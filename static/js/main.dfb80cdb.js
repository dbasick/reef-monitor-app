/*! For license information please see main.dfb80cdb.js.LICENSE.txt */
(()=>{"use strict";var e={43:(e,t,n)=>{e.exports=n(202)},98:(e,t,n)=>{e.exports=n.p+"static/media/ort-wasm-simd-threaded.jsep.9b38a8c18d5f4d131491.wasm"},153:(e,t,n)=>{var r=n(43),i=Symbol.for("react.element"),a=Symbol.for("react.fragment"),o=Object.prototype.hasOwnProperty,s=r.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED.ReactCurrentOwner,c={key:!0,ref:!0,__self:!0,__source:!0};function l(e,t,n){var r,a={},l=null,u=null;for(r in void 0!==n&&(l=""+n),void 0!==t.key&&(l=""+t.key),void 0!==t.ref&&(u=t.ref),t)o.call(t,r)&&!c.hasOwnProperty(r)&&(a[r]=t[r]);if(e&&e.defaultProps)for(r in t=e.defaultProps)void 0===a[r]&&(a[r]=t[r]);return{$$typeof:i,type:e,key:l,ref:u,props:a,_owner:s.current}}t.jsx=l,t.jsxs=l},202:(e,t)=>{var n=Symbol.for("react.element"),r=Symbol.for("react.portal"),i=Symbol.for("react.fragment"),a=Symbol.for("react.strict_mode"),o=Symbol.for("react.profiler"),s=Symbol.for("react.provider"),c=Symbol.for("react.context"),l=Symbol.for("react.forward_ref"),u=Symbol.for("react.suspense"),d=Symbol.for("react.memo"),h=Symbol.for("react.lazy"),f=Symbol.iterator;var p={isMounted:function(){return!1},enqueueForceUpdate:function(){},enqueueReplaceState:function(){},enqueueSetState:function(){}},m=Object.assign,g={};function y(e,t,n){this.props=e,this.context=t,this.refs=g,this.updater=n||p}function v(){}function w(e,t,n){this.props=e,this.context=t,this.refs=g,this.updater=n||p}y.prototype.isReactComponent={},y.prototype.setState=function(e,t){if("object"!==typeof e&&"function"!==typeof e&&null!=e)throw Error("setState(...): takes an object of state variables to update or a function which returns an object of state variables.");this.updater.enqueueSetState(this,e,t,"setState")},y.prototype.forceUpdate=function(e){this.updater.enqueueForceUpdate(this,e,"forceUpdate")},v.prototype=y.prototype;var b=w.prototype=new v;b.constructor=w,m(b,y.prototype),b.isPureReactComponent=!0;var _=Array.isArray,x=Object.prototype.hasOwnProperty,E={current:null},S={key:!0,ref:!0,__self:!0,__source:!0};function k(e,t,r){var i,a={},o=null,s=null;if(null!=t)for(i in void 0!==t.ref&&(s=t.ref),void 0!==t.key&&(o=""+t.key),t)x.call(t,i)&&!S.hasOwnProperty(i)&&(a[i]=t[i]);var c=arguments.length-2;if(1===c)a.children=r;else if(1<c){for(var l=Array(c),u=0;u<c;u++)l[u]=arguments[u+2];a.children=l}if(e&&e.defaultProps)for(i in c=e.defaultProps)void 0===a[i]&&(a[i]=c[i]);return{$$typeof:n,type:e,key:o,ref:s,props:a,_owner:E.current}}function T(e){return"object"===typeof e&&null!==e&&e.$$typeof===n}var I=/\/+/g;function C(e,t){return"object"===typeof e&&null!==e&&null!=e.key?function(e){var t={"=":"=0",":":"=2"};return"$"+e.replace(/[=:]/g,function(e){return t[e]})}(""+e.key):t.toString(36)}function A(e,t,i,a,o){var s=typeof e;"undefined"!==s&&"boolean"!==s||(e=null);var c=!1;if(null===e)c=!0;else switch(s){case"string":case"number":c=!0;break;case"object":switch(e.$$typeof){case n:case r:c=!0}}if(c)return o=o(c=e),e=""===a?"."+C(c,0):a,_(o)?(i="",null!=e&&(i=e.replace(I,"$&/")+"/"),A(o,t,i,"",function(e){return e})):null!=o&&(T(o)&&(o=function(e,t){return{$$typeof:n,type:e.type,key:t,ref:e.ref,props:e.props,_owner:e._owner}}(o,i+(!o.key||c&&c.key===o.key?"":(""+o.key).replace(I,"$&/")+"/")+e)),t.push(o)),1;if(c=0,a=""===a?".":a+":",_(e))for(var l=0;l<e.length;l++){var u=a+C(s=e[l],l);c+=A(s,t,i,u,o)}else if(u=function(e){return null===e||"object"!==typeof e?null:"function"===typeof(e=f&&e[f]||e["@@iterator"])?e:null}(e),"function"===typeof u)for(e=u.call(e),l=0;!(s=e.next()).done;)c+=A(s=s.value,t,i,u=a+C(s,l++),o);else if("object"===s)throw t=String(e),Error("Objects are not valid as a React child (found: "+("[object Object]"===t?"object with keys {"+Object.keys(e).join(", ")+"}":t)+"). If you meant to render a collection of children, use an array instead.");return c}function O(e,t,n){if(null==e)return e;var r=[],i=0;return A(e,r,"","",function(e){return t.call(n,e,i++)}),r}function N(e){if(-1===e._status){var t=e._result;(t=t()).then(function(t){0!==e._status&&-1!==e._status||(e._status=1,e._result=t)},function(t){0!==e._status&&-1!==e._status||(e._status=2,e._result=t)}),-1===e._status&&(e._status=0,e._result=t)}if(1===e._status)return e._result.default;throw e._result}var R={current:null},P={transition:null},D={ReactCurrentDispatcher:R,ReactCurrentBatchConfig:P,ReactCurrentOwner:E};function z(){throw Error("act(...) is not supported in production builds of React.")}t.Children={map:O,forEach:function(e,t,n){O(e,function(){t.apply(this,arguments)},n)},count:function(e){var t=0;return O(e,function(){t++}),t},toArray:function(e){return O(e,function(e){return e})||[]},only:function(e){if(!T(e))throw Error("React.Children.only expected to receive a single React element child.");return e}},t.Component=y,t.Fragment=i,t.Profiler=o,t.PureComponent=w,t.StrictMode=a,t.Suspense=u,t.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=D,t.act=z,t.cloneElement=function(e,t,r){if(null===e||void 0===e)throw Error("React.cloneElement(...): The argument must be a React element, but you passed "+e+".");var i=m({},e.props),a=e.key,o=e.ref,s=e._owner;if(null!=t){if(void 0!==t.ref&&(o=t.ref,s=E.current),void 0!==t.key&&(a=""+t.key),e.type&&e.type.defaultProps)var c=e.type.defaultProps;for(l in t)x.call(t,l)&&!S.hasOwnProperty(l)&&(i[l]=void 0===t[l]&&void 0!==c?c[l]:t[l])}var l=arguments.length-2;if(1===l)i.children=r;else if(1<l){c=Array(l);for(var u=0;u<l;u++)c[u]=arguments[u+2];i.children=c}return{$$typeof:n,type:e.type,key:a,ref:o,props:i,_owner:s}},t.createContext=function(e){return(e={$$typeof:c,_currentValue:e,_currentValue2:e,_threadCount:0,Provider:null,Consumer:null,_defaultValue:null,_globalName:null}).Provider={$$typeof:s,_context:e},e.Consumer=e},t.createElement=k,t.createFactory=function(e){var t=k.bind(null,e);return t.type=e,t},t.createRef=function(){return{current:null}},t.forwardRef=function(e){return{$$typeof:l,render:e}},t.isValidElement=T,t.lazy=function(e){return{$$typeof:h,_payload:{_status:-1,_result:e},_init:N}},t.memo=function(e,t){return{$$typeof:d,type:e,compare:void 0===t?null:t}},t.startTransition=function(e){var t=P.transition;P.transition={};try{e()}finally{P.transition=t}},t.unstable_act=z,t.useCallback=function(e,t){return R.current.useCallback(e,t)},t.useContext=function(e){return R.current.useContext(e)},t.useDebugValue=function(){},t.useDeferredValue=function(e){return R.current.useDeferredValue(e)},t.useEffect=function(e,t){return R.current.useEffect(e,t)},t.useId=function(){return R.current.useId()},t.useImperativeHandle=function(e,t,n){return R.current.useImperativeHandle(e,t,n)},t.useInsertionEffect=function(e,t){return R.current.useInsertionEffect(e,t)},t.useLayoutEffect=function(e,t){return R.current.useLayoutEffect(e,t)},t.useMemo=function(e,t){return R.current.useMemo(e,t)},t.useReducer=function(e,t,n){return R.current.useReducer(e,t,n)},t.useRef=function(e){return R.current.useRef(e)},t.useState=function(e){return R.current.useState(e)},t.useSyncExternalStore=function(e,t,n){return R.current.useSyncExternalStore(e,t,n)},t.useTransition=function(){return R.current.useTransition()},t.version="18.3.1"},234:(e,t)=>{function n(e,t){var n=e.length;e.push(t);e:for(;0<n;){var r=n-1>>>1,i=e[r];if(!(0<a(i,t)))break e;e[r]=t,e[n]=i,n=r}}function r(e){return 0===e.length?null:e[0]}function i(e){if(0===e.length)return null;var t=e[0],n=e.pop();if(n!==t){e[0]=n;e:for(var r=0,i=e.length,o=i>>>1;r<o;){var s=2*(r+1)-1,c=e[s],l=s+1,u=e[l];if(0>a(c,n))l<i&&0>a(u,c)?(e[r]=u,e[l]=n,r=l):(e[r]=c,e[s]=n,r=s);else{if(!(l<i&&0>a(u,n)))break e;e[r]=u,e[l]=n,r=l}}}return t}function a(e,t){var n=e.sortIndex-t.sortIndex;return 0!==n?n:e.id-t.id}if("object"===typeof performance&&"function"===typeof performance.now){var o=performance;t.unstable_now=function(){return o.now()}}else{var s=Date,c=s.now();t.unstable_now=function(){return s.now()-c}}var l=[],u=[],d=1,h=null,f=3,p=!1,m=!1,g=!1,y="function"===typeof setTimeout?setTimeout:null,v="function"===typeof clearTimeout?clearTimeout:null,w="undefined"!==typeof setImmediate?setImmediate:null;function b(e){for(var t=r(u);null!==t;){if(null===t.callback)i(u);else{if(!(t.startTime<=e))break;i(u),t.sortIndex=t.expirationTime,n(l,t)}t=r(u)}}function _(e){if(g=!1,b(e),!m)if(null!==r(l))m=!0,P(x);else{var t=r(u);null!==t&&D(_,t.startTime-e)}}function x(e,n){m=!1,g&&(g=!1,v(T),T=-1),p=!0;var a=f;try{for(b(n),h=r(l);null!==h&&(!(h.expirationTime>n)||e&&!A());){var o=h.callback;if("function"===typeof o){h.callback=null,f=h.priorityLevel;var s=o(h.expirationTime<=n);n=t.unstable_now(),"function"===typeof s?h.callback=s:h===r(l)&&i(l),b(n)}else i(l);h=r(l)}if(null!==h)var c=!0;else{var d=r(u);null!==d&&D(_,d.startTime-n),c=!1}return c}finally{h=null,f=a,p=!1}}"undefined"!==typeof navigator&&void 0!==navigator.scheduling&&void 0!==navigator.scheduling.isInputPending&&navigator.scheduling.isInputPending.bind(navigator.scheduling);var E,S=!1,k=null,T=-1,I=5,C=-1;function A(){return!(t.unstable_now()-C<I)}function O(){if(null!==k){var e=t.unstable_now();C=e;var n=!0;try{n=k(!0,e)}finally{n?E():(S=!1,k=null)}}else S=!1}if("function"===typeof w)E=function(){w(O)};else if("undefined"!==typeof MessageChannel){var N=new MessageChannel,R=N.port2;N.port1.onmessage=O,E=function(){R.postMessage(null)}}else E=function(){y(O,0)};function P(e){k=e,S||(S=!0,E())}function D(e,n){T=y(function(){e(t.unstable_now())},n)}t.unstable_IdlePriority=5,t.unstable_ImmediatePriority=1,t.unstable_LowPriority=4,t.unstable_NormalPriority=3,t.unstable_Profiling=null,t.unstable_UserBlockingPriority=2,t.unstable_cancelCallback=function(e){e.callback=null},t.unstable_continueExecution=function(){m||p||(m=!0,P(x))},t.unstable_forceFrameRate=function(e){0>e||125<e?console.error("forceFrameRate takes a positive int between 0 and 125, forcing frame rates higher than 125 fps is not supported"):I=0<e?Math.floor(1e3/e):5},t.unstable_getCurrentPriorityLevel=function(){return f},t.unstable_getFirstCallbackNode=function(){return r(l)},t.unstable_next=function(e){switch(f){case 1:case 2:case 3:var t=3;break;default:t=f}var n=f;f=t;try{return e()}finally{f=n}},t.unstable_pauseExecution=function(){},t.unstable_requestPaint=function(){},t.unstable_runWithPriority=function(e,t){switch(e){case 1:case 2:case 3:case 4:case 5:break;default:e=3}var n=f;f=e;try{return t()}finally{f=n}},t.unstable_scheduleCallback=function(e,i,a){var o=t.unstable_now();switch("object"===typeof a&&null!==a?a="number"===typeof(a=a.delay)&&0<a?o+a:o:a=o,e){case 1:var s=-1;break;case 2:s=250;break;case 5:s=1073741823;break;case 4:s=1e4;break;default:s=5e3}return e={id:d++,callback:i,priorityLevel:e,startTime:a,expirationTime:s=a+s,sortIndex:-1},a>o?(e.sortIndex=a,n(u,e),null===r(l)&&e===r(u)&&(g?(v(T),T=-1):g=!0,D(_,a-o))):(e.sortIndex=s,n(l,e),m||p||(m=!0,P(x))),e},t.unstable_shouldYield=A,t.unstable_wrapCallback=function(e){var t=f;return function(){var n=f;f=t;try{return e.apply(this,arguments)}finally{f=n}}}},579:(e,t,n)=>{e.exports=n(153)},618:(e,t,n)=>{e.exports=n.p+"static/media/ort.bundle.min.fdf769c7752a5def7ed2.mjs"},730:(e,t,n)=>{var r=n(43),i=n(853);function a(e){for(var t="https://reactjs.org/docs/error-decoder.html?invariant="+e,n=1;n<arguments.length;n++)t+="&args[]="+encodeURIComponent(arguments[n]);return"Minified React error #"+e+"; visit "+t+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}var o=new Set,s={};function c(e,t){l(e,t),l(e+"Capture",t)}function l(e,t){for(s[e]=t,e=0;e<t.length;e++)o.add(t[e])}var u=!("undefined"===typeof window||"undefined"===typeof window.document||"undefined"===typeof window.document.createElement),d=Object.prototype.hasOwnProperty,h=/^[:A-Z_a-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD][:A-Z_a-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD\-.0-9\u00B7\u0300-\u036F\u203F-\u2040]*$/,f={},p={};function m(e,t,n,r,i,a,o){this.acceptsBooleans=2===t||3===t||4===t,this.attributeName=r,this.attributeNamespace=i,this.mustUseProperty=n,this.propertyName=e,this.type=t,this.sanitizeURL=a,this.removeEmptyString=o}var g={};"children dangerouslySetInnerHTML defaultValue defaultChecked innerHTML suppressContentEditableWarning suppressHydrationWarning style".split(" ").forEach(function(e){g[e]=new m(e,0,!1,e,null,!1,!1)}),[["acceptCharset","accept-charset"],["className","class"],["htmlFor","for"],["httpEquiv","http-equiv"]].forEach(function(e){var t=e[0];g[t]=new m(t,1,!1,e[1],null,!1,!1)}),["contentEditable","draggable","spellCheck","value"].forEach(function(e){g[e]=new m(e,2,!1,e.toLowerCase(),null,!1,!1)}),["autoReverse","externalResourcesRequired","focusable","preserveAlpha"].forEach(function(e){g[e]=new m(e,2,!1,e,null,!1,!1)}),"allowFullScreen async autoFocus autoPlay controls default defer disabled disablePictureInPicture disableRemotePlayback formNoValidate hidden loop noModule noValidate open playsInline readOnly required reversed scoped seamless itemScope".split(" ").forEach(function(e){g[e]=new m(e,3,!1,e.toLowerCase(),null,!1,!1)}),["checked","multiple","muted","selected"].forEach(function(e){g[e]=new m(e,3,!0,e,null,!1,!1)}),["capture","download"].forEach(function(e){g[e]=new m(e,4,!1,e,null,!1,!1)}),["cols","rows","size","span"].forEach(function(e){g[e]=new m(e,6,!1,e,null,!1,!1)}),["rowSpan","start"].forEach(function(e){g[e]=new m(e,5,!1,e.toLowerCase(),null,!1,!1)});var y=/[\-:]([a-z])/g;function v(e){return e[1].toUpperCase()}function w(e,t,n,r){var i=g.hasOwnProperty(t)?g[t]:null;(null!==i?0!==i.type:r||!(2<t.length)||"o"!==t[0]&&"O"!==t[0]||"n"!==t[1]&&"N"!==t[1])&&(function(e,t,n,r){if(null===t||"undefined"===typeof t||function(e,t,n,r){if(null!==n&&0===n.type)return!1;switch(typeof t){case"function":case"symbol":return!0;case"boolean":return!r&&(null!==n?!n.acceptsBooleans:"data-"!==(e=e.toLowerCase().slice(0,5))&&"aria-"!==e);default:return!1}}(e,t,n,r))return!0;if(r)return!1;if(null!==n)switch(n.type){case 3:return!t;case 4:return!1===t;case 5:return isNaN(t);case 6:return isNaN(t)||1>t}return!1}(t,n,i,r)&&(n=null),r||null===i?function(e){return!!d.call(p,e)||!d.call(f,e)&&(h.test(e)?p[e]=!0:(f[e]=!0,!1))}(t)&&(null===n?e.removeAttribute(t):e.setAttribute(t,""+n)):i.mustUseProperty?e[i.propertyName]=null===n?3!==i.type&&"":n:(t=i.attributeName,r=i.attributeNamespace,null===n?e.removeAttribute(t):(n=3===(i=i.type)||4===i&&!0===n?"":""+n,r?e.setAttributeNS(r,t,n):e.setAttribute(t,n))))}"accent-height alignment-baseline arabic-form baseline-shift cap-height clip-path clip-rule color-interpolation color-interpolation-filters color-profile color-rendering dominant-baseline enable-background fill-opacity fill-rule flood-color flood-opacity font-family font-size font-size-adjust font-stretch font-style font-variant font-weight glyph-name glyph-orientation-horizontal glyph-orientation-vertical horiz-adv-x horiz-origin-x image-rendering letter-spacing lighting-color marker-end marker-mid marker-start overline-position overline-thickness paint-order panose-1 pointer-events rendering-intent shape-rendering stop-color stop-opacity strikethrough-position strikethrough-thickness stroke-dasharray stroke-dashoffset stroke-linecap stroke-linejoin stroke-miterlimit stroke-opacity stroke-width text-anchor text-decoration text-rendering underline-position underline-thickness unicode-bidi unicode-range units-per-em v-alphabetic v-hanging v-ideographic v-mathematical vector-effect vert-adv-y vert-origin-x vert-origin-y word-spacing writing-mode xmlns:xlink x-height".split(" ").forEach(function(e){var t=e.replace(y,v);g[t]=new m(t,1,!1,e,null,!1,!1)}),"xlink:actuate xlink:arcrole xlink:role xlink:show xlink:title xlink:type".split(" ").forEach(function(e){var t=e.replace(y,v);g[t]=new m(t,1,!1,e,"http://www.w3.org/1999/xlink",!1,!1)}),["xml:base","xml:lang","xml:space"].forEach(function(e){var t=e.replace(y,v);g[t]=new m(t,1,!1,e,"http://www.w3.org/XML/1998/namespace",!1,!1)}),["tabIndex","crossOrigin"].forEach(function(e){g[e]=new m(e,1,!1,e.toLowerCase(),null,!1,!1)}),g.xlinkHref=new m("xlinkHref",1,!1,"xlink:href","http://www.w3.org/1999/xlink",!0,!1),["src","href","action","formAction"].forEach(function(e){g[e]=new m(e,1,!1,e.toLowerCase(),null,!0,!0)});var b=r.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED,_=Symbol.for("react.element"),x=Symbol.for("react.portal"),E=Symbol.for("react.fragment"),S=Symbol.for("react.strict_mode"),k=Symbol.for("react.profiler"),T=Symbol.for("react.provider"),I=Symbol.for("react.context"),C=Symbol.for("react.forward_ref"),O=Symbol.for("react.suspense"),N=Symbol.for("react.suspense_list"),R=Symbol.for("react.memo"),P=Symbol.for("react.lazy");Symbol.for("react.scope"),Symbol.for("react.debug_trace_mode");var D=Symbol.for("react.offscreen");Symbol.for("react.legacy_hidden"),Symbol.for("react.cache"),Symbol.for("react.tracing_marker");var z=Symbol.iterator;function M(e){return null===e||"object"!==typeof e?null:"function"===typeof(e=z&&e[z]||e["@@iterator"])?e:null}var L,U=Object.assign;function B(e){if(void 0===L)try{throw Error()}catch($_){var t=$_.stack.trim().match(/\n( *(at )?)/);L=t&&t[1]||""}return"\n"+L+e}var F=!1;function j(e,t){if(!e||F)return"";F=!0;var n=Error.prepareStackTrace;Error.prepareStackTrace=void 0;try{if(t)if(t=function(){throw Error()},Object.defineProperty(t.prototype,"props",{set:function(){throw Error()}}),"object"===typeof Reflect&&Reflect.construct){try{Reflect.construct(t,[])}catch(l){var r=l}Reflect.construct(e,[],t)}else{try{t.call()}catch(l){r=l}e.call(t.prototype)}else{try{throw Error()}catch(l){r=l}e()}}catch(l){if(l&&r&&"string"===typeof l.stack){for(var i=l.stack.split("\n"),a=r.stack.split("\n"),o=i.length-1,s=a.length-1;1<=o&&0<=s&&i[o]!==a[s];)s--;for(;1<=o&&0<=s;o--,s--)if(i[o]!==a[s]){if(1!==o||1!==s)do{if(o--,0>--s||i[o]!==a[s]){var c="\n"+i[o].replace(" at new "," at ");return e.displayName&&c.includes("<anonymous>")&&(c=c.replace("<anonymous>",e.displayName)),c}}while(1<=o&&0<=s);break}}}finally{F=!1,Error.prepareStackTrace=n}return(e=e?e.displayName||e.name:"")?B(e):""}function V(e){switch(e.tag){case 5:return B(e.type);case 16:return B("Lazy");case 13:return B("Suspense");case 19:return B("SuspenseList");case 0:case 2:case 15:return e=j(e.type,!1);case 11:return e=j(e.type.render,!1);case 1:return e=j(e.type,!0);default:return""}}function q(e){if(null==e)return null;if("function"===typeof e)return e.displayName||e.name||null;if("string"===typeof e)return e;switch(e){case E:return"Fragment";case x:return"Portal";case k:return"Profiler";case S:return"StrictMode";case O:return"Suspense";case N:return"SuspenseList"}if("object"===typeof e)switch(e.$$typeof){case I:return(e.displayName||"Context")+".Consumer";case T:return(e._context.displayName||"Context")+".Provider";case C:var t=e.render;return(e=e.displayName)||(e=""!==(e=t.displayName||t.name||"")?"ForwardRef("+e+")":"ForwardRef"),e;case R:return null!==(t=e.displayName||null)?t:q(e.type)||"Memo";case P:t=e._payload,e=e._init;try{return q(e(t))}catch($_){}}return null}function H(e){var t=e.type;switch(e.tag){case 24:return"Cache";case 9:return(t.displayName||"Context")+".Consumer";case 10:return(t._context.displayName||"Context")+".Provider";case 18:return"DehydratedFragment";case 11:return e=(e=t.render).displayName||e.name||"",t.displayName||(""!==e?"ForwardRef("+e+")":"ForwardRef");case 7:return"Fragment";case 5:return t;case 4:return"Portal";case 3:return"Root";case 6:return"Text";case 16:return q(t);case 8:return t===S?"StrictMode":"Mode";case 22:return"Offscreen";case 12:return"Profiler";case 21:return"Scope";case 13:return"Suspense";case 19:return"SuspenseList";case 25:return"TracingMarker";case 1:case 0:case 17:case 2:case 14:case 15:if("function"===typeof t)return t.displayName||t.name||null;if("string"===typeof t)return t}return null}function W(e){switch(typeof e){case"boolean":case"number":case"string":case"undefined":case"object":return e;default:return""}}function G(e){var t=e.type;return(e=e.nodeName)&&"input"===e.toLowerCase()&&("checkbox"===t||"radio"===t)}function K(e){e._valueTracker||(e._valueTracker=function(e){var t=G(e)?"checked":"value",n=Object.getOwnPropertyDescriptor(e.constructor.prototype,t),r=""+e[t];if(!e.hasOwnProperty(t)&&"undefined"!==typeof n&&"function"===typeof n.get&&"function"===typeof n.set){var i=n.get,a=n.set;return Object.defineProperty(e,t,{configurable:!0,get:function(){return i.call(this)},set:function(e){r=""+e,a.call(this,e)}}),Object.defineProperty(e,t,{enumerable:n.enumerable}),{getValue:function(){return r},setValue:function(e){r=""+e},stopTracking:function(){e._valueTracker=null,delete e[t]}}}}(e))}function Q(e){if(!e)return!1;var t=e._valueTracker;if(!t)return!0;var n=t.getValue(),r="";return e&&(r=G(e)?e.checked?"true":"false":e.value),(e=r)!==n&&(t.setValue(e),!0)}function X(e){if("undefined"===typeof(e=e||("undefined"!==typeof document?document:void 0)))return null;try{return e.activeElement||e.body}catch(tp){return e.body}}function Y(e,t){var n=t.checked;return U({},t,{defaultChecked:void 0,defaultValue:void 0,value:void 0,checked:null!=n?n:e._wrapperState.initialChecked})}function J(e,t){var n=null==t.defaultValue?"":t.defaultValue,r=null!=t.checked?t.checked:t.defaultChecked;n=W(null!=t.value?t.value:n),e._wrapperState={initialChecked:r,initialValue:n,controlled:"checkbox"===t.type||"radio"===t.type?null!=t.checked:null!=t.value}}function $(e,t){null!=(t=t.checked)&&w(e,"checked",t,!1)}function Z(e,t){$(e,t);var n=W(t.value),r=t.type;if(null!=n)"number"===r?(0===n&&""===e.value||e.value!=n)&&(e.value=""+n):e.value!==""+n&&(e.value=""+n);else if("submit"===r||"reset"===r)return void e.removeAttribute("value");t.hasOwnProperty("value")?te(e,t.type,n):t.hasOwnProperty("defaultValue")&&te(e,t.type,W(t.defaultValue)),null==t.checked&&null!=t.defaultChecked&&(e.defaultChecked=!!t.defaultChecked)}function ee(e,t,n){if(t.hasOwnProperty("value")||t.hasOwnProperty("defaultValue")){var r=t.type;if(!("submit"!==r&&"reset"!==r||void 0!==t.value&&null!==t.value))return;t=""+e._wrapperState.initialValue,n||t===e.value||(e.value=t),e.defaultValue=t}""!==(n=e.name)&&(e.name=""),e.defaultChecked=!!e._wrapperState.initialChecked,""!==n&&(e.name=n)}function te(e,t,n){"number"===t&&X(e.ownerDocument)===e||(null==n?e.defaultValue=""+e._wrapperState.initialValue:e.defaultValue!==""+n&&(e.defaultValue=""+n))}var ne=Array.isArray;function re(e,t,n,r){if(e=e.options,t){t={};for(var i=0;i<n.length;i++)t["$"+n[i]]=!0;for(n=0;n<e.length;n++)i=t.hasOwnProperty("$"+e[n].value),e[n].selected!==i&&(e[n].selected=i),i&&r&&(e[n].defaultSelected=!0)}else{for(n=""+W(n),t=null,i=0;i<e.length;i++){if(e[i].value===n)return e[i].selected=!0,void(r&&(e[i].defaultSelected=!0));null!==t||e[i].disabled||(t=e[i])}null!==t&&(t.selected=!0)}}function ie(e,t){if(null!=t.dangerouslySetInnerHTML)throw Error(a(91));return U({},t,{value:void 0,defaultValue:void 0,children:""+e._wrapperState.initialValue})}function ae(e,t){var n=t.value;if(null==n){if(n=t.children,t=t.defaultValue,null!=n){if(null!=t)throw Error(a(92));if(ne(n)){if(1<n.length)throw Error(a(93));n=n[0]}t=n}null==t&&(t=""),n=t}e._wrapperState={initialValue:W(n)}}function oe(e,t){var n=W(t.value),r=W(t.defaultValue);null!=n&&((n=""+n)!==e.value&&(e.value=n),null==t.defaultValue&&e.defaultValue!==n&&(e.defaultValue=n)),null!=r&&(e.defaultValue=""+r)}function se(e){var t=e.textContent;t===e._wrapperState.initialValue&&""!==t&&null!==t&&(e.value=t)}function ce(e){switch(e){case"svg":return"http://www.w3.org/2000/svg";case"math":return"http://www.w3.org/1998/Math/MathML";default:return"http://www.w3.org/1999/xhtml"}}function le(e,t){return null==e||"http://www.w3.org/1999/xhtml"===e?ce(t):"http://www.w3.org/2000/svg"===e&&"foreignObject"===t?"http://www.w3.org/1999/xhtml":e}var ue,de=function(e){return"undefined"!==typeof MSApp&&MSApp.execUnsafeLocalFunction?function(t,n,r,i){MSApp.execUnsafeLocalFunction(function(){return e(t,n)})}:e}(function(e,t){if("http://www.w3.org/2000/svg"!==e.namespaceURI||"innerHTML"in e)e.innerHTML=t;else{for((ue=ue||document.createElement("div")).innerHTML="<svg>"+t.valueOf().toString()+"</svg>",t=ue.firstChild;e.firstChild;)e.removeChild(e.firstChild);for(;t.firstChild;)e.appendChild(t.firstChild)}});function he(e,t){if(t){var n=e.firstChild;if(n&&n===e.lastChild&&3===n.nodeType)return void(n.nodeValue=t)}e.textContent=t}var fe={animationIterationCount:!0,aspectRatio:!0,borderImageOutset:!0,borderImageSlice:!0,borderImageWidth:!0,boxFlex:!0,boxFlexGroup:!0,boxOrdinalGroup:!0,columnCount:!0,columns:!0,flex:!0,flexGrow:!0,flexPositive:!0,flexShrink:!0,flexNegative:!0,flexOrder:!0,gridArea:!0,gridRow:!0,gridRowEnd:!0,gridRowSpan:!0,gridRowStart:!0,gridColumn:!0,gridColumnEnd:!0,gridColumnSpan:!0,gridColumnStart:!0,fontWeight:!0,lineClamp:!0,lineHeight:!0,opacity:!0,order:!0,orphans:!0,tabSize:!0,widows:!0,zIndex:!0,zoom:!0,fillOpacity:!0,floodOpacity:!0,stopOpacity:!0,strokeDasharray:!0,strokeDashoffset:!0,strokeMiterlimit:!0,strokeOpacity:!0,strokeWidth:!0},pe=["Webkit","ms","Moz","O"];function me(e,t,n){return null==t||"boolean"===typeof t||""===t?"":n||"number"!==typeof t||0===t||fe.hasOwnProperty(e)&&fe[e]?(""+t).trim():t+"px"}function ge(e,t){for(var n in e=e.style,t)if(t.hasOwnProperty(n)){var r=0===n.indexOf("--"),i=me(n,t[n],r);"float"===n&&(n="cssFloat"),r?e.setProperty(n,i):e[n]=i}}Object.keys(fe).forEach(function(e){pe.forEach(function(t){t=t+e.charAt(0).toUpperCase()+e.substring(1),fe[t]=fe[e]})});var ye=U({menuitem:!0},{area:!0,base:!0,br:!0,col:!0,embed:!0,hr:!0,img:!0,input:!0,keygen:!0,link:!0,meta:!0,param:!0,source:!0,track:!0,wbr:!0});function ve(e,t){if(t){if(ye[e]&&(null!=t.children||null!=t.dangerouslySetInnerHTML))throw Error(a(137,e));if(null!=t.dangerouslySetInnerHTML){if(null!=t.children)throw Error(a(60));if("object"!==typeof t.dangerouslySetInnerHTML||!("__html"in t.dangerouslySetInnerHTML))throw Error(a(61))}if(null!=t.style&&"object"!==typeof t.style)throw Error(a(62))}}function we(e,t){if(-1===e.indexOf("-"))return"string"===typeof t.is;switch(e){case"annotation-xml":case"color-profile":case"font-face":case"font-face-src":case"font-face-uri":case"font-face-format":case"font-face-name":case"missing-glyph":return!1;default:return!0}}var be=null;function _e(e){return(e=e.target||e.srcElement||window).correspondingUseElement&&(e=e.correspondingUseElement),3===e.nodeType?e.parentNode:e}var xe=null,Ee=null,Se=null;function ke(e){if(e=wi(e)){if("function"!==typeof xe)throw Error(a(280));var t=e.stateNode;t&&(t=_i(t),xe(e.stateNode,e.type,t))}}function Te(e){Ee?Se?Se.push(e):Se=[e]:Ee=e}function Ie(){if(Ee){var e=Ee,t=Se;if(Se=Ee=null,ke(e),t)for(e=0;e<t.length;e++)ke(t[e])}}function Ce(e,t){return e(t)}function Ae(){}var Oe=!1;function Ne(e,t,n){if(Oe)return e(t,n);Oe=!0;try{return Ce(e,t,n)}finally{Oe=!1,(null!==Ee||null!==Se)&&(Ae(),Ie())}}function Re(e,t){var n=e.stateNode;if(null===n)return null;var r=_i(n);if(null===r)return null;n=r[t];e:switch(t){case"onClick":case"onClickCapture":case"onDoubleClick":case"onDoubleClickCapture":case"onMouseDown":case"onMouseDownCapture":case"onMouseMove":case"onMouseMoveCapture":case"onMouseUp":case"onMouseUpCapture":case"onMouseEnter":(r=!r.disabled)||(r=!("button"===(e=e.type)||"input"===e||"select"===e||"textarea"===e)),e=!r;break e;default:e=!1}if(e)return null;if(n&&"function"!==typeof n)throw Error(a(231,t,typeof n));return n}var Pe=!1;if(u)try{var De={};Object.defineProperty(De,"passive",{get:function(){Pe=!0}}),window.addEventListener("test",De,De),window.removeEventListener("test",De,De)}catch(N_){Pe=!1}function ze(e,t,n,r,i,a,o,s,c){var l=Array.prototype.slice.call(arguments,3);try{t.apply(n,l)}catch(u){this.onError(u)}}var Me=!1,Le=null,Ue=!1,Be=null,Fe={onError:function(e){Me=!0,Le=e}};function je(e,t,n,r,i,a,o,s,c){Me=!1,Le=null,ze.apply(Fe,arguments)}function Ve(e){var t=e,n=e;if(e.alternate)for(;t.return;)t=t.return;else{e=t;do{0!==(4098&(t=e).flags)&&(n=t.return),e=t.return}while(e)}return 3===t.tag?n:null}function qe(e){if(13===e.tag){var t=e.memoizedState;if(null===t&&(null!==(e=e.alternate)&&(t=e.memoizedState)),null!==t)return t.dehydrated}return null}function He(e){if(Ve(e)!==e)throw Error(a(188))}function We(e){return e=function(e){var t=e.alternate;if(!t){if(null===(t=Ve(e)))throw Error(a(188));return t!==e?null:e}for(var n=e,r=t;;){var i=n.return;if(null===i)break;var o=i.alternate;if(null===o){if(null!==(r=i.return)){n=r;continue}break}if(i.child===o.child){for(o=i.child;o;){if(o===n)return He(i),e;if(o===r)return He(i),t;o=o.sibling}throw Error(a(188))}if(n.return!==r.return)n=i,r=o;else{for(var s=!1,c=i.child;c;){if(c===n){s=!0,n=i,r=o;break}if(c===r){s=!0,r=i,n=o;break}c=c.sibling}if(!s){for(c=o.child;c;){if(c===n){s=!0,n=o,r=i;break}if(c===r){s=!0,r=o,n=i;break}c=c.sibling}if(!s)throw Error(a(189))}}if(n.alternate!==r)throw Error(a(190))}if(3!==n.tag)throw Error(a(188));return n.stateNode.current===n?e:t}(e),null!==e?Ge(e):null}function Ge(e){if(5===e.tag||6===e.tag)return e;for(e=e.child;null!==e;){var t=Ge(e);if(null!==t)return t;e=e.sibling}return null}var Ke=i.unstable_scheduleCallback,Qe=i.unstable_cancelCallback,Xe=i.unstable_shouldYield,Ye=i.unstable_requestPaint,Je=i.unstable_now,$e=i.unstable_getCurrentPriorityLevel,Ze=i.unstable_ImmediatePriority,et=i.unstable_UserBlockingPriority,tt=i.unstable_NormalPriority,nt=i.unstable_LowPriority,rt=i.unstable_IdlePriority,it=null,at=null;var ot=Math.clz32?Math.clz32:function(e){return e>>>=0,0===e?32:31-(st(e)/ct|0)|0},st=Math.log,ct=Math.LN2;var lt=64,ut=4194304;function dt(e){switch(e&-e){case 1:return 1;case 2:return 2;case 4:return 4;case 8:return 8;case 16:return 16;case 32:return 32;case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return 4194240&e;case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:return 130023424&e;case 134217728:return 134217728;case 268435456:return 268435456;case 536870912:return 536870912;case 1073741824:return 1073741824;default:return e}}function ht(e,t){var n=e.pendingLanes;if(0===n)return 0;var r=0,i=e.suspendedLanes,a=e.pingedLanes,o=268435455&n;if(0!==o){var s=o&~i;0!==s?r=dt(s):0!==(a&=o)&&(r=dt(a))}else 0!==(o=n&~i)?r=dt(o):0!==a&&(r=dt(a));if(0===r)return 0;if(0!==t&&t!==r&&0===(t&i)&&((i=r&-r)>=(a=t&-t)||16===i&&0!==(4194240&a)))return t;if(0!==(4&r)&&(r|=16&n),0!==(t=e.entangledLanes))for(e=e.entanglements,t&=r;0<t;)i=1<<(n=31-ot(t)),r|=e[n],t&=~i;return r}function ft(e,t){switch(e){case 1:case 2:case 4:return t+250;case 8:case 16:case 32:case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return t+5e3;default:return-1}}function pt(e){return 0!==(e=-1073741825&e.pendingLanes)?e:1073741824&e?1073741824:0}function mt(){var e=lt;return 0===(4194240&(lt<<=1))&&(lt=64),e}function gt(e){for(var t=[],n=0;31>n;n++)t.push(e);return t}function yt(e,t,n){e.pendingLanes|=t,536870912!==t&&(e.suspendedLanes=0,e.pingedLanes=0),(e=e.eventTimes)[t=31-ot(t)]=n}function vt(e,t){var n=e.entangledLanes|=t;for(e=e.entanglements;n;){var r=31-ot(n),i=1<<r;i&t|e[r]&t&&(e[r]|=t),n&=~i}}var wt=0;function bt(e){return 1<(e&=-e)?4<e?0!==(268435455&e)?16:536870912:4:1}var _t,xt,Et,St,kt,Tt=!1,It=[],Ct=null,At=null,Ot=null,Nt=new Map,Rt=new Map,Pt=[],Dt="mousedown mouseup touchcancel touchend touchstart auxclick dblclick pointercancel pointerdown pointerup dragend dragstart drop compositionend compositionstart keydown keypress keyup input textInput copy cut paste click change contextmenu reset submit".split(" ");function zt(e,t){switch(e){case"focusin":case"focusout":Ct=null;break;case"dragenter":case"dragleave":At=null;break;case"mouseover":case"mouseout":Ot=null;break;case"pointerover":case"pointerout":Nt.delete(t.pointerId);break;case"gotpointercapture":case"lostpointercapture":Rt.delete(t.pointerId)}}function Mt(e,t,n,r,i,a){return null===e||e.nativeEvent!==a?(e={blockedOn:t,domEventName:n,eventSystemFlags:r,nativeEvent:a,targetContainers:[i]},null!==t&&(null!==(t=wi(t))&&xt(t)),e):(e.eventSystemFlags|=r,t=e.targetContainers,null!==i&&-1===t.indexOf(i)&&t.push(i),e)}function Lt(e){var t=vi(e.target);if(null!==t){var n=Ve(t);if(null!==n)if(13===(t=n.tag)){if(null!==(t=qe(n)))return e.blockedOn=t,void kt(e.priority,function(){Et(n)})}else if(3===t&&n.stateNode.current.memoizedState.isDehydrated)return void(e.blockedOn=3===n.tag?n.stateNode.containerInfo:null)}e.blockedOn=null}function Ut(e){if(null!==e.blockedOn)return!1;for(var t=e.targetContainers;0<t.length;){var n=Xt(e.domEventName,e.eventSystemFlags,t[0],e.nativeEvent);if(null!==n)return null!==(t=wi(n))&&xt(t),e.blockedOn=n,!1;var r=new(n=e.nativeEvent).constructor(n.type,n);be=r,n.target.dispatchEvent(r),be=null,t.shift()}return!0}function Bt(e,t,n){Ut(e)&&n.delete(t)}function Ft(){Tt=!1,null!==Ct&&Ut(Ct)&&(Ct=null),null!==At&&Ut(At)&&(At=null),null!==Ot&&Ut(Ot)&&(Ot=null),Nt.forEach(Bt),Rt.forEach(Bt)}function jt(e,t){e.blockedOn===t&&(e.blockedOn=null,Tt||(Tt=!0,i.unstable_scheduleCallback(i.unstable_NormalPriority,Ft)))}function Vt(e){function t(t){return jt(t,e)}if(0<It.length){jt(It[0],e);for(var n=1;n<It.length;n++){var r=It[n];r.blockedOn===e&&(r.blockedOn=null)}}for(null!==Ct&&jt(Ct,e),null!==At&&jt(At,e),null!==Ot&&jt(Ot,e),Nt.forEach(t),Rt.forEach(t),n=0;n<Pt.length;n++)(r=Pt[n]).blockedOn===e&&(r.blockedOn=null);for(;0<Pt.length&&null===(n=Pt[0]).blockedOn;)Lt(n),null===n.blockedOn&&Pt.shift()}var qt=b.ReactCurrentBatchConfig,Ht=!0;function Wt(e,t,n,r){var i=wt,a=qt.transition;qt.transition=null;try{wt=1,Kt(e,t,n,r)}finally{wt=i,qt.transition=a}}function Gt(e,t,n,r){var i=wt,a=qt.transition;qt.transition=null;try{wt=4,Kt(e,t,n,r)}finally{wt=i,qt.transition=a}}function Kt(e,t,n,r){if(Ht){var i=Xt(e,t,n,r);if(null===i)Hr(e,t,r,Qt,n),zt(e,r);else if(function(e,t,n,r,i){switch(t){case"focusin":return Ct=Mt(Ct,e,t,n,r,i),!0;case"dragenter":return At=Mt(At,e,t,n,r,i),!0;case"mouseover":return Ot=Mt(Ot,e,t,n,r,i),!0;case"pointerover":var a=i.pointerId;return Nt.set(a,Mt(Nt.get(a)||null,e,t,n,r,i)),!0;case"gotpointercapture":return a=i.pointerId,Rt.set(a,Mt(Rt.get(a)||null,e,t,n,r,i)),!0}return!1}(i,e,t,n,r))r.stopPropagation();else if(zt(e,r),4&t&&-1<Dt.indexOf(e)){for(;null!==i;){var a=wi(i);if(null!==a&&_t(a),null===(a=Xt(e,t,n,r))&&Hr(e,t,r,Qt,n),a===i)break;i=a}null!==i&&r.stopPropagation()}else Hr(e,t,r,null,n)}}var Qt=null;function Xt(e,t,n,r){if(Qt=null,null!==(e=vi(e=_e(r))))if(null===(t=Ve(e)))e=null;else if(13===(n=t.tag)){if(null!==(e=qe(t)))return e;e=null}else if(3===n){if(t.stateNode.current.memoizedState.isDehydrated)return 3===t.tag?t.stateNode.containerInfo:null;e=null}else t!==e&&(e=null);return Qt=e,null}function Yt(e){switch(e){case"cancel":case"click":case"close":case"contextmenu":case"copy":case"cut":case"auxclick":case"dblclick":case"dragend":case"dragstart":case"drop":case"focusin":case"focusout":case"input":case"invalid":case"keydown":case"keypress":case"keyup":case"mousedown":case"mouseup":case"paste":case"pause":case"play":case"pointercancel":case"pointerdown":case"pointerup":case"ratechange":case"reset":case"resize":case"seeked":case"submit":case"touchcancel":case"touchend":case"touchstart":case"volumechange":case"change":case"selectionchange":case"textInput":case"compositionstart":case"compositionend":case"compositionupdate":case"beforeblur":case"afterblur":case"beforeinput":case"blur":case"fullscreenchange":case"focus":case"hashchange":case"popstate":case"select":case"selectstart":return 1;case"drag":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"mousemove":case"mouseout":case"mouseover":case"pointermove":case"pointerout":case"pointerover":case"scroll":case"toggle":case"touchmove":case"wheel":case"mouseenter":case"mouseleave":case"pointerenter":case"pointerleave":return 4;case"message":switch($e()){case Ze:return 1;case et:return 4;case tt:case nt:return 16;case rt:return 536870912;default:return 16}default:return 16}}var Jt=null,$t=null,Zt=null;function en(){if(Zt)return Zt;var e,t,n=$t,r=n.length,i="value"in Jt?Jt.value:Jt.textContent,a=i.length;for(e=0;e<r&&n[e]===i[e];e++);var o=r-e;for(t=1;t<=o&&n[r-t]===i[a-t];t++);return Zt=i.slice(e,1<t?1-t:void 0)}function tn(e){var t=e.keyCode;return"charCode"in e?0===(e=e.charCode)&&13===t&&(e=13):e=t,10===e&&(e=13),32<=e||13===e?e:0}function nn(){return!0}function rn(){return!1}function an(e){function t(t,n,r,i,a){for(var o in this._reactName=t,this._targetInst=r,this.type=n,this.nativeEvent=i,this.target=a,this.currentTarget=null,e)e.hasOwnProperty(o)&&(t=e[o],this[o]=t?t(i):i[o]);return this.isDefaultPrevented=(null!=i.defaultPrevented?i.defaultPrevented:!1===i.returnValue)?nn:rn,this.isPropagationStopped=rn,this}return U(t.prototype,{preventDefault:function(){this.defaultPrevented=!0;var e=this.nativeEvent;e&&(e.preventDefault?e.preventDefault():"unknown"!==typeof e.returnValue&&(e.returnValue=!1),this.isDefaultPrevented=nn)},stopPropagation:function(){var e=this.nativeEvent;e&&(e.stopPropagation?e.stopPropagation():"unknown"!==typeof e.cancelBubble&&(e.cancelBubble=!0),this.isPropagationStopped=nn)},persist:function(){},isPersistent:nn}),t}var on,sn,cn,ln={eventPhase:0,bubbles:0,cancelable:0,timeStamp:function(e){return e.timeStamp||Date.now()},defaultPrevented:0,isTrusted:0},un=an(ln),dn=U({},ln,{view:0,detail:0}),hn=an(dn),fn=U({},dn,{screenX:0,screenY:0,clientX:0,clientY:0,pageX:0,pageY:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,getModifierState:kn,button:0,buttons:0,relatedTarget:function(e){return void 0===e.relatedTarget?e.fromElement===e.srcElement?e.toElement:e.fromElement:e.relatedTarget},movementX:function(e){return"movementX"in e?e.movementX:(e!==cn&&(cn&&"mousemove"===e.type?(on=e.screenX-cn.screenX,sn=e.screenY-cn.screenY):sn=on=0,cn=e),on)},movementY:function(e){return"movementY"in e?e.movementY:sn}}),pn=an(fn),mn=an(U({},fn,{dataTransfer:0})),gn=an(U({},dn,{relatedTarget:0})),yn=an(U({},ln,{animationName:0,elapsedTime:0,pseudoElement:0})),vn=U({},ln,{clipboardData:function(e){return"clipboardData"in e?e.clipboardData:window.clipboardData}}),wn=an(vn),bn=an(U({},ln,{data:0})),_n={Esc:"Escape",Spacebar:" ",Left:"ArrowLeft",Up:"ArrowUp",Right:"ArrowRight",Down:"ArrowDown",Del:"Delete",Win:"OS",Menu:"ContextMenu",Apps:"ContextMenu",Scroll:"ScrollLock",MozPrintableKey:"Unidentified"},xn={8:"Backspace",9:"Tab",12:"Clear",13:"Enter",16:"Shift",17:"Control",18:"Alt",19:"Pause",20:"CapsLock",27:"Escape",32:" ",33:"PageUp",34:"PageDown",35:"End",36:"Home",37:"ArrowLeft",38:"ArrowUp",39:"ArrowRight",40:"ArrowDown",45:"Insert",46:"Delete",112:"F1",113:"F2",114:"F3",115:"F4",116:"F5",117:"F6",118:"F7",119:"F8",120:"F9",121:"F10",122:"F11",123:"F12",144:"NumLock",145:"ScrollLock",224:"Meta"},En={Alt:"altKey",Control:"ctrlKey",Meta:"metaKey",Shift:"shiftKey"};function Sn(e){var t=this.nativeEvent;return t.getModifierState?t.getModifierState(e):!!(e=En[e])&&!!t[e]}function kn(){return Sn}var Tn=U({},dn,{key:function(e){if(e.key){var t=_n[e.key]||e.key;if("Unidentified"!==t)return t}return"keypress"===e.type?13===(e=tn(e))?"Enter":String.fromCharCode(e):"keydown"===e.type||"keyup"===e.type?xn[e.keyCode]||"Unidentified":""},code:0,location:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,repeat:0,locale:0,getModifierState:kn,charCode:function(e){return"keypress"===e.type?tn(e):0},keyCode:function(e){return"keydown"===e.type||"keyup"===e.type?e.keyCode:0},which:function(e){return"keypress"===e.type?tn(e):"keydown"===e.type||"keyup"===e.type?e.keyCode:0}}),In=an(Tn),Cn=an(U({},fn,{pointerId:0,width:0,height:0,pressure:0,tangentialPressure:0,tiltX:0,tiltY:0,twist:0,pointerType:0,isPrimary:0})),An=an(U({},dn,{touches:0,targetTouches:0,changedTouches:0,altKey:0,metaKey:0,ctrlKey:0,shiftKey:0,getModifierState:kn})),On=an(U({},ln,{propertyName:0,elapsedTime:0,pseudoElement:0})),Nn=U({},fn,{deltaX:function(e){return"deltaX"in e?e.deltaX:"wheelDeltaX"in e?-e.wheelDeltaX:0},deltaY:function(e){return"deltaY"in e?e.deltaY:"wheelDeltaY"in e?-e.wheelDeltaY:"wheelDelta"in e?-e.wheelDelta:0},deltaZ:0,deltaMode:0}),Rn=an(Nn),Pn=[9,13,27,32],Dn=u&&"CompositionEvent"in window,zn=null;u&&"documentMode"in document&&(zn=document.documentMode);var Mn=u&&"TextEvent"in window&&!zn,Ln=u&&(!Dn||zn&&8<zn&&11>=zn),Un=String.fromCharCode(32),Bn=!1;function Fn(e,t){switch(e){case"keyup":return-1!==Pn.indexOf(t.keyCode);case"keydown":return 229!==t.keyCode;case"keypress":case"mousedown":case"focusout":return!0;default:return!1}}function jn(e){return"object"===typeof(e=e.detail)&&"data"in e?e.data:null}var Vn=!1;var qn={color:!0,date:!0,datetime:!0,"datetime-local":!0,email:!0,month:!0,number:!0,password:!0,range:!0,search:!0,tel:!0,text:!0,time:!0,url:!0,week:!0};function Hn(e){var t=e&&e.nodeName&&e.nodeName.toLowerCase();return"input"===t?!!qn[e.type]:"textarea"===t}function Wn(e,t,n,r){Te(r),0<(t=Gr(t,"onChange")).length&&(n=new un("onChange","change",null,n,r),e.push({event:n,listeners:t}))}var Gn=null,Kn=null;function Qn(e){Ur(e,0)}function Xn(e){if(Q(bi(e)))return e}function Yn(e,t){if("change"===e)return t}var Jn=!1;if(u){var $n;if(u){var Zn="oninput"in document;if(!Zn){var er=document.createElement("div");er.setAttribute("oninput","return;"),Zn="function"===typeof er.oninput}$n=Zn}else $n=!1;Jn=$n&&(!document.documentMode||9<document.documentMode)}function tr(){Gn&&(Gn.detachEvent("onpropertychange",nr),Kn=Gn=null)}function nr(e){if("value"===e.propertyName&&Xn(Kn)){var t=[];Wn(t,Kn,e,_e(e)),Ne(Qn,t)}}function rr(e,t,n){"focusin"===e?(tr(),Kn=n,(Gn=t).attachEvent("onpropertychange",nr)):"focusout"===e&&tr()}function ir(e){if("selectionchange"===e||"keyup"===e||"keydown"===e)return Xn(Kn)}function ar(e,t){if("click"===e)return Xn(t)}function or(e,t){if("input"===e||"change"===e)return Xn(t)}var sr="function"===typeof Object.is?Object.is:function(e,t){return e===t&&(0!==e||1/e===1/t)||e!==e&&t!==t};function cr(e,t){if(sr(e,t))return!0;if("object"!==typeof e||null===e||"object"!==typeof t||null===t)return!1;var n=Object.keys(e),r=Object.keys(t);if(n.length!==r.length)return!1;for(r=0;r<n.length;r++){var i=n[r];if(!d.call(t,i)||!sr(e[i],t[i]))return!1}return!0}function lr(e){for(;e&&e.firstChild;)e=e.firstChild;return e}function ur(e,t){var n,r=lr(e);for(e=0;r;){if(3===r.nodeType){if(n=e+r.textContent.length,e<=t&&n>=t)return{node:r,offset:t-e};e=n}e:{for(;r;){if(r.nextSibling){r=r.nextSibling;break e}r=r.parentNode}r=void 0}r=lr(r)}}function dr(e,t){return!(!e||!t)&&(e===t||(!e||3!==e.nodeType)&&(t&&3===t.nodeType?dr(e,t.parentNode):"contains"in e?e.contains(t):!!e.compareDocumentPosition&&!!(16&e.compareDocumentPosition(t))))}function hr(){for(var e=window,t=X();t instanceof e.HTMLIFrameElement;){try{var n="string"===typeof t.contentWindow.location.href}catch(r){n=!1}if(!n)break;t=X((e=t.contentWindow).document)}return t}function fr(e){var t=e&&e.nodeName&&e.nodeName.toLowerCase();return t&&("input"===t&&("text"===e.type||"search"===e.type||"tel"===e.type||"url"===e.type||"password"===e.type)||"textarea"===t||"true"===e.contentEditable)}function pr(e){var t=hr(),n=e.focusedElem,r=e.selectionRange;if(t!==n&&n&&n.ownerDocument&&dr(n.ownerDocument.documentElement,n)){if(null!==r&&fr(n))if(t=r.start,void 0===(e=r.end)&&(e=t),"selectionStart"in n)n.selectionStart=t,n.selectionEnd=Math.min(e,n.value.length);else if((e=(t=n.ownerDocument||document)&&t.defaultView||window).getSelection){e=e.getSelection();var i=n.textContent.length,a=Math.min(r.start,i);r=void 0===r.end?a:Math.min(r.end,i),!e.extend&&a>r&&(i=r,r=a,a=i),i=ur(n,a);var o=ur(n,r);i&&o&&(1!==e.rangeCount||e.anchorNode!==i.node||e.anchorOffset!==i.offset||e.focusNode!==o.node||e.focusOffset!==o.offset)&&((t=t.createRange()).setStart(i.node,i.offset),e.removeAllRanges(),a>r?(e.addRange(t),e.extend(o.node,o.offset)):(t.setEnd(o.node,o.offset),e.addRange(t)))}for(t=[],e=n;e=e.parentNode;)1===e.nodeType&&t.push({element:e,left:e.scrollLeft,top:e.scrollTop});for("function"===typeof n.focus&&n.focus(),n=0;n<t.length;n++)(e=t[n]).element.scrollLeft=e.left,e.element.scrollTop=e.top}}var mr=u&&"documentMode"in document&&11>=document.documentMode,gr=null,yr=null,vr=null,wr=!1;function br(e,t,n){var r=n.window===n?n.document:9===n.nodeType?n:n.ownerDocument;wr||null==gr||gr!==X(r)||("selectionStart"in(r=gr)&&fr(r)?r={start:r.selectionStart,end:r.selectionEnd}:r={anchorNode:(r=(r.ownerDocument&&r.ownerDocument.defaultView||window).getSelection()).anchorNode,anchorOffset:r.anchorOffset,focusNode:r.focusNode,focusOffset:r.focusOffset},vr&&cr(vr,r)||(vr=r,0<(r=Gr(yr,"onSelect")).length&&(t=new un("onSelect","select",null,t,n),e.push({event:t,listeners:r}),t.target=gr)))}function _r(e,t){var n={};return n[e.toLowerCase()]=t.toLowerCase(),n["Webkit"+e]="webkit"+t,n["Moz"+e]="moz"+t,n}var xr={animationend:_r("Animation","AnimationEnd"),animationiteration:_r("Animation","AnimationIteration"),animationstart:_r("Animation","AnimationStart"),transitionend:_r("Transition","TransitionEnd")},Er={},Sr={};function kr(e){if(Er[e])return Er[e];if(!xr[e])return e;var t,n=xr[e];for(t in n)if(n.hasOwnProperty(t)&&t in Sr)return Er[e]=n[t];return e}u&&(Sr=document.createElement("div").style,"AnimationEvent"in window||(delete xr.animationend.animation,delete xr.animationiteration.animation,delete xr.animationstart.animation),"TransitionEvent"in window||delete xr.transitionend.transition);var Tr=kr("animationend"),Ir=kr("animationiteration"),Cr=kr("animationstart"),Ar=kr("transitionend"),Or=new Map,Nr="abort auxClick cancel canPlay canPlayThrough click close contextMenu copy cut drag dragEnd dragEnter dragExit dragLeave dragOver dragStart drop durationChange emptied encrypted ended error gotPointerCapture input invalid keyDown keyPress keyUp load loadedData loadedMetadata loadStart lostPointerCapture mouseDown mouseMove mouseOut mouseOver mouseUp paste pause play playing pointerCancel pointerDown pointerMove pointerOut pointerOver pointerUp progress rateChange reset resize seeked seeking stalled submit suspend timeUpdate touchCancel touchEnd touchStart volumeChange scroll toggle touchMove waiting wheel".split(" ");function Rr(e,t){Or.set(e,t),c(t,[e])}for(var Pr=0;Pr<Nr.length;Pr++){var Dr=Nr[Pr];Rr(Dr.toLowerCase(),"on"+(Dr[0].toUpperCase()+Dr.slice(1)))}Rr(Tr,"onAnimationEnd"),Rr(Ir,"onAnimationIteration"),Rr(Cr,"onAnimationStart"),Rr("dblclick","onDoubleClick"),Rr("focusin","onFocus"),Rr("focusout","onBlur"),Rr(Ar,"onTransitionEnd"),l("onMouseEnter",["mouseout","mouseover"]),l("onMouseLeave",["mouseout","mouseover"]),l("onPointerEnter",["pointerout","pointerover"]),l("onPointerLeave",["pointerout","pointerover"]),c("onChange","change click focusin focusout input keydown keyup selectionchange".split(" ")),c("onSelect","focusout contextmenu dragend focusin keydown keyup mousedown mouseup selectionchange".split(" ")),c("onBeforeInput",["compositionend","keypress","textInput","paste"]),c("onCompositionEnd","compositionend focusout keydown keypress keyup mousedown".split(" ")),c("onCompositionStart","compositionstart focusout keydown keypress keyup mousedown".split(" ")),c("onCompositionUpdate","compositionupdate focusout keydown keypress keyup mousedown".split(" "));var zr="abort canplay canplaythrough durationchange emptied encrypted ended error loadeddata loadedmetadata loadstart pause play playing progress ratechange resize seeked seeking stalled suspend timeupdate volumechange waiting".split(" "),Mr=new Set("cancel close invalid load scroll toggle".split(" ").concat(zr));function Lr(e,t,n){var r=e.type||"unknown-event";e.currentTarget=n,function(e,t,n,r,i,o,s,c,l){if(je.apply(this,arguments),Me){if(!Me)throw Error(a(198));var u=Le;Me=!1,Le=null,Ue||(Ue=!0,Be=u)}}(r,t,void 0,e),e.currentTarget=null}function Ur(e,t){t=0!==(4&t);for(var n=0;n<e.length;n++){var r=e[n],i=r.event;r=r.listeners;e:{var a=void 0;if(t)for(var o=r.length-1;0<=o;o--){var s=r[o],c=s.instance,l=s.currentTarget;if(s=s.listener,c!==a&&i.isPropagationStopped())break e;Lr(i,s,l),a=c}else for(o=0;o<r.length;o++){if(c=(s=r[o]).instance,l=s.currentTarget,s=s.listener,c!==a&&i.isPropagationStopped())break e;Lr(i,s,l),a=c}}}if(Ue)throw e=Be,Ue=!1,Be=null,e}function Br(e,t){var n=t[mi];void 0===n&&(n=t[mi]=new Set);var r=e+"__bubble";n.has(r)||(qr(t,e,2,!1),n.add(r))}function Fr(e,t,n){var r=0;t&&(r|=4),qr(n,e,r,t)}var jr="_reactListening"+Math.random().toString(36).slice(2);function Vr(e){if(!e[jr]){e[jr]=!0,o.forEach(function(t){"selectionchange"!==t&&(Mr.has(t)||Fr(t,!1,e),Fr(t,!0,e))});var t=9===e.nodeType?e:e.ownerDocument;null===t||t[jr]||(t[jr]=!0,Fr("selectionchange",!1,t))}}function qr(e,t,n,r){switch(Yt(t)){case 1:var i=Wt;break;case 4:i=Gt;break;default:i=Kt}n=i.bind(null,t,n,e),i=void 0,!Pe||"touchstart"!==t&&"touchmove"!==t&&"wheel"!==t||(i=!0),r?void 0!==i?e.addEventListener(t,n,{capture:!0,passive:i}):e.addEventListener(t,n,!0):void 0!==i?e.addEventListener(t,n,{passive:i}):e.addEventListener(t,n,!1)}function Hr(e,t,n,r,i){var a=r;if(0===(1&t)&&0===(2&t)&&null!==r)e:for(;;){if(null===r)return;var o=r.tag;if(3===o||4===o){var s=r.stateNode.containerInfo;if(s===i||8===s.nodeType&&s.parentNode===i)break;if(4===o)for(o=r.return;null!==o;){var c=o.tag;if((3===c||4===c)&&((c=o.stateNode.containerInfo)===i||8===c.nodeType&&c.parentNode===i))return;o=o.return}for(;null!==s;){if(null===(o=vi(s)))return;if(5===(c=o.tag)||6===c){r=a=o;continue e}s=s.parentNode}}r=r.return}Ne(function(){var r=a,i=_e(n),o=[];e:{var s=Or.get(e);if(void 0!==s){var c=un,l=e;switch(e){case"keypress":if(0===tn(n))break e;case"keydown":case"keyup":c=In;break;case"focusin":l="focus",c=gn;break;case"focusout":l="blur",c=gn;break;case"beforeblur":case"afterblur":c=gn;break;case"click":if(2===n.button)break e;case"auxclick":case"dblclick":case"mousedown":case"mousemove":case"mouseup":case"mouseout":case"mouseover":case"contextmenu":c=pn;break;case"drag":case"dragend":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"dragstart":case"drop":c=mn;break;case"touchcancel":case"touchend":case"touchmove":case"touchstart":c=An;break;case Tr:case Ir:case Cr:c=yn;break;case Ar:c=On;break;case"scroll":c=hn;break;case"wheel":c=Rn;break;case"copy":case"cut":case"paste":c=wn;break;case"gotpointercapture":case"lostpointercapture":case"pointercancel":case"pointerdown":case"pointermove":case"pointerout":case"pointerover":case"pointerup":c=Cn}var u=0!==(4&t),d=!u&&"scroll"===e,h=u?null!==s?s+"Capture":null:s;u=[];for(var f,p=r;null!==p;){var m=(f=p).stateNode;if(5===f.tag&&null!==m&&(f=m,null!==h&&(null!=(m=Re(p,h))&&u.push(Wr(p,m,f)))),d)break;p=p.return}0<u.length&&(s=new c(s,l,null,n,i),o.push({event:s,listeners:u}))}}if(0===(7&t)){if(c="mouseout"===e||"pointerout"===e,(!(s="mouseover"===e||"pointerover"===e)||n===be||!(l=n.relatedTarget||n.fromElement)||!vi(l)&&!l[pi])&&(c||s)&&(s=i.window===i?i:(s=i.ownerDocument)?s.defaultView||s.parentWindow:window,c?(c=r,null!==(l=(l=n.relatedTarget||n.toElement)?vi(l):null)&&(l!==(d=Ve(l))||5!==l.tag&&6!==l.tag)&&(l=null)):(c=null,l=r),c!==l)){if(u=pn,m="onMouseLeave",h="onMouseEnter",p="mouse","pointerout"!==e&&"pointerover"!==e||(u=Cn,m="onPointerLeave",h="onPointerEnter",p="pointer"),d=null==c?s:bi(c),f=null==l?s:bi(l),(s=new u(m,p+"leave",c,n,i)).target=d,s.relatedTarget=f,m=null,vi(i)===r&&((u=new u(h,p+"enter",l,n,i)).target=f,u.relatedTarget=d,m=u),d=m,c&&l)e:{for(h=l,p=0,f=u=c;f;f=Kr(f))p++;for(f=0,m=h;m;m=Kr(m))f++;for(;0<p-f;)u=Kr(u),p--;for(;0<f-p;)h=Kr(h),f--;for(;p--;){if(u===h||null!==h&&u===h.alternate)break e;u=Kr(u),h=Kr(h)}u=null}else u=null;null!==c&&Qr(o,s,c,u,!1),null!==l&&null!==d&&Qr(o,d,l,u,!0)}if("select"===(c=(s=r?bi(r):window).nodeName&&s.nodeName.toLowerCase())||"input"===c&&"file"===s.type)var g=Yn;else if(Hn(s))if(Jn)g=or;else{g=ir;var y=rr}else(c=s.nodeName)&&"input"===c.toLowerCase()&&("checkbox"===s.type||"radio"===s.type)&&(g=ar);switch(g&&(g=g(e,r))?Wn(o,g,n,i):(y&&y(e,s,r),"focusout"===e&&(y=s._wrapperState)&&y.controlled&&"number"===s.type&&te(s,"number",s.value)),y=r?bi(r):window,e){case"focusin":(Hn(y)||"true"===y.contentEditable)&&(gr=y,yr=r,vr=null);break;case"focusout":vr=yr=gr=null;break;case"mousedown":wr=!0;break;case"contextmenu":case"mouseup":case"dragend":wr=!1,br(o,n,i);break;case"selectionchange":if(mr)break;case"keydown":case"keyup":br(o,n,i)}var v;if(Dn)e:{switch(e){case"compositionstart":var w="onCompositionStart";break e;case"compositionend":w="onCompositionEnd";break e;case"compositionupdate":w="onCompositionUpdate";break e}w=void 0}else Vn?Fn(e,n)&&(w="onCompositionEnd"):"keydown"===e&&229===n.keyCode&&(w="onCompositionStart");w&&(Ln&&"ko"!==n.locale&&(Vn||"onCompositionStart"!==w?"onCompositionEnd"===w&&Vn&&(v=en()):($t="value"in(Jt=i)?Jt.value:Jt.textContent,Vn=!0)),0<(y=Gr(r,w)).length&&(w=new bn(w,e,null,n,i),o.push({event:w,listeners:y}),v?w.data=v:null!==(v=jn(n))&&(w.data=v))),(v=Mn?function(e,t){switch(e){case"compositionend":return jn(t);case"keypress":return 32!==t.which?null:(Bn=!0,Un);case"textInput":return(e=t.data)===Un&&Bn?null:e;default:return null}}(e,n):function(e,t){if(Vn)return"compositionend"===e||!Dn&&Fn(e,t)?(e=en(),Zt=$t=Jt=null,Vn=!1,e):null;switch(e){case"paste":default:return null;case"keypress":if(!(t.ctrlKey||t.altKey||t.metaKey)||t.ctrlKey&&t.altKey){if(t.char&&1<t.char.length)return t.char;if(t.which)return String.fromCharCode(t.which)}return null;case"compositionend":return Ln&&"ko"!==t.locale?null:t.data}}(e,n))&&(0<(r=Gr(r,"onBeforeInput")).length&&(i=new bn("onBeforeInput","beforeinput",null,n,i),o.push({event:i,listeners:r}),i.data=v))}Ur(o,t)})}function Wr(e,t,n){return{instance:e,listener:t,currentTarget:n}}function Gr(e,t){for(var n=t+"Capture",r=[];null!==e;){var i=e,a=i.stateNode;5===i.tag&&null!==a&&(i=a,null!=(a=Re(e,n))&&r.unshift(Wr(e,a,i)),null!=(a=Re(e,t))&&r.push(Wr(e,a,i))),e=e.return}return r}function Kr(e){if(null===e)return null;do{e=e.return}while(e&&5!==e.tag);return e||null}function Qr(e,t,n,r,i){for(var a=t._reactName,o=[];null!==n&&n!==r;){var s=n,c=s.alternate,l=s.stateNode;if(null!==c&&c===r)break;5===s.tag&&null!==l&&(s=l,i?null!=(c=Re(n,a))&&o.unshift(Wr(n,c,s)):i||null!=(c=Re(n,a))&&o.push(Wr(n,c,s))),n=n.return}0!==o.length&&e.push({event:t,listeners:o})}var Xr=/\r\n?/g,Yr=/\u0000|\uFFFD/g;function Jr(e){return("string"===typeof e?e:""+e).replace(Xr,"\n").replace(Yr,"")}function $r(e,t,n){if(t=Jr(t),Jr(e)!==t&&n)throw Error(a(425))}function Zr(){}var ei=null,ti=null;function ni(e,t){return"textarea"===e||"noscript"===e||"string"===typeof t.children||"number"===typeof t.children||"object"===typeof t.dangerouslySetInnerHTML&&null!==t.dangerouslySetInnerHTML&&null!=t.dangerouslySetInnerHTML.__html}var ri="function"===typeof setTimeout?setTimeout:void 0,ii="function"===typeof clearTimeout?clearTimeout:void 0,ai="function"===typeof Promise?Promise:void 0,oi="function"===typeof queueMicrotask?queueMicrotask:"undefined"!==typeof ai?function(e){return ai.resolve(null).then(e).catch(si)}:ri;function si(e){setTimeout(function(){throw e})}function ci(e,t){var n=t,r=0;do{var i=n.nextSibling;if(e.removeChild(n),i&&8===i.nodeType)if("/$"===(n=i.data)){if(0===r)return e.removeChild(i),void Vt(t);r--}else"$"!==n&&"$?"!==n&&"$!"!==n||r++;n=i}while(n);Vt(t)}function li(e){for(;null!=e;e=e.nextSibling){var t=e.nodeType;if(1===t||3===t)break;if(8===t){if("$"===(t=e.data)||"$!"===t||"$?"===t)break;if("/$"===t)return null}}return e}function ui(e){e=e.previousSibling;for(var t=0;e;){if(8===e.nodeType){var n=e.data;if("$"===n||"$!"===n||"$?"===n){if(0===t)return e;t--}else"/$"===n&&t++}e=e.previousSibling}return null}var di=Math.random().toString(36).slice(2),hi="__reactFiber$"+di,fi="__reactProps$"+di,pi="__reactContainer$"+di,mi="__reactEvents$"+di,gi="__reactListeners$"+di,yi="__reactHandles$"+di;function vi(e){var t=e[hi];if(t)return t;for(var n=e.parentNode;n;){if(t=n[pi]||n[hi]){if(n=t.alternate,null!==t.child||null!==n&&null!==n.child)for(e=ui(e);null!==e;){if(n=e[hi])return n;e=ui(e)}return t}n=(e=n).parentNode}return null}function wi(e){return!(e=e[hi]||e[pi])||5!==e.tag&&6!==e.tag&&13!==e.tag&&3!==e.tag?null:e}function bi(e){if(5===e.tag||6===e.tag)return e.stateNode;throw Error(a(33))}function _i(e){return e[fi]||null}var xi=[],Ei=-1;function Si(e){return{current:e}}function ki(e){0>Ei||(e.current=xi[Ei],xi[Ei]=null,Ei--)}function Ti(e,t){Ei++,xi[Ei]=e.current,e.current=t}var Ii={},Ci=Si(Ii),Ai=Si(!1),Oi=Ii;function Ni(e,t){var n=e.type.contextTypes;if(!n)return Ii;var r=e.stateNode;if(r&&r.__reactInternalMemoizedUnmaskedChildContext===t)return r.__reactInternalMemoizedMaskedChildContext;var i,a={};for(i in n)a[i]=t[i];return r&&((e=e.stateNode).__reactInternalMemoizedUnmaskedChildContext=t,e.__reactInternalMemoizedMaskedChildContext=a),a}function Ri(e){return null!==(e=e.childContextTypes)&&void 0!==e}function Pi(){ki(Ai),ki(Ci)}function Di(e,t,n){if(Ci.current!==Ii)throw Error(a(168));Ti(Ci,t),Ti(Ai,n)}function zi(e,t,n){var r=e.stateNode;if(t=t.childContextTypes,"function"!==typeof r.getChildContext)return n;for(var i in r=r.getChildContext())if(!(i in t))throw Error(a(108,H(e)||"Unknown",i));return U({},n,r)}function Mi(e){return e=(e=e.stateNode)&&e.__reactInternalMemoizedMergedChildContext||Ii,Oi=Ci.current,Ti(Ci,e),Ti(Ai,Ai.current),!0}function Li(e,t,n){var r=e.stateNode;if(!r)throw Error(a(169));n?(e=zi(e,t,Oi),r.__reactInternalMemoizedMergedChildContext=e,ki(Ai),ki(Ci),Ti(Ci,e)):ki(Ai),Ti(Ai,n)}var Ui=null,Bi=!1,Fi=!1;function ji(e){null===Ui?Ui=[e]:Ui.push(e)}function Vi(){if(!Fi&&null!==Ui){Fi=!0;var e=0,t=wt;try{var n=Ui;for(wt=1;e<n.length;e++){var r=n[e];do{r=r(!0)}while(null!==r)}Ui=null,Bi=!1}catch(S_){throw null!==Ui&&(Ui=Ui.slice(e+1)),Ke(Ze,Vi),S_}finally{wt=t,Fi=!1}}return null}var qi=[],Hi=0,Wi=null,Gi=0,Ki=[],Qi=0,Xi=null,Yi=1,Ji="";function $i(e,t){qi[Hi++]=Gi,qi[Hi++]=Wi,Wi=e,Gi=t}function Zi(e,t,n){Ki[Qi++]=Yi,Ki[Qi++]=Ji,Ki[Qi++]=Xi,Xi=e;var r=Yi;e=Ji;var i=32-ot(r)-1;r&=~(1<<i),n+=1;var a=32-ot(t)+i;if(30<a){var o=i-i%5;a=(r&(1<<o)-1).toString(32),r>>=o,i-=o,Yi=1<<32-ot(t)+i|n<<i|r,Ji=a+e}else Yi=1<<a|n<<i|r,Ji=e}function ea(e){null!==e.return&&($i(e,1),Zi(e,1,0))}function ta(e){for(;e===Wi;)Wi=qi[--Hi],qi[Hi]=null,Gi=qi[--Hi],qi[Hi]=null;for(;e===Xi;)Xi=Ki[--Qi],Ki[Qi]=null,Ji=Ki[--Qi],Ki[Qi]=null,Yi=Ki[--Qi],Ki[Qi]=null}var na=null,ra=null,ia=!1,aa=null;function oa(e,t){var n=Nl(5,null,null,0);n.elementType="DELETED",n.stateNode=t,n.return=e,null===(t=e.deletions)?(e.deletions=[n],e.flags|=16):t.push(n)}function sa(e,t){switch(e.tag){case 5:var n=e.type;return null!==(t=1!==t.nodeType||n.toLowerCase()!==t.nodeName.toLowerCase()?null:t)&&(e.stateNode=t,na=e,ra=li(t.firstChild),!0);case 6:return null!==(t=""===e.pendingProps||3!==t.nodeType?null:t)&&(e.stateNode=t,na=e,ra=null,!0);case 13:return null!==(t=8!==t.nodeType?null:t)&&(n=null!==Xi?{id:Yi,overflow:Ji}:null,e.memoizedState={dehydrated:t,treeContext:n,retryLane:1073741824},(n=Nl(18,null,null,0)).stateNode=t,n.return=e,e.child=n,na=e,ra=null,!0);default:return!1}}function ca(e){return 0!==(1&e.mode)&&0===(128&e.flags)}function la(e){if(ia){var t=ra;if(t){var n=t;if(!sa(e,t)){if(ca(e))throw Error(a(418));t=li(n.nextSibling);var r=na;t&&sa(e,t)?oa(r,n):(e.flags=-4097&e.flags|2,ia=!1,na=e)}}else{if(ca(e))throw Error(a(418));e.flags=-4097&e.flags|2,ia=!1,na=e}}}function ua(e){for(e=e.return;null!==e&&5!==e.tag&&3!==e.tag&&13!==e.tag;)e=e.return;na=e}function da(e){if(e!==na)return!1;if(!ia)return ua(e),ia=!0,!1;var t;if((t=3!==e.tag)&&!(t=5!==e.tag)&&(t="head"!==(t=e.type)&&"body"!==t&&!ni(e.type,e.memoizedProps)),t&&(t=ra)){if(ca(e))throw ha(),Error(a(418));for(;t;)oa(e,t),t=li(t.nextSibling)}if(ua(e),13===e.tag){if(!(e=null!==(e=e.memoizedState)?e.dehydrated:null))throw Error(a(317));e:{for(e=e.nextSibling,t=0;e;){if(8===e.nodeType){var n=e.data;if("/$"===n){if(0===t){ra=li(e.nextSibling);break e}t--}else"$"!==n&&"$!"!==n&&"$?"!==n||t++}e=e.nextSibling}ra=null}}else ra=na?li(e.stateNode.nextSibling):null;return!0}function ha(){for(var e=ra;e;)e=li(e.nextSibling)}function fa(){ra=na=null,ia=!1}function pa(e){null===aa?aa=[e]:aa.push(e)}var ma=b.ReactCurrentBatchConfig;function ga(e,t,n){if(null!==(e=n.ref)&&"function"!==typeof e&&"object"!==typeof e){if(n._owner){if(n=n._owner){if(1!==n.tag)throw Error(a(309));var r=n.stateNode}if(!r)throw Error(a(147,e));var i=r,o=""+e;return null!==t&&null!==t.ref&&"function"===typeof t.ref&&t.ref._stringRef===o?t.ref:(t=function(e){var t=i.refs;null===e?delete t[o]:t[o]=e},t._stringRef=o,t)}if("string"!==typeof e)throw Error(a(284));if(!n._owner)throw Error(a(290,e))}return e}function ya(e,t){throw e=Object.prototype.toString.call(t),Error(a(31,"[object Object]"===e?"object with keys {"+Object.keys(t).join(", ")+"}":e))}function va(e){return(0,e._init)(e._payload)}function wa(e){function t(t,n){if(e){var r=t.deletions;null===r?(t.deletions=[n],t.flags|=16):r.push(n)}}function n(n,r){if(!e)return null;for(;null!==r;)t(n,r),r=r.sibling;return null}function r(e,t){for(e=new Map;null!==t;)null!==t.key?e.set(t.key,t):e.set(t.index,t),t=t.sibling;return e}function i(e,t){return(e=Pl(e,t)).index=0,e.sibling=null,e}function o(t,n,r){return t.index=r,e?null!==(r=t.alternate)?(r=r.index)<n?(t.flags|=2,n):r:(t.flags|=2,n):(t.flags|=1048576,n)}function s(t){return e&&null===t.alternate&&(t.flags|=2),t}function c(e,t,n,r){return null===t||6!==t.tag?((t=Ll(n,e.mode,r)).return=e,t):((t=i(t,n)).return=e,t)}function l(e,t,n,r){var a=n.type;return a===E?d(e,t,n.props.children,r,n.key):null!==t&&(t.elementType===a||"object"===typeof a&&null!==a&&a.$$typeof===P&&va(a)===t.type)?((r=i(t,n.props)).ref=ga(e,t,n),r.return=e,r):((r=Dl(n.type,n.key,n.props,null,e.mode,r)).ref=ga(e,t,n),r.return=e,r)}function u(e,t,n,r){return null===t||4!==t.tag||t.stateNode.containerInfo!==n.containerInfo||t.stateNode.implementation!==n.implementation?((t=Ul(n,e.mode,r)).return=e,t):((t=i(t,n.children||[])).return=e,t)}function d(e,t,n,r,a){return null===t||7!==t.tag?((t=zl(n,e.mode,r,a)).return=e,t):((t=i(t,n)).return=e,t)}function h(e,t,n){if("string"===typeof t&&""!==t||"number"===typeof t)return(t=Ll(""+t,e.mode,n)).return=e,t;if("object"===typeof t&&null!==t){switch(t.$$typeof){case _:return(n=Dl(t.type,t.key,t.props,null,e.mode,n)).ref=ga(e,null,t),n.return=e,n;case x:return(t=Ul(t,e.mode,n)).return=e,t;case P:return h(e,(0,t._init)(t._payload),n)}if(ne(t)||M(t))return(t=zl(t,e.mode,n,null)).return=e,t;ya(e,t)}return null}function f(e,t,n,r){var i=null!==t?t.key:null;if("string"===typeof n&&""!==n||"number"===typeof n)return null!==i?null:c(e,t,""+n,r);if("object"===typeof n&&null!==n){switch(n.$$typeof){case _:return n.key===i?l(e,t,n,r):null;case x:return n.key===i?u(e,t,n,r):null;case P:return f(e,t,(i=n._init)(n._payload),r)}if(ne(n)||M(n))return null!==i?null:d(e,t,n,r,null);ya(e,n)}return null}function p(e,t,n,r,i){if("string"===typeof r&&""!==r||"number"===typeof r)return c(t,e=e.get(n)||null,""+r,i);if("object"===typeof r&&null!==r){switch(r.$$typeof){case _:return l(t,e=e.get(null===r.key?n:r.key)||null,r,i);case x:return u(t,e=e.get(null===r.key?n:r.key)||null,r,i);case P:return p(e,t,n,(0,r._init)(r._payload),i)}if(ne(r)||M(r))return d(t,e=e.get(n)||null,r,i,null);ya(t,r)}return null}function m(i,a,s,c){for(var l=null,u=null,d=a,m=a=0,g=null;null!==d&&m<s.length;m++){d.index>m?(g=d,d=null):g=d.sibling;var y=f(i,d,s[m],c);if(null===y){null===d&&(d=g);break}e&&d&&null===y.alternate&&t(i,d),a=o(y,a,m),null===u?l=y:u.sibling=y,u=y,d=g}if(m===s.length)return n(i,d),ia&&$i(i,m),l;if(null===d){for(;m<s.length;m++)null!==(d=h(i,s[m],c))&&(a=o(d,a,m),null===u?l=d:u.sibling=d,u=d);return ia&&$i(i,m),l}for(d=r(i,d);m<s.length;m++)null!==(g=p(d,i,m,s[m],c))&&(e&&null!==g.alternate&&d.delete(null===g.key?m:g.key),a=o(g,a,m),null===u?l=g:u.sibling=g,u=g);return e&&d.forEach(function(e){return t(i,e)}),ia&&$i(i,m),l}function g(i,s,c,l){var u=M(c);if("function"!==typeof u)throw Error(a(150));if(null==(c=u.call(c)))throw Error(a(151));for(var d=u=null,m=s,g=s=0,y=null,v=c.next();null!==m&&!v.done;g++,v=c.next()){m.index>g?(y=m,m=null):y=m.sibling;var w=f(i,m,v.value,l);if(null===w){null===m&&(m=y);break}e&&m&&null===w.alternate&&t(i,m),s=o(w,s,g),null===d?u=w:d.sibling=w,d=w,m=y}if(v.done)return n(i,m),ia&&$i(i,g),u;if(null===m){for(;!v.done;g++,v=c.next())null!==(v=h(i,v.value,l))&&(s=o(v,s,g),null===d?u=v:d.sibling=v,d=v);return ia&&$i(i,g),u}for(m=r(i,m);!v.done;g++,v=c.next())null!==(v=p(m,i,g,v.value,l))&&(e&&null!==v.alternate&&m.delete(null===v.key?g:v.key),s=o(v,s,g),null===d?u=v:d.sibling=v,d=v);return e&&m.forEach(function(e){return t(i,e)}),ia&&$i(i,g),u}return function e(r,a,o,c){if("object"===typeof o&&null!==o&&o.type===E&&null===o.key&&(o=o.props.children),"object"===typeof o&&null!==o){switch(o.$$typeof){case _:e:{for(var l=o.key,u=a;null!==u;){if(u.key===l){if((l=o.type)===E){if(7===u.tag){n(r,u.sibling),(a=i(u,o.props.children)).return=r,r=a;break e}}else if(u.elementType===l||"object"===typeof l&&null!==l&&l.$$typeof===P&&va(l)===u.type){n(r,u.sibling),(a=i(u,o.props)).ref=ga(r,u,o),a.return=r,r=a;break e}n(r,u);break}t(r,u),u=u.sibling}o.type===E?((a=zl(o.props.children,r.mode,c,o.key)).return=r,r=a):((c=Dl(o.type,o.key,o.props,null,r.mode,c)).ref=ga(r,a,o),c.return=r,r=c)}return s(r);case x:e:{for(u=o.key;null!==a;){if(a.key===u){if(4===a.tag&&a.stateNode.containerInfo===o.containerInfo&&a.stateNode.implementation===o.implementation){n(r,a.sibling),(a=i(a,o.children||[])).return=r,r=a;break e}n(r,a);break}t(r,a),a=a.sibling}(a=Ul(o,r.mode,c)).return=r,r=a}return s(r);case P:return e(r,a,(u=o._init)(o._payload),c)}if(ne(o))return m(r,a,o,c);if(M(o))return g(r,a,o,c);ya(r,o)}return"string"===typeof o&&""!==o||"number"===typeof o?(o=""+o,null!==a&&6===a.tag?(n(r,a.sibling),(a=i(a,o)).return=r,r=a):(n(r,a),(a=Ll(o,r.mode,c)).return=r,r=a),s(r)):n(r,a)}}var ba=wa(!0),_a=wa(!1),xa=Si(null),Ea=null,Sa=null,ka=null;function Ta(){ka=Sa=Ea=null}function Ia(e){var t=xa.current;ki(xa),e._currentValue=t}function Ca(e,t,n){for(;null!==e;){var r=e.alternate;if((e.childLanes&t)!==t?(e.childLanes|=t,null!==r&&(r.childLanes|=t)):null!==r&&(r.childLanes&t)!==t&&(r.childLanes|=t),e===n)break;e=e.return}}function Aa(e,t){Ea=e,ka=Sa=null,null!==(e=e.dependencies)&&null!==e.firstContext&&(0!==(e.lanes&t)&&(ws=!0),e.firstContext=null)}function Oa(e){var t=e._currentValue;if(ka!==e)if(e={context:e,memoizedValue:t,next:null},null===Sa){if(null===Ea)throw Error(a(308));Sa=e,Ea.dependencies={lanes:0,firstContext:e}}else Sa=Sa.next=e;return t}var Na=null;function Ra(e){null===Na?Na=[e]:Na.push(e)}function Pa(e,t,n,r){var i=t.interleaved;return null===i?(n.next=n,Ra(t)):(n.next=i.next,i.next=n),t.interleaved=n,Da(e,r)}function Da(e,t){e.lanes|=t;var n=e.alternate;for(null!==n&&(n.lanes|=t),n=e,e=e.return;null!==e;)e.childLanes|=t,null!==(n=e.alternate)&&(n.childLanes|=t),n=e,e=e.return;return 3===n.tag?n.stateNode:null}var za=!1;function Ma(e){e.updateQueue={baseState:e.memoizedState,firstBaseUpdate:null,lastBaseUpdate:null,shared:{pending:null,interleaved:null,lanes:0},effects:null}}function La(e,t){e=e.updateQueue,t.updateQueue===e&&(t.updateQueue={baseState:e.baseState,firstBaseUpdate:e.firstBaseUpdate,lastBaseUpdate:e.lastBaseUpdate,shared:e.shared,effects:e.effects})}function Ua(e,t){return{eventTime:e,lane:t,tag:0,payload:null,callback:null,next:null}}function Ba(e,t,n){var r=e.updateQueue;if(null===r)return null;if(r=r.shared,0!==(2&Cc)){var i=r.pending;return null===i?t.next=t:(t.next=i.next,i.next=t),r.pending=t,Da(e,n)}return null===(i=r.interleaved)?(t.next=t,Ra(r)):(t.next=i.next,i.next=t),r.interleaved=t,Da(e,n)}function Fa(e,t,n){if(null!==(t=t.updateQueue)&&(t=t.shared,0!==(4194240&n))){var r=t.lanes;n|=r&=e.pendingLanes,t.lanes=n,vt(e,n)}}function ja(e,t){var n=e.updateQueue,r=e.alternate;if(null!==r&&n===(r=r.updateQueue)){var i=null,a=null;if(null!==(n=n.firstBaseUpdate)){do{var o={eventTime:n.eventTime,lane:n.lane,tag:n.tag,payload:n.payload,callback:n.callback,next:null};null===a?i=a=o:a=a.next=o,n=n.next}while(null!==n);null===a?i=a=t:a=a.next=t}else i=a=t;return n={baseState:r.baseState,firstBaseUpdate:i,lastBaseUpdate:a,shared:r.shared,effects:r.effects},void(e.updateQueue=n)}null===(e=n.lastBaseUpdate)?n.firstBaseUpdate=t:e.next=t,n.lastBaseUpdate=t}function Va(e,t,n,r){var i=e.updateQueue;za=!1;var a=i.firstBaseUpdate,o=i.lastBaseUpdate,s=i.shared.pending;if(null!==s){i.shared.pending=null;var c=s,l=c.next;c.next=null,null===o?a=l:o.next=l,o=c;var u=e.alternate;null!==u&&((s=(u=u.updateQueue).lastBaseUpdate)!==o&&(null===s?u.firstBaseUpdate=l:s.next=l,u.lastBaseUpdate=c))}if(null!==a){var d=i.baseState;for(o=0,u=l=c=null,s=a;;){var h=s.lane,f=s.eventTime;if((r&h)===h){null!==u&&(u=u.next={eventTime:f,lane:0,tag:s.tag,payload:s.payload,callback:s.callback,next:null});e:{var p=e,m=s;switch(h=t,f=n,m.tag){case 1:if("function"===typeof(p=m.payload)){d=p.call(f,d,h);break e}d=p;break e;case 3:p.flags=-65537&p.flags|128;case 0:if(null===(h="function"===typeof(p=m.payload)?p.call(f,d,h):p)||void 0===h)break e;d=U({},d,h);break e;case 2:za=!0}}null!==s.callback&&0!==s.lane&&(e.flags|=64,null===(h=i.effects)?i.effects=[s]:h.push(s))}else f={eventTime:f,lane:h,tag:s.tag,payload:s.payload,callback:s.callback,next:null},null===u?(l=u=f,c=d):u=u.next=f,o|=h;if(null===(s=s.next)){if(null===(s=i.shared.pending))break;s=(h=s).next,h.next=null,i.lastBaseUpdate=h,i.shared.pending=null}}if(null===u&&(c=d),i.baseState=c,i.firstBaseUpdate=l,i.lastBaseUpdate=u,null!==(t=i.shared.interleaved)){i=t;do{o|=i.lane,i=i.next}while(i!==t)}else null===a&&(i.shared.lanes=0);Mc|=o,e.lanes=o,e.memoizedState=d}}function qa(e,t,n){if(e=t.effects,t.effects=null,null!==e)for(t=0;t<e.length;t++){var r=e[t],i=r.callback;if(null!==i){if(r.callback=null,r=n,"function"!==typeof i)throw Error(a(191,i));i.call(r)}}}var Ha={},Wa=Si(Ha),Ga=Si(Ha),Ka=Si(Ha);function Qa(e){if(e===Ha)throw Error(a(174));return e}function Xa(e,t){switch(Ti(Ka,t),Ti(Ga,e),Ti(Wa,Ha),e=t.nodeType){case 9:case 11:t=(t=t.documentElement)?t.namespaceURI:le(null,"");break;default:t=le(t=(e=8===e?t.parentNode:t).namespaceURI||null,e=e.tagName)}ki(Wa),Ti(Wa,t)}function Ya(){ki(Wa),ki(Ga),ki(Ka)}function Ja(e){Qa(Ka.current);var t=Qa(Wa.current),n=le(t,e.type);t!==n&&(Ti(Ga,e),Ti(Wa,n))}function $a(e){Ga.current===e&&(ki(Wa),ki(Ga))}var Za=Si(0);function eo(e){for(var t=e;null!==t;){if(13===t.tag){var n=t.memoizedState;if(null!==n&&(null===(n=n.dehydrated)||"$?"===n.data||"$!"===n.data))return t}else if(19===t.tag&&void 0!==t.memoizedProps.revealOrder){if(0!==(128&t.flags))return t}else if(null!==t.child){t.child.return=t,t=t.child;continue}if(t===e)break;for(;null===t.sibling;){if(null===t.return||t.return===e)return null;t=t.return}t.sibling.return=t.return,t=t.sibling}return null}var to=[];function no(){for(var e=0;e<to.length;e++)to[e]._workInProgressVersionPrimary=null;to.length=0}var ro=b.ReactCurrentDispatcher,io=b.ReactCurrentBatchConfig,ao=0,oo=null,so=null,co=null,lo=!1,uo=!1,ho=0,fo=0;function po(){throw Error(a(321))}function mo(e,t){if(null===t)return!1;for(var n=0;n<t.length&&n<e.length;n++)if(!sr(e[n],t[n]))return!1;return!0}function go(e,t,n,r,i,o){if(ao=o,oo=t,t.memoizedState=null,t.updateQueue=null,t.lanes=0,ro.current=null===e||null===e.memoizedState?Zo:es,e=n(r,i),uo){o=0;do{if(uo=!1,ho=0,25<=o)throw Error(a(301));o+=1,co=so=null,t.updateQueue=null,ro.current=ts,e=n(r,i)}while(uo)}if(ro.current=$o,t=null!==so&&null!==so.next,ao=0,co=so=oo=null,lo=!1,t)throw Error(a(300));return e}function yo(){var e=0!==ho;return ho=0,e}function vo(){var e={memoizedState:null,baseState:null,baseQueue:null,queue:null,next:null};return null===co?oo.memoizedState=co=e:co=co.next=e,co}function wo(){if(null===so){var e=oo.alternate;e=null!==e?e.memoizedState:null}else e=so.next;var t=null===co?oo.memoizedState:co.next;if(null!==t)co=t,so=e;else{if(null===e)throw Error(a(310));e={memoizedState:(so=e).memoizedState,baseState:so.baseState,baseQueue:so.baseQueue,queue:so.queue,next:null},null===co?oo.memoizedState=co=e:co=co.next=e}return co}function bo(e,t){return"function"===typeof t?t(e):t}function _o(e){var t=wo(),n=t.queue;if(null===n)throw Error(a(311));n.lastRenderedReducer=e;var r=so,i=r.baseQueue,o=n.pending;if(null!==o){if(null!==i){var s=i.next;i.next=o.next,o.next=s}r.baseQueue=i=o,n.pending=null}if(null!==i){o=i.next,r=r.baseState;var c=s=null,l=null,u=o;do{var d=u.lane;if((ao&d)===d)null!==l&&(l=l.next={lane:0,action:u.action,hasEagerState:u.hasEagerState,eagerState:u.eagerState,next:null}),r=u.hasEagerState?u.eagerState:e(r,u.action);else{var h={lane:d,action:u.action,hasEagerState:u.hasEagerState,eagerState:u.eagerState,next:null};null===l?(c=l=h,s=r):l=l.next=h,oo.lanes|=d,Mc|=d}u=u.next}while(null!==u&&u!==o);null===l?s=r:l.next=c,sr(r,t.memoizedState)||(ws=!0),t.memoizedState=r,t.baseState=s,t.baseQueue=l,n.lastRenderedState=r}if(null!==(e=n.interleaved)){i=e;do{o=i.lane,oo.lanes|=o,Mc|=o,i=i.next}while(i!==e)}else null===i&&(n.lanes=0);return[t.memoizedState,n.dispatch]}function xo(e){var t=wo(),n=t.queue;if(null===n)throw Error(a(311));n.lastRenderedReducer=e;var r=n.dispatch,i=n.pending,o=t.memoizedState;if(null!==i){n.pending=null;var s=i=i.next;do{o=e(o,s.action),s=s.next}while(s!==i);sr(o,t.memoizedState)||(ws=!0),t.memoizedState=o,null===t.baseQueue&&(t.baseState=o),n.lastRenderedState=o}return[o,r]}function Eo(){}function So(e,t){var n=oo,r=wo(),i=t(),o=!sr(r.memoizedState,i);if(o&&(r.memoizedState=i,ws=!0),r=r.queue,Mo(Io.bind(null,n,r,e),[e]),r.getSnapshot!==t||o||null!==co&&1&co.memoizedState.tag){if(n.flags|=2048,No(9,To.bind(null,n,r,i,t),void 0,null),null===Ac)throw Error(a(349));0!==(30&ao)||ko(n,t,i)}return i}function ko(e,t,n){e.flags|=16384,e={getSnapshot:t,value:n},null===(t=oo.updateQueue)?(t={lastEffect:null,stores:null},oo.updateQueue=t,t.stores=[e]):null===(n=t.stores)?t.stores=[e]:n.push(e)}function To(e,t,n,r){t.value=n,t.getSnapshot=r,Co(t)&&Ao(e)}function Io(e,t,n){return n(function(){Co(t)&&Ao(e)})}function Co(e){var t=e.getSnapshot;e=e.value;try{var n=t();return!sr(e,n)}catch(r){return!0}}function Ao(e){var t=Da(e,1);null!==t&&nl(t,e,1,-1)}function Oo(e){var t=vo();return"function"===typeof e&&(e=e()),t.memoizedState=t.baseState=e,e={pending:null,interleaved:null,lanes:0,dispatch:null,lastRenderedReducer:bo,lastRenderedState:e},t.queue=e,e=e.dispatch=Qo.bind(null,oo,e),[t.memoizedState,e]}function No(e,t,n,r){return e={tag:e,create:t,destroy:n,deps:r,next:null},null===(t=oo.updateQueue)?(t={lastEffect:null,stores:null},oo.updateQueue=t,t.lastEffect=e.next=e):null===(n=t.lastEffect)?t.lastEffect=e.next=e:(r=n.next,n.next=e,e.next=r,t.lastEffect=e),e}function Ro(){return wo().memoizedState}function Po(e,t,n,r){var i=vo();oo.flags|=e,i.memoizedState=No(1|t,n,void 0,void 0===r?null:r)}function Do(e,t,n,r){var i=wo();r=void 0===r?null:r;var a=void 0;if(null!==so){var o=so.memoizedState;if(a=o.destroy,null!==r&&mo(r,o.deps))return void(i.memoizedState=No(t,n,a,r))}oo.flags|=e,i.memoizedState=No(1|t,n,a,r)}function zo(e,t){return Po(8390656,8,e,t)}function Mo(e,t){return Do(2048,8,e,t)}function Lo(e,t){return Do(4,2,e,t)}function Uo(e,t){return Do(4,4,e,t)}function Bo(e,t){return"function"===typeof t?(e=e(),t(e),function(){t(null)}):null!==t&&void 0!==t?(e=e(),t.current=e,function(){t.current=null}):void 0}function Fo(e,t,n){return n=null!==n&&void 0!==n?n.concat([e]):null,Do(4,4,Bo.bind(null,t,e),n)}function jo(){}function Vo(e,t){var n=wo();t=void 0===t?null:t;var r=n.memoizedState;return null!==r&&null!==t&&mo(t,r[1])?r[0]:(n.memoizedState=[e,t],e)}function qo(e,t){var n=wo();t=void 0===t?null:t;var r=n.memoizedState;return null!==r&&null!==t&&mo(t,r[1])?r[0]:(e=e(),n.memoizedState=[e,t],e)}function Ho(e,t,n){return 0===(21&ao)?(e.baseState&&(e.baseState=!1,ws=!0),e.memoizedState=n):(sr(n,t)||(n=mt(),oo.lanes|=n,Mc|=n,e.baseState=!0),t)}function Wo(e,t){var n=wt;wt=0!==n&&4>n?n:4,e(!0);var r=io.transition;io.transition={};try{e(!1),t()}finally{wt=n,io.transition=r}}function Go(){return wo().memoizedState}function Ko(e,t,n){var r=tl(e);if(n={lane:r,action:n,hasEagerState:!1,eagerState:null,next:null},Xo(e))Yo(t,n);else if(null!==(n=Pa(e,t,n,r))){nl(n,e,r,el()),Jo(n,t,r)}}function Qo(e,t,n){var r=tl(e),i={lane:r,action:n,hasEagerState:!1,eagerState:null,next:null};if(Xo(e))Yo(t,i);else{var a=e.alternate;if(0===e.lanes&&(null===a||0===a.lanes)&&null!==(a=t.lastRenderedReducer))try{var o=t.lastRenderedState,s=a(o,n);if(i.hasEagerState=!0,i.eagerState=s,sr(s,o)){var c=t.interleaved;return null===c?(i.next=i,Ra(t)):(i.next=c.next,c.next=i),void(t.interleaved=i)}}catch(l){}null!==(n=Pa(e,t,i,r))&&(nl(n,e,r,i=el()),Jo(n,t,r))}}function Xo(e){var t=e.alternate;return e===oo||null!==t&&t===oo}function Yo(e,t){uo=lo=!0;var n=e.pending;null===n?t.next=t:(t.next=n.next,n.next=t),e.pending=t}function Jo(e,t,n){if(0!==(4194240&n)){var r=t.lanes;n|=r&=e.pendingLanes,t.lanes=n,vt(e,n)}}var $o={readContext:Oa,useCallback:po,useContext:po,useEffect:po,useImperativeHandle:po,useInsertionEffect:po,useLayoutEffect:po,useMemo:po,useReducer:po,useRef:po,useState:po,useDebugValue:po,useDeferredValue:po,useTransition:po,useMutableSource:po,useSyncExternalStore:po,useId:po,unstable_isNewReconciler:!1},Zo={readContext:Oa,useCallback:function(e,t){return vo().memoizedState=[e,void 0===t?null:t],e},useContext:Oa,useEffect:zo,useImperativeHandle:function(e,t,n){return n=null!==n&&void 0!==n?n.concat([e]):null,Po(4194308,4,Bo.bind(null,t,e),n)},useLayoutEffect:function(e,t){return Po(4194308,4,e,t)},useInsertionEffect:function(e,t){return Po(4,2,e,t)},useMemo:function(e,t){var n=vo();return t=void 0===t?null:t,e=e(),n.memoizedState=[e,t],e},useReducer:function(e,t,n){var r=vo();return t=void 0!==n?n(t):t,r.memoizedState=r.baseState=t,e={pending:null,interleaved:null,lanes:0,dispatch:null,lastRenderedReducer:e,lastRenderedState:t},r.queue=e,e=e.dispatch=Ko.bind(null,oo,e),[r.memoizedState,e]},useRef:function(e){return e={current:e},vo().memoizedState=e},useState:Oo,useDebugValue:jo,useDeferredValue:function(e){return vo().memoizedState=e},useTransition:function(){var e=Oo(!1),t=e[0];return e=Wo.bind(null,e[1]),vo().memoizedState=e,[t,e]},useMutableSource:function(){},useSyncExternalStore:function(e,t,n){var r=oo,i=vo();if(ia){if(void 0===n)throw Error(a(407));n=n()}else{if(n=t(),null===Ac)throw Error(a(349));0!==(30&ao)||ko(r,t,n)}i.memoizedState=n;var o={value:n,getSnapshot:t};return i.queue=o,zo(Io.bind(null,r,o,e),[e]),r.flags|=2048,No(9,To.bind(null,r,o,n,t),void 0,null),n},useId:function(){var e=vo(),t=Ac.identifierPrefix;if(ia){var n=Ji;t=":"+t+"R"+(n=(Yi&~(1<<32-ot(Yi)-1)).toString(32)+n),0<(n=ho++)&&(t+="H"+n.toString(32)),t+=":"}else t=":"+t+"r"+(n=fo++).toString(32)+":";return e.memoizedState=t},unstable_isNewReconciler:!1},es={readContext:Oa,useCallback:Vo,useContext:Oa,useEffect:Mo,useImperativeHandle:Fo,useInsertionEffect:Lo,useLayoutEffect:Uo,useMemo:qo,useReducer:_o,useRef:Ro,useState:function(){return _o(bo)},useDebugValue:jo,useDeferredValue:function(e){return Ho(wo(),so.memoizedState,e)},useTransition:function(){return[_o(bo)[0],wo().memoizedState]},useMutableSource:Eo,useSyncExternalStore:So,useId:Go,unstable_isNewReconciler:!1},ts={readContext:Oa,useCallback:Vo,useContext:Oa,useEffect:Mo,useImperativeHandle:Fo,useInsertionEffect:Lo,useLayoutEffect:Uo,useMemo:qo,useReducer:xo,useRef:Ro,useState:function(){return xo(bo)},useDebugValue:jo,useDeferredValue:function(e){var t=wo();return null===so?t.memoizedState=e:Ho(t,so.memoizedState,e)},useTransition:function(){return[xo(bo)[0],wo().memoizedState]},useMutableSource:Eo,useSyncExternalStore:So,useId:Go,unstable_isNewReconciler:!1};function ns(e,t){if(e&&e.defaultProps){for(var n in t=U({},t),e=e.defaultProps)void 0===t[n]&&(t[n]=e[n]);return t}return t}function rs(e,t,n,r){n=null===(n=n(r,t=e.memoizedState))||void 0===n?t:U({},t,n),e.memoizedState=n,0===e.lanes&&(e.updateQueue.baseState=n)}var is={isMounted:function(e){return!!(e=e._reactInternals)&&Ve(e)===e},enqueueSetState:function(e,t,n){e=e._reactInternals;var r=el(),i=tl(e),a=Ua(r,i);a.payload=t,void 0!==n&&null!==n&&(a.callback=n),null!==(t=Ba(e,a,i))&&(nl(t,e,i,r),Fa(t,e,i))},enqueueReplaceState:function(e,t,n){e=e._reactInternals;var r=el(),i=tl(e),a=Ua(r,i);a.tag=1,a.payload=t,void 0!==n&&null!==n&&(a.callback=n),null!==(t=Ba(e,a,i))&&(nl(t,e,i,r),Fa(t,e,i))},enqueueForceUpdate:function(e,t){e=e._reactInternals;var n=el(),r=tl(e),i=Ua(n,r);i.tag=2,void 0!==t&&null!==t&&(i.callback=t),null!==(t=Ba(e,i,r))&&(nl(t,e,r,n),Fa(t,e,r))}};function as(e,t,n,r,i,a,o){return"function"===typeof(e=e.stateNode).shouldComponentUpdate?e.shouldComponentUpdate(r,a,o):!t.prototype||!t.prototype.isPureReactComponent||(!cr(n,r)||!cr(i,a))}function os(e,t,n){var r=!1,i=Ii,a=t.contextType;return"object"===typeof a&&null!==a?a=Oa(a):(i=Ri(t)?Oi:Ci.current,a=(r=null!==(r=t.contextTypes)&&void 0!==r)?Ni(e,i):Ii),t=new t(n,a),e.memoizedState=null!==t.state&&void 0!==t.state?t.state:null,t.updater=is,e.stateNode=t,t._reactInternals=e,r&&((e=e.stateNode).__reactInternalMemoizedUnmaskedChildContext=i,e.__reactInternalMemoizedMaskedChildContext=a),t}function ss(e,t,n,r){e=t.state,"function"===typeof t.componentWillReceiveProps&&t.componentWillReceiveProps(n,r),"function"===typeof t.UNSAFE_componentWillReceiveProps&&t.UNSAFE_componentWillReceiveProps(n,r),t.state!==e&&is.enqueueReplaceState(t,t.state,null)}function cs(e,t,n,r){var i=e.stateNode;i.props=n,i.state=e.memoizedState,i.refs={},Ma(e);var a=t.contextType;"object"===typeof a&&null!==a?i.context=Oa(a):(a=Ri(t)?Oi:Ci.current,i.context=Ni(e,a)),i.state=e.memoizedState,"function"===typeof(a=t.getDerivedStateFromProps)&&(rs(e,t,a,n),i.state=e.memoizedState),"function"===typeof t.getDerivedStateFromProps||"function"===typeof i.getSnapshotBeforeUpdate||"function"!==typeof i.UNSAFE_componentWillMount&&"function"!==typeof i.componentWillMount||(t=i.state,"function"===typeof i.componentWillMount&&i.componentWillMount(),"function"===typeof i.UNSAFE_componentWillMount&&i.UNSAFE_componentWillMount(),t!==i.state&&is.enqueueReplaceState(i,i.state,null),Va(e,n,i,r),i.state=e.memoizedState),"function"===typeof i.componentDidMount&&(e.flags|=4194308)}function ls(e,t){try{var n="",r=t;do{n+=V(r),r=r.return}while(r);var i=n}catch(P_){i="\nError generating stack: "+P_.message+"\n"+P_.stack}return{value:e,source:t,stack:i,digest:null}}function us(e,t,n){return{value:e,source:null,stack:null!=n?n:null,digest:null!=t?t:null}}function ds(e,t){try{console.error(t.value)}catch($_){setTimeout(function(){throw $_})}}var hs="function"===typeof WeakMap?WeakMap:Map;function fs(e,t,n){(n=Ua(-1,n)).tag=3,n.payload={element:null};var r=t.value;return n.callback=function(){Hc||(Hc=!0,Wc=r),ds(0,t)},n}function ps(e,t,n){(n=Ua(-1,n)).tag=3;var r=e.type.getDerivedStateFromError;if("function"===typeof r){var i=t.value;n.payload=function(){return r(i)},n.callback=function(){ds(0,t)}}var a=e.stateNode;return null!==a&&"function"===typeof a.componentDidCatch&&(n.callback=function(){ds(0,t),"function"!==typeof r&&(null===Gc?Gc=new Set([this]):Gc.add(this));var e=t.stack;this.componentDidCatch(t.value,{componentStack:null!==e?e:""})}),n}function ms(e,t,n){var r=e.pingCache;if(null===r){r=e.pingCache=new hs;var i=new Set;r.set(t,i)}else void 0===(i=r.get(t))&&(i=new Set,r.set(t,i));i.has(n)||(i.add(n),e=kl.bind(null,e,t,n),t.then(e,e))}function gs(e){do{var t;if((t=13===e.tag)&&(t=null===(t=e.memoizedState)||null!==t.dehydrated),t)return e;e=e.return}while(null!==e);return null}function ys(e,t,n,r,i){return 0===(1&e.mode)?(e===t?e.flags|=65536:(e.flags|=128,n.flags|=131072,n.flags&=-52805,1===n.tag&&(null===n.alternate?n.tag=17:((t=Ua(-1,1)).tag=2,Ba(n,t,1))),n.lanes|=1),e):(e.flags|=65536,e.lanes=i,e)}var vs=b.ReactCurrentOwner,ws=!1;function bs(e,t,n,r){t.child=null===e?_a(t,null,n,r):ba(t,e.child,n,r)}function _s(e,t,n,r,i){n=n.render;var a=t.ref;return Aa(t,i),r=go(e,t,n,r,a,i),n=yo(),null===e||ws?(ia&&n&&ea(t),t.flags|=1,bs(e,t,r,i),t.child):(t.updateQueue=e.updateQueue,t.flags&=-2053,e.lanes&=~i,Hs(e,t,i))}function xs(e,t,n,r,i){if(null===e){var a=n.type;return"function"!==typeof a||Rl(a)||void 0!==a.defaultProps||null!==n.compare||void 0!==n.defaultProps?((e=Dl(n.type,null,r,t,t.mode,i)).ref=t.ref,e.return=t,t.child=e):(t.tag=15,t.type=a,Es(e,t,a,r,i))}if(a=e.child,0===(e.lanes&i)){var o=a.memoizedProps;if((n=null!==(n=n.compare)?n:cr)(o,r)&&e.ref===t.ref)return Hs(e,t,i)}return t.flags|=1,(e=Pl(a,r)).ref=t.ref,e.return=t,t.child=e}function Es(e,t,n,r,i){if(null!==e){var a=e.memoizedProps;if(cr(a,r)&&e.ref===t.ref){if(ws=!1,t.pendingProps=r=a,0===(e.lanes&i))return t.lanes=e.lanes,Hs(e,t,i);0!==(131072&e.flags)&&(ws=!0)}}return Ts(e,t,n,r,i)}function Ss(e,t,n){var r=t.pendingProps,i=r.children,a=null!==e?e.memoizedState:null;if("hidden"===r.mode)if(0===(1&t.mode))t.memoizedState={baseLanes:0,cachePool:null,transitions:null},Ti(Pc,Rc),Rc|=n;else{if(0===(1073741824&n))return e=null!==a?a.baseLanes|n:n,t.lanes=t.childLanes=1073741824,t.memoizedState={baseLanes:e,cachePool:null,transitions:null},t.updateQueue=null,Ti(Pc,Rc),Rc|=e,null;t.memoizedState={baseLanes:0,cachePool:null,transitions:null},r=null!==a?a.baseLanes:n,Ti(Pc,Rc),Rc|=r}else null!==a?(r=a.baseLanes|n,t.memoizedState=null):r=n,Ti(Pc,Rc),Rc|=r;return bs(e,t,i,n),t.child}function ks(e,t){var n=t.ref;(null===e&&null!==n||null!==e&&e.ref!==n)&&(t.flags|=512,t.flags|=2097152)}function Ts(e,t,n,r,i){var a=Ri(n)?Oi:Ci.current;return a=Ni(t,a),Aa(t,i),n=go(e,t,n,r,a,i),r=yo(),null===e||ws?(ia&&r&&ea(t),t.flags|=1,bs(e,t,n,i),t.child):(t.updateQueue=e.updateQueue,t.flags&=-2053,e.lanes&=~i,Hs(e,t,i))}function Is(e,t,n,r,i){if(Ri(n)){var a=!0;Mi(t)}else a=!1;if(Aa(t,i),null===t.stateNode)qs(e,t),os(t,n,r),cs(t,n,r,i),r=!0;else if(null===e){var o=t.stateNode,s=t.memoizedProps;o.props=s;var c=o.context,l=n.contextType;"object"===typeof l&&null!==l?l=Oa(l):l=Ni(t,l=Ri(n)?Oi:Ci.current);var u=n.getDerivedStateFromProps,d="function"===typeof u||"function"===typeof o.getSnapshotBeforeUpdate;d||"function"!==typeof o.UNSAFE_componentWillReceiveProps&&"function"!==typeof o.componentWillReceiveProps||(s!==r||c!==l)&&ss(t,o,r,l),za=!1;var h=t.memoizedState;o.state=h,Va(t,r,o,i),c=t.memoizedState,s!==r||h!==c||Ai.current||za?("function"===typeof u&&(rs(t,n,u,r),c=t.memoizedState),(s=za||as(t,n,s,r,h,c,l))?(d||"function"!==typeof o.UNSAFE_componentWillMount&&"function"!==typeof o.componentWillMount||("function"===typeof o.componentWillMount&&o.componentWillMount(),"function"===typeof o.UNSAFE_componentWillMount&&o.UNSAFE_componentWillMount()),"function"===typeof o.componentDidMount&&(t.flags|=4194308)):("function"===typeof o.componentDidMount&&(t.flags|=4194308),t.memoizedProps=r,t.memoizedState=c),o.props=r,o.state=c,o.context=l,r=s):("function"===typeof o.componentDidMount&&(t.flags|=4194308),r=!1)}else{o=t.stateNode,La(e,t),s=t.memoizedProps,l=t.type===t.elementType?s:ns(t.type,s),o.props=l,d=t.pendingProps,h=o.context,"object"===typeof(c=n.contextType)&&null!==c?c=Oa(c):c=Ni(t,c=Ri(n)?Oi:Ci.current);var f=n.getDerivedStateFromProps;(u="function"===typeof f||"function"===typeof o.getSnapshotBeforeUpdate)||"function"!==typeof o.UNSAFE_componentWillReceiveProps&&"function"!==typeof o.componentWillReceiveProps||(s!==d||h!==c)&&ss(t,o,r,c),za=!1,h=t.memoizedState,o.state=h,Va(t,r,o,i);var p=t.memoizedState;s!==d||h!==p||Ai.current||za?("function"===typeof f&&(rs(t,n,f,r),p=t.memoizedState),(l=za||as(t,n,l,r,h,p,c)||!1)?(u||"function"!==typeof o.UNSAFE_componentWillUpdate&&"function"!==typeof o.componentWillUpdate||("function"===typeof o.componentWillUpdate&&o.componentWillUpdate(r,p,c),"function"===typeof o.UNSAFE_componentWillUpdate&&o.UNSAFE_componentWillUpdate(r,p,c)),"function"===typeof o.componentDidUpdate&&(t.flags|=4),"function"===typeof o.getSnapshotBeforeUpdate&&(t.flags|=1024)):("function"!==typeof o.componentDidUpdate||s===e.memoizedProps&&h===e.memoizedState||(t.flags|=4),"function"!==typeof o.getSnapshotBeforeUpdate||s===e.memoizedProps&&h===e.memoizedState||(t.flags|=1024),t.memoizedProps=r,t.memoizedState=p),o.props=r,o.state=p,o.context=c,r=l):("function"!==typeof o.componentDidUpdate||s===e.memoizedProps&&h===e.memoizedState||(t.flags|=4),"function"!==typeof o.getSnapshotBeforeUpdate||s===e.memoizedProps&&h===e.memoizedState||(t.flags|=1024),r=!1)}return Cs(e,t,n,r,a,i)}function Cs(e,t,n,r,i,a){ks(e,t);var o=0!==(128&t.flags);if(!r&&!o)return i&&Li(t,n,!1),Hs(e,t,a);r=t.stateNode,vs.current=t;var s=o&&"function"!==typeof n.getDerivedStateFromError?null:r.render();return t.flags|=1,null!==e&&o?(t.child=ba(t,e.child,null,a),t.child=ba(t,null,s,a)):bs(e,t,s,a),t.memoizedState=r.state,i&&Li(t,n,!0),t.child}function As(e){var t=e.stateNode;t.pendingContext?Di(0,t.pendingContext,t.pendingContext!==t.context):t.context&&Di(0,t.context,!1),Xa(e,t.containerInfo)}function Os(e,t,n,r,i){return fa(),pa(i),t.flags|=256,bs(e,t,n,r),t.child}var Ns,Rs,Ps,Ds,zs={dehydrated:null,treeContext:null,retryLane:0};function Ms(e){return{baseLanes:e,cachePool:null,transitions:null}}function Ls(e,t,n){var r,i=t.pendingProps,o=Za.current,s=!1,c=0!==(128&t.flags);if((r=c)||(r=(null===e||null!==e.memoizedState)&&0!==(2&o)),r?(s=!0,t.flags&=-129):null!==e&&null===e.memoizedState||(o|=1),Ti(Za,1&o),null===e)return la(t),null!==(e=t.memoizedState)&&null!==(e=e.dehydrated)?(0===(1&t.mode)?t.lanes=1:"$!"===e.data?t.lanes=8:t.lanes=1073741824,null):(c=i.children,e=i.fallback,s?(i=t.mode,s=t.child,c={mode:"hidden",children:c},0===(1&i)&&null!==s?(s.childLanes=0,s.pendingProps=c):s=Ml(c,i,0,null),e=zl(e,i,n,null),s.return=t,e.return=t,s.sibling=e,t.child=s,t.child.memoizedState=Ms(n),t.memoizedState=zs,e):Us(t,c));if(null!==(o=e.memoizedState)&&null!==(r=o.dehydrated))return function(e,t,n,r,i,o,s){if(n)return 256&t.flags?(t.flags&=-257,Bs(e,t,s,r=us(Error(a(422))))):null!==t.memoizedState?(t.child=e.child,t.flags|=128,null):(o=r.fallback,i=t.mode,r=Ml({mode:"visible",children:r.children},i,0,null),(o=zl(o,i,s,null)).flags|=2,r.return=t,o.return=t,r.sibling=o,t.child=r,0!==(1&t.mode)&&ba(t,e.child,null,s),t.child.memoizedState=Ms(s),t.memoizedState=zs,o);if(0===(1&t.mode))return Bs(e,t,s,null);if("$!"===i.data){if(r=i.nextSibling&&i.nextSibling.dataset)var c=r.dgst;return r=c,Bs(e,t,s,r=us(o=Error(a(419)),r,void 0))}if(c=0!==(s&e.childLanes),ws||c){if(null!==(r=Ac)){switch(s&-s){case 4:i=2;break;case 16:i=8;break;case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:i=32;break;case 536870912:i=268435456;break;default:i=0}0!==(i=0!==(i&(r.suspendedLanes|s))?0:i)&&i!==o.retryLane&&(o.retryLane=i,Da(e,i),nl(r,e,i,-1))}return ml(),Bs(e,t,s,r=us(Error(a(421))))}return"$?"===i.data?(t.flags|=128,t.child=e.child,t=Il.bind(null,e),i._reactRetry=t,null):(e=o.treeContext,ra=li(i.nextSibling),na=t,ia=!0,aa=null,null!==e&&(Ki[Qi++]=Yi,Ki[Qi++]=Ji,Ki[Qi++]=Xi,Yi=e.id,Ji=e.overflow,Xi=t),t=Us(t,r.children),t.flags|=4096,t)}(e,t,c,i,r,o,n);if(s){s=i.fallback,c=t.mode,r=(o=e.child).sibling;var l={mode:"hidden",children:i.children};return 0===(1&c)&&t.child!==o?((i=t.child).childLanes=0,i.pendingProps=l,t.deletions=null):(i=Pl(o,l)).subtreeFlags=14680064&o.subtreeFlags,null!==r?s=Pl(r,s):(s=zl(s,c,n,null)).flags|=2,s.return=t,i.return=t,i.sibling=s,t.child=i,i=s,s=t.child,c=null===(c=e.child.memoizedState)?Ms(n):{baseLanes:c.baseLanes|n,cachePool:null,transitions:c.transitions},s.memoizedState=c,s.childLanes=e.childLanes&~n,t.memoizedState=zs,i}return e=(s=e.child).sibling,i=Pl(s,{mode:"visible",children:i.children}),0===(1&t.mode)&&(i.lanes=n),i.return=t,i.sibling=null,null!==e&&(null===(n=t.deletions)?(t.deletions=[e],t.flags|=16):n.push(e)),t.child=i,t.memoizedState=null,i}function Us(e,t){return(t=Ml({mode:"visible",children:t},e.mode,0,null)).return=e,e.child=t}function Bs(e,t,n,r){return null!==r&&pa(r),ba(t,e.child,null,n),(e=Us(t,t.pendingProps.children)).flags|=2,t.memoizedState=null,e}function Fs(e,t,n){e.lanes|=t;var r=e.alternate;null!==r&&(r.lanes|=t),Ca(e.return,t,n)}function js(e,t,n,r,i){var a=e.memoizedState;null===a?e.memoizedState={isBackwards:t,rendering:null,renderingStartTime:0,last:r,tail:n,tailMode:i}:(a.isBackwards=t,a.rendering=null,a.renderingStartTime=0,a.last=r,a.tail=n,a.tailMode=i)}function Vs(e,t,n){var r=t.pendingProps,i=r.revealOrder,a=r.tail;if(bs(e,t,r.children,n),0!==(2&(r=Za.current)))r=1&r|2,t.flags|=128;else{if(null!==e&&0!==(128&e.flags))e:for(e=t.child;null!==e;){if(13===e.tag)null!==e.memoizedState&&Fs(e,n,t);else if(19===e.tag)Fs(e,n,t);else if(null!==e.child){e.child.return=e,e=e.child;continue}if(e===t)break e;for(;null===e.sibling;){if(null===e.return||e.return===t)break e;e=e.return}e.sibling.return=e.return,e=e.sibling}r&=1}if(Ti(Za,r),0===(1&t.mode))t.memoizedState=null;else switch(i){case"forwards":for(n=t.child,i=null;null!==n;)null!==(e=n.alternate)&&null===eo(e)&&(i=n),n=n.sibling;null===(n=i)?(i=t.child,t.child=null):(i=n.sibling,n.sibling=null),js(t,!1,i,n,a);break;case"backwards":for(n=null,i=t.child,t.child=null;null!==i;){if(null!==(e=i.alternate)&&null===eo(e)){t.child=i;break}e=i.sibling,i.sibling=n,n=i,i=e}js(t,!0,n,null,a);break;case"together":js(t,!1,null,null,void 0);break;default:t.memoizedState=null}return t.child}function qs(e,t){0===(1&t.mode)&&null!==e&&(e.alternate=null,t.alternate=null,t.flags|=2)}function Hs(e,t,n){if(null!==e&&(t.dependencies=e.dependencies),Mc|=t.lanes,0===(n&t.childLanes))return null;if(null!==e&&t.child!==e.child)throw Error(a(153));if(null!==t.child){for(n=Pl(e=t.child,e.pendingProps),t.child=n,n.return=t;null!==e.sibling;)e=e.sibling,(n=n.sibling=Pl(e,e.pendingProps)).return=t;n.sibling=null}return t.child}function Ws(e,t){if(!ia)switch(e.tailMode){case"hidden":t=e.tail;for(var n=null;null!==t;)null!==t.alternate&&(n=t),t=t.sibling;null===n?e.tail=null:n.sibling=null;break;case"collapsed":n=e.tail;for(var r=null;null!==n;)null!==n.alternate&&(r=n),n=n.sibling;null===r?t||null===e.tail?e.tail=null:e.tail.sibling=null:r.sibling=null}}function Gs(e){var t=null!==e.alternate&&e.alternate.child===e.child,n=0,r=0;if(t)for(var i=e.child;null!==i;)n|=i.lanes|i.childLanes,r|=14680064&i.subtreeFlags,r|=14680064&i.flags,i.return=e,i=i.sibling;else for(i=e.child;null!==i;)n|=i.lanes|i.childLanes,r|=i.subtreeFlags,r|=i.flags,i.return=e,i=i.sibling;return e.subtreeFlags|=r,e.childLanes=n,t}function Ks(e,t,n){var r=t.pendingProps;switch(ta(t),t.tag){case 2:case 16:case 15:case 0:case 11:case 7:case 8:case 12:case 9:case 14:return Gs(t),null;case 1:case 17:return Ri(t.type)&&Pi(),Gs(t),null;case 3:return r=t.stateNode,Ya(),ki(Ai),ki(Ci),no(),r.pendingContext&&(r.context=r.pendingContext,r.pendingContext=null),null!==e&&null!==e.child||(da(t)?t.flags|=4:null===e||e.memoizedState.isDehydrated&&0===(256&t.flags)||(t.flags|=1024,null!==aa&&(ol(aa),aa=null))),Rs(e,t),Gs(t),null;case 5:$a(t);var i=Qa(Ka.current);if(n=t.type,null!==e&&null!=t.stateNode)Ps(e,t,n,r,i),e.ref!==t.ref&&(t.flags|=512,t.flags|=2097152);else{if(!r){if(null===t.stateNode)throw Error(a(166));return Gs(t),null}if(e=Qa(Wa.current),da(t)){r=t.stateNode,n=t.type;var o=t.memoizedProps;switch(r[hi]=t,r[fi]=o,e=0!==(1&t.mode),n){case"dialog":Br("cancel",r),Br("close",r);break;case"iframe":case"object":case"embed":Br("load",r);break;case"video":case"audio":for(i=0;i<zr.length;i++)Br(zr[i],r);break;case"source":Br("error",r);break;case"img":case"image":case"link":Br("error",r),Br("load",r);break;case"details":Br("toggle",r);break;case"input":J(r,o),Br("invalid",r);break;case"select":r._wrapperState={wasMultiple:!!o.multiple},Br("invalid",r);break;case"textarea":ae(r,o),Br("invalid",r)}for(var c in ve(n,o),i=null,o)if(o.hasOwnProperty(c)){var l=o[c];"children"===c?"string"===typeof l?r.textContent!==l&&(!0!==o.suppressHydrationWarning&&$r(r.textContent,l,e),i=["children",l]):"number"===typeof l&&r.textContent!==""+l&&(!0!==o.suppressHydrationWarning&&$r(r.textContent,l,e),i=["children",""+l]):s.hasOwnProperty(c)&&null!=l&&"onScroll"===c&&Br("scroll",r)}switch(n){case"input":K(r),ee(r,o,!0);break;case"textarea":K(r),se(r);break;case"select":case"option":break;default:"function"===typeof o.onClick&&(r.onclick=Zr)}r=i,t.updateQueue=r,null!==r&&(t.flags|=4)}else{c=9===i.nodeType?i:i.ownerDocument,"http://www.w3.org/1999/xhtml"===e&&(e=ce(n)),"http://www.w3.org/1999/xhtml"===e?"script"===n?((e=c.createElement("div")).innerHTML="<script><\/script>",e=e.removeChild(e.firstChild)):"string"===typeof r.is?e=c.createElement(n,{is:r.is}):(e=c.createElement(n),"select"===n&&(c=e,r.multiple?c.multiple=!0:r.size&&(c.size=r.size))):e=c.createElementNS(e,n),e[hi]=t,e[fi]=r,Ns(e,t,!1,!1),t.stateNode=e;e:{switch(c=we(n,r),n){case"dialog":Br("cancel",e),Br("close",e),i=r;break;case"iframe":case"object":case"embed":Br("load",e),i=r;break;case"video":case"audio":for(i=0;i<zr.length;i++)Br(zr[i],e);i=r;break;case"source":Br("error",e),i=r;break;case"img":case"image":case"link":Br("error",e),Br("load",e),i=r;break;case"details":Br("toggle",e),i=r;break;case"input":J(e,r),i=Y(e,r),Br("invalid",e);break;case"option":default:i=r;break;case"select":e._wrapperState={wasMultiple:!!r.multiple},i=U({},r,{value:void 0}),Br("invalid",e);break;case"textarea":ae(e,r),i=ie(e,r),Br("invalid",e)}for(o in ve(n,i),l=i)if(l.hasOwnProperty(o)){var u=l[o];"style"===o?ge(e,u):"dangerouslySetInnerHTML"===o?null!=(u=u?u.__html:void 0)&&de(e,u):"children"===o?"string"===typeof u?("textarea"!==n||""!==u)&&he(e,u):"number"===typeof u&&he(e,""+u):"suppressContentEditableWarning"!==o&&"suppressHydrationWarning"!==o&&"autoFocus"!==o&&(s.hasOwnProperty(o)?null!=u&&"onScroll"===o&&Br("scroll",e):null!=u&&w(e,o,u,c))}switch(n){case"input":K(e),ee(e,r,!1);break;case"textarea":K(e),se(e);break;case"option":null!=r.value&&e.setAttribute("value",""+W(r.value));break;case"select":e.multiple=!!r.multiple,null!=(o=r.value)?re(e,!!r.multiple,o,!1):null!=r.defaultValue&&re(e,!!r.multiple,r.defaultValue,!0);break;default:"function"===typeof i.onClick&&(e.onclick=Zr)}switch(n){case"button":case"input":case"select":case"textarea":r=!!r.autoFocus;break e;case"img":r=!0;break e;default:r=!1}}r&&(t.flags|=4)}null!==t.ref&&(t.flags|=512,t.flags|=2097152)}return Gs(t),null;case 6:if(e&&null!=t.stateNode)Ds(e,t,e.memoizedProps,r);else{if("string"!==typeof r&&null===t.stateNode)throw Error(a(166));if(n=Qa(Ka.current),Qa(Wa.current),da(t)){if(r=t.stateNode,n=t.memoizedProps,r[hi]=t,(o=r.nodeValue!==n)&&null!==(e=na))switch(e.tag){case 3:$r(r.nodeValue,n,0!==(1&e.mode));break;case 5:!0!==e.memoizedProps.suppressHydrationWarning&&$r(r.nodeValue,n,0!==(1&e.mode))}o&&(t.flags|=4)}else(r=(9===n.nodeType?n:n.ownerDocument).createTextNode(r))[hi]=t,t.stateNode=r}return Gs(t),null;case 13:if(ki(Za),r=t.memoizedState,null===e||null!==e.memoizedState&&null!==e.memoizedState.dehydrated){if(ia&&null!==ra&&0!==(1&t.mode)&&0===(128&t.flags))ha(),fa(),t.flags|=98560,o=!1;else if(o=da(t),null!==r&&null!==r.dehydrated){if(null===e){if(!o)throw Error(a(318));if(!(o=null!==(o=t.memoizedState)?o.dehydrated:null))throw Error(a(317));o[hi]=t}else fa(),0===(128&t.flags)&&(t.memoizedState=null),t.flags|=4;Gs(t),o=!1}else null!==aa&&(ol(aa),aa=null),o=!0;if(!o)return 65536&t.flags?t:null}return 0!==(128&t.flags)?(t.lanes=n,t):((r=null!==r)!==(null!==e&&null!==e.memoizedState)&&r&&(t.child.flags|=8192,0!==(1&t.mode)&&(null===e||0!==(1&Za.current)?0===Dc&&(Dc=3):ml())),null!==t.updateQueue&&(t.flags|=4),Gs(t),null);case 4:return Ya(),Rs(e,t),null===e&&Vr(t.stateNode.containerInfo),Gs(t),null;case 10:return Ia(t.type._context),Gs(t),null;case 19:if(ki(Za),null===(o=t.memoizedState))return Gs(t),null;if(r=0!==(128&t.flags),null===(c=o.rendering))if(r)Ws(o,!1);else{if(0!==Dc||null!==e&&0!==(128&e.flags))for(e=t.child;null!==e;){if(null!==(c=eo(e))){for(t.flags|=128,Ws(o,!1),null!==(r=c.updateQueue)&&(t.updateQueue=r,t.flags|=4),t.subtreeFlags=0,r=n,n=t.child;null!==n;)e=r,(o=n).flags&=14680066,null===(c=o.alternate)?(o.childLanes=0,o.lanes=e,o.child=null,o.subtreeFlags=0,o.memoizedProps=null,o.memoizedState=null,o.updateQueue=null,o.dependencies=null,o.stateNode=null):(o.childLanes=c.childLanes,o.lanes=c.lanes,o.child=c.child,o.subtreeFlags=0,o.deletions=null,o.memoizedProps=c.memoizedProps,o.memoizedState=c.memoizedState,o.updateQueue=c.updateQueue,o.type=c.type,e=c.dependencies,o.dependencies=null===e?null:{lanes:e.lanes,firstContext:e.firstContext}),n=n.sibling;return Ti(Za,1&Za.current|2),t.child}e=e.sibling}null!==o.tail&&Je()>Vc&&(t.flags|=128,r=!0,Ws(o,!1),t.lanes=4194304)}else{if(!r)if(null!==(e=eo(c))){if(t.flags|=128,r=!0,null!==(n=e.updateQueue)&&(t.updateQueue=n,t.flags|=4),Ws(o,!0),null===o.tail&&"hidden"===o.tailMode&&!c.alternate&&!ia)return Gs(t),null}else 2*Je()-o.renderingStartTime>Vc&&1073741824!==n&&(t.flags|=128,r=!0,Ws(o,!1),t.lanes=4194304);o.isBackwards?(c.sibling=t.child,t.child=c):(null!==(n=o.last)?n.sibling=c:t.child=c,o.last=c)}return null!==o.tail?(t=o.tail,o.rendering=t,o.tail=t.sibling,o.renderingStartTime=Je(),t.sibling=null,n=Za.current,Ti(Za,r?1&n|2:1&n),t):(Gs(t),null);case 22:case 23:return dl(),r=null!==t.memoizedState,null!==e&&null!==e.memoizedState!==r&&(t.flags|=8192),r&&0!==(1&t.mode)?0!==(1073741824&Rc)&&(Gs(t),6&t.subtreeFlags&&(t.flags|=8192)):Gs(t),null;case 24:case 25:return null}throw Error(a(156,t.tag))}function Qs(e,t){switch(ta(t),t.tag){case 1:return Ri(t.type)&&Pi(),65536&(e=t.flags)?(t.flags=-65537&e|128,t):null;case 3:return Ya(),ki(Ai),ki(Ci),no(),0!==(65536&(e=t.flags))&&0===(128&e)?(t.flags=-65537&e|128,t):null;case 5:return $a(t),null;case 13:if(ki(Za),null!==(e=t.memoizedState)&&null!==e.dehydrated){if(null===t.alternate)throw Error(a(340));fa()}return 65536&(e=t.flags)?(t.flags=-65537&e|128,t):null;case 19:return ki(Za),null;case 4:return Ya(),null;case 10:return Ia(t.type._context),null;case 22:case 23:return dl(),null;default:return null}}Ns=function(e,t){for(var n=t.child;null!==n;){if(5===n.tag||6===n.tag)e.appendChild(n.stateNode);else if(4!==n.tag&&null!==n.child){n.child.return=n,n=n.child;continue}if(n===t)break;for(;null===n.sibling;){if(null===n.return||n.return===t)return;n=n.return}n.sibling.return=n.return,n=n.sibling}},Rs=function(){},Ps=function(e,t,n,r){var i=e.memoizedProps;if(i!==r){e=t.stateNode,Qa(Wa.current);var a,o=null;switch(n){case"input":i=Y(e,i),r=Y(e,r),o=[];break;case"select":i=U({},i,{value:void 0}),r=U({},r,{value:void 0}),o=[];break;case"textarea":i=ie(e,i),r=ie(e,r),o=[];break;default:"function"!==typeof i.onClick&&"function"===typeof r.onClick&&(e.onclick=Zr)}for(u in ve(n,r),n=null,i)if(!r.hasOwnProperty(u)&&i.hasOwnProperty(u)&&null!=i[u])if("style"===u){var c=i[u];for(a in c)c.hasOwnProperty(a)&&(n||(n={}),n[a]="")}else"dangerouslySetInnerHTML"!==u&&"children"!==u&&"suppressContentEditableWarning"!==u&&"suppressHydrationWarning"!==u&&"autoFocus"!==u&&(s.hasOwnProperty(u)?o||(o=[]):(o=o||[]).push(u,null));for(u in r){var l=r[u];if(c=null!=i?i[u]:void 0,r.hasOwnProperty(u)&&l!==c&&(null!=l||null!=c))if("style"===u)if(c){for(a in c)!c.hasOwnProperty(a)||l&&l.hasOwnProperty(a)||(n||(n={}),n[a]="");for(a in l)l.hasOwnProperty(a)&&c[a]!==l[a]&&(n||(n={}),n[a]=l[a])}else n||(o||(o=[]),o.push(u,n)),n=l;else"dangerouslySetInnerHTML"===u?(l=l?l.__html:void 0,c=c?c.__html:void 0,null!=l&&c!==l&&(o=o||[]).push(u,l)):"children"===u?"string"!==typeof l&&"number"!==typeof l||(o=o||[]).push(u,""+l):"suppressContentEditableWarning"!==u&&"suppressHydrationWarning"!==u&&(s.hasOwnProperty(u)?(null!=l&&"onScroll"===u&&Br("scroll",e),o||c===l||(o=[])):(o=o||[]).push(u,l))}n&&(o=o||[]).push("style",n);var u=o;(t.updateQueue=u)&&(t.flags|=4)}},Ds=function(e,t,n,r){n!==r&&(t.flags|=4)};var Xs=!1,Ys=!1,Js="function"===typeof WeakSet?WeakSet:Set,$s=null;function Zs(e,t){var n=e.ref;if(null!==n)if("function"===typeof n)try{n(null)}catch(r){Sl(e,t,r)}else n.current=null}function ec(e,t,n){try{n()}catch(r){Sl(e,t,r)}}var tc=!1;function nc(e,t,n){var r=t.updateQueue;if(null!==(r=null!==r?r.lastEffect:null)){var i=r=r.next;do{if((i.tag&e)===e){var a=i.destroy;i.destroy=void 0,void 0!==a&&ec(t,n,a)}i=i.next}while(i!==r)}}function rc(e,t){if(null!==(t=null!==(t=t.updateQueue)?t.lastEffect:null)){var n=t=t.next;do{if((n.tag&e)===e){var r=n.create;n.destroy=r()}n=n.next}while(n!==t)}}function ic(e){var t=e.ref;if(null!==t){var n=e.stateNode;e.tag,e=n,"function"===typeof t?t(e):t.current=e}}function ac(e){var t=e.alternate;null!==t&&(e.alternate=null,ac(t)),e.child=null,e.deletions=null,e.sibling=null,5===e.tag&&(null!==(t=e.stateNode)&&(delete t[hi],delete t[fi],delete t[mi],delete t[gi],delete t[yi])),e.stateNode=null,e.return=null,e.dependencies=null,e.memoizedProps=null,e.memoizedState=null,e.pendingProps=null,e.stateNode=null,e.updateQueue=null}function oc(e){return 5===e.tag||3===e.tag||4===e.tag}function sc(e){e:for(;;){for(;null===e.sibling;){if(null===e.return||oc(e.return))return null;e=e.return}for(e.sibling.return=e.return,e=e.sibling;5!==e.tag&&6!==e.tag&&18!==e.tag;){if(2&e.flags)continue e;if(null===e.child||4===e.tag)continue e;e.child.return=e,e=e.child}if(!(2&e.flags))return e.stateNode}}function cc(e,t,n){var r=e.tag;if(5===r||6===r)e=e.stateNode,t?8===n.nodeType?n.parentNode.insertBefore(e,t):n.insertBefore(e,t):(8===n.nodeType?(t=n.parentNode).insertBefore(e,n):(t=n).appendChild(e),null!==(n=n._reactRootContainer)&&void 0!==n||null!==t.onclick||(t.onclick=Zr));else if(4!==r&&null!==(e=e.child))for(cc(e,t,n),e=e.sibling;null!==e;)cc(e,t,n),e=e.sibling}function lc(e,t,n){var r=e.tag;if(5===r||6===r)e=e.stateNode,t?n.insertBefore(e,t):n.appendChild(e);else if(4!==r&&null!==(e=e.child))for(lc(e,t,n),e=e.sibling;null!==e;)lc(e,t,n),e=e.sibling}var uc=null,dc=!1;function hc(e,t,n){for(n=n.child;null!==n;)fc(e,t,n),n=n.sibling}function fc(e,t,n){if(at&&"function"===typeof at.onCommitFiberUnmount)try{at.onCommitFiberUnmount(it,n)}catch(s){}switch(n.tag){case 5:Ys||Zs(n,t);case 6:var r=uc,i=dc;uc=null,hc(e,t,n),dc=i,null!==(uc=r)&&(dc?(e=uc,n=n.stateNode,8===e.nodeType?e.parentNode.removeChild(n):e.removeChild(n)):uc.removeChild(n.stateNode));break;case 18:null!==uc&&(dc?(e=uc,n=n.stateNode,8===e.nodeType?ci(e.parentNode,n):1===e.nodeType&&ci(e,n),Vt(e)):ci(uc,n.stateNode));break;case 4:r=uc,i=dc,uc=n.stateNode.containerInfo,dc=!0,hc(e,t,n),uc=r,dc=i;break;case 0:case 11:case 14:case 15:if(!Ys&&(null!==(r=n.updateQueue)&&null!==(r=r.lastEffect))){i=r=r.next;do{var a=i,o=a.destroy;a=a.tag,void 0!==o&&(0!==(2&a)||0!==(4&a))&&ec(n,t,o),i=i.next}while(i!==r)}hc(e,t,n);break;case 1:if(!Ys&&(Zs(n,t),"function"===typeof(r=n.stateNode).componentWillUnmount))try{r.props=n.memoizedProps,r.state=n.memoizedState,r.componentWillUnmount()}catch(s){Sl(n,t,s)}hc(e,t,n);break;case 21:hc(e,t,n);break;case 22:1&n.mode?(Ys=(r=Ys)||null!==n.memoizedState,hc(e,t,n),Ys=r):hc(e,t,n);break;default:hc(e,t,n)}}function pc(e){var t=e.updateQueue;if(null!==t){e.updateQueue=null;var n=e.stateNode;null===n&&(n=e.stateNode=new Js),t.forEach(function(t){var r=Cl.bind(null,e,t);n.has(t)||(n.add(t),t.then(r,r))})}}function mc(e,t){var n=t.deletions;if(null!==n)for(var r=0;r<n.length;r++){var i=n[r];try{var o=e,s=t,c=s;e:for(;null!==c;){switch(c.tag){case 5:uc=c.stateNode,dc=!1;break e;case 3:case 4:uc=c.stateNode.containerInfo,dc=!0;break e}c=c.return}if(null===uc)throw Error(a(160));fc(o,s,i),uc=null,dc=!1;var l=i.alternate;null!==l&&(l.return=null),i.return=null}catch(u){Sl(i,t,u)}}if(12854&t.subtreeFlags)for(t=t.child;null!==t;)gc(t,e),t=t.sibling}function gc(e,t){var n=e.alternate,r=e.flags;switch(e.tag){case 0:case 11:case 14:case 15:if(mc(t,e),yc(e),4&r){try{nc(3,e,e.return),rc(3,e)}catch(k_){Sl(e,e.return,k_)}try{nc(5,e,e.return)}catch(k_){Sl(e,e.return,k_)}}break;case 1:mc(t,e),yc(e),512&r&&null!==n&&Zs(n,n.return);break;case 5:if(mc(t,e),yc(e),512&r&&null!==n&&Zs(n,n.return),32&e.flags){var i=e.stateNode;try{he(i,"")}catch(k_){Sl(e,e.return,k_)}}if(4&r&&null!=(i=e.stateNode)){var o=e.memoizedProps,s=null!==n?n.memoizedProps:o,c=e.type,l=e.updateQueue;if(e.updateQueue=null,null!==l)try{"input"===c&&"radio"===o.type&&null!=o.name&&$(i,o),we(c,s);var u=we(c,o);for(s=0;s<l.length;s+=2){var d=l[s],h=l[s+1];"style"===d?ge(i,h):"dangerouslySetInnerHTML"===d?de(i,h):"children"===d?he(i,h):w(i,d,h,u)}switch(c){case"input":Z(i,o);break;case"textarea":oe(i,o);break;case"select":var f=i._wrapperState.wasMultiple;i._wrapperState.wasMultiple=!!o.multiple;var p=o.value;null!=p?re(i,!!o.multiple,p,!1):f!==!!o.multiple&&(null!=o.defaultValue?re(i,!!o.multiple,o.defaultValue,!0):re(i,!!o.multiple,o.multiple?[]:"",!1))}i[fi]=o}catch(k_){Sl(e,e.return,k_)}}break;case 6:if(mc(t,e),yc(e),4&r){if(null===e.stateNode)throw Error(a(162));i=e.stateNode,o=e.memoizedProps;try{i.nodeValue=o}catch(k_){Sl(e,e.return,k_)}}break;case 3:if(mc(t,e),yc(e),4&r&&null!==n&&n.memoizedState.isDehydrated)try{Vt(t.containerInfo)}catch(k_){Sl(e,e.return,k_)}break;case 4:default:mc(t,e),yc(e);break;case 13:mc(t,e),yc(e),8192&(i=e.child).flags&&(o=null!==i.memoizedState,i.stateNode.isHidden=o,!o||null!==i.alternate&&null!==i.alternate.memoizedState||(jc=Je())),4&r&&pc(e);break;case 22:if(d=null!==n&&null!==n.memoizedState,1&e.mode?(Ys=(u=Ys)||d,mc(t,e),Ys=u):mc(t,e),yc(e),8192&r){if(u=null!==e.memoizedState,(e.stateNode.isHidden=u)&&!d&&0!==(1&e.mode))for($s=e,d=e.child;null!==d;){for(h=$s=d;null!==$s;){switch(p=(f=$s).child,f.tag){case 0:case 11:case 14:case 15:nc(4,f,f.return);break;case 1:Zs(f,f.return);var m=f.stateNode;if("function"===typeof m.componentWillUnmount){r=f,n=f.return;try{t=r,m.props=t.memoizedProps,m.state=t.memoizedState,m.componentWillUnmount()}catch(k_){Sl(r,n,k_)}}break;case 5:Zs(f,f.return);break;case 22:if(null!==f.memoizedState){_c(h);continue}}null!==p?(p.return=f,$s=p):_c(h)}d=d.sibling}e:for(d=null,h=e;;){if(5===h.tag){if(null===d){d=h;try{i=h.stateNode,u?"function"===typeof(o=i.style).setProperty?o.setProperty("display","none","important"):o.display="none":(c=h.stateNode,s=void 0!==(l=h.memoizedProps.style)&&null!==l&&l.hasOwnProperty("display")?l.display:null,c.style.display=me("display",s))}catch(k_){Sl(e,e.return,k_)}}}else if(6===h.tag){if(null===d)try{h.stateNode.nodeValue=u?"":h.memoizedProps}catch(k_){Sl(e,e.return,k_)}}else if((22!==h.tag&&23!==h.tag||null===h.memoizedState||h===e)&&null!==h.child){h.child.return=h,h=h.child;continue}if(h===e)break e;for(;null===h.sibling;){if(null===h.return||h.return===e)break e;d===h&&(d=null),h=h.return}d===h&&(d=null),h.sibling.return=h.return,h=h.sibling}}break;case 19:mc(t,e),yc(e),4&r&&pc(e);case 21:}}function yc(e){var t=e.flags;if(2&t){try{e:{for(var n=e.return;null!==n;){if(oc(n)){var r=n;break e}n=n.return}throw Error(a(160))}switch(r.tag){case 5:var i=r.stateNode;32&r.flags&&(he(i,""),r.flags&=-33),lc(e,sc(e),i);break;case 3:case 4:var o=r.stateNode.containerInfo;cc(e,sc(e),o);break;default:throw Error(a(161))}}catch(s){Sl(e,e.return,s)}e.flags&=-3}4096&t&&(e.flags&=-4097)}function vc(e,t,n){$s=e,wc(e,t,n)}function wc(e,t,n){for(var r=0!==(1&e.mode);null!==$s;){var i=$s,a=i.child;if(22===i.tag&&r){var o=null!==i.memoizedState||Xs;if(!o){var s=i.alternate,c=null!==s&&null!==s.memoizedState||Ys;s=Xs;var l=Ys;if(Xs=o,(Ys=c)&&!l)for($s=i;null!==$s;)c=(o=$s).child,22===o.tag&&null!==o.memoizedState?xc(i):null!==c?(c.return=o,$s=c):xc(i);for(;null!==a;)$s=a,wc(a,t,n),a=a.sibling;$s=i,Xs=s,Ys=l}bc(e)}else 0!==(8772&i.subtreeFlags)&&null!==a?(a.return=i,$s=a):bc(e)}}function bc(e){for(;null!==$s;){var t=$s;if(0!==(8772&t.flags)){var n=t.alternate;try{if(0!==(8772&t.flags))switch(t.tag){case 0:case 11:case 15:Ys||rc(5,t);break;case 1:var r=t.stateNode;if(4&t.flags&&!Ys)if(null===n)r.componentDidMount();else{var i=t.elementType===t.type?n.memoizedProps:ns(t.type,n.memoizedProps);r.componentDidUpdate(i,n.memoizedState,r.__reactInternalSnapshotBeforeUpdate)}var o=t.updateQueue;null!==o&&qa(t,o,r);break;case 3:var s=t.updateQueue;if(null!==s){if(n=null,null!==t.child)switch(t.child.tag){case 5:case 1:n=t.child.stateNode}qa(t,s,n)}break;case 5:var c=t.stateNode;if(null===n&&4&t.flags){n=c;var l=t.memoizedProps;switch(t.type){case"button":case"input":case"select":case"textarea":l.autoFocus&&n.focus();break;case"img":l.src&&(n.src=l.src)}}break;case 6:case 4:case 12:case 19:case 17:case 21:case 22:case 23:case 25:break;case 13:if(null===t.memoizedState){var u=t.alternate;if(null!==u){var d=u.memoizedState;if(null!==d){var h=d.dehydrated;null!==h&&Vt(h)}}}break;default:throw Error(a(163))}Ys||512&t.flags&&ic(t)}catch(C_){Sl(t,t.return,C_)}}if(t===e){$s=null;break}if(null!==(n=t.sibling)){n.return=t.return,$s=n;break}$s=t.return}}function _c(e){for(;null!==$s;){var t=$s;if(t===e){$s=null;break}var n=t.sibling;if(null!==n){n.return=t.return,$s=n;break}$s=t.return}}function xc(e){for(;null!==$s;){var t=$s;try{switch(t.tag){case 0:case 11:case 15:var n=t.return;try{rc(4,t)}catch(c){Sl(t,n,c)}break;case 1:var r=t.stateNode;if("function"===typeof r.componentDidMount){var i=t.return;try{r.componentDidMount()}catch(c){Sl(t,i,c)}}var a=t.return;try{ic(t)}catch(c){Sl(t,a,c)}break;case 5:var o=t.return;try{ic(t)}catch(c){Sl(t,o,c)}}}catch(c){Sl(t,t.return,c)}if(t===e){$s=null;break}var s=t.sibling;if(null!==s){s.return=t.return,$s=s;break}$s=t.return}}var Ec,Sc=Math.ceil,kc=b.ReactCurrentDispatcher,Tc=b.ReactCurrentOwner,Ic=b.ReactCurrentBatchConfig,Cc=0,Ac=null,Oc=null,Nc=0,Rc=0,Pc=Si(0),Dc=0,zc=null,Mc=0,Lc=0,Uc=0,Bc=null,Fc=null,jc=0,Vc=1/0,qc=null,Hc=!1,Wc=null,Gc=null,Kc=!1,Qc=null,Xc=0,Yc=0,Jc=null,$c=-1,Zc=0;function el(){return 0!==(6&Cc)?Je():-1!==$c?$c:$c=Je()}function tl(e){return 0===(1&e.mode)?1:0!==(2&Cc)&&0!==Nc?Nc&-Nc:null!==ma.transition?(0===Zc&&(Zc=mt()),Zc):0!==(e=wt)?e:e=void 0===(e=window.event)?16:Yt(e.type)}function nl(e,t,n,r){if(50<Yc)throw Yc=0,Jc=null,Error(a(185));yt(e,n,r),0!==(2&Cc)&&e===Ac||(e===Ac&&(0===(2&Cc)&&(Lc|=n),4===Dc&&sl(e,Nc)),rl(e,r),1===n&&0===Cc&&0===(1&t.mode)&&(Vc=Je()+500,Bi&&Vi()))}function rl(e,t){var n=e.callbackNode;!function(e,t){for(var n=e.suspendedLanes,r=e.pingedLanes,i=e.expirationTimes,a=e.pendingLanes;0<a;){var o=31-ot(a),s=1<<o,c=i[o];-1===c?0!==(s&n)&&0===(s&r)||(i[o]=ft(s,t)):c<=t&&(e.expiredLanes|=s),a&=~s}}(e,t);var r=ht(e,e===Ac?Nc:0);if(0===r)null!==n&&Qe(n),e.callbackNode=null,e.callbackPriority=0;else if(t=r&-r,e.callbackPriority!==t){if(null!=n&&Qe(n),1===t)0===e.tag?function(e){Bi=!0,ji(e)}(cl.bind(null,e)):ji(cl.bind(null,e)),oi(function(){0===(6&Cc)&&Vi()}),n=null;else{switch(bt(r)){case 1:n=Ze;break;case 4:n=et;break;case 16:default:n=tt;break;case 536870912:n=rt}n=Al(n,il.bind(null,e))}e.callbackPriority=t,e.callbackNode=n}}function il(e,t){if($c=-1,Zc=0,0!==(6&Cc))throw Error(a(327));var n=e.callbackNode;if(xl()&&e.callbackNode!==n)return null;var r=ht(e,e===Ac?Nc:0);if(0===r)return null;if(0!==(30&r)||0!==(r&e.expiredLanes)||t)t=gl(e,r);else{t=r;var i=Cc;Cc|=2;var o=pl();for(Ac===e&&Nc===t||(qc=null,Vc=Je()+500,hl(e,t));;)try{vl();break}catch(c){fl(e,c)}Ta(),kc.current=o,Cc=i,null!==Oc?t=0:(Ac=null,Nc=0,t=Dc)}if(0!==t){if(2===t&&(0!==(i=pt(e))&&(r=i,t=al(e,i))),1===t)throw n=zc,hl(e,0),sl(e,r),rl(e,Je()),n;if(6===t)sl(e,r);else{if(i=e.current.alternate,0===(30&r)&&!function(e){for(var t=e;;){if(16384&t.flags){var n=t.updateQueue;if(null!==n&&null!==(n=n.stores))for(var r=0;r<n.length;r++){var i=n[r],a=i.getSnapshot;i=i.value;try{if(!sr(a(),i))return!1}catch(s){return!1}}}if(n=t.child,16384&t.subtreeFlags&&null!==n)n.return=t,t=n;else{if(t===e)break;for(;null===t.sibling;){if(null===t.return||t.return===e)return!0;t=t.return}t.sibling.return=t.return,t=t.sibling}}return!0}(i)&&(2===(t=gl(e,r))&&(0!==(o=pt(e))&&(r=o,t=al(e,o))),1===t))throw n=zc,hl(e,0),sl(e,r),rl(e,Je()),n;switch(e.finishedWork=i,e.finishedLanes=r,t){case 0:case 1:throw Error(a(345));case 2:case 5:_l(e,Fc,qc);break;case 3:if(sl(e,r),(130023424&r)===r&&10<(t=jc+500-Je())){if(0!==ht(e,0))break;if(((i=e.suspendedLanes)&r)!==r){el(),e.pingedLanes|=e.suspendedLanes&i;break}e.timeoutHandle=ri(_l.bind(null,e,Fc,qc),t);break}_l(e,Fc,qc);break;case 4:if(sl(e,r),(4194240&r)===r)break;for(t=e.eventTimes,i=-1;0<r;){var s=31-ot(r);o=1<<s,(s=t[s])>i&&(i=s),r&=~o}if(r=i,10<(r=(120>(r=Je()-r)?120:480>r?480:1080>r?1080:1920>r?1920:3e3>r?3e3:4320>r?4320:1960*Sc(r/1960))-r)){e.timeoutHandle=ri(_l.bind(null,e,Fc,qc),r);break}_l(e,Fc,qc);break;default:throw Error(a(329))}}}return rl(e,Je()),e.callbackNode===n?il.bind(null,e):null}function al(e,t){var n=Bc;return e.current.memoizedState.isDehydrated&&(hl(e,t).flags|=256),2!==(e=gl(e,t))&&(t=Fc,Fc=n,null!==t&&ol(t)),e}function ol(e){null===Fc?Fc=e:Fc.push.apply(Fc,e)}function sl(e,t){for(t&=~Uc,t&=~Lc,e.suspendedLanes|=t,e.pingedLanes&=~t,e=e.expirationTimes;0<t;){var n=31-ot(t),r=1<<n;e[n]=-1,t&=~r}}function cl(e){if(0!==(6&Cc))throw Error(a(327));xl();var t=ht(e,0);if(0===(1&t))return rl(e,Je()),null;var n=gl(e,t);if(0!==e.tag&&2===n){var r=pt(e);0!==r&&(t=r,n=al(e,r))}if(1===n)throw n=zc,hl(e,0),sl(e,t),rl(e,Je()),n;if(6===n)throw Error(a(345));return e.finishedWork=e.current.alternate,e.finishedLanes=t,_l(e,Fc,qc),rl(e,Je()),null}function ll(e,t){var n=Cc;Cc|=1;try{return e(t)}finally{0===(Cc=n)&&(Vc=Je()+500,Bi&&Vi())}}function ul(e){null!==Qc&&0===Qc.tag&&0===(6&Cc)&&xl();var t=Cc;Cc|=1;var n=Ic.transition,r=wt;try{if(Ic.transition=null,wt=1,e)return e()}finally{wt=r,Ic.transition=n,0===(6&(Cc=t))&&Vi()}}function dl(){Rc=Pc.current,ki(Pc)}function hl(e,t){e.finishedWork=null,e.finishedLanes=0;var n=e.timeoutHandle;if(-1!==n&&(e.timeoutHandle=-1,ii(n)),null!==Oc)for(n=Oc.return;null!==n;){var r=n;switch(ta(r),r.tag){case 1:null!==(r=r.type.childContextTypes)&&void 0!==r&&Pi();break;case 3:Ya(),ki(Ai),ki(Ci),no();break;case 5:$a(r);break;case 4:Ya();break;case 13:case 19:ki(Za);break;case 10:Ia(r.type._context);break;case 22:case 23:dl()}n=n.return}if(Ac=e,Oc=e=Pl(e.current,null),Nc=Rc=t,Dc=0,zc=null,Uc=Lc=Mc=0,Fc=Bc=null,null!==Na){for(t=0;t<Na.length;t++)if(null!==(r=(n=Na[t]).interleaved)){n.interleaved=null;var i=r.next,a=n.pending;if(null!==a){var o=a.next;a.next=i,r.next=o}n.pending=r}Na=null}return e}function fl(e,t){for(;;){var n=Oc;try{if(Ta(),ro.current=$o,lo){for(var r=oo.memoizedState;null!==r;){var i=r.queue;null!==i&&(i.pending=null),r=r.next}lo=!1}if(ao=0,co=so=oo=null,uo=!1,ho=0,Tc.current=null,null===n||null===n.return){Dc=1,zc=t,Oc=null;break}e:{var o=e,s=n.return,c=n,l=t;if(t=Nc,c.flags|=32768,null!==l&&"object"===typeof l&&"function"===typeof l.then){var u=l,d=c,h=d.tag;if(0===(1&d.mode)&&(0===h||11===h||15===h)){var f=d.alternate;f?(d.updateQueue=f.updateQueue,d.memoizedState=f.memoizedState,d.lanes=f.lanes):(d.updateQueue=null,d.memoizedState=null)}var p=gs(s);if(null!==p){p.flags&=-257,ys(p,s,c,0,t),1&p.mode&&ms(o,u,t),l=u;var m=(t=p).updateQueue;if(null===m){var g=new Set;g.add(l),t.updateQueue=g}else m.add(l);break e}if(0===(1&t)){ms(o,u,t),ml();break e}l=Error(a(426))}else if(ia&&1&c.mode){var y=gs(s);if(null!==y){0===(65536&y.flags)&&(y.flags|=256),ys(y,s,c,0,t),pa(ls(l,c));break e}}o=l=ls(l,c),4!==Dc&&(Dc=2),null===Bc?Bc=[o]:Bc.push(o),o=s;do{switch(o.tag){case 3:o.flags|=65536,t&=-t,o.lanes|=t,ja(o,fs(0,l,t));break e;case 1:c=l;var v=o.type,w=o.stateNode;if(0===(128&o.flags)&&("function"===typeof v.getDerivedStateFromError||null!==w&&"function"===typeof w.componentDidCatch&&(null===Gc||!Gc.has(w)))){o.flags|=65536,t&=-t,o.lanes|=t,ja(o,ps(o,c,t));break e}}o=o.return}while(null!==o)}bl(n)}catch(A){t=A,Oc===n&&null!==n&&(Oc=n=n.return);continue}break}}function pl(){var e=kc.current;return kc.current=$o,null===e?$o:e}function ml(){0!==Dc&&3!==Dc&&2!==Dc||(Dc=4),null===Ac||0===(268435455&Mc)&&0===(268435455&Lc)||sl(Ac,Nc)}function gl(e,t){var n=Cc;Cc|=2;var r=pl();for(Ac===e&&Nc===t||(qc=null,hl(e,t));;)try{yl();break}catch(S_){fl(e,S_)}if(Ta(),Cc=n,kc.current=r,null!==Oc)throw Error(a(261));return Ac=null,Nc=0,Dc}function yl(){for(;null!==Oc;)wl(Oc)}function vl(){for(;null!==Oc&&!Xe();)wl(Oc)}function wl(e){var t=Ec(e.alternate,e,Rc);e.memoizedProps=e.pendingProps,null===t?bl(e):Oc=t,Tc.current=null}function bl(e){var t=e;do{var n=t.alternate;if(e=t.return,0===(32768&t.flags)){if(null!==(n=Ks(n,t,Rc)))return void(Oc=n)}else{if(null!==(n=Qs(n,t)))return n.flags&=32767,void(Oc=n);if(null===e)return Dc=6,void(Oc=null);e.flags|=32768,e.subtreeFlags=0,e.deletions=null}if(null!==(t=t.sibling))return void(Oc=t);Oc=t=e}while(null!==t);0===Dc&&(Dc=5)}function _l(e,t,n){var r=wt,i=Ic.transition;try{Ic.transition=null,wt=1,function(e,t,n,r){do{xl()}while(null!==Qc);if(0!==(6&Cc))throw Error(a(327));n=e.finishedWork;var i=e.finishedLanes;if(null===n)return null;if(e.finishedWork=null,e.finishedLanes=0,n===e.current)throw Error(a(177));e.callbackNode=null,e.callbackPriority=0;var o=n.lanes|n.childLanes;if(function(e,t){var n=e.pendingLanes&~t;e.pendingLanes=t,e.suspendedLanes=0,e.pingedLanes=0,e.expiredLanes&=t,e.mutableReadLanes&=t,e.entangledLanes&=t,t=e.entanglements;var r=e.eventTimes;for(e=e.expirationTimes;0<n;){var i=31-ot(n),a=1<<i;t[i]=0,r[i]=-1,e[i]=-1,n&=~a}}(e,o),e===Ac&&(Oc=Ac=null,Nc=0),0===(2064&n.subtreeFlags)&&0===(2064&n.flags)||Kc||(Kc=!0,Al(tt,function(){return xl(),null})),o=0!==(15990&n.flags),0!==(15990&n.subtreeFlags)||o){o=Ic.transition,Ic.transition=null;var s=wt;wt=1;var c=Cc;Cc|=4,Tc.current=null,function(e,t){if(ei=Ht,fr(e=hr())){if("selectionStart"in e)var n={start:e.selectionStart,end:e.selectionEnd};else e:{var r=(n=(n=e.ownerDocument)&&n.defaultView||window).getSelection&&n.getSelection();if(r&&0!==r.rangeCount){n=r.anchorNode;var i=r.anchorOffset,o=r.focusNode;r=r.focusOffset;try{n.nodeType,o.nodeType}catch(_){n=null;break e}var s=0,c=-1,l=-1,u=0,d=0,h=e,f=null;t:for(;;){for(var p;h!==n||0!==i&&3!==h.nodeType||(c=s+i),h!==o||0!==r&&3!==h.nodeType||(l=s+r),3===h.nodeType&&(s+=h.nodeValue.length),null!==(p=h.firstChild);)f=h,h=p;for(;;){if(h===e)break t;if(f===n&&++u===i&&(c=s),f===o&&++d===r&&(l=s),null!==(p=h.nextSibling))break;f=(h=f).parentNode}h=p}n=-1===c||-1===l?null:{start:c,end:l}}else n=null}n=n||{start:0,end:0}}else n=null;for(ti={focusedElem:e,selectionRange:n},Ht=!1,$s=t;null!==$s;)if(e=(t=$s).child,0!==(1028&t.subtreeFlags)&&null!==e)e.return=t,$s=e;else for(;null!==$s;){t=$s;try{var m=t.alternate;if(0!==(1024&t.flags))switch(t.tag){case 0:case 11:case 15:case 5:case 6:case 4:case 17:break;case 1:if(null!==m){var g=m.memoizedProps,y=m.memoizedState,v=t.stateNode,w=v.getSnapshotBeforeUpdate(t.elementType===t.type?g:ns(t.type,g),y);v.__reactInternalSnapshotBeforeUpdate=w}break;case 3:var b=t.stateNode.containerInfo;1===b.nodeType?b.textContent="":9===b.nodeType&&b.documentElement&&b.removeChild(b.documentElement);break;default:throw Error(a(163))}}catch(_){Sl(t,t.return,_)}if(null!==(e=t.sibling)){e.return=t.return,$s=e;break}$s=t.return}m=tc,tc=!1}(e,n),gc(n,e),pr(ti),Ht=!!ei,ti=ei=null,e.current=n,vc(n,e,i),Ye(),Cc=c,wt=s,Ic.transition=o}else e.current=n;if(Kc&&(Kc=!1,Qc=e,Xc=i),o=e.pendingLanes,0===o&&(Gc=null),function(e){if(at&&"function"===typeof at.onCommitFiberRoot)try{at.onCommitFiberRoot(it,e,void 0,128===(128&e.current.flags))}catch(t){}}(n.stateNode),rl(e,Je()),null!==t)for(r=e.onRecoverableError,n=0;n<t.length;n++)i=t[n],r(i.value,{componentStack:i.stack,digest:i.digest});if(Hc)throw Hc=!1,e=Wc,Wc=null,e;0!==(1&Xc)&&0!==e.tag&&xl(),o=e.pendingLanes,0!==(1&o)?e===Jc?Yc++:(Yc=0,Jc=e):Yc=0,Vi()}(e,t,n,r)}finally{Ic.transition=i,wt=r}return null}function xl(){if(null!==Qc){var e=bt(Xc),t=Ic.transition,n=wt;try{if(Ic.transition=null,wt=16>e?16:e,null===Qc)var r=!1;else{if(e=Qc,Qc=null,Xc=0,0!==(6&Cc))throw Error(a(331));var i=Cc;for(Cc|=4,$s=e.current;null!==$s;){var o=$s,s=o.child;if(0!==(16&$s.flags)){var c=o.deletions;if(null!==c){for(var l=0;l<c.length;l++){var u=c[l];for($s=u;null!==$s;){var d=$s;switch(d.tag){case 0:case 11:case 15:nc(8,d,o)}var h=d.child;if(null!==h)h.return=d,$s=h;else for(;null!==$s;){var f=(d=$s).sibling,p=d.return;if(ac(d),d===u){$s=null;break}if(null!==f){f.return=p,$s=f;break}$s=p}}}var m=o.alternate;if(null!==m){var g=m.child;if(null!==g){m.child=null;do{var y=g.sibling;g.sibling=null,g=y}while(null!==g)}}$s=o}}if(0!==(2064&o.subtreeFlags)&&null!==s)s.return=o,$s=s;else e:for(;null!==$s;){if(0!==(2048&(o=$s).flags))switch(o.tag){case 0:case 11:case 15:nc(9,o,o.return)}var v=o.sibling;if(null!==v){v.return=o.return,$s=v;break e}$s=o.return}}var w=e.current;for($s=w;null!==$s;){var b=(s=$s).child;if(0!==(2064&s.subtreeFlags)&&null!==b)b.return=s,$s=b;else e:for(s=w;null!==$s;){if(0!==(2048&(c=$s).flags))try{switch(c.tag){case 0:case 11:case 15:rc(9,c)}}catch(A){Sl(c,c.return,A)}if(c===s){$s=null;break e}var _=c.sibling;if(null!==_){_.return=c.return,$s=_;break e}$s=c.return}}if(Cc=i,Vi(),at&&"function"===typeof at.onPostCommitFiberRoot)try{at.onPostCommitFiberRoot(it,e)}catch(A){}r=!0}return r}finally{wt=n,Ic.transition=t}}return!1}function El(e,t,n){e=Ba(e,t=fs(0,t=ls(n,t),1),1),t=el(),null!==e&&(yt(e,1,t),rl(e,t))}function Sl(e,t,n){if(3===e.tag)El(e,e,n);else for(;null!==t;){if(3===t.tag){El(t,e,n);break}if(1===t.tag){var r=t.stateNode;if("function"===typeof t.type.getDerivedStateFromError||"function"===typeof r.componentDidCatch&&(null===Gc||!Gc.has(r))){t=Ba(t,e=ps(t,e=ls(n,e),1),1),e=el(),null!==t&&(yt(t,1,e),rl(t,e));break}}t=t.return}}function kl(e,t,n){var r=e.pingCache;null!==r&&r.delete(t),t=el(),e.pingedLanes|=e.suspendedLanes&n,Ac===e&&(Nc&n)===n&&(4===Dc||3===Dc&&(130023424&Nc)===Nc&&500>Je()-jc?hl(e,0):Uc|=n),rl(e,t)}function Tl(e,t){0===t&&(0===(1&e.mode)?t=1:(t=ut,0===(130023424&(ut<<=1))&&(ut=4194304)));var n=el();null!==(e=Da(e,t))&&(yt(e,t,n),rl(e,n))}function Il(e){var t=e.memoizedState,n=0;null!==t&&(n=t.retryLane),Tl(e,n)}function Cl(e,t){var n=0;switch(e.tag){case 13:var r=e.stateNode,i=e.memoizedState;null!==i&&(n=i.retryLane);break;case 19:r=e.stateNode;break;default:throw Error(a(314))}null!==r&&r.delete(t),Tl(e,n)}function Al(e,t){return Ke(e,t)}function Ol(e,t,n,r){this.tag=e,this.key=n,this.sibling=this.child=this.return=this.stateNode=this.type=this.elementType=null,this.index=0,this.ref=null,this.pendingProps=t,this.dependencies=this.memoizedState=this.updateQueue=this.memoizedProps=null,this.mode=r,this.subtreeFlags=this.flags=0,this.deletions=null,this.childLanes=this.lanes=0,this.alternate=null}function Nl(e,t,n,r){return new Ol(e,t,n,r)}function Rl(e){return!(!(e=e.prototype)||!e.isReactComponent)}function Pl(e,t){var n=e.alternate;return null===n?((n=Nl(e.tag,t,e.key,e.mode)).elementType=e.elementType,n.type=e.type,n.stateNode=e.stateNode,n.alternate=e,e.alternate=n):(n.pendingProps=t,n.type=e.type,n.flags=0,n.subtreeFlags=0,n.deletions=null),n.flags=14680064&e.flags,n.childLanes=e.childLanes,n.lanes=e.lanes,n.child=e.child,n.memoizedProps=e.memoizedProps,n.memoizedState=e.memoizedState,n.updateQueue=e.updateQueue,t=e.dependencies,n.dependencies=null===t?null:{lanes:t.lanes,firstContext:t.firstContext},n.sibling=e.sibling,n.index=e.index,n.ref=e.ref,n}function Dl(e,t,n,r,i,o){var s=2;if(r=e,"function"===typeof e)Rl(e)&&(s=1);else if("string"===typeof e)s=5;else e:switch(e){case E:return zl(n.children,i,o,t);case S:s=8,i|=8;break;case k:return(e=Nl(12,n,t,2|i)).elementType=k,e.lanes=o,e;case O:return(e=Nl(13,n,t,i)).elementType=O,e.lanes=o,e;case N:return(e=Nl(19,n,t,i)).elementType=N,e.lanes=o,e;case D:return Ml(n,i,o,t);default:if("object"===typeof e&&null!==e)switch(e.$$typeof){case T:s=10;break e;case I:s=9;break e;case C:s=11;break e;case R:s=14;break e;case P:s=16,r=null;break e}throw Error(a(130,null==e?e:typeof e,""))}return(t=Nl(s,n,t,i)).elementType=e,t.type=r,t.lanes=o,t}function zl(e,t,n,r){return(e=Nl(7,e,r,t)).lanes=n,e}function Ml(e,t,n,r){return(e=Nl(22,e,r,t)).elementType=D,e.lanes=n,e.stateNode={isHidden:!1},e}function Ll(e,t,n){return(e=Nl(6,e,null,t)).lanes=n,e}function Ul(e,t,n){return(t=Nl(4,null!==e.children?e.children:[],e.key,t)).lanes=n,t.stateNode={containerInfo:e.containerInfo,pendingChildren:null,implementation:e.implementation},t}function Bl(e,t,n,r,i){this.tag=t,this.containerInfo=e,this.finishedWork=this.pingCache=this.current=this.pendingChildren=null,this.timeoutHandle=-1,this.callbackNode=this.pendingContext=this.context=null,this.callbackPriority=0,this.eventTimes=gt(0),this.expirationTimes=gt(-1),this.entangledLanes=this.finishedLanes=this.mutableReadLanes=this.expiredLanes=this.pingedLanes=this.suspendedLanes=this.pendingLanes=0,this.entanglements=gt(0),this.identifierPrefix=r,this.onRecoverableError=i,this.mutableSourceEagerHydrationData=null}function Fl(e,t,n,r,i,a,o,s,c){return e=new Bl(e,t,n,s,c),1===t?(t=1,!0===a&&(t|=8)):t=0,a=Nl(3,null,null,t),e.current=a,a.stateNode=e,a.memoizedState={element:r,isDehydrated:n,cache:null,transitions:null,pendingSuspenseBoundaries:null},Ma(a),e}function jl(e){if(!e)return Ii;e:{if(Ve(e=e._reactInternals)!==e||1!==e.tag)throw Error(a(170));var t=e;do{switch(t.tag){case 3:t=t.stateNode.context;break e;case 1:if(Ri(t.type)){t=t.stateNode.__reactInternalMemoizedMergedChildContext;break e}}t=t.return}while(null!==t);throw Error(a(171))}if(1===e.tag){var n=e.type;if(Ri(n))return zi(e,n,t)}return t}function Vl(e,t,n,r,i,a,o,s,c){return(e=Fl(n,r,!0,e,0,a,0,s,c)).context=jl(null),n=e.current,(a=Ua(r=el(),i=tl(n))).callback=void 0!==t&&null!==t?t:null,Ba(n,a,i),e.current.lanes=i,yt(e,i,r),rl(e,r),e}function ql(e,t,n,r){var i=t.current,a=el(),o=tl(i);return n=jl(n),null===t.context?t.context=n:t.pendingContext=n,(t=Ua(a,o)).payload={element:e},null!==(r=void 0===r?null:r)&&(t.callback=r),null!==(e=Ba(i,t,o))&&(nl(e,i,o,a),Fa(e,i,o)),o}function Hl(e){return(e=e.current).child?(e.child.tag,e.child.stateNode):null}function Wl(e,t){if(null!==(e=e.memoizedState)&&null!==e.dehydrated){var n=e.retryLane;e.retryLane=0!==n&&n<t?n:t}}function Gl(e,t){Wl(e,t),(e=e.alternate)&&Wl(e,t)}Ec=function(e,t,n){if(null!==e)if(e.memoizedProps!==t.pendingProps||Ai.current)ws=!0;else{if(0===(e.lanes&n)&&0===(128&t.flags))return ws=!1,function(e,t,n){switch(t.tag){case 3:As(t),fa();break;case 5:Ja(t);break;case 1:Ri(t.type)&&Mi(t);break;case 4:Xa(t,t.stateNode.containerInfo);break;case 10:var r=t.type._context,i=t.memoizedProps.value;Ti(xa,r._currentValue),r._currentValue=i;break;case 13:if(null!==(r=t.memoizedState))return null!==r.dehydrated?(Ti(Za,1&Za.current),t.flags|=128,null):0!==(n&t.child.childLanes)?Ls(e,t,n):(Ti(Za,1&Za.current),null!==(e=Hs(e,t,n))?e.sibling:null);Ti(Za,1&Za.current);break;case 19:if(r=0!==(n&t.childLanes),0!==(128&e.flags)){if(r)return Vs(e,t,n);t.flags|=128}if(null!==(i=t.memoizedState)&&(i.rendering=null,i.tail=null,i.lastEffect=null),Ti(Za,Za.current),r)break;return null;case 22:case 23:return t.lanes=0,Ss(e,t,n)}return Hs(e,t,n)}(e,t,n);ws=0!==(131072&e.flags)}else ws=!1,ia&&0!==(1048576&t.flags)&&Zi(t,Gi,t.index);switch(t.lanes=0,t.tag){case 2:var r=t.type;qs(e,t),e=t.pendingProps;var i=Ni(t,Ci.current);Aa(t,n),i=go(null,t,r,e,i,n);var o=yo();return t.flags|=1,"object"===typeof i&&null!==i&&"function"===typeof i.render&&void 0===i.$$typeof?(t.tag=1,t.memoizedState=null,t.updateQueue=null,Ri(r)?(o=!0,Mi(t)):o=!1,t.memoizedState=null!==i.state&&void 0!==i.state?i.state:null,Ma(t),i.updater=is,t.stateNode=i,i._reactInternals=t,cs(t,r,e,n),t=Cs(null,t,r,!0,o,n)):(t.tag=0,ia&&o&&ea(t),bs(null,t,i,n),t=t.child),t;case 16:r=t.elementType;e:{switch(qs(e,t),e=t.pendingProps,r=(i=r._init)(r._payload),t.type=r,i=t.tag=function(e){if("function"===typeof e)return Rl(e)?1:0;if(void 0!==e&&null!==e){if((e=e.$$typeof)===C)return 11;if(e===R)return 14}return 2}(r),e=ns(r,e),i){case 0:t=Ts(null,t,r,e,n);break e;case 1:t=Is(null,t,r,e,n);break e;case 11:t=_s(null,t,r,e,n);break e;case 14:t=xs(null,t,r,ns(r.type,e),n);break e}throw Error(a(306,r,""))}return t;case 0:return r=t.type,i=t.pendingProps,Ts(e,t,r,i=t.elementType===r?i:ns(r,i),n);case 1:return r=t.type,i=t.pendingProps,Is(e,t,r,i=t.elementType===r?i:ns(r,i),n);case 3:e:{if(As(t),null===e)throw Error(a(387));r=t.pendingProps,i=(o=t.memoizedState).element,La(e,t),Va(t,r,null,n);var s=t.memoizedState;if(r=s.element,o.isDehydrated){if(o={element:r,isDehydrated:!1,cache:s.cache,pendingSuspenseBoundaries:s.pendingSuspenseBoundaries,transitions:s.transitions},t.updateQueue.baseState=o,t.memoizedState=o,256&t.flags){t=Os(e,t,r,n,i=ls(Error(a(423)),t));break e}if(r!==i){t=Os(e,t,r,n,i=ls(Error(a(424)),t));break e}for(ra=li(t.stateNode.containerInfo.firstChild),na=t,ia=!0,aa=null,n=_a(t,null,r,n),t.child=n;n;)n.flags=-3&n.flags|4096,n=n.sibling}else{if(fa(),r===i){t=Hs(e,t,n);break e}bs(e,t,r,n)}t=t.child}return t;case 5:return Ja(t),null===e&&la(t),r=t.type,i=t.pendingProps,o=null!==e?e.memoizedProps:null,s=i.children,ni(r,i)?s=null:null!==o&&ni(r,o)&&(t.flags|=32),ks(e,t),bs(e,t,s,n),t.child;case 6:return null===e&&la(t),null;case 13:return Ls(e,t,n);case 4:return Xa(t,t.stateNode.containerInfo),r=t.pendingProps,null===e?t.child=ba(t,null,r,n):bs(e,t,r,n),t.child;case 11:return r=t.type,i=t.pendingProps,_s(e,t,r,i=t.elementType===r?i:ns(r,i),n);case 7:return bs(e,t,t.pendingProps,n),t.child;case 8:case 12:return bs(e,t,t.pendingProps.children,n),t.child;case 10:e:{if(r=t.type._context,i=t.pendingProps,o=t.memoizedProps,s=i.value,Ti(xa,r._currentValue),r._currentValue=s,null!==o)if(sr(o.value,s)){if(o.children===i.children&&!Ai.current){t=Hs(e,t,n);break e}}else for(null!==(o=t.child)&&(o.return=t);null!==o;){var c=o.dependencies;if(null!==c){s=o.child;for(var l=c.firstContext;null!==l;){if(l.context===r){if(1===o.tag){(l=Ua(-1,n&-n)).tag=2;var u=o.updateQueue;if(null!==u){var d=(u=u.shared).pending;null===d?l.next=l:(l.next=d.next,d.next=l),u.pending=l}}o.lanes|=n,null!==(l=o.alternate)&&(l.lanes|=n),Ca(o.return,n,t),c.lanes|=n;break}l=l.next}}else if(10===o.tag)s=o.type===t.type?null:o.child;else if(18===o.tag){if(null===(s=o.return))throw Error(a(341));s.lanes|=n,null!==(c=s.alternate)&&(c.lanes|=n),Ca(s,n,t),s=o.sibling}else s=o.child;if(null!==s)s.return=o;else for(s=o;null!==s;){if(s===t){s=null;break}if(null!==(o=s.sibling)){o.return=s.return,s=o;break}s=s.return}o=s}bs(e,t,i.children,n),t=t.child}return t;case 9:return i=t.type,r=t.pendingProps.children,Aa(t,n),r=r(i=Oa(i)),t.flags|=1,bs(e,t,r,n),t.child;case 14:return i=ns(r=t.type,t.pendingProps),xs(e,t,r,i=ns(r.type,i),n);case 15:return Es(e,t,t.type,t.pendingProps,n);case 17:return r=t.type,i=t.pendingProps,i=t.elementType===r?i:ns(r,i),qs(e,t),t.tag=1,Ri(r)?(e=!0,Mi(t)):e=!1,Aa(t,n),os(t,r,i),cs(t,r,i,n),Cs(null,t,r,!0,e,n);case 19:return Vs(e,t,n);case 22:return Ss(e,t,n)}throw Error(a(156,t.tag))};var Kl="function"===typeof reportError?reportError:function(e){console.error(e)};function Ql(e){this._internalRoot=e}function Xl(e){this._internalRoot=e}function Yl(e){return!(!e||1!==e.nodeType&&9!==e.nodeType&&11!==e.nodeType)}function Jl(e){return!(!e||1!==e.nodeType&&9!==e.nodeType&&11!==e.nodeType&&(8!==e.nodeType||" react-mount-point-unstable "!==e.nodeValue))}function $l(){}function Zl(e,t,n,r,i){var a=n._reactRootContainer;if(a){var o=a;if("function"===typeof i){var s=i;i=function(){var e=Hl(o);s.call(e)}}ql(t,o,e,i)}else o=function(e,t,n,r,i){if(i){if("function"===typeof r){var a=r;r=function(){var e=Hl(o);a.call(e)}}var o=Vl(t,r,e,0,null,!1,0,"",$l);return e._reactRootContainer=o,e[pi]=o.current,Vr(8===e.nodeType?e.parentNode:e),ul(),o}for(;i=e.lastChild;)e.removeChild(i);if("function"===typeof r){var s=r;r=function(){var e=Hl(c);s.call(e)}}var c=Fl(e,0,!1,null,0,!1,0,"",$l);return e._reactRootContainer=c,e[pi]=c.current,Vr(8===e.nodeType?e.parentNode:e),ul(function(){ql(t,c,n,r)}),c}(n,t,e,i,r);return Hl(o)}Xl.prototype.render=Ql.prototype.render=function(e){var t=this._internalRoot;if(null===t)throw Error(a(409));ql(e,t,null,null)},Xl.prototype.unmount=Ql.prototype.unmount=function(){var e=this._internalRoot;if(null!==e){this._internalRoot=null;var t=e.containerInfo;ul(function(){ql(null,e,null,null)}),t[pi]=null}},Xl.prototype.unstable_scheduleHydration=function(e){if(e){var t=St();e={blockedOn:null,target:e,priority:t};for(var n=0;n<Pt.length&&0!==t&&t<Pt[n].priority;n++);Pt.splice(n,0,e),0===n&&Lt(e)}},_t=function(e){switch(e.tag){case 3:var t=e.stateNode;if(t.current.memoizedState.isDehydrated){var n=dt(t.pendingLanes);0!==n&&(vt(t,1|n),rl(t,Je()),0===(6&Cc)&&(Vc=Je()+500,Vi()))}break;case 13:ul(function(){var t=Da(e,1);if(null!==t){var n=el();nl(t,e,1,n)}}),Gl(e,1)}},xt=function(e){if(13===e.tag){var t=Da(e,134217728);if(null!==t)nl(t,e,134217728,el());Gl(e,134217728)}},Et=function(e){if(13===e.tag){var t=tl(e),n=Da(e,t);if(null!==n)nl(n,e,t,el());Gl(e,t)}},St=function(){return wt},kt=function(e,t){var n=wt;try{return wt=e,t()}finally{wt=n}},xe=function(e,t,n){switch(t){case"input":if(Z(e,n),t=n.name,"radio"===n.type&&null!=t){for(n=e;n.parentNode;)n=n.parentNode;for(n=n.querySelectorAll("input[name="+JSON.stringify(""+t)+'][type="radio"]'),t=0;t<n.length;t++){var r=n[t];if(r!==e&&r.form===e.form){var i=_i(r);if(!i)throw Error(a(90));Q(r),Z(r,i)}}}break;case"textarea":oe(e,n);break;case"select":null!=(t=n.value)&&re(e,!!n.multiple,t,!1)}},Ce=ll,Ae=ul;var eu={usingClientEntryPoint:!1,Events:[wi,bi,_i,Te,Ie,ll]},tu={findFiberByHostInstance:vi,bundleType:0,version:"18.3.1",rendererPackageName:"react-dom"},nu={bundleType:tu.bundleType,version:tu.version,rendererPackageName:tu.rendererPackageName,rendererConfig:tu.rendererConfig,overrideHookState:null,overrideHookStateDeletePath:null,overrideHookStateRenamePath:null,overrideProps:null,overridePropsDeletePath:null,overridePropsRenamePath:null,setErrorHandler:null,setSuspenseHandler:null,scheduleUpdate:null,currentDispatcherRef:b.ReactCurrentDispatcher,findHostInstanceByFiber:function(e){return null===(e=We(e))?null:e.stateNode},findFiberByHostInstance:tu.findFiberByHostInstance||function(){return null},findHostInstancesForRefresh:null,scheduleRefresh:null,scheduleRoot:null,setRefreshHandler:null,getCurrentFiber:null,reconcilerVersion:"18.3.1-next-f1338f8080-20240426"};if("undefined"!==typeof __REACT_DEVTOOLS_GLOBAL_HOOK__){var ru=__REACT_DEVTOOLS_GLOBAL_HOOK__;if(!ru.isDisabled&&ru.supportsFiber)try{it=ru.inject(nu),at=ru}catch(N_){}}t.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=eu,t.createPortal=function(e,t){var n=2<arguments.length&&void 0!==arguments[2]?arguments[2]:null;if(!Yl(t))throw Error(a(200));return function(e,t,n){var r=3<arguments.length&&void 0!==arguments[3]?arguments[3]:null;return{$$typeof:x,key:null==r?null:""+r,children:e,containerInfo:t,implementation:n}}(e,t,null,n)},t.createRoot=function(e,t){if(!Yl(e))throw Error(a(299));var n=!1,r="",i=Kl;return null!==t&&void 0!==t&&(!0===t.unstable_strictMode&&(n=!0),void 0!==t.identifierPrefix&&(r=t.identifierPrefix),void 0!==t.onRecoverableError&&(i=t.onRecoverableError)),t=Fl(e,1,!1,null,0,n,0,r,i),e[pi]=t.current,Vr(8===e.nodeType?e.parentNode:e),new Ql(t)},t.findDOMNode=function(e){if(null==e)return null;if(1===e.nodeType)return e;var t=e._reactInternals;if(void 0===t){if("function"===typeof e.render)throw Error(a(188));throw e=Object.keys(e).join(","),Error(a(268,e))}return e=null===(e=We(t))?null:e.stateNode},t.flushSync=function(e){return ul(e)},t.hydrate=function(e,t,n){if(!Jl(t))throw Error(a(200));return Zl(null,e,t,!0,n)},t.hydrateRoot=function(e,t,n){if(!Yl(e))throw Error(a(405));var r=null!=n&&n.hydratedSources||null,i=!1,o="",s=Kl;if(null!==n&&void 0!==n&&(!0===n.unstable_strictMode&&(i=!0),void 0!==n.identifierPrefix&&(o=n.identifierPrefix),void 0!==n.onRecoverableError&&(s=n.onRecoverableError)),t=Vl(t,null,e,1,null!=n?n:null,i,0,o,s),e[pi]=t.current,Vr(e),r)for(e=0;e<r.length;e++)i=(i=(n=r[e])._getVersion)(n._source),null==t.mutableSourceEagerHydrationData?t.mutableSourceEagerHydrationData=[n,i]:t.mutableSourceEagerHydrationData.push(n,i);return new Xl(t)},t.render=function(e,t,n){if(!Jl(t))throw Error(a(200));return Zl(null,e,t,!1,n)},t.unmountComponentAtNode=function(e){if(!Jl(e))throw Error(a(40));return!!e._reactRootContainer&&(ul(function(){Zl(null,null,e,!1,function(){e._reactRootContainer=null,e[pi]=null})}),!0)},t.unstable_batchedUpdates=ll,t.unstable_renderSubtreeIntoContainer=function(e,t,n,r){if(!Jl(n))throw Error(a(200));if(null==e||void 0===e._reactInternals)throw Error(a(38));return Zl(e,t,n,!1,r)},t.version="18.3.1-next-f1338f8080-20240426"},853:(e,t,n)=>{e.exports=n(234)},950:(e,t,n)=>{!function e(){if("undefined"!==typeof __REACT_DEVTOOLS_GLOBAL_HOOK__&&"function"===typeof __REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE)try{__REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE(e)}catch(t){console.error(t)}}(),e.exports=n(730)}},t={};function n(r){var i=t[r];if(void 0!==i)return i.exports;var a=t[r]={exports:{}};return e[r](a,a.exports,n),a.exports}n.m=e,n.g=function(){if("object"===typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(S_){if("object"===typeof window)return window}}(),n.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),n.p="/reef-monitor-app/",n.b="undefined"!==typeof document&&document.baseURI||self.location.href;var r=n(43),i=n(950);function a(e){return a="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},a(e)}function o(e){var t=function(e,t){if("object"!=a(e)||!e)return e;var n=e[Symbol.toPrimitive];if(void 0!==n){var r=n.call(e,t||"default");if("object"!=a(r))return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"==a(t)?t:t+""}function s(e,t,n){return(t=o(t))in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function c(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),n.push.apply(n,r)}return n}function l(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?c(Object(n),!0).forEach(function(t){s(e,t,n[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):c(Object(n)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))})}return e}var u={xmlns:"http://www.w3.org/2000/svg",width:24,height:24,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:2,strokeLinecap:"round",strokeLinejoin:"round"};const d=["color","size","strokeWidth","absoluteStrokeWidth","children"];var h=(e,t)=>{const n=(0,r.forwardRef)((n,i)=>{let{color:a="currentColor",size:o=24,strokeWidth:s=2,absoluteStrokeWidth:c,children:h}=n,f=function(e,t){if(null==e)return{};var n,r,i=function(e,t){if(null==e)return{};var n={};for(var r in e)if({}.hasOwnProperty.call(e,r)){if(-1!==t.indexOf(r))continue;n[r]=e[r]}return n}(e,t);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);for(r=0;r<a.length;r++)n=a[r],-1===t.indexOf(n)&&{}.propertyIsEnumerable.call(e,n)&&(i[n]=e[n])}return i}(n,d);return(0,r.createElement)("svg",l(l({ref:i},u),{},{width:o,height:o,stroke:a,strokeWidth:c?24*Number(s)/Number(o):s,className:"lucide lucide-".concat((p=e,p.replace(/([a-z0-9])([A-Z])/g,"$1-$2").toLowerCase()))},f),[...t.map(e=>{let[t,n]=e;return(0,r.createElement)(t,n)}),...(Array.isArray(h)?h:[h])||[]]);var p});return n.displayName="".concat(e),n};const f=h("History",[["path",{d:"M3 12a9 9 0 1 0 9-9 9.75 9.75 0 0 0-6.74 2.74L3 8",key:"1357e3"}],["path",{d:"M3 3v5h5",key:"1xhq8a"}],["path",{d:"M12 7v5l4 2",key:"1fdv2h"}]]),p=h("Loader",[["line",{x1:"12",x2:"12",y1:"2",y2:"6",key:"gza1u7"}],["line",{x1:"12",x2:"12",y1:"18",y2:"22",key:"1qhbu9"}],["line",{x1:"4.93",x2:"7.76",y1:"4.93",y2:"7.76",key:"xae44r"}],["line",{x1:"16.24",x2:"19.07",y1:"16.24",y2:"19.07",key:"bxnmvf"}],["line",{x1:"2",x2:"6",y1:"12",y2:"12",key:"89khin"}],["line",{x1:"18",x2:"22",y1:"12",y2:"12",key:"pb8tfm"}],["line",{x1:"4.93",x2:"7.76",y1:"19.07",y2:"16.24",key:"1uxjnu"}],["line",{x1:"16.24",x2:"19.07",y1:"7.76",y2:"4.93",key:"6duxfx"}]]),m=h("Camera",[["path",{d:"M14.5 4h-5L7 7H4a2 2 0 0 0-2 2v9a2 2 0 0 0 2 2h16a2 2 0 0 0 2-2V9a2 2 0 0 0-2-2h-3l-2.5-3z",key:"1tc9qg"}],["circle",{cx:"12",cy:"13",r:"3",key:"1vg3eu"}]]),g=h("Upload",[["path",{d:"M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4",key:"ih7n3h"}],["polyline",{points:"17 8 12 3 7 8",key:"t8dd8p"}],["line",{x1:"12",x2:"12",y1:"3",y2:"15",key:"widbto"}]]),y=h("Info",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"M12 16v-4",key:"1dtifu"}],["path",{d:"M12 8h.01",key:"e9boi3"}]]),v=h("ChevronRight",[["path",{d:"m9 18 6-6-6-6",key:"mthhwq"}]]);var w,b,_,x,E,S,k,T,I,C,A,O,N,R,P,D,z,M,L,U,B,F,j,V,q,H,W,G,K,Q,X,Y,J,$=Object.defineProperty,Z=Object.getOwnPropertyDescriptor,ee=Object.getOwnPropertyNames,te=Object.prototype.hasOwnProperty,ne=(e=>typeof require<"u"?require:typeof Proxy<"u"?new Proxy(e,{get:(e,t)=>(typeof require<"u"?require:e)[t]}):e)(function(e){if(typeof require<"u")return require.apply(this,arguments);throw Error('Dynamic require of "'+e+'" is not supported')}),re=(e,t)=>()=>(e&&(t=e(e=0)),t),ie=(e,t)=>{for(var n in t)$(e,n,{get:t[n],enumerable:!0})},ae=e=>((e,t,n,r)=>{if(t&&"object"==typeof t||"function"==typeof t)for(let i of ee(t))!te.call(e,i)&&i!==n&&$(e,i,{get:()=>t[i],enumerable:!(r=Z(t,i))||r.enumerable});return e})($({},"__esModule",{value:!0}),e),oe=re(()=>{w=new Map,b=[],_=(e,t,n)=>{if(t&&"function"==typeof t.init&&"function"==typeof t.createInferenceSessionHandler){let r=w.get(e);if(void 0===r)w.set(e,{backend:t,priority:n});else{if(r.priority>n)return;if(r.priority===n&&r.backend!==t)throw new Error('cannot register backend "'.concat(e,'" using priority ').concat(n))}if(n>=0){let t=b.indexOf(e);-1!==t&&b.splice(t,1);for(let r=0;r<b.length;r++)if(w.get(b[r]).priority<=n)return void b.splice(r,0,e);b.push(e)}return}throw new TypeError("not a valid backend")},x=async e=>{let t=w.get(e);if(!t)return"backend not found.";if(t.initialized)return t.backend;if(t.aborted)return t.error;{let n=!!t.initPromise;try{return n||(t.initPromise=t.backend.init(e)),await t.initPromise,t.initialized=!0,t.backend}catch(C_){return n||(t.error="".concat(C_),t.aborted=!0),t.error}finally{delete t.initPromise}}},E=async e=>{let t,n=e.executionProviders||[],r=n.map(e=>"string"==typeof e?e:e.name),i=0===r.length?b:r,a=[],o=new Set;for(let c of i){let e=await x(c);"string"==typeof e?a.push({name:c,err:e}):(t||(t=e),t===e&&o.add(c))}if(!t)throw new Error("no available backend found. ERR: ".concat(a.map(e=>"[".concat(e.name,"] ").concat(e.err)).join(", ")));for(let{name:c,err:l}of a)r.includes(c)&&console.warn('removing requested execution provider "'.concat(c,'" from session options because it is not available: ').concat(l));let s=n.filter(e=>o.has("string"==typeof e?e:e.name));return[t,new Proxy(e,{get:(e,t)=>"executionProviders"===t?s:Reflect.get(e,t)})]}}),se=re(()=>{oe()}),ce=re(()=>{S="1.23.2"}),le=re(()=>{ce(),k="warning",T={wasm:{},webgl:{},webgpu:{},versions:{common:S},set logLevel(e){if(void 0!==e){if("string"!=typeof e||-1===["verbose","info","warning","error","fatal"].indexOf(e))throw new Error("Unsupported logging level: ".concat(e));k=e}},get logLevel(){return k}},Object.defineProperty(T,"logLevel",{enumerable:!0})}),ue=re(()=>{le(),I=T}),de=re(()=>{C=(e,t)=>{let n=typeof document<"u"?document.createElement("canvas"):new OffscreenCanvas(1,1);n.width=e.dims[3],n.height=e.dims[2];let r=n.getContext("2d");if(null!=r){let i,a;void 0!==(null===t||void 0===t?void 0:t.tensorLayout)&&"NHWC"===t.tensorLayout?(i=e.dims[2],a=e.dims[3]):(i=e.dims[3],a=e.dims[2]);let o,s,c=void 0!==(null===t||void 0===t?void 0:t.format)?t.format:"RGB",l=null===t||void 0===t?void 0:t.norm;void 0===l||void 0===l.mean?o=[255,255,255,255]:"number"==typeof l.mean?o=[l.mean,l.mean,l.mean,l.mean]:(o=[l.mean[0],l.mean[1],l.mean[2],0],void 0!==l.mean[3]&&(o[3]=l.mean[3])),void 0===l||void 0===l.bias?s=[0,0,0,0]:"number"==typeof l.bias?s=[l.bias,l.bias,l.bias,l.bias]:(s=[l.bias[0],l.bias[1],l.bias[2],0],void 0!==l.bias[3]&&(s[3]=l.bias[3]));let u=a*i,d=0,h=u,f=2*u,p=-1;"RGBA"===c?(d=0,h=u,f=2*u,p=3*u):"RGB"===c?(d=0,h=u,f=2*u):"RBG"===c&&(d=0,f=u,h=2*u);for(let t=0;t<a;t++)for(let n=0;n<i;n++){let i=(e.data[d++]-s[0])*o[0],a=(e.data[h++]-s[1])*o[1],c=(e.data[f++]-s[2])*o[2],l=-1===p?255:(e.data[p++]-s[3])*o[3];r.fillStyle="rgba("+i+","+a+","+c+","+l+")",r.fillRect(n,t,1,1)}if("toDataURL"in n)return n.toDataURL();throw new Error("toDataURL is not supported")}throw new Error("Can not access image data")},A=(e,t)=>{let n,r=typeof document<"u"?document.createElement("canvas").getContext("2d"):new OffscreenCanvas(1,1).getContext("2d");if(null==r)throw new Error("Can not access image data");{let i,a,o;void 0!==(null===t||void 0===t?void 0:t.tensorLayout)&&"NHWC"===t.tensorLayout?(i=e.dims[2],a=e.dims[1],o=e.dims[3]):(i=e.dims[3],a=e.dims[2],o=e.dims[1]);let s,c,l=void 0!==t&&void 0!==t.format?t.format:"RGB",u=null===t||void 0===t?void 0:t.norm;void 0===u||void 0===u.mean?s=[255,255,255,255]:"number"==typeof u.mean?s=[u.mean,u.mean,u.mean,u.mean]:(s=[u.mean[0],u.mean[1],u.mean[2],255],void 0!==u.mean[3]&&(s[3]=u.mean[3])),void 0===u||void 0===u.bias?c=[0,0,0,0]:"number"==typeof u.bias?c=[u.bias,u.bias,u.bias,u.bias]:(c=[u.bias[0],u.bias[1],u.bias[2],0],void 0!==u.bias[3]&&(c[3]=u.bias[3]));let d=a*i;if(void 0!==t&&(void 0!==t.format&&4===o&&"RGBA"!==t.format||3===o&&"RGB"!==t.format&&"BGR"!==t.format))throw new Error("Tensor format doesn't match input tensor dims");let h=4,f=0,p=1,m=2,g=3,y=0,v=d,w=2*d,b=-1;"RGBA"===l?(y=0,v=d,w=2*d,b=3*d):"RGB"===l?(y=0,v=d,w=2*d):"RBG"===l&&(y=0,w=d,v=2*d),n=r.createImageData(i,a);for(let t=0;t<a*i;f+=h,p+=h,m+=h,g+=h,t++)n.data[f]=(e.data[y++]-c[0])*s[0],n.data[p]=(e.data[v++]-c[1])*s[1],n.data[m]=(e.data[w++]-c[2])*s[2],n.data[g]=-1===b?255:(e.data[b++]-c[3])*s[3]}return n}}),he=re(()=>{me(),O=(e,t)=>{var n,r,i;if(void 0===e)throw new Error("Image buffer must be defined");if(void 0===t.height||void 0===t.width)throw new Error("Image height and width must be defined");if("NHWC"===t.tensorLayout)throw new Error("NHWC Tensor layout is not supported yet");let a,o,{height:s,width:c}=t,l=null!==(n=t.norm)&&void 0!==n?n:{mean:255,bias:0};a="number"==typeof l.mean?[l.mean,l.mean,l.mean,l.mean]:[l.mean[0],l.mean[1],l.mean[2],null!==(r=l.mean[3])&&void 0!==r?r:255],o="number"==typeof l.bias?[l.bias,l.bias,l.bias,l.bias]:[l.bias[0],l.bias[1],l.bias[2],null!==(i=l.bias[3])&&void 0!==i?i:0];let u=void 0!==t.format?t.format:"RGBA",d=void 0!==t.tensorFormat&&void 0!==t.tensorFormat?t.tensorFormat:"RGB",h=s*c,f="RGBA"===d?new Float32Array(4*h):new Float32Array(3*h),p=4,m=0,g=1,y=2,v=3,w=0,b=h,_=2*h,x=-1;"RGB"===u&&(p=3,m=0,g=1,y=2,v=-1),"RGBA"===d?x=3*h:"RBG"===d?(w=0,_=h,b=2*h):"BGR"===d&&(_=0,b=h,w=2*h);for(let E=0;E<h;E++,m+=p,y+=p,g+=p,v+=p)f[w++]=(e[m]+o[0])/a[0],f[b++]=(e[g]+o[1])/a[1],f[_++]=(e[y]+o[2])/a[2],-1!==x&&-1!==v&&(f[x++]=(e[v]+o[3])/a[3]);return new V("float32",f,"RGBA"===d?[1,4,s,c]:[1,3,s,c])},N=async(e,t)=>{let n,r=typeof HTMLImageElement<"u"&&e instanceof HTMLImageElement,i=typeof ImageData<"u"&&e instanceof ImageData,a=typeof ImageBitmap<"u"&&e instanceof ImageBitmap,o="string"==typeof e,s=null!==t&&void 0!==t?t:{},c=()=>{if(typeof document<"u")return document.createElement("canvas");if(typeof OffscreenCanvas<"u")return new OffscreenCanvas(1,1);throw new Error("Canvas is not supported")},l=e=>typeof HTMLCanvasElement<"u"&&e instanceof HTMLCanvasElement||e instanceof OffscreenCanvas?e.getContext("2d"):null;if(r){let r=c();r.width=e.width,r.height=e.height;let i=l(r);if(null==i)throw new Error("Can not access image data");{let r=e.height,a=e.width;if(void 0!==t&&void 0!==t.resizedHeight&&void 0!==t.resizedWidth&&(r=t.resizedHeight,a=t.resizedWidth),void 0!==t){if(s=t,void 0!==t.tensorFormat)throw new Error("Image input config format must be RGBA for HTMLImageElement");s.tensorFormat="RGBA",s.height=r,s.width=a}else s.tensorFormat="RGBA",s.height=r,s.width=a;i.drawImage(e,0,0),n=i.getImageData(0,0,a,r).data}}else{if(!i){if(a){if(void 0===t)throw new Error("Please provide image config with format for Imagebitmap");let r=c();r.width=e.width,r.height=e.height;let i=l(r);if(null!=i){let t=e.height,r=e.width;return i.drawImage(e,0,0,r,t),n=i.getImageData(0,0,r,t).data,s.height=t,s.width=r,O(n,s)}throw new Error("Can not access image data")}if(o)return new Promise((t,n)=>{let r=c(),i=l(r);if(!e||!i)return n();let a=new Image;a.crossOrigin="Anonymous",a.src=e,a.onload=()=>{r.width=a.width,r.height=a.height,i.drawImage(a,0,0,r.width,r.height);let e=i.getImageData(0,0,r.width,r.height);s.height=r.height,s.width=r.width,t(O(e.data,s))}});throw new Error("Input data provided is not supported - aborted tensor creation")}{let r,i;if(void 0!==t&&void 0!==t.resizedWidth&&void 0!==t.resizedHeight?(r=t.resizedHeight,i=t.resizedWidth):(r=e.height,i=e.width),void 0!==t&&(s=t),s.format="RGBA",s.height=r,s.width=i,void 0!==t){let t=c();t.width=i,t.height=r;let a=l(t);if(null==a)throw new Error("Can not access image data");a.putImageData(e,0,0),n=a.getImageData(0,0,i,r).data}else n=e.data}}if(void 0!==n)return O(n,s);throw new Error("Input data provided is not supported - aborted tensor creation")},R=(e,t)=>{let{width:n,height:r,download:i,dispose:a}=t;return new V({location:"texture",type:"float32",texture:e,dims:[1,r,n,4],download:i,dispose:a})},P=(e,t)=>{let{dataType:n,dims:r,download:i,dispose:a}=t;return new V({location:"gpu-buffer",type:null!==n&&void 0!==n?n:"float32",gpuBuffer:e,dims:r,download:i,dispose:a})},D=(e,t)=>{let{dataType:n,dims:r,download:i,dispose:a}=t;return new V({location:"ml-tensor",type:null!==n&&void 0!==n?n:"float32",mlTensor:e,dims:r,download:i,dispose:a})},z=(e,t,n)=>new V({location:"cpu-pinned",type:e,data:t,dims:null!==n&&void 0!==n?n:[t.length]})}),fe=re(()=>{M=new Map([["float32",Float32Array],["uint8",Uint8Array],["int8",Int8Array],["uint16",Uint16Array],["int16",Int16Array],["int32",Int32Array],["bool",Uint8Array],["float64",Float64Array],["uint32",Uint32Array],["int4",Uint8Array],["uint4",Uint8Array]]),L=new Map([[Float32Array,"float32"],[Uint8Array,"uint8"],[Int8Array,"int8"],[Uint16Array,"uint16"],[Int16Array,"int16"],[Int32Array,"int32"],[Float64Array,"float64"],[Uint32Array,"uint32"]]),U=!1,B=()=>{if(!U){U=!0;let e=typeof BigInt64Array<"u"&&BigInt64Array.from,t=typeof BigUint64Array<"u"&&BigUint64Array.from,n=globalThis.Float16Array,r=typeof n<"u"&&n.from;e&&(M.set("int64",BigInt64Array),L.set(BigInt64Array,"int64")),t&&(M.set("uint64",BigUint64Array),L.set(BigUint64Array,"uint64")),r?(M.set("float16",n),L.set(n,"float16")):M.set("float16",Uint16Array)}}}),pe=re(()=>{me(),F=e=>{let t=1;for(let n=0;n<e.length;n++){let r=e[n];if("number"!=typeof r||!Number.isSafeInteger(r))throw new TypeError("dims[".concat(n,"] must be an integer, got: ").concat(r));if(r<0)throw new RangeError("dims[".concat(n,"] must be a non-negative integer, got: ").concat(r));t*=r}return t},j=(e,t)=>{switch(e.location){case"cpu":return new V(e.type,e.data,t);case"cpu-pinned":return new V({location:"cpu-pinned",data:e.data,type:e.type,dims:t});case"texture":return new V({location:"texture",texture:e.texture,type:e.type,dims:t});case"gpu-buffer":return new V({location:"gpu-buffer",gpuBuffer:e.gpuBuffer,type:e.type,dims:t});case"ml-tensor":return new V({location:"ml-tensor",mlTensor:e.mlTensor,type:e.type,dims:t});default:throw new Error("tensorReshape: tensor location ".concat(e.location," is not supported"))}}}),me=re(()=>{de(),he(),fe(),pe(),V=class{constructor(e,t,n){let r,i;if(B(),"object"==typeof e&&"location"in e)switch(this.dataLocation=e.location,r=e.type,i=e.dims,e.location){case"cpu-pinned":{let t=M.get(r);if(!t)throw new TypeError('unsupported type "'.concat(r,'" to create tensor from pinned buffer'));if(!(e.data instanceof t))throw new TypeError("buffer should be of type ".concat(t.name));this.cpuData=e.data;break}case"texture":if("float32"!==r)throw new TypeError('unsupported type "'.concat(r,'" to create tensor from texture'));this.gpuTextureData=e.texture,this.downloader=e.download,this.disposer=e.dispose;break;case"gpu-buffer":if("float32"!==r&&"float16"!==r&&"int32"!==r&&"int64"!==r&&"uint32"!==r&&"uint8"!==r&&"bool"!==r&&"uint4"!==r&&"int4"!==r)throw new TypeError('unsupported type "'.concat(r,'" to create tensor from gpu buffer'));this.gpuBufferData=e.gpuBuffer,this.downloader=e.download,this.disposer=e.dispose;break;case"ml-tensor":if("float32"!==r&&"float16"!==r&&"int32"!==r&&"int64"!==r&&"uint32"!==r&&"uint64"!==r&&"int8"!==r&&"uint8"!==r&&"bool"!==r&&"uint4"!==r&&"int4"!==r)throw new TypeError('unsupported type "'.concat(r,'" to create tensor from MLTensor'));this.mlTensorData=e.mlTensor,this.downloader=e.download,this.disposer=e.dispose;break;default:throw new Error("Tensor constructor: unsupported location '".concat(this.dataLocation,"'"))}else{let a,o;if("string"==typeof e)if(r=e,o=n,"string"===e){if(!Array.isArray(t))throw new TypeError("A string tensor's data must be a string array.");a=t}else{let n=M.get(e);if(void 0===n)throw new TypeError("Unsupported tensor type: ".concat(e,"."));if(Array.isArray(t)){if("float16"===e&&n===Uint16Array||"uint4"===e||"int4"===e)throw new TypeError("Creating a ".concat(e," tensor from number array is not supported. Please use ").concat(n.name," as data."));a="uint64"===e||"int64"===e?n.from(t,BigInt):n.from(t)}else if(t instanceof n)a=t;else if(t instanceof Uint8ClampedArray){if("uint8"!==e)throw new TypeError("A Uint8ClampedArray tensor's data must be type of uint8");a=Uint8Array.from(t)}else{if(!("float16"===e&&t instanceof Uint16Array&&n!==Uint16Array))throw new TypeError("A ".concat(r," tensor's data must be type of ").concat(n));a=new globalThis.Float16Array(t.buffer,t.byteOffset,t.length)}}else if(o=t,Array.isArray(e)){if(0===e.length)throw new TypeError("Tensor type cannot be inferred from an empty array.");let t=typeof e[0];if("string"===t)r="string",a=e;else{if("boolean"!==t)throw new TypeError("Invalid element type of data array: ".concat(t,"."));r="bool",a=Uint8Array.from(e)}}else if(e instanceof Uint8ClampedArray)r="uint8",a=Uint8Array.from(e);else{let t=L.get(e.constructor);if(void 0===t)throw new TypeError("Unsupported type for tensor data: ".concat(e.constructor,"."));r=t,a=e}if(void 0===o)o=[a.length];else if(!Array.isArray(o))throw new TypeError("A tensor's dims must be a number array");i=o,this.cpuData=a,this.dataLocation="cpu"}let a=F(i);if(this.cpuData&&a!==this.cpuData.length&&("uint4"!==r&&"int4"!==r||Math.ceil(a/2)!==this.cpuData.length))throw new Error("Tensor's size(".concat(a,") does not match data length(").concat(this.cpuData.length,")."));this.type=r,this.dims=i,this.size=a}static async fromImage(e,t){return N(e,t)}static fromTexture(e,t){return R(e,t)}static fromGpuBuffer(e,t){return P(e,t)}static fromMLTensor(e,t){return D(e,t)}static fromPinnedBuffer(e,t,n){return z(e,t,n)}toDataURL(e){return C(this,e)}toImageData(e){return A(this,e)}get data(){if(this.ensureValid(),!this.cpuData)throw new Error("The data is not on CPU. Use `getData()` to download GPU data to CPU, or use `texture` or `gpuBuffer` property to access the GPU data directly.");return this.cpuData}get location(){return this.dataLocation}get texture(){if(this.ensureValid(),!this.gpuTextureData)throw new Error("The data is not stored as a WebGL texture.");return this.gpuTextureData}get gpuBuffer(){if(this.ensureValid(),!this.gpuBufferData)throw new Error("The data is not stored as a WebGPU buffer.");return this.gpuBufferData}get mlTensor(){if(this.ensureValid(),!this.mlTensorData)throw new Error("The data is not stored as a WebNN MLTensor.");return this.mlTensorData}async getData(e){switch(this.ensureValid(),this.dataLocation){case"cpu":case"cpu-pinned":return this.data;case"texture":case"gpu-buffer":case"ml-tensor":if(!this.downloader)throw new Error("The current tensor is not created with a specified data downloader.");if(this.isDownloading)throw new Error("The current tensor is being downloaded.");try{this.isDownloading=!0;let t=await this.downloader();return this.downloader=void 0,this.dataLocation="cpu",this.cpuData=t,e&&this.disposer&&(this.disposer(),this.disposer=void 0),t}finally{this.isDownloading=!1}default:throw new Error("cannot get data from location: ".concat(this.dataLocation))}}dispose(){if(this.isDownloading)throw new Error("The current tensor is being downloaded.");this.disposer&&(this.disposer(),this.disposer=void 0),this.cpuData=void 0,this.gpuTextureData=void 0,this.gpuBufferData=void 0,this.mlTensorData=void 0,this.downloader=void 0,this.isDownloading=void 0,this.dataLocation="none"}ensureValid(){if("none"===this.dataLocation)throw new Error("The tensor is disposed.")}reshape(e){if(this.ensureValid(),this.downloader||this.disposer)throw new Error("Cannot reshape a tensor that owns GPU resource.");return j(this,e)}}}),ge=re(()=>{me(),q=V}),ye=re(()=>{le(),H=(e,t)=>{(typeof T.trace>"u"?!T.wasm.trace:!T.trace)||console.timeStamp("".concat(e,"::ORT::").concat(t))},W=(e,t)=>{var n;let r=(null===(n=(new Error).stack)||void 0===n?void 0:n.split(/\r\n|\r|\n/g))||[],i=!1;for(let a=0;a<r.length;a++){if(i&&!r[a].includes("TRACE_FUNC")){let n="FUNC_".concat(e,"::").concat(r[a].trim().split(" ")[1]);return t&&(n+="::".concat(t)),void H("CPU",n)}r[a].includes("TRACE_FUNC")&&(i=!0)}},G=e=>{(typeof T.trace>"u"?!T.wasm.trace:!T.trace)||W("BEGIN",e)},K=e=>{(typeof T.trace>"u"?!T.wasm.trace:!T.trace)||W("END",e)},Q=e=>{(typeof T.trace>"u"?!T.wasm.trace:!T.trace)||console.time("ORT::".concat(e))},X=e=>{(typeof T.trace>"u"?!T.wasm.trace:!T.trace)||console.timeEnd("ORT::".concat(e))}}),ve=re(()=>{oe(),ge(),ye(),Y=class e{constructor(e){this.handler=e}async run(e,t,n){G(),Q("InferenceSession.run");let r={},i={};if("object"!=typeof e||null===e||e instanceof q||Array.isArray(e))throw new TypeError("'feeds' must be an object that use input names as keys and OnnxValue as corresponding values.");let a=!0;if("object"==typeof t){if(null===t)throw new TypeError("Unexpected argument[1]: cannot be null.");if(t instanceof q)throw new TypeError("'fetches' cannot be a Tensor");if(Array.isArray(t)){if(0===t.length)throw new TypeError("'fetches' cannot be an empty array.");a=!1;for(let e of t){if("string"!=typeof e)throw new TypeError("'fetches' must be a string array or an object.");if(-1===this.outputNames.indexOf(e))throw new RangeError("'fetches' contains invalid output name: ".concat(e,"."));r[e]=null}if("object"==typeof n&&null!==n)i=n;else if(typeof n<"u")throw new TypeError("'options' must be an object.")}else{let e=!1,o=Object.getOwnPropertyNames(t);for(let n of this.outputNames)if(-1!==o.indexOf(n)){let i=t[n];(null===i||i instanceof q)&&(e=!0,a=!1,r[n]=i)}if(e){if("object"==typeof n&&null!==n)i=n;else if(typeof n<"u")throw new TypeError("'options' must be an object.")}else i=t}}else if(typeof t<"u")throw new TypeError("Unexpected argument[1]: must be 'fetches' or 'options'.");for(let c of this.inputNames)if(typeof e[c]>"u")throw new Error("input '".concat(c,"' is missing in 'feeds'."));if(a)for(let c of this.outputNames)r[c]=null;let o=await this.handler.run(e,r,i),s={};for(let c in o)if(Object.hasOwnProperty.call(o,c)){let e=o[c];s[c]=e instanceof q?e:new q(e.type,e.data,e.dims)}return X("InferenceSession.run"),K(),s}async release(){return this.handler.dispose()}static async create(t,n,r,i){G(),Q("InferenceSession.create");let a,o={};if("string"==typeof t){if(a=t,"object"==typeof n&&null!==n)o=n;else if(typeof n<"u")throw new TypeError("'options' must be an object.")}else if(t instanceof Uint8Array){if(a=t,"object"==typeof n&&null!==n)o=n;else if(typeof n<"u")throw new TypeError("'options' must be an object.")}else{if(!(t instanceof ArrayBuffer||typeof SharedArrayBuffer<"u"&&t instanceof SharedArrayBuffer))throw new TypeError("Unexpected argument[0]: must be 'path' or 'buffer'.");{let e=t,s=0,c=t.byteLength;if("object"==typeof n&&null!==n)o=n;else if("number"==typeof n){if(s=n,!Number.isSafeInteger(s))throw new RangeError("'byteOffset' must be an integer.");if(s<0||s>=e.byteLength)throw new RangeError("'byteOffset' is out of range [0, ".concat(e.byteLength,")."));if(c=t.byteLength-s,"number"==typeof r){if(c=r,!Number.isSafeInteger(c))throw new RangeError("'byteLength' must be an integer.");if(c<=0||s+c>e.byteLength)throw new RangeError("'byteLength' is out of range (0, ".concat(e.byteLength-s,"]."));if("object"==typeof i&&null!==i)o=i;else if(typeof i<"u")throw new TypeError("'options' must be an object.")}else if(typeof r<"u")throw new TypeError("'byteLength' must be a number.")}else if(typeof n<"u")throw new TypeError("'options' must be an object.");a=new Uint8Array(e,s,c)}}let[s,c]=await E(o),l=await s.createInferenceSessionHandler(a,c);return X("InferenceSession.create"),K(),new e(l)}startProfiling(){this.handler.startProfiling()}endProfiling(){this.handler.endProfiling()}get inputNames(){return this.handler.inputNames}get outputNames(){return this.handler.outputNames}get inputMetadata(){return this.handler.inputMetadata}get outputMetadata(){return this.handler.outputMetadata}}}),we=re(()=>{ve(),J=Y}),be=re(()=>{}),_e=re(()=>{}),xe=re(()=>{}),Ee=re(()=>{}),Se={};ie(Se,{InferenceSession:()=>J,TRACE:()=>H,TRACE_EVENT_BEGIN:()=>Q,TRACE_EVENT_END:()=>X,TRACE_FUNC_BEGIN:()=>G,TRACE_FUNC_END:()=>K,Tensor:()=>q,env:()=>I,registerBackend:()=>_});var ke=re(()=>{se(),ue(),we(),ge(),be(),_e(),ye(),xe(),Ee()}),Te=re(()=>{}),Ie={};ie(Ie,{default:()=>Oe});var Ce,Ae,Oe,Ne=re(()=>{var e;kd(),wl(),vl(),Ce="ort-wasm-proxy-worker",(Ae=(null===(e=globalThis.self)||void 0===e?void 0:e.name)===Ce)&&(self.onmessage=e=>{let{type:t,in:n}=e.data;try{switch(t){case"init-wasm":nt(n.wasm).then(()=>{Wu(n).then(()=>{postMessage({type:t})},e=>{postMessage({type:t,err:e})})},e=>{postMessage({type:t,err:e})});break;case"init-ep":{let{epName:e,env:r}=n;Gu(r,e).then(()=>{postMessage({type:t})},e=>{postMessage({type:t,err:e})});break}case"copy-from":{let{buffer:e}=n,r=Yu(e);postMessage({type:t,out:r});break}case"create":{let{model:e,options:r}=n;Ju(e,r).then(e=>{postMessage({type:t,out:e})},e=>{postMessage({type:t,err:e})});break}case"release":$u(n),postMessage({type:t});break;case"run":{let{sessionId:e,inputIndices:r,inputs:i,outputIndices:a,options:o}=n;ed(e,r,i,a,new Array(a.length).fill(null),o).then(e=>{e.some(e=>"cpu"!==e[3])?postMessage({type:t,err:"Proxy does not support non-cpu tensor location."}):postMessage({type:t,out:e},nd([...i,...e]))},e=>{postMessage({type:t,err:e})});break}case"end-profiling":td(n),postMessage({type:t})}}catch(C_){postMessage({type:t,err:C_})}}),Oe=Ae?null:e=>new Worker(null!==e&&void 0!==e?e:Ue,{type:"module",name:Ce})}),Re={};ie(Re,{default:()=>De});var Pe,De,ze,Me,Le,Ue,Be,Fe,je,Ve,qe,He,We,Ge,Ke,Qe,Xe,Ye,Je,$e,Ze,et,tt,nt,rt,it,at,ot,st,ct,lt,ut,dt,ht,ft,pt,mt,gt,yt,vt,wt,bt,_t,xt,Et,St,kt,Tt,It,Ct,At,Ot,Nt,Rt,Pt,Dt,zt,Mt,Lt,Ut,Bt,Ft,jt,Vt,qt,Ht,Wt,Gt,Kt,Qt,Xt,Yt,Jt,$t,Zt,en,tn,nn,rn,an,on,sn,cn,ln,un,dn,hn,fn,pn,mn,gn,yn,vn,wn,bn,_n,xn,En,Sn,kn,Tn,In,Cn,An,On,Nn,Rn,Pn,Dn,zn,Mn,Ln,Un,Bn,Fn,jn,Vn,qn,Hn,Wn,Gn,Kn,Qn,Xn,Yn,Jn,$n,Zn,er,tr,nr,rr,ir,ar,or,sr,cr,lr,ur,dr,hr,fr,pr,mr,gr,yr,vr,wr,br,_r,xr,Er,Sr,kr,Tr,Ir,Cr,Ar,Or,Nr,Rr,Pr,Dr,zr,Mr,Lr,Ur,Br,Fr,jr,Vr,qr,Hr,Wr,Gr,Kr,Qr,Xr,Yr,Jr,$r,Zr,ei,ti,ni,ri,ii,ai,oi,si,ci,li,ui,di,hi,fi,pi,mi,gi,yi,vi,wi,bi,_i,xi,Ei,Si,ki,Ti,Ii,Ci,Ai,Oi,Ni,Ri,Pi,Di,zi,Mi,Li,Ui,Bi,Fi,ji,Vi,qi,Hi,Wi,Gi,Ki,Qi,Xi,Yi,Ji,$i,Zi,ea,ta,na,ra,ia,aa,oa,sa,ca,la,ua,da,ha,fa,pa,ma,ga,ya,va,wa,ba,_a,xa,Ea,Sa,ka,Ta,Ia,Ca,Aa,Oa,Na,Ra,Pa,Da,za,Ma,La,Ua,Ba,Fa,ja,Va,qa,Ha,Wa,Ga,Ka,Qa,Xa,Ya,Ja,$a,Za,eo,to,no,ro,io,ao,oo,so,co,lo,uo,ho,fo,po,mo,go,yo,vo,wo,bo,_o,xo,Eo,So,ko,To,Io,Co,Ao,Oo,No,Ro,Po,Do,zo,Mo,Lo,Uo,Bo,Fo,jo,Vo,qo,Ho,Wo,Go,Ko,Qo,Xo,Yo,Jo,$o,Zo,es,ts,ns,rs,is,as,os,ss,cs,ls,us,ds,hs,fs,ps,ms,gs,ys,vs,ws,bs,_s,xs,Es,Ss,ks,Ts,Is,Cs,As,Os,Ns,Rs,Ps,Ds,zs,Ms,Ls,Us,Bs,Fs,js,Vs,qs,Hs,Ws,Gs,Ks,Qs,Xs,Ys,Js,$s,Zs,ec,tc,nc,rc,ic,ac,oc,sc,cc,lc,uc,dc,hc,fc,pc,mc,gc,yc,vc,wc,bc,_c,xc,Ec,Sc,kc,Tc,Ic,Cc,Ac,Oc,Nc,Rc,Pc,Dc,zc,Mc,Lc,Uc,Bc,Fc,jc,Vc,qc,Hc,Wc,Gc,Kc,Qc,Xc,Yc,Jc,$c,Zc,el,tl,nl,rl,il,al,ol,sl,cl,ll,ul,dl,hl,fl,pl,ml,gl,yl=re(()=>{var e;Pe=async function(){var e,t;var r,i,a=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},o=new Promise((e,t)=>{r=e,i=t}),c="object"==typeof window,l=typeof WorkerGlobalScope<"u",u=l&&(null===(e=self.name)||void 0===e?void 0:e.startsWith("em-pthread"));a.mountExternalData=(e,t)=>{e.startsWith("./")&&(e=e.substring(2)),(a.Fb||(a.Fb=new Map)).set(e,t)},a.unmountExternalData=()=>{delete a.Fb};var d=null!==(t=globalThis.SharedArrayBuffer)&&void 0!==t?t:new WebAssembly.Memory({initial:0,maximum:0,qc:!0}).buffer.constructor;let h=e=>async function(){try{var t;if(a.Gb)throw Error("Session already started");let n=a.Gb={ec:arguments.length<=0?void 0:arguments[0],errors:[]},r=await e(...arguments);if(a.Gb!==n)throw Error("Session mismatch");null===(t=a.Kb)||void 0===t||t.flush();let i=n.errors;if(0<i.length){let e=await Promise.all(i);if(e=e.filter(e=>e),0<e.length)throw Error(e.join("\n"))}return r}finally{a.Gb=null}};a.jsepInit=(e,t)=>{if("webgpu"===e){[a.Kb,a.Vb,a.Zb,a.Lb,a.Yb,a.Ab,a.$b,a.bc,a.Wb,a.Xb,a.ac]=t;let e=a.Kb;a.jsepRegisterBuffer=(t,n,r,i)=>e.registerBuffer(t,n,r,i),a.jsepGetBuffer=t=>e.getBuffer(t),a.jsepCreateDownloader=(t,n,r)=>e.createDownloader(t,n,r),a.jsepOnCreateSession=t=>{e.onCreateSession(t)},a.jsepOnReleaseSession=t=>{e.onReleaseSession(t)},a.jsepOnRunStart=t=>e.onRunStart(t),a.cc=(t,n)=>{e.upload(t,n)}}else if("webnn"===e){let e=t[0];[a.oc,a.Ob,a.webnnEnsureTensor,a.Pb,a.webnnDownloadTensor,a.nc,a.webnnEnableTraceEvent]=t.slice(1),a.webnnReleaseTensorId=a.Ob,a.webnnUploadTensor=a.Pb,a.webnnRegisterMLContext=a.nc,a.webnnOnRunStart=t=>e.onRunStart(t),a.webnnOnRunEnd=e.onRunEnd.bind(e),a.webnnOnReleaseSession=t=>{e.onReleaseSession(t)},a.webnnCreateMLTensorDownloader=(t,n)=>e.createMLTensorDownloader(t,n),a.webnnRegisterMLTensor=(t,n,r,i)=>e.registerMLTensor(t,n,r,i),a.webnnCreateMLContext=t=>e.createMLContext(t),a.webnnRegisterMLConstant=(t,n,r,i,o,s)=>e.registerMLConstant(t,n,r,i,o,a.Fb,s),a.webnnRegisterGraphInput=e.registerGraphInput.bind(e),a.webnnIsGraphInput=e.isGraphInput.bind(e),a.webnnRegisterGraphOutput=e.registerGraphOutput.bind(e),a.webnnIsGraphOutput=e.isGraphOutput.bind(e),a.webnnCreateTemporaryTensor=e.createTemporaryTensor.bind(e),a.webnnIsGraphInputOutputTypeSupported=e.isGraphInputOutputTypeSupported.bind(e)}};let f=()=>{let e=(e,t,n)=>function(){for(var r,i,a=arguments.length,o=new Array(a),s=0;s<a;s++)o[s]=arguments[s];let c=Bt,l=null===(r=t)||void 0===r?void 0:r();o=e(...o);let u=null===(i=t)||void 0===i?void 0:i();return l!==u&&(e=u,n(l),t=n=null),Bt!=c?new Promise((e,t)=>{Wt={resolve:e,reject:t}}):o};(()=>{for(let t of["_OrtAppendExecutionProvider","_OrtCreateSession","_OrtRun","_OrtRunWithBinding","_OrtBindInput"])a[t]=e(a[t],()=>a[t],e=>a[t]=e)})(),void 0!==h&&(a._OrtRun=h(a._OrtRun),a._OrtRunWithBinding=h(a._OrtRunWithBinding)),f=void 0};a.asyncInit=()=>{var e;null===(e=f)||void 0===e||e()};var p,m,g=(e,t)=>{throw t},y="";if(c||l){try{y=new URL(".","file:///C:/reef-monitor/node_modules/onnxruntime-web/dist/ort.bundle.min.mjs").href}catch(Rr){}l&&(m=e=>{var t=new XMLHttpRequest;return t.open("GET",e,!1),t.responseType="arraybuffer",t.send(null),new Uint8Array(t.response)}),p=async e=>{if(U(e))return new Promise((t,n)=>{var r=new XMLHttpRequest;r.open("GET",e,!0),r.responseType="arraybuffer",r.onload=()=>{200==r.status||0==r.status&&r.response?t(r.response):n(r.status)},r.onerror=n,r.send(null)});var t=await fetch(e,{credentials:"same-origin"});if(t.ok)return t.arrayBuffer();throw Error(t.status+" : "+t.url)}}var v,w,b,_,x,E,S,k,T,I,C,A,O,N,R,P=console.log.bind(console),D=console.error.bind(console),z=P,M=D,L=!1,U=e=>e.startsWith("file://");function B(){return w.buffer!=x.buffer&&Q(),x}function F(){return w.buffer!=x.buffer&&Q(),E}function j(){return w.buffer!=x.buffer&&Q(),S}function V(){return w.buffer!=x.buffer&&Q(),k}function q(){return w.buffer!=x.buffer&&Q(),T}function H(){return w.buffer!=x.buffer&&Q(),I}function W(){return w.buffer!=x.buffer&&Q(),C}function G(){return w.buffer!=x.buffer&&Q(),N}if(u){let e=function(t){try{var n=t.data,r=n.Db;if("load"===r){let t=[];self.onmessage=e=>t.push(e),self.startWorker=()=>{postMessage({Db:"loaded"});for(let n of t)e(n);self.onmessage=e};for(let e of n.Sb)a[e]&&!a[e].proxy||(a[e]=function(){for(var t=arguments.length,n=new Array(t),r=0;r<t;r++)n[r]=arguments[r];postMessage({Db:"callHandler",Rb:e,args:n})},"print"==e&&(z=a[e]),"printErr"==e&&(M=a[e]));w=n.kc,Q(),R(n.lc)}else if("run"===r){we(n.Bb),gr(n.Bb,0,0,1,0,0),ge(),kt(n.Bb),K||(hr(),K=!0);try{be(n.hc,n.Jb)}catch(i){if("unwind"!=i)throw i}}else"setimmediate"!==n.target&&("checkMailbox"===r?K&&Tt():r&&(M("worker: received unknown command ".concat(r)),M(n)))}catch(i){throw yr(),i}};var K=!1;self.onunhandledrejection=e=>{throw e.reason||e},self.onmessage=e}function Q(){var e=w.buffer;a.HEAP8=x=new Int8Array(e),S=new Int16Array(e),a.HEAPU8=E=new Uint8Array(e),k=new Uint16Array(e),a.HEAP32=T=new Int32Array(e),a.HEAPU32=I=new Uint32Array(e),C=new Float32Array(e),N=new Float64Array(e),A=new BigInt64Array(e),O=new BigUint64Array(e)}function X(){u?startWorker(a):ur.Da()}var Y,J=0,$=null;function Z(){if(0==--J&&$){var e=$;$=null,e()}}function ee(e){throw M(e="Aborted("+e+")"),L=!0,e=new WebAssembly.RuntimeError(e+". Build with -sASSERTIONS for more info."),i(e),e}function te(){return{a:{L:lr,Aa:cr,b:xe,$:Se,A:Ce,pa:Ae,X:Oe,Z:Ne,qa:Re,na:Pe,ga:De,ma:ze,J:Me,Y:Le,V:Ue,oa:Be,W:Fe,va:Ve,E:Ye,Q:$e,O:ot,D:ct,v:lt,s:ut,P:ft,z:_t,R:xt,ja:Et,T:It,aa:At,M:Ot,F:Nt,ia:kt,sa:Rt,r:zt,Ca:Mt,w:Qt,o:Yt,m:Zt,c:tt,Ba:en,n:nn,j:on,u:sn,p:cn,f:ln,t:un,l:dn,e:hn,k:fn,h:pn,g:mn,d:gn,da:yn,ea:_n,fa:xn,ba:En,ca:Sn,N:In,xa:Cn,ua:Nn,i:Dn,C:zn,G:Mn,ta:An,x:Ln,ra:Un,U:Bn,q:Tn,y:Fn,K:jn,S:Vn,za:Gn,ya:Kn,ka:Jn,la:$n,_:ue,B:Zn,I:er,ha:tr,H:rr,a:w,wa:ce}}}class ne{constructor(e){s(this,"name","ExitStatus"),this.message="Program terminated with exit(".concat(e,")"),this.status=e}}var re=e=>{e.terminate(),e.onmessage=()=>{}},ie=[],ae=e=>{0==de.length&&(ve(),ye(de[0]));var t=de.pop();if(!t)return 6;he.push(t),pe[e.Bb]=t,t.Bb=e.Bb;var n={Db:"run",hc:e.fc,Jb:e.Jb,Bb:e.Bb};return t.postMessage(n,e.Nb),0},oe=0,se=function(e,t){for(var n=2*(arguments.length<=2?0:arguments.length-2),r=Tr(),i=kr(8*n),a=i>>>3,o=0;o<(arguments.length<=2?0:arguments.length-2);o++){var s=o+2<2||arguments.length<=o+2?void 0:arguments[o+2];"bigint"==typeof s?(A[a+2*o]=1n,A[a+2*o+1]=s):(A[a+2*o]=0n,G()[a+2*o+1>>>0]=s)}return e=vr(e,0,n,i,t),Sr(r),e};function ce(e){if(u)return se(0,1,e);if(_=e,!(0<oe)){for(var t of he)re(t);for(t of de)re(t);de=[],he=[],pe={},L=!0}g(0,new ne(e))}function le(e){if(u)return se(1,0,e);ue(e)}var ue=e=>{if(_=e,u)throw le(e),"unwind";ce(e)},de=[],he=[],fe=[],pe={},me=e=>{var t=e.Bb;delete pe[t],de.push(e),he.splice(he.indexOf(e),1),e.Bb=0,wr(t)};function ge(){fe.forEach(e=>e())}var ye=e=>new Promise(t=>{e.onmessage=n=>{var r=(n=n.data).Db;if(n.Hb&&n.Hb!=fr()){var i=pe[n.Hb];i?i.postMessage(n,n.Nb):M('Internal error! Worker sent a message "'.concat(r,'" to target pthread ').concat(n.Hb,", but that thread no longer exists!"))}else"checkMailbox"===r?Tt():"spawnThread"===r?ae(n):"cleanupThread"===r?me(pe[n.ic]):"loaded"===r?(e.loaded=!0,t(e)):"setimmediate"===n.target?e.postMessage(n):"callHandler"===r?a[n.Rb](...n.args):r&&M("worker sent an unknown command ".concat(r))},e.onerror=e=>{throw M("worker sent an error! ".concat(e.filename,":").concat(e.lineno,": ").concat(e.message)),e};var n,r=[];for(n of[])a.propertyIsEnumerable(n)&&r.push(n);e.postMessage({Db:"load",Sb:r,kc:w,lc:b})});function ve(){var e=new Worker(new URL(n(618),n.b),{type:"module",workerData:"em-pthread",name:"em-pthread"});de.push(e)}var we=e=>{Q();var t=H()[e+52>>>2>>>0];e=H()[e+56>>>2>>>0],Er(t,t-e),Sr(t)},be=(e,t)=>{oe=0,e=Ir(e,t),0<oe?_=e:br(e)};class _e{constructor(e){this.Ib=e-24}}function xe(e,t,n){var r=new _e(e>>>=0);throw t>>>=0,n>>>=0,H()[r.Ib+16>>>2>>>0]=0,H()[r.Ib+4>>>2>>>0]=t,H()[r.Ib+8>>>2>>>0]=n,e}function Ee(e,t,n,r){return u?se(2,1,e,t,n,r):Se(e,t,n,r)}function Se(e,t,n,r){if(e>>>=0,n>>>=0,r>>>=0,void 0===d)return 6;var i=[];return u&&0===i.length?Ee(e,t>>>=0,n,r):(e={fc:n,Bb:e,Jb:r,Nb:i},u?(e.Db="spawnThread",postMessage(e,i),0):ae(e))}var ke=typeof TextDecoder<"u"?new TextDecoder:void 0,Te=function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:NaN;var r=(t>>>=0)+n;for(n=t;e[n]&&!(n>=r);)++n;if(16<n-t&&e.buffer&&ke)return ke.decode(e.buffer instanceof ArrayBuffer?e.subarray(t,n):e.slice(t,n));for(r="";t<n;){var i=e[t++];if(128&i){var a=63&e[t++];if(192==(224&i))r+=String.fromCharCode((31&i)<<6|a);else{var o=63&e[t++];65536>(i=224==(240&i)?(15&i)<<12|a<<6|o:(7&i)<<18|a<<12|o<<6|63&e[t++])?r+=String.fromCharCode(i):(i-=65536,r+=String.fromCharCode(55296|i>>10,56320|1023&i))}}else r+=String.fromCharCode(i)}return r},Ie=(e,t)=>(e>>>=0)?Te(F(),e,t):"";function Ce(e,t,n){return u?se(3,1,e,t,n):0}function Ae(e,t){if(u)return se(4,1,e,t)}function Oe(e,t){if(u)return se(5,1,e,t)}function Ne(e,t,n){if(u)return se(6,1,e,t,n)}function Re(e,t,n){return u?se(7,1,e,t,n):0}function Pe(e,t){if(u)return se(8,1,e,t)}function De(e,t,n){if(u)return se(9,1,e,t,n)}function ze(e,t,n,r){if(u)return se(10,1,e,t,n,r)}function Me(e,t,n,r){if(u)return se(11,1,e,t,n,r)}function Le(e,t,n,r){if(u)return se(12,1,e,t,n,r)}function Ue(e){if(u)return se(13,1,e)}function Be(e,t){if(u)return se(14,1,e,t)}function Fe(e,t,n){if(u)return se(15,1,e,t,n)}var je,Ve=()=>ee(""),qe=e=>{for(var t="";F()[e>>>0];)t+=je[F()[e++>>>0]];return t},He={},We={},Ge={},Ke=a.BindingError=class extends Error{constructor(e){super(e),this.name="BindingError"}};function Qe(e,t){return function(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};var r=t.name;if(!e)throw new Ke('type "'.concat(r,'" must have a positive integer typeid pointer'));if(We.hasOwnProperty(e)){if(n.Tb)return;throw new Ke("Cannot register type '".concat(r,"' twice"))}We[e]=t,delete Ge[e],He.hasOwnProperty(e)&&(t=He[e],delete He[e],t.forEach(e=>e()))}(e,t,arguments.length>2&&void 0!==arguments[2]?arguments[2]:{})}var Xe=(e,t,n)=>{switch(t){case 1:return n?e=>B()[e>>>0]:e=>F()[e>>>0];case 2:return n?e=>j()[e>>>1>>>0]:e=>V()[e>>>1>>>0];case 4:return n?e=>q()[e>>>2>>>0]:e=>H()[e>>>2>>>0];case 8:return n?e=>A[e>>>3]:e=>O[e>>>3];default:throw new TypeError("invalid integer width (".concat(t,"): ").concat(e))}};function Ye(e,t,n){n>>>=0,Qe(e>>>=0,{name:t=qe(t>>>0),fromWireType:e=>e,toWireType:function(e,t){if("bigint"!=typeof t&&"number"!=typeof t)throw t=null===t?"null":"object"==(e=typeof t)||"array"===e||"function"===e?t.toString():""+t,new TypeError('Cannot convert "'.concat(t,'" to ').concat(this.name));return"number"==typeof t&&(t=BigInt(t)),t},Cb:Je,readValueFromPointer:Xe(t,n,-1==t.indexOf("u")),Eb:null})}var Je=8;function $e(e,t,n,r){Qe(e>>>=0,{name:t=qe(t>>>0),fromWireType:function(e){return!!e},toWireType:function(e,t){return t?n:r},Cb:Je,readValueFromPointer:function(e){return this.fromWireType(F()[e>>>0])},Eb:null})}var Ze=[],et=[];function tt(e){9<(e>>>=0)&&0==--et[e+1]&&(et[e]=void 0,Ze.push(e))}var nt=e=>{if(!e)throw new Ke("Cannot use deleted val. handle = ".concat(e));return et[e]},rt=e=>{switch(e){case void 0:return 2;case null:return 4;case!0:return 6;case!1:return 8;default:let t=Ze.pop()||et.length;return et[t]=e,et[t+1]=1,t}};function it(e){return this.fromWireType(H()[e>>>2>>>0])}var at={name:"emscripten::val",fromWireType:e=>{var t=nt(e);return tt(e),t},toWireType:(e,t)=>rt(t),Cb:Je,readValueFromPointer:it,Eb:null};function ot(e){return Qe(e>>>0,at)}var st=(e,t)=>{switch(t){case 4:return function(e){return this.fromWireType(W()[e>>>2>>>0])};case 8:return function(e){return this.fromWireType(G()[e>>>3>>>0])};default:throw new TypeError("invalid float width (".concat(t,"): ").concat(e))}};function ct(e,t,n){n>>>=0,Qe(e>>>=0,{name:t=qe(t>>>0),fromWireType:e=>e,toWireType:(e,t)=>t,Cb:Je,readValueFromPointer:st(t,n),Eb:null})}function lt(e,t,n,r,i){if(e>>>=0,n>>>=0,t=qe(t>>>0),-1===i&&(i=4294967295),i=e=>e,0===r){var a=32-8*n;i=e=>e<<a>>>a}var o=t.includes("unsigned")?function(e,t){return t>>>0}:function(e,t){return t};Qe(e,{name:t,fromWireType:i,toWireType:o,Cb:Je,readValueFromPointer:Xe(t,n,0!==r),Eb:null})}function ut(e,t,n){function r(e){var t=H()[e>>>2>>>0];return e=H()[e+4>>>2>>>0],new i(B().buffer,e,t)}var i=[Int8Array,Uint8Array,Int16Array,Uint16Array,Int32Array,Uint32Array,Float32Array,Float64Array,BigInt64Array,BigUint64Array][t];Qe(e>>>=0,{name:n=qe(n>>>0),fromWireType:r,Cb:Je,readValueFromPointer:r},{Tb:!0})}var dt=(e,t,n)=>{var r=F();if(t>>>=0,0<n){var i=t;n=t+n-1;for(var a=0;a<e.length;++a){var o=e.charCodeAt(a);if(55296<=o&&57343>=o&&(o=65536+((1023&o)<<10)|1023&e.charCodeAt(++a)),127>=o){if(t>=n)break;r[t++>>>0]=o}else{if(2047>=o){if(t+1>=n)break;r[t++>>>0]=192|o>>6}else{if(65535>=o){if(t+2>=n)break;r[t++>>>0]=224|o>>12}else{if(t+3>=n)break;r[t++>>>0]=240|o>>18,r[t++>>>0]=128|o>>12&63}r[t++>>>0]=128|o>>6&63}r[t++>>>0]=128|63&o}}r[t>>>0]=0,e=t-i}else e=0;return e},ht=e=>{for(var t=0,n=0;n<e.length;++n){var r=e.charCodeAt(n);127>=r?t++:2047>=r?t+=2:55296<=r&&57343>=r?(t+=4,++n):t+=3}return t};function ft(e,t){Qe(e>>>=0,{name:t=qe(t>>>0),fromWireType:function(e){for(var t,n=H()[e>>>2>>>0],r=e+4,i=r,a=0;a<=n;++a){var o=r+a;a!=n&&0!=F()[o>>>0]||(i=Ie(i,o-i),void 0===t?t=i:(t+="\0",t+=i),i=o+1)}return pr(e),t},toWireType:function(e,t){t instanceof ArrayBuffer&&(t=new Uint8Array(t));var n="string"==typeof t;if(!(n||ArrayBuffer.isView(t)&&1==t.BYTES_PER_ELEMENT))throw new Ke("Cannot pass non-string to std::string");var r=n?ht(t):t.length,i=mr(4+r+1),a=i+4;return H()[i>>>2>>>0]=r,n?dt(t,a,r+1):F().set(t,a>>>0),null!==e&&e.push(pr,i),i},Cb:Je,readValueFromPointer:it,Eb(e){pr(e)}})}var pt=typeof TextDecoder<"u"?new TextDecoder("utf-16le"):void 0,mt=(e,t)=>{for(var n=e>>1,r=n+t/2;!(n>=r)&&V()[n>>>0];)++n;if(32<(n<<=1)-e&&pt)return pt.decode(F().slice(e,n));for(n="",r=0;!(r>=t/2);++r){var i=j()[e+2*r>>>1>>>0];if(0==i)break;n+=String.fromCharCode(i)}return n},gt=(e,t,n)=>{if(null!==n&&void 0!==n||(n=2147483647),2>n)return 0;var r=t;n=(n-=2)<2*e.length?n/2:e.length;for(var i=0;i<n;++i){var a=e.charCodeAt(i);j()[t>>>1>>>0]=a,t+=2}return j()[t>>>1>>>0]=0,t-r},yt=e=>2*e.length,vt=(e,t)=>{for(var n=0,r="";!(n>=t/4);){var i=q()[e+4*n>>>2>>>0];if(0==i)break;++n,65536<=i?(i-=65536,r+=String.fromCharCode(55296|i>>10,56320|1023&i)):r+=String.fromCharCode(i)}return r},wt=(e,t,n)=>{if(null!==n&&void 0!==n||(n=2147483647),4>n)return 0;var r=t>>>=0;n=r+n-4;for(var i=0;i<e.length;++i){var a=e.charCodeAt(i);if(55296<=a&&57343>=a&&(a=65536+((1023&a)<<10)|1023&e.charCodeAt(++i)),q()[t>>>2>>>0]=a,(t+=4)+4>n)break}return q()[t>>>2>>>0]=0,t-r},bt=e=>{for(var t=0,n=0;n<e.length;++n){var r=e.charCodeAt(n);55296<=r&&57343>=r&&++n,t+=4}return t};function _t(e,t,n){if(e>>>=0,t>>>=0,n=qe(n>>>=0),2===t)var r=mt,i=gt,a=yt,o=e=>V()[e>>>1>>>0];else 4===t&&(r=vt,i=wt,a=bt,o=e=>H()[e>>>2>>>0]);Qe(e,{name:n,fromWireType:e=>{for(var n,i=H()[e>>>2>>>0],a=e+4,s=0;s<=i;++s){var c=e+4+s*t;s!=i&&0!=o(c)||(a=r(a,c-a),void 0===n?n=a:(n+="\0",n+=a),a=c+t)}return pr(e),n},toWireType:(e,r)=>{if("string"!=typeof r)throw new Ke("Cannot pass non-string to C++ string type ".concat(n));var o=a(r),s=mr(4+o+t);return H()[s>>>2>>>0]=o/t,i(r,s+4,o+t),null!==e&&e.push(pr,s),s},Cb:Je,readValueFromPointer:it,Eb(e){pr(e)}})}function xt(e,t){Qe(e>>>=0,{Ub:!0,name:t=qe(t>>>0),Cb:0,fromWireType:()=>{},toWireType:()=>{}})}function Et(e){gr(e>>>0,!l,1,!c,131072,!1),ge()}var St=e=>{if(!L)try{if(e(),!(0<oe))try{u?br(_):ue(_)}catch(t){t instanceof ne||"unwind"==t||g(0,t)}}catch(t){t instanceof ne||"unwind"==t||g(0,t)}};function kt(e){e>>>=0,"function"==typeof Atomics.jc&&(Atomics.jc(q(),e>>>2,e).value.then(Tt),e+=128,Atomics.store(q(),e>>>2,1))}var Tt=()=>{var e=fr();e&&(kt(e),St(xr))};function It(e,t){(e>>>=0)==t>>>0?setTimeout(Tt):u?postMessage({Hb:e,Db:"checkMailbox"}):(e=pe[e])&&e.postMessage({Db:"checkMailbox"})}var Ct=[];function At(e,t,n,r,i){for(t>>>=0,r/=2,Ct.length=r,n=i>>>0>>>3,i=0;i<r;i++)Ct[i]=A[n+2*i]?A[n+2*i+1]:G()[n+2*i+1>>>0];return(t?sr[t]:or[e])(...Ct)}var Ot=()=>{oe=0};function Nt(e){e>>>=0,u?postMessage({Db:"cleanupThread",ic:e}):me(pe[e])}function Rt(e){}var Pt=(e,t)=>{var n=We[e];if(void 0===n)throw e=dr(e),n=qe(e),pr(e),new Ke("".concat(t," has unknown type ").concat(n));return n},Dt=(e,t,n)=>{var r=[];return e=e.toWireType(r,n),r.length&&(H()[t>>>2>>>0]=rt(r)),e};function zt(e,t,n){return t>>>=0,n>>>=0,e=nt(e>>>0),t=Pt(t,"emval::as"),Dt(t,n,e)}function Mt(e,t){return t>>>=0,e=nt(e>>>0),(t=Pt(t,"emval::as")).toWireType(null,e)}var Lt=e=>{try{e()}catch(t){ee(t)}},Ut=0,Bt=null,Ft=0,jt=[],Vt={},qt={},Ht=0,Wt=null,Gt=[];function Kt(e){return function(){if(!L){if(0===Ut){var t=!1,n=!1;(t=>{e().then(t)})(function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;if(!L&&(Ft=e,t=!0,n)){Ut=2,Lt(()=>Or(Bt)),typeof MainLoop<"u"&&MainLoop.Qb&&MainLoop.resume(),e=!1;try{var r=function(){var e=q()[Bt+8>>>2>>>0];return e=ur[qt[e]],--oe,e()}()}catch(o){r=o,e=!0}var i=!1;if(!Bt){var a=Wt;a&&(Wt=null,(e?a.reject:a.resolve)(r),i=!0)}if(e&&!i)throw r}}),n=!0,t||(Ut=1,Bt=function(){var e=mr(65548),t=e+12;H()[e>>>2>>>0]=t,H()[e+4>>>2>>>0]=t+65536,t=jt[0];var n=Vt[t];return void 0===n&&(n=Ht++,Vt[t]=n,qt[n]=t),t=n,q()[e+8>>>2>>>0]=t,e}(),typeof MainLoop<"u"&&MainLoop.Qb&&MainLoop.pause(),Lt(()=>Cr(Bt)))}else 2===Ut?(Ut=0,Lt(Nr),pr(Bt),Bt=null,Gt.forEach(St)):ee("invalid state: ".concat(Ut));return Ft}}()}function Qt(e){return e>>>=0,Kt(async()=>{var t=await nt(e);return rt(t)})}var Xt=[];function Yt(e,t,n,r){return n>>>=0,r>>>=0,(e=Xt[e>>>0])(null,t=nt(t>>>0),n,r)}var Jt={},$t=e=>{var t=Jt[e];return void 0===t?qe(e):t};function Zt(e,t,n,r,i){return n>>>=0,r>>>=0,i>>>=0,(e=Xt[e>>>0])(t=nt(t>>>0),t[n=$t(n)],r,i)}function en(e,t){return t>>>=0,(e=nt(e>>>0))==nt(t)}var tn=()=>"object"==typeof globalThis?globalThis:Function("return this")();function nn(e){return 0==(e>>>=0)?rt(tn()):(e=$t(e),rt(tn()[e]))}var rn=e=>{var t=Xt.length;return Xt.push(e),t},an=(e,t)=>{for(var n=Array(e),r=0;r<e;++r)n[r]=Pt(H()[t+4*r>>>2>>>0],"parameter ".concat(r));return n};function on(e,t,n){var r=(t=an(e,t>>>0)).shift();e--;var i="return function (obj, func, destructorsRef, args) {\n",a=0,o=[];0===n&&o.push("obj");for(var s=["retType"],c=[r],l=0;l<e;++l)o.push("arg".concat(l)),s.push("argType".concat(l)),c.push(t[l]),i+="  var arg".concat(l," = argType").concat(l,".readValueFromPointer(args").concat(a?"+"+a:"",");\n"),a+=t[l].Cb;return i+="  var rv = ".concat(1===n?"new func":"func.call","(").concat(o.join(", "),");\n"),r.Ub||(s.push("emval_returnValue"),c.push(Dt),i+="  return emval_returnValue(retType, destructorsRef, rv);\n"),e=new Function(...s,i+"};\n")(...c),n="methodCaller<(".concat(t.map(e=>e.name).join(", "),") => ").concat(r.name,">"),rn(Object.defineProperty(e,"name",{value:n}))}function sn(e){return e=$t(e>>>0),rt(a[e])}function cn(e,t){return t>>>=0,e=nt(e>>>0),t=nt(t),rt(e[t])}function ln(e){9<(e>>>=0)&&(et[e+1]+=1)}function un(){return rt([])}function dn(e){e=nt(e>>>0);for(var t=Array(e.length),n=0;n<e.length;n++)t[n]=e[n];return rt(t)}function hn(e){return rt($t(e>>>0))}function fn(){return rt({})}function pn(e){for(var t=nt(e>>>=0);t.length;){var n=t.pop();t.pop()(n)}tt(e)}function mn(e,t,n){t>>>=0,n>>>=0,e=nt(e>>>0),t=nt(t),n=nt(n),e[t]=n}function gn(e,t){return t>>>=0,e=(e=Pt(e>>>0,"_emval_take_value")).readValueFromPointer(t),rt(e)}function yn(e,t){e=-9007199254740992>e||9007199254740992<e?NaN:Number(e),t>>>=0,e=new Date(1e3*e),q()[t>>>2>>>0]=e.getUTCSeconds(),q()[t+4>>>2>>>0]=e.getUTCMinutes(),q()[t+8>>>2>>>0]=e.getUTCHours(),q()[t+12>>>2>>>0]=e.getUTCDate(),q()[t+16>>>2>>>0]=e.getUTCMonth(),q()[t+20>>>2>>>0]=e.getUTCFullYear()-1900,q()[t+24>>>2>>>0]=e.getUTCDay(),e=(e.getTime()-Date.UTC(e.getUTCFullYear(),0,1,0,0,0,0))/864e5|0,q()[t+28>>>2>>>0]=e}var vn=e=>e%4==0&&(e%100!=0||e%400==0),wn=[0,31,60,91,121,152,182,213,244,274,305,335],bn=[0,31,59,90,120,151,181,212,243,273,304,334];function _n(e,t){e=-9007199254740992>e||9007199254740992<e?NaN:Number(e),t>>>=0,e=new Date(1e3*e),q()[t>>>2>>>0]=e.getSeconds(),q()[t+4>>>2>>>0]=e.getMinutes(),q()[t+8>>>2>>>0]=e.getHours(),q()[t+12>>>2>>>0]=e.getDate(),q()[t+16>>>2>>>0]=e.getMonth(),q()[t+20>>>2>>>0]=e.getFullYear()-1900,q()[t+24>>>2>>>0]=e.getDay();var n=(vn(e.getFullYear())?wn:bn)[e.getMonth()]+e.getDate()-1|0;q()[t+28>>>2>>>0]=n,q()[t+36>>>2>>>0]=-60*e.getTimezoneOffset(),n=new Date(e.getFullYear(),6,1).getTimezoneOffset();var r=new Date(e.getFullYear(),0,1).getTimezoneOffset();e=0|(n!=r&&e.getTimezoneOffset()==Math.min(r,n)),q()[t+32>>>2>>>0]=e}function xn(e){e>>>=0;var t=new Date(q()[e+20>>>2>>>0]+1900,q()[e+16>>>2>>>0],q()[e+12>>>2>>>0],q()[e+8>>>2>>>0],q()[e+4>>>2>>>0],q()[e>>>2>>>0],0),n=q()[e+32>>>2>>>0],r=t.getTimezoneOffset(),i=new Date(t.getFullYear(),6,1).getTimezoneOffset(),a=new Date(t.getFullYear(),0,1).getTimezoneOffset(),o=Math.min(a,i);return 0>n?q()[e+32>>>2>>>0]=+(i!=a&&o==r):0<n!=(o==r)&&(i=Math.max(a,i),t.setTime(t.getTime()+6e4*((0<n?o:i)-r))),q()[e+24>>>2>>>0]=t.getDay(),n=(vn(t.getFullYear())?wn:bn)[t.getMonth()]+t.getDate()-1|0,q()[e+28>>>2>>>0]=n,q()[e>>>2>>>0]=t.getSeconds(),q()[e+4>>>2>>>0]=t.getMinutes(),q()[e+8>>>2>>>0]=t.getHours(),q()[e+12>>>2>>>0]=t.getDate(),q()[e+16>>>2>>>0]=t.getMonth(),q()[e+20>>>2>>>0]=t.getYear(),e=t.getTime(),BigInt(isNaN(e)?-1:e/1e3)}function En(e,t,n,r,i,a,o){return u?se(16,1,e,t,n,r,i,a,o):-52}function Sn(e,t,n,r,i,a){if(u)return se(17,1,e,t,n,r,i,a)}var kn={},Tn=()=>performance.timeOrigin+performance.now();function In(e,t){if(u)return se(18,1,e,t);if(kn[e]&&(clearTimeout(kn[e].id),delete kn[e]),!t)return 0;var n=setTimeout(()=>{delete kn[e],St(()=>_r(e,performance.timeOrigin+performance.now()))},t);return kn[e]={id:n,rc:t},0}function Cn(e,t,n,r){e>>>=0,t>>>=0,n>>>=0,r>>>=0;var i=(new Date).getFullYear(),a=new Date(i,0,1).getTimezoneOffset();i=new Date(i,6,1).getTimezoneOffset();var o=Math.max(a,i);H()[e>>>2>>>0]=60*o,q()[t>>>2>>>0]=+(a!=i),e=(t=e=>{var t=Math.abs(e);return"UTC".concat(0<=e?"-":"+").concat(String(Math.floor(t/60)).padStart(2,"0")).concat(String(t%60).padStart(2,"0"))})(a),t=t(i),i<a?(dt(e,n,17),dt(t,r,17)):(dt(e,r,17),dt(t,n,17))}var An=()=>Date.now(),On=1;function Nn(e,t,n){if(!(0<=e&&3>=e))return 28;if(0===e)e=Date.now();else{if(!On)return 52;e=performance.timeOrigin+performance.now()}return A[n>>>0>>>3]=BigInt(Math.round(1e6*e)),0}var Rn=[],Pn=(e,t)=>{Rn.length=0;for(var n;n=F()[e++>>>0];){var r=105!=n;t+=(r&=112!=n)&&t%8?4:0,Rn.push(112==n?H()[t>>>2>>>0]:106==n?A[t>>>3]:105==n?q()[t>>>2>>>0]:G()[t>>>3>>>0]),t+=r?8:4}return Rn};function Dn(e,t,n){return e>>>=0,t=Pn(t>>>0,n>>>0),sr[e](...t)}function zn(e,t,n){return e>>>=0,t=Pn(t>>>0,n>>>0),sr[e](...t)}var Mn=()=>{};function Ln(e,t){return M(Ie(e>>>0,t>>>0))}var Un=()=>{throw oe+=1,"unwind"};function Bn(){return 4294901760}var Fn=()=>navigator.hardwareConcurrency;function jn(){return ee("Cannot use emscripten_pc_get_function without -sUSE_OFFSET_CONVERTER"),0}function Vn(e){e>>>=0;var t=F().length;if(e<=t||4294901760<e)return!1;for(var n=1;4>=n;n*=2){var r=t*(1+.2/n);r=Math.min(r,e+100663296);e:{r=(Math.min(4294901760,65536*Math.ceil(Math.max(e,r)/65536))-w.buffer.byteLength+65535)/65536|0;try{w.grow(r),Q();var i=1;break e}catch(a){}i=void 0}if(i)return!0}return!1}var qn=()=>(ee("Cannot use convertFrameToPC (needed by __builtin_return_address) without -sUSE_OFFSET_CONVERTER"),0),Hn={},Wn=e=>{e.forEach(e=>{var t=qn();t&&(Hn[t]=e)})};function Gn(){var e=Error().stack.toString().split("\n");return"Error"==e[0]&&e.shift(),Wn(e),Hn.Mb=qn(),Hn.dc=e,Hn.Mb}function Kn(e,t,n){if(e>>>=0,t>>>=0,Hn.Mb==e)var r=Hn.dc;else"Error"==(r=Error().stack.toString().split("\n"))[0]&&r.shift(),Wn(r);for(var i=3;r[i]&&qn()!=e;)++i;for(e=0;e<n&&r[e+i];++e)q()[t+4*e>>>2>>>0]=qn();return e}var Qn,Xn={},Yn=()=>{if(!Qn){var e,t={USER:"web_user",LOGNAME:"web_user",PATH:"/",PWD:"/",HOME:"/home/web_user",LANG:("object"==typeof navigator&&navigator.languages&&navigator.languages[0]||"C").replace("-","_")+".UTF-8",_:"./this.program"};for(e in Xn)void 0===Xn[e]?delete t[e]:t[e]=Xn[e];var n=[];for(e in t)n.push("".concat(e,"=").concat(t[e]));Qn=n}return Qn};function Jn(e,t){if(u)return se(19,1,e,t);e>>>=0,t>>>=0;var n,r=0,i=0;for(n of Yn()){var a=t+r;H()[e+i>>>2>>>0]=a,r+=dt(n,a,1/0)+1,i+=4}return 0}function $n(e,t){if(u)return se(20,1,e,t);e>>>=0,t>>>=0;var n=Yn();for(var r of(H()[e>>>2>>>0]=n.length,e=0,n))e+=ht(r)+1;return H()[t>>>2>>>0]=e,0}function Zn(e){return u?se(21,1,e):52}function er(e,t,n,r){return u?se(22,1,e,t,n,r):52}function tr(e,t,n,r){return u?se(23,1,e,t,n,r):70}var nr=[null,[],[]];function rr(e,t,n,r){if(u)return se(24,1,e,t,n,r);t>>>=0,n>>>=0,r>>>=0;for(var i=0,a=0;a<n;a++){var o=H()[t>>>2>>>0],s=H()[t+4>>>2>>>0];t+=8;for(var c=0;c<s;c++){var l=e,d=F()[o+c>>>0],h=nr[l];0===d||10===d?((1===l?z:M)(Te(h)),h.length=0):h.push(d)}i+=s}return H()[r>>>2>>>0]=i,0}u||function(){for(var e=a.numThreads-1;e--;)ve();ie.push(()=>{J++,function(e){u?e():Promise.all(de.map(ye)).then(e)}(()=>Z())})}();for(var ir=Array(256),ar=0;256>ar;++ar)ir[ar]=String.fromCharCode(ar);je=ir,et.push(0,1,void 0,1,null,1,!0,1,!1,1),a.count_emval_handles=()=>et.length/2-5-Ze.length,u||(w=new WebAssembly.Memory({initial:256,maximum:65536,shared:!0}),Q()),a.wasmBinary&&(v=a.wasmBinary),a.stackSave=()=>Tr(),a.stackRestore=e=>Sr(e),a.stackAlloc=e=>kr(e),a.setValue=function(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"i8";switch(n.endsWith("*")&&(n="*"),n){case"i1":case"i8":B()[e>>>0]=t;break;case"i16":j()[e>>>1>>>0]=t;break;case"i32":q()[e>>>2>>>0]=t;break;case"i64":A[e>>>3]=BigInt(t);break;case"float":W()[e>>>2>>>0]=t;break;case"double":G()[e>>>3>>>0]=t;break;case"*":H()[e>>>2>>>0]=t;break;default:ee("invalid type for setValue: ".concat(n))}},a.getValue=function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"i8";switch(t.endsWith("*")&&(t="*"),t){case"i1":case"i8":return B()[e>>>0];case"i16":return j()[e>>>1>>>0];case"i32":return q()[e>>>2>>>0];case"i64":return A[e>>>3];case"float":return W()[e>>>2>>>0];case"double":return G()[e>>>3>>>0];case"*":return H()[e>>>2>>>0];default:ee("invalid type for getValue: ".concat(t))}},a.UTF8ToString=Ie,a.stringToUTF8=dt,a.lengthBytesUTF8=ht;var or=[ce,le,Ee,Ce,Ae,Oe,Ne,Re,Pe,De,ze,Me,Le,Ue,Be,Fe,En,Sn,In,Jn,$n,Zn,er,tr,rr],sr={893836:(e,t,n,r,i)=>{if(void 0===a||!a.Fb)return 1;if((e=Ie(Number(e>>>0))).startsWith("./")&&(e=e.substring(2)),!(e=a.Fb.get(e)))return 2;if(t=Number(t>>>0),n=Number(n>>>0),r=Number(r>>>0),t+n>e.byteLength)return 3;try{let o=e.subarray(t,t+n);switch(i){case 0:F().set(o,r>>>0);break;case 1:a.mc?a.mc(r,o):a.cc(r,o);break;default:return 4}return 0}catch(o){return 4}},894660:(e,t,n)=>{a.Pb(e,F().subarray(t>>>0,t+n>>>0))},894724:()=>a.oc(),894766:e=>{a.Ob(e)},894803:()=>{a.Wb()},894834:()=>{a.Xb()},894863:()=>{a.ac()},894888:e=>a.Vb(e),894921:e=>a.Zb(e),894953:(e,t,n)=>{a.Lb(Number(e),Number(t),Number(n),!0)},895016:(e,t,n)=>{a.Lb(Number(e),Number(t),Number(n))},895073:()=>typeof wasmOffsetConverter<"u",895130:e=>{a.Ab("Abs",e,void 0)},895181:e=>{a.Ab("Neg",e,void 0)},895232:e=>{a.Ab("Floor",e,void 0)},895285:e=>{a.Ab("Ceil",e,void 0)},895337:e=>{a.Ab("Reciprocal",e,void 0)},895395:e=>{a.Ab("Sqrt",e,void 0)},895447:e=>{a.Ab("Exp",e,void 0)},895498:e=>{a.Ab("Erf",e,void 0)},895549:e=>{a.Ab("Sigmoid",e,void 0)},895604:(e,t,n)=>{a.Ab("HardSigmoid",e,{alpha:t,beta:n})},895683:e=>{a.Ab("Log",e,void 0)},895734:e=>{a.Ab("Sin",e,void 0)},895785:e=>{a.Ab("Cos",e,void 0)},895836:e=>{a.Ab("Tan",e,void 0)},895887:e=>{a.Ab("Asin",e,void 0)},895939:e=>{a.Ab("Acos",e,void 0)},895991:e=>{a.Ab("Atan",e,void 0)},896043:e=>{a.Ab("Sinh",e,void 0)},896095:e=>{a.Ab("Cosh",e,void 0)},896147:e=>{a.Ab("Asinh",e,void 0)},896200:e=>{a.Ab("Acosh",e,void 0)},896253:e=>{a.Ab("Atanh",e,void 0)},896306:e=>{a.Ab("Tanh",e,void 0)},896358:e=>{a.Ab("Not",e,void 0)},896409:(e,t,n)=>{a.Ab("Clip",e,{min:t,max:n})},896478:e=>{a.Ab("Clip",e,void 0)},896530:(e,t)=>{a.Ab("Elu",e,{alpha:t})},896588:e=>{a.Ab("Gelu",e,void 0)},896640:e=>{a.Ab("Relu",e,void 0)},896692:(e,t)=>{a.Ab("LeakyRelu",e,{alpha:t})},896756:(e,t)=>{a.Ab("ThresholdedRelu",e,{alpha:t})},896826:(e,t)=>{a.Ab("Cast",e,{to:t})},896884:e=>{a.Ab("Add",e,void 0)},896935:e=>{a.Ab("Sub",e,void 0)},896986:e=>{a.Ab("Mul",e,void 0)},897037:e=>{a.Ab("Div",e,void 0)},897088:e=>{a.Ab("Pow",e,void 0)},897139:e=>{a.Ab("Equal",e,void 0)},897192:e=>{a.Ab("Greater",e,void 0)},897247:e=>{a.Ab("GreaterOrEqual",e,void 0)},897309:e=>{a.Ab("Less",e,void 0)},897361:e=>{a.Ab("LessOrEqual",e,void 0)},897420:(e,t,n,r,i)=>{a.Ab("ReduceMean",e,{keepDims:!!t,noopWithEmptyAxes:!!n,axes:r?Array.from(q().subarray(Number(r)>>>0,Number(i)>>>0)):[]})},897595:(e,t,n,r,i)=>{a.Ab("ReduceMax",e,{keepDims:!!t,noopWithEmptyAxes:!!n,axes:r?Array.from(q().subarray(Number(r)>>>0,Number(i)>>>0)):[]})},897769:(e,t,n,r,i)=>{a.Ab("ReduceMin",e,{keepDims:!!t,noopWithEmptyAxes:!!n,axes:r?Array.from(q().subarray(Number(r)>>>0,Number(i)>>>0)):[]})},897943:(e,t,n,r,i)=>{a.Ab("ReduceProd",e,{keepDims:!!t,noopWithEmptyAxes:!!n,axes:r?Array.from(q().subarray(Number(r)>>>0,Number(i)>>>0)):[]})},898118:(e,t,n,r,i)=>{a.Ab("ReduceSum",e,{keepDims:!!t,noopWithEmptyAxes:!!n,axes:r?Array.from(q().subarray(Number(r)>>>0,Number(i)>>>0)):[]})},898292:(e,t,n,r,i)=>{a.Ab("ReduceL1",e,{keepDims:!!t,noopWithEmptyAxes:!!n,axes:r?Array.from(q().subarray(Number(r)>>>0,Number(i)>>>0)):[]})},898465:(e,t,n,r,i)=>{a.Ab("ReduceL2",e,{keepDims:!!t,noopWithEmptyAxes:!!n,axes:r?Array.from(q().subarray(Number(r)>>>0,Number(i)>>>0)):[]})},898638:(e,t,n,r,i)=>{a.Ab("ReduceLogSum",e,{keepDims:!!t,noopWithEmptyAxes:!!n,axes:r?Array.from(q().subarray(Number(r)>>>0,Number(i)>>>0)):[]})},898815:(e,t,n,r,i)=>{a.Ab("ReduceSumSquare",e,{keepDims:!!t,noopWithEmptyAxes:!!n,axes:r?Array.from(q().subarray(Number(r)>>>0,Number(i)>>>0)):[]})},898995:(e,t,n,r,i)=>{a.Ab("ReduceLogSumExp",e,{keepDims:!!t,noopWithEmptyAxes:!!n,axes:r?Array.from(q().subarray(Number(r)>>>0,Number(i)>>>0)):[]})},899175:e=>{a.Ab("Where",e,void 0)},899228:(e,t,n)=>{a.Ab("Transpose",e,{perm:t?Array.from(q().subarray(Number(t)>>>0,Number(n)>>>0)):[]})},899352:(e,t,n,r)=>{a.Ab("DepthToSpace",e,{blocksize:t,mode:Ie(n),format:r?"NHWC":"NCHW"})},899485:(e,t,n,r)=>{a.Ab("DepthToSpace",e,{blocksize:t,mode:Ie(n),format:r?"NHWC":"NCHW"})},899618:(e,t,n,r,i,o,s,c,l,u,d,h,f,p,m)=>{a.Ab("ConvTranspose",e,{format:l?"NHWC":"NCHW",autoPad:t,dilations:[n],group:r,kernelShape:[i],pads:[o,s],strides:[c],wIsConst:()=>!!B()[u>>>0],outputPadding:d?Array.from(q().subarray(Number(d)>>>0,Number(h)>>>0)):[],outputShape:f?Array.from(q().subarray(Number(f)>>>0,Number(p)>>>0)):[],activation:Ie(m)})},900051:(e,t,n,r,i,o,s,c,l,u,d,h,f,p)=>{a.Ab("ConvTranspose",e,{format:c?"NHWC":"NCHW",autoPad:t,dilations:Array.from(q().subarray(Number(n)>>>0,2+(Number(n)>>>0)>>>0)),group:r,kernelShape:Array.from(q().subarray(Number(i)>>>0,2+(Number(i)>>>0)>>>0)),pads:Array.from(q().subarray(Number(o)>>>0,4+(Number(o)>>>0)>>>0)),strides:Array.from(q().subarray(Number(s)>>>0,2+(Number(s)>>>0)>>>0)),wIsConst:()=>!!B()[l>>>0],outputPadding:u?Array.from(q().subarray(Number(u)>>>0,Number(d)>>>0)):[],outputShape:h?Array.from(q().subarray(Number(h)>>>0,Number(f)>>>0)):[],activation:Ie(p)})},900712:(e,t,n,r,i,o,s,c,l,u,d,h,f,p,m)=>{a.Ab("ConvTranspose",e,{format:l?"NHWC":"NCHW",autoPad:t,dilations:[n],group:r,kernelShape:[i],pads:[o,s],strides:[c],wIsConst:()=>!!B()[u>>>0],outputPadding:d?Array.from(q().subarray(Number(d)>>>0,Number(h)>>>0)):[],outputShape:f?Array.from(q().subarray(Number(f)>>>0,Number(p)>>>0)):[],activation:Ie(m)})},901145:(e,t,n,r,i,o,s,c,l,u,d,h,f,p)=>{a.Ab("ConvTranspose",e,{format:c?"NHWC":"NCHW",autoPad:t,dilations:Array.from(q().subarray(Number(n)>>>0,2+(Number(n)>>>0)>>>0)),group:r,kernelShape:Array.from(q().subarray(Number(i)>>>0,2+(Number(i)>>>0)>>>0)),pads:Array.from(q().subarray(Number(o)>>>0,4+(Number(o)>>>0)>>>0)),strides:Array.from(q().subarray(Number(s)>>>0,2+(Number(s)>>>0)>>>0)),wIsConst:()=>!!B()[l>>>0],outputPadding:u?Array.from(q().subarray(Number(u)>>>0,Number(d)>>>0)):[],outputShape:h?Array.from(q().subarray(Number(h)>>>0,Number(f)>>>0)):[],activation:Ie(p)})},901806:(e,t)=>{a.Ab("GlobalAveragePool",e,{format:t?"NHWC":"NCHW"})},901897:(e,t,n,r,i,o,s,c,l,u,d,h,f,p)=>{a.Ab("AveragePool",e,{format:p?"NHWC":"NCHW",auto_pad:t,ceil_mode:n,count_include_pad:r,storage_order:i,dilations:o?Array.from(q().subarray(Number(o)>>>0,Number(s)>>>0)):[],kernel_shape:c?Array.from(q().subarray(Number(c)>>>0,Number(l)>>>0)):[],pads:u?Array.from(q().subarray(Number(u)>>>0,Number(d)>>>0)):[],strides:h?Array.from(q().subarray(Number(h)>>>0,Number(f)>>>0)):[]})},902376:(e,t)=>{a.Ab("GlobalAveragePool",e,{format:t?"NHWC":"NCHW"})},902467:(e,t,n,r,i,o,s,c,l,u,d,h,f,p)=>{a.Ab("AveragePool",e,{format:p?"NHWC":"NCHW",auto_pad:t,ceil_mode:n,count_include_pad:r,storage_order:i,dilations:o?Array.from(q().subarray(Number(o)>>>0,Number(s)>>>0)):[],kernel_shape:c?Array.from(q().subarray(Number(c)>>>0,Number(l)>>>0)):[],pads:u?Array.from(q().subarray(Number(u)>>>0,Number(d)>>>0)):[],strides:h?Array.from(q().subarray(Number(h)>>>0,Number(f)>>>0)):[]})},902946:(e,t)=>{a.Ab("GlobalMaxPool",e,{format:t?"NHWC":"NCHW"})},903033:(e,t,n,r,i,o,s,c,l,u,d,h,f,p)=>{a.Ab("MaxPool",e,{format:p?"NHWC":"NCHW",auto_pad:t,ceil_mode:n,count_include_pad:r,storage_order:i,dilations:o?Array.from(q().subarray(Number(o)>>>0,Number(s)>>>0)):[],kernel_shape:c?Array.from(q().subarray(Number(c)>>>0,Number(l)>>>0)):[],pads:u?Array.from(q().subarray(Number(u)>>>0,Number(d)>>>0)):[],strides:h?Array.from(q().subarray(Number(h)>>>0,Number(f)>>>0)):[]})},903508:(e,t)=>{a.Ab("GlobalMaxPool",e,{format:t?"NHWC":"NCHW"})},903595:(e,t,n,r,i,o,s,c,l,u,d,h,f,p)=>{a.Ab("MaxPool",e,{format:p?"NHWC":"NCHW",auto_pad:t,ceil_mode:n,count_include_pad:r,storage_order:i,dilations:o?Array.from(q().subarray(Number(o)>>>0,Number(s)>>>0)):[],kernel_shape:c?Array.from(q().subarray(Number(c)>>>0,Number(l)>>>0)):[],pads:u?Array.from(q().subarray(Number(u)>>>0,Number(d)>>>0)):[],strides:h?Array.from(q().subarray(Number(h)>>>0,Number(f)>>>0)):[]})},904070:(e,t,n,r,i)=>{a.Ab("Gemm",e,{alpha:t,beta:n,transA:r,transB:i})},904174:e=>{a.Ab("MatMul",e,void 0)},904228:(e,t,n,r)=>{a.Ab("ArgMax",e,{keepDims:!!t,selectLastIndex:!!n,axis:r})},904336:(e,t,n,r)=>{a.Ab("ArgMin",e,{keepDims:!!t,selectLastIndex:!!n,axis:r})},904444:(e,t)=>{a.Ab("Softmax",e,{axis:t})},904507:(e,t)=>{a.Ab("Concat",e,{axis:t})},904567:(e,t,n,r,i)=>{a.Ab("Split",e,{axis:t,numOutputs:n,splitSizes:r?Array.from(q().subarray(Number(r)>>>0,Number(i)>>>0)):[]})},904723:e=>{a.Ab("Expand",e,void 0)},904777:(e,t)=>{a.Ab("Gather",e,{axis:Number(t)})},904848:(e,t)=>{a.Ab("GatherElements",e,{axis:Number(t)})},904927:(e,t)=>{a.Ab("GatherND",e,{batch_dims:Number(t)})},905006:(e,t,n,r,i,o,s,c,l,u,d)=>{a.Ab("Resize",e,{antialias:t,axes:n?Array.from(q().subarray(Number(n)>>>0,Number(r)>>>0)):[],coordinateTransformMode:Ie(i),cubicCoeffA:o,excludeOutside:s,extrapolationValue:c,keepAspectRatioPolicy:Ie(l),mode:Ie(u),nearestMode:Ie(d)})},905368:(e,t,n,r,i,o,s)=>{a.Ab("Slice",e,{starts:t?Array.from(q().subarray(Number(t)>>>0,Number(n)>>>0)):[],ends:r?Array.from(q().subarray(Number(r)>>>0,Number(i)>>>0)):[],axes:o?Array.from(q().subarray(Number(o)>>>0,Number(s)>>>0)):[]})},905632:e=>{a.Ab("Tile",e,void 0)},905684:(e,t,n)=>{a.Ab("InstanceNormalization",e,{epsilon:t,format:n?"NHWC":"NCHW"})},905798:(e,t,n)=>{a.Ab("InstanceNormalization",e,{epsilon:t,format:n?"NHWC":"NCHW"})},905912:e=>{a.Ab("Range",e,void 0)},905965:(e,t)=>{a.Ab("Einsum",e,{equation:Ie(t)})},906046:(e,t,n,r,i)=>{a.Ab("Pad",e,{mode:t,value:n,pads:r?Array.from(q().subarray(Number(r)>>>0,Number(i)>>>0)):[]})},906189:(e,t,n,r,i,o)=>{a.Ab("BatchNormalization",e,{epsilon:t,momentum:n,spatial:!!i,trainingMode:!!r,format:o?"NHWC":"NCHW"})},906358:(e,t,n,r,i,o)=>{a.Ab("BatchNormalization",e,{epsilon:t,momentum:n,spatial:!!i,trainingMode:!!r,format:o?"NHWC":"NCHW"})},906527:(e,t,n)=>{a.Ab("CumSum",e,{exclusive:Number(t),reverse:Number(n)})},906624:(e,t,n)=>{a.Ab("DequantizeLinear",e,{axis:t,blockSize:n})},906714:(e,t,n,r,i)=>{a.Ab("GridSample",e,{align_corners:t,mode:Ie(n),padding_mode:Ie(r),format:i?"NHWC":"NCHW"})},906884:(e,t,n,r,i)=>{a.Ab("GridSample",e,{align_corners:t,mode:Ie(n),padding_mode:Ie(r),format:i?"NHWC":"NCHW"})},907054:(e,t)=>{a.Ab("ScatterND",e,{reduction:Ie(t)})},907139:(e,t,n,r,i,o,s,c,l)=>{a.Ab("Attention",e,{numHeads:t,isUnidirectional:n,maskFilterValue:r,scale:i,doRotary:o,qkvHiddenSizes:s?Array.from(q().subarray(Number(c)>>>0,Number(c)+s>>>0)):[],pastPresentShareBuffer:!!l})},907411:e=>{a.Ab("BiasAdd",e,void 0)},907466:e=>{a.Ab("BiasSplitGelu",e,void 0)},907527:e=>{a.Ab("FastGelu",e,void 0)},907583:(e,t,n,r,i,o,s,c,l,u,d,h,f,p,m,g)=>{a.Ab("Conv",e,{format:h?"NHWC":"NCHW",auto_pad:t,dilations:n?Array.from(q().subarray(Number(n)>>>0,Number(r)>>>0)):[],group:i,kernel_shape:o?Array.from(q().subarray(Number(o)>>>0,Number(s)>>>0)):[],pads:c?Array.from(q().subarray(Number(c)>>>0,Number(l)>>>0)):[],strides:u?Array.from(q().subarray(Number(u)>>>0,Number(d)>>>0)):[],w_is_const:()=>!!B()[Number(f)>>>0],activation:Ie(p),activation_params:m?Array.from(W().subarray(Number(m)>>>0,Number(g)>>>0)):[]})},908167:e=>{a.Ab("Gelu",e,void 0)},908219:(e,t,n,r,i,o,s,c,l)=>{a.Ab("GroupQueryAttention",e,{numHeads:t,kvNumHeads:n,scale:r,softcap:i,doRotary:o,rotaryInterleaved:s,smoothSoftmax:c,localWindowSize:l})},908436:(e,t,n,r)=>{a.Ab("LayerNormalization",e,{axis:t,epsilon:n,simplified:!!r})},908547:(e,t,n,r)=>{a.Ab("LayerNormalization",e,{axis:t,epsilon:n,simplified:!!r})},908658:(e,t,n,r,i,o)=>{a.Ab("MatMulNBits",e,{k:t,n:n,accuracyLevel:r,bits:i,blockSize:o})},908785:(e,t,n,r,i,o)=>{a.Ab("MultiHeadAttention",e,{numHeads:t,isUnidirectional:n,maskFilterValue:r,scale:i,doRotary:o})},908944:(e,t)=>{a.Ab("QuickGelu",e,{alpha:t})},909008:(e,t,n,r,i)=>{a.Ab("RotaryEmbedding",e,{interleaved:!!t,numHeads:n,rotaryEmbeddingDim:r,scale:i})},909147:(e,t,n)=>{a.Ab("SkipLayerNormalization",e,{epsilon:t,simplified:!!n})},909249:(e,t,n)=>{a.Ab("SkipLayerNormalization",e,{epsilon:t,simplified:!!n})},909351:(e,t,n,r)=>{a.Ab("GatherBlockQuantized",e,{gatherAxis:t,quantizeAxis:n,blockSize:r})},909472:e=>{a.$b(e)},909506:(e,t)=>a.bc(Number(e),Number(t),a.Gb.ec,a.Gb.errors)};function cr(e,t,n){return Kt(async()=>{await a.Yb(Number(e),Number(t),Number(n))})}function lr(){return typeof wasmOffsetConverter<"u"}var ur=await async function(){function e(e,t){return ur=e.exports,ur=function(){var e=ur,t={};for(let[n,r]of Object.entries(e))t[n]="function"==typeof r?function(){jt.push(n);try{return r(...arguments)}finally{L||(jt.pop(),Bt&&1===Ut&&0===jt.length&&(Ut=0,oe+=1,Lt(Ar),typeof Fibers<"u"&&Fibers.sc()))}}:r;return t}(),ur=function(){var e=ur,t=e=>t=>e(t)>>>0,n=e=>()=>e()>>>0;return(e=Object.assign({},e)).Ea=t(e.Ea),e.gb=n(e.gb),e.ib=t(e.ib),e.tb=t(e.tb),e.ub=n(e.ub),e.__cxa_get_exception_ptr=t(e.__cxa_get_exception_ptr),e}(),fe.push(ur.jb),b=t,Z(),ur}J++;var t=te();if(a.instantiateWasm)return new Promise(n=>{a.instantiateWasm(t,(t,r)=>{n(e(t,r))})});if(u)return new Promise(t=>{R=n=>{var r=new WebAssembly.Instance(n,te());t(e(r,n))}});null!==Y&&void 0!==Y||(Y=a.locateFile?a.locateFile?a.locateFile("ort-wasm-simd-threaded.jsep.wasm",y):y+"ort-wasm-simd-threaded.jsep.wasm":new URL(n(98),n.b).href);try{var r=await async function(e){var t=Y;if(!v&&"function"==typeof WebAssembly.instantiateStreaming&&!U(t))try{var n=fetch(t,{credentials:"same-origin"});return await WebAssembly.instantiateStreaming(n,e)}catch(r){M("wasm streaming compile failed: ".concat(r)),M("falling back to ArrayBuffer instantiation")}return async function(e,t){try{var n=await async function(e){if(!v)try{var t=await p(e);return new Uint8Array(t)}catch(n){}if(e==Y&&v)e=new Uint8Array(v);else{if(!m)throw"both async and sync fetching of the wasm failed";e=m(e)}return e}(e);return await WebAssembly.instantiate(n,t)}catch(r){M("failed to asynchronously prepare wasm: ".concat(r)),ee(r)}}(t,e)}(t);return e(r.instance,r.module)}catch(o){return i(o),Promise.reject(o)}}(),dr=e=>(dr=ur.Ea)(e),hr=()=>(hr=ur.Fa)();a._OrtInit=(e,t)=>(a._OrtInit=ur.Ga)(e,t),a._OrtGetLastError=(e,t)=>(a._OrtGetLastError=ur.Ha)(e,t),a._OrtCreateSessionOptions=(e,t,n,r,i,o,s,c,l,u)=>(a._OrtCreateSessionOptions=ur.Ia)(e,t,n,r,i,o,s,c,l,u),a._OrtAppendExecutionProvider=(e,t,n,r,i)=>(a._OrtAppendExecutionProvider=ur.Ja)(e,t,n,r,i),a._OrtAddFreeDimensionOverride=(e,t,n)=>(a._OrtAddFreeDimensionOverride=ur.Ka)(e,t,n),a._OrtAddSessionConfigEntry=(e,t,n)=>(a._OrtAddSessionConfigEntry=ur.La)(e,t,n),a._OrtReleaseSessionOptions=e=>(a._OrtReleaseSessionOptions=ur.Ma)(e),a._OrtCreateSession=(e,t,n)=>(a._OrtCreateSession=ur.Na)(e,t,n),a._OrtReleaseSession=e=>(a._OrtReleaseSession=ur.Oa)(e),a._OrtGetInputOutputCount=(e,t,n)=>(a._OrtGetInputOutputCount=ur.Pa)(e,t,n),a._OrtGetInputOutputMetadata=(e,t,n,r)=>(a._OrtGetInputOutputMetadata=ur.Qa)(e,t,n,r),a._OrtFree=e=>(a._OrtFree=ur.Ra)(e),a._OrtCreateTensor=(e,t,n,r,i,o)=>(a._OrtCreateTensor=ur.Sa)(e,t,n,r,i,o),a._OrtGetTensorData=(e,t,n,r,i)=>(a._OrtGetTensorData=ur.Ta)(e,t,n,r,i),a._OrtReleaseTensor=e=>(a._OrtReleaseTensor=ur.Ua)(e),a._OrtCreateRunOptions=(e,t,n,r)=>(a._OrtCreateRunOptions=ur.Va)(e,t,n,r),a._OrtAddRunConfigEntry=(e,t,n)=>(a._OrtAddRunConfigEntry=ur.Wa)(e,t,n),a._OrtReleaseRunOptions=e=>(a._OrtReleaseRunOptions=ur.Xa)(e),a._OrtCreateBinding=e=>(a._OrtCreateBinding=ur.Ya)(e),a._OrtBindInput=(e,t,n)=>(a._OrtBindInput=ur.Za)(e,t,n),a._OrtBindOutput=(e,t,n,r)=>(a._OrtBindOutput=ur._a)(e,t,n,r),a._OrtClearBoundOutputs=e=>(a._OrtClearBoundOutputs=ur.$a)(e),a._OrtReleaseBinding=e=>(a._OrtReleaseBinding=ur.ab)(e),a._OrtRunWithBinding=(e,t,n,r,i)=>(a._OrtRunWithBinding=ur.bb)(e,t,n,r,i),a._OrtRun=(e,t,n,r,i,o,s,c)=>(a._OrtRun=ur.cb)(e,t,n,r,i,o,s,c),a._OrtEndProfiling=e=>(a._OrtEndProfiling=ur.db)(e),a._JsepOutput=(e,t,n)=>(a._JsepOutput=ur.eb)(e,t,n),a._JsepGetNodeName=e=>(a._JsepGetNodeName=ur.fb)(e);var fr=()=>(fr=ur.gb)(),pr=a._free=e=>(pr=a._free=ur.hb)(e),mr=a._malloc=e=>(mr=a._malloc=ur.ib)(e),gr=(e,t,n,r,i,a)=>(gr=ur.kb)(e,t,n,r,i,a),yr=()=>(yr=ur.lb)(),vr=(e,t,n,r,i)=>(vr=ur.mb)(e,t,n,r,i),wr=e=>(wr=ur.nb)(e),br=e=>(br=ur.ob)(e),_r=(e,t)=>(_r=ur.pb)(e,t),xr=()=>(xr=ur.qb)(),Er=(e,t)=>(Er=ur.rb)(e,t),Sr=e=>(Sr=ur.sb)(e),kr=e=>(kr=ur.tb)(e),Tr=()=>(Tr=ur.ub)(),Ir=a.dynCall_ii=(e,t)=>(Ir=a.dynCall_ii=ur.vb)(e,t);a.dynCall_vii=(e,t,n)=>(a.dynCall_vii=ur.dynCall_vii)(e,t,n),a.dynCall_iiiii=(e,t,n,r,i)=>(a.dynCall_iiiii=ur.dynCall_iiiii)(e,t,n,r,i),a.dynCall_iii=(e,t,n)=>(a.dynCall_iii=ur.dynCall_iii)(e,t,n),a.dynCall_iiiiii=(e,t,n,r,i,o)=>(a.dynCall_iiiiii=ur.dynCall_iiiiii)(e,t,n,r,i,o),a.dynCall_iiiiiiii=(e,t,n,r,i,o,s,c)=>(a.dynCall_iiiiiiii=ur.dynCall_iiiiiiii)(e,t,n,r,i,o,s,c),a.dynCall_iiiiiii=(e,t,n,r,i,o,s)=>(a.dynCall_iiiiiii=ur.dynCall_iiiiiii)(e,t,n,r,i,o,s),a.dynCall_vi=(e,t)=>(a.dynCall_vi=ur.dynCall_vi)(e,t),a.dynCall_iiii=(e,t,n,r)=>(a.dynCall_iiii=ur.dynCall_iiii)(e,t,n,r),a.dynCall_i=e=>(a.dynCall_i=ur.dynCall_i)(e),a.dynCall_viiiiiiii=(e,t,n,r,i,o,s,c,l)=>(a.dynCall_viiiiiiii=ur.dynCall_viiiiiiii)(e,t,n,r,i,o,s,c,l),a.dynCall_viii=(e,t,n,r)=>(a.dynCall_viii=ur.dynCall_viii)(e,t,n,r),a.dynCall_viijj=(e,t,n,r,i)=>(a.dynCall_viijj=ur.dynCall_viijj)(e,t,n,r,i),a.dynCall_viiiiii=(e,t,n,r,i,o,s)=>(a.dynCall_viiiiii=ur.dynCall_viiiiii)(e,t,n,r,i,o,s),a.dynCall_viiii=(e,t,n,r,i)=>(a.dynCall_viiii=ur.dynCall_viiii)(e,t,n,r,i),a.dynCall_viiiii=(e,t,n,r,i,o)=>(a.dynCall_viiiii=ur.dynCall_viiiii)(e,t,n,r,i,o),a.dynCall_vfiii=(e,t,n,r,i)=>(a.dynCall_vfiii=ur.dynCall_vfiii)(e,t,n,r,i),a.dynCall_viiiiff=(e,t,n,r,i,o,s)=>(a.dynCall_viiiiff=ur.dynCall_viiiiff)(e,t,n,r,i,o,s),a.dynCall_viiiiiff=(e,t,n,r,i,o,s,c)=>(a.dynCall_viiiiiff=ur.dynCall_viiiiiff)(e,t,n,r,i,o,s,c),a.dynCall_ffff=(e,t,n,r)=>(a.dynCall_ffff=ur.dynCall_ffff)(e,t,n,r),a.dynCall_viiff=(e,t,n,r,i)=>(a.dynCall_viiff=ur.dynCall_viiff)(e,t,n,r,i),a.dynCall_fffffff=(e,t,n,r,i,o,s)=>(a.dynCall_fffffff=ur.dynCall_fffffff)(e,t,n,r,i,o,s),a.dynCall_jjjjjjj=(e,t,n,r,i,o,s)=>(a.dynCall_jjjjjjj=ur.dynCall_jjjjjjj)(e,t,n,r,i,o,s),a.dynCall_jjjjjj=(e,t,n,r,i,o)=>(a.dynCall_jjjjjj=ur.dynCall_jjjjjj)(e,t,n,r,i,o),a.dynCall_iijjii=(e,t,n,r,i,o)=>(a.dynCall_iijjii=ur.dynCall_iijjii)(e,t,n,r,i,o),a.dynCall_viiiiiiiiiiiii=(e,t,n,r,i,o,s,c,l,u,d,h,f,p)=>(a.dynCall_viiiiiiiiiiiii=ur.dynCall_viiiiiiiiiiiii)(e,t,n,r,i,o,s,c,l,u,d,h,f,p),a.dynCall_viiiiiiiiii=(e,t,n,r,i,o,s,c,l,u,d)=>(a.dynCall_viiiiiiiiii=ur.dynCall_viiiiiiiiii)(e,t,n,r,i,o,s,c,l,u,d),a.dynCall_viiiiiiiiiii=(e,t,n,r,i,o,s,c,l,u,d,h)=>(a.dynCall_viiiiiiiiiii=ur.dynCall_viiiiiiiiiii)(e,t,n,r,i,o,s,c,l,u,d,h),a.dynCall_viiiiiiiiiiii=(e,t,n,r,i,o,s,c,l,u,d,h,f)=>(a.dynCall_viiiiiiiiiiii=ur.dynCall_viiiiiiiiiiii)(e,t,n,r,i,o,s,c,l,u,d,h,f),a.dynCall_viiiiiiiiiiiiiiiiii=(e,t,n,r,i,o,s,c,l,u,d,h,f,p,m,g,y,v,w)=>(a.dynCall_viiiiiiiiiiiiiiiiii=ur.dynCall_viiiiiiiiiiiiiiiiii)(e,t,n,r,i,o,s,c,l,u,d,h,f,p,m,g,y,v,w),a.dynCall_viiiiiiiii=(e,t,n,r,i,o,s,c,l,u)=>(a.dynCall_viiiiiiiii=ur.dynCall_viiiiiiiii)(e,t,n,r,i,o,s,c,l,u),a.dynCall_viiiiiiiiiiiiiiiiiii=(e,t,n,r,i,o,s,c,l,u,d,h,f,p,m,g,y,v,w,b)=>(a.dynCall_viiiiiiiiiiiiiiiiiii=ur.dynCall_viiiiiiiiiiiiiiiiiii)(e,t,n,r,i,o,s,c,l,u,d,h,f,p,m,g,y,v,w,b),a.dynCall_viiiiiii=(e,t,n,r,i,o,s,c)=>(a.dynCall_viiiiiii=ur.dynCall_viiiiiii)(e,t,n,r,i,o,s,c),a.dynCall_viiiiiiiiiiiiiii=(e,t,n,r,i,o,s,c,l,u,d,h,f,p,m,g)=>(a.dynCall_viiiiiiiiiiiiiii=ur.dynCall_viiiiiiiiiiiiiii)(e,t,n,r,i,o,s,c,l,u,d,h,f,p,m,g),a.dynCall_jiji=(e,t,n,r)=>(a.dynCall_jiji=ur.dynCall_jiji)(e,t,n,r),a.dynCall_v=e=>(a.dynCall_v=ur.dynCall_v)(e),a.dynCall_iidiiii=(e,t,n,r,i,o,s)=>(a.dynCall_iidiiii=ur.dynCall_iidiiii)(e,t,n,r,i,o,s),a.dynCall_iiiiiiiii=(e,t,n,r,i,o,s,c,l)=>(a.dynCall_iiiiiiiii=ur.dynCall_iiiiiiiii)(e,t,n,r,i,o,s,c,l),a.dynCall_iiij=(e,t,n,r)=>(a.dynCall_iiij=ur.dynCall_iiij)(e,t,n,r),a.dynCall_iiiiiiiiii=(e,t,n,r,i,o,s,c,l,u)=>(a.dynCall_iiiiiiiiii=ur.dynCall_iiiiiiiiii)(e,t,n,r,i,o,s,c,l,u),a.dynCall_iiiiiiiiiiiii=(e,t,n,r,i,o,s,c,l,u,d,h,f)=>(a.dynCall_iiiiiiiiiiiii=ur.dynCall_iiiiiiiiiiiii)(e,t,n,r,i,o,s,c,l,u,d,h,f),a.dynCall_iiiiiiiiiii=(e,t,n,r,i,o,s,c,l,u,d)=>(a.dynCall_iiiiiiiiiii=ur.dynCall_iiiiiiiiiii)(e,t,n,r,i,o,s,c,l,u,d),a.dynCall_ji=(e,t)=>(a.dynCall_ji=ur.dynCall_ji)(e,t),a.dynCall_iijii=(e,t,n,r,i)=>(a.dynCall_iijii=ur.dynCall_iijii)(e,t,n,r,i),a.dynCall_vij=(e,t,n)=>(a.dynCall_vij=ur.dynCall_vij)(e,t,n),a.dynCall_viiijii=(e,t,n,r,i,o,s)=>(a.dynCall_viiijii=ur.dynCall_viiijii)(e,t,n,r,i,o,s),a.dynCall_viijiiiiiiiiiiiiii=(e,t,n,r,i,o,s,c,l,u,d,h,f,p,m,g,y,v)=>(a.dynCall_viijiiiiiiiiiiiiii=ur.dynCall_viijiiiiiiiiiiiiii)(e,t,n,r,i,o,s,c,l,u,d,h,f,p,m,g,y,v),a.dynCall_viiiji=(e,t,n,r,i,o)=>(a.dynCall_viiiji=ur.dynCall_viiiji)(e,t,n,r,i,o),a.dynCall_fiii=(e,t,n,r)=>(a.dynCall_fiii=ur.dynCall_fiii)(e,t,n,r),a.dynCall_viijii=(e,t,n,r,i,o)=>(a.dynCall_viijii=ur.dynCall_viijii)(e,t,n,r,i,o),a.dynCall_viij=(e,t,n,r)=>(a.dynCall_viij=ur.dynCall_viij)(e,t,n,r),a.dynCall_jiij=(e,t,n,r)=>(a.dynCall_jiij=ur.dynCall_jiij)(e,t,n,r),a.dynCall_fi=(e,t)=>(a.dynCall_fi=ur.dynCall_fi)(e,t),a.dynCall_fii=(e,t,n)=>(a.dynCall_fii=ur.dynCall_fii)(e,t,n),a.dynCall_jii=(e,t,n)=>(a.dynCall_jii=ur.dynCall_jii)(e,t,n),a.dynCall_dii=(e,t,n)=>(a.dynCall_dii=ur.dynCall_dii)(e,t,n),a.dynCall_fiiii=(e,t,n,r,i)=>(a.dynCall_fiiii=ur.dynCall_fiiii)(e,t,n,r,i),a.dynCall_fif=(e,t,n)=>(a.dynCall_fif=ur.dynCall_fif)(e,t,n),a.dynCall_jfi=(e,t,n)=>(a.dynCall_jfi=ur.dynCall_jfi)(e,t,n),a.dynCall_viiiiiiiiiiiiii=(e,t,n,r,i,o,s,c,l,u,d,h,f,p,m)=>(a.dynCall_viiiiiiiiiiiiii=ur.dynCall_viiiiiiiiiiiiii)(e,t,n,r,i,o,s,c,l,u,d,h,f,p,m),a.dynCall_viiiiiiiiiiiiiiiiiiii=(e,t,n,r,i,o,s,c,l,u,d,h,f,p,m,g,y,v,w,b,_)=>(a.dynCall_viiiiiiiiiiiiiiiiiiii=ur.dynCall_viiiiiiiiiiiiiiiiiiii)(e,t,n,r,i,o,s,c,l,u,d,h,f,p,m,g,y,v,w,b,_),a.dynCall_viiiiiiiiiiiiiiii=(e,t,n,r,i,o,s,c,l,u,d,h,f,p,m,g,y)=>(a.dynCall_viiiiiiiiiiiiiiii=ur.dynCall_viiiiiiiiiiiiiiii)(e,t,n,r,i,o,s,c,l,u,d,h,f,p,m,g,y),a.dynCall_iif=(e,t,n)=>(a.dynCall_iif=ur.dynCall_iif)(e,t,n),a.dynCall_jiiii=(e,t,n,r,i)=>(a.dynCall_jiiii=ur.dynCall_jiiii)(e,t,n,r,i),a.dynCall_jiii=(e,t,n,r)=>(a.dynCall_jiii=ur.dynCall_jiii)(e,t,n,r),a.dynCall_viif=(e,t,n,r)=>(a.dynCall_viif=ur.dynCall_viif)(e,t,n,r),a.dynCall_viiij=(e,t,n,r,i)=>(a.dynCall_viiij=ur.dynCall_viiij)(e,t,n,r,i),a.dynCall_viiiijii=(e,t,n,r,i,o,s,c)=>(a.dynCall_viiiijii=ur.dynCall_viiiijii)(e,t,n,r,i,o,s,c),a.dynCall_iiiiij=(e,t,n,r,i,o)=>(a.dynCall_iiiiij=ur.dynCall_iiiiij)(e,t,n,r,i,o),a.dynCall_iiiiid=(e,t,n,r,i,o)=>(a.dynCall_iiiiid=ur.dynCall_iiiiid)(e,t,n,r,i,o),a.dynCall_iiiiijj=(e,t,n,r,i,o,s)=>(a.dynCall_iiiiijj=ur.dynCall_iiiiijj)(e,t,n,r,i,o,s),a.dynCall_iiiiiijj=(e,t,n,r,i,o,s,c)=>(a.dynCall_iiiiiijj=ur.dynCall_iiiiiijj)(e,t,n,r,i,o,s,c);var Cr=e=>(Cr=ur.wb)(e),Ar=()=>(Ar=ur.xb)(),Or=e=>(Or=ur.yb)(e),Nr=()=>(Nr=ur.zb)();return function e(){if(0<J)$=e;else if(u)r(a),X();else{for(;0<ie.length;)ie.shift()(a);0<J?$=e:(a.calledRun=!0,L||(X(),r(a)))}}(),a.PTR_SIZE=4,o},De=Pe,(null===(e=globalThis.self)||void 0===e||null===(e=e.name)||void 0===e?void 0:e.startsWith("em-pthread"))&&Pe()}),vl=re(()=>{Te(),ze=typeof location>"u"?void 0:location.origin,Me=!0,Le=()=>{if(Me){let e=URL;return new URL(new e(n(618),n.b).href,ze).href}return"file:///C:/reef-monitor/node_modules/onnxruntime-web/dist/ort.bundle.min.mjs"},Ue=Le(),Be=()=>{if(Ue&&!Ue.startsWith("blob:"))return Ue.substring(0,Ue.lastIndexOf("/")+1)},Fe=(e,t)=>{try{let n=null!==t&&void 0!==t?t:Ue;return(n?new URL(e,n):new URL(e)).origin===ze}catch(n){return!1}},je=(e,t)=>{let n=null!==t&&void 0!==t?t:Ue;try{return(n?new URL(e,n):new URL(e)).href}catch(r){return}},Ve=(e,t)=>"".concat(null!==t&&void 0!==t?t:"./").concat(e),qe=async e=>{let t=await(await fetch(e,{credentials:"same-origin"})).blob();return URL.createObjectURL(t)},He=async e=>(await import(e)).default,We=(Ne(),ae(Ie)).default,Ge=async()=>{if(!Ue)throw new Error("Failed to load proxy worker: cannot determine the script source URL.");if(Fe(Ue))return[void 0,We()];let e=await qe(Ue);return[e,We(e)]},Ke=(yl(),ae(Re)).default,Qe=async(e,t,n,r)=>{let i=Ke&&!(e||t);if(i)if(Ue)i=Fe(Ue);else{if(!r||n)throw new Error("cannot determine the script source URL.");i=!0}if(i)return[void 0,Ke];{let r="ort-wasm-simd-threaded.jsep.mjs",i=null!==e&&void 0!==e?e:je(r,t),a=n&&i&&!Fe(i,t),o=a?await qe(i):null!==i&&void 0!==i?i:Ve(r,t);return[a?o:void 0,await He(o)]}}}),wl=re(()=>{vl(),Ye=!1,Je=!1,$e=!1,Ze=()=>{if(typeof SharedArrayBuffer>"u")return!1;try{return typeof MessageChannel<"u"&&(new MessageChannel).port1.postMessage(new SharedArrayBuffer(1)),WebAssembly.validate(new Uint8Array([0,97,115,109,1,0,0,0,1,4,1,96,0,0,3,2,1,0,5,4,1,3,1,1,10,11,1,9,0,65,0,254,16,2,0,26,11]))}catch(e){return!1}},et=()=>{try{return WebAssembly.validate(new Uint8Array([0,97,115,109,1,0,0,0,1,4,1,96,0,0,3,2,1,0,10,30,1,28,0,65,0,253,15,253,12,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,253,186,1,26,11]))}catch(e){return!1}},tt=()=>{try{return WebAssembly.validate(new Uint8Array([0,97,115,109,1,0,0,0,1,5,1,96,0,1,123,3,2,1,0,10,19,1,17,0,65,1,253,15,65,2,253,15,65,3,253,15,253,147,2,11]))}catch(e){return!1}},nt=async e=>{var t,n;if(Ye)return Promise.resolve();if(Je)throw new Error("multiple calls to 'initializeWebAssembly()' detected.");if($e)throw new Error("previous call to 'initializeWebAssembly()' failed.");Je=!0;let r=e.initTimeout,i=e.numThreads;if(!1!==e.simd)if("relaxed"===e.simd){if(!tt())throw new Error("Relaxed WebAssembly SIMD is not supported in the current environment.")}else if(!et())throw new Error("WebAssembly SIMD is not supported in the current environment.");let a=Ze();i>1&&!a&&(typeof self<"u"&&!self.crossOriginIsolated&&console.warn("env.wasm.numThreads is set to "+i+", but this will not work unless you enable crossOriginIsolated mode. See https://web.dev/cross-origin-isolation-guide/ for more info."),console.warn("WebAssembly multi-threading is not supported in the current environment. Falling back to single-threading."),e.numThreads=i=1);let o=e.wasmPaths,s="string"==typeof o?o:void 0,c=null===o||void 0===o?void 0:o.mjs,l=null!==(t=null===c||void 0===c?void 0:c.href)&&void 0!==t?t:c,u=null===o||void 0===o?void 0:o.wasm,d=null!==(n=null===u||void 0===u?void 0:u.href)&&void 0!==n?n:u,h=e.wasmBinary,[f,p]=await Qe(l,s,i>1,!!h||!!d),m=!1,g=[];if(r>0&&g.push(new Promise(e=>{setTimeout(()=>{m=!0,e()},r)})),g.push(new Promise((e,t)=>{let n={numThreads:i};if(h)n.wasmBinary=h;else if(d||s)n.locateFile=e=>null!==d&&void 0!==d?d:s+e;else if(l&&0!==l.indexOf("blob:"))n.locateFile=e=>new URL(e,l).href;else if(f){let e=Be();e&&(n.locateFile=t=>e+t)}p(n).then(t=>{Je=!1,Ye=!0,Xe=t,e(),f&&URL.revokeObjectURL(f)},e=>{Je=!1,$e=!0,t(e)})})),await Promise.race(g),m)throw new Error("WebAssembly backend initializing failed due to timeout: ".concat(r,"ms"))},rt=()=>{if(Ye&&Xe)return Xe;throw new Error("WebAssembly is not initialized yet.")}}),bl=re(()=>{wl(),it=(e,t)=>{let n=rt(),r=n.lengthBytesUTF8(e)+1,i=n._malloc(r);return n.stringToUTF8(e,i,r),t.push(i),i},at=(e,t,n,r)=>{if("object"==typeof e&&null!==e){if(n.has(e))throw new Error("Circular reference in options");n.add(e)}Object.entries(e).forEach(e=>{let[i,a]=e,o=t?t+i:i;if("object"==typeof a)at(a,o+".",n,r);else if("string"==typeof a||"number"==typeof a)r(o,a.toString());else{if("boolean"!=typeof a)throw new Error("Can't handle extra config type: ".concat(typeof a));r(o,a?"1":"0")}})},ot=e=>{let t=rt(),n=t.stackSave();try{let n=t.PTR_SIZE,r=t.stackAlloc(2*n);t._OrtGetLastError(r,r+n);let i=Number(t.getValue(r,4===n?"i32":"i64")),a=t.getValue(r+n,"*"),o=a?t.UTF8ToString(a):"";throw new Error("".concat(e," ERROR_CODE: ").concat(i,", ERROR_MESSAGE: ").concat(o))}finally{t.stackRestore(n)}}}),_l=re(()=>{wl(),bl(),st=e=>{let t=rt(),n=0,r=[],i=e||{};try{if(void 0===(null===e||void 0===e?void 0:e.logSeverityLevel))i.logSeverityLevel=2;else if("number"!=typeof e.logSeverityLevel||!Number.isInteger(e.logSeverityLevel)||e.logSeverityLevel<0||e.logSeverityLevel>4)throw new Error("log severity level is not valid: ".concat(e.logSeverityLevel));if(void 0===(null===e||void 0===e?void 0:e.logVerbosityLevel))i.logVerbosityLevel=0;else if("number"!=typeof e.logVerbosityLevel||!Number.isInteger(e.logVerbosityLevel))throw new Error("log verbosity level is not valid: ".concat(e.logVerbosityLevel));void 0===(null===e||void 0===e?void 0:e.terminate)&&(i.terminate=!1);let a=0;return void 0!==(null===e||void 0===e?void 0:e.tag)&&(a=it(e.tag,r)),n=t._OrtCreateRunOptions(i.logSeverityLevel,i.logVerbosityLevel,!!i.terminate,a),0===n&&ot("Can't create run options."),void 0!==(null===e||void 0===e?void 0:e.extra)&&at(e.extra,"",new WeakSet,(e,i)=>{let a=it(e,r),o=it(i,r);0!==t._OrtAddRunConfigEntry(n,a,o)&&ot("Can't set a run config entry: ".concat(e," - ").concat(i,"."))}),[n,r]}catch(N_){throw 0!==n&&t._OrtReleaseRunOptions(n),r.forEach(e=>t._free(e)),N_}}}),xl=re(()=>{wl(),bl(),ct=e=>{switch(e){case"disabled":return 0;case"basic":return 1;case"extended":return 2;case"layout":return 3;case"all":return 99;default:throw new Error("unsupported graph optimization level: ".concat(e))}},lt=e=>{switch(e){case"sequential":return 0;case"parallel":return 1;default:throw new Error("unsupported execution mode: ".concat(e))}},ut=e=>{e.extra||(e.extra={}),e.extra.session||(e.extra.session={});let t=e.extra.session;t.use_ort_model_bytes_directly||(t.use_ort_model_bytes_directly="1"),e.executionProviders&&e.executionProviders.some(e=>"webgpu"===("string"==typeof e?e:e.name))&&(e.enableMemPattern=!1)},dt=(e,t,n,r)=>{let i=it(t,r),a=it(n,r);0!==rt()._OrtAddSessionConfigEntry(e,i,a)&&ot("Can't set a session config entry: ".concat(t," - ").concat(n,"."))},ht=async(e,t,n)=>{for(let r of t){let t="string"==typeof r?r:r.name,i=[];switch(t){case"webnn":if(t="WEBNN","string"!=typeof r){let t=null===r||void 0===r?void 0:r.deviceType;t&&dt(e,"deviceType",t,n)}break;case"webgpu":if(t="JS","string"!=typeof r){let t=r;if(null!==t&&void 0!==t&&t.preferredLayout){if("NCHW"!==t.preferredLayout&&"NHWC"!==t.preferredLayout)throw new Error("preferredLayout must be either 'NCHW' or 'NHWC': ".concat(t.preferredLayout));dt(e,"preferredLayout",t.preferredLayout,n)}}break;case"wasm":case"cpu":continue;default:throw new Error("not supported execution provider: ".concat(t))}let a=it(t,n),o=i.length,s=0,c=0;if(o>0){s=rt()._malloc(o*rt().PTR_SIZE),n.push(s),c=rt()._malloc(o*rt().PTR_SIZE),n.push(c);for(let e=0;e<o;e++)rt().setValue(s+e*rt().PTR_SIZE,i[e][0],"*"),rt().setValue(c+e*rt().PTR_SIZE,i[e][1],"*")}0!==await rt()._OrtAppendExecutionProvider(e,a,s,c,o)&&ot("Can't append execution provider: ".concat(t,"."))}},ft=async e=>{let t=rt(),n=0,r=[],i=e||{};ut(i);try{var a,o,s,c;let e=ct(null!==(a=i.graphOptimizationLevel)&&void 0!==a?a:"all"),l=lt(null!==(o=i.executionMode)&&void 0!==o?o:"sequential"),u="string"==typeof i.logId?it(i.logId,r):0,d=null!==(s=i.logSeverityLevel)&&void 0!==s?s:2;if(!Number.isInteger(d)||d<0||d>4)throw new Error("log severity level is not valid: ".concat(d));let h=null!==(c=i.logVerbosityLevel)&&void 0!==c?c:0;if(!Number.isInteger(h)||h<0||h>4)throw new Error("log verbosity level is not valid: ".concat(h));let f="string"==typeof i.optimizedModelFilePath?it(i.optimizedModelFilePath,r):0;if(n=t._OrtCreateSessionOptions(e,!!i.enableCpuMemArena,!!i.enableMemPattern,l,!!i.enableProfiling,0,u,d,h,f),0===n&&ot("Can't create session options."),i.executionProviders&&await ht(n,i.executionProviders,r),void 0!==i.enableGraphCapture){if("boolean"!=typeof i.enableGraphCapture)throw new Error("enableGraphCapture must be a boolean value: ".concat(i.enableGraphCapture));dt(n,"enableGraphCapture",i.enableGraphCapture.toString(),r)}if(i.freeDimensionOverrides)for(let[a,o]of Object.entries(i.freeDimensionOverrides)){if("string"!=typeof a)throw new Error("free dimension override name must be a string: ".concat(a));if("number"!=typeof o||!Number.isInteger(o)||o<0)throw new Error("free dimension override value must be a non-negative integer: ".concat(o));let e=it(a,r);0!==t._OrtAddFreeDimensionOverride(n,e,o)&&ot("Can't set a free dimension override: ".concat(a," - ").concat(o,"."))}return void 0!==i.extra&&at(i.extra,"",new WeakSet,(e,t)=>{dt(n,e,t,r)}),[n,r]}catch(N_){throw 0!==n&&0!==t._OrtReleaseSessionOptions(n)&&ot("Can't release session options."),r.forEach(e=>t._free(e)),N_}}}),El=re(()=>{pt=e=>{switch(e){case"int8":return 3;case"uint8":return 2;case"bool":return 9;case"int16":return 5;case"uint16":return 4;case"int32":return 6;case"uint32":return 12;case"float16":return 10;case"float32":return 1;case"float64":return 11;case"string":return 8;case"int64":return 7;case"uint64":return 13;case"int4":return 22;case"uint4":return 21;default:throw new Error("unsupported data type: ".concat(e))}},mt=e=>{switch(e){case 3:return"int8";case 2:return"uint8";case 9:return"bool";case 5:return"int16";case 4:return"uint16";case 6:return"int32";case 12:return"uint32";case 10:return"float16";case 1:return"float32";case 11:return"float64";case 8:return"string";case 7:return"int64";case 13:return"uint64";case 22:return"int4";case 21:return"uint4";default:throw new Error("unsupported data type: ".concat(e))}},gt=(e,t)=>{let n=[-1,4,1,1,2,2,4,8,-1,1,2,8,4,8,-1,-1,-1,-1,-1,-1,-1,.5,.5][e],r="number"==typeof t?t:t.reduce((e,t)=>e*t,1);return n>0?Math.ceil(r*n):void 0},yt=e=>{switch(e){case"float16":return typeof Float16Array<"u"&&Float16Array.from?Float16Array:Uint16Array;case"float32":return Float32Array;case"uint8":case"bool":return Uint8Array;case"int8":return Int8Array;case"uint16":return Uint16Array;case"int16":return Int16Array;case"int32":return Int32Array;case"float64":return Float64Array;case"uint32":return Uint32Array;case"int64":return BigInt64Array;case"uint64":return BigUint64Array;default:throw new Error("unsupported type: ".concat(e))}},vt=e=>{switch(e){case"verbose":return 0;case"info":return 1;case"warning":return 2;case"error":return 3;case"fatal":return 4;default:throw new Error("unsupported logging level: ".concat(e))}},wt=e=>"float32"===e||"float16"===e||"int32"===e||"int64"===e||"uint32"===e||"uint8"===e||"bool"===e||"uint4"===e||"int4"===e,bt=e=>"float32"===e||"float16"===e||"int32"===e||"int64"===e||"uint32"===e||"uint64"===e||"int8"===e||"uint8"===e||"bool"===e||"uint4"===e||"int4"===e,_t=e=>{switch(e){case"none":return 0;case"cpu":return 1;case"cpu-pinned":return 2;case"texture":return 3;case"gpu-buffer":return 4;case"ml-tensor":return 5;default:throw new Error("unsupported data location: ".concat(e))}}}),Sl=re(()=>{Te(),xt=async e=>{if("string"==typeof e){let n=await fetch(e);if(!n.ok)throw new Error("failed to load external data file: ".concat(e));let r=n.headers.get("Content-Length"),i=r?parseInt(r,10):0;if(i<1073741824)return new Uint8Array(await n.arrayBuffer());{if(!n.body)throw new Error("failed to load external data file: ".concat(e,", no response body."));let r,a=n.body.getReader();try{r=new ArrayBuffer(i)}catch(t){if(!(t instanceof RangeError))throw t;{let e=Math.ceil(i/65536);r=new WebAssembly.Memory({initial:e,maximum:e}).buffer}}let o=0;for(;;){let{done:e,value:t}=await a.read();if(e)break;let n=t.byteLength;new Uint8Array(r,o,n).set(t),o+=n}return new Uint8Array(r,0,i)}}return e instanceof Blob?new Uint8Array(await e.arrayBuffer()):e instanceof Uint8Array?e:new Uint8Array(e)}}),kl=re(()=>{El(),Et=["V","I","W","E","F"],St=(e,t)=>{console.log("[".concat(Et[e],",").concat((new Date).toISOString(),"]").concat(t))},It=(e,t)=>{kt=e,Tt=t},Ct=(e,t)=>{let n=vt(e);n>=vt(kt)&&St(n,"function"==typeof t?t():t)},At=function(){Tt&&Ct(...arguments)}}),Tl=re(()=>{Ot=class{static calcMatMulShape(e,t){return e[1]!==t[0]?void 0:[e[0],t[1]]}},Nt=class{static calcShape(e,t){let n=arguments.length>2&&void 0!==arguments[2]&&arguments[2],r=e.length,i=t.length;if(0===r)return t;if(0===i)return e;let a=Math.max(e.length,t.length),o=new Array(a);if(n){if(r<2||i<2)return;let n=Ot.calcMatMulShape([e[r-2],e[r-1]],[t[i-2],t[i-1]]);if(void 0===n)return;[o[a-2],o[a-1]]=n}for(let s=n?3:1;s<=a;s++){let n=r-s<0?1:e[r-s],c=i-s<0?1:t[i-s];if(n!==c&&n>1&&c>1)return;let l=Math.max(n,c);if(n&&c)o[a-s]=Math.max(n,c);else{if(l>1)return;o[a-s]=0}}return o}static isValidBroadcast(e,t){let n=e.length,r=t.length;if(n>r)return!1;for(let i=1;i<=n;i++)if(1!==e[n-i]&&e[n-i]!==t[r-i])return!1;return!0}},Rt=class e{static size(t){return e.getSizeFromDimensionRange(t,0,t.length)}static convertShape(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:4,n=e.length;if(0===n)return[];let r=new Array(n),i=n-1;for(;i>=0;){if(e[i]%t===0){r[i]=e[i]/t;break}if(t%e[i]!==0)throw new Error("cannot convert shape");r[i]=1,t/=e[i],i--}for(i--;i>=0;i--)r[i]=e[i];return r}static sizeFromDimension(t,n){if(n<0||n>t.length)throw new Error("invalid dimension of ".concat(n," for sizeFromDimension as Tensor has ").concat(t.length," dimensions."));return e.getSizeFromDimensionRange(t,n,t.length)}static sizeToDimension(t,n){if(n<0||n>t.length)throw new Error("invalid dimension of ".concat(n," for sizeToDimension as Tensor has ").concat(t.length," dimensions."));return e.getSizeFromDimensionRange(t,0,n)}static getSizeFromDimensionRange(e,t,n){let r=1;for(let i=t;i<n;i++){if(e[i]<0)throw new Error("cannot get valid size from specified dimension range. Most likely the range contains negative values in them.");r*=Number(e[i])}return r}static computeStrides(e){let t=e.length;if(0===t)return[];if(1===t)return[1];let n=new Array(t);n[t-1]=1,n[t-2]=e[t-1];for(let r=t-3;r>=0;--r)n[r]=n[r+1]*e[r+1];return n}static normalizeAxis(e,t){if(e<-t&&e>=t)throw new Error("unsupported axis for this operation.");return e<0?e+t:e}static normalizeAxes(e,t){return e.map(n=>this.normalizeAxis(n,null!==t&&void 0!==t?t:e.length))}static sortBasedOnPerm(e,t){return t?t.map(t=>e[t]):e.slice().reverse()}static padShape(e,t){let n=e.length;return e.map((e,r)=>e+t[r]+t[r+n])}static areEqual(e,t){return e.length===t.length&&e.every((e,n)=>e===t[n])}},Pt=class e{static adjustPoolAttributes(e,t,n,r,i,a){if(!e&&n.length!==t.length-2)throw new Error("length of specified kernel shapes should be 2 less than length of input dimensions");if(e)for(let o=0;o<t.length-2;o++)o>=n.length?n.push(t[o+2]):n[o]=t[o+2];for(let o=0;o<n.length;o++)if(o<r.length){if(r[o]<0)throw new Error("strides should be greater than or equal to 1")}else r.push(1);for(let o=0;o<n.length;o++)if(o<i.length){if(i[o]<0)throw new Error("dilations should be greater than or equal to 1")}else i.push(1);for(let o=0;o<2*n.length;o++)if(o<a.length){if(a[o]<0)throw new Error("pad should be greater than or equal to 1")}else a.push(0);for(let o=0;o<n.length;o++){if(n[o]<=0)throw new Error("kernel shapes need to be greater than 0");if(a[o]>=n[o]||a[o+n.length]>=n[o])throw new Error("pads should be smaller than kernel")}}static adjustPadsBasedOnAutoPad(t,n,r,i,a,o,s){if(s){if(a.length!==2*(t.length-2))throw new Error("length of pads should be twice the length of data dimensions");if(n.length!==t.length-2)throw new Error("length of strides should be the length of data dimensions");if(i.length!==t.length-2)throw new Error("length of kernel shapes should be the length of data dimensions");for(let c=0;c<t.length-2;c++)e.adjustPadAndReturnShape(t[c+(o?1:2)],n[c],r[c],i[c],a,c,c+t.length-2,s)}}static computePoolOutputShape(t,n,r,i,a,o,s){if(n.length<=0)throw new Error("input shape must be of size greater than 0");let c=[n[0],n[1]];return e.computeShapeHelper(t,n,c,r,i,a,o,s),c}static computeConvOutputShape(t,n,r,i,a,o,s){if(t.length<=0||n.length<=0)throw new Error("invalid input tensor dims or invalid filter tensor dims");let c=[t[0],n[0]];return e.computeShapeHelper(!1,t,c,r,i,a,o,s),c}static computeShapeHelper(t,n,r,i,a,o,s,c){if(t)for(let e=0;e<n.length-2;e++)r.push(1);else for(let l=0;l<n.length-2;l++)r.push(e.adjustPadAndReturnShape(n[l+2],i[l],a[l],o[l],s,l,l+n.length-2,c))}static adjustPadAndReturnShape(e,t,n,r,i,a,o,s){let c=n*(r-1)+1;if(!s||"NOTSET"===s)return Math.floor((e+i[a]+i[o]-c)/t+1);switch(s){case"VALID":return i[a]=0,i[o]=0,Math.floor((e-c)/t+1);case"SAME_LOWER":case"SAME_UPPER":if(1!==n)throw new Error("Dilation not supported for SAME_UPPER or SAME_LOWER");{let n=((e+t-1)/t-1)*t+r-e;return i[a]=Math.floor("SAME_LOWER"===s?(n+1)/2:n/2),i[o]=n-i[a],Math.floor((e+n-r)/t+1)}default:throw new Error("Unsupported AutoPad type")}}},Dt=class{static getShapeOfGemmResult(e,t,n,r,i){if(2!==e.length||2!==n.length)throw new Error("shape need to be of size 2");let a,o,s;t?(a=e[1],o=e[0]):(a=e[0],o=e[1]);let c=-1;if(r?(s=n[0],c=1):(s=n[1],c=0),n[c]!==o)throw new Error("dimension mismatch");if(a<=0||s<=0||o<=0)throw new Error("invalid shape specified");if(i&&!Nt.isValidBroadcast(i,[a,s]))throw new Error("gemm: invalid bias shape for broadcast");return[a,s,o]}},zt=-34028234663852886e22,Mt=34028234663852886e22}),Il=re(()=>{El(),Lt=(e,t)=>new(yt(t))(e)}),Cl=re(()=>{El(),kl(),Ut=new Map([["float32",32],["float16",16],["int32",32],["uint32",32],["int64",64],["uint64",64],["int8",8],["uint8",8],["int4",4],["uint4",4]]),Bt=(e,t)=>{if("int32"===t)return e;let n=Ut.get(t);if(!n)throw new Error("WebNN backend does not support data type: ".concat(t));let r=n/8;if(e.byteLength%r!==0)throw new Error("Invalid Uint8Array length - must be a multiple of ".concat(r,"."));let i=e.byteLength/r,a=new(yt(t))(e.buffer,e.byteOffset,i);switch(t){case"int64":case"uint64":{let e=new Int32Array(i);for(let t=0;t<i;t++){let n=a[t];if(n>2147483647n||n<-2147483648n)throw new Error("Can not convert int64 data to int32 - value out of range.");e[t]=Number(n)}return new Uint8Array(e.buffer)}case"int8":case"uint8":case"uint32":{if("uint32"===t&&a.some(e=>e>2147483647))throw new Error("Can not convert uint32 data to int32 - value out of range.");let e=Int32Array.from(a,Number);return new Uint8Array(e.buffer)}default:throw new Error("Unsupported data conversion from ".concat(t," to 'int32'"))}},Ft=(e,t)=>{if("int32"===t)return e;if(e.byteLength%4!==0)throw new Error("Invalid Uint8Array length - must be a multiple of 4 (int32).");let n=e.byteLength/4,r=new Int32Array(e.buffer,e.byteOffset,n);switch(t){case"int64":{let e=BigInt64Array.from(r,BigInt);return new Uint8Array(e.buffer)}case"uint64":{if(r.some(e=>e<0))throw new Error("Can not convert int32 data to uin64 - negative value found.");let e=BigUint64Array.from(r,BigInt);return new Uint8Array(e.buffer)}case"int8":{if(r.some(e=>e<-128||e>127))throw new Error("Can not convert int32 data to int8 - value out of range.");let e=Int8Array.from(r,Number);return new Uint8Array(e.buffer)}case"uint8":if(r.some(e=>e<0||e>255))throw new Error("Can not convert int32 data to uint8 - value out of range.");return Uint8Array.from(r,Number);case"uint32":{if(r.some(e=>e<0))throw new Error("Can not convert int32 data to uint32 - negative value found.");let e=Uint32Array.from(r,Number);return new Uint8Array(e.buffer)}default:throw new Error("Unsupported data conversion from 'int32' to ".concat(t))}},jt=1,Vt=()=>jt++,qt=new Map([["int8","int32"],["uint8","int32"],["uint32","int32"],["int64","int32"]]),Ht=(e,t)=>{let n=Ut.get(e);if(!n)throw new Error("WebNN backend does not support data type: ".concat(e));return t.length>0?Math.ceil(t.reduce((e,t)=>e*t)*n/8):0},Wt=class{constructor(e){this.isDataConverted=!1;let{sessionId:t,context:n,tensor:r,dataType:i,shape:a,fallbackDataType:o}=e;this.sessionId=t,this.mlContext=n,this.mlTensor=r,this.dataType=i,this.tensorShape=a,this.fallbackDataType=o}get tensor(){return this.mlTensor}get type(){return this.dataType}get fallbackType(){return this.fallbackDataType}get shape(){return this.tensorShape}get byteLength(){return Ht(this.dataType,this.tensorShape)}destroy(){At("verbose",()=>"[WebNN] TensorWrapper.destroy"),this.mlTensor.destroy()}write(e){this.mlContext.writeTensor(this.mlTensor,e)}async read(e){if(this.fallbackDataType){let t=await this.mlContext.readTensor(this.mlTensor),n=Ft(new Uint8Array(t),this.dataType);return e?void(e instanceof ArrayBuffer?new Uint8Array(e):new Uint8Array(e.buffer,e.byteOffset,e.byteLength)).set(n):n.buffer}return e?this.mlContext.readTensor(this.mlTensor,e):this.mlContext.readTensor(this.mlTensor)}canReuseTensor(e,t,n){return this.mlContext===e&&this.dataType===t&&this.tensorShape.length===n.length&&this.tensorShape.every((e,t)=>e===n[t])}setIsDataConverted(e){this.isDataConverted=e}},Gt=class{constructor(e,t){this.tensorManager=e,this.wrapper=t}get tensorWrapper(){return this.wrapper}releaseTensor(){this.tensorWrapper&&(this.tensorManager.releaseTensor(this.tensorWrapper),this.wrapper=void 0)}async ensureTensor(e,t,n,r){let i,a=this.tensorManager.getMLContext(e);if(!a.opSupportLimits().input.dataTypes.includes(t)){if(i=qt.get(t),!i||!a.opSupportLimits().input.dataTypes.includes(i))throw new Error("WebNN backend does not support data type: ".concat(t));At("verbose",()=>"[WebNN] TensorIdTracker.ensureTensor: fallback dataType from ".concat(t," to ").concat(i))}if(this.wrapper){if(this.wrapper.canReuseTensor(a,t,n))return this.wrapper.tensor;if(r){if(this.wrapper.byteLength!==Ht(t,n))throw new Error("Unable to copy data to tensor with different size.");this.activeUpload=new Uint8Array(await this.wrapper.read())}this.tensorManager.releaseTensor(this.wrapper)}let o=typeof MLTensorUsage>"u"?void 0:MLTensorUsage.READ|MLTensorUsage.WRITE;return this.wrapper=await this.tensorManager.getCachedTensor(e,t,n,o,!0,!0,i),r&&this.activeUpload&&(this.wrapper.write(this.activeUpload),this.activeUpload=void 0),this.wrapper.tensor}upload(e){let t=e;if(this.wrapper){if(this.wrapper.fallbackType){if("int32"!==this.wrapper.fallbackType)throw new Error("Unsupported fallback data type: ".concat(this.wrapper.fallbackType));t=Bt(e,this.wrapper.type),this.wrapper.setIsDataConverted(!0)}if(e.byteLength===this.wrapper.byteLength)return void this.wrapper.write(t);At("verbose",()=>"Data size does not match tensor size. Releasing tensor."),this.releaseTensor()}this.activeUpload?this.activeUpload.set(t):this.activeUpload=new Uint8Array(t)}async download(e){if(this.activeUpload){var t,n;let r=null!==(t=this.wrapper)&&void 0!==t&&t.isDataConverted?Ft(this.activeUpload,null===(n=this.wrapper)||void 0===n?void 0:n.type):this.activeUpload;return e?void(e instanceof ArrayBuffer?new Uint8Array(e).set(r):new Uint8Array(e.buffer,e.byteOffset,e.byteLength).set(r)):r.buffer}if(!this.wrapper)throw new Error("Tensor has not been created.");return e?this.wrapper.read(e):this.wrapper.read()}},Kt=class{constructor(e){this.backend=e,this.tensorTrackersById=new Map,this.freeTensors=[],this.externalTensors=new Set}getMLContext(e){let t=this.backend.getMLContext(e);if(!t)throw new Error("MLContext not found for session.");return t}reserveTensorId(){let e=Vt();return this.tensorTrackersById.set(e,new Gt(this)),e}releaseTensorId(e){let t=this.tensorTrackersById.get(e);t&&(this.tensorTrackersById.delete(e),t.tensorWrapper&&this.releaseTensor(t.tensorWrapper))}async ensureTensor(e,t,n,r,i){At("verbose",()=>"[WebNN] TensorManager.ensureTensor {tensorId: ".concat(t,", dataType: ").concat(n,", shape: ").concat(r,", copyOld: ").concat(i,"}"));let a=this.tensorTrackersById.get(t);if(!a)throw new Error("Tensor not found.");return a.ensureTensor(e,n,r,i)}upload(e,t){let n=this.tensorTrackersById.get(e);if(!n)throw new Error("Tensor not found.");n.upload(t)}async download(e,t){At("verbose",()=>"[WebNN] TensorManager.download {tensorId: ".concat(e,", dstBuffer: ").concat(null===t||void 0===t?void 0:t.byteLength,"}"));let n=this.tensorTrackersById.get(e);if(!n)throw new Error("Tensor not found.");return n.download(t)}releaseTensorsForSession(e){for(let t of this.freeTensors)t.sessionId===e&&t.destroy();this.freeTensors=this.freeTensors.filter(t=>t.sessionId!==e)}registerTensor(e,t,n,r){let i=this.getMLContext(e),a=Vt(),o=new Wt({sessionId:e,context:i,tensor:t,dataType:n,shape:r});return this.tensorTrackersById.set(a,new Gt(this,o)),this.externalTensors.add(o),a}async getCachedTensor(e,t,n,r,i,a,o){let s=this.getMLContext(e);for(let[l,u]of this.freeTensors.entries())if(u.canReuseTensor(s,t,n)){At("verbose",()=>"[WebNN] Reusing tensor {dataType: ".concat(t,", ").concat(o?"fallbackDataType: ".concat(o,","):""," shape: ").concat(n));let r=this.freeTensors.splice(l,1)[0];return r.sessionId=e,r}At("verbose",()=>"[WebNN] MLContext.createTensor {dataType: ".concat(t,", ").concat(o?"fallbackDataType: ".concat(o,","):""," shape: ").concat(n,"}"));let c=await s.createTensor({dataType:null!==o&&void 0!==o?o:t,shape:n,dimensions:n,usage:r,writable:i,readable:a});return new Wt({sessionId:e,context:s,tensor:c,dataType:t,shape:n,fallbackDataType:o})}releaseTensor(e){this.externalTensors.has(e)&&this.externalTensors.delete(e),this.freeTensors.push(e)}},Qt=function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];return new Kt(...t)}}),Al=re(()=>{El(),wl(),Il(),Cl(),kl(),Xt=new Map([[1,"float32"],[10,"float16"],[6,"int32"],[12,"uint32"],[7,"int64"],[13,"uint64"],[22,"int4"],[21,"uint4"],[3,"int8"],[2,"uint8"],[9,"uint8"]]),Yt=(e,t)=>{if(e===t)return!0;if(void 0===e||void 0===t)return!1;let n=Object.keys(e).sort(),r=Object.keys(t).sort();return n.length===r.length&&n.every((n,i)=>n===r[i]&&e[n]===t[n])},Jt=class{constructor(e){this.tensorManager=Qt(this),this.mlContextBySessionId=new Map,this.sessionIdsByMLContext=new Map,this.mlContextCache=[],this.sessionGraphInputs=new Map,this.sessionGraphOutputs=new Map,this.temporaryGraphInputs=[],this.temporaryGraphOutputs=[],this.temporarySessionTensorIds=new Map,It(e.logLevel,!!e.debug)}get currentSessionId(){if(void 0===this.activeSessionId)throw new Error("No active session");return this.activeSessionId}onRunStart(e){At("verbose",()=>"[WebNN] onRunStart {sessionId: ".concat(e,"}")),this.activeSessionId=e}onRunEnd(e){At("verbose",()=>"[WebNN] onRunEnd {sessionId: ".concat(e,"}"));let t=this.temporarySessionTensorIds.get(e);if(t){for(let e of t)At("verbose",()=>"[WebNN] releasing temporary tensor {tensorId: ".concat(e,"}")),this.tensorManager.releaseTensorId(e);this.temporarySessionTensorIds.delete(e),this.activeSessionId=void 0}}async createMLContext(e){if(e instanceof GPUDevice){let t=this.mlContextCache.findIndex(t=>t.gpuDevice===e);if(-1!==t)return this.mlContextCache[t].mlContext;{let t=await navigator.ml.createContext(e);return this.mlContextCache.push({gpuDevice:e,mlContext:t}),t}}if(void 0===e){let e=this.mlContextCache.findIndex(e=>void 0===e.options&&void 0===e.gpuDevice);if(-1!==e)return this.mlContextCache[e].mlContext;{let e=await navigator.ml.createContext();return this.mlContextCache.push({mlContext:e}),e}}let t=this.mlContextCache.findIndex(t=>Yt(t.options,e));if(-1!==t)return this.mlContextCache[t].mlContext;{let t=await navigator.ml.createContext(e);return this.mlContextCache.push({options:e,mlContext:t}),t}}registerMLContext(e,t){this.mlContextBySessionId.set(e,t);let n=this.sessionIdsByMLContext.get(t);n||(n=new Set,this.sessionIdsByMLContext.set(t,n)),n.add(e),this.temporaryGraphInputs.length>0&&(this.sessionGraphInputs.set(e,this.temporaryGraphInputs),this.temporaryGraphInputs=[]),this.temporaryGraphOutputs.length>0&&(this.sessionGraphOutputs.set(e,this.temporaryGraphOutputs),this.temporaryGraphOutputs=[])}onReleaseSession(e){this.sessionGraphInputs.delete(e),this.sessionGraphOutputs.delete(e);let t=this.mlContextBySessionId.get(e);if(!t)return;this.tensorManager.releaseTensorsForSession(e),this.mlContextBySessionId.delete(e);let n=this.sessionIdsByMLContext.get(t);if(n.delete(e),0===n.size){this.sessionIdsByMLContext.delete(t);let e=this.mlContextCache.findIndex(e=>e.mlContext===t);-1!==e&&this.mlContextCache.splice(e,1)}}getMLContext(e){return this.mlContextBySessionId.get(e)}reserveTensorId(){return this.tensorManager.reserveTensorId()}releaseTensorId(e){At("verbose",()=>"[WebNN] releaseTensorId {tensorId: ".concat(e,"}")),this.tensorManager.releaseTensorId(e)}async ensureTensor(e,t,n,r,i){let a=Xt.get(n);if(!a)throw new Error("Unsupported ONNX data type: ".concat(n));return this.tensorManager.ensureTensor(null!==e&&void 0!==e?e:this.currentSessionId,t,a,r,i)}async createTemporaryTensor(e,t,n){At("verbose",()=>"[WebNN] createTemporaryTensor {onnxDataType: ".concat(t,", shape: ").concat(n,"}"));let r=Xt.get(t);if(!r)throw new Error("Unsupported ONNX data type: ".concat(t));let i=this.tensorManager.reserveTensorId();await this.tensorManager.ensureTensor(e,i,r,n,!1);let a=this.temporarySessionTensorIds.get(e);return a?a.push(i):this.temporarySessionTensorIds.set(e,[i]),i}uploadTensor(e,t){if(!rt().shouldTransferToMLTensor)throw new Error("Trying to upload to a MLTensor while shouldTransferToMLTensor is false");At("verbose",()=>"[WebNN] uploadTensor {tensorId: ".concat(e,", data: ").concat(t.byteLength,"}")),this.tensorManager.upload(e,t)}async downloadTensor(e,t){return this.tensorManager.download(e,t)}createMLTensorDownloader(e,t){return async()=>{let n=await this.tensorManager.download(e);return Lt(n,t)}}registerMLTensor(e,t,n,r){let i=Xt.get(n);if(!i)throw new Error("Unsupported ONNX data type: ".concat(n));let a=this.tensorManager.registerTensor(e,t,i,r);return At("verbose",()=>"[WebNN] registerMLTensor {tensor: ".concat(t,", dataType: ").concat(i,", dimensions: ").concat(r,"} -> {tensorId: ").concat(a,"}")),a}registerMLConstant(e,t,n,r,i,a){let o=arguments.length>6&&void 0!==arguments[6]&&arguments[6];if(!a)throw new Error("External mounted files are not available.");let s=e;e.startsWith("./")&&(s=e.substring(2));let c=a.get(s);if(!c)throw new Error("File with name ".concat(s," not found in preloaded files."));if(t+n>c.byteLength)throw new Error("Out of bounds: data offset and length exceed the external file data size.");let l,u=c.slice(t,t+n).buffer;switch(i.dataType){case"float32":l=new Float32Array(u);break;case"float16":l=typeof Float16Array<"u"&&Float16Array.from?new Float16Array(u):new Uint16Array(u);break;case"int32":l=new Int32Array(u);break;case"uint32":l=new Uint32Array(u);break;case"int64":if(o){let e=Bt(new Uint8Array(u),"int64");l=new Int32Array(e.buffer),i.dataType="int32"}else l=new BigInt64Array(u);break;case"uint64":l=new BigUint64Array(u);break;case"int8":l=new Int8Array(u);break;case"int4":case"uint4":case"uint8":l=new Uint8Array(u);break;default:throw new Error("Unsupported data type: ".concat(i.dataType," in creating WebNN Constant from external data."))}return At("verbose",()=>"[WebNN] registerMLConstant {dataType: ".concat(i.dataType,", shape: ").concat(i.shape,"}} ").concat(o?"(Note: it was int64 data type and registered to int32 as workaround)":"")),r.constant(i,l)}registerGraphInput(e){this.temporaryGraphInputs.push(e)}registerGraphOutput(e){this.temporaryGraphOutputs.push(e)}isGraphInput(e,t){let n=this.sessionGraphInputs.get(e);return!!n&&n.includes(t)}isGraphOutput(e,t){let n=this.sessionGraphOutputs.get(e);return!!n&&n.includes(t)}isGraphInputOutputTypeSupported(e,t){let n=!(arguments.length>2&&void 0!==arguments[2])||arguments[2],r=this.mlContextBySessionId.get(e),i=Xt.get(pt(t));return!(typeof i>"u")&&(n?!(null===r||void 0===r||!r.opSupportLimits().input.dataTypes.includes(i)):!(null===r||void 0===r||!r.opSupportLimits().output.dataTypes.includes(i)))}flush(){}}}),Ol=re(()=>{}),Nl=re(()=>{kl(),Ol(),$t=new Map([[64,250],[128,200],[256,200],[512,200],[2048,230],[4096,200],[8192,50],[16384,50],[32768,50],[65536,50],[131072,50],[262144,50],[524288,50],[1048576,50],[2097152,30],[4194304,20],[8388608,10],[12582912,10],[16777216,10],[26214400,15],[33554432,22],[44236800,2],[58982400,6],[67108864,6],[134217728,6],[167772160,6]]),Zt=[],en=e=>16*Math.ceil(Number(e)/16),tn=e=>{for(let t=0;t<Zt.length;t++){let n=Zt[t];if(e<=n)return n}return 16*Math.ceil(e/16)},nn=1,rn=()=>nn++,an=async(e,t,n,r)=>{let i=en(n),a=e.device.createBuffer({size:i,usage:GPUBufferUsage.COPY_DST|GPUBufferUsage.MAP_READ});try{let o=e.getCommandEncoder();e.endComputePass(),o.copyBufferToBuffer(t,0,a,0,i),e.flush(),await a.mapAsync(GPUMapMode.READ);let s=a.getMappedRange();if(r){let e=r();return e.set(new Uint8Array(s,0,n)),e}return new Uint8Array(s.slice(0,n))}finally{a.destroy()}},on=class{constructor(e){this.backend=e,this.storageCache=new Map,this.freeBuffers=new Map,this.freeUniformBuffers=new Map,this.buffersPending=[],this.capturedPendingBuffers=new Map;for(let[t]of $t)Zt.push(t),this.freeBuffers.set(t,[]),this.freeUniformBuffers.set(t,[]);this.sessionCount=0}upload(e,t){let n=t.buffer,r=t.byteOffset,i=t.byteLength,a=en(i),o=this.storageCache.get(e);if(!o)throw new Error("gpu data for uploading does not exist");if(Number(o.originalSize)!==i)throw new Error("inconsistent data size. gpu data size=".concat(o.originalSize,", data size=").concat(i));let s=this.backend.device.createBuffer({mappedAtCreation:!0,size:a,usage:GPUBufferUsage.MAP_WRITE|GPUBufferUsage.COPY_SRC}),c=s.getMappedRange();new Uint8Array(c).set(new Uint8Array(n,r,i)),s.unmap();let l=this.backend.device.createCommandEncoder();l.copyBufferToBuffer(s,0,o.gpuData.buffer,0,a),this.backend.device.queue.submit([l.finish()]),s.destroy(),At("verbose",()=>"[WebGPU] GpuDataManager.upload(id=".concat(e,")"))}memcpy(e,t){let n=this.storageCache.get(e);if(!n)throw new Error("source gpu data for memcpy does not exist");let r=this.storageCache.get(t);if(!r)throw new Error("destination gpu data for memcpy does not exist");if(n.originalSize!==r.originalSize)throw new Error("inconsistent source and destination gpu data size");let i=en(n.originalSize),a=this.backend.getCommandEncoder();this.backend.endComputePass(),a.copyBufferToBuffer(n.gpuData.buffer,0,r.gpuData.buffer,0,i)}registerExternalBuffer(e,t,n){let r;if(n){if(r=n[0],e===n[1])return At("verbose",()=>"[WebGPU] GpuDataManager.registerExternalBuffer(size=".concat(t,") => id=").concat(r,", buffer is the same, skip.")),r;if(this.backend.capturedCommandList.has(this.backend.currentSessionId))throw new Error("Registering a different external buffer under graph capture mode is not supported yet.\n             Please use the previous external buffer!")}else r=rn();return this.storageCache.set(r,{gpuData:{id:r,type:0,buffer:e},originalSize:t}),At("verbose",()=>"[WebGPU] GpuDataManager.registerExternalBuffer(size=".concat(t,") => id=").concat(r,", registered.")),r}unregisterExternalBuffer(e){void 0!==e&&(this.storageCache.delete(e),At("verbose",()=>"[WebGPU] GpuDataManager.unregisterExternalBuffer() => id=".concat(e)))}create(e){let t,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:GPUBufferUsage.STORAGE|GPUBufferUsage.COPY_SRC|GPUBufferUsage.COPY_DST,r=tn(e),i=(n&GPUBufferUsage.STORAGE)===GPUBufferUsage.STORAGE,a=(n&GPUBufferUsage.UNIFORM)===GPUBufferUsage.UNIFORM;if(i||a){let e=(i?this.freeBuffers:this.freeUniformBuffers).get(r);t=e&&e.length>0?e.pop():this.backend.device.createBuffer({size:r,usage:n})}else t=this.backend.device.createBuffer({size:r,usage:n});let o={id:rn(),type:0,buffer:t};return this.storageCache.set(o.id,{gpuData:o,originalSize:Number(e)}),At("verbose",()=>"[WebGPU] GpuDataManager.create(size=".concat(e,") => id=").concat(o.id)),o}get(e){var t;return null===(t=this.storageCache.get(e))||void 0===t?void 0:t.gpuData}release(e){let t="bigint"==typeof e?Number(e):e,n=this.storageCache.get(t);if(!n){if(0===this.storageCache.size)return 0;throw new Error("releasing data does not exist")}return At("verbose",()=>"[WebGPU] GpuDataManager.release(id=".concat(t,"), gpuDataId=").concat(n.gpuData.id)),this.storageCache.delete(t),this.buffersPending.push(n.gpuData.buffer),n.originalSize}async download(e,t){let n=this.storageCache.get(Number(e));if(!n)throw new Error("data does not exist");await an(this.backend,n.gpuData.buffer,n.originalSize,t)}refreshPendingBuffers(){if(0!==this.buffersPending.length)if("default"===this.backend.sessionStatus){for(let e of this.buffersPending){let t=$t.get(e.size);if((e.usage&GPUBufferUsage.STORAGE)===GPUBufferUsage.STORAGE){let n=this.freeBuffers.get(e.size)||[];void 0===t||n.length>=t?e.destroy():n.push(e)}else if((e.usage&GPUBufferUsage.UNIFORM)===GPUBufferUsage.UNIFORM){let n=this.freeUniformBuffers.get(e.size)||[];void 0===t||n.length>=t?e.destroy():n.push(e)}else e.destroy()}this.buffersPending=[]}else{let e=this.capturedPendingBuffers.get(this.backend.currentSessionId);e||(e=[],this.capturedPendingBuffers.set(this.backend.currentSessionId,e));for(let t of this.buffersPending)e.push(t);this.buffersPending=[]}}dispose(){this.freeBuffers.forEach(e=>{e.forEach(e=>{e.destroy()})}),this.freeUniformBuffers.forEach(e=>{e.forEach(e=>{e.destroy()})}),this.storageCache.forEach(e=>{e.gpuData.buffer.destroy()}),this.capturedPendingBuffers.forEach(e=>{e.forEach(e=>{e.destroy()})}),this.storageCache=new Map,this.freeBuffers=new Map,this.freeUniformBuffers=new Map,this.capturedPendingBuffers=new Map}onCreateSession(){this.sessionCount+=1}onReleaseSession(e){let t=this.capturedPendingBuffers.get(e);t&&(t.forEach(e=>{e.destroy()}),this.capturedPendingBuffers.delete(e)),this.sessionCount-=1,0===this.sessionCount&&(At("warning",()=>"[WebGPU] Clearing webgpu buffer cache"),this.storageCache.forEach(e=>{e.gpuData.buffer.destroy()}),this.storageCache=new Map)}},sn=function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];return new on(...t)}}),Rl=re(()=>{cn=class{constructor(e){Object.assign(this,e)}get cacheKey(){return this.key||(this.key=Object.getOwnPropertyNames(this).sort().map(e=>"".concat(this[e])).join(";")),this.key}},ln=e=>new cn(e)}),Pl=re(()=>{El(),Tl(),un=64,dn=(e,t)=>{if(3===t)throw new Error("vec3 has same alignment as vec4, use vec4 instead");switch(Number(e)){case 10:return t>1?"vec".concat(t,"<f16>"):"f16";case 1:return t>1?"vec".concat(t,"<f32>"):"f32";case 6:return t>1?"vec".concat(t,"<i32>"):"i32";case 12:return t>1?"vec".concat(t,"<u32>"):"u32";case 7:if(t>1)throw new Error("currently not supported vecX of uint64 yet");return["vec2<u32>","i32"];case 13:if(t>1)throw new Error("currently not supported vecX of uint64 yet");return["vec2<u32>","u32"];case 9:if(4!==t)throw new Error("bool must be vec4");return["u32","vec4<bool>"];case 22:return"i32";case 21:return"u32";default:throw new Error("Unknown data type: ".concat(e))}},hn=function(e){let t=dn(e,arguments.length>1&&void 0!==arguments[1]?arguments[1]:1);return"string"==typeof t?t:t[0]},fn=function(e){let t=dn(e,arguments.length>1&&void 0!==arguments[1]?arguments[1]:1);return"string"==typeof t?t:t[1]},pn=function(){let e=[];for(var t=arguments.length,n=new Array(t),r=0;r<t;r++)n[r]=arguments[r];return n.forEach(t=>{0!==t.length&&e.push({type:12,data:t},{type:12,data:Rt.computeStrides(t)})}),e},mn=e=>e%4===0?4:e%2===0?2:1,gn=function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"f32",t=arguments.length>1?arguments[1]:void 0,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"0";return t&&1!==t?"vec".concat(t,"<").concat(e,">(").concat(n,")"):"".concat(e,"(").concat(n,")")},yn=(e,t,n)=>"f32"===e?n:1===t?"f32(".concat(n,")"):"vec".concat(t,"<f32>(").concat(n,")"),vn=(e,t)=>4===t?"(".concat(e,".x + ").concat(e,".y + ").concat(e,".z + ").concat(e,".w)"):2===t?"(".concat(e,".x + ").concat(e,".y)"):3===t?"(".concat(e,".x + ").concat(e,".y + ").concat(e,".z)"):e,wn=(e,t,n,r)=>e.startsWith("uniforms.")&&n>4?"string"==typeof t?"f16"===r?"".concat(e,"[(").concat(t,") / 8][(").concat(t,") % 8 / 4][(").concat(t,") % 8 % 4]"):"".concat(e,"[(").concat(t,") / 4][(").concat(t,") % 4]"):"f16"===r?"".concat(e,"[").concat(Math.floor(t/8),"][").concat(Math.floor(t%8/4),"][").concat(t%8%4,"]"):"".concat(e,"[").concat(Math.floor(t/4),"][").concat(t%4,"]"):n>1?"".concat(e,"[").concat(t,"]"):e,bn=(e,t,n,r,i)=>{let a="number"==typeof n,o=a?n:n.length,s=[...new Array(o).keys()],c=o<2?"u32":o<=4?"vec".concat(o,"<u32>"):"array<u32, ".concat(o,">"),l=dn(t,i),u="string"==typeof l?l:l[1],d="string"==typeof l?l:l[0],h={indices:c,value:u,storage:d,tensor:t},f=e=>"string"==typeof e?e:"".concat(e,"u"),p={offsetToIndices:!1,indicesToOffset:!1,broadcastedIndicesToOffset:!1,set:!1,setByIndices:!1,get:!1,getByIndices:!1},m=a?"uniforms.":"",g="".concat(m).concat(e,"_shape"),y="".concat(m).concat(e,"_strides"),v="";for(let N=0;N<o-1;N++)v+="\n    let dim".concat(N," = current / ").concat(wn(y,N,o),";\n    let rest").concat(N," = current % ").concat(wn(y,N,o),";\n    indices[").concat(N,"] = dim").concat(N,";\n    current = rest").concat(N,";\n    ");v+="indices[".concat(o-1,"] = current;");let w=o<2?"":"\n  fn o2i_".concat(e,"(offset: u32) -> ").concat(h.indices," {\n    var indices: ").concat(h.indices,";\n    var current = offset;\n    ").concat(v,"\n    return indices;\n  }"),b=[];if(o>=2)for(let N=o-1;N>=0;N--)b.push("".concat(wn(y,N,o)," * (indices[").concat(N,"])"));let _=o<2?"":"\n  fn i2o_".concat(e,"(indices: ").concat(h.indices,") -> u32 {\n    return ").concat(b.join("+"),";\n  }"),x=function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];return 0===o?"0u":"".concat(h.indices,"(").concat(t.map(f).join(","),")")},E=(e,t)=>"".concat(o<2?e:wn(e,t,o)),S={},k=(t,n)=>(()=>{if(h.storage===h.value)return"".concat(e,"[").concat(t,"]=").concat(n,";");if("vec2<u32>"===h.storage&&"i32"===h.value)return"".concat(e,"[").concat(t,"]=vec2<u32>(u32(").concat(n,"), select(0u, 0xFFFFFFFFu, ").concat(n," < 0));");if("vec2<u32>"===h.storage&&"u32"===h.value)return"".concat(e,"[").concat(t,"]=vec2<u32>(u32(").concat(n,"), 0u);");if("u32"===h.storage&&"vec4<bool>"===h.value)return"".concat(e,"[").concat(t,"]=dot(vec4<u32>(0x1, 0x100, 0x10000, 0x1000000), vec4<u32>(").concat(n,"));");throw new Error("not supported combination of storage type ".concat(h.storage," and value type ").concat(h.value," yet"))})(),T=t=>(()=>{if(h.storage===h.value)return"".concat(e,"[").concat(t,"]");if("vec2<u32>"===h.storage&&"i32"===h.value)return"i32(".concat(e,"[").concat(t,"].x)");if("vec2<u32>"===h.storage&&"u32"===h.value)return"u32(".concat(e,"[").concat(t,"].x)");if("u32"===h.storage&&"vec4<bool>"===h.value)return"vec4<bool>(bool(".concat(e,"[").concat(t,"] & 0xFFu), bool(").concat(e,"[").concat(t,"] & 0xFF00u), bool(").concat(e,"[").concat(t,"] & 0xFF0000u), bool(").concat(e,"[").concat(t,"] & 0xFF000000u))");throw new Error("not supported combination of storage type ".concat(h.storage," and value type ").concat(h.value," yet"))})(),I=o<2?"":"\n  fn get_".concat(e,"ByIndices(indices: ").concat(h.indices,") -> ").concat(u," {\n    return ").concat(T("i2o_".concat(e,"(indices)")),";\n  }"),C=o<2?"":(()=>{let t=s.map(e=>"d".concat(e,": u32")).join(", "),n=s.map(e=>"d".concat(e)).join(", ");return"\n  fn get_".concat(e,"(").concat(t,") -> ").concat(u," {\n    return get_").concat(e,"ByIndices(").concat(x(n),");\n  }")})(),A=o<2?"":"\n  fn set_".concat(e,"ByIndices(indices: ").concat(h.indices,", value: ").concat(u,") {\n    ").concat(k("i2o_".concat(e,"(indices)"),"value"),"\n  }"),O=o<2?"":(()=>{let t=s.map(e=>"d".concat(e,": u32")).join(", "),n=s.map(e=>"d".concat(e)).join(", ");return"\n  fn set_".concat(e,"(").concat(t,", value: ").concat(u,") {\n    set_").concat(e,"ByIndices(").concat(x(n),", value);\n  }")})();return{impl:()=>{let e=[],t=!1;return p.offsetToIndices&&(e.push(w),t=!0),p.indicesToOffset&&(e.push(_),t=!0),p.broadcastedIndicesToOffset&&(Object.values(S).forEach(t=>e.push(t)),t=!0),p.set&&(e.push(O),t=!0),p.setByIndices&&(e.push(A),t=!0),p.get&&(e.push(C),t=!0),p.getByIndices&&(e.push(I),t=!0),!a&&t&&e.unshift("const ".concat(g," = ").concat(h.indices,"(").concat(n.join(","),");"),"const ".concat(y," = ").concat(h.indices,"(").concat(Rt.computeStrides(n).join(","),");")),e.join("\n")},type:h,offsetToIndices:t=>(p.offsetToIndices=!0,o<2?t:"o2i_".concat(e,"(").concat(t,")")),indicesToOffset:t=>(p.indicesToOffset=!0,o<2?t:"i2o_".concat(e,"(").concat(t,")")),broadcastedIndicesToOffset:(t,n)=>{p.broadcastedIndicesToOffset=!0;let r="".concat(n.name,"broadcastedIndicesTo").concat(e,"Offset");if(r in S)return"".concat(r,"(").concat(t,")");let i=[];for(let e=o-1;e>=0;e--){let t=n.indicesGet("outputIndices",e+n.rank-o);i.push("".concat(E(y,e)," * (").concat(t," % ").concat(E(g,e),")"))}return S[r]="fn ".concat(r,"(outputIndices: ").concat(n.type.indices,") -> u32 {\n             return ").concat(i.length>0?i.join("+"):"0u",";\n           }"),"".concat(r,"(").concat(t,")")},indices:x,indicesGet:E,indicesSet:(e,t,n)=>o<2?"".concat(e,"=").concat(n,";"):"".concat(wn(e,t,o),"=").concat(n,";"),set:function(){for(var t=arguments.length,n=new Array(t),r=0;r<t;r++)n[r]=arguments[r];if(n.length!==o+1)throw new Error("indices length must be ".concat(o));let i=n[o];if("string"!=typeof i)throw new Error("value must be string");let a=n.slice(0,o).map(f).join(",");return 0===o?k("0u",i):1===o?k(a[0],i):(p.set=!0,p.setByIndices=!0,p.indicesToOffset=!0,"set_".concat(e,"(").concat(a,", ").concat(i,")"))},setByOffset:k,setByIndices:(t,n)=>o<2?k(t,n):(p.setByIndices=!0,p.indicesToOffset=!0,"set_".concat(e,"ByIndices(").concat(t,", ").concat(n,");")),get:function(){for(var t=arguments.length,n=new Array(t),r=0;r<t;r++)n[r]=arguments[r];if(n.length!==o)throw new Error("indices length must be ".concat(o));let i=n.map(f).join(",");return 0===o?T("0u"):1===o?T(i[0]):(p.get=!0,p.getByIndices=!0,p.indicesToOffset=!0,"get_".concat(e,"(").concat(i,")"))},getByOffset:T,getByIndices:t=>o<2?T(t):(p.getByIndices=!0,p.indicesToOffset=!0,"get_".concat(e,"ByIndices(").concat(t,")")),usage:r,name:e,strides:y,shape:g,rank:o}},_n=function(e,t,n){return bn(e,t,n,"input",arguments.length>3&&void 0!==arguments[3]?arguments[3]:1)},xn=function(e,t,n){return bn(e,t,n,"output",arguments.length>3&&void 0!==arguments[3]?arguments[3]:1)},En=(e,t,n)=>bn(e,t,n,"atomicOutput",1),Sn=function(e,t,n){return bn(e,t,n,"internal",arguments.length>3&&void 0!==arguments[3]?arguments[3]:1)},kn=class{constructor(e,t){this.normalizedDispatchGroup=e,this.limits=t,this.internalVariables=[],this.variables=[],this.uniforms=[],this.variableIndex=0}guardAgainstOutOfBoundsWorkgroupSizes(e){return"if (global_idx >= ".concat("number"==typeof e?"".concat(e,"u"):e,") { return; }")}mainStart(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:un,t="number"==typeof e?e:e[0],n="number"==typeof e?1:e[1],r="number"==typeof e?1:e[2];if(t>this.limits.maxComputeWorkgroupSizeX||n>this.limits.maxComputeWorkgroupSizeY||r>this.limits.maxComputeWorkgroupSizeZ)throw new Error("workgroup size [".concat(t,", ").concat(n,", ").concat(r,"] exceeds the maximum workgroup size [").concat(this.limits.maxComputeWorkgroupSizeX,", ").concat(this.limits.maxComputeWorkgroupSizeY,", ").concat(this.limits.maxComputeWorkgroupSizeZ,"]."));if(t*n*r>this.limits.maxComputeInvocationsPerWorkgroup)throw new Error("workgroup size [".concat(t,", ").concat(n,", ").concat(r,"] exceeds the maximum workgroup invocations ").concat(this.limits.maxComputeInvocationsPerWorkgroup,"."));let i=1===this.normalizedDispatchGroup[1]&&1===this.normalizedDispatchGroup[2],a=i?"@builtin(global_invocation_id) global_id : vec3<u32>,\n    @builtin(workgroup_id) workgroup_id : vec3<u32>,\n    @builtin(local_invocation_index) local_idx : u32,\n    @builtin(local_invocation_id) local_id : vec3<u32>":"@builtin(global_invocation_id) global_id : vec3<u32>,\n                                             @builtin(local_invocation_id) local_id : vec3<u32>,\n    @builtin(local_invocation_index) local_idx : u32,\n    @builtin(workgroup_id) workgroup_id : vec3<u32>,\n    @builtin(num_workgroups) num_workgroups : vec3<u32>",o=i?"let global_idx = global_id.x;\n         let workgroup_index = workgroup_id.x;":"let workgroup_index = workgroup_id.z * num_workgroups[0] * num_workgroups[1] +\n             workgroup_id.y * num_workgroups[0] + workgroup_id.x;\n         let global_idx = workgroup_index * ".concat(t*n*r,"u + local_idx;");return"@compute @workgroup_size(".concat(t,", ").concat(n,", ").concat(r,")\n  fn main(").concat(a,") {\n    ").concat(o,"\n  ")}appendVariableUniforms(e){0!==e.rank&&(e.shape.startsWith("uniforms.")&&this.uniforms.push({name:e.shape.replace("uniforms.",""),type:"u32",length:e.rank}),e.strides.startsWith("uniforms.")&&this.uniforms.push({name:e.strides.replace("uniforms.",""),type:"u32",length:e.rank}))}declareVariable(e,t){if("internal"===e.usage)throw new Error("cannot use internal variable with declareVariable(). use registerInternalVariables() instead.");this.variables.push(e),this.appendVariableUniforms(e);let n="input"===e.usage?"read":"read_write",r="atomicOutput"===e.usage?"atomic<i32>":e.type.storage;return"@group(0) @binding(".concat(t,") var<storage, ").concat(n,"> ").concat(e.name,": array<").concat(r,">;")}declareVariables(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];return t.map(e=>this.declareVariable(e,this.variableIndex++)).join("\n")}registerInternalVariable(e){if("internal"!==e.usage)throw new Error("cannot use input or output variable with registerInternalVariable(). use declareVariables() instead.");this.internalVariables.push(e),this.appendVariableUniforms(e)}registerInternalVariables(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];return t.forEach(e=>this.registerInternalVariable(e)),this}registerUniform(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1;return this.uniforms.push({name:e,type:t,length:n}),this}registerUniforms(e){return this.uniforms=this.uniforms.concat(e),this}uniformDeclaration(){if(0===this.uniforms.length)return"";let e=[];for(let{name:t,type:n,length:r}of this.uniforms)if(r&&r>4)"f16"===n?e.push("@align(16) ".concat(t,":array<mat2x4<").concat(n,">, ").concat(Math.ceil(r/8),">")):e.push("".concat(t,":array<vec4<").concat(n,">, ").concat(Math.ceil(r/4),">"));else{let i=null==r||1===r?n:"vec".concat(r,"<").concat(n,">");e.push("".concat(t,":").concat(i))}return"\n      struct Uniforms { ".concat(e.join(", ")," };\n      @group(0) @binding(").concat(this.variableIndex,") var<uniform> uniforms: Uniforms;")}get additionalImplementations(){return this.uniformDeclaration()+this.variables.map(e=>e.impl()).join("\n")+this.internalVariables.map(e=>e.impl()).join("\n")}get variablesInfo(){if(0===this.uniforms.length)return;let e=e=>[12,10,1,6][["u32","f16","f32","i32"].indexOf(e)];return this.uniforms.map(t=>{var n;return[e(t.type),null!==(n=t.length)&&void 0!==n?n:1]})}},Tn=(e,t)=>new kn(e,t)}),Dl=re(()=>{El(),Tl(),Rl(),Pl(),In=(e,t)=>{if(!e||1!==e.length)throw new Error("Transpose requires 1 input.");if(0!==t.length&&t.length!==e[0].dims.length)throw new Error("perm size ".concat(t.length," does not match input rank ").concat(e[0].dims.length))},Cn=(e,t)=>0!==t.length?t:[...new Array(e).keys()].reverse(),An=(e,t)=>Rt.sortBasedOnPerm(e,Cn(e.length,t)),On=(e,t,n,r)=>{let i="fn perm(i: ".concat(r.type.indices,") -> ").concat(n.type.indices," {\n    var a: ").concat(n.type.indices,";");for(let a=0;a<t;++a)i+="a[".concat(e[a],"]=i[").concat(a,"];");return i+"return a;}"},Nn=(e,t)=>{let n=[],r=[];for(let i=0;i<e.length;++i)1!==e[i]&&n.push(e[i]),1!==e[t[i]]&&r.push(t[i]);return{newShape:n,newPerm:r}},Rn=(e,t)=>{let n=0;for(let r=0;r<e.length;++r)if(1!==t[e[r]]){if(e[r]<n)return!1;n=e[r]}return!0},Pn=(e,t)=>{let n,r=e.dataType,i=e.dims.length,a=Cn(i,t),o=An(e.dims,a),s=e.dims,c=o;if(i<2||Rn(a,e.dims))return n=e=>{let t=_n("input",r,s,4),n=xn("output",r,c,4);return"\n  ".concat(e.registerUniform("output_size","u32").declareVariables(t,n),"\n  ").concat(e.mainStart(),"\n    ").concat(e.guardAgainstOutOfBoundsWorkgroupSizes("uniforms.output_size"),"\n    output[global_idx] = input[global_idx];\n  }")},{name:"TransposeCopy",shaderCache:{inputDependencies:["type"]},getRunData:()=>{let t=Rt.size(o);return{outputs:[{dims:o,dataType:e.dataType}],dispatchGroup:{x:Math.ceil(t/64/4)},programUniforms:[{type:12,data:Math.ceil(t/4)}]}},getShaderSource:n};let{newShape:l,newPerm:u}=Nn(e.dims,a),d=Rt.areEqual(u,[2,3,1]),h=Rt.areEqual(u,[3,1,2]);if(2===l.length||d||h){s=d?[l[0],l[1]*l[2]]:h?[l[0]*l[1],l[2]]:l,c=[s[1],s[0]];let t=16;return n=e=>{let n=_n("a",r,s.length),i=xn("output",r,c.length);return"\n  ".concat(e.registerUniform("output_size","u32").declareVariables(n,i),"\n  var<workgroup> tile : array<array<").concat(i.type.value,", ").concat(t+1,">, ").concat(t,">;\n  ").concat(e.mainStart([t,t,1]),"\n    let stride = (uniforms.output_shape[1] - 1) / ").concat(t," + 1;\n    let workgroup_id_x = workgroup_index % stride;\n    let workgroup_id_y = workgroup_index / stride;\n    let input_col = workgroup_id_y * ").concat(t,"u + local_id.x;\n    let input_row = workgroup_id_x * ").concat(t,"u + local_id.y;\n    if (input_row < uniforms.a_shape[0] && input_col < uniforms.a_shape[1]) {\n      tile[local_id.y][local_id.x] = ").concat(n.getByIndices("".concat(n.type.indices,"(input_row, input_col)")),";\n    }\n    workgroupBarrier();\n\n    let output_col = workgroup_id_x * ").concat(t,"u + local_id.x;\n    let output_row = workgroup_id_y * ").concat(t,"u + local_id.y;\n    if (output_row < uniforms.output_shape[0] && output_col < uniforms.output_shape[1]) {\n      ").concat(i.setByIndices("".concat(i.type.indices,"(output_row, output_col)"),"tile[local_id.x][local_id.y]"),"\n    }\n  }")},{name:"TransposeShared",shaderCache:{inputDependencies:["type"]},getRunData:()=>{let n=Rt.size(o);return{outputs:[{dims:o,dataType:e.dataType}],dispatchGroup:{x:Math.ceil(c[1]/t),y:Math.ceil(c[0]/t)},programUniforms:[{type:12,data:n},...pn(s,c)]}},getShaderSource:n}}return n=e=>{let t=_n("a",r,s.length),n=xn("output",r,c.length);return"\n  ".concat(e.registerUniform("output_size","u32").declareVariables(t,n),"\n\n  ").concat(On(a,i,t,n),"\n\n  ").concat(e.mainStart(),"\n    ").concat(e.guardAgainstOutOfBoundsWorkgroupSizes("uniforms.output_size"),"\n\n    let indices = ").concat(n.offsetToIndices("global_idx"),";\n    let aIndices = perm(indices);\n\n    ").concat(n.setByOffset("global_idx",t.getByIndices("aIndices")),"\n  }")},{name:"Transpose",shaderCache:{hint:"".concat(t),inputDependencies:["rank"]},getRunData:()=>{let t=Rt.size(o);return{outputs:[{dims:o,dataType:e.dataType}],dispatchGroup:{x:Math.ceil(t/64)},programUniforms:[{type:12,data:t},...pn(s,c)]}},getShaderSource:n}},Dn=(e,t)=>{In(e.inputs,t.perm),e.compute(Pn(e.inputs[0],t.perm))},zn=e=>ln({perm:e.perm})}),zl=re(()=>{El(),Tl(),Pl(),Ml(),Dl(),Mn={max:"select(bestValue, candidate, candidate > bestValue)",min:"select(bestValue, candidate, candidate < bestValue)",mean:"bestValue + candidate",sum:"bestValue + candidate",prod:"bestValue * candidate",sumSquare:"bestValue + candidate * candidate",logSumExp:"bestValue + exp(candidate)",l1:"bestValue + abs(candidate)",l2:"bestValue + candidate * candidate",logSum:"bestValue + candidate"},Ln={max:"select(bestValue, candidate, candidate > bestValue)",min:"select(bestValue, candidate, candidate < bestValue)",mean:"bestValue + candidate",sum:"bestValue + candidate",prod:"bestValue * candidate",sumSquare:"bestValue + candidate",logSumExp:"bestValue + candidate",l1:"bestValue + candidate",l2:"bestValue + candidate",logSum:"bestValue + candidate"},Un={max:"_A[offset]",min:"_A[offset]",mean:"0",sum:"0",prod:"1",sumSquare:"0",logSumExp:"0",l1:"0",l2:"0",logSum:"0"},Bn={max:"bestValue",min:"bestValue",sum:"bestValue",prod:"bestValue",sumSquare:"bestValue",logSumExp:"log(bestValue)",l1:"bestValue",l2:"sqrt(bestValue)",logSum:"log(bestValue)"},Fn=(e,t)=>{let n=[];for(let r=t-e;r<t;++r)n.push(r);return n},jn=(e,t)=>{let n=[],r=e.length;for(let a=0;a<r;a++)-1===t.indexOf(a)&&n.push(e[a]);let i=t.map(t=>e[t]);return[n,i]},Vn=(e,t)=>{let n=e.length+t.length,r=[],i=0;for(let a=0;a<n;a++)-1===t.indexOf(a)?r.push(e[i++]):r.push(1);return r},qn=(e,t)=>{for(let n=0;n<e.length;++n)if(e[e.length-n-1]!==t-1-n)return!1;return!0},Hn=(e,t)=>{let n=[];if(!qn(e,t)){for(let r=0;r<t;++r)-1===e.indexOf(r)&&n.push(r);e.forEach(e=>n.push(e))}return n},Wn=(e,t,n,r,i,a,o)=>{let s=n[0].dims,c=Rt.size(a),l=Rt.size(o),u=_n("_A",n[0].dataType,s),d=xn("output",i,a),h=64;1===c&&(h=256);let f="\n          var<workgroup> aBestValues : array<f32, ".concat(h,">;\n       ");return{name:e,shaderCache:{hint:"".concat(t,";").concat(h),inputDependencies:["type"]},getShaderSource:e=>"\n        ".concat(e.registerUniform("reduceSize","u32").declareVariables(u,d),"\n        ").concat(f,"\n        fn DIV_CEIL(a : u32, b : u32) -> u32 {\n          return ((a - 1u) / b + 1u);\n         }\n         ").concat(e.mainStart(h),"\n\n          let outputIndex = global_idx / ").concat(h,";\n          let offset = outputIndex * uniforms.reduceSize;\n\n          var bestValue = f32(").concat(Un[r],");\n          let Length = uniforms.reduceSize;\n          for (var k = local_idx; k < Length; k = k + ").concat(h,") {\n           let candidate = f32(").concat(u.getByOffset("offset + k"),");\n           bestValue = ").concat(Mn[r],";\n          }\n          aBestValues[local_idx] = bestValue;\n          workgroupBarrier();\n\n         var reduceSize = min(Length, ").concat(h,"u);\n         for (var currentSize = reduceSize / 2u; reduceSize > 1u;\n             currentSize = reduceSize / 2u) {\n           let interval = DIV_CEIL(reduceSize, 2u);\n           if (local_idx < currentSize) {\n            let candidate = aBestValues[local_idx + interval];\n            bestValue = ").concat(Ln[r],";\n            aBestValues[local_idx] = bestValue;\n           }\n           reduceSize = interval;\n           workgroupBarrier();\n         }\n\n         if (local_idx == 0u) {\n          ").concat(d.setByOffset("outputIndex","".concat("mean"===r?"".concat(d.type.storage,"(bestValue / f32(uniforms.reduceSize))"):"".concat(d.type.storage,"(").concat(Bn[r],")"))),";\n         }\n        }"),getRunData:()=>({outputs:[{dims:a,dataType:i}],dispatchGroup:{x:c},programUniforms:[{type:12,data:l}]})}},Gn=(e,t,n,r)=>{let i=1===e.inputs.length?n:or(e.inputs,n),a=i.axes;0===a.length&&!i.noopWithEmptyAxes&&(a=e.inputs[0].dims.map((e,t)=>t));let o=Rt.normalizeAxes(a,e.inputs[0].dims.length),s=o,c=e.inputs[0],l=Hn(s,e.inputs[0].dims.length);l.length>0&&(c=e.compute(Pn(e.inputs[0],l),{inputs:[0],outputs:[-1]})[0],s=Fn(s.length,c.dims.length));let[u,d]=jn(c.dims,s),h=u;i.keepDims&&(h=Vn(u,o)),e.compute(Wn(t,i.cacheKey,[c],r,e.inputs[0].dataType,h,d),{inputs:[c]})},Kn=(e,t)=>{Gn(e,"ReduceMeanShared",t,"mean")},Qn=(e,t)=>{Gn(e,"ReduceL1Shared",t,"l1")},Xn=(e,t)=>{Gn(e,"ReduceL2Shared",t,"l2")},Yn=(e,t)=>{Gn(e,"ReduceLogSumExpShared",t,"logSumExp")},Jn=(e,t)=>{Gn(e,"ReduceMaxShared",t,"max")},$n=(e,t)=>{Gn(e,"ReduceMinShared",t,"min")},Zn=(e,t)=>{Gn(e,"ReduceProdShared",t,"prod")},er=(e,t)=>{Gn(e,"ReduceSumShared",t,"sum")},tr=(e,t)=>{Gn(e,"ReduceSumSquareShared",t,"sumSquare")},nr=(e,t)=>{Gn(e,"ReduceLogSumShared",t,"logSum")}}),Ml=re(()=>{El(),Tl(),Rl(),Pl(),zl(),rr=e=>{if(!e||0===e.length||e.length>2)throw new Error("Reduce op requires 1 or 2 inputs.");if(2===e.length&&1!==e[1].dims.length)throw new Error("Invalid axes input dims.")},ir=e=>["","","var value = ".concat(e.getByIndices("input_indices"),";"),""],ar=function(e,t,n,r,i,a){let o=arguments.length>6&&void 0!==arguments[6]&&arguments[6],s=arguments.length>7&&void 0!==arguments[7]&&arguments[7],c=[],l=n[0].dims,u=l.length,d=Rt.normalizeAxes(i,u),h=!s&&0===d.length;l.forEach((e,t)=>{h||d.indexOf(t)>=0?o&&c.push(1):c.push(e)});let f=c.length,p=Rt.size(c);return{name:e,shaderCache:t,getShaderSource:e=>{let t=[],i=_n("_A",n[0].dataType,u),s=xn("output",a,f),c=r(i,s,d),p=c[2];for(let n=0,r=0;n<u;n++)h||d.indexOf(n)>=0?(o&&r++,p="for(var j".concat(n,": u32 = 0; j").concat(n," < ").concat(l[n],"; j").concat(n,"++) {\n                  ").concat(c[2].includes("last_index")?"let last_index = j".concat(n,";"):"","\n                  ").concat(i.indicesSet("input_indices",n,"j".concat(n)),"\n                  ").concat(p,"\n                }")):(t.push("".concat(i.indicesSet("input_indices",n,s.indicesGet("output_indices",r)),";")),r++);return"\n\n        ".concat(e.registerUniform("output_size","u32").declareVariables(i,s),"\n\n        ").concat(e.mainStart(),"\n          ").concat(e.guardAgainstOutOfBoundsWorkgroupSizes("uniforms.output_size"),"\n          var input_indices: ").concat(i.type.indices,";\n          let output_indices = ").concat(s.offsetToIndices("global_idx"),";\n\n          ").concat(t.join("\n"),"\n          ").concat(c[0],"       // init ops for reduce max/min\n          ").concat(c[1],"\n          ").concat(p,"\n          ").concat(c[3],"\n          ").concat(4===c.length?s.setByOffset("global_idx","value"):c.slice(4).join("\n"),"\n        }")},getRunData:()=>({outputs:[{dims:c,dataType:a}],dispatchGroup:{x:Math.ceil(p/64)},programUniforms:[{type:12,data:p},...pn(l,c)]})}},or=(e,t)=>{let n=[];return e[1].dims[0]>0&&e[1].getBigInt64Array().forEach(e=>n.push(Number(e))),ln({axes:n,keepDims:t.keepDims,noopWithEmptyAxes:t.noopWithEmptyAxes})},sr=(e,t,n,r)=>{let i=e.inputs,a=1===i.length?n:or(i,n);e.compute(ar(t,{hint:a.cacheKey,inputDependencies:["rank"]},[i[0]],a.noopWithEmptyAxes&&0===a.axes.length?ir:r,a.axes,i[0].dataType,a.keepDims,a.noopWithEmptyAxes),{inputs:[0]})},cr=(e,t)=>{rr(e.inputs),sr(e,"ReduceLogSum",t,(e,t)=>["var value = ".concat(t.type.storage,"(0);"),"","value += ".concat(e.getByIndices("input_indices"),";"),"value = log(value);"])},lr=(e,t)=>{rr(e.inputs),sr(e,"ReduceL1",t,(e,t)=>["var value = ".concat(t.type.storage,"(0);"),"","value += abs(".concat(e.getByIndices("input_indices"),");"),""])},ur=(e,t)=>{rr(e.inputs),sr(e,"ReduceL2",t,(e,t)=>["var t = ".concat(t.type.value,"(0); var value = ").concat(t.type.value,"(0);"),"","t = ".concat(e.getByIndices("input_indices"),"; value += (t * t);"),"value = sqrt(value);"])},dr=(e,t)=>{rr(e.inputs),sr(e,"ReduceLogSumExp",t,(e,t)=>["var value = ".concat(t.type.storage,"(0);"),"","value += exp(".concat(e.getByIndices("input_indices"),");"),"value = log(value);"])},hr=(e,t)=>{rr(e.inputs),sr(e,"ReduceMax",t,(e,t,n)=>{let r=[];for(let i=0;i<e.rank;i++)(n.indexOf(i)>=0||0===n.length)&&r.push(e.indicesSet("input_indices",i,0));return["".concat(r.join("\n")),"var value = ".concat(e.getByIndices("input_indices"),";"),"value = max(value, ".concat(e.getByIndices("input_indices"),");"),""]})},fr=(e,t)=>{rr(e.inputs),sr(e,"ReduceMean",t,(t,n,r)=>{let i=1;for(let a=0;a<t.rank;a++)(r.indexOf(a)>=0||0===r.length)&&(i*=e.inputs[0].dims[a]);return["var sum = f32(0);","","sum += f32(".concat(t.getByIndices("input_indices"),");"),"let value = ".concat(n.type.value,"(sum / ").concat(i,");")]})},pr=(e,t)=>{rr(e.inputs),sr(e,"ReduceMin",t,(e,t,n)=>{let r=[];for(let i=0;i<e.rank;i++)(n.indexOf(i)>=0||0===n.length)&&r.push("input_indices[".concat(i,"] = 0;"));return["".concat(r.join("\n")),"var value = ".concat(e.getByIndices("input_indices"),";"),"value = min(value, ".concat(e.getByIndices("input_indices"),");"),""]})},mr=(e,t)=>{rr(e.inputs),sr(e,"ReduceProd",t,(e,t)=>["var value = ".concat(t.type.storage,"(1);"),"","value *= ".concat(e.getByIndices("input_indices"),";"),""])},gr=(e,t)=>{rr(e.inputs),sr(e,"ReduceSum",t,(e,t)=>["var value = ".concat(t.type.storage,"(0);"),"","value += ".concat(e.getByIndices("input_indices"),";"),""])},yr=(e,t)=>{rr(e.inputs),sr(e,"ReduceSumSquare",t,(e,t)=>["var t = ".concat(t.type.value,"(0); var value = ").concat(t.type.value,"(0);"),"","t = ".concat(e.getByIndices("input_indices"),"; value += t * t;"),""])},vr=(e,t,n)=>{if(0===t.length)return n;let r=1,i=1;for(let a=0;a<t.length;a++)-1===t.indexOf(a)?r*=e[a]:i*=e[a];return i<32&&r>1024},wr=(e,t)=>{vr(e.inputs[0].dims,t.axes,t.noopWithEmptyAxes)?fr(e,t):Kn(e,t)},br=(e,t)=>{vr(e.inputs[0].dims,t.axes,t.noopWithEmptyAxes)?lr(e,t):Qn(e,t)},_r=(e,t)=>{vr(e.inputs[0].dims,t.axes,t.noopWithEmptyAxes)?ur(e,t):Xn(e,t)},xr=(e,t)=>{vr(e.inputs[0].dims,t.axes,t.noopWithEmptyAxes)?dr(e,t):Yn(e,t)},Er=(e,t)=>{vr(e.inputs[0].dims,t.axes,t.noopWithEmptyAxes)?hr(e,t):Jn(e,t)},Sr=(e,t)=>{vr(e.inputs[0].dims,t.axes,t.noopWithEmptyAxes)?pr(e,t):$n(e,t)},kr=(e,t)=>{vr(e.inputs[0].dims,t.axes,t.noopWithEmptyAxes)?mr(e,t):Zn(e,t)},Tr=(e,t)=>{vr(e.inputs[0].dims,t.axes,t.noopWithEmptyAxes)?gr(e,t):er(e,t)},Ir=(e,t)=>{vr(e.inputs[0].dims,t.axes,t.noopWithEmptyAxes)?yr(e,t):tr(e,t)},Cr=(e,t)=>{vr(e.inputs[0].dims,t.axes,t.noopWithEmptyAxes)?cr(e,t):nr(e,t)}}),Ll=re(()=>{El(),Rl(),Ml(),Ar=e=>{if(!e||0===e.length||e.length>2)throw new Error("ArgMinMaxOp op requires 1 or 2 inputs.");if(1!==e[0].dataType)throw new Error("Invalid input type.")},Or=(e,t)=>{Ar(e.inputs);e.compute(ar("ArgMin",{hint:t.cacheKey,inputDependencies:["rank"]},[e.inputs[0]],(e,n,r)=>{let i=[];for(let t=0;t<e.rank;t++)(r.indexOf(t)>=0||0===r.length)&&i.push("input_indices[".concat(t,"] = 0;"));return["".concat(i.join("\n")),"var value = ".concat(e.getByIndices("input_indices"),";\nvar best_index : i32 = 0;"),"if (".concat(e.getByIndices("input_indices")," ").concat(t.selectLastIndex>0?"<=":"<"," value) {\n         value = ").concat(e.getByIndices("input_indices"),";\n         best_index = i32(last_index);\n       }"),"",n.setByOffset("global_idx","best_index")]},[t.axis],7,t.keepDims),{inputs:[0]})},Nr=(e,t)=>{Ar(e.inputs);e.compute(ar("argMax",{hint:t.cacheKey,inputDependencies:["rank"]},[e.inputs[0]],(e,n,r)=>{let i=[];for(let t=0;t<e.rank;t++)(r.indexOf(t)>=0||0===r.length)&&i.push("input_indices[".concat(t,"] = 0;"));return["".concat(i.join("\n")),"var value = ".concat(e.getByIndices("input_indices"),";\nvar best_index : i32 = 0;"),"if (".concat(e.getByIndices("input_indices")," ").concat(t.selectLastIndex>0?">=":">"," value) {\n         value = ").concat(e.getByIndices("input_indices"),";\n         best_index = i32(last_index);\n       }"),"",n.setByOffset("global_idx","best_index")]},[t.axis],7,t.keepDims),{inputs:[0]})},Rr=e=>ln(e)}),Ul=re(()=>{El(),Tl(),Ol(),Pl(),Pr=(e,t)=>{let n=e[0],r=e[1],i=e[2],a=e[3],o=e[4],s=e[5];if(o&&s)throw new Error("Attention cannot have both past and attention_bias");if(3!==n.dims.length)throw new Error('Input "input" must have 3 dimensions');let c=n.dims[0],l=n.dims[1],u=n.dims[2];if(1!==i.dims.length)throw new Error('Input "bias" is expected to have 1 dimensions');if(2!==r.dims.length)throw new Error('Input "weights" is expected to have 2 dimensions');if(r.dims[0]!==u)throw new Error("Input 1 dimension 0 should have same length as dimension 2 of input 0");if(i.dims[0]!==r.dims[1])throw new Error('Input "bias" dimension 0 should have same length as dimension 1 of input "weights"');let d=i.dims[0]/3,h=d,f=h;if(t.qkvHiddenSizes.length>0){if(3!==t.qkvHiddenSizes.length)throw new Error("qkv_hidden_sizes attribute should have 3 elements");for(let e of t.qkvHiddenSizes)if(e%t.numHeads!==0)throw new Error("qkv_hidden_sizes should be divisible by num_heads");d=t.qkvHiddenSizes[0],h=t.qkvHiddenSizes[1],f=t.qkvHiddenSizes[2]}let p=l;if(d!==h)throw new Error("qkv_hidden_sizes first element should be same as the second");if(i.dims[0]!==d+h+f)throw new Error('Input "bias" dimension 0 should have same length as sum of Q/K/V hidden sizes');let m=0;if(o){if(h!==f)throw new Error('Input "past" expect k_hidden_size == v_hidden_size');if(5!==o.dims.length)throw new Error('Input "past" must have 5 dimensions');if(2!==o.dims[0])throw new Error('Input "past" first dimension must be 2');if(o.dims[1]!==c)throw new Error('Input "past" second dimension must be batch_size');if(o.dims[2]!==t.numHeads)throw new Error('Input "past" third dimension must be num_heads');if(o.dims[4]!==h/t.numHeads)throw new Error('Input "past" fifth dimension must be k_hidden_size / num_heads');t.pastPresentShareBuffer||(m=o.dims[3])}let g=p+m;if(a)throw new Error("Mask not supported");if(o)throw new Error("past is not supported");if(s){if(4!==s.dims.length)throw new Error('Input "attention_bias" must have 4 dimensions');if(s.dims[0]!==c||s.dims[1]!==t.numHeads||s.dims[2]!==l||s.dims[3]!==g)throw new Error('Expect "attention_bias" shape (batch_size, num_heads, sequence_length, total_sequence_length)')}return{batchSize:c,sequenceLength:l,pastSequenceLength:m,kvSequenceLength:p,totalSequenceLength:g,maxSequenceLength:-1,inputHiddenSize:u,hiddenSize:d,vHiddenSize:f,headSize:Math.floor(d/t.numHeads),vHeadSize:Math.floor(f/t.numHeads),numHeads:t.numHeads,isUnidirectional:!1,pastPresentShareBuffer:!1,maskFilterValue:t.maskFilterValue,maskType:0,scale:t.scale,broadcastResPosBias:!1,passPastInKv:!1,qkvFormat:1}},Dr=(e,t,n)=>t&&e?"\n      let total_sequence_length_input = u32(".concat(t.getByOffset("0"),");\n      let present_sequence_length = max(total_sequence_length_input, uniforms.past_sequence_length);\n      let is_subsequent_prompt: bool = sequence_length > 1 && sequence_length != total_sequence_length_input;\n      let is_first_prompt: bool = is_subsequent_prompt == false && sequence_length == total_sequence_length_input;\n      total_sequence_length = u32(").concat(null===e||void 0===e?void 0:e.getByOffset("batchIdx"),") + 1;\n      var past_sequence_length: u32 = 0;\n      if (is_first_prompt == false) {\n        past_sequence_length = total_sequence_length - sequence_length;\n      }\n       "):"\n    ".concat(n?"let past_sequence_length = uniforms.past_sequence_length":"",";\n    let present_sequence_length = total_sequence_length;\n    "),zr=(e,t,n,r,i,a,o,s)=>{let c=mn(o?1:a),l=64,u=a/c;u<l&&(l=32);let d=Math.ceil(a/c/l),h=[{type:12,data:t},{type:12,data:n},{type:12,data:r},{type:12,data:i},{type:12,data:u},{type:12,data:d}],f=hn(e.dataType,c),p=fn(1,c),m=["type"];o&&m.push("type"),s&&m.push("type");return{name:"AttentionProbsSoftmax",shaderCache:{hint:"".concat(l,";").concat(f,";").concat(c),inputDependencies:m},getShaderSource:t=>{let n=xn("x",e.dataType,e.dims,c),r=[n],i=o?_n("seq_lens",o.dataType,o.dims):void 0;i&&r.push(i);let a=s?_n("total_sequence_length_input",s.dataType,s.dims):void 0;a&&r.push(a);let u=fn(e.dataType);return"\n  var<workgroup> thread_max: array<f32, ".concat(l,">;\n  var<workgroup> thread_sum: array<f32, ").concat(l,">;\n  ").concat(t.registerUniforms([{name:"batch_size",type:"u32"},{name:"num_heads",type:"u32"},{name:"past_sequence_length",type:"u32"},{name:"sequence_length",type:"u32"},{name:"total_sequence_length",type:"u32"},{name:"elements_per_thread",type:"u32"}]).declareVariables(...r),"\n  ").concat(t.mainStart([l,1,1]),"\n    let batchIdx = workgroup_id.z / uniforms.num_heads;\n    let headIdx = workgroup_id.z % uniforms.num_heads;\n    let sequence_length = uniforms.sequence_length;\n    var total_sequence_length = uniforms.total_sequence_length;\n    ").concat(Dr(i,a,!1),"\n    let local_offset = local_idx * uniforms.elements_per_thread;\n    let offset = (global_idx / ").concat(l,") * uniforms.total_sequence_length + local_offset;\n    let seq_causal_length = ").concat(o?"u32(past_sequence_length + workgroup_id.y + 1)":"total_sequence_length",";\n    var thread_max_vector = ").concat(p,"(-3.402823e+38f);\n    for (var i: u32 = 0; i < uniforms.elements_per_thread && i + local_offset < seq_causal_length; i++) {\n      thread_max_vector = max(").concat(p,"(x[offset + i]), thread_max_vector);\n    }\n    thread_max[local_idx] = ").concat((()=>{switch(c){case 1:return"thread_max_vector";case 2:return"max(thread_max_vector.x, thread_max_vector.y)";case 4:return"max(max(thread_max_vector.x, thread_max_vector.y), max(thread_max_vector.z, thread_max_vector.w))";default:throw new Error("Unsupported components: ".concat(c))}})(),";\n    workgroupBarrier();\n\n    var max_value =  f32(-3.402823e+38f);\n    for (var i = 0u; i < ").concat(l,"; i++) {\n      max_value = max(thread_max[i], max_value);\n    }\n\n    var sum_vector = ").concat(p,"(0);\n    for (var i: u32 = 0; i < uniforms.elements_per_thread && i + local_offset < seq_causal_length; i++) {\n      sum_vector += exp(").concat(p,"(x[offset + i]) - max_value);\n    }\n    thread_sum[local_idx] = ").concat((()=>{switch(c){case 1:return"sum_vector";case 2:return"sum_vector.x + sum_vector.y";case 4:return"sum_vector.x + sum_vector.y + sum_vector.z + sum_vector.w";default:throw new Error("Unsupported components: ".concat(c))}})(),";\n    workgroupBarrier();\n\n    var sum: f32 = 0;\n    for (var i = 0u; i < ").concat(l,"; i++) {\n      sum += thread_sum[i];\n    }\n\n    if (sum == 0) {\n      for (var i: u32 = 0; i < uniforms.elements_per_thread && i + local_offset < seq_causal_length; i++) {\n        x[offset + i] = ").concat(n.type.value,"(").concat(u,"(1.0) / ").concat(u,"(seq_causal_length));\n      }\n    } else {\n      for (var i: u32 = 0; i < uniforms.elements_per_thread && i + local_offset < seq_causal_length; i++) {\n        var f32input = ").concat(p,"(x[offset + i]);\n        x[offset + i] = ").concat(n.type.value,"(exp(f32input - max_value) / sum);\n      }\n    }\n      ").concat(o?"\n        for (var total_seq_id: u32 = seq_causal_length; total_seq_id + local_offset < uniforms.total_sequence_length; total_seq_id++) {\n          x[offset + total_seq_id] = ".concat(n.type.value,"(").concat(u,"(0));\n        }"):"",";\n  }")},getRunData:()=>({outputs:[],dispatchGroup:{x:1,y:i,z:t*n},programUniforms:h})}},Mr=(e,t,n,r,i,a,o,s,c)=>{let l=o+a.kvSequenceLength,u=[a.batchSize,a.numHeads,a.sequenceLength,l],d=e>1&&r,h=a.kvNumHeads?a.kvNumHeads:a.numHeads,f=d?[a.batchSize,h,l,a.headSize]:void 0,p=a.nReps?a.nReps:1,m=0===a.scale?1/Math.sqrt(a.headSize):a.scale,g=mn(a.headSize),y=a.headSize/g,v=12,w={x:Math.ceil(l/v),y:Math.ceil(a.sequenceLength/v),z:a.batchSize*a.numHeads},b=[{type:12,data:a.sequenceLength},{type:12,data:y},{type:12,data:l},{type:12,data:a.numHeads},{type:12,data:a.headSize},{type:1,data:m},{type:12,data:o},{type:12,data:a.kvSequenceLength},{type:12,data:p}],_=d&&r&&Rt.size(r.dims)>0,x=["type","type"];_&&x.push("type"),i&&x.push("type"),s&&x.push("type"),c&&x.push("type");let E=[{dims:u,dataType:t.dataType,gpuDataType:0}];d&&E.push({dims:f,dataType:t.dataType,gpuDataType:0});return{name:"AttentionProbs",shaderCache:{hint:"".concat(g,";").concat(void 0!==i,";").concat(void 0!==r,";").concat(e),inputDependencies:x},getRunData:()=>({outputs:E,dispatchGroup:w,programUniforms:b}),getShaderSource:e=>{let a=_n("q",t.dataType,t.dims,g),o=[a,_n("key",n.dataType,n.dims,g)];if(_){let e=_n("past_key",r.dataType,r.dims,g);o.push(e)}i&&o.push(_n("attention_bias",i.dataType,i.dims));let l=s?_n("seq_lens",s.dataType,s.dims):void 0;l&&o.push(l);let h=c?_n("total_sequence_length_input",c.dataType,c.dims):void 0;h&&o.push(h);let m=xn("output",t.dataType,u),y=[m];d&&y.push(xn("present_key",t.dataType,f,g));let w=fn(1,g);return"\n  const TILE_SIZE = ".concat(v,"u;\n\n  var<workgroup> tileQ: array<").concat(a.type.storage,", ").concat(144,">;\n  var<workgroup> tileK: array<").concat(a.type.storage,", ").concat(144,">;\n  ").concat(e.registerUniforms([{name:"M",type:"u32"},{name:"K",type:"u32"},{name:"N",type:"u32"},{name:"num_heads",type:"u32"},{name:"head_size",type:"u32"},{name:"alpha",type:"f32"},{name:"past_sequence_length",type:"u32"},{name:"kv_sequence_length",type:"u32"},{name:"n_reps",type:"u32"}]).declareVariables(...o,...y),"\n  ").concat(e.mainStart([v,v,1]),"\n    // x holds the N and y holds the M\n    let headIdx = workgroup_id.z % uniforms.num_heads;\n    let kvHeadIdx = ").concat(1===p?"headIdx":"headIdx / uniforms.n_reps",";\n    let kv_num_heads = ").concat(1===p?"uniforms.num_heads":"uniforms.num_heads / uniforms.n_reps",";\n    let batchIdx = workgroup_id.z / uniforms.num_heads;\n    let m = workgroup_id.y * TILE_SIZE;\n    let n = workgroup_id.x * TILE_SIZE;\n    let sequence_length = uniforms.M;\n    var total_sequence_length = uniforms.N;\n    ").concat(Dr(l,h,!0),"\n    let absKvHeadIdx = batchIdx * kv_num_heads + kvHeadIdx;\n    let qOffset = workgroup_id.z * uniforms.M * uniforms.K + m * uniforms.K;\n    ").concat(_&&d?"let pastKeyOffset = absKvHeadIdx * uniforms.past_sequence_length * uniforms.K;":"",";\n    let kOffset = absKvHeadIdx * uniforms.kv_sequence_length * uniforms.K;\n    ").concat(d?"let presentKeyOffset = absKvHeadIdx * uniforms.N * uniforms.K;":"","\n    var value = ").concat(w,"(0);\n    for (var w: u32 = 0u; w < uniforms.K; w += TILE_SIZE) {\n      if (global_id.y < uniforms.M && w + local_id.x < uniforms.K) {\n        tileQ[TILE_SIZE * local_id.y + local_id.x] = q[qOffset + local_id.y * uniforms.K + w + local_id.x];\n      }\n      if (n + local_id.y < uniforms.N && w + local_id.x < uniforms.K) {\n        var idx = TILE_SIZE * local_id.y + local_id.x;\n      ").concat(_&&d?"\n              if (n + local_id.y < past_sequence_length) {\n                tileK[idx] = past_key[pastKeyOffset + (n + local_id.y) * uniforms.K + w + local_id.x];\n              } else if (n + local_id.y - past_sequence_length < uniforms.kv_sequence_length) {\n                tileK[idx] = key[kOffset + (n + local_id.y - past_sequence_length) * uniforms.K + w + local_id.x];\n              }":"\n          if (n + local_id.y < uniforms.kv_sequence_length) {\n            tileK[idx] = key[kOffset + (n + local_id.y) * uniforms.K + w + local_id.x];\n          }","\n      ").concat(d?"if (n + local_id.y < present_sequence_length) {\n        present_key[presentKeyOffset + (n + local_id.y) * uniforms.K + w + local_id.x] = tileK[idx];\n      }":"","\n      }\n      workgroupBarrier();\n\n      for (var k: u32 = 0u; k < TILE_SIZE && w+k < uniforms.K; k++) {\n          value += ").concat(w,"(tileQ[TILE_SIZE * local_id.y + k] * tileK[TILE_SIZE * local_id.x + k]);\n      }\n\n      workgroupBarrier();\n    }\n\n    if (global_id.y < uniforms.M && global_id.x < total_sequence_length) {\n      let headOffset = workgroup_id.z * uniforms.M * uniforms.N;\n      let outputIdx = headOffset + global_id.y * uniforms.N + global_id.x;\n      var sum: f32 = ").concat((()=>{switch(g){case 1:return"value";case 2:return"value.x + value.y";case 4:return"value.x + value.y + value.z + value.w";default:throw new Error("Unsupported components: ".concat(g))}})(),";\n        output[outputIdx] = ").concat(m.type.value," (sum * uniforms.alpha) + ").concat(i?"attention_bias[outputIdx]":"0.0",";\n    }\n  }")}}},Lr=function(e,t,n,r,i,a){let o=arguments.length>6&&void 0!==arguments[6]?arguments[6]:void 0,s=arguments.length>7&&void 0!==arguments[7]?arguments[7]:void 0,c=a+i.kvSequenceLength,l=i.nReps?i.nReps:1,u=i.vHiddenSize*l,d=e>1&&r,h=i.kvNumHeads?i.kvNumHeads:i.numHeads,f=d?[i.batchSize,h,c,i.headSize]:void 0,p=[i.batchSize,i.sequenceLength,u],m=12,g={x:Math.ceil(i.vHeadSize/m),y:Math.ceil(i.sequenceLength/m),z:i.batchSize*i.numHeads},y=[{type:12,data:i.sequenceLength},{type:12,data:c},{type:12,data:i.vHeadSize},{type:12,data:i.numHeads},{type:12,data:i.headSize},{type:12,data:u},{type:12,data:a},{type:12,data:i.kvSequenceLength},{type:12,data:l}],v=d&&r&&Rt.size(r.dims)>0,w=["type","type"];v&&w.push("type"),o&&w.push("type"),s&&w.push("type");let b=[{dims:p,dataType:t.dataType,gpuDataType:0}];d&&b.push({dims:f,dataType:t.dataType,gpuDataType:0});return{name:"AttentionScore",shaderCache:{hint:"".concat(void 0!==r,";").concat(e),inputDependencies:w},getRunData:()=>({outputs:b,dispatchGroup:g,programUniforms:y}),getShaderSource:e=>{let i=_n("probs",t.dataType,t.dims),a=[i,_n("v",n.dataType,n.dims)];v&&a.push(_n("past_value",r.dataType,r.dims));let c=o?_n("seq_lens",o.dataType,o.dims):void 0;o&&a.push(c);let u=s?_n("total_sequence_length_input",s.dataType,s.dims):void 0;s&&a.push(u);let h=[xn("output",t.dataType,p)];d&&h.push(xn("present_value",t.dataType,f));return"\n  const TILE_SIZE = ".concat(m,"u;\n  var<workgroup> tileQ: array<").concat(i.type.value,", ").concat(144,">;\n  var<workgroup> tileV: array<").concat(i.type.value,", ").concat(144,">;\n  ").concat(e.registerUniforms([{name:"M",type:"u32"},{name:"K",type:"u32"},{name:"N",type:"u32"},{name:"num_heads",type:"u32"},{name:"head_size",type:"u32"},{name:"v_hidden_size",type:"u32"},{name:"past_sequence_length",type:"u32"},{name:"kv_sequence_length",type:"u32"},{name:"n_reps",type:"u32"}]).declareVariables(...a,...h),"\n  ").concat(e.mainStart([m,m,1]),"\n   let headIdx = workgroup_id.z % uniforms.num_heads;\n   let batchIdx = workgroup_id.z / uniforms.num_heads;\n   let kvHeadIdx = ").concat(1===l?"headIdx":"headIdx / uniforms.n_reps",";\n   let kv_num_heads = ").concat(1===l?"uniforms.num_heads":"uniforms.num_heads / uniforms.n_reps",";\n   let m = global_id.y;\n   let n = global_id.x;\n   let sequence_length = uniforms.M;\n   var total_sequence_length = uniforms.K;\n   ").concat(Dr(c,u,!0),"\n   let offsetA = workgroup_id.z * uniforms.M * uniforms.K + m * uniforms.K;\n   let absKvHeadIdx = batchIdx * kv_num_heads + kvHeadIdx; // kvHeadIdx is relative to the batch\n   ").concat(v&&d?"let pastValueOffset = absKvHeadIdx * uniforms.N * uniforms.past_sequence_length + n;":"",";\n   let vOffset = absKvHeadIdx * uniforms.N * uniforms.kv_sequence_length + n;\n   ").concat(d?"let presentValueOffset = absKvHeadIdx * uniforms.N * uniforms.K + n;":"","\n   var value = ").concat(i.type.storage,"(0);\n   for (var w: u32 = 0u; w < uniforms.K; w += TILE_SIZE) {\n      if (m < uniforms.M && w + local_id.x < uniforms.K) {\n        tileQ[TILE_SIZE * local_id.y + local_id.x] = probs[offsetA + w + local_id.x];\n      }\n      if (n < uniforms.N && w + local_id.y < uniforms.K) {\n        var idx = TILE_SIZE * local_id.y + local_id.x;\n        ").concat(v&&d?"\n        if (w + local_id.y < past_sequence_length) {\n          tileV[idx] = past_value[pastValueOffset + (w + local_id.y) * uniforms.N];\n        } else if (w + local_id.y - past_sequence_length < uniforms.kv_sequence_length) {\n          tileV[idx] = v[vOffset + (w + local_id.y - past_sequence_length) * uniforms.N];\n        }\n      ":"\n            if (w + local_id.y < uniforms.kv_sequence_length) {\n              tileV[idx] = v[vOffset + (w + local_id.y) * uniforms.N];\n            }","\n        ").concat(d?"\n            if (w + local_id.y < present_sequence_length) {\n          present_value[presentValueOffset + (w + local_id.y) * uniforms.N] = tileV[idx];\n        }":"","\n      }\n     workgroupBarrier();\n     for (var k: u32 = 0u; k < TILE_SIZE && w+k < total_sequence_length; k++) {\n       value += tileQ[TILE_SIZE * local_id.y + k] * tileV[TILE_SIZE * k + local_id.x];\n     }\n     workgroupBarrier();\n   }\n\n   // we need to transpose output from BNSH_v to BSND_v\n   if (m < uniforms.M && n < uniforms.N) {\n     let outputIdx = batchIdx * uniforms.M * uniforms.v_hidden_size + m * uniforms.v_hidden_size\n       + headIdx * uniforms.N + n;\n     output[outputIdx] = value;\n   }\n  }")}}},Ur=function(e,t,n,r,i,a,o,s,c,l){let u=arguments.length>10&&void 0!==arguments[10]?arguments[10]:void 0,d=arguments.length>11&&void 0!==arguments[11]?arguments[11]:void 0,h=Math.min(e.outputCount,1+(o?1:0)+(s?1:0)),f=h>1?l.pastSequenceLength:0,p=f+l.kvSequenceLength,m=c&&Rt.size(c.dims)>0?c:void 0,g=[t,n];h>1&&o&&Rt.size(o.dims)>0&&g.push(o),m&&g.push(m),u&&g.push(u),d&&g.push(d);let y=e.compute(Mr(h,t,n,o,m,l,f,u,d),{inputs:g,outputs:h>1?[-1,1]:[-1]})[0];e.compute(zr(y,l.batchSize,l.numHeads,f,l.sequenceLength,p,u,d),{inputs:u&&d?[y,u,d]:[y],outputs:[]});let v=[y,r];h>1&&s&&Rt.size(s.dims)>0&&v.push(s),u&&v.push(u),d&&v.push(d),e.compute(Lr(h,y,r,s,l,f,u,d),{inputs:v,outputs:h>1?[0,2]:[0]})},Br=(e,t)=>{let n=[t.batchSize,t.numHeads,t.sequenceLength,t.headSize],r=t.sequenceLength,i=t.inputHiddenSize,a=t.headSize,o=12,s={x:Math.ceil(t.headSize/o),y:Math.ceil(t.sequenceLength/o),z:t.batchSize*t.numHeads},c=[e.inputs[0],e.inputs[1],e.inputs[2]],l=[{type:12,data:r},{type:12,data:i},{type:12,data:a},{type:12,data:t.numHeads},{type:12,data:t.headSize},{type:12,data:t.hiddenSize},{type:12,data:t.hiddenSize+t.hiddenSize+t.vHiddenSize}];return e.compute({name:"AttentionPrepare",shaderCache:{inputDependencies:["type","type","type"]},getRunData:()=>({outputs:[{dims:n,dataType:e.inputs[0].dataType,gpuDataType:0},{dims:n,dataType:e.inputs[0].dataType,gpuDataType:0},{dims:n,dataType:e.inputs[0].dataType,gpuDataType:0}],dispatchGroup:s,programUniforms:l}),getShaderSource:e=>{let t=xn("output_q",c[0].dataType,n),r=xn("output_k",c[0].dataType,n),i=xn("output_v",c[0].dataType,n),a=_n("input",c[0].dataType,c[0].dims),s=_n("weight",c[1].dataType,c[1].dims),l=_n("bias",c[2].dataType,c[2].dims),u=a.type.storage;return"\n  const TILE_SIZE = ".concat(o,"u;\n  var<workgroup> tileInput: array<").concat(u,", ").concat(144,">;\n  var<workgroup> tileWeightQ: array<").concat(u,", ").concat(144,">;\n  var<workgroup> tileWeightK: array<").concat(u,", ").concat(144,">;\n  var<workgroup> tileWeightV: array<").concat(u,", ").concat(144,">;\n  ").concat(e.registerUniforms([{name:"M",type:"u32"},{name:"K",type:"u32"},{name:"N",type:"u32"},{name:"num_heads",type:"u32"},{name:"head_size",type:"u32"},{name:"hidden_size",type:"u32"},{name:"ldb",type:"u32"}]).declareVariables(a,s,l,t,r,i),"\n  ").concat(e.mainStart([o,o,1]),"\n    let batchIndex = workgroup_id.z / uniforms.num_heads;\n    let headNumber = workgroup_id.z % uniforms.num_heads;\n    let m = global_id.y;\n    let n = global_id.x;\n\n    let inputOffset = batchIndex * (uniforms.M * uniforms.K) + m * uniforms.K;\n    let biasOffsetQ = headNumber * uniforms.head_size;\n    let biasOffsetK = uniforms.hidden_size + biasOffsetQ;\n    let biasOffsetV = uniforms.hidden_size + biasOffsetK;\n\n    var valueQ = ").concat(u,"(0);\n    var valueK = ").concat(u,"(0);\n    var valueV = ").concat(u,"(0);\n    for (var w: u32 = 0u; w < uniforms.K; w += TILE_SIZE) {\n      if (m < uniforms.M && w + local_id.x < uniforms.K) {\n        tileInput[TILE_SIZE * local_id.y + local_id.x] = input[inputOffset + w + local_id.x];\n      }\n      if (n < uniforms.N && w + local_id.y < uniforms.K) {\n        let offset = n + (w + local_id.y) * uniforms.ldb;\n        tileWeightQ[TILE_SIZE * local_id.y + local_id.x] = weight[biasOffsetQ + offset];\n        tileWeightK[TILE_SIZE * local_id.y + local_id.x] = weight[biasOffsetK + offset];\n        tileWeightV[TILE_SIZE * local_id.y + local_id.x] = weight[biasOffsetV + offset];\n      }\n      workgroupBarrier();\n      for (var k: u32 = 0u; k<TILE_SIZE && w+k < uniforms.K; k++) {\n        let inputTileOffset = TILE_SIZE * local_id.y + k;\n        let weightTileOffset = TILE_SIZE * k + local_id.x;\n        valueQ += tileInput[inputTileOffset] * tileWeightQ[weightTileOffset];\n        valueK += tileInput[inputTileOffset] * tileWeightK[weightTileOffset];\n        valueV += tileInput[inputTileOffset] * tileWeightV[weightTileOffset];\n      }\n\n      workgroupBarrier();\n    }\n\n    let headOffset = (m * uniforms.N + n) % uniforms.head_size;\n    valueQ += bias[headOffset + biasOffsetQ];\n    valueK += bias[headOffset + biasOffsetK];\n    valueV += bias[headOffset + biasOffsetV];\n\n    let offset = workgroup_id.z * uniforms.M * uniforms.N;\n    if (m < uniforms.M && n < uniforms.N) {\n      let outputIdx = offset + m * uniforms.N + n;\n      output_q[outputIdx] = valueQ;\n      output_k[outputIdx] = valueK;\n      output_v[outputIdx] = valueV;\n    }\n  }")}},{inputs:c,outputs:[-1,-1,-1]})},Fr=(e,t)=>{let n=Pr(e.inputs,t),[r,i,a]=Br(e,n);return Ur(e,r,i,a,e.inputs[4],void 0,void 0,void 0,e.inputs[5],n)}}),Bl=re(()=>{ke(),El(),Tl(),Rl(),Pl(),jr=(e,t)=>{if(!e||5!==e.length)throw new Error("BatchNormalization requires 5 inputs");let n=(e,t,n)=>{let r=t.length;if(r!==e.length)throw new Error("".concat(n,": num dimensions != ").concat(r));t.forEach((t,r)=>{if(t!==e[r])throw new Error("".concat(n,": dim[").concat(r,"] do not match"))})};if(e[0].dims.length>1){let r="NHWC"===t.format?t.spatial?e[0].dims.slice(-1):e[0].dims.slice(-1).concat(e[0].dims.slice(1,e[0].dims.length-1)):e[0].dims.slice(1,t.spatial?2:void 0);n(e[1].dims,r,"Invalid input scale"),n(e[2].dims,r,"Invalid input B"),n(e[3].dims,r,"Invalid input mean"),n(e[4].dims,r,"Invalid input var")}else n(e[1].dims,[1],"Invalid input scale"),n(e[2].dims,[1],"Invalid input B"),n(e[3].dims,[1],"Invalid input mean"),n(e[4].dims,[1],"Invalid input var")},Vr=(e,t)=>{let{epsilon:n,spatial:r,format:i}=t,a=e[0].dims,o=r?mn(a[a.length-1]):1,s="NHWC"===i&&a.length>1?o:1,c=Rt.size(a)/o,l=r,u=l?a.length:a,d=_n("x",e[0].dataType,e[0].dims,o),h=_n("scale",e[1].dataType,e[1].dims,s),f=_n("bias",e[2].dataType,e[2].dims,s),p=_n("inputMean",e[3].dataType,e[3].dims,s),m=_n("inputVar",e[4].dataType,e[4].dims,s),g=xn("y",e[0].dataType,u,o);return{name:"BatchNormalization",shaderCache:{hint:"".concat(t.epsilon,"_").concat(t.format,"_").concat(r,"_").concat(o),inputDependencies:l?["rank","type","type","type","type"]:void 0},getShaderSource:e=>"\n  const epsilon = ".concat(n,";\n  ").concat(e.registerUniform("outputSize","u32").declareVariables(d,h,f,p,m,g),"\n  ").concat(e.mainStart(),"\n  ").concat(e.guardAgainstOutOfBoundsWorkgroupSizes("uniforms.outputSize"),"\n    var outputIndices = ").concat(g.offsetToIndices("global_idx * ".concat(o)),";\n    ").concat((()=>{let e="";if(r)e="let cOffset = ".concat(1===a.length?"0u":"NHWC"===i?"outputIndices[".concat(a.length-1,"] / ").concat(o):"outputIndices[1]",";");else if("NCHW"===i)e="\n            ".concat(g.indicesSet("outputIndices","0","0"),"\n            let cOffset = ").concat(g.indicesToOffset("outputIndices"),";");else{e="var cIndices = ".concat(h.type.indices,"(0);\n                       cIndices[0] = outputIndices[").concat(a.length-1,"];");for(let t=1;t<h.rank;t++)e+="cIndices[".concat(t,"] = outputIndices[").concat(t,"];");e+="let cOffset = ".concat(h.indicesToOffset("cIndices"),";")}return e})(),"\n    let scale = ").concat(h.getByOffset("cOffset"),";\n    let bias = ").concat(f.getByOffset("cOffset"),";\n    let inputMean = ").concat(p.getByOffset("cOffset"),";\n    let inputVar = ").concat(m.getByOffset("cOffset"),";\n    let x = ").concat(d.getByOffset("global_idx"),";\n    let value = (x - inputMean) * inverseSqrt(inputVar + epsilon) * scale + bias;\n    ").concat(g.setByOffset("global_idx","value"),"\n  }"),getRunData:()=>({outputs:[{dims:e[0].dims,dataType:e[0].dataType}],dispatchGroup:{x:Math.ceil(c/64)},programUniforms:l?[{type:12,data:c},...pn(a)]:[{type:12,data:c}]})}},qr=e=>ln(e),Hr=(e,t)=>{let{inputs:n,outputCount:r}=e,i=qr(l(l({},t),{},{outputCount:r}));if(I.webgpu.validateInputContent&&jr(n,i),t.trainingMode)throw new Error("BatchNormalization trainingMode is not supported yet.");e.compute(Vr(n,i))}}),Fl=re(()=>{Tl(),Pl(),Wr=e=>{if(3!==e[0].dims.length)throw new Error("input should have 3 dimensions");if(![320,640,1280].includes(e[0].dims[2]))throw new Error("number of channels should be 320, 640 or 1280");if(1!==e[1].dims.length)throw new Error("bias is expected to have 1 dimensions");if(e[0].dims[2]!==e[1].dims[0])throw new Error("last dimension of input and bias are not the same")},Gr=e=>{let t=e[0].dims,n=e[0].dims[2],r=Rt.size(t)/4,i=e[0].dataType,a=_n("input",i,t,4),o=_n("bias",i,[n],4),s=_n("residual",i,t,4),c=xn("output",i,t,4);return{name:"BiasAdd",getRunData:()=>({outputs:[{dims:t,dataType:e[0].dataType}],dispatchGroup:{x:Math.ceil(r/64)}}),getShaderSource:e=>"\n  const channels = ".concat(n,"u / 4;\n  ").concat(e.declareVariables(a,o,s,c),"\n\n  ").concat(e.mainStart(),"\n    ").concat(e.guardAgainstOutOfBoundsWorkgroupSizes(r),"\n    let value = ").concat(a.getByOffset("global_idx"),"\n      + ").concat(o.getByOffset("global_idx % channels")," + ").concat(s.getByOffset("global_idx"),";\n    ").concat(c.setByOffset("global_idx","value"),"\n  }")}},Kr=e=>{Wr(e.inputs),e.compute(Gr(e.inputs))}}),jl=re(()=>{El(),Tl(),Rl(),Pl(),Qr=(e,t,n,r,i,a,o)=>{let s=Math.ceil(t/4),c="";c="string"==typeof i?"".concat(i,"(a)"):i("a");let l=_n("inputData",n,[s],4),u=xn("outputData",r,[s],4),d=[{name:"vec_size",type:"u32"}];return o&&d.push(...o),"\n      ".concat(e.registerUniforms(d).declareVariables(l,u),"\n\n  ").concat(null!==a&&void 0!==a?a:"","\n\n  ").concat(e.mainStart(),"\n    ").concat(e.guardAgainstOutOfBoundsWorkgroupSizes("uniforms.vec_size"),"\n\n    let a = ").concat(l.getByOffset("global_idx"),";\n    ").concat(u.setByOffset("global_idx",c),"\n  }")},Xr=function(e,t,n,r,i){let a=arguments.length>5&&void 0!==arguments[5]?arguments[5]:e.dataType,o=arguments.length>6?arguments[6]:void 0,s=arguments.length>7?arguments[7]:void 0,c=[{type:12,data:Math.ceil(Rt.size(e.dims)/4)}];return o&&c.push(...o),{name:t,shaderCache:{hint:i,inputDependencies:["type"]},getShaderSource:t=>Qr(t,Rt.size(e.dims),e.dataType,a,n,r,s),getRunData:t=>({outputs:[{dims:e.dims,dataType:a}],dispatchGroup:{x:Math.ceil(Rt.size(t[0].dims)/64/4)},programUniforms:c})}},Yr=e=>{e.compute(Xr(e.inputs[0],"Abs","abs"))},Jr=e=>{e.compute(Xr(e.inputs[0],"Acos","acos"))},$r=e=>{e.compute(Xr(e.inputs[0],"Acosh","acosh"))},Zr=e=>{e.compute(Xr(e.inputs[0],"Asin","asin"))},ei=e=>{e.compute(Xr(e.inputs[0],"Asinh","asinh"))},ti=e=>{e.compute(Xr(e.inputs[0],"Atan","atan"))},ni=e=>{e.compute(Xr(e.inputs[0],"Atanh","atanh"))},ri=e=>ln(e),ii=(e,t)=>{let n;switch(t.to){case 10:n="vec4<f16>";break;case 1:n="vec4<f32>";break;case 12:n="vec4<u32>";break;case 6:n="vec4<i32>";break;case 9:n="vec4<bool>";break;default:throw new RangeError("not supported type (specified in attribute 'to' from 'Cast' operator): ".concat(t.to))}e.compute(Xr(e.inputs[0],"Cast",n,void 0,t.cacheKey,t.to))},ai=e=>{let t,n,r=e.length>=2&&0!==e[1].data,i=e.length>=3&&0!==e[2].data;switch(e[0].dataType){case 1:t=r?e[1].getFloat32Array()[0]:-34028234663852886e22,n=i?e[2].getFloat32Array()[0]:34028234663852886e22;break;case 10:t=r?e[1].getUint16Array()[0]:64511,n=i?e[2].getUint16Array()[0]:31743;break;default:throw new Error("Unsupport data type")}return ln({min:t,max:n})},oi=(e,t)=>{let n=t||ai(e.inputs),r=fn(e.inputs[0].dataType);e.compute(Xr(e.inputs[0],"Clip",e=>"clamp(".concat(e,", vec4<").concat(r,">(uniforms.min), vec4<").concat(r,">(uniforms.max))"),void 0,n.cacheKey,void 0,[{type:e.inputs[0].dataType,data:n.min},{type:e.inputs[0].dataType,data:n.max}],[{name:"min",type:r},{name:"max",type:r}]),{inputs:[0]})},si=e=>{e.compute(Xr(e.inputs[0],"Ceil","ceil"))},ci=e=>{e.compute(Xr(e.inputs[0],"Cos","cos"))},li=e=>{e.compute(Xr(e.inputs[0],"Cosh","cosh"))},ui=e=>ln(e),di=(e,t)=>{let n=fn(e.inputs[0].dataType);e.compute(Xr(e.inputs[0],"Elu",e=>"elu_vf32(".concat(e,")"),"\n  const elu_alpha_ = ".concat(n,"(").concat(t.alpha,");\n\n  fn elu_f32(a: ").concat(n,") -> ").concat(n," {\n  return select((exp(a) - 1.0) * elu_alpha_, a, a >= 0.0);\n  }\n\n  fn elu_vf32(v: vec4<").concat(n,">) -> vec4<").concat(n,"> {\n  return vec4(elu_f32(v.x), elu_f32(v.y), elu_f32(v.z), elu_f32(v.w));\n  }"),t.cacheKey))},hi=function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"f32";return"\nconst r0: ".concat(e," = 0.3275911;\nconst r1: ").concat(e," = 0.254829592;\nconst r2: ").concat(e," = -0.284496736;\nconst r3: ").concat(e," = 1.421413741;\nconst r4: ").concat(e," = -1.453152027;\nconst r5: ").concat(e," = 1.061405429;\n\nfn erf_vf32(v: vec4<").concat(e,">) -> vec4<").concat(e,"> {\n  let absv = abs(v);\n  let x = 1.0 / (1.0 + r0 * absv);\n  return sign(v) * (1.0 - ((((r5 * x + r4) * x + r3) * x + r2) * x + r1) * x * exp(-absv * absv));\n}")},fi=e=>{let t=fn(e.inputs[0].dataType);e.compute(Xr(e.inputs[0],"Erf",e=>"erf_vf32(".concat(e,")"),hi(t)))},pi=e=>{e.compute(Xr(e.inputs[0],"Exp","exp"))},mi=e=>{e.compute(Xr(e.inputs[0],"Floor","floor"))},gi=e=>{let t=fn(e.inputs[0].dataType);e.compute(Xr(e.inputs[0],"Gelu",e=>"0.5 * ".concat(e," * (1.0 + erf_vf32(").concat(e," * 0.7071067811865475))"),hi(t)))},yi=(e,t)=>{let n=fn(e.inputs[0].dataType);e.compute(Xr(e.inputs[0],"LeakyRelu",e=>"select(leaky_relu_alpha_ * ".concat(e,", ").concat(e,", ").concat(e," >= vec4<").concat(n,">(0.0))"),"const leaky_relu_alpha_ = ".concat(n,"(").concat(t.alpha,");"),t.cacheKey))},vi=e=>{e.compute(Xr(e.inputs[0],"Not",e=>"!".concat(e)))},wi=e=>{e.compute(Xr(e.inputs[0],"Neg",e=>"-".concat(e)))},bi=e=>{e.compute(Xr(e.inputs[0],"Reciprocal",e=>"1.0/".concat(e)))},_i=e=>{let t=fn(e.inputs[0].dataType);e.compute(Xr(e.inputs[0],"Relu",e=>"select(vec4<".concat(t,">(0.0), ").concat(e,", ").concat(e," > vec4<").concat(t,">(0.0))")))},xi=e=>{e.compute(Xr(e.inputs[0],"Sigmoid",e=>"(1.0 / (1.0 + exp(-".concat(e,")))")))},Ei=e=>ln(e),Si=(e,t)=>{let n=fn(e.inputs[0].dataType);e.compute(Xr(e.inputs[0],"HardSigmoid",e=>"max(vec4<".concat(n,">(0.0), min(vec4<").concat(n,">(1.0), ").concat(t.alpha," * ").concat(e," + vec4<").concat(n,">(").concat(t.beta,")))"),void 0,t.cacheKey))},ki=e=>{e.compute(Xr(e.inputs[0],"Sin","sin"))},Ti=e=>{e.compute(Xr(e.inputs[0],"Sinh","sinh"))},Ii=e=>{e.compute(Xr(e.inputs[0],"Sqrt","sqrt"))},Ci=e=>{e.compute(Xr(e.inputs[0],"Tan","tan"))},Ai=e=>"sign(".concat(e,") * (1 - exp(-2 * abs(").concat(e,"))) / (1 + exp(-2 * abs(").concat(e,")))"),Oi=e=>{e.compute(Xr(e.inputs[0],"Tanh",Ai))},Ni=function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"f32";return"\nconst fast_gelu_a: ".concat(e," = 0.5;\nconst fast_gelu_b: ").concat(e," = 0.7978845608028654;\nconst fast_gelu_c: ").concat(e," = 0.035677408136300125;\n\nfn tanh_v(v: vec4<").concat(e,">) -> vec4<").concat(e,"> {\n  return ").concat(Ai("v"),";\n}\n")},Ri=e=>"(fast_gelu_a + fast_gelu_a * tanh_v(".concat(e," * (fast_gelu_c * ").concat(e," * ").concat(e," + fast_gelu_b))) * ").concat(e),Pi=e=>{let t=fn(e.inputs[0].dataType);e.compute(Xr(e.inputs[0],"FastGelu",Ri,Ni(t),void 0,e.inputs[0].dataType))},Di=(e,t)=>{let n=fn(e.inputs[0].dataType);return e.compute(Xr(e.inputs[0],"ThresholdedRelu",e=>"select(vec4<".concat(n,">(0.0), ").concat(e,", ").concat(e," > thresholded_relu_alpha_)"),"const thresholded_relu_alpha_ = vec4<".concat(n,">(").concat(t.alpha,");"),t.cacheKey)),0},zi=e=>{e.compute(Xr(e.inputs[0],"Log","log"))},Mi=(e,t)=>"\nconst alpha = vec4<".concat(e,">(").concat(t,");\nconst one = ").concat(e,"(1.0);\nconst zero = ").concat(e,"(0.0);\n\nfn quick_gelu_impl(x: vec4<").concat(e,">) -> vec4<").concat(e,"> {\n  let v = x *alpha;\n  var x1 : vec4<").concat(e,">;\n  for (var i = 0; i < 4; i = i + 1) {\n    if (v[i] >= zero) {\n      x1[i] = one / (one + exp(-v[i]));\n    } else {\n      x1[i] = one - one / (one + exp(v[i]));\n    }\n  }\n  return x * x1;\n}\n"),Li=e=>"quick_gelu_impl(".concat(e,")"),Ui=(e,t)=>{let n=fn(e.inputs[0].dataType);e.compute(Xr(e.inputs[0],"QuickGelu",Li,Mi(n,t.alpha),t.cacheKey,e.inputs[0].dataType))}}),Vl=re(()=>{Tl(),Pl(),jl(),Bi=e=>{if(3!==e[0].dims.length)throw new Error("input should have 3 dimensions");if(![2560,5120,10240].includes(e[0].dims[2]))throw new Error("hidden state should be 2560, 5120 or 10240");if(1!==e[1].dims.length)throw new Error("bias is expected to have 1 dimensions");if(e[0].dims[2]!==e[1].dims[0])throw new Error("last dimension of input and bias are not the same")},Fi=e=>{let t=e[0].dims.slice();t[2]=t[2]/2;let n=_n("input",e[0].dataType,e[0].dims,4),r=_n("bias",e[0].dataType,[e[0].dims[2]],4),i=xn("output",e[0].dataType,t,4),a=Rt.size(t)/4,o=hn(e[0].dataType);return{name:"BiasSplitGelu",getRunData:()=>({outputs:[{dims:t,dataType:e[0].dataType}],dispatchGroup:{x:Math.ceil(a/64)}}),getShaderSource:t=>"\n  const M_SQRT2 = sqrt(2.0);\n  const halfChannels = ".concat(e[0].dims[2]/4/2,"u;\n\n  ").concat(t.declareVariables(n,r,i),"\n\n  ").concat(hi(o),"\n\n  ").concat(t.mainStart(),"\n    ").concat(t.guardAgainstOutOfBoundsWorkgroupSizes(a),"\n    let biasIdx = global_idx % halfChannels;\n    let batchIndex = global_idx / halfChannels;\n    let inputOffset = biasIdx + batchIndex * halfChannels * 2;\n    let valueLeft = input[inputOffset] + bias[biasIdx];\n    let valueRight = input[inputOffset + halfChannels] + bias[biasIdx + halfChannels];\n    let geluRight = valueRight * 0.5 * (erf_vf32(valueRight / M_SQRT2) + 1);\n\n    ").concat(i.setByOffset("global_idx","valueLeft * geluRight"),"\n  }")}},ji=e=>{Bi(e.inputs),e.compute(Fi(e.inputs))}}),ql=re(()=>{El(),Tl(),Pl(),Vi=(e,t,n,r,i,a,o,s,c,l,u,d)=>{let h,f;"string"==typeof s?h=f=(e,t)=>"".concat(s,"((").concat(e,"),(").concat(t,"))"):"function"==typeof s?h=f=s:(h=s.scalar,f=s.vector);let p,m=xn("outputData",u,r.length,4),g=_n("aData",c,t.length,4),y=_n("bData",l,n.length,4);if(i)if(a){let e=1===Rt.size(t),r=1===Rt.size(n),i=t.length>0&&t[t.length-1]%4===0,a=n.length>0&&n[n.length-1]%4===0;p=e||r?m.setByOffset("global_idx",f(e?"".concat(g.type.value,"(").concat(g.getByOffset("0"),".x)"):g.getByOffset("global_idx"),r?"".concat(y.type.value,"(").concat(y.getByOffset("0"),".x)"):y.getByOffset("global_idx"))):"\n            let outputIndices = ".concat(m.offsetToIndices("global_idx * 4u"),";\n            let offsetA = ").concat(g.broadcastedIndicesToOffset("outputIndices",m),";\n            let offsetB = ").concat(y.broadcastedIndicesToOffset("outputIndices",m),";\n            ").concat(m.setByOffset("global_idx",f(o||i?g.getByOffset("offsetA / 4u"):"".concat(g.type.value,"(").concat(g.getByOffset("offsetA / 4u"),"[offsetA % 4u])"),o||a?y.getByOffset("offsetB / 4u"):"".concat(y.type.value,"(").concat(y.getByOffset("offsetB / 4u"),"[offsetB % 4u])"))),"\n          ")}else p=m.setByOffset("global_idx",f(g.getByOffset("global_idx"),y.getByOffset("global_idx")));else{if(!a)throw new Error("no necessary to use scalar implementation for element-wise binary op implementation.");let e=function(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"",r="aData[indexA".concat(t,"][componentA").concat(t,"]"),i="bData[indexB".concat(t,"][componentB").concat(t,"]");return"\n            let outputIndices".concat(t," = ").concat(m.offsetToIndices("global_idx * 4u + ".concat(t,"u")),";\n            let offsetA").concat(t," = ").concat(g.broadcastedIndicesToOffset("outputIndices".concat(t),m),";\n            let offsetB").concat(t," = ").concat(y.broadcastedIndicesToOffset("outputIndices".concat(t),m),";\n            let indexA").concat(t," = offsetA").concat(t," / 4u;\n            let indexB").concat(t," = offsetB").concat(t," / 4u;\n            let componentA").concat(t," = offsetA").concat(t," % 4u;\n            let componentB").concat(t," = offsetB").concat(t," % 4u;\n            ").concat(e,"[").concat(t,"] = ").concat(n,"(").concat(h(r,i),");\n          ")};p=9===u?"\n            var data = vec4<u32>(0);\n            ".concat(e("data",0,"u32"),"\n            ").concat(e("data",1,"u32"),"\n            ").concat(e("data",2,"u32"),"\n            ").concat(e("data",3,"u32"),"\n            outputData[global_idx] = dot(vec4<u32>(0x1, 0x100, 0x10000, 0x1000000), vec4<u32>(data));"):"\n            ".concat(e("outputData[global_idx]",0),"\n            ").concat(e("outputData[global_idx]",1),"\n            ").concat(e("outputData[global_idx]",2),"\n            ").concat(e("outputData[global_idx]",3),"\n          ")}return"\n        ".concat(e.registerUniform("vec_size","u32").declareVariables(g,y,m),"\n\n        ").concat(null!==d&&void 0!==d?d:"","\n\n        ").concat(e.mainStart(),"\n        ").concat(e.guardAgainstOutOfBoundsWorkgroupSizes("uniforms.vec_size"),"\n        ").concat(p,"\n      }")},qi=function(e,t,n,r,i,a){let o=arguments.length>6&&void 0!==arguments[6]?arguments[6]:n.dataType,s=n.dims.map(e=>{var t;return null!==(t=Number(e))&&void 0!==t?t:1}),c=r.dims.map(e=>{var t;return null!==(t=Number(e))&&void 0!==t?t:1}),l=!Rt.areEqual(s,c),u=s,d=Rt.size(s),h=!1,f=!1,p=[l];if(l){let e=Nt.calcShape(s,c,!1);if(!e)throw new Error("Can't perform binary op on the given tensors");u=e.slice(),d=Rt.size(u);let t=1===Rt.size(s),n=1===Rt.size(c),r=s.length>0&&s[s.length-1]%4===0,i=c.length>0&&c[c.length-1]%4===0;p.push(t),p.push(n),p.push(r),p.push(i);let a=1;for(let o=1;o<u.length;o++){let e=s[s.length-o];if(e!==c[c.length-o])break;a*=e}a%4===0?(f=!0,h=!0):(t||n||r||i)&&(h=!0)}else h=!0;return p.push(h),{name:e,shaderCache:{hint:t+p.map(e=>e.toString()).join("_"),inputDependencies:["rank","rank"]},getShaderSource:e=>Vi(e,s,c,u,h,l,f,i,n.dataType,r.dataType,o,a),getRunData:()=>({outputs:[{dims:u,dataType:o}],dispatchGroup:{x:Math.ceil(d/64/4)},programUniforms:[{type:12,data:Math.ceil(Rt.size(u)/4)},...pn(s,c,u)]})}},Hi=(e,t,n,r,i,a)=>{e.compute(qi(t,null!==i&&void 0!==i?i:"",e.inputs[0],e.inputs[1],n,r,a))},Wi=e=>{Hi(e,"Add",(e,t)=>"".concat(e,"+").concat(t))},Gi=e=>{Hi(e,"Div",(e,t)=>"".concat(e,"/").concat(t))},Ki=e=>{Hi(e,"Equal",{scalar:(e,t)=>"u32(".concat(e,"==").concat(t,")"),vector:(e,t)=>"vec4<u32>(".concat(e,"==").concat(t,")")},void 0,void 0,9)},Qi=e=>{Hi(e,"Mul",(e,t)=>"".concat(e,"*").concat(t))},Xi=e=>{let t=_n("input",e.inputs[0].dataType,e.inputs[0].dims).type.value;Hi(e,"Pow",{scalar:(e,t)=>"pow_custom(".concat(e,",").concat(t,")"),vector:(e,t)=>"pow_vector_custom(".concat(e,",").concat(t,")")},"\n    fn pow_custom(a : ".concat(t,", b : ").concat(t,") -> ").concat(t," {\n      if (b == ").concat(t,"(0.0)) {\n        return ").concat(t,"(1.0);\n      } else if (a < ").concat(t,"(0.0) && f32(b) != floor(f32(b))) {\n        return ").concat(t,"(pow(f32(a), f32(b))); // NaN\n      }\n      return select(sign(a), ").concat(t,"(1.0), round(f32(abs(b) % ").concat(t,"(2.0))) != 1.0) * ").concat(t,"(").concat("i32"===t?"round":"","(pow(f32(abs(a)), f32(b))));\n    }\n    fn pow_vector_custom(a : vec4<").concat(t,">, b : vec4<").concat(t,">) -> vec4<").concat(t,"> {\n      // TODO: implement vectorized pow\n      return vec4<").concat(t,">(pow_custom(a.x, b.x), pow_custom(a.y, b.y), pow_custom(a.z, b.z), pow_custom(a.w, b.w));\n    }\n      "))},Yi=e=>{Hi(e,"Sub",(e,t)=>"".concat(e,"-").concat(t))},Ji=e=>{Hi(e,"Greater",{scalar:(e,t)=>"u32(".concat(e,">").concat(t,")"),vector:(e,t)=>"vec4<u32>(".concat(e,">").concat(t,")")},void 0,void 0,9)},$i=e=>{Hi(e,"Less",{scalar:(e,t)=>"u32(".concat(e,"<").concat(t,")"),vector:(e,t)=>"vec4<u32>(".concat(e,"<").concat(t,")")},void 0,void 0,9)},Zi=e=>{Hi(e,"GreaterOrEqual",{scalar:(e,t)=>"u32(".concat(e,">=").concat(t,")"),vector:(e,t)=>"vec4<u32>(".concat(e,">=").concat(t,")")},void 0,void 0,9)},ea=e=>{Hi(e,"LessOrEqual",{scalar:(e,t)=>"u32(".concat(e,"<=").concat(t,")"),vector:(e,t)=>"vec4<u32>(".concat(e,"<=").concat(t,")")},void 0,void 0,9)}}),Hl=re(()=>{El(),Tl(),Rl(),Pl(),ta=(e,t)=>{if(!e||e.length<1)throw new Error("too few inputs");let n=e[0],r=n.dataType,i=n.dims.length;e.forEach((e,a)=>{if(0!==a){if(e.dataType!==r)throw new Error("input tensors should be one type");if(e.dims.length!==i)throw new Error("input tensors should have the same shape");e.dims.forEach((e,r)=>{if(r!==t&&e!==n.dims[r])throw new Error("non concat dimensions must match")})}})},na=(e,t)=>"\n  fn calculateInputIndex(index: u32) -> u32 {\n    let sizeInConcatAxis = array<u32, ".concat(e,"u>(").concat(t,");\n    for (var i: u32 = 0u; i < ").concat(e,"; i += 1u ) {\n      if (index < sizeInConcatAxis[i]) {\n        return i;\n      }\n    }\n    return ").concat(e,"u;\n  }"),ra=(e,t)=>{let n=e.length,r=[];for(let i=0;i<n;++i){let a=t.setByOffset("global_idx",e[i].getByIndices("indices"));1===n?r.push(a):0===i?r.push("if (inputIndex == ".concat(i,"u) { ").concat(a," }")):i===n-1?r.push("else { ".concat(a," }")):r.push("else if (inputIndex == ".concat(i,") { ").concat(a," }"))}return r.join("\n")},ia=(e,t,n,r)=>{let i=Rt.size(n),a=new Array(e.length),o=new Array(e.length),s=0,c=[],l=[],u=[{type:12,data:i}];for(let p=0;p<e.length;++p)s+=e[p].dims[t],a[p]=s,l.push(e[p].dims.length),o[p]=_n("input".concat(p),r,l[p]),c.push("rank"),u.push({type:12,data:a[p]});for(let p=0;p<e.length;++p)u.push(...pn(e[p].dims));u.push(...pn(n));let d=xn("output",r,n.length),h=d.indicesGet("indices",t),f=Array.from(Array(a.length).keys()).map(e=>"uniforms.sizeInConcatAxis".concat(e)).join(",");return{name:"Concat",shaderCache:{hint:"".concat(t),inputDependencies:c},getRunData:()=>({outputs:[{dims:n,dataType:r}],dispatchGroup:{x:Math.ceil(i/64)},programUniforms:u}),getShaderSource:t=>"\n\n  ".concat((()=>{t.registerUniform("outputSize","u32");for(let n=0;n<e.length;n++)t.registerUniform("sizeInConcatAxis".concat(n),"u32");return t.declareVariables(...o,d)})(),"\n\n  ").concat(na(a.length,f),"\n\n  ").concat(t.mainStart(),"\n    ").concat(t.guardAgainstOutOfBoundsWorkgroupSizes("uniforms.outputSize"),"\n\n    var indices = ").concat(d.offsetToIndices("global_idx"),";\n\n    let inputIndex = calculateInputIndex(").concat(h,");\n    if (inputIndex != 0u) {\n      let sizeInConcatAxis = array<u32, ").concat(a.length,"u>(").concat(f,");\n      ").concat(h," -= sizeInConcatAxis[inputIndex - 1u];\n    }\n\n    ").concat(ra(o,d),"\n  }")}},aa=(e,t)=>{let n=e.inputs,r=n[0].dims,i=Rt.normalizeAxis(t.axis,r.length);ta(n,i);let a=r.slice();a[i]=n.reduce((e,t)=>e+(t.dims.length>i?t.dims[i]:0),0);let o=n.filter(e=>Rt.size(e.dims)>0);e.compute(ia(o,i,a,n[0].dataType),{inputs:o})},oa=e=>ln({axis:e.axis})}),Wl=re(()=>{El(),Tl(),sa=function(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"f32";switch(e.activation){case"Relu":return"value = max(value, ".concat(t,"(0.0));");case"Sigmoid":return"value = (".concat(t,"(1.0) / (").concat(t,"(1.0) + exp(-value)));");case"Clip":return"value = clamp(value, ".concat(t,"(").concat(n,"(uniforms.clip_min)), ").concat(t,"(").concat(n,"(uniforms.clip_max)));");case"HardSigmoid":return"value = max(".concat(t,"(0.0), min(").concat(t,"(1.0), ").concat(n,"(uniforms.alpha) * value + ").concat(n,"(uniforms.beta)));");case"LeakyRelu":return"value = select(".concat(n,"(uniforms.alpha) * value, value, value >= ").concat(t,"(0.0));");case"Tanh":return"let e2x = exp(-2.0 * abs(value));\n              value = sign(value) * (1.0 - e2x) / (1.0 + e2x);\n        ";case"":return"";default:throw new Error("Unsupported activation ".concat(e.activation))}},ca=(e,t)=>{"Clip"===e.activation?t.push({type:1,data:e.clipMax},{type:1,data:e.clipMin}):"HardSigmoid"===e.activation?t.push({type:1,data:e.alpha},{type:1,data:e.beta}):"LeakyRelu"===e.activation&&t.push({type:1,data:e.alpha})},la=(e,t)=>{"Clip"===e.activation?t.push({name:"clip_max",type:"f32"},{name:"clip_min",type:"f32"}):"HardSigmoid"===e.activation?t.push({name:"alpha",type:"f32"},{name:"beta",type:"f32"}):"LeakyRelu"===e.activation&&t.push({name:"alpha",type:"f32"})},ua=e=>{let t=(null===e||void 0===e?void 0:e.activation)||"";if("HardSigmoid"===t){let[n,r]=(null===e||void 0===e?void 0:e.activation_params)||[.2,.5];return{activation:t,alpha:n,beta:r}}if("Clip"===t){let[n,r]=(null===e||void 0===e?void 0:e.activation_params)||[zt,Mt];return{activation:t,clipMax:r,clipMin:n}}if("LeakyRelu"===t){let[n]=(null===e||void 0===e?void 0:e.activation_params)||[.01];return{activation:t,alpha:n}}return{activation:t}}}),Gl=re(()=>{da=(e,t)=>{switch(e){case 1:return t;case 2:return"vec2<".concat(t,">");case 3:return"vec3<".concat(t,">");case 4:return"vec4<".concat(t,">");default:throw new Error("".concat(e,"-component is not supported."))}},ha=e=>"\n      ".concat(e?"value = value + getBiasByOutputCoords(coords);":"","\n      ")}),Kl=re(()=>{fa=e=>"\nfn getIndexFromCoords4D(coords : vec4<i32>, shape : vec4<i32>) -> i32 {\n  return dot(coords, vec4<i32>(\n      shape.y * shape.z * shape.w, shape.z * shape.w, shape.w, 1));\n}\nfn getOutputIndexFromCoords(coords : vec4<i32>) -> i32 {\n  return dot(coords, vec4<i32>(\n    i32(".concat(e,".x), i32(").concat(e,".y), i32(").concat(e,".z), 1));\n}\n")}),Ql=re(()=>{El(),Tl(),Pl(),Wl(),pa=(e,t,n,r,i)=>{let a=r-n;return"\n      ".concat(Array.from({length:n}).map((n,o)=>"\n      if (".concat(wn(t.shape,o,t.rank)," != 1) {\n        ").concat(t.indicesSet(e,o,wn(i,o+a,r)),"\n      } else {\n        ").concat(t.indicesSet(e,o,0),"\n      }")).join(""),"\n")},ma=function(e,t,n,r){let i=arguments.length>4&&void 0!==arguments[4]&&arguments[4],a=arguments.length>5?arguments[5]:void 0,o=e[0].dims,s=e[1].dims,c=o[o.length-2],l=s[s.length-1],u=o[o.length-1],d=mn(l),h=mn(u),f=mn(c),p=Rt.size(n)/d/f,m=e.length>2,g=r?r.slice(0,-2):n.slice(0,-2),y=[Rt.size(g),c,l],v=[{type:12,data:p},{type:12,data:c},{type:12,data:l},{type:12,data:u}];ca(t,v),v.push(...pn(g,o,s)),m&&v.push(...pn(e[2].dims)),v.push(...pn(y));return{name:"MatMulNaive",shaderCache:{hint:"".concat(t.activation,";").concat(d,";").concat(h,";").concat(f,";").concat(i),inputDependencies:m?["rank","rank","rank"]:["rank","rank"]},getRunData:()=>({outputs:[{dims:a?a(n):n,dataType:e[0].dataType}],dispatchGroup:{x:Math.ceil(p/64)},programUniforms:v}),getShaderSource:r=>{let a=Sn("batch_dims",e[0].dataType,g.length),c=_n("a",e[0].dataType,o.length,h),l=_n("b",e[1].dataType,s.length,d),u=xn("output",e[0].dataType,y.length,d),p=hn(u.type.tensor),v=sa(t,u.type.value,p),w=[c,l],b="";if(m){let t=i?d:1;w.push(_n("bias",e[2].dataType,e[2].dims.length,t)),b="".concat(i?"value += bias[col / ".concat(t,"];"):"value += ".concat(u.type.value,"(bias[row + i]);"))}let _=[{name:"output_size",type:"u32"},{name:"M",type:"u32"},{name:"N",type:"u32"},{name:"K",type:"u32"}];la(t,_);return"\n  ".concat(r.registerUniforms(_).registerInternalVariables(a).declareVariables(...w,u),"\n  ").concat(r.mainStart(),"\n    ").concat(r.guardAgainstOutOfBoundsWorkgroupSizes("uniforms.output_size"),"\n    let col = (global_idx % (uniforms.N / ").concat(d,")) * ").concat(d,";\n    var index1 = global_idx / (uniforms.N / ").concat(d,");\n    let stride1 = uniforms.M / ").concat(f,";\n    let row = (index1 % stride1) * ").concat(f,";\n    let batch = index1 / stride1;\n\n    ").concat(2===n.length?"":"let batch_indices = ".concat(a.offsetToIndices("batch"),";"),"\n\n    var a_indices: ").concat(c.type.indices,";\n    ").concat(pa("a_indices",c,c.rank-2,a.rank,"batch_indices"),"\n    ").concat(c.indicesSet("a_indices",c.rank-2,0),"\n    ").concat(c.indicesSet("a_indices",c.rank-1,0),"\n    let a_offset = ").concat(c.indicesToOffset("a_indices"),";\n\n    var b_indices: ").concat(l.type.indices,";\n    ").concat(pa("b_indices",l,l.rank-2,a.rank,"batch_indices"),"\n    ").concat(l.indicesSet("b_indices",l.rank-2,0),"\n    ").concat(l.indicesSet("b_indices",l.rank-1,0),"\n    let b_offset = ").concat(l.indicesToOffset("b_indices"),";\n    var values: array<").concat(u.type.value,", ").concat(f,">;\n    for (var k: u32 = 0u; k < uniforms.K; k = k + ").concat(h,") {\n      ").concat((()=>{let e="var a_data: ".concat(c.type.value,";");for(let t=0;t<h;t++)e+="\n              let b_data".concat(t," = b[(b_offset + (k + ").concat(t,") * uniforms.N + col) / ").concat(d,"];");for(let t=0;t<f;t++){e+="a_data = a[(a_offset + (row + ".concat(t,") * uniforms.K + k) / ").concat(h,"];");for(let n=0;n<h;n++)e+="\n            values[".concat(t,"] = fma(").concat(l.type.value,"(a_data").concat(1===h?"":"[".concat(n,"]"),"), b_data").concat(n,", values[").concat(t,"]);\n")}return e})(),"\n    }\n    for (var i = 0u; i < ").concat(f,"u; i++) {\n      var value = values[i];\n      ").concat(b,"\n      ").concat(v,"\n      let cur_indices = ").concat(u.type.indices,"(batch, row + i, col);\n      let offset = ").concat(u.indicesToOffset("cur_indices"),";\n      ").concat(u.setByOffset("offset / ".concat(d),"value"),";\n    }\n  }\n  ")}}}}),Xl=re(()=>{El(),Tl(),Pl(),Wl(),Ql(),Gl(),ga=(e,t)=>e?"\n        mm_Asub[inputRow][inputCol] = mm_readA(batch,\n          kStart + inputRow,\n          globalRowStart / innerElementSize + inputCol".concat(t?", batchIndices":"",");\n        "):"\n        mm_Asub[inputRow][inputCol] = mm_readA(batch,\n          globalRow + innerRow,\n          kStart / innerElementSize + inputCol".concat(t?", batchIndices":"",");\n        "),ya=(e,t)=>e?"\n        let ACached0 = mm_Asub[k * innerElementSize][localRow];\n        let ACached1 = mm_Asub[k * innerElementSize + 1][localRow];\n        let ACached2 = mm_Asub[k * innerElementSize + 2][localRow];\n        ".concat(3===t?"":"let ACached3 = mm_Asub[k * innerElementSize + 3][localRow];","\n        for (var i = 0; i < rowPerThread; i = i + 1) {\n          acc[i] = BCached0 * ACached0[i] + acc[i];\n          acc[i] = BCached1 * ACached1[i] + acc[i];\n          acc[i] = BCached2 * ACached2[i] + acc[i];\n          ").concat(3===t?"":"acc[i] = BCached3 * ACached3[i] + acc[i];","\n        }"):"\n        for (var i = 0; i < rowPerThread; i = i + 1) {\n          let ACached = mm_Asub[tileRow + i][k];\n          acc[i] = BCached0 * ACached.x + acc[i];\n          acc[i] = BCached1 * ACached.y + acc[i];\n          acc[i] = BCached2 * ACached.z + acc[i];\n          ".concat(3===t?"":"acc[i] = BCached3 * ACached.w + acc[i];","\n        }"),va=function(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"f32",r=arguments.length>3?arguments[3]:void 0,i=arguments.length>4&&void 0!==arguments[4]&&arguments[4],a=arguments.length>5&&void 0!==arguments[5]?arguments[5]:32,o=arguments.length>6&&void 0!==arguments[6]&&arguments[6],s=arguments.length>7&&void 0!==arguments[7]?arguments[7]:32,c=t[1]*e[1],l=t[0]*e[0],u=i?c:a,d=i?a:c,h=u/t[0],f=a/t[1];if((!i||4!==h||4!==e[1])&&(i||3!==h&&4!==h)||u%t[0]!==0||a%t[1]!==0||4!==e[0])throw new Error("If transposeA ".concat(i," is true, innerElementSize ").concat(h," and workPerThread[1] ").concat(e[1]," must be 4.\n      Otherwise, innerElementSize ").concat(h," must be 3 or 4.\n  tileAWidth ").concat(u," must be divisible by workgroupSize[0]").concat(t[0],". tileInner ").concat(a," must be divisible by workgroupSize[1] ").concat(t[1],". colPerThread ").concat(e[0]," must be 4."));return"\nvar<workgroup> mm_Asub: array<array<vec".concat(h,"<").concat(n,">, ").concat(u/h,">, ").concat(d,">;\nvar<workgroup> mm_Bsub: array<array<vec4<").concat(n,">, ").concat(l/e[0],">, ").concat(a,">;\n\nconst rowPerThread = ").concat(e[1],";\nconst colPerThread = ").concat(e[0],";\nconst innerElementSize = ").concat(h,";\nconst tileInner = ").concat(a,";\n\n@compute @workgroup_size(").concat(t[0],", ").concat(t[1],", ").concat(t[2],")\nfn main(@builtin(local_invocation_id) localId : vec3<u32>,\n        @builtin(global_invocation_id) globalId : vec3<u32>,\n        @builtin(workgroup_id) workgroupId : vec3<u32>) {\n  let localRow = i32(localId.y);\n  let tileRow = localRow * rowPerThread;\n  let tileCol = i32(localId.x);\n\n  let globalRow =i32(globalId.y) * rowPerThread;\n  let globalCol = i32(globalId.x);\n  let batch = ").concat(o?"0":"i32(globalId.z)",";\n  ").concat(r?"let batchIndices = ".concat(r.offsetToIndices("u32(batch)"),";"):"","\n  let globalRowStart = i32(workgroupId.y) * ").concat(c,";\n\n  let num_tiles = ").concat(o?"".concat(Math.ceil(s/a)):"(uniforms.dim_inner - 1) / tileInner + 1",";\n  var kStart = ").concat(o?"i32(globalId.z) * ".concat(s):"0",";\n\n  var acc: array<vec4<").concat(n,">, rowPerThread>;\n\n  // Loop over shared dimension.\n  let tileRowB = localRow * ").concat(f,";\n  for (var t = 0; t < num_tiles; t = t + 1) {\n      // Load one tile of A into local memory.\n      for (var innerRow = 0; innerRow < rowPerThread; innerRow = innerRow + 1) {\n          let inputRow = tileRow + innerRow;\n          let inputCol = tileCol;\n          ").concat(ga(i,r),"\n      }\n\n      // Load one tile of B into local memory.\n      for (var innerRow = 0; innerRow < ").concat(f,"; innerRow = innerRow + 1) {\n          let inputRow = tileRowB + innerRow;\n          let inputCol = tileCol;\n          mm_Bsub[inputRow][inputCol] = mm_readB(batch, kStart + inputRow, globalCol").concat(r?", batchIndices":"",");\n      }\n      kStart = kStart + tileInner;\n      workgroupBarrier();\n\n      // Compute acc values for a single thread.\n      for (var k = 0; k < tileInner / innerElementSize; k = k + 1) {\n          let BCached0 = mm_Bsub[k * innerElementSize][tileCol];\n          let BCached1 = mm_Bsub[k * innerElementSize + 1][tileCol];\n          let BCached2 = mm_Bsub[k * innerElementSize + 2][tileCol];\n          ").concat(3===h?"":"let BCached3 = mm_Bsub[k * innerElementSize + 3][tileCol];","\n\n          ").concat(ya(i,h),"\n      }\n\n      workgroupBarrier();\n  }\n\n  for (var innerRow = 0; innerRow < rowPerThread; innerRow = innerRow + 1) {\n      mm_write(batch, globalRow + innerRow, globalCol, acc[innerRow]);\n  }\n}")},wa=(e,t)=>e?"\n            mm_Asub[inputRow][inputCol] = mm_readA(batch,\n              kStart + inputRow,\n              globalRowStart + inputCol".concat(t?", batchIndices":"",");\n            "):"\n            mm_Asub[inputRow][inputCol] = mm_readA(batch,\n              globalRowStart + inputRow,\n              kStart + inputCol".concat(t?", batchIndices":"",");\n            "),ba=e=>e?"let ACached = mm_Asub[k][tileRow + innerRow];":"let ACached = mm_Asub[tileRow + innerRow][k];",_a=function(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"f32",r=arguments.length>3?arguments[3]:void 0,i=arguments.length>4&&void 0!==arguments[4]&&arguments[4],a=arguments.length>5&&void 0!==arguments[5]?arguments[5]:32,o=arguments.length>6&&void 0!==arguments[6]&&arguments[6],s=arguments.length>7&&void 0!==arguments[7]?arguments[7]:32,c=arguments.length>8&&void 0!==arguments[8]&&arguments[8],l=e[1]*t[1],u=e[0]*t[0],d=i?l:a,h=i?a:l;if(h%t[1]!==0||d%t[0]!==0||a%t[1]!==0)throw new Error("tileAHight ".concat(h," must be divisible by workgroupSize[1]").concat(t[1],", tileAWidth ").concat(d," must be divisible by workgroupSize[0]").concat(t[0],", tileInner ").concat(a," must be divisible by workgroupSize[1]").concat(t[1]));let f=h/t[1],p=d/t[0],m=a/t[1],g=c?"\n    let localRow = i32(localId.y);\n    let localCol = i32(localId.x);\n    let globalRowStart = i32(workgroupId.y) * ".concat(l,";\n    let globalColStart = i32(workgroupId.x) * ").concat(u,";\n\n    // Loop over shared dimension.\n    for (var t = 0; t < num_tiles; t = t + 1) {\n      // Load one tile of A into local memory.\n      for (var inputRow = localRow; inputRow < ").concat(h,"; inputRow = inputRow + ").concat(t[1],") {\n        for (var inputCol = localCol; inputCol < ").concat(d,"; inputCol = inputCol + ").concat(t[0],") {\n          ").concat(wa(i,r),"\n        }\n      }\n      // Load one tile of B into local memory.\n      for (var inputRow = localRow; inputRow < ").concat(a,"; inputRow = inputRow + ").concat(t[1],") {\n            for (var inputCol = localCol; inputCol < ").concat(u,"; inputCol = inputCol + ").concat(t[0],") {\n          mm_Bsub[inputRow][inputCol] = mm_readB(batch,\n            kStart + inputRow,\n            globalColStart + inputCol").concat(r?", batchIndices":"",");\n        }\n      }\n      kStart = kStart + tileInner;\n      workgroupBarrier();\n\n      // Compute acc values for a single thread.\n      var BCached : array<").concat(n,", colPerThread>;\n      for (var k = 0; k < tileInner; k = k + 1) {\n        for (var inner = 0; inner < colPerThread; inner = inner + 1) {\n          BCached[inner] = mm_Bsub[k][localCol + inner * ").concat(t[0],"];\n        }\n        for (var innerRow = 0; innerRow < rowPerThread; innerRow = innerRow + 1) {\n          let ACached = ").concat(i?"mm_Asub[k][localRow + innerRow * ".concat(t[1],"];"):"mm_Asub[localRow + innerRow * ".concat(t[1],"][k];"),"\n          for (var innerCol = 0; innerCol < colPerThread; innerCol = innerCol + 1) {\n            acc[innerRow][innerCol] = acc[innerRow][innerCol] +\n                ACached * BCached[innerCol];\n          }\n        }\n      }\n      workgroupBarrier();\n    }\n    for (var innerRow = 0; innerRow < rowPerThread; innerRow = innerRow + 1) {\n      let gRow = globalRowStart + localRow + innerRow * ").concat(t[1],";\n      for (var innerCol = 0; innerCol < colPerThread; innerCol = innerCol + 1) {\n        let gCol = globalColStart + localCol + innerCol * ").concat(t[0],";\n        mm_write(batch, gRow, gCol, acc[innerRow][innerCol]);\n      }\n    }\n    "):"\nlet tileRow = i32(localId.y) * rowPerThread;\nlet tileCol = i32(localId.x) * colPerThread;\n\nlet globalRow = i32(globalId.y) * rowPerThread;\nlet globalCol = i32(globalId.x) * colPerThread;\nlet globalRowStart = i32(workgroupId.y) * ".concat(l,";\n\nlet tileRowA = i32(localId.y) * ").concat(f,";\nlet tileColA = i32(localId.x) * ").concat(p,";\nlet tileRowB = i32(localId.y) * ").concat(m,";\n// Loop over shared dimension.\nfor (var t = 0; t < num_tiles; t = t + 1) {\n  // Load one tile of A into local memory.\n  for (var innerRow = 0; innerRow < ").concat(f,"; innerRow = innerRow + 1) {\n    for (var innerCol = 0; innerCol < ").concat(p,"; innerCol = innerCol + 1) {\n      let inputRow = tileRowA + innerRow;\n      let inputCol = tileColA + innerCol;\n      ").concat(wa(i,r),"\n    }\n  }\n\n  // Load one tile of B into local memory.\n  for (var innerRow = 0; innerRow < ").concat(m,"; innerRow = innerRow + 1) {\n    for (var innerCol = 0; innerCol < colPerThread; innerCol = innerCol + 1) {\n      let inputRow = tileRowB + innerRow;\n      let inputCol = tileCol + innerCol;\n      mm_Bsub[inputRow][inputCol] = mm_readB(batch,\n        kStart + inputRow,\n        globalCol + innerCol").concat(r?", batchIndices":"",");\n    }\n  }\n  kStart = kStart + tileInner;\n  workgroupBarrier();\n\n  // Compute acc values for a single thread.\n  var BCached : array<").concat(n,", colPerThread>;\n  for (var k = 0; k < tileInner; k = k + 1) {\n    for (var inner = 0; inner < colPerThread; inner = inner + 1) {\n      BCached[inner] = mm_Bsub[k][tileCol + inner];\n    }\n\n    for (var innerRow = 0; innerRow < rowPerThread; innerRow = innerRow + 1) {\n      ").concat(ba(i),"\n      for (var innerCol = 0; innerCol < colPerThread; innerCol = innerCol + 1) {\n        acc[innerRow][innerCol] = acc[innerRow][innerCol] + ACached * BCached[innerCol];\n      }\n    }\n  }\n\n  workgroupBarrier();\n}\n\nfor (var innerRow = 0; innerRow < rowPerThread; innerRow = innerRow + 1) {\n  for (var innerCol = 0; innerCol < colPerThread; innerCol = innerCol + 1) {\n    mm_write(batch, globalRow + innerRow, globalCol + innerCol,\n        acc[innerRow][innerCol]);\n  }\n}\n");return"\n  var<workgroup> mm_Asub : array<array<".concat(n,", ").concat(d,">, ").concat(h,">;\n  var<workgroup> mm_Bsub : array<array<").concat(n,", ").concat(u,">, ").concat(a,">;\n  const rowPerThread = ").concat(e[1],";\n  const colPerThread = ").concat(e[0],";\n  const tileInner = ").concat(a,";\n\n@compute @workgroup_size(").concat(t[0],", ").concat(t[1],", ").concat(t[2],")\nfn main(@builtin(local_invocation_id) localId : vec3<u32>,\n        @builtin(global_invocation_id) globalId : vec3<u32>,\n        @builtin(workgroup_id) workgroupId : vec3<u32>) {\n    let batch = ").concat(o?"0":"i32(globalId.z)",";\n    ").concat(r?"let batchIndices = ".concat(r.offsetToIndices("u32(batch)"),";"):"","\n    let num_tiles = ").concat(o?"".concat(Math.ceil(s/a)):"(uniforms.dim_inner - 1) / tileInner + 1",";\n    var kStart = ").concat(o?"i32(globalId.z) * ".concat(s):"0",";\n\n    var acc : array<array<").concat(n,", colPerThread>, rowPerThread>;\n    ").concat(g,"\n  }\n")},xa=function(e,t,n,r){let i=arguments.length>4&&void 0!==arguments[4]&&arguments[4],[a,o,s,c]=r,l=hn(r[0].type.tensor);return"\n    fn mm_readA(batch: i32, row: i32, colIn: i32, batchIndices: ".concat(a.type.indices,") -> ").concat(da(e,l)," {\n      var value = ").concat(da(e,l),"(0.0);\n      let col = colIn * ").concat(e,";\n      if(row < uniforms.dim_a_outer && col < uniforms.dim_inner)\n      {\n        var aIndices: ").concat(o.type.indices,";\n        ").concat(pa("aIndices",o,o.rank-2,a.rank,"batchIndices"),"\n        ").concat(o.indicesSet("aIndices",o.rank-2,"u32(row)"),"\n        ").concat(o.indicesSet("aIndices",o.rank-1,"u32(colIn)"),"\n        value = ").concat(o.getByIndices("aIndices"),";\n      }\n      return value;\n    }\n\n    fn mm_readB(batch: i32, row: i32, colIn: i32, batchIndices: ").concat(a.type.indices,") -> ").concat(da(e,l)," {\n      var value = ").concat(da(e,l),"(0.0);\n      let col = colIn * ").concat(e,";\n      if(row < uniforms.dim_inner && col < uniforms.dim_b_outer)\n      {\n        var bIndices: ").concat(s.type.indices,";\n        ").concat(pa("bIndices",s,s.rank-2,a.rank,"batchIndices"),"\n        ").concat(s.indicesSet("bIndices",s.rank-2,"u32(row)"),"\n        ").concat(s.indicesSet("bIndices",s.rank-1,"u32(colIn)"),"\n        value = ").concat(s.getByIndices("bIndices"),";\n      }\n      return value;\n    }\n\n    fn mm_write(batch: i32, row: i32, colIn: i32, valueIn: ").concat(da(e,l),") {\n      let col = colIn * ").concat(e,";\n      if (row < uniforms.dim_a_outer && col < uniforms.dim_b_outer) {\n        var value = valueIn;\n        let coords = vec3<i32>(batch, row, colIn);\n        ").concat(t?"value = value + ".concat(i?"bias[colIn]":"".concat(da(e,l),"(bias[row])"),";"):"","\n        ").concat(n,"\n        ").concat(c.setByIndices("vec3<u32>(coords)","value"),"\n      }\n    }\n    ")},Ea=function(e,t,n,r){let i=arguments.length>4&&void 0!==arguments[4]&&arguments[4],a=arguments.length>5?arguments[5]:void 0,o=e[0].dims,s=e[1].dims,c=o.slice(0,-2),l=s.slice(0,-2),u=r?r.slice(0,-2):n.slice(0,-2),d=Rt.size(u),h=o[o.length-2],f=o[o.length-1],p=s[s.length-1],m=f%4===0&&p%4===0,g=h<=8?[4,1,1]:[4,4,1],y=[8,8,1],v=[Math.ceil(p/y[0]/g[0]),Math.ceil(h/y[1]/g[1]),Math.ceil(d/y[2]/g[2])],w=m?4:1,b=[...c,h,f/w],_=b.length,x=[...l,f,p/w],E=x.length,S=[d,h,p/w],k=[{type:6,data:h},{type:6,data:p},{type:6,data:f}];ca(t,k),k.push(...pn(u,b,x));let T=["rank","rank"],I=e.length>2;I&&(k.push(...pn(e[2].dims)),T.push("rank")),k.push(...pn(S));return{name:"MatMul",shaderCache:{hint:"".concat(g,";").concat(t.activation,";").concat(m,";").concat(i),inputDependencies:T},getRunData:()=>({outputs:[{dims:a?a(n):n,dataType:e[0].dataType}],dispatchGroup:{x:v[0],y:v[1],z:v[2]},programUniforms:k}),getShaderSource:n=>{let r=u.length,a=Sn("batchDims",e[0].dataType,r,1),o=hn(e[0].dataType),s=_n("a",e[0].dataType,_,w),c=_n("b",e[1].dataType,E,w),l=xn("result",e[0].dataType,S.length,w),d=[s,c];if(I){let t=i?w:1;d.push(_n("bias",e[2].dataType,e[2].dims.length,t))}let h=[{name:"dim_a_outer",type:"i32"},{name:"dim_b_outer",type:"i32"},{name:"dim_inner",type:"i32"}];la(t,h);let f=hn(l.type.tensor),p=sa(t,l.type.value,f),v=xa(w,I,p,[a,s,c,l],i);return"\n  ".concat(n.registerUniforms(h).registerInternalVariables(a).declareVariables(...d,l),"\n  ").concat(v,"\n  ").concat(m?va(g,y,o,a):_a(g,y,o,a),"\n                   ")}}}}),Yl=re(()=>{El(),kl(),Pl(),Wl(),Gl(),Kl(),Xl(),Sa=function(e,t,n,r){let i=arguments.length>4&&void 0!==arguments[4]&&arguments[4],a=arguments.length>5?arguments[5]:void 0,o=arguments.length>6&&void 0!==arguments[6]?arguments[6]:4,s=arguments.length>7&&void 0!==arguments[7]?arguments[7]:4,c=arguments.length>8&&void 0!==arguments[8]?arguments[8]:4,l=arguments.length>9&&void 0!==arguments[9]?arguments[9]:"f32",u=e=>{switch(e){case 1:return"return w[row * i32(uniforms.w_shape[3]) + colIn];";case 4:return"return w[row * i32(uniforms.w_shape[3]) / 4 + colIn];";default:throw new Error("innerElementSize ".concat(e," is not supported."))}},d=e?"\n    let coord = vec4<i32>(batch, xRow, xCol, xCh);\n    ":"\n    let coord = vec4<i32>(batch, xCh, xRow, xCol);\n    ",h=e?"\n    let coords = vec4<i32>(\n      batch,\n      row / outWidth,\n      row % outWidth,\n      col);\n    ":"\n    let coords = vec4<i32>(\n      batch,\n      row,\n      col / outWidth,\n      col % outWidth);\n    ",f=e?"i32(uniforms.x_shape[1])":"i32(uniforms.x_shape[2])",p=e?"i32(uniforms.x_shape[2])":"i32(uniforms.x_shape[3])",m=e?"row":"col",g=e?"col":"row",y="\n    let inChannels = i32(uniforms.w_shape[2]);\n    let outWidth = ".concat(e?"i32(uniforms.result_shape[2])":"i32(uniforms.result_shape[3])",";\n    let outRow = ").concat(m," / outWidth;\n    let outCol = ").concat(m," % outWidth;\n\n    let WRow = ").concat(g," / (i32(uniforms.w_shape[1]) * inChannels);\n    let WCol = ").concat(g," / inChannels % i32(uniforms.w_shape[1]);\n    let xRow = outRow * uniforms.stride[0] + uniforms.dilation[0] * WRow - uniforms.pad[0];\n    let xCol = outCol * uniforms.stride[1] + uniforms.dilation[1] * WCol - uniforms.pad[1];\n    let xCh = ").concat(g," % inChannels;\n    var resData = ").concat(da(o,l),"(0.0);\n    // The bounds checking is always needed since we use it to pad zero for\n    // the 'same' padding type.\n    if (xRow >= 0 && xRow < ").concat(f," && xCol >= 0 && xCol < ").concat(p,") {\n      ").concat(d,"\n      let xIndex = getIndexFromCoords4D(coord, vec4<i32>(uniforms.x_shape));\n      ").concat((e=>{switch(e){case 1:return"resData = x[xIndex];";case 3:return"resData = vec3<".concat(l,">(x[xIndex], x[xIndex + 1], x[xIndex + 2]);");case 4:return"resData = x[xIndex / 4];";default:throw new Error("innerElementSize ".concat(e," is not supported."))}})(o),"\n    }\n    return resData;"),v=e?t&&r?"\n    let col = colIn * ".concat(o,";\n    ").concat(y):"\n    let col = colIn * ".concat(o,";\n    if (row < uniforms.dim_a_outer && col < uniforms.dim_inner) {\n      ").concat(y,"\n    }\n    return ").concat(da(o,l),"(0.0);"):r&&n?"\n    let col = colIn * ".concat(o,";\n    ").concat(y):"\n    let col = colIn * ".concat(o,";\n    if (row < uniforms.dim_inner && col < uniforms.dim_b_outer) {\n      ").concat(y,"\n    }\n    return ").concat(da(o,l),"(0.0);"),w=e?r&&n?u(s):"\n    let col = colIn * ".concat(s,";\n    if (row < uniforms.dim_inner && col < uniforms.dim_b_outer) {\n      ").concat(u(s),"\n    }\n    return ").concat(da(s,l),"(0.0);"):"\n    let col = colIn * ".concat(s,";\n    if (row < uniforms.dim_inner && col < uniforms.dim_a_outer) {\n      ").concat(u(s),"\n    }\n    return ").concat(da(s,l),"(0.0);"),b=da(c,l),_=da(e?o:s,l),x=da(e?s:o,l),E=sa(a,b,l);return"\n    fn mm_readA(batch: i32, row : i32, colIn : i32) -> ".concat(_," {\n      ").concat(e?v:w,"\n    }\n\n    fn mm_readB(batch: i32, row : i32, colIn : i32) -> ").concat(x," {\n      ").concat(e?w:v,"\n    }\n\n    fn mm_write(batch: i32, row : i32, colIn : i32, valueIn : ").concat(b,") {\n      let col = colIn * ").concat(c,";\n      if (row < uniforms.dim_a_outer && col < uniforms.dim_b_outer)\n      {\n      var value = valueIn;\n      let outWidth = ").concat(e?"i32(uniforms.result_shape[2])":"i32(uniforms.result_shape[3])",";\n      ").concat(h,"\n      ").concat(ha(i),"\n      ").concat(E,"\n      setOutputAtCoords(coords[0], coords[1], coords[2], coords[3], value);\n      }\n    }")},ka=(e,t,n,r,i,a,o,s,c)=>{let l="NHWC"===t.format,u=l?e[0].dims[3]:e[0].dims[1],d=n[0],h=l?n[2]:n[3],f=l?n[1]:n[2],p=l?n[3]:n[1],m=l&&(u%4===0||u%3===0)&&p%4===0,g=l?p:h*f,y=l?h*f:p,v=[8,8,1],w=r<=8?[4,1,1]:[4,4,1],b=[Math.ceil(g/v[0]/w[0]),Math.ceil(y/v[1]/w[1]),Math.ceil(d/v[2]/w[2])];At("verbose",()=>"[conv2d_mm_webgpu] dispatch = ".concat(b));let _=m?l&&u%4!==0?3:4:1,x=v[1]*w[1],E=v[0]*w[0],S=Math.max(v[0]*_,v[1]),k=r%x===0,T=i%E===0,I=a%S===0,C=m?[_,4,4]:[1,1,1],A=[{type:6,data:r},{type:6,data:i},{type:6,data:a},{type:6,data:[t.pads[0],t.pads[1]]},{type:6,data:t.strides},{type:6,data:t.dilations}];ca(t,A),A.push(...pn(e[0].dims,e[1].dims));let O=["rank","rank"];o&&(A.push(...pn(e[2].dims)),O.push("rank")),A.push(...pn(n));return{name:"Conv2DMatMul",shaderCache:{hint:"".concat(t.cacheKey,";").concat(_,";").concat(m,";").concat(k,";").concat(T,";").concat(I,";").concat(x,";").concat(E,";").concat(S),inputDependencies:O},getRunData:()=>({outputs:[{dims:c?c(n):n,dataType:e[0].dataType}],dispatchGroup:{x:b[0],y:b[1],z:b[2]},programUniforms:A}),getShaderSource:r=>{let i=[{name:"dim_a_outer",type:"i32"},{name:"dim_b_outer",type:"i32"},{name:"dim_inner",type:"i32"},{name:"pad",type:"i32",length:2},{name:"stride",type:"i32",length:2},{name:"dilation",type:"i32",length:2}];la(t,i);let a=m?4:1,c=hn(e[0].dataType),u="\n      fn setOutputAtIndex(flatIndex : i32, value : ".concat(m?"vec4<".concat(c,">"):c,") {\n        result[flatIndex] = ").concat(m?"vec4<".concat(c,">"):c,"(value);\n      }\n      fn setOutputAtCoords(d0 : i32, d1 : i32, d2 : i32, d3 : i32, value : ").concat(m?"vec4<".concat(c,">"):c,") {\n        let flatIndex = getOutputIndexFromCoords(vec4<i32>(d0, d1, d2, d3));\n        setOutputAtIndex(flatIndex ").concat(m?"/ 4":"",", value);\n      }"),d=[_n("x",e[0].dataType,e[0].dims.length,3===_?1:_),_n("w",e[1].dataType,e[1].dims.length,a)],h=xn("result",e[0].dataType,n.length,a);if(o){let t=_n("bias",e[2].dataType,e[2].dims.length,a);d.push(t),u+="\n        fn getBiasByOutputCoords(coords : vec4<i32>) -> ".concat(m?"vec4<".concat(c,">"):c," {\n          return bias[coords.").concat(l?"w":"y").concat(m?"/ 4":"","];\n        }")}return"\n        ".concat(fa("uniforms.result_strides"),"\n        //struct Uniforms { xShape : vec4<i32>, wShape : vec4<i32>, outShape : vec4<i32>,\n        //  outShapeStrides: vec3<i32>, filterDims : vec2<i32>, pad : vec2<i32>, stride : vec2<i32>,\n        //  dilation : vec2<i32>, dimAOuter : i32, dimBOuter : i32, dimInner : i32 };\n        ").concat(r.registerUniforms(i).declareVariables(...d,h),"\n        ").concat(u,"\n        ").concat(Sa(l,k,T,I,o,t,C[0],C[1],C[2],c),"\n        ").concat(m?va(w,v,c,void 0,!l,S):_a(w,v,c,void 0,!l,S,!1,void 0,s))}}}}),Jl=re(()=>{El(),kl(),Tl(),Pl(),Wl(),Gl(),Ta=e=>{let t=1;for(let n=0;n<e.length;n++)t*=e[n];return t},Ia=e=>"number"==typeof e?[e,e,e]:e,Ca=(e,t)=>t<=1?e:e+(e-1)*(t-1),Aa=function(e,t,n){let r=Ca(t,arguments.length>3&&void 0!==arguments[3]?arguments[3]:1);return Math.floor((e[0]*(n-1)-n+r)/2)},Oa=(e,t,n,r,i)=>{null==i&&(i=Aa(e,t[0],r[0]));let a=[0,0,0,n];for(let o=0;o<3;o++)e[o]+2*i>=t[o]&&(a[o]=Math.trunc((e[o]-t[o]+2*i)/r[o]+1));return a},Na=(e,t,n,r,i,a,o,s,c,l)=>{let u,d,h,f;if("VALID"===e&&(e=0),"number"==typeof e){u={top:e,bottom:e,left:e,right:e,front:e,back:e};let p=Oa([t,n,r,1],[s,c,l],1,[i,a,o],e);d=p[0],h=p[1],f=p[2]}else if(Array.isArray(e)){if(!e.every((e,t,n)=>e===n[0]))throw Error("Unsupported padding parameter: ".concat(e));u={top:e[0],bottom:e[1],left:e[2],right:e[3],front:e[4],back:e[5]};let p=Oa([t,n,r,1],[s,c,l],1,[i,a,o],e[0]);d=p[0],h=p[1],f=p[2]}else{if("SAME_UPPER"!==e)throw Error("Unknown padding parameter: ".concat(e));{d=Math.ceil(t/i),h=Math.ceil(n/a),f=Math.ceil(r/o);let e=(d-1)*i+s-t,p=(h-1)*a+c-n,m=(f-1)*o+l-r,g=Math.floor(e/2),y=e-g,v=Math.floor(p/2),w=p-v,b=Math.floor(m/2);u={top:v,bottom:w,left:b,right:m-b,front:g,back:y}}}return{padInfo:u,outDepth:d,outHeight:h,outWidth:f}},Ra=function(e,t,n,r,i){let a,o,s,c,l,u=arguments.length>5&&void 0!==arguments[5]&&arguments[5],d=arguments.length>6&&void 0!==arguments[6]?arguments[6]:"channelsLast";if("channelsLast"===d)[a,o,s,c,l]=e;else{if("channelsFirst"!==d)throw new Error("Unknown dataFormat ".concat(d));[a,l,o,s,c]=e}let[h,,f,p,m]=t,[g,y,v]=Ia(n),[w,b,_]=Ia(r),x=Ca(f,w),E=Ca(p,b),S=Ca(m,_),{padInfo:k,outDepth:T,outHeight:I,outWidth:C}=Na(i,o,s,c,g,y,v,x,E,S),A=u?h*l:h,O=[0,0,0,0,0];return"channelsFirst"===d?O=[a,A,T,I,C]:"channelsLast"===d&&(O=[a,T,I,C,A]),{batchSize:a,dataFormat:d,inDepth:o,inHeight:s,inWidth:c,inChannels:l,outDepth:T,outHeight:I,outWidth:C,outChannels:A,padInfo:k,strideDepth:g,strideHeight:y,strideWidth:v,filterDepth:f,filterHeight:p,filterWidth:m,effectiveFilterDepth:x,effectiveFilterHeight:E,effectiveFilterWidth:S,dilationDepth:w,dilationHeight:b,dilationWidth:_,inShape:e,outShape:O,filterShape:t}},Pa=(e,t,n,r,i,a)=>{let o="channelsLast"===a,s=(o?e[0].dims[3]:e[0].dims[1],{x:n.map((e,t)=>t)}),c=[Math.ceil(Ta(s.x.map(e=>n[e]))/64),1,1];At("verbose",()=>"[conv3d_naive_webgpu] dispatch = ".concat(c));let l=[{type:12,data:Rt.size(n)},{type:12,data:r},{type:12,data:i},{type:12,data:t.strides},{type:12,data:t.dilations}];ca(t,l),l.push(...pn(e[0].dims,e[1].dims));let u=["rank","rank"],d=3===e.length;d&&(l.push(...pn(e[2].dims)),u.push("rank")),l.push(...pn(n));return{name:"Conv3DNaive",shaderCache:{hint:"".concat(t.cacheKey,";").concat(o,";").concat(1,";").concat(d),inputDependencies:u},getRunData:()=>({outputs:[{dims:n,dataType:e[0].dataType}],dispatchGroup:{x:c[0],y:c[1],z:c[2]},programUniforms:l}),getShaderSource:a=>{let s=[{name:"output_size",type:"u32"},{name:"filter_dims",type:"u32",length:r.length},{name:"pads",type:"u32",length:i.length},{name:"strides",type:"u32",length:t.strides.length},{name:"dilations",type:"u32",length:t.dilations.length}];la(t,s);let c=hn(e[0].dataType),l=_n("x",e[0].dataType,e[0].dims.length,1),u=_n("W",e[1].dataType,e[1].dims.length,1),h=[l,u],f=xn("result",e[0].dataType,n.length,1),p="";if(d){let t=_n("bias",e[2].dataType,e[2].dims.length,1);h.push(t),p+="\n        fn getBiasByOutputCoords(coords : array<u32, 5>) -> ".concat(c," {\n          return bias[").concat(wn("coords",o?4:1,5)).concat("","];\n        }")}let m=da(1,c),g=sa(t,m,c);return"\n            ".concat(p,"\n            fn getX(d0 : u32, d1 : u32, d2 : u32, d3 : u32, d4 : u32) -> f32 {\n              let aIndices = array<u32, 5>(d0, d1, d2, d3, d4);\n              return ").concat(l.getByIndices("aIndices"),";\n            }\n            fn getW(d0 : u32, d1 : u32, d2 : u32, d3 : u32, d4 : u32) -> f32 {\n              let aIndices = array<u32, 5>(d0, d1, d2, d3, d4);\n              return ").concat(u.getByIndices("aIndices"),";\n            }\n          ").concat(a.registerUniforms(s).declareVariables(...h,f),"\n          ").concat(a.mainStart(),"\n          ").concat(a.guardAgainstOutOfBoundsWorkgroupSizes("uniforms.output_size"),"\n              let coords = ").concat(f.offsetToIndices("global_idx"),";\n              let batch = ").concat(wn("coords",0,l.rank),";\n              let d2 = ").concat(wn("coords",o?l.rank-1:1,l.rank),";\n              let xFRCCorner = vec3<u32>(").concat(wn("coords",o?1:2,l.rank),",\n              ").concat(wn("coords",o?2:3,l.rank),",\n              ").concat(wn("coords",o?3:4,l.rank),") * uniforms.strides - uniforms.pads;\n              let xFCorner = xFRCCorner.x;\n              let xRCorner = xFRCCorner.y;\n              let xCCorner = xFRCCorner.z;\n              let xShapeY = ").concat(wn("uniforms.x_shape",o?1:2,l.rank),";\n              let xShapeZ = ").concat(wn("uniforms.x_shape",o?2:3,l.rank),";\n              let xShapeW = ").concat(wn("uniforms.x_shape",o?3:4,l.rank),";\n              let xShapeU = ").concat(wn("uniforms.x_shape",o?4:1,l.rank),";\n              let inputDepthNearestVec4 = (xShapeU / 4) * 4;\n              let inputDepthVec4Remainder = xShapeU % 4;\n\n              var value = 0.0;\n              for (var wF = 0u; wF < uniforms.filter_dims[0]; wF++) {\n                let xF = xFCorner + wF * uniforms.dilations[0];\n                if (xF < 0 || xF >= xShapeY) {\n                  continue;\n                }\n\n                for (var wR = 0u; wR < uniforms.filter_dims[1]; wR++) {\n                  let xR = xRCorner + wR * uniforms.dilations[1];\n                  if (xR < 0 || xR >= xShapeZ) {\n                    continue;\n                  }\n\n                  for (var wC = 0u; wC < uniforms.filter_dims[2]; wC++) {\n                    let xC = xCCorner + wC * uniforms.dilations[2];\n                    if (xC < 0 || xC >= xShapeW) {\n                      continue;\n                    }\n\n                    for (var d1 = 0u; d1 < inputDepthNearestVec4; d1 += 4) {\n                      ").concat(o?"let xValues = vec4<f32>(\n                               getX(batch, xF, xR, xC, d1),\n                               getX(batch, xF, xR, xC, d1 + 1),\n                               getX(batch, xF, xR, xC, d1 + 2),\n                               getX(batch, xF, xR, xC, d1 + 3));\n                            ":"let xValues = vec4<f32>(\n                               getX(batch, d1, xF, xR, xC),\n                               getX(batch, d1 + 1, xF, xR, xC),\n                               getX(batch, d1 + 2, xF, xR, xC),\n                               getX(batch, d1 + 3, xF, xR, xC));\n                            ","\n                            let wValues = vec4<f32>(\n                              getW(d2, d1, wF, wR, wC),\n                              getW(d2, d1 + 1, wF, wR, wC),\n                              getW(d2, d1 + 2, wF, wR, wC),\n                              getW(d2, d1 + 3, wF, wR, wC));\n                      value += dot(xValues, wValues);\n                    }\n                    if (inputDepthVec4Remainder == 1) {\n                        ").concat(o?"value += getX(batch, xF, xR, xC, inputDepthNearestVec4)\n                          * getW(d2, inputDepthNearestVec4, wF, wR, wC);":"value += getX(batch, inputDepthNearestVec4, xF, xR, xC)\n                          * getW(d2, inputDepthNearestVec4, wF, wR, wC);","\n                    } else if (inputDepthVec4Remainder == 2) {\n                      ").concat(o?"let xValues = vec2<f32>(\n                        getX(batch, xF, xR, xC, inputDepthNearestVec4),\n                        getX(batch, xF, xR, xC, inputDepthNearestVec4 + 1));\n                      ":"let xValues = vec2<f32>(\n                        getX(batch, inputDepthNearestVec4, xF, xR, xC),\n                        getX(batch, inputDepthNearestVec4 + 1, xF, xR, xC));\n                    ","\n                    let wValues = vec2<f32>(\n                      getW(d2, inputDepthNearestVec4, wF, wR, wC),\n                      getW(d2, inputDepthNearestVec4 + 1, wF, wR, wC));\n                      value += dot(xValues, wValues);\n                    } else if (inputDepthVec4Remainder == 3) {\n                      ").concat(o?"let xValues = vec3<f32>(\n                        getX(batch, xF, xR, xC, inputDepthNearestVec4),\n                        getX(batch, xF, xR, xC, inputDepthNearestVec4 + 1),\n                        getX(batch, xF, xR, xC, inputDepthNearestVec4 + 2));\n                      ":"let xValues = vec3<f32>(\n                        getX(batch, inputDepthNearestVec4, xF, xR, xC),\n                        getX(batch, inputDepthNearestVec4 + 1, xF, xR, xC),\n                        getX(batch, inputDepthNearestVec4 + 2, xF, xR, xC));\n                    ","\n                    let wValues = vec3<f32>(\n                      getW(d2, inputDepthNearestVec4, wF, wR, wC),\n                      getW(d2, inputDepthNearestVec4 + 1, wF, wR, wC),\n                      getW(d2, inputDepthNearestVec4 + 2, wF, wR, wC));\n                      value += dot(xValues, wValues);\n                    }\n                  }\n                }\n              }\n              ").concat(d?"value = value + getBiasByOutputCoords(coords)":"",";\n              ").concat(g,"\n              result[global_idx] = f32(value);\n          }")}}}}),$l=re(()=>{El(),Tl(),Pl(),Wl(),Da=(e,t,n,r)=>{let i=e.length>2,a=i?"value += b[output_channel];":"",o=e[0].dims,s=e[1].dims,c="NHWC"===t.format,l=c?n[3]:n[1],u=l/t.group,d=c&&u>=4?mn(l):1,h=Rt.size(n)/d,f=[{type:12,data:h},{type:12,data:t.dilations},{type:12,data:[t.strides[0],t.strides[1]]},{type:12,data:[t.pads[0],t.pads[1]]},{type:12,data:u}];ca(t,f),f.push(...pn(o,[s[0],s[1],s[2],s[3]/d]));let p=i?["rank","rank","rank"]:["rank","rank"];f.push(...pn([n[0],n[1],n[2],n[3]/d]));return{name:"GroupedConv",shaderCache:{hint:"".concat(t.cacheKey,"_").concat(d),inputDependencies:p},getRunData:()=>({outputs:[{dims:r?r(n):n,dataType:e[0].dataType}],dispatchGroup:{x:Math.ceil(h/64)},programUniforms:f}),getShaderSource:r=>{let l=xn("output",e[0].dataType,n.length,d),u=hn(l.type.tensor),h=sa(t,l.type.value,u),f=_n("x",e[0].dataType,o.length),p=_n("w",e[1].dataType,s.length,d),m=[f,p];i&&m.push(_n("b",e[2].dataType,e[2].dims,d));let g=[{name:"output_size",type:"u32"},{name:"dilations",type:"u32",length:t.dilations.length},{name:"strides",type:"u32",length:2},{name:"pads",type:"u32",length:2},{name:"output_channels_per_group",type:"u32"}];la(t,g);let y=c?"\n      for (var wHeight: u32 = 0u; wHeight < uniforms.w_shape[0]; wHeight++) {\n        let xHeight = xRCCorner.x + wHeight * uniforms.dilations[0];\n\n        if (xHeight < 0u || xHeight >= uniforms.x_shape[1]) {\n          continue;\n        }\n\n        for (var wWidth: u32 = 0u; wWidth < uniforms.w_shape[1]; wWidth++) {\n          let xWidth = xRCCorner.y + wWidth * uniforms.dilations[1];\n          if (xWidth < 0u || xWidth >= uniforms.x_shape[2]) {\n            continue;\n          }\n\n          for (var wInChannel: u32 = 0u; wInChannel < uniforms.w_shape[2]; wInChannel++) {\n            let input_channel = in_channel_offset + wInChannel;\n            let xVal = ".concat(f.get("batch","xHeight","xWidth","input_channel"),";\n            let wVal = ").concat(p.get("wHeight","wWidth","wInChannel","output_channel"),";\n            value += xVal * wVal;\n          }\n        }\n      }\n      "):"\n      for (var wInChannel: u32 = 0u; wInChannel < uniforms.w_shape[1]; wInChannel++) {\n        let input_channel = in_channel_offset + wInChannel;\n        for (var wHeight: u32 = 0u; wHeight < uniforms.w_shape[2]; wHeight++) {\n          let xHeight = xRCCorner.x + wHeight * uniforms.dilations[0];\n\n          if (xHeight < 0u || xHeight >= uniforms.x_shape[2]) {\n            continue;\n          }\n\n          for (var wWidth: u32 = 0u; wWidth < uniforms.w_shape[3]; wWidth++) {\n            let xWidth = xRCCorner.y + wWidth * uniforms.dilations[1];\n            if (xWidth < 0u || xWidth >= uniforms.x_shape[3]) {\n              continue;\n            }\n\n            let xVal = ".concat(f.get("batch","input_channel","xHeight","xWidth"),";\n            let wVal = ").concat(p.get("output_channel","wInChannel","wHeight","wWidth"),";\n            value += xVal * wVal;\n          }\n        }\n      }\n      ");return"\n  ".concat(r.registerUniforms(g).declareVariables(...m,l),"\n\n  ").concat(r.mainStart(),"\n    ").concat(r.guardAgainstOutOfBoundsWorkgroupSizes("uniforms.output_size"),"\n\n    let outputIndices = ").concat(l.offsetToIndices("global_idx"),";\n    let batch: u32 = outputIndices[0];\n    let output_channel: u32 = outputIndices[").concat(c?3:1,"];\n    let xRCCorner: vec2<u32> = vec2<u32>(outputIndices[").concat(c?1:2,"], outputIndices[").concat(c?2:3,"]) * uniforms.strides - uniforms.pads;\n    let group_id: u32 = output_channel * ").concat(d," / uniforms.output_channels_per_group;\n    var in_channel_offset = group_id * uniforms.w_shape[").concat(c?2:1,"];\n\n    var value: ").concat(l.type.value," = ").concat(l.type.value,"(0);\n    ").concat(y,"\n    ").concat(a,"\n    ").concat(h,"\n    ").concat(l.setByOffset("global_idx","value"),"\n  }")}}},za=(e,t,n,r)=>{let i=e.length>2,a=mn(n[3]),o=mn(n[2]),s=Rt.size(n)/a/o,c=[e[0].dims[0],e[0].dims[1],e[0].dims[2],e[0].dims[3]/a],l=[e[1].dims[0],e[1].dims[1],e[1].dims[2],e[1].dims[3]/a],u=[n[0],n[1],n[2],n[3]/a],d=[{type:12,data:s},{type:6,data:[t.strides[0],t.strides[1]]},{type:6,data:[t.pads[0],t.pads[1]]}];ca(t,d),d.push(...pn(c,l,u));let h=(o-1)*t.strides[1]+l[1];return{name:"GroupedConv-Vectorize",shaderCache:{hint:"".concat(t.cacheKey,";").concat(a,";").concat(o,";").concat(h,";").concat(l[0],";").concat(l[1]),inputDependencies:i?["rank","rank","type"]:["rank","rank"]},getRunData:()=>({outputs:[{dims:r?r(n):n,dataType:e[0].dataType}],dispatchGroup:{x:Math.ceil(s/64)},programUniforms:d}),getShaderSource:n=>{let r=xn("output",e[0].dataType,u.length,a),s=hn(r.type.tensor),d=sa(t,r.type.value,s),f=_n("x",e[0].dataType,c.length,a),p=_n("w",e[1].dataType,l.length,a),m=[f,p];i&&m.push(_n("b",e[2].dataType,e[2].dims,a));let g=i?"value += b[output_channel];":"",y=[{name:"output_size",type:"u32"},{name:"strides",type:"i32",length:2},{name:"pads",type:"i32",length:2}];return la(t,y),"\n  ".concat(n.registerUniforms(y).declareVariables(...m,r),"\n  ").concat(n.mainStart(),"\n    ").concat(n.guardAgainstOutOfBoundsWorkgroupSizes("uniforms.output_size"),"\n    let width0 = uniforms.output_shape[3];\n    let output_channel = global_idx % width0;\n    var index1 = global_idx / width0;\n    let width1 = uniforms.output_shape[2] / ").concat(o,"u;\n    let col = (index1 % width1) * ").concat(o,"u;\n    index1 = index1 / width1;\n    let row = index1 % uniforms.output_shape[1];\n    let batch = index1 / uniforms.output_shape[1];\n\n    let x_corner = vec2<i32>(i32(row), i32(col)) * uniforms.strides - uniforms.pads;\n\n    var x_vals: array<").concat(f.type.value,", ").concat(h,">;\n    var values: array<").concat(r.type.value,", ").concat(o,">;\n    let input_channel = output_channel;\n    // Use constant instead of uniform can give better performance for w's height/width.\n    for (var w_height: u32 = 0u; w_height < ").concat(l[0],"; w_height++) {\n      let x_height = x_corner.x + i32(w_height);\n      if (x_height >= 0 && u32(x_height) < uniforms.x_shape[1]) {\n        for (var i = 0; i < ").concat(h,"; i++) {\n          let x_width = x_corner.y + i;\n          if (x_width >= 0 && u32(x_width) < uniforms.x_shape[2]) {\n            x_vals[i] = ").concat(f.get("batch","u32(x_height)","u32(x_width)","input_channel"),";\n          } else {\n            x_vals[i] = ").concat(f.type.value,"(0);\n          }\n        }\n        for (var w_width: u32 = 0u; w_width < ").concat(l[1],"; w_width++) {\n          let w_val = ").concat(p.get("w_height","w_width","0","output_channel"),";\n          for (var i = 0u; i < ").concat(o,"u; i++) {\n            values[i] = fma(x_vals[i * u32(uniforms.strides[1]) + w_width], w_val, values[i]);\n          }\n        }\n      }\n    }\n\n    for (var i = 0u; i < ").concat(o,"u; i++) {\n      var value = values[i];\n      ").concat(g,"\n      ").concat(d,"\n      ").concat(r.set("batch","row","col + i","output_channel","value"),";\n    }\n  }")}}}}),Zl=re(()=>{Tl(),Yl(),Jl(),Xl(),$l(),Wl(),Ql(),Dl(),Ma=(e,t,n,r,i,a)=>{let o=e[0],s=e.slice(a?1:2,a?3:4),c=s.length,l=t[0],u=t.slice(2).map((e,t)=>e+(e-1)*(n[t]-1)),d=s.map((e,t)=>e+r[t]+r[t+c]).map((e,t)=>Math.floor((e-u[t]+i[t])/i[t]));return d.splice(0,0,o),d.splice(a?3:1,0,l),d},La=[2,3,1,0],Ua=(e,t)=>{if(!e||2!==e.length&&3!==e.length)throw new Error("Conv requires 2 or 3 inputs");if(e[0].dims.length>5)throw new Error("greater than 5D is not supported");if(e[0].dims.length!==e[1].dims.length)throw new Error("filter does not have same dimension as input");if(e[0].dims["NHWC"===t.format?e[0].dims.length-1:1]!==e[1].dims[1]*t.group)throw new Error("FILTER_IN_CHANNEL should be equal to DATA_CHANNEL");if(3===e.length&&(1!==e[2].dims.length||e[1].dims[0]!==e[2].dims[0]))throw new Error("invalid bias");let n=e[0].dims.length-2;if(t.dilations.length!==n)throw new Error("dilations should be ".concat(n,"D"));if(t.strides.length!==n)throw new Error("strides should be ".concat(n,"D"));if(t.pads.length!==2*n)throw new Error("pads should be ".concat(2*n,"D"));if(0!==t.kernelShape.length&&t.kernelShape.length!==e[1].dims.length-2)throw new Error("invalid kernel shape")},Ba=(e,t)=>{let n=e.kernelShape.slice();n.length<t[1].dims.length-2&&n.push(...Array(t[1].dims.length-2-n.length).fill(0));for(let a=2;a<t[1].dims.length;++a)0===n[a-2]&&(n[a-2]=t[1].dims[a]);let r=e.pads.slice();Pt.adjustPadsBasedOnAutoPad(t[0].dims,e.strides,e.dilations,n,r,"NHWC"===e.format,e.autoPad);let i=Object.assign({},e);return Object.assign(i,{kernelShape:n,pads:r}),i},Fa=e=>{let t=ua(e),n=e.format;return l(l({autoPad:["NOTSET","VALID","SAME_UPPER","SAME_LOWER"][e.auto_pad],format:n,dilations:e.dilations,group:e.group,kernelShape:e.kernel_shape,pads:e.pads,strides:e.strides,wIsConst:e.w_is_const()},t),{},{cacheKey:"".concat(e.format,";").concat(t.activation,";")})},ja=(e,t,n,r)=>{var i;let a="NHWC"===n.format,o=Ma(t[0].dims,t[1].dims,n.dilations,n.pads,n.strides,a);if(1!==n.group){let i=[t[0]];if(a){var s;let r=null!==(s=e.kernelCustomData.wT)&&void 0!==s?s:e.compute(Pn(t[1],La),{inputs:[1],outputs:[n.wIsConst?-2:-1]})[0];n.wIsConst&&!e.kernelCustomData.wT&&(e.kernelCustomData.wT=r),i.push(r)}else i.push(t[1]);return 3===t.length&&i.push(t[2]),void(!e.adapterInfo.isArchitecture("ampere")&&a&&t[1].dims[0]===n.group&&1===t[1].dims[1]&&1===n.dilations[0]&&1===n.dilations[1]?e.compute(za(i,n,o,r),{inputs:i}):e.compute(Da(i,n,o,r),{inputs:i}))}let c=3===t.length,l=t[0].dims[a?1:2],u=t[0].dims[a?2:3],d=t[0].dims[a?3:1],h=t[1].dims[2],f=t[1].dims[3],p=o[a?1:2],m=o[a?2:3],g=o[a?3:1],y=a&&h===l&&f===u&&0===n.pads[0]&&0===n.pads[1];if(y||1===h&&1===f&&1===n.dilations[0]&&1===n.dilations[1]&&1===n.strides[0]&&1===n.strides[1]&&0===n.pads[0]&&0===n.pads[1]){let i,s,h,f=o[0],w=[];if(a){var v;let r=null!==(v=e.kernelCustomData.wT)&&void 0!==v?v:e.compute(Pn(t[1],La),{inputs:[1],outputs:[n.wIsConst?-2:-1]})[0];if(n.wIsConst&&!e.kernelCustomData.wT&&(e.kernelCustomData.wT=r),y){let e=l*u*d;i=t[0].reshape([1,f,e]),s=r.reshape([1,e,g]),h=[1,f,g]}else i=t[0].reshape([f,l*u,d]),s=r.reshape([1,d,g]),h=[f,p*m,g];w.push(i),w.push(s)}else i=t[0].reshape([f,d,l*u]),s=t[1].reshape([1,g,d]),h=[f,g,p*m],w.push(s),w.push(i);c&&w.push(t[2]);let b=h[2],_=w[0].dims[w[0].dims.length-1];return void(b<8&&_<8?e.compute(ma(w,n,o,h,a,r),{inputs:w}):e.compute(Ea(w,n,o,h,a,r),{inputs:w}))}let w=null!==(i=e.kernelCustomData.wT)&&void 0!==i?i:e.compute(Pn(t[1],La),{inputs:[1],outputs:[n.wIsConst?-2:-1]})[0];n.wIsConst&&!e.kernelCustomData.wT&&(e.kernelCustomData.wT=w);let b=[t[0],w];c&&b.push(t[2]);let _=a?p*m:g,x=a?g:p*m,E=h*f*d;e.compute(ka(b,n,o,_,x,E,c,!0,r),{inputs:b})},Va=(e,t)=>{let n="NHWC"===t.format,r=[e.inputs[0].reshape(n?[e.inputs[0].dims[0],1,e.inputs[0].dims[1],e.inputs[0].dims[2]]:[e.inputs[0].dims[0],e.inputs[0].dims[1],1,e.inputs[0].dims[2]]),e.inputs[1].reshape([e.inputs[1].dims[0],e.inputs[1].dims[1],1,e.inputs[1].dims[2]])];3===e.inputs.length&&r.push(e.inputs[2]);let i=[0,t.pads[0],0,t.pads[1]],a=[1].concat(t.strides),o=[1].concat(t.dilations),s=[1].concat(t.kernelShape),c=Ba(l(l({},t),{},{pads:i,strides:a,dilations:o,kernelShape:s}),r);ja(e,r,c,e=>n?[e[0],e[2],e[3]]:[e[0],e[1],e[3]])},qa=(e,t,n)=>{let r="NHWC"===n.format?"channelsLast":"channelsFirst",i=Ba(n,t),a="NOTSET"===n.autoPad?n.pads:n.autoPad,o=Ra(t[0].dims,t[1].dims,n.strides,n.dilations,a,!1,r);e.compute(Pa(t,i,o.outShape,[o.filterDepth,o.filterHeight,o.filterWidth],[o.padInfo.front,o.padInfo.top,o.padInfo.left],r))},Ha=(e,t)=>{if(Ua(e.inputs,t),3===e.inputs[0].dims.length)Va(e,t);else if(5===e.inputs[0].dims.length)qa(e,e.inputs,t);else{let n=Ba(t,e.inputs);ja(e,e.inputs,n)}}}),eu=re(()=>{El(),kl(),Tl(),Pl(),Wa=(e,t,n)=>{let r=e.length>2,i=t.outputShape,a="NHWC"===t.format,o=t.group,s=e[1].dims,c=s[2]/o,l=s[3],u=a?mn(c):1,d=a&&1===l&&c>=4,h=d?4*Math.floor(c/4):Math.floor(c/u)*u,f=c-h,p=a?mn(l):1,m=a?1===l?u:p:1,g=Rt.size(i)/p,y=[Math.ceil(g/64),1,1];At("verbose",()=>"[conv2d_backprop_webgpu] dispatch = ".concat(y));let v=["rank","rank"],w=[t.strides[0],t.strides[1]],b=[t.kernelShape[a?1:2],t.kernelShape[a?2:3]],_=[t.dilations[0],t.dilations[1]],x=[b[0]+(t.dilations[0]<=1?0:(t.kernelShape[a?1:2]-1)*(t.dilations[0]-1)),b[1]+(t.dilations[1]<=1?0:(t.kernelShape[a?2:3]-1)*(t.dilations[1]-1))],E=[x[0]-1-Math.floor((t.pads[0]+t.pads[2])/2),x[1]-1-Math.floor((t.pads[1]+t.pads[3])/2)],S=[{type:12,data:g},{type:12,data:w},{type:12,data:b},{type:12,data:_},{type:12,data:x},{type:6,data:E},{type:12,data:h},{type:12,data:c},{type:12,data:l},...pn(e[0].dims,e[1].dims)];r&&(S.push(...pn(e[2].dims)),v.push("rank")),S.push(...pn(i));return{name:"ConvTranspose2D",shaderCache:{hint:"".concat(t.cacheKey,";").concat(u).concat(m).concat(p).concat(d).concat(f),inputDependencies:v},getRunData:()=>({dispatchGroup:{x:y[0],y:y[1],z:y[2]},outputs:[{dims:n?n(i):i,dataType:e[0].dataType}],programUniforms:S}),getShaderSource:t=>{let n=[{name:"output_size",type:"u32"},{name:"strides",type:"u32",length:w.length},{name:"filter_dims",type:"u32",length:b.length},{name:"dilations",type:"u32",length:b.length},{name:"effective_filter_dims",type:"u32",length:x.length},{name:"pads",type:"i32",length:E.length},{name:"input_channels_per_group_int",type:"u32"},{name:"input_channels_per_group",type:"u32"},{name:"output_channels_per_group",type:"u32"}],o=hn(e[0].dataType),s=a?1:2,c=a?2:3,l=a?3:1,h=_n("W",e[1].dataType,e[1].dims.length,m),g=_n("Dy",e[0].dataType,e[0].dims.length,u),y=[g,h];r&&y.push(_n("bias",e[2].dataType,[i[l]].length,p));let v=xn("result",e[0].dataType,i.length,p),_="\n            let outputIndices = ".concat(v.offsetToIndices("global_idx * ".concat(p)),";\n            let batch = ").concat(v.indicesGet("outputIndices",0),";\n            let d1 = ").concat(v.indicesGet("outputIndices",l),";\n            let r = ").concat(v.indicesGet("outputIndices",s),";\n            let c = ").concat(v.indicesGet("outputIndices",c),";\n            let dyCorner = vec2<i32>(i32(r), i32(c)) - uniforms.pads;\n            let dyRCorner = dyCorner.x;\n            let dyCCorner = dyCorner.y;\n            let groupId = d1 / uniforms.output_channels_per_group;\n            let wOutChannel = d1 - groupId * uniforms.output_channels_per_group;\n            // Convolve dy(?, ?, d2) with w(:, :, d1, d2) to compute dx(xR, xC, d1).\n            // ? = to be determined. : = across all values in that axis.\n            var dotProd = ").concat(v.type.value,"(0.0);\n            var wR: u32 = 0;\n            if (uniforms.dilations.x == 1) {\n              // Minimum wR >= 0 that satisfies (dyRCorner + wR) % (uniforms.strides.x) == 0\n              wR = u32(((dyRCorner + i32(uniforms.strides.x) - 1) / i32(uniforms.strides.x)) * i32(uniforms.strides.x) - dyRCorner);\n            }\n            for (; wR < uniforms.effective_filter_dims.x; wR = wR + 1) {\n              if (wR % uniforms.dilations.x != 0) {\n                continue;\n              }\n              let dyR = (").concat(o,"(dyRCorner) + ").concat(o,"(wR)) / ").concat(o,"(uniforms.strides[0]);\n              let wRPerm = uniforms.filter_dims.x - 1 - wR / uniforms.dilations.x;\n              if (dyR < 0.0 || dyR >= ").concat(o,"(uniforms.Dy_shape[").concat(s,"]) || fract(dyR) > 0.0 ||\n                  wRPerm < 0) {\n                continue;\n              }\n              let idyR: u32 = u32(dyR);\n              var wC: u32 = 0;\n              if (uniforms.dilations.y == 1) {\n                // Minimum wC >= 0 that satisfies (dyCCorner + wC) % (uniforms.strides.y) == 0\n                wC = u32(((dyCCorner + i32(uniforms.strides.y) - 1) / i32(uniforms.strides.y)) * i32(uniforms.strides.y) - dyCCorner);\n              }\n              for (; wC < uniforms.effective_filter_dims.y; wC = wC + 1) {\n                if (wC % uniforms.dilations.y != 0) {\n                  continue;\n                }\n                let dyC = (").concat(o,"(dyCCorner) + ").concat(o,"(wC)) / ").concat(o,"(uniforms.strides.y);\n                let wCPerm = uniforms.filter_dims.y - 1 - wC / uniforms.dilations.y;\n                if (dyC < 0.0 || dyC >= ").concat(o,"(uniforms.Dy_shape[").concat(c,"]) ||\n                    fract(dyC) > 0.0 || wCPerm < 0) {\n                  continue;\n                }\n                let idyC: u32 = u32(dyC);\n                var inputChannel = groupId * uniforms.input_channels_per_group;\n                ").concat(d?"\n                var x_offset = ".concat(g.indicesToOffset("".concat(g.type.indices,"(batch, idyR, idyC, inputChannel)"))," / ").concat(u,";\n                var w_offset = ").concat(h.indicesToOffset("".concat(h.type.indices,"(wRPerm, wCPerm, inputChannel, wOutChannel)"))," / ").concat(m,";\n                  "):"","\n                for (var d2: u32 = 0; d2 < uniforms.input_channels_per_group_int; d2 = d2 + ").concat(d?4:u,") {\n                  ").concat((()=>{let e="";if(d)4===u?e+="\n        let xValue = ".concat(g.getByOffset("x_offset"),";\n        let wValue = ").concat(h.getByOffset("w_offset"),";\n        dotProd = dotProd + dot(xValue, wValue);\n        x_offset += 1u;\n        w_offset += 1u;"):2===u?e+="\n          dotProd = dotProd + dot(vec4<".concat(o,">(").concat(g.getByOffset("x_offset"),", ").concat(g.getByOffset("x_offset + 1u"),"), vec4<").concat(o,">(").concat(h.getByOffset("w_offset"),", ").concat(h.getByOffset("w_offset + 1u"),"));\n          x_offset += 2u;\n          w_offset += 2u;"):1===u&&(e+="\n          dotProd = dotProd + dot(vec4<".concat(o,">(").concat(g.getByOffset("x_offset"),", ").concat(g.getByOffset("x_offset + 1u"),", ").concat(g.getByOffset("x_offset + 2u"),", ").concat(g.getByOffset("x_offset + 3u"),"), vec4<").concat(o,">(").concat(h.getByOffset("w_offset"),", ").concat(h.getByOffset("w_offset + 1u"),", ").concat(h.getByOffset("w_offset + 2u"),", ").concat(h.getByOffset("w_offset + 3u"),"));\n          x_offset += 4u;\n          w_offset += 4u;"));else if(e+="\n                  let xValue = ".concat(a?g.getByOffset("".concat(g.indicesToOffset("".concat(g.type.indices,"(batch, idyR, idyC, inputChannel)"))," / ").concat(u)):g.get("batch","inputChannel","idyR","idyC"),";\n        "),1===u)e+="\n          let w_offset = ".concat(h.indicesToOffset("".concat(h.type.indices,"(u32(wRPerm), u32(wCPerm), inputChannel, wOutChannel)")),";\n          let wValue = ").concat(h.getByOffset("w_offset / ".concat(m)),";\n          dotProd = dotProd + xValue * wValue;");else for(let t=0;t<u;t++)e+="\n            let wValue".concat(t," = ").concat(h.getByOffset("".concat(h.indicesToOffset("".concat(h.type.indices,"(u32(wRPerm), u32(wCPerm), inputChannel + ").concat(t,", wOutChannel)"))," / ").concat(m)),";\n            dotProd = dotProd + xValue[").concat(t,"] * wValue").concat(t,";");return e})(),"\n                  inputChannel = inputChannel + ").concat(d?4:u,";\n                }\n                ").concat((()=>{if(0===f)return"";if(!d)throw new Error("packInputAs4 ".concat(d," is not true."));let e="";if(1===u){e+="dotProd = dotProd";for(let t=0;t<f;t++)e+="\n            + ".concat(g.getByOffset("x_offset + ".concat(t))," * ").concat(h.getByOffset("w_offset + ".concat(t)));e+=";"}else if(2===u){if(2!==f)throw new Error("Invalid inputChannelsRemainder ".concat(f,"."));e+="\n          let xValue = ".concat(g.getByOffset("x_offset"),";\n          let wValue = ").concat(h.getByOffset("w_offset"),";\n          dotProd = dotProd + dot(xValue, wValue);")}return e})(),"\n                wC = wC + uniforms.strides.y - 1;\n              }\n              wR = wR + uniforms.strides[0] - 1;\n            }\n            let value = dotProd").concat(r?" + bias[d1 / ".concat(p,"]"):"",";\n            ").concat(v.setByOffset("global_idx","value"),";\n          ");return"\n    ".concat(t.registerUniforms(n).declareVariables(...y,v),"\n      ").concat(t.mainStart(),"\n      ").concat(t.guardAgainstOutOfBoundsWorkgroupSizes("uniforms.output_size"),";\n    ").concat(_,"}")}}}}),tu=re(()=>{eu(),Wl(),Dl(),Ga=(e,t,n,r,i,a)=>(e-1)*t+n+(r-1)*i+1-a,Ka=(e,t,n,r,i)=>{let a=Math.floor(e/2);"SAME_UPPER"===t?(n[r]=a,n[i]=e-a):"SAME_LOWER"===t&&(n[r]=e-a,n[i]=a)},Qa=(e,t,n,r,i,a,o,s,c,l)=>{let u=e.length-2,d=0===l.length;c.length<u&&c.push(...Array(u-c.length).fill(0));let h=e[0],f=t[s?3:1]*i;for(let p=0,m=e.length-u-(s?1:0);p<u;++p,++m){let i=e[m],s=d?i*o[p]:l[p],h=Ga(i,o[p],a[p],t[m],n[p],s);Ka(h,r,a,p,p+u),d&&l.push(o[p]*(i-1)+c[p]+(t[m]-1)*n[p]+1-a[p]-a[p+u])}l.splice(0,0,h),l.splice(s?3:1,0,f)},Xa=(e,t)=>{let n=e.kernelShape.slice();if(0===e.kernelShape.length||0===e.kernelShape.reduce((e,t)=>e*t,1)){n.length=0;for(let e=2;e<t[1].dims.length;++e)n.push(t[1].dims[e])}let r="NHWC"===e.format;n.splice(0,0,t[1].dims[0]),n.splice(r?3:1,0,t[1].dims[1]);let i=e.pads.slice(),a=e.outputShape.slice(),o=e.outputPadding.slice(),s=t[0].dims,c=e.dilations.slice();if(0===c.reduce((e,t)=>e+t,0)){let e=t[0].dims.length-2;c=new Array(e).fill(1)}let l=e.strides.slice();if(0===l.reduce((e,t)=>e+t,0)){let e=t[0].dims.length-2;l=new Array(e).fill(1)}Qa(s,n,c,e.autoPad,e.group,i,l,r,o,a);let u=Object.assign({},e);return Object.assign(u,{kernelShape:n,pads:i,outputPadding:o,outputShape:a,dilations:c,strides:l}),u},Ya=e=>{let t=ua(e),n=e.format,r=["NOTSET","VALID","SAME_UPPER","SAME_LOWER"][typeof e.autoPad>"u"?0:e.autoPad],i=e.dilations,a=e.group,o=e.kernelShape,s=e.pads,c=e.strides,u=e.wIsConst();return l(l({autoPad:r,format:n,dilations:i,group:a,kernelShape:o,outputPadding:e.outputPadding,outputShape:e.outputShape,pads:s,strides:c,wIsConst:u},t),{},{cacheKey:"".concat(e.format,";").concat(t.activation,";")})},Ja=(e,t)=>{if(!e||2!==e.length&&3!==e.length)throw new Error("Conv requires 2 or 3 inputs");if(4!==e[0].dims.length&&3!==e[0].dims.length)throw new Error("currently only support 2-dimensional conv");if(e[0].dims.length!==e[1].dims.length)throw new Error("filter does not have same dimension as input");if(e[0].dims["NHWC"===t.format?e[0].dims.length-1:1]!==e[1].dims[0])throw new Error("FILTER_IN_CHANNEL should be equal to DATA_CHANNEL");let n=e[1].dims[1]*t.group;if(3===e.length&&(1!==e[2].dims.length||e[2].dims[0]!==n))throw new Error("invalid bias");let r=e[0].dims.length-2;if(t.dilations.reduce((e,t)=>e+t,0)>0&&t.dilations.length!==r)throw new Error("dilations should be ".concat(r,"D"));if(t.strides.reduce((e,t)=>e+t,0)>0&&t.strides.length!==r)throw new Error("strides should be ".concat(r,"D"));if(t.pads.reduce((e,t)=>e+t,0)>0&&t.pads.length!==2*r)throw new Error("pads should be ".concat(2*r,"D"));if(t.outputPadding.length!==r&&0!==t.outputPadding.length)throw new Error("output_padding should be ".concat(r,"D"));if(t.kernelShape.reduce((e,t)=>e+t,0)>0&&0!==t.kernelShape.length&&t.kernelShape.length!==e[1].dims.length-2)throw new Error("invalid kernel shape");if(0!==t.outputShape.length&&t.outputShape.length!==e[0].dims.length-2)throw new Error("invalid output shape")},$a=(e,t,n,r)=>{var i;let a=null!==(i=e.kernelCustomData.wT)&&void 0!==i?i:e.compute(Pn(t[1],[2,3,0,1]),{inputs:[1],outputs:[n.wIsConst?-2:-1]})[0];n.wIsConst&&!e.kernelCustomData.wT&&(e.kernelCustomData.wT=a);let o=[t[0],a];3===t.length&&o.push(t[2]),e.compute(Wa(o,n,r),{inputs:o})},Za=(e,t)=>{let n="NHWC"===t.format,r=[e.inputs[0].reshape(n?[e.inputs[0].dims[0],1,e.inputs[0].dims[1],e.inputs[0].dims[2]]:[e.inputs[0].dims[0],e.inputs[0].dims[1],1,e.inputs[0].dims[2]]),e.inputs[1].reshape([e.inputs[1].dims[0],e.inputs[1].dims[1],1,e.inputs[1].dims[2]])];3===e.inputs.length&&r.push(e.inputs[2]);let i=t.kernelShape;(0===i.length||0===i[0])&&(i=[e.inputs[1].dims[2]]);let a=t.dilations;(0===a.length||0===a[0])&&(a=[1]);let o=t.strides;(0===o.length||0===o[0])&&(o=[1]);let s=t.pads;0===s.length&&(s=[0,0]),s=[0,s[0],0,s[1]],o=[1].concat(o),a=[1].concat(a),i=[1].concat(i);let c=t.outputPadding;c=[0].concat(c);let u=Xa(l(l({},t),{},{pads:s,strides:o,dilations:a,kernelShape:i,outputPadding:c}),r);$a(e,r,u,e=>n?[e[0],e[2],e[3]]:[e[0],e[1],e[3]])},eo=(e,t)=>{if(Ja(e.inputs,t),3===e.inputs[0].dims.length)Za(e,t);else{let n=Xa(t,e.inputs);$a(e,e.inputs,n)}}}),nu=re(()=>{El(),Tl(),Rl(),Pl(),to=(e,t,n,r)=>{let i=Rt.size(t),a=t.length,o=_n("input",e,a),s=xn("output",e,a),c=6===n.dataType?n.getInt32Array()[0]:Number(n.getBigInt64Array()[0]),l=Rt.normalizeAxis(c,a);return{name:"CumSum",shaderCache:{hint:r.cacheKey,inputDependencies:["rank"]},getRunData:()=>({outputs:[{dims:t,dataType:e}],dispatchGroup:{x:Math.ceil(i/64)},programUniforms:[{type:12,data:i},{type:12,data:l},...pn(t,t)]}),getShaderSource:e=>{let t=" i32(".concat(o.indicesGet("inputIndices","uniforms.axis"),") "),n=wn("uniforms.input_shape","uniforms.axis",a),i=r.reverse?t+(r.exclusive?" + 1":""):"0",c=r.reverse?n:t+(r.exclusive?"":" + 1");return"\n                ".concat(e.registerUniform("outputSize","u32").registerUniform("axis","u32").declareVariables(o,s),"\n                ").concat(e.mainStart(),"\n                  ").concat(e.guardAgainstOutOfBoundsWorkgroupSizes("uniforms.outputSize"),"\n                  var inputIndices = ").concat(s.offsetToIndices("global_idx"),";\n                  var sum = ").concat(s.type.value,"(0);\n                  let first : i32 = ").concat(i,";\n                  let last : i32 = ").concat(c,";\n                  for (var i : i32 = first; i < last; i++) {\n                    ").concat(o.indicesSet("inputIndices","uniforms.axis","u32(i)"),";\n                    sum = sum + ").concat(o.getByIndices("inputIndices"),";\n                  }\n                  ").concat(s.setByOffset("global_idx","sum"),";\n                }")}}},no=(e,t)=>{let n=e.inputs[0].dims,r=e.inputs[0].dataType,i=e.inputs[1];e.compute(to(r,n,i,t),{inputs:[0]})},ro=e=>{let t=1===e.exclusive,n=1===e.reverse;return ln({exclusive:t,reverse:n})}}),ru=re(()=>{El(),Tl(),Rl(),Pl(),io=e=>{if(!e||1!==e.length)throw new Error("DepthToSpace requires 1 input.");if(4!==e[0].dims.length)throw new Error("DepthToSpace requires 4D input.")},ao=(e,t,n,r)=>{let i=[];i.push("fn perm(i: ".concat(r.type.indices,") -> ").concat(n.type.indices," {\n    var a: ").concat(n.type.indices,";"));for(let a=0;a<t;++a)i.push(n.indicesSet("a",e[a],"i[".concat(a,"]")));return i.push("return a;}"),i.join("\n")},oo=(e,t)=>{let n,r,i,a,o,s,c="NHWC"===t.format,l=t.blocksize,u="DCR"===t.mode;c?([n,r,i,a]=e.dims,o=u?[n,r,i,l,l,a/l**2]:[n,r,i,a/l**2,l,l],s=u?[0,1,3,2,4,5]:[0,1,4,2,5,3]):([n,r,i,a]=[e.dims[0],e.dims[2],e.dims[3],e.dims[1]],o=u?[n,l,l,a/l**2,r,i]:[n,a/l**2,l,l,r,i],s=u?[0,3,4,1,5,2]:[0,1,4,2,5,3]);let d=e.reshape(o),h=d.dims.length,f=e.dataType,p=_n("a",f,h),m=xn("output",f,h);return{name:"DepthToSpace",shaderCache:{hint:"".concat(e.dims,";").concat(t.blocksize,";").concat(t.mode),inputDependencies:["rank"]},getRunData:e=>{let t=c?[n,r*l,i*l,a/l**2]:[n,a/l**2,r*l,i*l],o=Rt.size(t),u=d.dims,h=Rt.sortBasedOnPerm(u,s);return{outputs:[{dims:t,dataType:e[0].dataType}],dispatchGroup:{x:Math.ceil(o/64)},programUniforms:[{type:12,data:o},...pn(u,h)]}},getShaderSource:e=>"\n  ".concat(e.registerUniform("output_size","u32").declareVariables(p,m),"\n\n  ").concat(ao(s,h,p,m),"\n\n  ").concat(e.mainStart(),"\n    ").concat(e.guardAgainstOutOfBoundsWorkgroupSizes("uniforms.output_size"),"\n\n    let indices = ").concat(m.offsetToIndices("global_idx"),";\n    let aIndices = perm(indices);\n\n    ").concat(m.setByOffset("global_idx",p.getByIndices("aIndices")),"\n  }")}},so=(e,t)=>{io(e.inputs),e.compute(oo(e.inputs[0],t))},co=e=>ln({blocksize:e.blocksize,mode:e.mode,format:e.format})}),iu=re(()=>{El(),Tl(),Rl(),Pl(),ho="^"+(uo="("+(lo="[a-zA-Z]|\\.\\.\\.")+")+")+"$",fo="^"+("("+uo+",)*"+uo)+"$",po=class{constructor(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:-1;this.symbolToIndices=new Map,this.inputIndex=e}addSymbol(e,t){let n=this.symbolToIndices.get(e);void 0===n?n=[t]:n.push(t),this.symbolToIndices.set(e,n)}},mo=class{constructor(e,t){var n;this.equation=t,this.hasEllipsis=!1,this.symbolToInfo=new Map,this.lhs=new Array,this.outputDims=[];let[r,i]=t.includes("->")?t.split("->",2):[t,""];if(!r.match(RegExp(fo)))throw new Error("Invalid LHS term");if(r.split(",").forEach((t,n)=>{let r=e[n].dims.slice();if(!t.match(RegExp(ho)))throw new Error("Invalid LHS term");let i=this.processTerm(t,!0,r,n);this.lhs.push(i)}),""===i)i+=[...this.symbolToInfo.entries()].filter(e=>{let[t,n]=e;return 1===n.count||"..."===t}).map(e=>{let[t]=e;return t}).join("");else if(!i.match(RegExp(uo)))throw new Error("Invalid RHS");null!==(n=i.match(RegExp(lo,"g")))&&void 0!==n&&n.forEach(e=>{if("..."===e)this.outputDims=this.outputDims.concat(this.ellipsisDims);else{let t=this.symbolToInfo.get(e);if(void 0===t)throw new Error("Invalid RHS symbol");this.outputDims.push(t.dimValue)}}),this.rhs=this.processTerm(i,!1,this.outputDims)}addSymbol(e,t,n){let r=this.symbolToInfo.get(e);if(void 0!==r){if(r.dimValue!==t&&1!==r.count)throw new Error("Dimension mismatch");r.count++,r.inputIndices.push(n)}else r={count:1,dimValue:t,inputIndices:[n]};this.symbolToInfo.set(e,r)}processTerm(e,t,n){let r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:-1,i=n.length,a=!1,o=[],s=0;if(!e.match(RegExp(ho))&&!t&&""!==e)throw new Error("Invalid LHS term");let c=e.match(RegExp(lo,"g")),l=new po(r);return null!==c&&void 0!==c&&c.forEach((e,u)=>{if("..."===e){if(a)throw new Error("Only one ellipsis is allowed per input term");a=!0;let e=i-c.length+1;if(e<0)throw new Error("Ellipsis out of bounds");if(o=n.slice(s,s+e),this.hasEllipsis){if(this.ellipsisDims.length!==o.length||this.ellipsisDims.toString()!==o.toString())throw new Error("Ellipsis dimensions mismatch")}else{if(!t)throw new Error("Ellipsis must be specified in the LHS");this.hasEllipsis=!0,this.ellipsisDims=o}for(let t=0;t<o.length;t++){let e=String.fromCharCode(48+t);l.addSymbol(e,u+t),this.addSymbol(e,n[s++],r)}}else l.addSymbol(e,u+(this.hasEllipsis?this.ellipsisDims.length-1:0)),this.addSymbol(e,n[s++],r)}),l}},go=e=>e+"_max",yo=(e,t,n,r)=>{let i=e.map(e=>e.length).map((e,n)=>_n("input".concat(n),t,e)),a=Rt.size(r),o=xn("output",t,r.length),s=[...n.symbolToInfo.keys()].filter(e=>!n.rhs.symbolToIndices.has(e));return{name:"Einsum",shaderCache:{hint:n.equation,inputDependencies:e.map(()=>"rank")},getRunData:()=>{let i=s.filter(e=>n.symbolToInfo.has(e)).map(e=>{var t;return{type:12,data:(null===(t=n.symbolToInfo.get(e))||void 0===t?void 0:t.dimValue)||0}});i.push({type:12,data:a});let o=e.map((e,t)=>[...pn(e)]).reduce((e,t)=>e.concat(t),i);return o.push(...pn(r)),{outputs:[{dims:r,dataType:t}],dispatchGroup:{x:Math.ceil(a/64)},programUniforms:o}},getShaderSource:e=>{let t=[],r=[],a=[],c=[],l=[],u=n.symbolToInfo.size===n.rhs.symbolToIndices.size;n.symbolToInfo.forEach((e,s)=>{if(n.rhs.symbolToIndices.has(s)){var u;let r=null===(u=n.rhs.symbolToIndices.get(s))||void 0===u?void 0:u[0];void 0!==r&&n.lhs.forEach((n,a)=>{if(e.inputIndices.includes(a)){let e=n.symbolToIndices.get(s);if(void 0===e)throw new Error("Invalid symbol error");e.forEach(e=>{t.push("".concat(i[a].indicesSet("input".concat(a,"Indices"),e,o.indicesGet("outputIndices",r))))})}})}else n.lhs.forEach((t,n)=>{if(e.inputIndices.includes(n)){let e=t.symbolToIndices.get(s);if(void 0===e)throw new Error("Invalid symbol error");e.forEach(e=>{r.push("".concat(i[n].indicesSet("input".concat(n,"Indices"),e,"".concat(s))))}),l.push("prod *= ".concat(i[n].getByIndices("input".concat(n,"Indices")),";"))}}),a.push("for(var ".concat(s,": u32 = 0; ").concat(s," < uniforms.").concat(go(s),"; ").concat(s,"++) {")),c.push("}")});let d=u?[...t,"let sum = ".concat(i.map((e,t)=>e.getByIndices("input".concat(t,"Indices"))).join(" * "),";")]:[...t,"var sum = 0.0;",...a,...r,"var prod = 1.0;",...l,"sum += prod;",...c];return"\n            ".concat(e.registerUniforms(s.map(e=>({name:"".concat(go(e)),type:"u32"}))).registerUniform("outputSize","u32").declareVariables(...i,o),"\n\n            ").concat(e.mainStart(),"\n            ").concat(e.guardAgainstOutOfBoundsWorkgroupSizes("uniforms.outputSize"),"\n            var outputIndices = ").concat(o.offsetToIndices("global_idx"),";\n            ").concat(i.map((e,t)=>"var input".concat(t,"Indices: ").concat(i[t].type.indices,";")).join("\n"),"\n            ").concat(d.join("\n"),";\n            ").concat(o.setByOffset("global_idx","sum"),";\n          }")}}},vo=(e,t)=>{let n=new mo(e.inputs,t.equation),r=n.outputDims,i=e.inputs.map((e,t)=>e.dims);e.compute(yo(i,e.inputs[0].dataType,n,r))},wo=e=>{let t=e.equation.replace(/\s+/g,"");return ln({equation:t})}}),au=re(()=>{El(),Tl(),Pl(),bo=e=>{if(!e||2!==e.length)throw new Error("Expand requires 2 input.");let t=e[0].dims,n=Array.from(e[1].getBigInt64Array(),Number),r=n.length<t.length?0:n.length-t.length,i=t.length<n.length?0:t.length-n.length;for(;r<n.length&&i<t.length;++r,++i)if(n[r]!==t[i]&&1!==n[r]&&1!==t[i])throw new Error("Expand requires shape to be broadcastable to input")},_o=(e,t)=>{let n=e.length-t.length,r=[];for(let i=0;i<n;++i)r.push(e[i]);for(let i=0;i<t.length;++i)r.push(1===t[i]?e[i+n]:t[i]);return r},xo=(e,t)=>e.length>t.length?_o(e,t):_o(t,e),Eo=e=>{let t=e[0].dims,n=Array.from(e[1].getBigInt64Array(),Number),r=xo(t,n),i=e[0].dataType,a=9===i||1===Rt.size(t),o=9===i||t.length>0&&t[t.length-1]%4===0?4:1,s=a||r.length>0&&r[r.length-1]%4===0?4:1,c=Math.ceil(Rt.size(r)/s),l=[{type:12,data:c},...pn(t,r)];return{name:"Expand",shaderCache:{hint:"".concat(r.length,";").concat(o).concat(s),inputDependencies:["rank"]},getShaderSource:e=>{let n,a=_n("input",i,t.length,o),c=xn("output",i,r.length,s);if(9===i){let e=function(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"";return"\n          let outputIndices".concat(t," = ").concat(c.offsetToIndices("outputOffset + ".concat(t,"u")),";\n          let offset").concat(t," = ").concat(a.broadcastedIndicesToOffset("outputIndices".concat(t),c),";\n          let index").concat(t," = offset").concat(t," / 4u;\n          let component").concat(t," = offset").concat(t," % 4u;\n          ").concat(e,"[").concat(t,"] = ").concat(n,"(").concat(a.getByOffset("index".concat(t)),"[component").concat(t,"]);\n        ")};n="\n        let outputOffset = global_idx * ".concat(s,";\n        var data = vec4<u32>(0);\n        ").concat(e("data",0,"u32"),"\n        ").concat(e("data",1,"u32"),"\n        ").concat(e("data",2,"u32"),"\n        ").concat(e("data",3,"u32"),"\n        ").concat(c.setByOffset("global_idx","data"),"\n      }")}else n="\n        let outputIndices = ".concat(c.offsetToIndices("global_idx * ".concat(s)),";\n        let inputOffset = ").concat(a.broadcastedIndicesToOffset("outputIndices",c),";\n        let data = ").concat(c.type.value,"(").concat(a.getByOffset("inputOffset / ".concat(o)),");\n        ").concat(c.setByOffset("global_idx","data"),"\n      }");return"\n    ".concat(e.registerUniform("vec_size","u32").declareVariables(a,c),"\n    ").concat(e.mainStart(),"\n    ").concat(e.guardAgainstOutOfBoundsWorkgroupSizes("uniforms.vec_size"),"\n    ").concat(n)},getRunData:()=>({outputs:[{dims:r,dataType:e[0].dataType}],dispatchGroup:{x:Math.ceil(c/64)},programUniforms:l})}},So=e=>{bo(e.inputs),e.compute(Eo(e.inputs),{inputs:[0]})}}),ou=re(()=>{El(),Tl(),Pl(),jl(),ko=e=>{let t=e[0].dataType,n=Rt.size(e[0].dims),r=Rt.size(e[1].dims),i=r%4===0;return{name:"FastGeluWithBias",shaderCache:{hint:"".concat(i),inputDependencies:["type","type"]},getShaderSource:e=>{let n=_n("x",t,[1],4),r=_n("bias",t,[1],4),a=xn("y",t,[1],4),o=e=>"\n      let bias".concat(e,"_offset: u32 = (global_idx * 4 + ").concat(e,") % uniforms.bias_size;\n      let bias").concat(e," = ").concat(r.getByOffset("bias".concat(e,"_offset / 4")),"[bias").concat(e,"_offset % 4];"),s=i?"\n      let bias = ".concat(r.getByOffset("global_idx % (uniforms.bias_size / 4)"),";"):"".concat(o(0)).concat(o(1)).concat(o(2)).concat(o(3),"\n      let bias = ").concat(n.type.value,"(bias0, bias1, bias2, bias3);");return"".concat(e.registerUniforms([{name:"output_vec_size",type:"u32"},{name:"bias_size",type:"u32"}]).declareVariables(n,r,a),"\n\n    ").concat(Ni(fn(t)),"\n\n    ").concat(e.mainStart(un),"\n      ").concat(e.guardAgainstOutOfBoundsWorkgroupSizes("uniforms.output_vec_size"),"\n\n      let x = ").concat(n.getByOffset("global_idx"),";\n      ").concat(s,"\n      let x_in = x + bias;\n      ").concat(a.setByOffset("global_idx",Ri("x_in")),"\n    }")},getRunData:e=>({outputs:[{dims:e[0].dims,dataType:e[0].dataType}],programUniforms:[{type:12,data:Math.ceil(n/4)},{type:12,data:r}],dispatchGroup:{x:Math.ceil(n/un/4)}})}},To=e=>{e.inputs.length<2||0===Rt.size(e.inputs[1].dims)?Pi(e):e.compute(ko(e.inputs))}}),su=re(()=>{El(),Tl(),Rl(),Pl(),Io=e=>{if(!e||2!==e.length)throw new Error("Gather requires 2 inputs.")},Co=(e,t)=>{let n=e[0].dims,r=e[1].dims,i=n.length,a=Rt.normalizeAxis(t.axis,i),o=n.slice(0);o.splice(a,1,...r);let s=n[a],c=9===e[0].dataType?4:1,l=Math.ceil(Rt.size(o)/c),u=[{type:12,data:l},{type:6,data:s},{type:12,data:a},...pn(e[0].dims,e[1].dims,o)];return{name:"Gather",shaderCache:{hint:t.cacheKey,inputDependencies:["rank","rank"]},getRunData:()=>({outputs:[{dims:o,dataType:e[0].dataType}],dispatchGroup:{x:Math.ceil(l/64)},programUniforms:u}),getShaderSource:t=>{let n,s=_n("data",e[0].dataType,e[0].dims.length,c),l=_n("inputIndices",e[1].dataType,e[1].dims.length),u=xn("output",e[0].dataType,o.length,c),d=e=>{let t=r.length,n="var indicesIndices".concat(e,"  = ").concat(l.type.indices,"(0);");for(let r=0;r<t;r++)n+="".concat(t>1?"indicesIndices".concat(e,"[").concat(r,"]"):"indicesIndices".concat(e)," = ").concat(o.length>1?"outputIndices".concat(e,"[uniforms.axis + ").concat(r,"]"):"outputIndices".concat(e),";");n+="\n          var idx".concat(e," = ").concat(l.getByIndices("indicesIndices".concat(e)),";\n          if (idx").concat(e," < 0) {\n            idx").concat(e," = idx").concat(e," + uniforms.axisDimLimit;\n          }\n          var dataIndices").concat(e," : ").concat(s.type.indices,";\n        ");for(let r=0,s=0;r<i;r++)r===a?(n+="".concat(i>1?"dataIndices".concat(e,"[").concat(r,"]"):"dataIndices".concat(e)," = u32(idx").concat(e,");"),s+=t):(n+="".concat(i>1?"dataIndices".concat(e,"[").concat(r,"]"):"dataIndices".concat(e)," = ").concat(o.length>1?"outputIndices".concat(e,"[").concat(s,"]"):"outputIndices".concat(e),";"),s++);return n};if(9===e[0].dataType){let e=function(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"";return"\n          let outputIndices".concat(t," = ").concat(u.offsetToIndices("outputOffset + ".concat(t,"u")),";\n          ").concat(d(t),";\n          let offset").concat(t," = ").concat(s.indicesToOffset("dataIndices".concat(t)),";\n          let index").concat(t," = offset").concat(t," / 4u;\n          let component").concat(t," = offset").concat(t," % 4u;\n          ").concat(e,"[").concat(t,"] = ").concat(n,"(").concat(s.getByOffset("index".concat(t)),"[component").concat(t,"]);\n        ")};n="\n        let outputOffset = global_idx * ".concat(c,";\n        var value = vec4<u32>(0);\n        ").concat(e("value",0,"u32"),"\n        ").concat(e("value",1,"u32"),"\n        ").concat(e("value",2,"u32"),"\n        ").concat(e("value",3,"u32"),"\n        ").concat(u.setByOffset("global_idx","value"),"\n      ")}else n="\n      let outputIndices = ".concat(u.offsetToIndices("global_idx"),";\n      ").concat(d(""),";\n      let value = ").concat(s.getByIndices("dataIndices"),";\n      ").concat(u.setByOffset("global_idx","value"),";\n      ");return"\n      ".concat(t.registerUniform("outputSize","u32").registerUniform("axisDimLimit","i32").registerUniform("axis","u32").declareVariables(s,l,u),"\n      ").concat(t.mainStart(),"\n        ").concat(t.guardAgainstOutOfBoundsWorkgroupSizes("uniforms.outputSize"),"\n        ").concat(n,"\n      }")}}},Ao=e=>ln({axis:e.axis}),Oo=(e,t)=>{let n=e.inputs;Io(n),e.compute(Co(e.inputs,t))}}),cu=re(()=>{El(),Tl(),Pl(),No=(e,t,n,r,i,a,o,s,c)=>{let l=[{type:12,data:a},{type:12,data:r},{type:12,data:i},{type:12,data:n},{type:12,data:o},{type:12,data:s},{type:12,data:c}],u=[a];l.push(...pn(t.dims,u));return e.compute({name:"computeSliceOffsets",shaderCache:{hint:"".concat(i.length,"_").concat(n.length),inputDependencies:["rank"]},getRunData:()=>({outputs:[{dims:u,dataType:e.inputs[1].dataType}],dispatchGroup:{x:Math.ceil(a/64)},programUniforms:l}),getShaderSource:e=>{let r=[_n("indices_data",t.dataType,t.dims.length),xn("input_slice_offsets_data",12,1,1)],a=[{name:"output_size",type:"u32"},{name:"batch_dims",type:"u32"},{name:"input_dims",type:"u32",length:i.length},{name:"sizes_from_slice_dims_data",type:"u32",length:n.length},{name:"num_slices_per_batch",type:"u32"},{name:"input_batch_stride",type:"u32"},{name:"num_slice_dims",type:"u32"}];return"\n  ".concat(e.registerUniforms(a).declareVariables(...r),"\n  ").concat(e.mainStart(),"\n    ").concat(e.guardAgainstOutOfBoundsWorkgroupSizes("uniforms.output_size"),"\n    let batch_idx = global_idx / uniforms.num_slices_per_batch;\n    let base_offset = batch_idx * uniforms.input_batch_stride;\n\n    let slice_indices_base_offset = global_idx * uniforms.num_slice_dims;\n    var relative_slice_offset = 0;\n    for (var dim_idx = 0u; dim_idx < uniforms.num_slice_dims; dim_idx ++) {\n      var index = i32(indices_data[dim_idx + slice_indices_base_offset].x);\n      let input_dim_idx = uniforms.batch_dims + dim_idx;\n      if (index < 0) {\n        ").concat(1===i.length?"index += i32(uniforms.input_dims);":"index += i32(uniforms.input_dims[input_dim_idx]);","\n      }\n      ").concat(1===n.length?"relative_slice_offset += index * i32(uniforms.sizes_from_slice_dims_data);":"relative_slice_offset += index * i32(uniforms.sizes_from_slice_dims_data[dim_idx]);","\n    }\n\n    input_slice_offsets_data[global_idx] =  base_offset + u32(relative_slice_offset);\n  }")}},{inputs:[t],outputs:[-1]})[0]},Ro=(e,t)=>{let n=e.inputs,r=n[0].dims,i=n[0].dataType,a=n[1].dims,o=a[a.length-1],s=Rt.sizeToDimension(a,a.length-1),c=Rt.sizeFromDimension(r,t.batchDims+o),l=Rt.sizeToDimension(r,t.batchDims),u=Rt.sizeFromDimension(r,t.batchDims),d=s/l,h=new Array(o),f=c;for(let w=0;w<o;++w)h[o-1-w]=f,f*=r[t.batchDims+o-1-w];let p=No(e,n[1],h,t.batchDims,r,s,d,u,o),m=t.batchDims+o;if(m>r.length)throw new Error("last dimension of indices must not be larger than rank of input tensor");let g=a.slice(0,-1).concat(r.slice(m)),y=Rt.size(g),v=[{type:12,data:y},{type:12,data:c},...pn(n[0].dims,p.dims,g)];e.compute({name:"GatherND",shaderCache:{hint:t.cacheKey,inputDependencies:["rank","rank"]},getRunData:()=>({outputs:[{dims:g,dataType:i}],dispatchGroup:{x:Math.ceil(y/64)},programUniforms:v}),getShaderSource:e=>{let t=_n("data",n[0].dataType,n[0].dims.length),r=_n("slice_offsets",12,p.dims.length),i=xn("output",n[0].dataType,g.length);return"\n          ".concat(e.registerUniform("output_size","u32").registerUniform("slice_size","u32").declareVariables(t,r,i),"\n            ").concat(e.mainStart(),"\n            ").concat(e.guardAgainstOutOfBoundsWorkgroupSizes("uniforms.output_size"),"\n          let slice_offset = slice_offsets[global_idx / uniforms.slice_size];\n          output[global_idx] = data[u32(slice_offset) + global_idx % uniforms.slice_size];\n        }")}},{inputs:[n[0],p]})},Po=e=>({batchDims:e.batch_dims,cacheKey:""})}),lu=re(()=>{El(),Tl(),Rl(),Pl(),Do=(e,t)=>{if(e.length<3||e.length>4)throw new Error("GatherBlockQuantized requires 3 or 4 inputs.");let n=Rt.normalizeAxis(t.quantizeAxis,e[0].dims.length),r=t.blockSize,i=e[0],a=e[2],o=4===e.length?e[3]:void 0;if(a.dims.length!==i.dims.length||!i.dims.map((e,t)=>t===n?Math.ceil(e/r)===a.dims[t]:e===a.dims[t]).reduce((e,t)=>e&&t,!0))throw new Error("Scales must have the same rank as the input tensor and the dims should match except on gatherAxis.");if(o){if(o.dataType!==i.dataType)throw new Error("Zero point must have the same data type as the input tensor.");if(o.dims.length!==a.dims.length||!o.dims.map((e,t)=>e===a.dims[t]).reduce((e,t)=>e&&t,!0))throw new Error("Zero point must have the same rank as the input tensor and the dims should match except on quantizeAxis.")}},zo=(e,t)=>{let n=e[0].dims,r=e[1].dims,i=n.length,a=Rt.normalizeAxis(t.gatherAxis,i),o=Rt.normalizeAxis(t.quantizeAxis,i),s=n.slice(0);s.splice(a,1,...r);let c=Rt.size(s),l=e[2].dataType,u=22===e[0].dataType,d=[{type:12,data:c},{type:12,data:o},{type:12,data:a},{type:12,data:t.blockSize},...pn(...e.map((e,t)=>e.dims),s)];return{name:"GatherBlockQuantized",shaderCache:{hint:"".concat(t.cacheKey,";").concat(e.filter((e,t)=>1!==t).map(e=>e.dims.join("_")).join(";")),inputDependencies:Array.from({length:e.length},(e,t)=>"rank")},getRunData:()=>({outputs:[{dims:s,dataType:l}],dispatchGroup:{x:Math.ceil(c/64)},programUniforms:d}),getShaderSource:t=>{let i=_n("data",e[0].dataType,e[0].dims.length),o=_n("inputIndices",e[1].dataType,e[1].dims.length),c=_n("scales",e[2].dataType,e[2].dims.length),d=e.length>3?_n("zeroPoint",e[3].dataType,e[3].dims.length):void 0,h=xn("output",l,s.length),f=[i,o,c];d&&f.push(d);return"\n        ".concat(t.registerUniforms([{name:"output_size",type:"u32"},{name:"quantize_axis",type:"u32"},{name:"gather_axis",type:"u32"},{name:"block_size",type:"u32"}]).declareVariables(...f,h),"\n        ").concat(t.mainStart(),"\n        let output_indices = ").concat(h.offsetToIndices("global_idx"),";\n        var indices_indices = ").concat(o.type.indices,"(0);\n        ").concat(r.length>1?"\n          for (var i: u32 = 0; i < ".concat(r.length,"; i++) {\n            let index = ").concat(h.indicesGet("output_indices","uniforms.gather_axis + i"),";\n            ").concat(o.indicesSet("indices_indices","i","index"),";\n          }"):"indices_indices = ".concat(h.indicesGet("output_indices","uniforms.gather_axis"),";"),";\n        var data_indices = ").concat(i.type.indices,"(0);\n        for (var i: u32 = 0; i < uniforms.gather_axis; i++) {\n          let index = ").concat(h.indicesGet("output_indices","i"),";\n          ").concat(i.indicesSet("data_indices","i","index"),";\n        }\n        var index_from_indices = ").concat(o.getByIndices("indices_indices"),";\n        if (index_from_indices < 0) {\n          index_from_indices += ").concat(n[a],";\n        }\n        ").concat(i.indicesSet("data_indices","uniforms.gather_axis","u32(index_from_indices)"),";\n        for (var i = uniforms.gather_axis + 1; i < ").concat(s.length,"; i++) {\n          let index = ").concat(h.indicesGet("output_indices","i + ".concat(r.length," - 1")),";\n          ").concat(i.indicesSet("data_indices","i","index"),";\n        }\n        let data_offset = ").concat(i.indicesToOffset("data_indices"),";\n        let data_index = data_offset % 8;\n        // Convert 4-bit packed data to 8-bit packed data.\n        let packed_4bit_quantized_data = ").concat(i.getByOffset("data_offset / 8"),";\n        let packed_8bit_quantized_data = (packed_4bit_quantized_data >> (4 * (data_index % 2))) & 0x0f0f0f0f;\n        let quantized_data_vec = ").concat(u?"unpack4xI8":"unpack4xU8","(u32(packed_8bit_quantized_data));\n        let quantized_data = quantized_data_vec[data_index / 2];\n        var scale_indices = data_indices;\n        let quantize_axis_index = ").concat(c.indicesGet("data_indices","uniforms.quantize_axis")," / uniforms.block_size;\n        ").concat(c.indicesSet("scale_indices","uniforms.quantize_axis","quantize_axis_index"),";\n        var scale = ").concat(c.getByIndices("scale_indices"),";\n        ").concat(d?"\n              let zero_point_indices = scale_indices;\n              let zero_point_offset = ".concat(d.indicesToOffset("zero_point_indices"),";\n              let zero_point_index = zero_point_offset % 8;\n              let packed_4bit_zero_points = ").concat(d.getByOffset("zero_point_offset / 8"),";\n              let packed_8bit_zero_points = (packed_4bit_zero_points >> (4 * (zero_point_index % 2))) & 0x0f0f0f0f;\n              let zero_point_vec = ").concat(u?"unpack4xI8":"unpack4xU8","(u32(packed_8bit_zero_points));\n              let zero_point = zero_point_vec[zero_point_index / 2];"):"var zero_point = 0",";\n        let dequantized_data = ").concat(fn(l),"(quantized_data - zero_point) * scale;\n        ").concat(h.setByOffset("global_idx","dequantized_data"),";\n    }")}}},Mo=(e,t)=>{let n=e.inputs;Do(n,t),e.compute(zo(e.inputs,t))},Lo=e=>ln({blockSize:e.blockSize,gatherAxis:e.gatherAxis,quantizeAxis:e.quantizeAxis})}),uu=re(()=>{El(),Tl(),Rl(),Pl(),Uo=e=>{if(!e||2!==e.length)throw new Error("GatherElements requires 2 inputs.");if(e[0].dims.length<1)throw new Error("GatherElements requires that the data input be rank >= 1.");if(e[0].dims.length!==e[1].dims.length)throw new Error("GatherElements requires that the data input and\n                     indices input tensors be of same rank.")},Bo=(e,t)=>{let n=e[0].dims,r=e[0].dataType,i=n.length,a=e[1].dims,o=e[1].dataType,s=Rt.normalizeAxis(t.axis,i),c=n[s],l=a.slice(0),u=Rt.size(l),d=_n("input",r,i),h=_n("indicesInput",o,a.length),f=xn("output",r,l.length),p=[{type:12,data:u},{type:6,data:c},{type:12,data:s}];return p.push(...pn(n,a,l)),{name:"GatherElements",shaderCache:{inputDependencies:["rank","rank"]},getRunData:()=>({outputs:[{dims:l,dataType:e[0].dataType}],dispatchGroup:{x:Math.ceil(u/64)},programUniforms:p}),getShaderSource:e=>"\n      ".concat(e.registerUniform("outputSize","u32").registerUniform("axisDimLimit","i32").registerUniform("axis","u32").declareVariables(d,h,f),"\n      ").concat(e.mainStart(),"\n      ").concat(e.guardAgainstOutOfBoundsWorkgroupSizes("uniforms.outputSize"),"\n\n      let outputIndices = ").concat(f.offsetToIndices("global_idx"),";\n\n      var idx = ").concat(h.getByOffset("global_idx"),";\n      if (idx < 0) {\n        idx = idx + uniforms.axisDimLimit;\n      }\n      var inputIndices = ").concat(d.type.indices,"(outputIndices);\n      ").concat(d.indicesSet("inputIndices","uniforms.axis","u32(idx)"),";\n      let value = ").concat(d.getByIndices("inputIndices"),";\n\n      ").concat(f.setByOffset("global_idx","value"),";\n  }")}},Fo=e=>ln({axis:e.axis}),jo=(e,t)=>{let n=e.inputs;Uo(n),e.compute(Bo(e.inputs,t))}}),du=re(()=>{El(),Tl(),Pl(),Vo=e=>{if(!e)throw new Error("Input is missing");if(e.length<2||e.length>3)throw new Error("Invaid input number.");if(3===e.length&&e[2].dims.length>2)throw new Error("Invalid input shape of C");if(e[0].dataType!==e[1].dataType||3===e.length&&e[0].dataType!==e[2].dataType)throw new Error("Input types are mismatched")},qo=(e,t)=>{let n=e[0].dims.slice(),r=e[1].dims.slice(),[i,a,o]=Dt.getShapeOfGemmResult(n,t.transA,r,t.transB,3===e.length?e[2].dims:void 0),s=[i,a];if(!s)throw new Error("Can't use gemm on the given tensors");let c=16,l=Math.ceil(a/c),u=Math.ceil(i/c),d=(Rt.size(s),[{type:12,data:l},{type:12,data:i},{type:12,data:a},{type:12,data:o},{type:1,data:t.alpha},{type:1,data:t.beta}]),h=["type","type"];3===e.length&&(d.push(...pn(e[2].dims)),h.push("rank")),d.push(...pn(s));return{name:"GemmShared",shaderCache:{hint:"".concat(t.cacheKey),inputDependencies:h},getRunData:()=>({outputs:[{dims:s,dataType:e[0].dataType}],dispatchGroup:{x:l*u},programUniforms:d}),getShaderSource:n=>{let r=_n("a",e[0].dataType,e[0].dims),i=_n("b",e[1].dataType,e[1].dims),a=null,o=[r,i];3===e.length&&(a=_n("c",e[2].dataType,e[2].dims.length),o.push(a));let l=xn("output",e[0].dataType,s.length);o.push(l);let u="",d="";t.transA&&t.transB?(d="\n      var col = tile_row_start + local_id.x;\n      var row = k_start + local_id.y;\n      if (col < uniforms.M && row < uniforms.K) {\n        tile_a[local_id.y][local_id.x] = a[row * uniforms.M + col];\n      } else {\n        tile_a[local_id.y][local_id.x] = ".concat(r.type.value,"(0);\n      }\n\n      col = k_start + local_id.x;\n      row = tile_col_start + local_id.y;\n      if (col < uniforms.K && row < uniforms.N) {\n        tile_b[local_id.y][local_id.x] = b[row * uniforms.K + col];\n      } else {\n        tile_b[local_id.y][local_id.x] = ").concat(i.type.value,"(0);\n      }\n      "),u="value += tile_a[k][local_id.y] * tile_b[local_id.x][k];"):t.transA&&!t.transB?(d="\n      var col = tile_row_start + local_id.x;\n      var row = k_start + local_id.y;\n      if (col < uniforms.M && row < uniforms.K) {\n        tile_a[local_id.y][local_id.x] = a[row * uniforms.M + col];\n      } else {\n        tile_a[local_id.y][local_id.x] = ".concat(r.type.value,"(0);\n      }\n\n      col = tile_col_start + local_id.x;\n      row = k_start + local_id.y;\n      if (col < uniforms.N && row < uniforms.K) {\n        tile_b[local_id.y][local_id.x] = b[row * uniforms.N + col];\n      } else {\n        tile_b[local_id.y][local_id.x] = ").concat(i.type.value,"(0);\n      }\n      "),u="value += tile_a[k][local_id.y] * tile_b[k][local_id.x];"):!t.transA&&t.transB?(d="\n      var col = k_start + local_id.x;\n      var row = tile_row_start + local_id.y;\n      if (col < uniforms.K && row < uniforms.M) {\n        tile_a[local_id.y][local_id.x] = a[row * uniforms.K + col];\n      } else {\n        tile_a[local_id.y][local_id.x] = ".concat(r.type.value,"(0);\n      }\n\n      col = k_start + local_id.x;\n      row = tile_col_start + local_id.y;\n      if (col < uniforms.K && row < uniforms.N) {\n        tile_b[local_id.y][local_id.x] = b[row * uniforms.K + col];\n      } else {\n        tile_b[local_id.y][local_id.x] = ").concat(i.type.value,"(0);\n      }\n      "),u="value += tile_a[local_id.y][k] * tile_b[local_id.x][k];"):!t.transA&&!t.transB&&(d="\n      var col = k_start + local_id.x;\n      var row = tile_row_start + local_id.y;\n      if (col < uniforms.K && row < uniforms.M) {\n        tile_a[local_id.y][local_id.x] = a[row * uniforms.K + col];\n      } else {\n        tile_a[local_id.y][local_id.x] = ".concat(r.type.value,"(0);\n      }\n\n      col = tile_col_start + local_id.x;\n      row = k_start + local_id.y;\n      if (col < uniforms.N && row < uniforms.K) {\n        tile_b[local_id.y][local_id.x] = b[row * uniforms.N + col];\n      } else {\n        tile_b[local_id.y][local_id.x] = ").concat(i.type.value,"(0);\n      }\n      "),u="value += tile_a[local_id.y][k] * tile_b[k][local_id.x];");let h=1===t.alpha?"":"value *= uniforms.alpha;";return"\n  ".concat(n.registerUniforms([{name:"num_tile_n",type:"u32"},{name:"M",type:"u32"},{name:"N",type:"u32"},{name:"K",type:"u32"},{name:"alpha",type:"f32"},{name:"beta",type:"f32"}]).declareVariables(...o),"\n  var<workgroup> tile_a: array<array<").concat(r.type.storage,", ").concat(c,">, ").concat(c,">;\n  var<workgroup> tile_b: array<array<").concat(i.type.storage,", ").concat(c,">, ").concat(c,">;\n  ").concat(n.mainStart([c,c,1]),"\n    let tile_col_start = (workgroup_index % uniforms.num_tile_n) * ").concat(c,";\n    let tile_row_start = (workgroup_index / uniforms.num_tile_n) * ").concat(c,";\n    let num_tiles = (uniforms.K - 1) / ").concat(c," + 1;\n    var k_start = 0u;\n    var value = ").concat(l.type.value,"(0);\n    for (var t: u32 = 0u; t < num_tiles; t++) {\n      ").concat(d,"\n      k_start = k_start + ").concat(c,";\n      workgroupBarrier();\n\n      for (var k: u32 = 0u; k < ").concat(c,"; k++) {\n        ").concat(u,"\n      }\n      workgroupBarrier();\n    }\n\n    ").concat(h,"\n    let m = tile_row_start + local_id.y;\n    let n = tile_col_start + local_id.x;\n    ").concat(null!=a?"let cOffset = ".concat(a.broadcastedIndicesToOffset("vec2(m, n)",l),"; value += ").concat(l.type.value,"(uniforms.beta) * ").concat(a.getByOffset("cOffset"),";"):"","\n    if (m < uniforms.M && n < uniforms.N) {\n      output[m * uniforms.N + n] = value;\n    }\n  }")}}},Ho=e=>({transA:e.transA,transB:e.transB,alpha:e.alpha,beta:e.beta,cacheKey:"".concat(e.transA,";").concat(e.transB,";").concat(1===e.alpha)}),Wo=(e,t)=>{Vo(e.inputs),e.compute(qo(e.inputs,t))}}),hu=re(()=>{El(),Tl(),Rl(),Pl(),[Go,Ko,Qo,Xo]=[0,1,2,3],Yo=e=>{if(4!==e[0].dims.length)throw new Error("only 4-D tensor is supported.");if(e[0].dims.length!==e[1].dims.length)throw new Error("input dimensions must be equal to grid dimensions");if(e[0].dims.length-2!==e[1].dims[e[1].dims.length-1])throw new Error("last dimension of grid must be equal to ".concat(e[0].dims.length-2));if(e[0].dims[0]!==e[1].dims[0])throw new Error("grid batch size must match input batch size")},Jo=e=>"\n  fn gs_bicubic_interpolate(p: mat4x4<".concat(e,">, x: f32, y: f32) -> ").concat(e," {\n    var v: vec4<f32>;\n    var coeffs = gs_get_cubic_coeffs(x);\n    for (var i = 0; i < 4; i++) {\n      v[i] = coeffs[0] * p[i][0] + coeffs[1] * p[i][1] + coeffs[2] * p[i][2] + coeffs[3] * p[i][3];\n    }\n    coeffs = gs_get_cubic_coeffs(y);\n    let pixel = ").concat(e,"(coeffs[0] * v[0] + coeffs[1] * v[1] + coeffs[2] * v[2] + coeffs[3] * v[3]);\n    return pixel;\n  }\n"),$o=e=>"\n  fn gs_denormalize(n: f32, length: i32) -> f32 {\n    ".concat(0===e.alignCorners?"\n    // alignCorners: false => [-1, 1] to [-0.5, length - 0.5]\n    return ((n + 1.0) * f32(length) - 1.0) / 2.0;\n    ":"\n    // alignCorners: true => [-1, 1] to [0, length - 1]\n    return (n + 1.0) / 2.0 * (f32(length - 1));\n    ","\n  }\n"),Zo=e=>"\n  ".concat("reflection"===e.paddingMode?"\n      fn gs_reflect(x: i32, x_min: f32, x_max: f32) -> u32 {\n        var dx = 0.0;\n        var fx = f32(x);\n        let range = x_max - x_min;\n        if (fx < x_min) {\n          dx = x_min - fx;\n          let n = u32(dx / range);\n          let r = dx - f32(n) * range;\n          if (n % 2 == 0) {\n            fx = x_min + r;\n          } else {\n            fx = x_max - r;\n          }\n        } else if (fx > x_max) {\n          dx = fx - x_max;\n          let n = u32(dx / range);\n          let r = dx - f32(n) * range;\n          if (n % 2 == 0) {\n            fx = x_max - r;\n          } else {\n            fx = x_min + r;\n          }\n        }\n        return u32(fx);\n      }":"","\n"),es=(e,t,n)=>"\n  fn pixel_at_grid(r: i32, c: i32, H: i32, W: i32, batch: u32, channel: u32, border: vec4<f32>) -> ".concat(t," {\n     var pixel = ").concat(t,"(0);\n     var indices = vec4<u32>(0);\n     indices[").concat(Go,"] = batch;\n     indices[").concat(Ko,"] = channel;")+(()=>{switch(n.paddingMode){case"zeros":return"\n          if (r >= 0 && r < H && c >=0 && c < W) {\n            indices[".concat(Qo,"] = u32(r);\n            indices[").concat(Xo,"] = u32(c);\n          } else {\n            return ").concat(t,"(0);\n          }\n        ");case"border":return"\n          indices[".concat(Qo,"] = u32(clamp(r, 0, H - 1));\n          indices[").concat(Xo,"] = u32(clamp(c, 0, W - 1));\n        ");case"reflection":return"\n          indices[".concat(Qo,"] = gs_reflect(r, border[1], border[3]);\n          indices[").concat(Xo,"] = gs_reflect(c, border[0], border[2]);\n        ");default:throw new Error("padding mode ".concat(n.paddingMode," is not supported"))}})()+"\n    return ".concat(e.getByIndices("indices"),";\n  }\n"),ts=(e,t,n)=>(()=>{switch(n.mode){case"nearest":return"\n          let result = pixel_at_grid(i32(round(y)), i32(round(x)), H_in, W_in, indices[".concat(Go,"], indices[").concat(Ko,"], border);\n        ");case"bilinear":return"\n          let x1 = i32(floor(x));\n          let y1 = i32(floor(y));\n          let x2 = x1 + 1;\n          let y2 = y1 + 1;\n\n          let p11 = pixel_at_grid(y1, x1, H_in, W_in, indices[".concat(Go,"], indices[").concat(Ko,"], border);\n          let p12 = pixel_at_grid(y1, x2, H_in, W_in, indices[").concat(Go,"], indices[").concat(Ko,"], border);\n          let p21 = pixel_at_grid(y2, x1, H_in, W_in, indices[").concat(Go,"], indices[").concat(Ko,"], border);\n          let p22 = pixel_at_grid(y2, x2, H_in, W_in, indices[").concat(Go,"], indices[").concat(Ko,"], border);\n\n          let dx2 = ").concat(t,"(f32(x2) - x);\n          let dx1 = ").concat(t,"(x - f32(x1));\n          let dy2 = ").concat(t,"(f32(y2) - y);\n          let dy1 = ").concat(t,"(y - f32(y1));\n          let result = dy2 * (dx2 * p11 + dx1 * p12) + dy1 * (dx2 * p21 + dx1 * p22);\n        ");case"bicubic":return"\n          let x0 = i32(floor(x)) - 1;\n          let y0 = i32(floor(y)) - 1;\n          var p: mat4x4<".concat(t,">;\n          for (var h = 0; h < 4; h++) {\n            for (var w = 0; w < 4; w++) {\n              p[h][w] = pixel_at_grid(h + y0, w + x0, H_in, W_in, indices[").concat(Go,"], indices[").concat(Ko,"], border);\n            }\n          }\n\n          let dx = x - f32(x0 + 1);\n          let dy = y - f32(y0 + 1);\n          let result = gs_bicubic_interpolate(p, dx, dy);\n        ");default:throw new Error("mode ".concat(n.mode," is not supported"))}})()+"".concat(e.setByOffset("global_idx","result")),ns=(e,t)=>{let n=_n("x",e[0].dataType,e[0].dims.length),r=[e[1].dims[0],e[1].dims[1],e[1].dims[2]],i=_n("grid",e[1].dataType,r.length,2),a=[e[0].dims[0],e[0].dims[1],e[1].dims[1],e[1].dims[2]];"NHWC"===t.format&&(a=[e[0].dims[0],e[1].dims[1],e[1].dims[2],e[0].dims[3]],[Go,Ko,Qo,Xo]=[0,3,1,2]);let o=xn("output",e[0].dataType,a.length),s=n.type.value,c=[{type:12,data:Rt.size(a)},...pn(e[0].dims,r,a)];return{name:"GridSample",shaderCache:{hint:"".concat(t.cacheKey),inputDependencies:["type","type"]},getRunData:e=>{let t=Rt.size(a);return{outputs:[{dims:a,dataType:e[0].dataType}],dispatchGroup:{x:Math.ceil(t/64)},programUniforms:c}},getShaderSource:e=>"\n  ".concat(e.registerUniform("output_size","u32").declareVariables(n,i,o),"\n  ").concat("\n  fn gs_get_cubic_coeffs(x: f32) -> vec4<f32> {\n    let cubic_alpha = -0.75f;\n    let x_abs = abs(x);\n    var coeffs: vec4<f32>;\n    coeffs[0] = (((cubic_alpha * (x_abs + 1) - 5 * cubic_alpha) * (x_abs + 1) + 8 * cubic_alpha) * (x_abs + 1) - 4 * cubic_alpha);\n    coeffs[1] = (((cubic_alpha + 2) * x_abs - (cubic_alpha + 3)) * x_abs * x_abs + 1);\n    coeffs[2] = (((cubic_alpha + 2) * (1 - x_abs) - (cubic_alpha + 3)) * (1 - x_abs) * (1 - x_abs) + 1);\n    coeffs[3] = (((cubic_alpha * (2 - x_abs) - 5 * cubic_alpha) * (2 - x_abs) + 8 * cubic_alpha) * (2 - x_abs) - 4 * cubic_alpha);\n    return coeffs;\n  }\n","\n  ").concat(Jo(s),"\n  ").concat($o(t),"\n  ").concat(Zo(t),"\n  ").concat(es(n,s,t),"\n\n  ").concat(e.mainStart(),"\n    ").concat(e.guardAgainstOutOfBoundsWorkgroupSizes("uniforms.output_size"),"\n      let H_in = i32(uniforms.x_shape[").concat(Qo,"]);\n      let W_in = i32(uniforms.x_shape[").concat(Xo,"]);\n\n      ").concat(0===t.alignCorners?"\n      let x_min = -0.5;\n      let x_max = f32(W_in) - 0.5;\n      let y_min = -0.5;\n      let y_max = f32(H_in) - 0.5;\n      ":"\n      let x_min = 0.0;\n      let x_max = f32(W_in) - 1.0;\n      let y_min = 0.0;\n      let y_max = f32(H_in) - 1.0;\n      ",";\n      let border = vec4<f32>(x_min, y_min, x_max, y_max);\n\n      let indices = ").concat(o.offsetToIndices("global_idx"),";\n      var grid_indices = vec3<u32>(indices[").concat(Go,"], indices[").concat(Qo,"], indices[").concat(Xo,"]);\n      let nxy = ").concat(i.getByIndices("grid_indices"),";\n      var x = gs_denormalize(f32(nxy[0]), W_in);\n      var y = gs_denormalize(f32(nxy[1]), H_in);\n\n      ").concat(ts(o,s,t),"\n  }")}},rs=(e,t)=>{Yo(e.inputs),e.compute(ns(e.inputs,t))},is=e=>ln({alignCorners:e.align_corners,mode:e.mode,paddingMode:e.padding_mode,format:e.format})}),fu=re(()=>{El(),Tl(),Rl(),Ol(),Ul(),Pl(),Dl(),as=(e,t)=>e.length>t&&e[t].dims.length>0?e[t]:void 0,os=(e,t)=>{let n=e[0],r=as(e,1),i=as(e,2),a=as(e,3),o=as(e,4),s=as(e,5),c=as(e,6),l=as(e,7);if(3!==n.dims.length&&5!==n.dims.length)throw new Error("Input query is expected to have 3 or 5 dimensions");let u,d=n.dims[0],h=n.dims[1],f=3===n.dims.length?n.dims[2]:t.numHeads*n.dims[4],p=h,m=0,g=0,y=Math.floor(f/t.numHeads);if(c&&l&&Rt.size(c.dims)&&Rt.size(l.dims)){if(4!==c.dims.length)throw new Error('Input "past_key" is expected to have 4 dimensions');if(c.dims[0]!==d||c.dims[1]!==t.numHeads||c.dims[3]!==y)throw new Error('Input "past_key" shape (batch_size, num_heads, past_sequence_length, head_size)');if(l.dims[0]!==d||l.dims[1]!==t.numHeads||l.dims[3]!==y)throw new Error('Input "past_value" shape (batch_size, num_heads, past_sequence_length, head_size)');if(c.dims[2]!==l.dims[2])throw new Error('Input "past_key" and "past_value" shall have same dim 2 (past_sequence_length)');if(4!==l.dims.length)throw new Error('Input "past_value" is expected to have 4 dimensions');m=c.dims[2],g=c.dims[2]}else if(c&&Rt.size(c.dims)||l&&Rt.size(l.dims))throw new Error('Input "past_key" and "past_value" shall be both present or both absent');if(r&&Rt.size(r.dims)>0){if(3!==n.dims.length)throw new Error('Input "query" is expected to have 3 dimensions when key is given');if(r.dims.length<3||r.dims.length>5)throw new Error('Input "key" is expected to have 3, 4, or 5 dimensions');if(n.dims[0]!==r.dims[0])throw new Error('Input "query" and "key" shall have same dim 0 (batch size)');if(3===r.dims.length){if(r.dims[2]!==n.dims[2])throw new Error('Input "query" and "key" shall have same dim 2 (hidden_size)');u=2,p=r.dims[1]}else if(5===r.dims.length){if(r.dims[2]!==t.numHeads||2!==r.dims[3]||r.dims[4]!==y)throw new Error('Expect "key" shape (batch_size, kv_sequence_length, num_heads, 2, head_size) for packed kv');if(i)throw new Error('Expect "value" be none when "key" has packed kv format.');u=5,p=r.dims[1]}else{if(r.dims[1]!==t.numHeads||r.dims[3]!==y)throw new Error('Expect "key" shape (batch_size, num_heads, kv_sequence_length, head_size) for past_key');u=0,p=r.dims[2]}}else{if(5!==n.dims.length)throw new Error('Input "query" is expected to have 5 dimensions when key is empty');if(n.dims[2]!==t.numHeads||3!==n.dims[3])throw new Error('Expect "query" shape (batch_size, kv_sequence_length, num_heads, 3, head_size) for packed kv');u=3}if(a&&Rt.size(a.dims)>0){if(1!==a.dims.length)throw new Error('Input "bias" is expected to have 1 dimension');if(r&&5===r.dims.length&&2===r.dims[3])throw new Error("bias is not allowed for packed kv.")}let v=m+p,w=0;if(o&&Rt.size(o.dims)>0){w=8;let e=o.dims;throw 1===e.length?e[0]===d?w=1:e[0]===3*d+2&&(w=3):2===e.length&&e[0]===d&&e[1]===v&&(w=5),8===w?new Error('Input "key_padding_mask" shape shall be (batch_size) or (batch_size, total_sequence_length)'):new Error("Mask not supported")}let b=!1,_=f;if(i&&Rt.size(i.dims)>0){if(3!==i.dims.length&&4!==i.dims.length)throw new Error('Input "value" is expected to have 3 or 4 dimensions');if(n.dims[0]!==i.dims[0])throw new Error('Input "query" and "value" shall have same dim 0 (batch_size)');if(3===i.dims.length){if(p!==i.dims[1])throw new Error('Input "key" and "value" shall have the same dim 1 (kv_sequence_length)');_=i.dims[2]}else{if(p!==i.dims[2])throw new Error('Input "key" and "value" shall have the same dim 2 (kv_sequence_length)');_=i.dims[1]*i.dims[3],b=!0}}if(o&&Rt.size(o.dims)>0)throw new Error("Key padding mask is not supported");if(s&&Rt.size(s.dims)>0){if(4!==s.dims.length)throw new Error('Input "attention_bias" is expected to have 4 dimensions');if(s.dims[0]!==d||s.dims[1]!==t.numHeads||s.dims[2]!==h||s.dims[3]!==v)throw new Error('Expect "attention_bias" shape (batch_size, num_heads, sequence_length, total_sequence_length)')}return{batchSize:d,sequenceLength:h,pastSequenceLength:m,kvSequenceLength:p,totalSequenceLength:v,maxSequenceLength:g,inputHiddenSize:0,hiddenSize:f,vHiddenSize:_,headSize:y,vHeadSize:Math.floor(_/t.numHeads),numHeads:t.numHeads,isUnidirectional:!1,pastPresentShareBuffer:!1,maskFilterValue:t.maskFilterValue,maskType:w,scale:t.scale,broadcastResPosBias:!1,passPastInKv:b,qkvFormat:u}},ss=e=>ln(l({},e)),cs=ln({perm:[0,2,1,3]}),ls=(e,t,n,r,i,a,o)=>{let s=[r,i,a],c=Rt.size(s),l=[{type:12,data:c},{type:12,data:o},{type:12,data:a}];return e.compute({name:"MultiHeadAttentionAddBias",shaderCache:{inputDependencies:["type","type"]},getRunData:()=>({outputs:[{dims:s,dataType:t.dataType,gpuDataType:0}],dispatchGroup:{x:Math.ceil(c/64)},programUniforms:l}),getShaderSource:e=>{let r=xn("qkv_with_bias",t.dataType,s),i=_n("qkv",t.dataType,s),a=_n("bias",n.dataType,s);return"\n  ".concat(e.registerUniforms([{name:"output_size",type:"u32"},{name:"bias_offset",type:"u32"},{name:"hidden_size",type:"u32"}]).declareVariables(i,a,r),"\n  ").concat(e.mainStart(),"\n    ").concat(e.guardAgainstOutOfBoundsWorkgroupSizes("uniforms.output_size"),"\n    let bias_offset_idx = (global_idx % uniforms.hidden_size) + uniforms.bias_offset;\n\n    qkv_with_bias[global_idx] = qkv[global_idx] + bias[bias_offset_idx];\n  }")}},{inputs:[t,n],outputs:[-1]})[0]},us=(e,t,n,r,i,a,o,s)=>{let c=a;if(o&&Rt.size(o.dims)>0){if(1===r)throw new Error("AddBiasReshape is not implemented. Please export your model with packed QKV or KV");return c=ls(e,a,o,t,r,n*i,s),c=c.reshape([t,r,n,i]),1===n||1===r?c:e.compute(Pn(c,cs.perm),{inputs:[c],outputs:[-1]})[0]}return 3===a.dims.length&&(c=a.reshape([t,r,n,i])),1===n||1===r?c:e.compute(Pn(c,cs.perm),{inputs:[c],outputs:[-1]})[0]},ds=(e,t)=>{let n=os(e.inputs,t),r=e.inputs[0],i=as(e.inputs,1),a=as(e.inputs,2),o=as(e.inputs,3),s=as(e.inputs,4),c=as(e.inputs,5),l=as(e.inputs,6),u=as(e.inputs,7);if(5===r.dims.length)throw new Error("Packed QKV is not implemented");if(5===(null===i||void 0===i?void 0:i.dims.length))throw new Error("Packed KV is not implemented");let d=i&&a&&4===i.dims.length&&4===a.dims.length,h=us(e,n.batchSize,n.numHeads,n.sequenceLength,n.headSize,r,o,0);if(d)return Ur(e,h,i,a,s,void 0,l,u,c,n);if(!i||!a)throw new Error("key and value must be provided");let f=us(e,n.batchSize,n.numHeads,n.kvSequenceLength,n.headSize,i,o,n.hiddenSize),p=us(e,n.batchSize,n.numHeads,n.kvSequenceLength,n.vHeadSize,a,o,2*n.hiddenSize);Ur(e,h,f,p,s,void 0,l,u,c,n)}}),pu=re(()=>{El(),Tl(),Rl(),Pl(),hs=e=>{if(!e||e.length<1)throw new Error("too few inputs")},fs=(e,t)=>{let n=[],r=t.numOutputs;return e[1].dims[0]>0&&(e[1].getBigInt64Array().forEach(e=>n.push(Number(e))),r=n.length),ln({numOutputs:r,axis:t.axis,splitSizes:n})},ps=e=>"\nfn calculateOutputIndex(index: u32) -> u32 {\n    for (var i: u32 = 0u; i < ".concat(e,"u; i += 1u ) {\n    if (index < ").concat(wn("uniforms.size_in_split_axis","i",e),") {\n        return i;\n    }\n    }\n    return ").concat(e,"u;\n}"),ms=e=>{let t=e.length,n=[];for(let r=0;r<t;++r){let i=e[r].setByIndices("indices","input[global_idx]");1===t?n.push(i):0===r?n.push("if (output_number == ".concat(r,"u) { ").concat(i," }")):r===t-1?n.push("else { ".concat(i," }")):n.push("else if (output_number == ".concat(r,") { ").concat(i," }"))}return"\n      fn writeBufferData(output_number: u32, indices: ".concat(e[0].type.indices,", global_idx: u32) {\n        ").concat(n.join("\n"),"\n      }")},gs=(e,t)=>{let n=e[0].dims,r=Rt.size(n),i=e[0].dataType,a=Rt.normalizeAxis(t.axis,n.length),o=new Array(t.numOutputs),s=_n("input",i,n.length),c=new Array(t.numOutputs),l=[],u=[],d=0,h=[{type:12,data:r}];for(let f=0;f<t.numOutputs;f++){d+=t.splitSizes[f],c[f]=d;let r=n.slice();r[a]=t.splitSizes[f],u.push(r),o[f]=xn("output".concat(f),i,r.length),l.push({dims:u[f],dataType:e[0].dataType})}h.push({type:12,data:c},...pn(n,...u));return{name:"Split",shaderCache:{hint:t.cacheKey,inputDependencies:["rank"]},getShaderSource:e=>"\n  ".concat(e.registerUniform("input_size","u32").registerUniform("size_in_split_axis","u32",c.length).declareVariables(s,...o),"\n  ").concat(ps(c.length),"\n  ").concat(ms(o),"\n\n  ").concat(e.mainStart(),"\n    ").concat(e.guardAgainstOutOfBoundsWorkgroupSizes("uniforms.input_size"),"\n\n    var indices = ").concat(s.offsetToIndices("global_idx"),";\n    var index = ").concat(s.indicesGet("indices",a),";\n    let output_number = calculateOutputIndex(index);\n    if (output_number != 0) {\n      index -= ").concat(wn("uniforms.size_in_split_axis","output_number - 1u",c.length),";\n      ").concat(s.indicesSet("indices",a,"index"),";\n    }\n    writeBufferData(output_number, indices, global_idx);\n  }"),getRunData:()=>({outputs:l,dispatchGroup:{x:Math.ceil(r/64)},programUniforms:h})}},ys=(e,t)=>{hs(e.inputs);let n=1===e.inputs.length?t:fs(e.inputs,t);e.compute(gs(e.inputs,n),{inputs:[0]})},vs=e=>{let t=e.axis,n=e.splitSizes,r=e.numOutputs<0?n.length:e.numOutputs;if(r!==n.length)throw new Error("numOutputs and splitSizes length must be equal");return ln({axis:t,numOutputs:r,splitSizes:n})}}),mu=re(()=>{El(),Tl(),Rl(),Pl(),ws=(e,t)=>{let[n,r,i,a]=e,{numHeads:o,rotaryEmbeddingDim:s}=t;if(3!==n.dims.length&&4!==n.dims.length)throw new Error("Input 'x' is expected to have 3 or 4 dimensions, got ".concat(n.dims.length));if(!Rt.areEqual(r.dims,[])&&!Rt.areEqual(r.dims,[1])&&2!==r.dims.length)throw new Error("Input 'position_ids' is expected to have 0, 1, or 2 dimensions, got ".concat(r.dims.length));if(2!==i.dims.length)throw new Error("Input 'cos_cache' is expected to have 2 dimensions, got ".concat(i.dims.length));if(2!==a.dims.length)throw new Error("Input 'sin_cache' is expected to have 2 dimensions, got ".concat(a.dims.length));if(!Rt.areEqual(i.dims,a.dims))throw new Error("Inputs 'cos_cache' and 'sin_cache' are expected to have the same shape");if(s>0&&0===o)throw new Error("num_heads must be provided if rotary_embedding_dim is specified");let c=n.dims[0],l=n.dims[n.dims.length-2],u=i.dims[0],d=Rt.sizeFromDimension(n.dims,1)/l,h=0===s?2*i.dims[1]:d/o;if(s>h)throw new Error("rotary_embedding_dim must be less than or equal to head_size");if(2===r.dims.length){if(c!==r.dims[0])throw new Error("Input 'position_ids' dimension 0 should be of size batch_size, got ".concat(r.dims[0]));if(l!==r.dims[1])throw new Error("Input 'position_ids' dimension 1 should be of size sequence_length, got ".concat(r.dims[1]))}if(h/2!==i.dims[1]&&s/2!==i.dims[1])throw new Error("Input 'cos_cache' dimension 1 should be same as head_size / 2 or rotary_embedding_dim / 2, got ".concat(i.dims[1]));if(l>u)throw new Error("Updating cos_cache and sin_cache in RotaryEmbedding is not currently supported")},bs=(e,t)=>{let{interleaved:n,numHeads:r,rotaryEmbeddingDim:i,scale:a}=t,o=e[0].dims[0],s=Rt.sizeFromDimension(e[0].dims,1),c=e[0].dims[e[0].dims.length-2],l=s/c,u=e[2].dims[1],d=0===i?2*u:l/r,h=new Array(o,c,l/d,d-u),f=Rt.computeStrides(h),p=[{type:1,data:a},{type:12,data:h},{type:12,data:f},...3===e[0].dims.length?new Array({type:12,data:[s,l,d,1]}):[],...4===e[0].dims.length?new Array({type:12,data:[s,d,c*d,1]}):[],...pn(e[0].dims,e[1].dims,e[2].dims,e[3].dims,e[0].dims)];return{name:"RotaryEmbedding",shaderCache:{hint:ln({interleaved:n}).cacheKey,inputDependencies:["rank","rank","rank","rank"]},getShaderSource:t=>{let r=_n("input",e[0].dataType,e[0].dims.length),i=_n("position_ids",e[1].dataType,e[1].dims.length),a=_n("cos_cache",e[2].dataType,e[2].dims.length),o=_n("sin_cache",e[3].dataType,e[3].dims.length),s=xn("output",e[0].dataType,e[0].dims.length);return t.registerUniforms([{name:"scale",type:"f32"},{name:"global_shape",type:"u32",length:h.length},{name:"global_strides",type:"u32",length:f.length},{name:"input_output_strides",type:"u32",length:f.length}]),"\n        ".concat(t.declareVariables(r,i,a,o,s),"\n\n        ").concat(t.mainStart(un),"\n          let half_rotary_emb_dim = uniforms.").concat(a.name,"_shape[1];\n          let bsnh = global_idx / uniforms.global_strides % uniforms.global_shape;\n          let size = uniforms.global_shape[0] * uniforms.global_strides[0];\n          ").concat(t.guardAgainstOutOfBoundsWorkgroupSizes("size"),"\n\n          if (bsnh[3] < half_rotary_emb_dim) {\n            let position_ids_idx =\n                ").concat(i.broadcastedIndicesToOffset("bsnh.xy",xn("",i.type.tensor,2)),";\n            let position_id =\n                u32(").concat(i.getByOffset("position_ids_idx"),") + select(0, bsnh[1], position_ids_idx == 0);\n            let i = dot(bsnh, uniforms.input_output_strides) + select(0, bsnh[3], ").concat(n,");\n            let j = i + select(half_rotary_emb_dim, 1, ").concat(n,");\n            let re = ").concat(r.getByOffset("i")," * ").concat(a.get("position_id","bsnh[3]")," -\n                ").concat(r.getByOffset("j")," * ").concat(o.get("position_id","bsnh[3]"),";\n            ").concat(s.setByOffset("i","re"),"\n            let im = ").concat(r.getByOffset("i")," * ").concat(o.get("position_id","bsnh[3]")," +\n                ").concat(r.getByOffset("j")," * ").concat(a.get("position_id","bsnh[3]"),";\n            ").concat(s.setByOffset("j","im"),"\n          } else {\n            let k = dot(bsnh, uniforms.input_output_strides) + half_rotary_emb_dim;\n            ").concat(s.setByOffset("k",r.getByOffset("k")),"\n          }\n        }")},getRunData:()=>({outputs:[{dims:e[0].dims,dataType:e[0].dataType}],dispatchGroup:{x:Math.ceil(Rt.size(h)/un)},programUniforms:p})}},_s=(e,t)=>{ws(e.inputs,t),e.compute(bs(e.inputs,t))}}),gu=re(()=>{Rl(),El(),Ul(),fu(),pu(),Dl(),mu(),Pl(),xs=(e,t)=>{if(t.doRotary&&e.length<=7)throw new Error("cos_cache and sin_cache inputs are required if do_rotary is specified");let n=e[0],r=e[1],i=e[2],a=e[3],o=e[4];if(0!==t.doRotary&&e.length<=7)throw new Error("cos_cast and sin_cache are expected if do_rotary attribute is non-zero");if(-1!==t.localWindowSize)throw new Error("Local attention is not supported");if(0!==t.softcap)throw new Error("Softcap is not supported");if(0!==t.rotaryInterleaved)throw new Error("Rotary interleaved is not supported");if(t.smoothSoftmax)throw new Error("Smooth softmax is not supported");if(3!==n.dims.length&&5!==n.dims.length)throw new Error("Input query is expected to have 3 or 5 dimensions");let s=n.dims[0],c=n.dims[1],l=3===n.dims.length?n.dims[2]:t.numHeads*n.dims[4],u=c,d=0,h=!r||0===r.dims.length,f=Math.floor(h?l/(t.numHeads+2*t.kvNumHeads):l/t.numHeads);h&&(l=f*t.numHeads);let p=a&&0!==a.dims.length,m=o&&0!==o.dims.length;if(p&&4===a.dims.length&&a.dims[0]===s&&a.dims[1]!==t.kvNumHeads&&a.dims[2]===t.kvNumHeads&&a.dims[3]===f)throw new Error("BSNH pastKey/pastValue is not supported");if(p&&m){if(4!==a.dims.length)throw new Error('Input "past_key" is expected to have 4 dimensions');if(4!==o.dims.length)throw new Error('Input "past_value" is expected to have 4 dimensions');d=a.dims[2]}else if(p||m)throw new Error('Input "past_key" and "past_value" shall be both present or both absent');let g=1;if(r&&r.dims.length>0){if(3!==n.dims.length)throw new Error('Input "query" is expected to have 3 dimensions when key is given');if(r.dims.length<3||r.dims.length>5)throw new Error('Input "key" is expected to have 3, 4, or 5 dimensions');if(n.dims[0]!==r.dims[0])throw new Error('Input "query" and "key" shall have same dim 0 (batch size)');if(3===r.dims.length){if(n.dims[2]%r.dims[2]!==0)throw new Error('Dimension 2 of "query" should be a multiple of "key"');u=r.dims[1]}else if(5===r.dims.length){if(r.dims[2]!==t.numHeads||2!==r.dims[3]||r.dims[4]!==f)throw new Error('Expect "key" shape (batch_size, kv_sequence_length, num_heads, 2, head_size) for packed kv');if(i)throw new Error('Expect "value" be none when "key" has packed kv format.');u=r.dims[1]}else{if(r.dims[1]!==t.numHeads||r.dims[3]!==f)throw new Error('Expect "key" shape (batch_size, num_heads, kv_sequence_length, head_size) for past_key');u=r.dims[2]}}else{if(3!==n.dims.length&&5!==n.dims.length)throw new Error('Input "query" is expected to have 3 or 5 dimensions when key is empty');if(5===n.dims.length&&(n.dims[2]!==t.numHeads||3!==n.dims[3]))throw new Error('Expect "query" shape (batch_size, kv_sequence_length, num_heads, 3, head_size) for packed kv');g=3}let y=!1,v=t.kvNumHeads?f*t.kvNumHeads:l;if(i&&i.dims.length>0){if(3!==i.dims.length&&4!==i.dims.length)throw new Error('Input "value" is expected to have 3 or 4 dimensions');if(n.dims[0]!==i.dims[0])throw new Error('Input "query" and "value" shall have same dim 0 (batch_size)');if(3===i.dims.length){if(u!==i.dims[1])throw new Error('Input "key" and "value" shall have the same dim 1 (kv_sequence_length)');v=i.dims[2]}else{if(u!==i.dims[2])throw new Error('Input "past_key" and "past_value" shall have the same dim 2 (kv_sequence_length)');v=i.dims[1]*i.dims[3],y=!0}}let w=e.length>4?e[5]:void 0;if(w&&1!==w.dims.length&&w.dims[0]!==s)throw new Error('Input "seqlens" is expected to have 1 dimension and the same dim 0 as batch_size');return{batchSize:s,sequenceLength:c,pastSequenceLength:d,kvSequenceLength:u,totalSequenceLength:-1,maxSequenceLength:-1,inputHiddenSize:0,hiddenSize:l,vHiddenSize:v,headSize:f,vHeadSize:Math.floor(v/t.kvNumHeads),numHeads:t.numHeads,kvNumHeads:t.kvNumHeads,nReps:t.numHeads/t.kvNumHeads,pastPresentShareBuffer:!1,maskType:0,scale:t.scale,broadcastResPosBias:!1,passPastInKv:y,qkvFormat:g}},Es=ln({perm:[0,2,1,3]}),Ss=(e,t,n)=>{let r=t,i=n.kvNumHeads;return 3===t.dims.length&&0!==n.kvSequenceLength&&(r=t.reshape([n.batchSize,n.kvSequenceLength,i,n.headSize]),r=e.compute(Pn(r,Es.perm),{inputs:[r],outputs:[-1]})[0]),r},ks=(e,t,n,r)=>{let i=[e*t],a=e*t,o=[{type:12,data:a},{type:12,data:t},{type:12,data:e}];return{name:"GeneratePositionIds",shaderCache:{hint:"".concat(e,";").concat(t),inputDependencies:["type","type"]},getRunData:()=>({outputs:[{dims:i,dataType:7}],dispatchGroup:{x:Math.ceil(a/64)},programUniforms:o}),getShaderSource:e=>{let t=_n("seq_lens",n.dataType,n.dims),a=_n("total_seq_lens",r.dataType,r.dims),o=xn("pos_ids",7,i);return"\n  ".concat(e.registerUniforms([{name:"output_size",type:"u32"},{name:"sequence_length",type:"u32"},{name:"batch_size",type:"u32"}]).declareVariables(t,a,o),"\n  ").concat(e.mainStart(),"\n    ").concat(e.guardAgainstOutOfBoundsWorkgroupSizes("uniforms.output_size"),"\n    let total_sequence_length = u32(").concat(a.getByOffset("0"),");\n    let is_subsequent_prompt = uniforms.sequence_length > 1 && uniforms.sequence_length != total_sequence_length;\n    let is_first_prompt = !is_subsequent_prompt && uniforms.sequence_length == total_sequence_length;\n    let batch_idx = global_idx / uniforms.sequence_length;\n    let sequence_idx = i32(global_idx % uniforms.sequence_length);\n    var pos_id: i32 = 0;\n    let seqlen = ").concat(t.getByOffset("batch_idx"),";\n    let total_seqlen = seqlen + 1;\n    if (is_first_prompt) {\n      if (sequence_idx < total_seqlen) {\n        pos_id = sequence_idx;\n      } else {\n        pos_id = 1;\n      }\n      ").concat(o.setByOffset("global_idx","pos_id"),"\n    } else if (is_subsequent_prompt) {\n      let past_seqlen = total_seqlen - i32(uniforms.sequence_length);\n      if (past_seqlen + sequence_idx < total_seqlen) {\n        pos_id = past_seqlen + sequence_idx;\n      } else {\n        pos_id = 1;\n      }\n      ").concat(o.setByOffset("global_idx","pos_id"),"\n    } else if (global_idx < uniforms.batch_size) {\n      ").concat(o.setByOffset("global_idx","seqlen"),"\n    };\n  }\n  ")}}},Ts=(e,t)=>{var n;let r=xs(e.inputs,t);if(5===e.inputs[0].dims.length)throw new Error("Packed QKV is not implemented");if(5===(null===(n=e.inputs[1])||void 0===n?void 0:n.dims.length))throw new Error("Packed KV is not implemented");let i,a,o=e.inputs[0],s=e.inputs[1]&&e.inputs[1].dims.length>0?e.inputs[1]:void 0,c=e.inputs[2]&&e.inputs[2].dims.length>0?e.inputs[2]:void 0,l=e.inputs[3]&&0!==e.inputs[3].dims.length?e.inputs[3]:void 0,u=e.inputs[4]&&0!==e.inputs[4].dims.length?e.inputs[4]:void 0,d=e.inputs.length>4?e.inputs[5]:void 0,h=e.inputs.length>5?e.inputs[6]:void 0,f=r.kvNumHeads?r.kvNumHeads:r.numHeads,p=ln({axis:2,numOutputs:3,splitSizes:[r.numHeads*r.headSize,f*r.headSize,f*r.headSize]}),[m,g,y]=s||c?[o,s,c]:e.compute(gs([o],p),{inputs:[o],outputs:[-1,-1,-1]});if(t.doRotary){let n=e.compute(ks(r.batchSize,r.sequenceLength,d,h),{inputs:[d,h],outputs:[-1]})[0],o=e.inputs[7],s=e.inputs[8],c=ln({interleaved:0!==t.rotaryInterleaved,numHeads:r.numHeads,rotaryEmbeddingDim:0,scale:t.scale}),l=[m,n,o,s],u=[-1];i=e.compute(bs(l,c),{inputs:l,outputs:u})[0],l.splice(0,1,g);let f=ln({interleaved:0!==t.rotaryInterleaved,numHeads:r.kvNumHeads,rotaryEmbeddingDim:0,scale:t.scale});a=e.compute(bs(l,f),{inputs:l,outputs:u})[0]}let v=us(e,r.batchSize,r.numHeads,r.sequenceLength,r.headSize,t.doRotary?i:m,void 0,0),w=Ss(e,t.doRotary?a:g,r),b=Ss(e,y,r);Ur(e,v,w,b,void 0,void 0,l,u,void 0,r,d,h)}}),yu=re(()=>{El(),Tl(),Dl(),Pl(),Is=(e,t,n,r,i,a,o,s)=>{let c=mn(a),l=1===c?"f32":"vec".concat(c,"f"),u=1===c?"vec2f":"mat2x".concat(c,"f"),d=i*o,h=64;1===d&&(h=256);let f=[i,o,a/c],p=[i,o,2],m=[];m.push(...pn(f,p));return e.compute({name:"InstanceNormComputeChannelScaleShift",shaderCache:{hint:"".concat(c,";").concat(s,";").concat(h),inputDependencies:["rank","type","type"]},getRunData:()=>({outputs:[{dims:p,dataType:1}],dispatchGroup:{x:d},programUniforms:m}),getShaderSource:e=>{let i=_n("x",t.dataType,3,c),a=[i,_n("scale",n.dataType,n.dims),_n("bias",r.dataType,r.dims),xn("output",1,3,2)];return"\n  var<workgroup> workgroup_shared : array<".concat(u,", ").concat(h,">;\n  const workgroup_size = ").concat(h,"u;\n  ").concat(e.declareVariables(...a),"\n  ").concat(e.mainStart(h),"\n    let batch = workgroup_index / uniforms.x_shape[1];\n    let channel = workgroup_index % uniforms.x_shape[1];\n    let hight = uniforms.x_shape[2];\n    // initialize workgroup memory\n    var sum = ").concat(l,"(0);\n    var squared_sum = ").concat(l,"(0);\n    for (var h = local_idx; h < hight; h += workgroup_size) {\n      let value = ").concat(l,"(").concat(i.get("batch","channel","h"),");\n      sum += value;\n      squared_sum += value * value;\n    }\n    workgroup_shared[local_idx] = ").concat(u,"(sum, squared_sum);\n    workgroupBarrier();\n\n    for (var currSize = workgroup_size >> 1;  currSize > 0; currSize = currSize >> 1) {\n      if (local_idx < currSize) {\n        workgroup_shared[local_idx] = workgroup_shared[local_idx] + workgroup_shared[local_idx + currSize];\n      }\n      workgroupBarrier();\n    }\n    if (local_idx == 0) {\n      let sum_final = ").concat(vn("workgroup_shared[0][0]",c)," / f32(hight * ").concat(c,");\n      let squared_sum_final = ").concat(vn("workgroup_shared[0][1]",c)," / f32(hight * ").concat(c,");\n\n      let inv_std_dev = inverseSqrt(squared_sum_final - sum_final * sum_final + f32(").concat(s,"));\n      let channel_scale = inv_std_dev * f32(scale[channel]);\n      let channel_shift = f32(bias[channel]) - sum_final * channel_scale;\n      output[workgroup_index] = vec2f(channel_scale, channel_shift);\n    }\n  }")}},{inputs:[t,n,r],outputs:[-1]})[0]},Cs=(e,t,n)=>{let r=t[0].dims,i=r,a=r[0],o=r[1],s=Rt.sizeFromDimension(r,2),c=mn(s),l=Rt.size(i)/c,u=Is(e,t[0],t[1],t[2],a,s,o,n.epsilon),d=[a,o,s/c],h=[a,o];e.compute({name:"InstanceNormalization",shaderCache:{hint:"".concat(c),inputDependencies:["type","none"]},getRunData:()=>({outputs:[{dims:i,dataType:t[0].dataType}],dispatchGroup:{x:Math.ceil(l/64)},programUniforms:[{type:12,data:l},...pn(d,h,d)]}),getShaderSource:e=>{let n=_n("x",t[0].dataType,d.length,c),r=_n("scale_shift",1,h.length,2),i=xn("output",t[0].dataType,d.length,c),a=[n,r,i];return"\n  ".concat(e.registerUniform("output_size","u32").declareVariables(...a),"\n  ").concat(e.mainStart(),"\n  ").concat(e.guardAgainstOutOfBoundsWorkgroupSizes("uniforms.output_size"),"\n      let outputIndices = ").concat(i.offsetToIndices("global_idx"),";\n      let batch = outputIndices[0];\n      let channel = outputIndices[1];\n      let scale_shift = ").concat(r.getByIndices("vec2<u32>(batch, channel)"),";\n      let value = ").concat(n.getByOffset("global_idx")," * ").concat(i.type.value,"(scale_shift.x) + ").concat(i.type.value,"(scale_shift.y);\n      ").concat(i.setByOffset("global_idx","value"),";\n  }")}},{inputs:[t[0],u]})},As=(e,t,n)=>{let r=t[0].dims,i=r,a=r[0],o=r[r.length-1],s=Rt.sizeFromDimension(r,1)/o,c=mn(o),l=Rt.size(i)/c,u=[{type:12,data:s},{type:12,data:Math.floor(o/c)}],d=!1,h=[0,r.length-1];for(let m=0;m<r.length-2;m++)d=d||1!==r[m+1],h.push(m+1);d=d&&1!==r[r.length-1];let f=d?e.compute(Pn(e.inputs[0],h),{inputs:[e.inputs[0]],outputs:[-1]})[0]:e.inputs[0].reshape(Array.from({length:r.length},(e,t)=>r[h[t]])),p=Is(e,f,t[1],t[2],a,s,o,n.epsilon);e.compute({name:"InstanceNormalizationNHWC",shaderCache:{hint:"".concat(c),inputDependencies:["type","type"]},getRunData:()=>({outputs:[{dims:i,dataType:t[0].dataType}],dispatchGroup:{x:Math.ceil(l/64)},programUniforms:u}),getShaderSource:e=>{let n=hn(t[0].dataType),r=1===c?"vec2f":"mat".concat(c,"x2f"),a=e=>{let t=0===e?"x":"y",r=1===c?"f32":"vec".concat(c,"f");switch(c){case 1:return"".concat(n,"(").concat(r,"(scale.").concat(t,"))");case 2:return"vec2<".concat(n,">(").concat(r,"(scale[0].").concat(t,", scale[1].").concat(t,"))");case 4:return"vec4<".concat(n,">(").concat(r,"(scale[0].").concat(t,", scale[1].").concat(t,", scale[2].").concat(t,", scale[3].").concat(t,"))");default:throw new Error("Not supported compoents ".concat(c))}},o=_n("input",t[0].dataType,t[0].dims,c),s=xn("output",t[0].dataType,i,c);return"\n  @group(0) @binding(0) var<storage, read> input : array<".concat(o.type.storage,">;\n  @group(0) @binding(1) var<storage, read> scale_input : array<").concat(r,">;\n  @group(0) @binding(2) var<storage, read_write> output : array<").concat(s.type.storage,">;\n  struct Uniforms {H: u32, C : u32};\n  @group(0) @binding(3) var<uniform> uniforms: Uniforms;\n\n  ").concat(e.mainStart(),"\n    let current_image_number = global_idx / (uniforms.C * uniforms.H);\n    let current_channel_number = global_idx % uniforms.C;\n\n    let scale_offset = current_image_number * uniforms.C + current_channel_number;\n    let scale = scale_input[scale_offset];\n    output[global_idx] = fma(input[global_idx], ").concat(a(0),", ").concat(a(1),");\n  }")}},{inputs:[t[0],p]})},Os=(e,t)=>{"NHWC"===t.format?As(e,e.inputs,t):Cs(e,e.inputs,t)}}),vu=re(()=>{El(),Tl(),Pl(),Ns=e=>{if(!e||e.length<2)throw new Error("layerNorm requires at least 2 inputs.")},Rs=(e,t,n)=>{let r=t.simplified,i=e[0].dims,a=e[1],o=!r&&e[2],s=i,c=Rt.normalizeAxis(t.axis,i.length),l=Rt.sizeToDimension(i,c),u=Rt.sizeFromDimension(i,c),d=Rt.size(a.dims),h=o?Rt.size(o.dims):0;if(d!==u||o&&h!==u)throw new Error("Size of X.shape()[axis:] == ".concat(u,".\n       Size of scale and bias (if provided) must match this.\n       Got scale size of ").concat(d," and bias size of ").concat(h));let f=[];for(let b=0;b<i.length;++b)b<c?f.push(i[b]):f.push(1);let p=mn(u),m=["type","type"],g=[{type:12,data:l},{type:1,data:u},{type:12,data:Math.floor(u/p)},{type:1,data:t.epsilon}];o&&m.push("type");let y=n>1,v=n>2,w=[{dims:s,dataType:e[0].dataType}];return y&&w.push({dims:f,dataType:1}),v&&w.push({dims:f,dataType:1}),{name:"LayerNormalization",shaderCache:{hint:"".concat(p,";").concat(n,";").concat(r),inputDependencies:m},getRunData:()=>({outputs:w,dispatchGroup:{x:Math.ceil(l/64)},programUniforms:g}),getShaderSource:t=>{let n=hn(e[0].dataType),i=[_n("x",e[0].dataType,e[0].dims,p),_n("scale",a.dataType,a.dims,p)];o&&i.push(_n("bias",o.dataType,o.dims,p)),i.push(xn("output",e[0].dataType,s,p)),y&&i.push(xn("mean_data_output",1,f)),v&&i.push(xn("inv_std_output",1,f));return"\n  ".concat(t.registerUniforms([{name:"norm_count",type:"u32"},{name:"norm_size",type:"f32"},{name:"norm_size_vectorized",type:"u32"},{name:"epsilon",type:"f32"}]).declareVariables(...i),"\n  ").concat(t.mainStart(),"\n    ").concat(t.guardAgainstOutOfBoundsWorkgroupSizes("uniforms.norm_count"),"\n    let offset = global_idx * uniforms.norm_size_vectorized;\n    var mean_vector = ").concat(gn("f32",p),";\n    var mean_square_vector = ").concat(gn("f32",p),";\n\n    for (var h: u32 = 0u; h < uniforms.norm_size_vectorized; h++) {\n      let value = ").concat(yn(n,p,"x[h + offset]"),";\n      mean_vector += value;\n      mean_square_vector += value * value;\n    }\n    let mean = ").concat(vn("mean_vector",p)," / uniforms.norm_size;\n    let inv_std_dev = inverseSqrt(").concat(vn("mean_square_vector",p)," / uniforms.norm_size ").concat(r?"":"- mean * mean"," + uniforms.epsilon);\n\n    for (var j: u32 = 0; j < uniforms.norm_size_vectorized; j++) {\n      let f32input = ").concat(yn(n,p,"x[j + offset]"),";\n      let f32scale = ").concat(yn(n,p,"scale[j]"),";\n      output[j + offset] = ").concat(i[0].type.value,"((f32input ").concat(r?"":"- mean",") * inv_std_dev * f32scale\n        ").concat(o?"+ ".concat(yn(n,p,"bias[j]")):"","\n      );\n    }\n\n    ").concat(y?"mean_data_output[global_idx] = mean":"",";\n    ").concat(v?"inv_std_output[global_idx] = inv_std_dev":"",";\n  }")}}},Ps=(e,t)=>{Ns(e.inputs),e.compute(Rs(e.inputs,t,e.outputCount))}}),wu=re(()=>{Tl(),Ql(),Xl(),Ds=e=>{if(!e||2!==e.length)throw new Error("MatMul requires 2 inputs.");if(e[0].dims[e[0].dims.length-1]!==e[1].dims[e[1].dims.length-2])throw new Error("shared dimension does not match.")},zs=e=>{Ds(e.inputs);let t=Nt.calcShape(e.inputs[0].dims,e.inputs[1].dims,!0);if(!t)throw new Error("Can't use matmul on the given tensors");let n=t[t.length-1],r=e.inputs[0].dims[e.inputs[0].dims.length-1];if(n<8&&r<8)e.compute(ma(e.inputs,{activation:""},t));else{let i=t[t.length-2],a=Rt.size(e.inputs[0].dims.slice(0,-2)),o=Rt.size(e.inputs[1].dims.slice(0,-2));if(1!==a&&1===i&&1===o){let i=[1,a,n],o=[e.inputs[0].reshape([1,a,r]),e.inputs[1].reshape([1,r,n])];e.compute(Ea(o,{activation:""},t,i),{inputs:o})}else e.compute(Ea(e.inputs,{activation:""},t))}}}),bu=re(()=>{El(),Tl(),Rl(),Pl(),Ms=(e,t)=>{if(e.length<3||e.length>4)throw new Error("MatMulNBits requires 3 or 4 inputs");let n=e[0],r=n.dims.length;if(n.dims[r-1]!==t.k)throw new Error("The last dim of input shape does not match the k value");let i=Math.floor((t.k+t.blockSize-1)/t.blockSize),a=t.blockSize/8*t.bits,o=e[1];if(!Rt.areEqual(o.dims,[t.n,i,a]))throw new Error("The second inputs must be 3D tensor with shape N X nBlocksPerCol X blobSize");let s=e[2].dims;if(Rt.size(s)!==t.n*i)throw new Error("scales input size error.");if(4===e.length){let n=e[3].dims,r=t.n*(8===t.bits?i:Math.floor((i*t.bits+7)/8));if(Rt.size(n)!==r)throw new Error("zeroPoints input size error.")}},Ls=(e,t)=>{let n=e[0].dims,r=n.length,i=n[r-2],a=t.k,o=t.n,s=n.slice(0,r-2),c=Rt.size(s),l=e[1].dims[2]/4,u=e[0].dataType,d=mn(t.k),h=mn(l),f=mn(o),p=s.concat([i,o]),m=i>1&&o/f%2===0?2:1,g=Rt.size(p)/f/m,y=64,v=[],w=[c,i,a/d],b=Rt.convertShape(e[1].dims).slice();b.splice(-1,1,l/h),v.push(...pn(w)),v.push(...pn(b)),v.push(...pn(e[2].dims)),4===e.length&&v.push(...pn(Rt.convertShape(e[3].dims)));let _=[c,i,o/f];v.push(...pn(_));return{name:"MatMulNBits",shaderCache:{hint:"".concat(t.blockSize,";").concat(t.bits,";").concat(d,";").concat(h,";").concat(f,";").concat(m,";").concat(y),inputDependencies:Array(e.length).fill("rank")},getRunData:()=>({outputs:[{dims:p,dataType:u}],dispatchGroup:{x:g},programUniforms:v}),getShaderSource:n=>{let r=w.length,i=_n("a",e[0].dataType,r,d),a=_n("b",12,b.length,h),o=_n("scales",e[2].dataType,e[2].dims.length),s=[i,a,o],c=4===e.length?_n("zero_points",12,e[3].dims.length):void 0;c&&s.push(c);let u=_.length,p=xn("output",e[0].dataType,u,f),g=hn(e[0].dataType),v=(()=>{switch(d){case 1:return"array<".concat(g,", 8>");case 2:return"mat4x2<".concat(g,">");case 4:return"mat2x4<".concat(g,">");default:throw new Error("".concat(d,"-component is not supported."))}})();return"\n        var<workgroup> workgroup_shared: array<".concat(p.type.value,", ").concat(m*y,">;\n        ").concat(n.declareVariables(...s,p),"\n        ").concat(n.mainStart([y,1,1]),"\n          let output_indices = ").concat(p.offsetToIndices("(global_idx / ".concat(y,") * ").concat(m)),";\n          let col = output_indices[2];\n          let row = output_indices[1];\n          let batch = output_indices[0];\n          let nBlocksPerCol = uniforms.b_shape[1];\n\n          for (var block = local_id.x; block < nBlocksPerCol; block += ").concat(y,") {\n            //process one block\n            var word_offset: u32 = block * ").concat(t.blockSize/d,";\n            ").concat((()=>{let e="\n            var col_index = col * ".concat(f,";\n            ").concat(c?"\n            let zero_point_bytes_per_col = (nBlocksPerCol + 1) / 2;\n            var zero_point_byte_count: u32;\n            var zero_point_word_index: u32;\n            var zero_point_byte_offset: u32;\n            let zero_point_nibble_offset: u32 = block & 0x1u;\n            var zero_point_bits_offset: u32;\n            var zero_point_word: u32;":"\n            // The default zero point is 8 for unsigned 4-bit quantization.\n            let zero_point = ".concat(g,"(8);"),"\n            ");for(let t=0;t<f*m;t++)e+="\n            let scale".concat(t," = ").concat(o.getByOffset("col_index * nBlocksPerCol + block"),";\n            ").concat(c?"\n            zero_point_byte_count = col_index * zero_point_bytes_per_col + (block >> 0x1u);\n            zero_point_word_index = zero_point_byte_count >> 0x2u;\n            zero_point_byte_offset = zero_point_byte_count & 0x3u;\n            zero_point_bits_offset = (zero_point_byte_offset << 3) + (zero_point_nibble_offset << 2);\n            zero_point_word = ".concat(c.getByOffset("zero_point_word_index")," >> zero_point_bits_offset;\n            let zero_point").concat(t," = ").concat(g,"((zero_point_word) & 0xFu);"):"","\n            col_index += 1;");return e})(),"\n            for (var word: u32 = 0; word < ").concat(l,"; word += ").concat(h,") {\n              ").concat((()=>{let e="col_index = col * ".concat(f,";");for(let t=0;t<f*m;t++)e+="\n            let b".concat(t,"_data = ").concat(a.getByIndices("".concat(a.type.indices,"(col_index, block, word)")),";\n            col_index += 1;");return e+="\n            var b_value: u32;\n            let b_mask: u32 = 0x0F0F0F0Fu;\n            var b_value_lower: vec4<u32>;\n            var b_value_upper: vec4<u32>;\n            var b_quantized_values: ".concat(v,";\n            var b_dequantized_values: ").concat(v,";"),e})(),"\n              for (var i: u32 = 0; i < ").concat(h,"; i++) {\n                ").concat((()=>{let e="\n          // reuse a data\n            var input_offset = ".concat(i.indicesToOffset("".concat(i.type.indices,"(batch, row, word_offset)")),";\n            var a_data: ").concat(v,";\n            for (var j: u32 = 0; j < ").concat(8/d,"; j++) {\n              a_data[j] = ").concat(i.getByOffset("input_offset"),";\n              input_offset++;\n            }\n          ");for(let t=0;t<f*m;t++)e+="\n            b_value = ".concat("b".concat(t,1===h?"_data":"_data[i]"),";\n            b_value_lower = unpack4xU8(b_value & b_mask);\n            b_value_upper = unpack4xU8((b_value >> 4) & b_mask);\n            b_quantized_values = ").concat(v,"(").concat(Array.from({length:4},(e,t)=>"".concat(g,"(b_value_lower[").concat(t,"]), ").concat(g,"(b_value_upper[").concat(t,"])")).join(", "),");\n            b_dequantized_values = ").concat(1===d?"".concat(v,"(").concat(Array.from({length:8},(e,n)=>"(b_quantized_values[".concat(n,"] - ").concat(c?"zero_point".concat(t):"zero_point",") * scale").concat(t)).join(", "),");"):"(b_quantized_values - ".concat(v,"(").concat(Array(8).fill("".concat(c?"zero_point".concat(t):"zero_point")).join(","),")) * scale").concat(t,";"),";\n            workgroup_shared[local_id.x * ").concat(m," + ").concat(Math.floor(t/f),"]").concat(f>1?"[".concat(t%f,"]"):""," += ").concat(Array.from({length:8/d},(e,t)=>"".concat(1===d?"a_data[".concat(t,"] * b_dequantized_values[").concat(t,"]"):"dot(a_data[".concat(t,"], b_dequantized_values[").concat(t,"])"))).join(" + "),";\n          ");return e})(),"\n                word_offset += ").concat(8/d,";\n              }\n            }\n          }\n          workgroupBarrier();\n\n          if (local_id.x < ").concat(m,") {\n            var output_value: ").concat(p.type.value," = ").concat(p.type.value,"(0);\n            var workgroup_shared_offset: u32 = local_id.x;\n            for (var b: u32 = 0u; b < ").concat(y,"u; b++) {\n              output_value += workgroup_shared[workgroup_shared_offset];\n              workgroup_shared_offset += ").concat(m,";\n            }\n            ").concat(p.setByIndices("".concat(p.type.indices,"(batch, row, col + local_id.x)"),"output_value"),";\n          }\n        }")}}},Us=(e,t)=>{let n=e[0].dims,r=n.length,i=n[r-2],a=t.k,o=t.n,s=n.slice(0,r-2),c=Rt.size(s),l=e[1].dims[2]/4,u=e[0].dataType,d=mn(t.k),h=mn(l),f=s.concat([i,o]),p=o%8===0?8:o%4===0?4:1,m=128/p,g=m*h*8,y=g/d,v=g/t.blockSize,w=Rt.size(f)/p,b=[],_=[c,i,a/d],x=Rt.convertShape(e[1].dims).slice();x.splice(-1,1,l/h),b.push(...pn(_)),b.push(...pn(x)),b.push(...pn(e[2].dims)),4===e.length&&b.push(...pn(Rt.convertShape(e[3].dims)));let E=[c,i,o];b.push(...pn(E));return{name:"BlockwiseMatMulNBits32",shaderCache:{hint:"".concat(t.blockSize,";").concat(d,";").concat(h,";").concat(m,";").concat(p),inputDependencies:Array(e.length).fill("rank")},getRunData:()=>({outputs:[{dims:f,dataType:u}],dispatchGroup:{x:w},programUniforms:b}),getShaderSource:n=>{let r=_.length,i=_n("a",e[0].dataType,r,d),a=_n("b",12,x.length,h),o=_n("scales",e[2].dataType,e[2].dims.length),s=[i,a,o],c=4===e.length?_n("zero_points",12,e[3].dims.length):void 0;c&&s.push(c);let l=E.length,u=xn("output",e[0].dataType,l),f=hn(e[0].dataType);return"\n        var<workgroup> sub_a: array<".concat(i.type.value,", ").concat(y,">;\n        var<workgroup> inter_results: array<array<").concat(u.type.value,", ").concat(m,">, ").concat(p,">;\n        ").concat(n.declareVariables(...s,u),"\n        ").concat(n.mainStart([m,p,1]),"\n          let output_indices = ").concat(u.offsetToIndices("workgroup_index * ".concat(p)),";\n          let col = output_indices[2];\n          let row = output_indices[1];\n          let batch = output_indices[0];\n          let n_blocks_per_col = uniforms.b_shape[1];\n          let num_tiles =  (n_blocks_per_col - 1) / ").concat(v," + 1;\n\n          // Loop over shared dimension.\n          for (var tile: u32 = 0; tile < num_tiles; tile += 1) {\n            let a_col_start = tile * ").concat(y,";\n            // load one tile A data into shared memory.\n            for (var a_offset = local_idx; a_offset < ").concat(y,"; a_offset += ").concat(128,")\n            {\n              let a_col = a_col_start + a_offset;\n              if (a_col < uniforms.a_shape[2])\n              {\n                sub_a[a_offset] = ").concat(i.getByIndices("".concat(i.type.indices,"(batch, row, a_col)")),";\n              } else {\n                sub_a[a_offset] = ").concat(i.type.value,"(0);\n              }\n            }\n            workgroupBarrier();\n\n            // each thread process one block\n            let b_row = col + local_id.y;\n            let block = tile * ").concat(v," + local_id.x;\n            ").concat(c?"\n            let zero_point_bytes_per_col = (n_blocks_per_col + 1) / 2;\n            let zero_point_byte_count = b_row * zero_point_bytes_per_col + (block >> 0x1u);\n            let zero_point_word_index = zero_point_byte_count >> 0x2u;\n            let zero_point_byte_offset = zero_point_byte_count & 0x3u;\n            let zero_point_nibble_offset: u32 = block & 0x1u;\n            let zero_point_bits_offset = (zero_point_byte_offset << 3) + (zero_point_nibble_offset << 2);\n            let zero_point_word = ".concat(c.getByOffset("zero_point_word_index")," >> zero_point_bits_offset;\n            let zero_point = ").concat(f,"((zero_point_word) & 0xFu);"):"\n            // The default zero point is 8 for unsigned 4-bit quantization.\n            let zero_point = ".concat(f,"(8);"),"\n            let scale = ").concat(o.getByOffset("b_row * n_blocks_per_col + block"),";\n            let b_data = ").concat(a.getByIndices("".concat(a.type.indices,"(b_row, block, 0)")),";\n            var word_offset = local_id.x * ").concat(t.blockSize/d,";\n            for (var i: u32 = 0; i < ").concat(h,"; i++) {\n              ").concat((()=>{switch(d){case 1:return"\n          let a_data0 = vec4<".concat(f,">(sub_a[word_offset], sub_a[word_offset + 1], sub_a[word_offset + 2], sub_a[word_offset + 3]);\n          let a_data1 = vec4<").concat(f,">(sub_a[word_offset + 4], sub_a[word_offset + 5], sub_a[word_offset + 6], sub_a[word_offset + 7]);");case 2:return"\n          let a_data0 = vec4<".concat(f,">(sub_a[word_offset], sub_a[word_offset + 1]);\n          let a_data1 = vec4<").concat(f,">(sub_a[word_offset + 2], sub_a[word_offset + 3]);");case 4:return"\n          let a_data0 = sub_a[word_offset];\n          let a_data1 = sub_a[word_offset + 1];";default:throw new Error("".concat(d,"-component is not supported."))}})(),"\n              let b_value = ").concat(1===h?"b_data":"b_data[i]",";\n              let b_value_lower = unpack4xU8(b_value & 0x0F0F0F0Fu);\n              let b_value_upper = unpack4xU8((b_value >> 4) & 0x0F0F0F0Fu);\n              let b_quantized_values = mat2x4<").concat(f,">(").concat(Array.from({length:4},(e,t)=>"".concat(f,"(b_value_lower[").concat(t,"]), ").concat(f,"(b_value_upper[").concat(t,"])")).join(", "),");\n              let b_dequantized_values = (b_quantized_values - mat2x4<").concat(f,">(").concat(Array(8).fill("zero_point").join(","),")) * scale;\n              inter_results[local_id.y][local_id.x] += ").concat(Array.from({length:2},(e,t)=>"".concat("dot(a_data".concat(t,", b_dequantized_values[").concat(t,"])"))).join(" + "),";\n              word_offset += ").concat(8/d,";\n            }\n            workgroupBarrier();\n          }\n\n          if (local_idx < ").concat(p,") {\n            var output_value: ").concat(u.type.value," = ").concat(u.type.value,"(0);\n            for (var b = 0u; b < ").concat(m,"; b++) {\n              output_value += inter_results[local_idx][b];\n            }\n            if (col + local_idx < uniforms.output_shape[2])\n            {\n              ").concat(u.setByIndices("".concat(u.type.indices,"(batch, row, col + local_idx)"),"output_value"),"\n            }\n          }\n        }")}}},Bs=(e,t)=>{Ms(e.inputs,t),32===t.blockSize&&e.adapterInfo.isVendor("intel")&&e.adapterInfo.isArchitecture("gen-12lp")?e.compute(Us(e.inputs,t)):e.compute(Ls(e.inputs,t))},Fs=e=>ln(e)}),_u=re(()=>{El(),Tl(),Pl(),js=e=>{if(!e||e.length<1)throw new Error("Too few inputs");if(1!==e[0].dataType&&10!==e[0].dataType)throw new Error("Input type must be float or float16.");if(e.length>=2){let t=2*e[0].dims.length===e[1].dims[0];if(4===e.length&&(t=2*e[3].dims[0]===e[1].dims[0]),!t)throw new Error("The pads should be a 1D tensor of shape [2 * input_rank] or [2 * num_axes].")}},Vs=(e,t,n)=>{let r="";for(let i=t-1;i>=0;--i)r+="\n            k = i32(".concat(e.indicesGet("indices",i),") - ").concat(wn("uniforms.pads",i,n),";\n            if (k < 0) {\n              break;\n            }\n            if (k >= i32(").concat(wn("uniforms.x_shape",i,t),")) {\n              break;\n            }\n            offset += k * i32(").concat(wn("uniforms.x_strides",i,t),");\n        ");return"\n          value = ".concat(e.type.value,"(uniforms.constant_value);\n          for (var i = 0; i < 1; i++) {\n            var offset = 0;\n            var k = 0;\n            ").concat(r,"\n            value = x[offset];\n          }\n      ")},qs=(e,t,n)=>{let r="";for(let i=t-1;i>=0;--i)r+="\n                k = i32(".concat(e.indicesGet("indices",i),") - ").concat(wn("uniforms.pads",i,n),";\n                if (k < 0) {\n                  k = -k;\n                }\n                {\n                  let _2n_1 = 2 * (i32(").concat(wn("uniforms.x_shape",i,t),") - 1);\n                  k = k % _2n_1;\n                  if(k >= i32(").concat(wn("uniforms.x_shape",i,t),")) {\n                    k = _2n_1 - k;\n                  }\n                }\n                offset += k * i32(").concat(wn("uniforms.x_strides",i,t),");\n            ");return"\n              var offset = 0;\n              var k = 0;\n              ".concat(r,"\n              value = x[offset];\n          ")},Hs=(e,t,n)=>{let r="";for(let i=t-1;i>=0;--i)r+="\n                k = i32(".concat(e.indicesGet("indices",i),") - ").concat(wn("uniforms.pads",i,n),";\n                if (k < 0) {\n                  k = 0;\n                }\n                if (k >= i32(").concat(wn("uniforms.x_shape",i,t),")) {\n                  k = i32(").concat(wn("uniforms.x_shape",i,t),") - 1;\n                }\n                offset += k * i32(").concat(wn("uniforms.x_strides",i,t),");\n            ");return"\n              var offset = 0;\n              var k = 0;\n              ".concat(r,"\n              value = x[offset];\n          ")},Ws=(e,t,n)=>{let r="";for(let i=t-1;i>=0;--i)r+="\n                k = i32(".concat(e.indicesGet("indices",i),") - ").concat(wn("uniforms.pads",i,n),";\n                if (k < 0)  {\n                  k += i32(").concat(wn("uniforms.x_shape",i,t),"]);\n                }\n                if (k >= i32(").concat(wn("uniforms.x_shape",i,t),")) {\n                  k -= i32(").concat(wn("uniforms.x_shape",i,t),");\n                }\n                offset += k * i32(").concat(wn("uniforms.x_strides",i,t),");\n            ");return"\n              var offset = 0;\n              var k = 0;\n              ".concat(r,"\n              value = x[offset];\n          ")},Gs=(e,t,n)=>{switch(n.mode){case 0:return Vs(e,t,n.pads.length);case 1:return qs(e,t,n.pads.length);case 2:return Hs(e,t,n.pads.length);case 3:return Ws(e,t,n.pads.length);default:throw new Error("Invalid mode")}},Ks=(e,t)=>{let n=Rt.padShape(e[0].dims.slice(),t.pads),r=e[0].dims,i=[{type:12,data:Rt.size(n)},{type:6,data:t.pads}],a=e.length>=3&&e[2].data;0===t.mode&&i.push({type:a?e[2].dataType:1,data:t.value}),i.push(...pn(e[0].dims,n));return{name:"Pad",shaderCache:{hint:"".concat(t.mode).concat(a),inputDependencies:["rank"]},getRunData:()=>({outputs:[{dims:n,dataType:e[0].dataType}],dispatchGroup:{x:Math.ceil(Rt.size(n)/64)},programUniforms:i}),getShaderSource:i=>{let o=xn("output",e[0].dataType,n.length),s=_n("x",e[0].dataType,r.length),c=s.type.value,l=Gs(o,r.length,t),u=[{name:"output_size",type:"u32"},{name:"pads",type:"i32",length:t.pads.length}];return 0===t.mode&&u.push({name:"constant_value",type:a?c:"f32"}),"\n            ".concat(i.registerUniforms(u).declareVariables(s,o),"\n            ").concat(i.mainStart(),"\n            ").concat(i.guardAgainstOutOfBoundsWorkgroupSizes("uniforms.output_size"),"\n\n            let indices = ").concat(o.offsetToIndices("global_idx"),";\n\n            var value = ").concat(c,"(0);\n            ").concat(l,"\n            output[global_idx] = value;\n        }")}}},Qs=(e,t)=>{if(e.length>1){let n=e[1].getBigInt64Array(),r=e.length>=3&&e[2].data?10===e[2].dataType?e[2].getUint16Array()[0]:e[2].getFloat32Array()[0]:0,i=e[0].dims.length,a=new Int32Array(2*i).fill(0);if(e.length>=4){let t=e[3].getBigInt64Array();for(let e=0;e<t.length;e++)a[Number(t[e])]=Number(n[e]),a[Number(t[e])+i]=Number(n[e+t.length])}else n.forEach((e,t)=>a[Number(t)]=Number(e));let o=[];return a.forEach(e=>o.push(e)),{mode:t.mode,value:r,pads:o}}return t},Xs=(e,t)=>{js(e.inputs);let n=Qs(e.inputs,t);e.compute(Ks(e.inputs,n),{inputs:[0]})}}),xu=re(()=>{ke(),El(),Tl(),Pl(),Ys=e=>{if(I.webgpu.validateInputContent&&(!e||1!==e.length))throw new Error("Pool ops requires 1 input.")},Js=(e,t,n)=>{let r="NHWC"===t.format,i=e.dims.slice();r&&i.splice(1,0,i.pop());let a=Object.hasOwnProperty.call(t,"dilations"),o=t.kernelShape.slice(),s=t.strides.slice(),c=a?t.dilations.slice():[],l=t.pads.slice();Pt.adjustPoolAttributes(n,i,o,s,c,l);let u=Pt.computePoolOutputShape(n,i,s,c,o,l,t.autoPad),d=Object.assign({},t);a?Object.assign(d,{kernelShape:o,strides:s,pads:l,dilations:c,cacheKey:t.cacheKey}):Object.assign(d,{kernelShape:o,strides:s,pads:l,cacheKey:t.cacheKey});let h=u.slice();return h.push(h.splice(1,1)[0]),[d,r?h:u]},$s=(e,t)=>{let n="NHWC"===t.format,r=[{type:12,data:Rt.size(e)},{type:12,data:Rt.size(t.kernelShape)}],i=[{name:"outputSize",type:"u32"},{name:"kernelSize",type:"u32"}];if(t.kernelShape.length<=2){let e=t.kernelShape[t.kernelShape.length-1],n=t.strides[t.strides.length-1],a=t.pads[t.pads.length/2-1],o=t.pads[t.pads.length-1],s=!!(a+o);r.push({type:12,data:e},{type:12,data:n},{type:12,data:a},{type:12,data:o}),i.push({name:"kw",type:"u32"},{name:"sw",type:"u32"},{name:"pwStart",type:"u32"},{name:"pwEnd",type:"u32"});let c=!1;if(2===t.kernelShape.length){let e=t.kernelShape[t.kernelShape.length-2],n=t.strides[t.strides.length-2],a=t.pads[t.pads.length/2-2],o=t.pads[t.pads.length-2];c=!!(a+o),r.push({type:12,data:e},{type:12,data:n},{type:12,data:a},{type:12,data:o}),i.push({name:"kh",type:"u32"},{name:"sh",type:"u32"},{name:"phStart",type:"u32"},{name:"phEnd",type:"u32"})}return[r,i,!0,s,c]}{if(n)throw new Error("Pooling with kernelShape.length > 2 is not supported for NHWC format.");let e=Rt.computeStrides(t.kernelShape);r.push({type:12,data:e},{type:12,data:t.pads},{type:12,data:t.strides}),i.push({name:"kernelStrides",type:"u32",length:e.length},{name:"pads",type:"u32",length:t.pads.length},{name:"strides",type:"u32",length:t.strides.length});let a=t.pads.reduce((e,t)=>e+t);return[r,i,!!a,!1,!1]}},Zs=(e,t,n,r,i,a,o,s,c,l,u,d)=>{let h="NHWC"===i.format,f=t.type.value,p=xn("output",t.type.tensor,r);if(i.kernelShape.length<=2){let r="",l="",m="",g=n-(h?2:1);if(r=u?"\n                for (var i: u32 = 0u; i < uniforms.kw; i++) {\n                  xIndices[".concat(g,"] = indices[").concat(g,"] * uniforms.sw - uniforms.pwStart + i;\n                  if (xIndices[").concat(g,"] < 0 || xIndices[").concat(g,"]\n                      >= uniforms.x_shape[").concat(g,"]) {\n                    pad++;\n                    continue;\n                  }\n                  let x_val = x[").concat(t.indicesToOffset("xIndices"),"];\n                  ").concat(a,"\n                }"):"\n                for (var i: u32 = 0u; i < uniforms.kw; i++) {\n                  xIndices[".concat(g,"] = indices[").concat(g,"] * uniforms.sw - uniforms.pwStart + i;\n                  let x_val = x[").concat(t.indicesToOffset("xIndices"),"];\n                  ").concat(a,"\n                }"),2===i.kernelShape.length){let e=n-(h?3:2);l=d?"\n                for (var j: u32 = 0u; j < uniforms.kh; j++) {\n                  xIndices[".concat(e,"] = indices[").concat(e,"] * uniforms.sh - uniforms.phStart + j;\n                  if (xIndices[").concat(e,"] < 0 || xIndices[").concat(e,"] >= uniforms.x_shape[").concat(e,"]) {\n                    pad += i32(uniforms.kw);\n                    continue;\n                  }\n              "):"\n                for (var j: u32 = 0u; j < uniforms.kh; j++) {\n                  xIndices[".concat(e,"] = indices[").concat(e,"] * uniforms.sh - uniforms.phStart + j;\n                "),m="\n              }\n            "}return"\n            ".concat(e.registerUniforms(c).declareVariables(t,p),"\n\n            ").concat(e.mainStart(),"\n              ").concat(e.guardAgainstOutOfBoundsWorkgroupSizes("uniforms.outputSize"),"\n\n              let indices = ").concat(p.offsetToIndices("global_idx"),";\n              var xIndices = ").concat(p.offsetToIndices("global_idx"),";\n\n              var value = ").concat(f,"(").concat(s,");\n              var pad = 0;\n              ").concat(l,"\n              ").concat(r,"\n              ").concat(m,"\n              ").concat(o,"\n\n              output[global_idx] = value;\n            }")}{if(h)throw new Error("Pooling with kernelShape.length > 2 is not supported for NHWC format.");let r=i.kernelShape.length,u=i.pads.length,d="";return d=l?"\n                if (xIndices[j] >= uniforms.x_shape[j]) {\n                  pad++;\n                  isPad = true;\n                  break;\n                }\n              }\n              if (!isPad) {\n                let x_val = x[".concat(t.indicesToOffset("xIndices"),"];\n                ").concat(a,"\n              }"):"\n              }\n              let x_val = x[".concat(t.indicesToOffset("xIndices"),"];\n              ").concat(a,"\n            "),"\n            ".concat(e.registerUniforms(c).declareVariables(t,p),"\n\n            ").concat(e.mainStart(),"\n              ").concat(e.guardAgainstOutOfBoundsWorkgroupSizes("uniforms.outputSize"),"\n              let indices = ").concat(p.offsetToIndices("global_idx"),";\n              var xIndices = ").concat(p.offsetToIndices("global_idx"),";\n\n              var offsets: array<u32, ").concat(r,">;\n\n              var value = ").concat(f,"(").concat(s,");\n              var pad = 0;\n              var isPad = false;\n\n              for (var i: u32 = 0u; i < uniforms.kernelSize; i++) {\n                var offset = i;\n                for (var j = 0u; j < ").concat(r-1,"u; j++) {\n                  offsets[j] = offset / ").concat(wn("uniforms.kernelStrides","j",r),";\n                  offset -= offsets[j] * ").concat(wn("uniforms.kernelStrides","j",r),";\n                }\n                offsets[").concat(r-1,"] = offset;\n\n                isPad = false;\n                for (var j = ").concat(n-r,"u; j < ").concat(n,"u; j++) {\n                  xIndices[j] = indices[j] * ").concat(wn("uniforms.strides","j - ".concat(n-r,"u"),r),"\n                    + offsets[j - ").concat(n-r,"u] - ").concat(wn("uniforms.pads","j - 2u",u),";\n                  ").concat(d,"\n              }\n              ").concat(o,"\n\n              output[global_idx] = value;\n            }")}},ec=e=>"".concat(e.format,";").concat(e.ceilMode,";").concat(e.autoPad,";").concat(e.kernelShape.length),tc=e=>"".concat(ec(e),";").concat(e.countIncludePad),nc=e=>"".concat(ec(e),";").concat(e.storageOrder,";").concat(e.dilations),rc=e=>({format:e.format,autoPad:["NOTSET","VALID","SAME_UPPER","SAME_LOWER"][e.auto_pad],ceilMode:e.ceil_mode,kernelShape:e.kernel_shape,strides:e.strides,pads:e.pads}),ic=(e,t,n,r)=>{let[i,a]=Js(t,r,n),o=_n("x",t.dataType,t.dims.length),s=o.type.value,c="";i.countIncludePad?c+="value /= ".concat(s,"(uniforms.kernelSize);"):c+="value /= ".concat(s,"(i32(uniforms.kernelSize) - pad);");let[l,u,d,h,f]=$s(a,i);l.push(...pn(t.dims,a));return{name:e,shaderCache:{hint:"".concat(r.cacheKey,";").concat(d,";").concat(h,";").concat(f),inputDependencies:["rank"]},getRunData:()=>({outputs:[{dims:a,dataType:t.dataType}],dispatchGroup:{x:Math.ceil(Rt.size(a)/64)},programUniforms:l}),getShaderSource:e=>Zs(e,o,t.dims.length,a.length,i,"value += x_val;",c,0,u,d,h,f)}},ac=e=>{let t=0!==e.count_include_pad,n=rc(e);if(0!==n.ceilMode)throw new Error("using ceil() in shape computation is not yet supported for AveragePool");let r=l(l({countIncludePad:t},n),{},{cacheKey:""});return l(l({},r),{},{cacheKey:tc(r)})},oc=(e,t)=>{Ys(e.inputs),e.compute(ic("AveragePool",e.inputs[0],!1,t))},sc={autoPad:"",ceilMode:0,countIncludePad:!1,kernelShape:[],strides:[],pads:[],storageOrder:0,dilations:[]},cc=e=>{let t=e.format;return l(l({format:t},sc),{},{cacheKey:t})},lc=(e,t)=>{Ys(e.inputs),e.compute(ic("GlobalAveragePool",e.inputs[0],!0,t))},uc=(e,t,n,r)=>{let[i,a]=Js(t,r,n),o=_n("x",t.dataType,t.dims.length),[s,c,l,u,d]=$s(a,i);return s.push(...pn(t.dims,a)),{name:e,shaderCache:{hint:"".concat(r.cacheKey,";").concat(l,";").concat(u,";").concat(d),inputDependencies:["rank"]},getRunData:()=>({outputs:[{dims:a,dataType:t.dataType}],dispatchGroup:{x:Math.ceil(Rt.size(a)/64)},programUniforms:s}),getShaderSource:e=>Zs(e,o,t.dims.length,a.length,i,"\n      value = max(x_val, value);\n    ","",10===t.dataType?-65504:-1e5,c,l,u,d)}},dc=(e,t)=>{Ys(e.inputs),e.compute(uc("MaxPool",e.inputs[0],!1,t))},hc=e=>{let t=e.storage_order,n=e.dilations,r=rc(e);if(0!==t)throw new Error("column major storage order is not yet supported for MaxPool");if(0!==r.ceilMode)throw new Error("using ceil() in shape computation is not yet supported for MaxPool");let i=l(l({storageOrder:t,dilations:n},r),{},{cacheKey:""});return l(l({},i),{},{cacheKey:nc(i)})},fc=e=>{let t=e.format;return l(l({format:t},sc),{},{cacheKey:t})},pc=(e,t)=>{Ys(e.inputs),e.compute(uc("GlobalMaxPool",e.inputs[0],!0,t))}}),Eu=re(()=>{El(),Tl(),Rl(),Pl(),mc=(e,t)=>{if(e.length<2||e.length>3)throw new Error("DequantizeLinear requires 2 or 3 inputs.");if(3===e.length&&e[1].dims===e[2].dims)throw new Error("x-scale and x-zero-point must have the same shape.");if(3===e.length&&e[0].dataType!==e[2].dataType)throw new Error("x and x-zero-point must have the same data type.");if(6===e[0].dataType&&e.length>2)throw new Error("In the case of dequantizing int32 there is no zero point.");if(0!==e[1].dims.length&&1!==e[1].dims.length&&e[1].dims.length!==e[0].dims.length)throw new Error("scale input must be a scalar, a 1D tensor, or have the same rank as the input tensor.");if(e.length>2){if(e[0].dataType!==e[2].dataType)throw new Error("x and x-zero-point must have the same data type.");if(e[1].dims.length!==e[2].dims.length)throw new Error("scale and zero-point inputs must have the same rank.");if(!e[1].dims.map((t,n)=>t===e[2].dims[n]).reduce((e,t)=>e&&t,!0))throw new Error("scale and zero-point inputs must have the same shape.")}if(t.blockSize>0){if(0===e[1].dims.length||1===e[1].dims.length&&1===e[1].dims[0])throw new Error("blockSize must be set only for block quantization.");if(!e[1].dims.map((n,r)=>r===t.axis||n===e[0].dims[r]).reduce((e,t)=>e&&t,!0))throw new Error("For block qunatization, scale input shape to match the input shape except for the axis");if(e[1].dims.length!==e[0].dims.length)throw new Error("For block qunatization the scale input rank must be the same as the x rank.");let n=e[0].dims[t.axis],r=e[1].dims[t.axis];if(t.blockSize<Math.ceil(n/r)||t.blockSize>Math.ceil(n/(r-1)-1))throw new Error("blockSize must be with in the range [ceil(dI / Si), ceil(dI / (Si - 1) - 1)].")}},gc=(e,t)=>{let n=Rt.normalizeAxis(t.axis,e[0].dims.length),r=e[0].dataType,i=3===r,a=e[0].dims,o=e[1].dataType,s=Rt.size(a),c=3===r||2===r,l=c?[Math.ceil(Rt.size(e[0].dims)/4)]:e[0].dims,u=e[1].dims,d=e.length>2?e[2]:void 0,h=d?c?[Math.ceil(Rt.size(d.dims)/4)]:d.dims:void 0,f=0===u.length||1===u.length&&1===u[0],p=!1===f&&1===u.length,m=mn(s),g=f&&(!c||4===m),y=g?m:1,v=g&&!c?m:1,w=_n("input",c?12:r,l.length,v),b=_n("scale",o,u.length),_=d?_n("zero_point",c?12:r,h.length):void 0,x=xn("output",o,a.length,y),E=[w,b];_&&E.push(_);let S=[l,u];d&&S.push(h);let k=[{type:12,data:s/y},{type:12,data:n},{type:12,data:t.blockSize},...pn(...S,a)];return{name:"DequantizeLinear",shaderCache:{hint:t.cacheKey,inputDependencies:_?["rank","rank","rank"]:["rank","rank"]},getShaderSource:e=>"\n      ".concat(e.registerUniforms([{name:"output_size",type:"u32"},{name:"axis",type:"u32"},{name:"block_size",type:"u32"}]).declareVariables(...E,x),"\n      ").concat(e.mainStart(),"\n          ").concat(e.guardAgainstOutOfBoundsWorkgroupSizes("uniforms.output_size"),"\n          let output_indices = ").concat(x.offsetToIndices("global_idx"),";\n\n          // Set input x\n          ").concat(c?"\n            let input = ".concat(w.getByOffset("global_idx / 4"),";\n            let x_vec = ").concat(i?"unpack4xI8(input)":"unpack4xU8(input)",";\n            let x_value = ").concat(1===y?"x_vec[global_idx % 4]":"x_vec",";"):"let x_value = ".concat(w.getByOffset("global_idx"),";"),";\n\n          // Set scale input\n          ").concat(f?"let scale_value= ".concat(b.getByOffset("0")):p?"\n            let scale_index = ".concat(x.indicesGet("output_indices","uniforms.axis"),";\n            let scale_value= ").concat(b.getByOffset("scale_index"),";"):"\n            var scale_indices: ".concat(b.type.indices," = output_indices;\n            let index = ").concat(b.indicesGet("scale_indices","uniforms.axis")," / uniforms.block_size;\n            ").concat(b.indicesSet("scale_indices","uniforms.axis","index"),";\n            let scale_value= ").concat(b.getByIndices("scale_indices"),";"),";\n\n          // Set zero-point input\n          ").concat(_?f?c?"\n                let zero_point_input = ".concat(_.getByOffset("0"),";\n                let zero_point_vec =  ").concat(i?"unpack4xI8(zero_point_input)":"unpack4xU8(zero_point_input)",";\n                let zero_point_value= zero_point_vec[0]"):"let zero_point_value = ".concat(_.getByOffset("0")):p?c?"\n                let zero_point_index = ".concat(x.indicesGet("output_indices","uniforms.axis"),";\n                let zero_point_input = ").concat(_.getByOffset("zero_point_index / 4"),";\n                let zero_point_vec =  ").concat(i?"unpack4xI8(zero_point_input)":"unpack4xU8(zero_point_input)",";\n                let zero_point_value = zero_point_vec[zero_point_index % 4]"):"\n                let zero_point_index = ".concat(x.indicesGet("output_indices","uniforms.axis"),";\n                let zero_point_value = ").concat(_.getByOffset("zero_point_index"),";"):c?"\n                let zero_point_offset = ".concat(b.indicesToOffset("scale_indices"),";\n                let zero_point_input = ").concat(_.getByOffset("zero_point_offset / 4"),";\n                let zero_point_vec = ").concat(i?"unpack4xI8(zero_point_input)":"unpack4xU8(zero_point_input)",";\n                let zero_point_value = zero_point_vec[zero_point_offset % 4];"):"let zero_point_value = ".concat(_.getByIndices("scale_indices"),";"):"let zero_point_value = ".concat(c?i?"i32":"u32":w.type.value,"(0);"),";\n      // Compute and write output\n      ").concat(x.setByOffset("global_idx","".concat(x.type.value,"(x_value - zero_point_value) * scale_value")),";\n      }"),getRunData:()=>({outputs:[{dims:a,dataType:o}],dispatchGroup:{x:Math.ceil(s/y/64),y:1,z:1},programUniforms:k})}},yc=(e,t)=>{mc(e.inputs,t),e.compute(gc(e.inputs,t))},vc=e=>ln({axis:e.axis,blockSize:e.blockSize})}),Su=re(()=>{ke(),El(),Pl(),wc=(e,t,n)=>{if(e===t||e<t&&n<0||e>t&&n>0)throw new Error("Range these inputs' contents are invalid.")},bc=(e,t,n,r)=>{let i=Math.abs(Math.ceil((t-e)/n)),a=[i],o=i,s=[{type:12,data:o},{type:r,data:e},{type:r,data:n},...pn(a)];return{name:"Range",shaderCache:{hint:"".concat(r)},getShaderSource:e=>{let t=xn("output",r,a.length),n=t.type.value,i=[{name:"outputSize",type:"u32"},{name:"start",type:n},{name:"delta",type:n}];return"\n        ".concat(e.registerUniforms(i).declareVariables(t),"\n        ").concat(e.mainStart(),"\n        ").concat(e.guardAgainstOutOfBoundsWorkgroupSizes("uniforms.outputSize"),"\n        output[global_idx] = uniforms.start + ").concat(n,"(global_idx) * uniforms.delta;\n      }")},getRunData:()=>({outputs:[{dims:a,dataType:r}],dispatchGroup:{x:Math.ceil(o/64)},programUniforms:s})}},_c=e=>{let t=0,n=0,r=0;6===e.inputs[0].dataType?(t=e.inputs[0].getInt32Array()[0],n=e.inputs[1].getInt32Array()[0],r=e.inputs[2].getInt32Array()[0]):1===e.inputs[0].dataType&&(t=e.inputs[0].getFloat32Array()[0],n=e.inputs[1].getFloat32Array()[0],r=e.inputs[2].getFloat32Array()[0]),I.webgpu.validateInputContent&&wc(t,n,r),e.compute(bc(t,n,r,e.inputs[0].dataType),{inputs:[]})}}),ku=re(()=>{El(),Tl(),Rl(),Pl(),xc=(e,t,n,r)=>{if("none"!==e&&"i32"!==r&&"u32"!==r&&"f32"!==r)throw new Error("Input ".concat(r," is not supported with reduction ").concat(e,"."));let i="{\n                var oldValue = 0;\n                loop {\n                  let newValueF32 =",a=";\n                  let newValue = bitcast<i32>(newValueF32);\n                  let res = atomicCompareExchangeWeak(&".concat(t,", oldValue, newValue);\n                  if res.exchanged {\n                    break;\n                  }\n                  oldValue = res.old_value;\n                }\n              }");switch(e){case"none":return"".concat(t,"=").concat(n,";");case"add":return"i32"===r||"u32"===r?"atomicAdd(&".concat(t,", bitcast<").concat(r,">(").concat(n,"));"):"\n              ".concat(i,"bitcast<").concat(r,">(oldValue) + (").concat(n,")").concat(a);case"max":return"i32"===r||"u32"===r?"atomicMax(&".concat(t,", bitcast<").concat(r,">(").concat(n,"));"):"\n                ".concat(i,"max(bitcast<f32>(oldValue), (").concat(n,"))").concat(a);case"min":return"i32"===r||"u32"===r?"atomicMin(&".concat(t,", bitcast<").concat(r,">(").concat(n,"));"):"".concat(i,"min(bitcast<").concat(r,">(oldValue), (").concat(n,"))").concat(a);case"mul":return"".concat(i,"(bitcast<").concat(r,">(oldValue) * (").concat(n,"))").concat(a);default:throw new Error("Reduction ".concat(e," is not supported."))}},Ec=(e,t)=>{let n=e[0].dims,r=e[1].dims,i=n,a=Math.ceil(Rt.sizeToDimension(r,r.length-1)/1),o=r[r.length-1],s=Rt.sizeFromDimension(n,o),c=[{type:12,data:a},{type:12,data:o},{type:12,data:s},...pn(e[1].dims,e[2].dims,i)];return{name:"ScatterND",shaderCache:{hint:"".concat(t.cacheKey,"_").concat(t.reduction),inputDependencies:["rank","rank"]},getRunData:()=>({outputs:[{dims:i,dataType:e[0].dataType}],dispatchGroup:{x:Math.ceil(a/64)},programUniforms:c}),getShaderSource:n=>{let r=_n("indices",e[1].dataType,e[1].dims.length),a=_n("updates",e[2].dataType,e[2].dims.length,1),o="none"!==t.reduction&&""!==t.reduction?En("output",e[0].dataType,i.length):xn("output",e[0].dataType,i.length,1);return"\n      ".concat(n.registerUniform("output_size","u32").registerUniform("last_index_dimension","u32").registerUniform("num_updates_elements","u32").declareVariables(r,a,o),"\n      ").concat(n.mainStart(),"\n        ").concat(n.guardAgainstOutOfBoundsWorkgroupSizes("uniforms.output_size"),"\n  var data_offset = 0u;\n  let indices_start = uniforms.last_index_dimension * global_idx;\n  let indices_end = indices_start + uniforms.last_index_dimension;\n  for (var i = indices_start; i < indices_end; i++) {\n    var index = i32(indices[i].x);\n    ").concat(1===e[0].dims.length?"\n    let element_count_dim = uniforms.output_strides;\n    let dim_value = uniforms.output_shape;":"\n    let element_count_dim = uniforms.output_strides[i - indices_start];\n    let dim_value = uniforms.output_shape[i - indices_start];","\n    if (index >= 0) {\n      if (index >= i32(dim_value)) {\n        index = i32(dim_value - 1);\n      }\n    } else {\n      if (index < -i32(dim_value)) {\n        index = 0;\n      } else {\n        index += i32(dim_value);\n      }\n    }\n    data_offset += u32((u32(index) * element_count_dim));\n  }\n\n  for (var i = 0u; i < uniforms.num_updates_elements; i++) {\n    let value = updates[uniforms.num_updates_elements * global_idx + i];\n    ").concat(xc(t.reduction,"output[data_offset + i]","value",o.type.value),"\n  }\n\n      }")}}},Sc=e=>ln({reduction:e.reduction}),kc=(e,t)=>{e.compute(Ec(e.inputs,t),{inputs:[e.inputs[1],e.inputs[2]],outputs:[]})}}),Tu=re(()=>{El(),Tl(),Rl(),Pl(),Tc=(e,t)=>{if(e.every(e=>e>0||(()=>{throw new Error("Resize requires scales input values to be positive")})),e.length>0)if("linear"===t.mode){if(!(2===e.length||3===e.length||4===e.length&&1===e[0]&&1===e[1]||4===e.length&&1===e[0]&&1===e[3]||5===e.length&&1===e[0]&&1===e[1]))throw new Error("For linear mode, Resize requires scales to be 2D, 3D, 4D with either two outermost or one innermost and\n            one outermost scale values equal to 1, or 5D with two outermost scale values equal to 1")}else if("cubic"===t.mode&&!(2===e.length||4===e.length&&1===e[0]&&1===e[1]||4===e.length&&1===e[0]&&1===e[3]))throw new Error("Resize requires scales input size to be 2 or 4 for cubic mode")},Ic=(e,t,n)=>{t.every(e=>e>=0&&e<n||(()=>{throw new Error("Resize requires axes input values to be positive and less than rank")}));let r=new Array(n).fill(1);return t.forEach((t,n)=>r[t]=e[n]),r},Cc=(e,t,n,r,i,a)=>{let[o,s,c]=n>10?[1,2,3]:[-1,e.length>1?1:-1,-1],l=e[0].dims.length;if(o>0&&e.length>o&&e[o].dims.length>0)e[o].getFloat32Array().forEach(e=>a.push(e));else if("tf_crop_and_resize"===t.coordinateTransformMode)throw new Error("Resize requires RoI input to be specified when coordinateTransformMode is tfCropAndResize");if(s>0&&e.length>s&&1===e[s].dims.length&&e[s].dims[0]>0){if(e[s].getFloat32Array().forEach(e=>r.push(e)),0!==r.length&&r.length!==l&&n>=18&&r.length!==t.axes.length)throw new Error("Resize requires scales input size to be same as input rank or axes size for opset 18 and up");Tc(r,t),t.axes.length>0&&Ic(r,t.axes,l).forEach((e,t)=>r[t]=e)}if(c>0&&e.length>c&&1===e[c].dims.length&&e[c].dims[0]>0&&(e[c].getBigInt64Array().forEach(e=>i.push(Number(e))),0!==i.length&&i.length!==l&&n>=18&&i.length!==t.axes.length))throw new Error("Resize requires sizes input size to be same as input rank or axes size for opset 18 and up");if(t.axes.length>0){if(0!==r.length&&r.length!==t.axes.length)throw new Error('Resize requires "scales" input size to be of axes rank when axes attributes is specified');if(0!==i.length&&i.length!==t.axes.length)throw new Error('Resize requires "sizes" input size to be of rank axes rank when axes attributes is specified')}if(typeof r<"u"&&typeof i<"u"&&r.length>0&&i.length>l)throw new Error("Resize requires only of scales or sizes to be specified")},Ac=(e,t,n,r)=>"\n  // The whole part and the fractional part are calculated separately due to inaccuracy of floating\n  // point division. As an example, f32(21) / f32(7) may evaluate to 2.99... instead of 3, causing an\n  // offset-by-one error later in floor().\n  let big = (".concat(e,") * (").concat(t,");\n  let whole = ").concat(r,"(big / (").concat(n,"));\n  let fract = ").concat(r,"(big % (").concat(n,")) / ").concat(r,"(").concat(n,");\n  return whole + fract;\n"),Oc=(e,t)=>"fn getOriginalCoordinateFromResizedCoordinate(xResized: u32, xScale: f32, lengthResized: u32,\n     lengthOriginal: u32, roiStart: f32, roiEnd: f32) -> ".concat(t," { ")+(()=>{switch(e){case"asymmetric":return"\n          if (xScale < 1.0 || floor(xScale) != xScale) {\n            return ".concat(t,"(xResized) / ").concat(t,"(xScale);\n          } else {\n            ").concat(Ac("xResized","lengthOriginal","lengthResized",t),"\n          }\n        ");case"pytorch_half_pixel":return"if (lengthResized > 1) {\n                    return (".concat(t,"(xResized) + 0.5) / ").concat(t,"(xScale) - 0.5;\n                  } else {\n                    return 0.0;\n                  }");case"tf_half_pixel_for_nn":return"return (".concat(t,"(xResized) + 0.5) / ").concat(t,"(xScale);");case"align_corners":return"if (lengthResized == 1) {\n                    return 0.0;\n                  } else {\n                    ".concat(Ac("xResized","lengthOriginal - 1","lengthResized - 1",t),"\n                  }");case"tf_crop_and_resize":return"if (lengthResized > 1) {\n                    return ".concat(t,"(roiStart) * ").concat(t,"(lengthOriginal - 1) +\n                        (").concat(t,"(xResized) * ").concat(t,"(roiEnd - roiStart) * ").concat(t,"(lengthOriginal - 1)) /\n                        ").concat(t,"(lengthResized - 1);\n                  } else {\n                    return 0.5 * ").concat(t,"(roiStart + roiEnd) * ").concat(t,"(lengthOriginal - 1);\n                  }");case"half_pixel_symmetric":return"const outputWidth = ".concat(t,"xScale * ").concat(t,"(lengthResized);\n                  const adjustment = ").concat(t,"(lengthResized) / outputWidth;\n                  const center = ").concat(t,"(lengthOriginal) / 2;\n                  const offset = center * (1 - adjustment);\n                  return offset + ((").concat(t,"(xResized) + 0.5) / ").concat(t,"(xScale)) - 0.5;");case"half_pixel":return"return ((".concat(t,"(xResized) + 0.5) / ").concat(t,"(xScale)) - 0.5;");default:throw new Error("Coordinate transform mode ".concat(e," is not supported"))}})()+"}",Nc=(e,t,n)=>"fn getNearestPixelFromOriginal(xOriginal: ".concat(n,", isDownSample: bool) -> ").concat(n," {")+(()=>{switch(e){case"round_prefer_ceil":return"if (fract(xOriginal) == 0.5) {             return ceil(xOriginal);           } else {             return round(xOriginal);           }";case"floor":return"return floor(xOriginal);";case"ceil":return"return ceil(xOriginal);";case"round_prefer_floor":return"if (fract(xOriginal) == 0.5) {                     return floor(xOriginal);                   } else {                     return round(xOriginal);                   }";default:if(t<11)return"if (isDownSample)                     {                       return ceil(xOriginal);                     } else {                       return xOriginal;                     }";throw new Error("Nearest mode ".concat(e," is not supported"))}})()+"}",Rc=(e,t,n)=>{let r=new Array(n).fill(0).concat(new Array(n).fill(1)),i=0===e.length?r:e.slice();return t.length>0?(t.forEach((e,a)=>{r[e]=i[a],r[a+n]=i[t.length+a]}),r):i},Pc=(e,t,n,r)=>{let i=[];if(n.length>0)if(r.length>0){if(e.forEach(e=>i.push(e)),Math.max(...r)>e.length)throw new Error("axes is out of bound");r.forEach((e,t)=>i[e]=n[t])}else n.forEach(e=>i.push(e));else{if(0===t.length)throw new Error("Resize requires either scales or sizes.");i=e.map((e,n)=>Math.round(e*t[n]))}return i},Dc=(e,t,n)=>{let r=(()=>{switch(n.keepAspectRatioPolicy){case"not_larger":return n.axes.length>0?Math.min(...n.axes.map(e=>t[e]),Number.MAX_VALUE):Math.min(...t,Number.MAX_VALUE);case"not_smaller":return n.axes.length>0?Math.max(...n.axes.map(e=>t[e]),Number.MIN_VALUE):Math.max(...t,Number.MIN_VALUE);default:throw new Error("Keep aspect ratio policy ".concat(n.keepAspectRatioPolicy," is not supported"))}})();t.fill(1,0,t.length);let i=e.slice();return n.axes.length>0?(n.axes.forEach(e=>t[e]=r),n.axes.forEach(n=>i[n]=Math.round(e[n]*t[n]))):(t.fill(r,0,t.length),i.forEach((e,n)=>i[n]=Math.round(e*t[n]))),i},zc=(e,t,n,r,i)=>"\n    fn calculateOriginalIndicesFromOutputIndices(output_indices: ".concat(e.type.indices,") -> array<").concat(e.type.value,", ").concat(n.length,"> {\n      var original_indices: array<").concat(e.type.value,", ").concat(n.length,">;\n      for (var i:u32 = 0; i < ").concat(n.length,"; i++) {\n        var output_index = ").concat(e.indicesGet("output_indices","i"),";\n        var scale = ").concat(wn("uniforms.scales","i",r),";\n        var roi_low = ").concat(wn("uniforms.roi","i",i),";\n        var roi_hi = ").concat(wn("uniforms.roi","i + ".concat(t.length),i),";\n        if (scale == 1.0) {\n          original_indices[i] = ").concat(e.type.value,"(output_index);\n        } else {\n          var input_shape_i = ").concat(wn("uniforms.input_shape","i",t.length),";\n          var output_shape_i = ").concat(wn("uniforms.output_shape","i",n.length),";\n          original_indices[i] = getOriginalCoordinateFromResizedCoordinate(output_index, scale, output_shape_i,\n                                                                           input_shape_i, roi_low, roi_hi);\n        }\n      }\n      return original_indices;\n    }"),Mc=(e,t,n,r,i,a,o)=>"\n    fn calculateInputIndicesFromOutputIndices(output_indices: ".concat(t.type.indices,") -> ").concat(e.type.indices," {\n      var input_indices: ").concat(e.type.indices,";\n      for (var i:u32 = 0; i < ").concat(r.length,"; i++) {\n        var output_index = ").concat(t.indicesGet("output_indices","i"),";\n        var input_index: u32;\n        var scale = ").concat(wn("uniforms.scales","i",i),";\n        if (scale == 1.0) {\n          input_index = output_index;\n        } else {\n          var roi_low = ").concat(wn("uniforms.roi","i",a),";\n          var roi_hi = ").concat(wn("uniforms.roi","i + ".concat(n.length),a),";\n          var input_shape_i = ").concat(wn("uniforms.input_shape","i",n.length),";\n          var output_shape_i = ").concat(wn("uniforms.output_shape","i",r.length),";\n          var original_idx = getOriginalCoordinateFromResizedCoordinate(output_index, scale, output_shape_i,\n                                                                        input_shape_i, roi_low, roi_hi);\n          if (!").concat(o," || (original_idx >= 0 && original_idx < ").concat(t.type.value,"(input_shape_i))) {\n            if (original_idx < 0) {\n              input_index = 0;\n            } else if (original_idx > ").concat(t.type.value,"(input_shape_i - 1)) {\n              input_index = input_shape_i - 1;\n            } else {\n              input_index = u32(getNearestPixelFromOriginal(original_idx, scale < 1));\n            }\n          } else {\n            input_index = u32(original_idx);\n          }\n        }\n        ").concat(e.indicesSet("input_indices","i","input_index"),"\n      }\n      return input_indices;\n    }"),Lc=(e,t)=>"\n    fn checkInputIndices(input_indices: ".concat(e.type.indices,") -> bool {\n      for (var i:u32 = 0; i < ").concat(t.length,"; i++) {\n        var input_index = ").concat(e.indicesGet("input_indices","i"),";\n        if (input_index < 0 || input_index >= ").concat(wn("uniforms.input_shape","i",t.length),") {\n          return false;\n        }\n      }\n      return true;\n    }"),Uc=(e,t,n,r)=>e.rank>r?"\n    ".concat(e.indicesSet("input_indices",t,"channel"),";\n    ").concat(e.indicesSet("input_indices",n,"batch"),";\n"):"",Bc=(e,t,n,r,i)=>{let[a,o,s,c]=2===n.length?[-1,0,1,-1]:[0,2,3,1],l=e.type.value;return"\n    fn getInputValue(batch: u32, channel: u32, row: u32, col: u32) -> ".concat(l," {\n      var input_indices: ").concat(e.type.indices,";\n      ").concat(e.indicesSet("input_indices",o,"max(0, min(row, ".concat(n[o]," - 1))")),";\n      ").concat(e.indicesSet("input_indices",s,"max(0, min(col, ".concat(n[s]," - 1))")),";\n      ").concat(Uc(e,c,a,2),"\n      return ").concat(e.getByIndices("input_indices"),";\n    }\n\n    fn bilinearInterpolation(output_indices: ").concat(t.type.indices,") -> ").concat(l," {\n      var originalIndices = calculateOriginalIndicesFromOutputIndices(output_indices);\n      var row:").concat(l," = originalIndices[").concat(o,"];\n      var col:").concat(l," = originalIndices[").concat(s,"];\n      ").concat(r?"if (row < 0 || row > (".concat(n[o]," - 1) || col < 0 || col > (").concat(n[s]," - 1)) {\n        return ").concat(i,";\n      }"):"",";\n      row = max(0, min(row, ").concat(n[o]," - 1));\n      col = max(0, min(col, ").concat(n[s]," - 1));\n      var row1: u32 = u32(row);\n      var col1: u32 = u32(col);\n      var row2: u32 = u32(row + 1);\n      var col2: u32 = u32(col + 1);\n      var channel: u32 = ").concat(n.length>2?"u32(originalIndices[".concat(c,"])"):"0",";\n      var batch: u32 =  ").concat(n.length>2?"u32(originalIndices[".concat(a,"])"):"0",";\n      var x11: ").concat(l," = getInputValue(batch, channel, row1, col1);\n      var x12: ").concat(l," = getInputValue(batch, channel, row1, col2);\n      var x21: ").concat(l," = getInputValue(batch, channel, row2, col1);\n      var x22: ").concat(l," = getInputValue(batch, channel, row2, col2);\n      var dx1: ").concat(l," = abs(row - ").concat(l,"(row1));\n      var dx2: ").concat(l," = abs(").concat(l,"(row2) - row);\n      var dy1: ").concat(l," = abs(col - ").concat(l,"(col1));\n      var dy2: ").concat(l," = abs(").concat(l,"(col2) - col);\n      if (row1 == row2) {\n        dx1 = 0.5;\n        dx2 = 0.5;\n      }\n      if (col1 == col2) {\n        dy1 = 0.5;\n        dy2 = 0.5;\n      }\n      return (x11 * dx2 * dy2 + x12 * dx2 * dy1 + x21 * dx1 * dy2 + x22 * dx1 * dy1);\n    }")},Fc=(e,t,n,r,i,a,o,s,c,l)=>{let u=2===n.length,[d,h]=u?[0,1]:[2,3],f=e.type.value,p=o=>{let u=o===d?"row":"col";return"\n      fn ".concat(u,"CubicInterpolation(input_indices: ").concat(e.type.indices,", output_indices: ").concat(t.type.indices,") -> ").concat(f," {\n        var output_index = ").concat(t.indicesGet("output_indices",o),";\n        var originalIdx: ").concat(f," = getOriginalCoordinateFromResizedCoordinate(output_index, ").concat(i[o],",\n        ").concat(r[o],", ").concat(n[o],", ").concat(a[o],", ").concat(a[o]," + ").concat(n.length,");\n        var fractOriginalIdx: ").concat(f," = originalIdx - floor(originalIdx);\n        var coefs = getCubicInterpolationCoefs(fractOriginalIdx);\n\n        if (").concat(s," && (originalIdx < 0 || originalIdx > (").concat(n[o]," - 1))) {\n          return ").concat(c,";\n        }\n        var data: array<").concat(f,", 4> = array<").concat(f,", 4>(0.0, 0.0, 0.0, 0.0);\n        for (var i: i32 = -1; i < 3; i++) {\n          var ").concat(u,": ").concat(f," = originalIdx + ").concat(f,"(i);\n          if (").concat(u," < 0 || ").concat(u," >= ").concat(n[o],") {\n            ").concat(l?"coefs[i + 1] = 0.0;\n                        continue;":s?"return ".concat(c,";"):"".concat(u," = max(0, min(").concat(u,", ").concat(n[o]," - 1));"),";\n          }\n        var input_indices_copy: ").concat(e.type.indices," = input_indices;\n          ").concat(e.indicesSet("input_indices_copy",o,"u32(".concat(u,")")),";\n          data[i + 1] = ").concat(o===d?e.getByIndices("input_indices_copy"):"rowCubicInterpolation(input_indices_copy, output_indices)",";\n        }\n        return cubicInterpolation1D(data, coefs);\n      }")};return"\n    ".concat(p(d),";\n    ").concat(p(h),";\n  fn getCubicInterpolationCoefs(s: ").concat(f,") -> array<").concat(f,", 4> {\n    var absS = abs(s);\n    var coeffs: array<").concat(f,", 4> = array<").concat(f,", 4>(0.0, 0.0, 0.0, 0.0);\n    var oneMinusAbsS: ").concat(f," = 1.0 - absS;\n    var twoMinusAbsS: ").concat(f," = 2.0 - absS;\n    var onePlusAbsS: ").concat(f," = 1.0 + absS;\n    coeffs[0] = ((").concat(o," * onePlusAbsS - 5 * ").concat(o,") * onePlusAbsS + 8 * ").concat(o,") * onePlusAbsS - 4 * ").concat(o,";\n    coeffs[1] = ((").concat(o," + 2) * absS - (").concat(o," + 3)) * absS * absS + 1;\n    coeffs[2] = ((").concat(o," + 2) * oneMinusAbsS - (").concat(o," + 3)) * oneMinusAbsS * oneMinusAbsS + 1;\n    coeffs[3] = ((").concat(o," * twoMinusAbsS - 5 * ").concat(o,") * twoMinusAbsS + 8 * ").concat(o,") * twoMinusAbsS - 4 * ").concat(o,";\n    return coeffs;\n  }\n\n  fn cubicInterpolation1D(x: array<").concat(f,", 4>, coefs: array<").concat(f,", 4>) -> ").concat(f," {\n    var coefsSum: ").concat(f," = coefs[0] + coefs[1] + coefs[2] + coefs[3];\n    return (x[0] * coefs[0] + x[1] * coefs[1]+ x[2] * coefs[2]+ x[3] * coefs[3]) / coefsSum;\n  }\n\n  fn bicubicInterpolation(output_indices: ").concat(t.type.indices,") -> ").concat(f," {\n    var input_indices: ").concat(e.type.indices," = output_indices;\n    return colCubicInterpolation(input_indices, output_indices);\n  }\n    ")},jc=(e,t,n,r,i)=>{let[a,o,s,c,l]=3===n.length?[-1,0,1,2,-1]:[0,2,3,4,1],u=e.type.value;return"\n    fn getInputValue(batch: u32, channel: u32, depth:u32, height: u32, width: u32) -> ".concat(u," {\n      var input_indices: ").concat(e.type.indices,";\n      ").concat(e.indicesSet("input_indices",o,"max(0, min(depth, ".concat(n[o]," - 1))")),";\n      ").concat(e.indicesSet("input_indices",s,"max(0, min(height, ".concat(n[s]," - 1))")),";\n      ").concat(e.indicesSet("input_indices",c,"max(0, min(width, ".concat(n[c]," - 1))")),";\n      ").concat(Uc(e,l,a,3),"\n      return ").concat(e.getByIndices("input_indices"),";\n    }\n\n    fn trilinearInterpolation(output_indices: ").concat(t.type.indices,") -> ").concat(u," {\n      var originalIndices = calculateOriginalIndicesFromOutputIndices(output_indices);\n      var depth:").concat(u," = originalIndices[").concat(o,"];\n      var height:").concat(u," = originalIndices[").concat(s,"];\n      var width:").concat(u," = originalIndices[").concat(c,"];\n      ").concat(r?"if (depth < 0 || depth > (".concat(n[o]," - 1) || height < 0 || height > (").concat(n[s]," - 1) || width < 0 || (width > ").concat(n[c]," - 1)) {\n      return ").concat(i,";\n        }"):"",";\n\n    depth = max(0, min(depth, ").concat(n[o]," - 1));\n      height = max(0, min(height, ").concat(n[s]," - 1));\n      width = max(0, min(width, ").concat(n[c]," - 1));\n      var depth1: u32 = u32(depth);\n      var height1: u32 = u32(height);\n      var width1: u32 = u32(width);\n      var depth2: u32 = u32(depth + 1);\n      var height2: u32 = u32(height + 1);\n      var width2: u32 = u32(width + 1);\n      var channel: u32 = ").concat(n.length>3?"u32(originalIndices[".concat(l,"])"):"0",";\n      var batch: u32 =  ").concat(n.length>3?"u32(originalIndices[".concat(a,"])"):"0",";\n\n      var x111: ").concat(u," = getInputValue(batch, channel, depth1, height1, width1);\n      var x112: ").concat(u," = getInputValue(batch, channel, depth1, height1, width2);\n      var x121: ").concat(u," = getInputValue(batch, channel, depth1, height2, width1);\n      var x122: ").concat(u," = getInputValue(batch, channel, depth1, height2, width2);\n      var x211: ").concat(u," = getInputValue(batch, channel, depth2, height1, width1);\n      var x212: ").concat(u," = getInputValue(batch, channel, depth2, height1, width2);\n      var x221: ").concat(u," = getInputValue(batch, channel, depth2, height2, width1);\n      var x222: ").concat(u," = getInputValue(batch, channel, depth2, height2, width2);\n      var dx1: ").concat(u," = abs(depth - ").concat(u,"(depth1));\n      var dx2: ").concat(u," = abs(").concat(u,"(depth2) - depth);\n      var dy1: ").concat(u," = abs(height - ").concat(u,"(height1));\n      var dy2: ").concat(u," = abs(").concat(u,"(height2) - height);\n      var dz1: ").concat(u," = abs(width - ").concat(u,"(width1));\n      var dz2: ").concat(u," = abs(").concat(u,"(width2) - width);\n      if (depth1 == depth2) {\n        dx1 = 0.5;\n        dx2 = 0.5;\n      }\n      if (height1 == height2) {\n        dy1 = 0.5;\n        dy2 = 0.5;\n      }\n      if (width1 == width2) {\n        dz1 = 0.5;\n        dz2 = 0.5;\n      }\n      return (x111 * dx2 * dy2 * dz2 + x112 * dx2 * dy2 * dz1 + x121 * dx2 * dy1 *dz2 + x122 * dx2 * dy1 * dz1 +\n              x211 * dx1 * dy2 * dz2 + x212 * dx1 * dy2 * dz1 + x221 * dx1 * dy1 *dz2 + x222 * dx1 * dy1 * dz1);\n    }")},Vc=(e,t,n,r,i,a)=>{let o=e.dims,s=Rc(a,t.axes,o.length),c=Pc(o,r,i,t.axes),l=r.slice();0===r.length&&(l=o.map((e,t)=>0===e?1:c[t]/e),"stretch"!==t.keepAspectRatioPolicy&&(c=Dc(o,l,t)));let u=xn("output",e.dataType,c.length),d=_n("input",e.dataType,o.length),h=Rt.size(c),f=o.length===c.length&&o.every((e,t)=>e===c[t]),p="tf_crop_and_resize"===t.coordinateTransformMode,m=t.extrapolationValue,g=d.type.value;return{name:"Resize",shaderCache:{hint:"".concat(t.cacheKey,"|").concat(n,"|").concat(l.length>0?"cubic"===t.mode?l:l.length:"","|").concat(i.length>0?i:"","|").concat(s.length>0?s:"","|").concat(f,"|").concat("nearest"===t.mode?o.length:o),inputDependencies:["rank"]},getShaderSource:e=>"\n      ".concat(f?"":"\n      ".concat(Oc(t.coordinateTransformMode,g),";\n      ").concat((()=>{switch(t.mode){case"nearest":return"\n              ".concat(Lc(d,o),";\n              ").concat(Nc(t.nearestMode,n,g),";\n              ").concat(Mc(d,u,o,c,l.length,s.length,p),";\n              ");case"linear":return"\n              ".concat(zc(u,o,c,l.length,s.length),";\n              ").concat((()=>{if(2===o.length||4===o.length)return"".concat(Bc(d,u,o,p,m));if(3===o.length||5===o.length)return"".concat(jc(d,u,o,p,m));throw Error("Linear mode only supports input dims 2, 3, 4 and 5 are supported in linear mode.")})(),";\n            ");case"cubic":return"\n            ".concat((()=>{if(2===o.length||4===o.length)return"".concat(Fc(d,u,o,c,l,s,t.cubicCoeffA,p,t.extrapolationValue,t.excludeOutside));throw Error("Cubic mode only supports input dims 2 and 4 are supported in linear mode.")})(),";\n            ");default:throw Error("Invalid resize mode")}})(),";\n      "),"\n      ").concat(e.registerUniform("output_size","u32").registerUniform("scales","f32",l.length).registerUniform("roi","f32",s.length).declareVariables(d,u),"\n      ").concat(e.mainStart(),"\n        ").concat(e.guardAgainstOutOfBoundsWorkgroupSizes("uniforms.output_size"),"\n        ").concat(f?"output[global_idx] = input[global_idx];":"\n        let output_indices = ".concat(u.offsetToIndices("global_idx"),";\n        var input_indices: ").concat(d.type.indices,";\n        ").concat((()=>{switch(t.mode){case"nearest":return"input_indices = calculateInputIndicesFromOutputIndices(output_indices);\n                if (checkInputIndices(input_indices)) {\n                  output[global_idx] = ".concat(d.getByIndices("input_indices"),";\n                } else {\n                  output[global_idx] = ").concat(t.extrapolationValue,";\n                }");case"linear":return"output[global_idx] = ".concat(2===o.length||4===o.length?"bilinearInterpolation":"trilinearInterpolation","(output_indices);");case"cubic":return"output[global_idx] = bicubicInterpolation(output_indices);";default:throw Error("Unsupported resize mode: ".concat(t.mode))}})(),";\n"),"\n      }"),getRunData:()=>({outputs:[{dims:c,dataType:e.dataType}],dispatchGroup:{x:Math.ceil(h/64)},programUniforms:[{type:12,data:h},{type:1,data:l},{type:1,data:s},...pn(o,c)]})}},qc=e=>{let t=e.customDataBuffer;return new Uint32Array(t,t.byteOffset,1)[0]},Hc=(e,t)=>{let n=[],r=[],i=[],a=qc(e);if(0!==t.antialias)throw Error("Only default value (0) for Antialias attribute is supported");Cc(e.inputs,t,a,n,r,i),e.compute(Vc(e.inputs[0],t,a,n,r,i),{inputs:[0]})},Wc=e=>{let t=e.antialias,n=e.axes,r=e.coordinateTransformMode,i=e.cubicCoeffA,a=0!==e.excludeOutside,o=e.extrapolationValue,s=e.keepAspectRatioPolicy,c=e.mode,l=""===e.nearestMode?"simple":e.nearestMode;return ln({antialias:t,axes:n,coordinateTransformMode:r,cubicCoeffA:i,excludeOutside:a,extrapolationValue:o,keepAspectRatioPolicy:s,mode:c,nearestMode:l})}}),Iu=re(()=>{El(),Tl(),Pl(),Gc=e=>{if(!e||e.length<3)throw new Error("layerNorm requires at least 3 inputs.");let t=e[0],n=e[1],r=e[2];if(t.dataType!==n.dataType||t.dataType!==r.dataType)throw new Error("All inputs must have the same data type");if(3!==t.dims.length&&2!==t.dims.length)throw new Error("Input must be 2D or 3D");if(3!==n.dims.length&&2!==n.dims.length)throw new Error("Skip must be 2D or 3D");let i=t.dims[t.dims.length-1],a=t.dims[t.dims.length-2];if(n.dims[n.dims.length-1]!==i)throw new Error("Skip must have the same hidden size as input");if(n.dims[n.dims.length-2]!==a)throw new Error("Skip must have the same sequence length as input");if(1!==r.dims.length)throw new Error("Gamma must be 1D");if(r.dims[r.dims.length-1]!==i)throw new Error("Gamma must have the same hidden size as input");if(e.length>3){let t=e[3];if(1!==t.dims.length)throw new Error("Beta must be 1D");if(t.dims[t.dims.length-1]!==i)throw new Error("Beta must have the same hidden size as input")}if(e.length>4){let t=e[4];if(1!==t.dims.length)throw new Error("Bias must be 1D");if(t.dims[t.dims.length-1]!==i)throw new Error("Bias must have the same hidden size as input")}},Kc=(e,t,n,r)=>{let i=t.simplified,a=e[0].dims,o=Rt.size(a),s=a,c=o,l=a.slice(-1)[0],u=r?a.slice(0,-1).concat(1):[],d=!i&&e.length>3,h=e.length>4,f=r&&n>1,p=r&&n>2,m=n>3,g=64,y=mn(l),v=[{type:12,data:c},{type:12,data:y},{type:12,data:l},{type:1,data:t.epsilon}],w=[{dims:s,dataType:e[0].dataType}];return n>1&&w.push({dims:u,dataType:1}),n>2&&w.push({dims:u,dataType:1}),n>3&&w.push({dims:a,dataType:e[0].dataType}),{name:"SkipLayerNormalization",shaderCache:{hint:"".concat(y,";").concat(f,";").concat(p,";").concat(m),inputDependencies:e.map((e,t)=>"type")},getShaderSource:t=>{let n=[_n("x",e[0].dataType,e[0].dims,y),_n("skip",e[1].dataType,e[1].dims,y),_n("gamma",e[2].dataType,e[2].dims,y)];d&&n.push(_n("beta",e[3].dataType,e[3].dims,y)),h&&n.push(_n("bias",e[4].dataType,e[4].dims,y)),n.push(xn("output",e[0].dataType,s,y)),f&&n.push(xn("mean_output",1,u)),p&&n.push(xn("inv_std_output",1,u)),m&&n.push(xn("input_skip_bias_sum",e[0].dataType,s,y));let r=hn(e[0].dataType),a=hn(1,y);return"\n\n      ".concat(t.registerUniforms([{name:"output_size",type:"u32"},{name:"components",type:"u32"},{name:"hidden_size",type:"u32"},{name:"epsilon",type:"f32"}]).declareVariables(...n),"\n      var<workgroup> sum_shared : array<").concat(a,", ").concat(g,">;\n      var<workgroup> sum_squared_shared : array<").concat(a,", ").concat(g,">;\n\n      ").concat(t.mainStart([g,1,1]),"\n        let ix = local_id.x;\n        let iy = global_id.x / ").concat(g,";\n\n        let hidden_size_vectorized: u32 = uniforms.hidden_size / uniforms.components;\n        var stride = hidden_size_vectorized / ").concat(g,";\n        let offset = ix * stride + iy * hidden_size_vectorized;\n        let offset1d = stride * ix;\n        if (ix == ").concat(63,") {\n          stride = hidden_size_vectorized - stride * ix;\n        }\n        for (var i: u32 = 0; i < stride; i++) {\n          let skip_value = skip[offset + i];\n          let bias_value = ").concat(h?"bias[offset1d + i]":r+"(0.0)",";\n          let input_value = x[offset + i];\n          let value = input_value + skip_value + bias_value;\n          ").concat(m?"input_skip_bias_sum[offset + i] = value;":"","\n          output[offset + i] = value;\n          let f32_value = ").concat(yn(r,y,"value"),";\n          sum_shared[ix] += f32_value;\n          sum_squared_shared[ix] += f32_value * f32_value;\n        }\n        workgroupBarrier();\n\n        var reduce_size : u32 = ").concat(g,";\n        for (var curr_size = reduce_size >> 1;  curr_size > 0; curr_size = reduce_size >> 1) {\n          reduce_size = curr_size + (reduce_size & 1);\n          if (ix < curr_size) {\n            sum_shared[ix] += sum_shared[ix + reduce_size];\n            sum_squared_shared[ix] += sum_squared_shared[ix + reduce_size];\n          }\n          workgroupBarrier();\n        }\n\n        let sum = sum_shared[0];\n        let square_sum = sum_squared_shared[0];\n        let mean = ").concat(vn("sum",y)," / f32(uniforms.hidden_size);\n        let inv_std_dev = inverseSqrt(").concat(vn("square_sum",y)," / f32(uniforms.hidden_size) ").concat(i?"":"- mean * mean"," + uniforms.epsilon);\n        ").concat(f?"mean_output[global_idx] = mean;":"","\n        ").concat(p?"inv_std_output[global_idx] = inv_std_dev;":"","\n\n        for (var i: u32 = 0; i < stride; i++) {\n          output[offset + i] = (output[offset + i] ").concat(i?"":"- ".concat(r,"(mean)"),") *\n            ").concat(r,"(inv_std_dev) * gamma[offset1d + i]\n            ").concat(d?"+ beta[offset1d + i]":"",";\n        }\n      }")},getRunData:()=>({outputs:w,dispatchGroup:{x:Math.ceil(c/l)},programUniforms:v})}},Qc=(e,t)=>{Gc(e.inputs);let n=[0];e.outputCount>1&&n.push(-3),e.outputCount>2&&n.push(-3),e.outputCount>3&&n.push(3),e.compute(Kc(e.inputs,t,e.outputCount,!1),{outputs:n})}}),Cu=re(()=>{El(),Tl(),Rl(),Pl(),Xc=(e,t)=>{if(!e||e.length<1)throw new Error("too few inputs");if(0!==t.axes.length){if(t.axes.length!==t.starts.length||t.axes.length!==t.ends.length)throw new Error("axes, starts and ends must have the same length")}else if(t.starts.length!==t.ends.length)throw new Error("starts and ends must have the same length");e.slice(1).forEach((t,n)=>{if(6!==e[n+1].dataType&&7!==e[n+1].dataType)throw new Error("Input ".concat(n," must be an array of int32 or int64"))})},Yc=(e,t)=>{let n=[];if(e.length>t)if(7===e[t].dataType)e[t].getBigInt64Array().forEach(e=>n.push(Number(e)));else{if(6!==e[t].dataType)throw new Error("Input ".concat(t," must be an array of int32 or int64"));e[t].getInt32Array().forEach(e=>n.push(Number(e)))}return n},Jc=(e,t)=>{if(e.length>1){let t=Yc(e,1),n=Yc(e,2),r=Yc(e,3);return 0===r.length&&(r=[...Array(e[0].dims.length).keys()]),ln({starts:t,ends:n,axes:r})}return t},$c=(e,t,n,r,i)=>{let a=e;return e<0&&(a+=n[r[t]]),i[t]<0?Math.max(0,Math.min(a,n[r[t]]-1)):Math.max(0,Math.min(a,n[r[t]]))},Zc=(e,t,n)=>"fn calculateInputIndices(output_indices: ".concat(t.type.indices,") -> ").concat(e.type.indices," {\n          var input_indices: ").concat(e.type.indices,";\n          var carry = 0u;\n          for (var i = ").concat(n.length-1,"; i >= 0; i--) {\n            let input_shape_i = ").concat(wn("uniforms.input_shape","i",n.length),";\n            let steps_i = ").concat(wn("uniforms.steps","i",n.length),";\n            let signs_i = ").concat(wn("uniforms.signs","i",n.length),";\n            let starts_i = ").concat(wn("uniforms.starts","i",n.length),";\n            var output_index = ").concat(t.indicesGet("output_indices","i"),";\n            var input_index = output_index * steps_i + starts_i + carry;\n            carry = input_index / input_shape_i;\n            input_index = input_index % input_shape_i;\n            if (signs_i < 0) {\n              input_index = input_shape_i - input_index - 1u + starts_i;\n            }\n            ").concat(e.indicesSet("input_indices","i","input_index"),";\n          }\n          return input_indices;\n      }"),el=(e,t)=>{let n=e[0].dims,r=Rt.size(n),i=t.axes.length>0?Rt.normalizeAxes(t.axes,n.length):[...Array(n.length).keys()],a=Yc(e,4);a.forEach(e=>0!==e||(()=>{throw new Error("step cannot be 0")})),0===a.length&&(a=Array(i.length).fill(1));let o=t.starts.map((e,t)=>$c(e,t,n,i,a)),s=t.ends.map((e,t)=>$c(e,t,n,i,a));if(i.length!==o.length||i.length!==s.length)throw new Error("start, ends and axes should have the same number of elements");if(i.length!==n.length)for(let g=0;g<n.length;++g)i.includes(g)||(o.splice(g,0,0),s.splice(g,0,n[g]),a.splice(g,0,1));let c=a.map(e=>Math.sign(e));a.forEach((e,t,n)=>{if(e<0){let r=(s[t]-o[t])/e,i=o[t],c=i+r*a[t];o[t]=c,s[t]=i,n[t]=-e}});let l=n.slice(0);i.forEach((e,t)=>{l[e]=Math.ceil((s[e]-o[e])/a[e])});let u={dims:l,dataType:e[0].dataType},d=xn("output",e[0].dataType,l.length),h=_n("input",e[0].dataType,e[0].dims.length),f=Rt.size(l),p=[{name:"outputSize",type:"u32"},{name:"starts",type:"u32",length:o.length},{name:"signs",type:"i32",length:c.length},{name:"steps",type:"u32",length:a.length}],m=[{type:12,data:f},{type:12,data:o},{type:6,data:c},{type:12,data:a},...pn(e[0].dims,l)];return{name:"Slice",shaderCache:{hint:"".concat(c.length,"_").concat(o.length,"_").concat(a.length),inputDependencies:["rank"]},getShaderSource:e=>"\n      ".concat(e.registerUniforms(p).declareVariables(h,d),"\n        ").concat(Zc(h,d,n),"\n        ").concat(e.mainStart(),"\n          ").concat(e.guardAgainstOutOfBoundsWorkgroupSizes("uniforms.outputSize"),"\n          let output_indices = ").concat(d.offsetToIndices("global_idx"),";\n          let input_indices = calculateInputIndices(output_indices);\n          ").concat(d.setByOffset("global_idx",h.getByIndices("input_indices")),"\n      }"),getRunData:()=>({outputs:[u],dispatchGroup:{x:Math.ceil(r/64)},programUniforms:m})}},tl=(e,t)=>{Xc(e.inputs,t);let n=Jc(e.inputs,t);e.compute(el(e.inputs,n),{inputs:[0]})},nl=e=>{let t=e.starts,n=e.ends,r=e.axes;return ln({starts:t,ends:n,axes:r})}}),Au=re(()=>{El(),Tl(),Rl(),Dl(),Pl(),rl=e=>{if(!e||1!==e.length)throw new Error("Softmax op requires 1 input.")},il=(e,t)=>{let n,r=e.inputs[0],i=r.dims,a=Rt.size(i),o=i.length,s=Rt.normalizeAxis(t.axis,o),c=s<i.length-1,l=[];c?(l=Array.from({length:o},(e,t)=>t),l[s]=o-1,l[o-1]=s,n=e.compute(Pn(r,l),{inputs:[r],outputs:[-1]})[0]):n=r;let u=n.dims,d=u[o-1],h=a/d,f=mn(d),p=d/f,m=64;1===h&&(m=256);let g=_n("x",n.dataType,n.dims,f),y=xn("result",n.dataType,n.dims,f),v=g.type.value,w="f32"===hn(n.dataType)?"var threadMax = ".concat(v,"(-3.402823e+38f);"):"var threadMax = ".concat(v,"(-65504.0h);"),b=e.compute({name:"Softmax",shaderCache:{hint:"".concat(f,";").concat(m),inputDependencies:["type"]},getRunData:()=>({outputs:[{dims:u,dataType:n.dataType}],dispatchGroup:{x:h},programUniforms:[{type:6,data:p}]}),getShaderSource:e=>"\n      var<workgroup> rowMaxShared : ".concat(v,";\n      var<workgroup> rowSumShared : ").concat(v,";\n      var<workgroup> threadShared : array<").concat(v,", ").concat(m,">;\n\n      fn getValue(row: i32, col: i32, row_stride: i32) -> ").concat(v," {\n        let index = row * row_stride + col;\n        return x[index];\n      }\n\n      fn setValue(row: i32, col: i32, row_stride: i32, value: ").concat(v,") {\n        let index = row * row_stride + col;\n        result[index] = value;\n      }\n      ").concat(e.registerUniform("packedCols","i32").declareVariables(g,y),"\n      ").concat(e.mainStart(m),"\n        let gindex = i32(global_idx);\n        let lindex = i32(local_idx);\n        const wg = ").concat(m,";\n        let row = gindex / wg;\n        let cols = uniforms.packedCols;\n        let row_stride : i32 = uniforms.packedCols;\n\n        // find the rows max\n        ").concat(w,"\n        for (var col = lindex; col < cols; col += wg) {\n          let value = getValue(row, col, row_stride);\n          threadMax = max(threadMax, value);\n        }\n        if (lindex < cols) {\n          threadShared[lindex] = threadMax;\n        }\n        workgroupBarrier();\n\n        var reduceSize = min(cols, wg);\n        for (var currSize = reduceSize >> 1;  currSize > 0; currSize = reduceSize >> 1) {\n          reduceSize = currSize + (reduceSize & 1);\n          if (lindex < currSize) {\n            threadShared[lindex] = max(threadShared[lindex], threadShared[lindex + reduceSize]);\n          }\n          workgroupBarrier();\n        }\n        if (lindex == 0) {\n          rowMaxShared = ").concat(v,"(").concat(((e,t)=>4===t?"max(max(".concat(e,".x, ").concat(e,".y), max(").concat(e,".z, ").concat(e,".w))"):2===t?"max(".concat(e,".x, ").concat(e,".y)"):3===t?"max(max(".concat(e,".x, ").concat(e,".y), ").concat(e,".z)"):e)("threadShared[0]",f),");\n        }\n        workgroupBarrier();\n\n        // find the rows sum\n        var threadSum = ").concat(v,"(0.0);\n        for (var col = lindex; col < cols; col += wg) {\n          let subExp = exp(getValue(row, col, row_stride) - rowMaxShared);\n          threadSum += subExp;\n        }\n        threadShared[lindex] = threadSum;\n        workgroupBarrier();\n\n        for (var currSize = wg >> 1;  currSize > 0; currSize = currSize >> 1) {\n          if (lindex < currSize) {\n            threadShared[lindex] = threadShared[lindex] + threadShared[lindex + currSize];\n          }\n          workgroupBarrier();\n        }\n        if (lindex == 0) {\n          rowSumShared = ").concat(v,"(").concat(vn("threadShared[0]",f),");\n        }\n        workgroupBarrier();\n\n        // calculate final value for each element in the row\n        for (var col = lindex; col < cols; col += wg) {\n          var value = exp(getValue(row, col, row_stride) - rowMaxShared) / rowSumShared;\n          // max operation protects against NaN since all values should be >=0\n          value = max(value, ").concat(v,"(0.0));\n          setValue(row, col, row_stride, value);\n        }\n      }")},{inputs:[n],outputs:[c?-1:0]})[0];c&&e.compute(Pn(b,l),{inputs:[b]})},al=(e,t)=>{rl(e.inputs),il(e,t)},ol=e=>ln({axis:e.axis})}),Ou=re(()=>{El(),Tl(),Pl(),sl=e=>Array.from(e.getBigInt64Array(),Number),cl=e=>{if(!e||2!==e.length)throw new Error("Tile requires 2 inputs.");if(1!==e[0].dataType&&10!==e[0].dataType&&6!==e[0].dataType&&12!==e[0].dataType)throw new Error("Tile only support float, float16, int32, and uint32 data types");if(7!==e[1].dataType)throw new Error("Tile `repeats` input should be of int64 data type");if(1!==e[1].dims.length)throw new Error("Tile `repeats` input should be 1-D");if(sl(e[1]).length!==e[0].dims.length)throw new Error("Tile `repeats` input should have same number of elements as rank of input data tensor")},ll=(e,t)=>{let n=[];for(let r=0;r<e.length;++r)n.push(e[r]*t[r]);return n},ul=(e,t)=>{let n=e[0].dims,r=null!==t&&void 0!==t?t:sl(e[1]),i=ll(n,r),a=Rt.size(i),o=e[0].dataType,s=_n("input",o,n.length),c=xn("output",o,i.length);return{name:"Tile",shaderCache:{hint:"".concat(r),inputDependencies:["rank"]},getRunData:()=>({outputs:[{dims:i,dataType:e[0].dataType}],dispatchGroup:{x:Math.ceil(a/64)},programUniforms:[{type:12,data:a},...pn(e[0].dims,i)]}),getShaderSource:e=>"\n      const inputShape = ".concat(s.indices(...n),";\n      ").concat(e.registerUniform("output_size","u32").declareVariables(s,c),"\n      ").concat(e.mainStart(),"\n      ").concat(e.guardAgainstOutOfBoundsWorkgroupSizes("uniforms.output_size"),"\n      let output_indices = ").concat(c.offsetToIndices("global_idx"),";\n      var input_indices: ").concat(s.type.indices,";\n      for (var i = 0; i < ").concat(n.length,"; i++) {\n        let input_dim_i = ").concat(s.indicesGet("uniforms.input_shape","i"),";\n        let input_dim_value = ").concat(c.indicesGet("output_indices","i"),"  % input_dim_i;\n\n        ").concat(s.indicesSet("input_indices","i","input_dim_value"),"\n      }\n      ").concat(c.setByOffset("global_idx",s.getByIndices("input_indices")),"\n    }")}},dl=e=>{cl(e.inputs),e.compute(ul(e.inputs),{inputs:[0]})}}),Nu=re(()=>{El(),Tl(),Pl(),hl=(e,t,n,r,i)=>{let a,o=xn("output_data",i,n.length,4),s=_n("a_data",t[1].dataType,t[1].dims.length,4),c=_n("b_data",t[2].dataType,t[2].dims.length,4),l=_n("c_data",t[0].dataType,t[0].dims.length,4),u=(e,t,n)=>"select(".concat(t,", ").concat(e,", ").concat(n,")");if(r){let e=function(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"",r="a_data[index_a".concat(t,"][component_a").concat(t,"]"),i="b_data[index_b".concat(t,"][component_b").concat(t,"]"),a="bool(c_data[index_c".concat(t,"] & (0xffu << (component_c").concat(t," * 8)))");return"\n            let output_indices".concat(t," = ").concat(o.offsetToIndices("global_idx * 4u + ".concat(t,"u")),";\n            let offset_a").concat(t," = ").concat(s.broadcastedIndicesToOffset("output_indices".concat(t),o),";\n            let offset_b").concat(t," = ").concat(c.broadcastedIndicesToOffset("output_indices".concat(t),o),";\n            let offset_c").concat(t," = ").concat(l.broadcastedIndicesToOffset("output_indices".concat(t),o),";\n            let index_a").concat(t," = offset_a").concat(t," / 4u;\n            let index_b").concat(t," = offset_b").concat(t," / 4u;\n            let index_c").concat(t," = offset_c").concat(t," / 4u;\n            let component_a").concat(t," = offset_a").concat(t," % 4u;\n            let component_b").concat(t," = offset_b").concat(t," % 4u;\n            let component_c").concat(t," = offset_c").concat(t," % 4u;\n            ").concat(e,"[").concat(t,"] = ").concat(n,"(").concat(u(r,i,a),");\n          ")};a=9===i?"\n            var data = vec4<u32>(0);\n            ".concat(e("data",0,"u32"),"\n            ").concat(e("data",1,"u32"),"\n            ").concat(e("data",2,"u32"),"\n            ").concat(e("data",3,"u32"),"\n            output_data[global_idx] = dot(vec4<u32>(0x1, 0x100, 0x10000, 0x1000000), vec4<u32>(data));"):"\n            ".concat(e("output_data[global_idx]",0),"\n            ").concat(e("output_data[global_idx]",1),"\n            ").concat(e("output_data[global_idx]",2),"\n            ").concat(e("output_data[global_idx]",3),"\n          ")}else a=o.setByOffset("global_idx",u(s.getByOffset("global_idx"),c.getByOffset("global_idx"),l.getByOffset("global_idx")));return"\n        ".concat(e.registerUniform("vec_size","u32").declareVariables(l,s,c,o),"\n        ").concat(e.mainStart(),"\n        ").concat(e.guardAgainstOutOfBoundsWorkgroupSizes("uniforms.vec_size"),"\n        ").concat(a,"\n      }")},fl=e=>{let t=e[1].dims,n=e[2].dims,r=e[0].dims,i=e[1].dataType,a=!(Rt.areEqual(t,n)&&Rt.areEqual(n,r)),o=t,s=Rt.size(t);if(a){let e=Nt.calcShape(Nt.calcShape(t,n,!1),r,!1);if(!e)throw new Error("Can't perform where op on the given tensors");o=e,s=Rt.size(o)}let c=Math.ceil(s/4);return{name:"Where",shaderCache:{inputDependencies:["rank","rank","rank"]},getShaderSource:t=>hl(t,e,o,a,i),getRunData:()=>({outputs:[{dims:o,dataType:i}],dispatchGroup:{x:Math.ceil(s/64/4)},programUniforms:[{type:12,data:c},...pn(r,t,n,o)]})}},pl=e=>{e.compute(fl(e.inputs))}}),Ru=re(()=>{Ll(),Ul(),Bl(),Fl(),Vl(),ql(),Hl(),Zl(),tu(),nu(),ru(),iu(),au(),ou(),su(),cu(),lu(),uu(),du(),hu(),gu(),yu(),vu(),wu(),bu(),fu(),_u(),xu(),Eu(),Su(),ku(),Ml(),Tu(),mu(),Iu(),Cu(),Au(),pu(),Ou(),Dl(),jl(),Nu(),ml=new Map([["Abs",[Yr]],["Acos",[Jr]],["Acosh",[$r]],["Add",[Wi]],["ArgMax",[Nr,Rr]],["ArgMin",[Or,Rr]],["Asin",[Zr]],["Asinh",[ei]],["Atan",[ti]],["Atanh",[ni]],["Attention",[Fr]],["AveragePool",[oc,ac]],["BatchNormalization",[Hr]],["BiasAdd",[Kr]],["BiasSplitGelu",[ji]],["Cast",[ii,ri]],["Ceil",[si]],["Clip",[oi]],["Concat",[aa,oa]],["Conv",[Ha,Fa]],["ConvTranspose",[eo,Ya]],["Cos",[ci]],["Cosh",[li]],["CumSum",[no,ro]],["DepthToSpace",[so,co]],["DequantizeLinear",[yc,vc]],["Div",[Gi]],["Einsum",[vo,wo]],["Elu",[di,ui]],["Equal",[Ki]],["Erf",[fi]],["Exp",[pi]],["Expand",[So]],["FastGelu",[To]],["Floor",[mi]],["FusedConv",[Ha,Fa]],["Gather",[Oo,Ao]],["GatherElements",[jo,Fo]],["GatherBlockQuantized",[Mo,Lo]],["GatherND",[Ro,Po]],["Gelu",[gi]],["Gemm",[Wo,Ho]],["GlobalAveragePool",[lc,cc]],["GlobalMaxPool",[pc,fc]],["Greater",[Ji]],["GreaterOrEqual",[Zi]],["GridSample",[rs,is]],["GroupQueryAttention",[Ts]],["HardSigmoid",[Si,Ei]],["InstanceNormalization",[Os]],["LayerNormalization",[Ps]],["LeakyRelu",[yi,ui]],["Less",[$i]],["LessOrEqual",[ea]],["Log",[zi]],["MatMul",[zs]],["MatMulNBits",[Bs,Fs]],["MaxPool",[dc,hc]],["Mul",[Qi]],["MultiHeadAttention",[ds,ss]],["Neg",[wi]],["Not",[vi]],["Pad",[Xs]],["Pow",[Xi]],["QuickGelu",[Ui,ui]],["Range",[_c]],["Reciprocal",[bi]],["ReduceMin",[Sr]],["ReduceMean",[wr]],["ReduceMax",[Er]],["ReduceSum",[Tr]],["ReduceProd",[kr]],["ReduceL1",[br]],["ReduceL2",[_r]],["ReduceLogSum",[Cr]],["ReduceLogSumExp",[xr]],["ReduceSumSquare",[Ir]],["Relu",[_i]],["Resize",[Hc,Wc]],["RotaryEmbedding",[_s]],["ScatterND",[kc,Sc]],["Sigmoid",[xi]],["Sin",[ki]],["Sinh",[Ti]],["Slice",[tl,nl]],["SkipLayerNormalization",[Qc]],["Split",[ys,vs]],["Sqrt",[Ii]],["Softmax",[al,ol]],["Sub",[Yi]],["Tan",[Ci]],["Tanh",[Oi]],["ThresholdedRelu",[Di,ui]],["Tile",[dl]],["Transpose",[Dn,zn]],["Where",[pl]]])}),Pu=re(()=>{ke(),kl(),Pl(),gl=class{constructor(e){this.backend=e,this.repo=new Map,this.attributesBound=!1}getArtifact(e){return this.repo.get(e)}setArtifact(e,t){this.repo.set(e,t)}run(e,t,n,r,i){G(e.programInfo.name);let a=this.backend.device,o=this.backend.getComputePassEncoder();this.backend.writeTimestamp(2*this.backend.pendingDispatchNumber);let s=[];for(let l of t)s.push({binding:s.length,resource:{buffer:l.buffer}});for(let l of n)s.push({binding:s.length,resource:{buffer:l.buffer}});i&&s.push({binding:s.length,resource:i});let c=a.createBindGroup({layout:e.computePipeline.getBindGroupLayout(0),entries:s,label:e.programInfo.name});if("capturing"===this.backend.sessionStatus){let t={kernelId:this.backend.currentKernelId,computePipeline:e.computePipeline,bindGroup:c,dispatchGroup:r};this.backend.capturedCommandList.get(this.backend.currentSessionId).push(t)}o.setPipeline(e.computePipeline),o.setBindGroup(0,c),o.dispatchWorkgroups(...r),this.backend.writeTimestamp(2*this.backend.pendingDispatchNumber+1),this.backend.pendingDispatchNumber++,(this.backend.pendingDispatchNumber>=this.backend.maxDispatchNumber||"at-passes"===this.backend.queryType)&&this.backend.endComputePass(),this.backend.pendingDispatchNumber>=this.backend.maxDispatchNumber&&this.backend.flush(),K(e.programInfo.name)}dispose(){}build(e,t){G(e.name);let n=this.backend.device,r=[];[{feature:"shader-f16",extension:"f16"},{feature:"subgroups",extension:"subgroups"}].forEach(e=>{n.features.has(e.feature)&&r.push("enable ".concat(e.extension,";"))});let i=Tn(t,this.backend.device.limits),a=e.getShaderSource(i),o="".concat(r.join("\n"),"\n").concat(i.additionalImplementations,"\n").concat(a),s=n.createShaderModule({code:o,label:e.name});At("verbose",()=>"[WebGPU] ".concat(e.name," shader code: ").concat(o));let c=n.createComputePipeline({compute:{module:s,entryPoint:"main"},layout:"auto",label:e.name});return K(e.name),{programInfo:e,computePipeline:c,uniformVariablesInfo:i.variablesInfo}}normalizeDispatchGroupSize(e){let t="number"==typeof e?e:e.x,n="number"==typeof e?1:e.y||1,r="number"==typeof e?1:e.z||1,i=this.backend.device.limits.maxComputeWorkgroupsPerDimension;if(t<=i&&n<=i&&r<=i)return[t,n,r];let a=t*n*r,o=Math.ceil(Math.sqrt(a));if(o>i){if(o=Math.ceil(Math.cbrt(a)),o>i)throw new Error("Total dispatch size exceeds WebGPU maximum.");return[o,o,o]}return[o,o,1]}}}),Du={};ie(Du,{WebGpuBackend:()=>Uu});var zu,Mu,Lu,Uu,Bu=re(()=>{ke(),El(),kl(),Il(),Nl(),Ru(),Pu(),zu=(e,t)=>{if(t.length!==e.length)throw new Error("inputDependencies length ".concat(t.length," is not equal to inputTensors length ").concat(e.length,"."));let n=[];for(let r=0;r<e.length;++r){let i=e[r].dataType;switch(t[r]){case"none":n.push("");break;case"type":n.push("".concat(i));break;case"rank":{let t=e[r].dims.length;n.push("".concat(i,";").concat(t));break}case"dims":{let t=e[r].dims.join(",");n.push("".concat(i,";").concat(t));break}default:throw new Error("unsupported input dependency: ".concat(t[r]))}}return n.join("|")},Mu=(e,t,n)=>{var r,i,a;let o=e.name;return null!==(r=e.shaderCache)&&void 0!==r&&r.hint&&(o+="["+e.shaderCache.hint+"]"),o+=":"+n+":".concat(zu(t,null!==(i=null===(a=e.shaderCache)||void 0===a?void 0:a.inputDependencies)&&void 0!==i?i:new Array(t.length).fill("dims"))),o},Lu=class{constructor(e){e&&(this.architecture=e.architecture,this.vendor=e.vendor)}isArchitecture(e){return this.architecture===e}isVendor(e){return this.vendor===e}},Uu=class{constructor(){this.currentSessionId=null,this.currentKernelId=null,this.commandEncoder=null,this.computePassEncoder=null,this.maxDispatchNumber=16,this.pendingDispatchNumber=0,this.pendingKernels=[],this.pendingQueries=new Map,this.sessionStatus="default",this.capturedCommandList=new Map,this.capturedPendingKernels=new Map,this.sessionExternalDataMapping=new Map}get currentKernelCustomData(){if(null===this.currentKernelId)throw new Error("currentKernelCustomData(): currentKernelId is null. (should not happen)");let e=this.kernelCustomData.get(this.currentKernelId);return e||(e={},this.kernelCustomData.set(this.currentKernelId,e)),e}async initialize(e,t){this.env=e;let n=[],r={requiredLimits:{maxComputeWorkgroupStorageSize:t.limits.maxComputeWorkgroupStorageSize,maxComputeWorkgroupsPerDimension:t.limits.maxComputeWorkgroupsPerDimension,maxStorageBufferBindingSize:t.limits.maxStorageBufferBindingSize,maxBufferSize:t.limits.maxBufferSize,maxComputeInvocationsPerWorkgroup:t.limits.maxComputeInvocationsPerWorkgroup,maxComputeWorkgroupSizeX:t.limits.maxComputeWorkgroupSizeX,maxComputeWorkgroupSizeY:t.limits.maxComputeWorkgroupSizeY,maxComputeWorkgroupSizeZ:t.limits.maxComputeWorkgroupSizeZ},requiredFeatures:n},i=e=>t.features.has(e)&&n.push(e)&&!0;i("chromium-experimental-timestamp-query-inside-passes")||i("timestamp-query"),i("shader-f16"),i("subgroups"),this.device=await t.requestDevice(r),this.adapterInfo=new Lu(t.info||await t.requestAdapterInfo()),this.gpuDataManager=sn(this),this.programManager=new gl(this),this.kernels=new Map,this.kernelPersistentData=new Map,this.kernelCustomData=new Map,It(e.logLevel,!!e.debug),this.device.onuncapturederror=e=>{e.error instanceof GPUValidationError&&console.error("An uncaught WebGPU validation error was raised: ".concat(e.error.message))},Object.defineProperty(this.env.webgpu,"device",{value:this.device,writable:!1,enumerable:!0,configurable:!1}),Object.defineProperty(this.env.webgpu,"adapter",{value:t,writable:!1,enumerable:!0,configurable:!1}),this.setQueryType()}dispose(){typeof this.querySet<"u"&&this.querySet.destroy(),this.gpuDataManager.dispose()}getCommandEncoder(){return this.commandEncoder||(this.commandEncoder=this.device.createCommandEncoder()),this.commandEncoder}getComputePassEncoder(){if(!this.computePassEncoder){let e=this.getCommandEncoder(),t={};"at-passes"===this.queryType&&(t.timestampWrites={querySet:this.querySet,beginningOfPassWriteIndex:2*this.pendingDispatchNumber,endOfPassWriteIndex:2*this.pendingDispatchNumber+1}),this.computePassEncoder=e.beginComputePass(t)}return this.computePassEncoder}endComputePass(){this.computePassEncoder&&(this.computePassEncoder.end(),this.computePassEncoder=null)}flush(){if(!this.commandEncoder)return;let e;G(),this.endComputePass(),"none"!==this.queryType&&(this.commandEncoder.resolveQuerySet(this.querySet,0,2*this.pendingDispatchNumber,this.queryResolveBuffer,0),e=this.device.createBuffer({size:2*this.pendingDispatchNumber*8,usage:GPUBufferUsage.MAP_READ|GPUBufferUsage.COPY_DST}),this.pendingQueries.set(e,this.pendingKernels),this.pendingKernels=[],this.commandEncoder.copyBufferToBuffer(this.queryResolveBuffer,0,e,0,2*this.pendingDispatchNumber*8)),this.device.queue.submit([this.commandEncoder.finish()]),this.gpuDataManager.refreshPendingBuffers(),this.commandEncoder=null,this.pendingDispatchNumber=0,"none"!==this.queryType&&e.mapAsync(GPUMapMode.READ).then(()=>{let t=new BigUint64Array(e.getMappedRange()),n=this.pendingQueries.get(e);for(let e=0;e<t.length/2;e++){var r;let i=n[e],a=i.kernelId,o=this.kernels.get(a),s=o.kernelType,c=o.kernelName,l=i.programName,u=i.inputTensorViews,d=i.outputTensorViews,h=t[2*e],f=t[2*e+1];typeof this.queryTimeBase>"u"&&(this.queryTimeBase=h);let p=Number(h-this.queryTimeBase),m=Number(f-this.queryTimeBase);if(!Number.isSafeInteger(p)||!Number.isSafeInteger(m))throw new RangeError("incorrect timestamp range");if(null!==(r=this.env.webgpu.profiling)&&void 0!==r&&r.ondata)this.env.webgpu.profiling.ondata({version:1,inputsMetadata:u.map(e=>({dims:e.dims,dataType:mt(e.dataType)})),outputsMetadata:d.map(e=>({dims:e.dims,dataType:mt(e.dataType)})),kernelId:a,kernelType:s,kernelName:c,programName:l,startTime:p,endTime:m});else{let e="";u.forEach((t,n)=>{e+="input[".concat(n,"]: [").concat(t.dims,"] | ").concat(mt(t.dataType),", ")});let t="";d.forEach((e,n)=>{t+="output[".concat(n,"]: [").concat(e.dims,"] | ").concat(mt(e.dataType),", ")}),console.log('[profiling] kernel "'.concat(a,"|").concat(s,"|").concat(c,"|").concat(l,'" ').concat(e).concat(t,"start time: ").concat(p," ns, execution time: ").concat(m-p," ns"))}H("GPU","".concat(l,"::").concat(h,"::").concat(f))}e.unmap(),this.pendingQueries.delete(e)}),K()}run(e,t,n,r,i,a){G(e.name);let o=[];for(let v=0;v<t.length;++v){let e=t[v].data;if(0===e)continue;let n=this.gpuDataManager.get(e);if(!n)throw new Error("no GPU data for input: ".concat(e));o.push(n)}let{outputs:s,dispatchGroup:c,programUniforms:l}=e.getRunData(t),u=0===n.length?s.map((e,t)=>t):n;if(u.length!==s.length)throw new Error("Output size ".concat(u.length," must be equal to ").concat(s.length,"."));let d,h=[],f=[];for(let v=0;v<s.length;++v){if(!Number.isInteger(u[v])||u[v]<-3||u[v]>=a)throw new Error("Invalid output index: ".concat(u[v]));if(-3===u[v])continue;let e=-1===u[v],t=-2===u[v],n=e||t?i(s[v].dataType,s[v].dims):r(u[v],s[v].dataType,s[v].dims);if(h.push(n),0===n.data)continue;let o=this.gpuDataManager.get(n.data);if(!o)throw new Error("no GPU data for output: ".concat(n.data));if(e&&this.temporaryData.push(o),t){let e=this.kernelPersistentData.get(this.currentKernelId);e||(e=[],this.kernelPersistentData.set(this.currentKernelId,e)),e.push(o)}f.push(o)}if(o.length!==t.length||f.length!==h.length){if(0===f.length)return K(e.name),h;throw new Error("Program ".concat(e.name," has zero-sized tensor(s) in inputs or outputs. This is not supported now."))}if(l){let e=0,t=[];l.forEach(n=>{let r="number"==typeof n.data?[n.data]:n.data;if(0===r.length)return;let i,a,o=10===n.type?2:4;10===n.type?(a=r.length>4?16:r.length>2?8:r.length*o,i=r.length>4?16:o*r.length):(a=r.length<=2?r.length*o:16,i=16),e=Math.ceil(e/a)*a,t.push(e);let s=10===n.type?8:4;e+=r.length>4?Math.ceil(r.length/s)*i:r.length*o});let n=16;e=Math.ceil(e/n)*n;let r=new ArrayBuffer(e);l.forEach((e,n)=>{let i=t[n],a="number"==typeof e.data?[e.data]:e.data;if(6===e.type)new Int32Array(r,i,a.length).set(a);else if(12===e.type)new Uint32Array(r,i,a.length).set(a);else if(10===e.type)new Uint16Array(r,i,a.length).set(a);else{if(1!==e.type)throw new Error("Unsupported uniform type: ".concat(mt(e.type)));new Float32Array(r,i,a.length).set(a)}});let i=this.gpuDataManager.create(e,GPUBufferUsage.COPY_DST|GPUBufferUsage.UNIFORM);this.device.queue.writeBuffer(i.buffer,0,r,0,e),this.gpuDataManager.release(i.id),d={offset:0,size:e,buffer:i.buffer}}let p=this.programManager.normalizeDispatchGroupSize(c),m=1===p[1]&&1===p[2],g=Mu(e,t,m),y=this.programManager.getArtifact(g);if(y||(y=this.programManager.build(e,p),this.programManager.setArtifact(g,y),At("info",()=>"[artifact] key: ".concat(g,", programName: ").concat(e.name))),l&&y.uniformVariablesInfo){if(l.length!==y.uniformVariablesInfo.length)throw new Error("Uniform variables count mismatch: expect ".concat(y.uniformVariablesInfo.length,", got ").concat(l.length,' in program "').concat(y.programInfo.name,'".'));for(let e=0;e<l.length;e++){let t=l[e],n=t.type,r="number"==typeof t.data?1:t.data.length,[i,a]=y.uniformVariablesInfo[e];if(n!==i||r!==a)throw new Error("Uniform variable ".concat(e," mismatch: expect type ").concat(i," with size ").concat(a,", got type ").concat(n," with size ").concat(r,' in program "').concat(y.programInfo.name,'".'))}}if(At("info",()=>'[ProgramManager] run "'.concat(e.name,'" (key=').concat(g,") with ").concat(p[0],"x").concat(p[1],"x").concat(p[2])),"none"!==this.queryType||"capturing"===this.sessionStatus){let e={kernelId:this.currentKernelId,programName:y.programInfo.name,inputTensorViews:t,outputTensorViews:h};this.pendingKernels.push(e),"capturing"===this.sessionStatus&&this.capturedPendingKernels.get(this.currentSessionId).push(e)}return this.programManager.run(y,o,f,p,d),K(e.name),h}upload(e,t){this.gpuDataManager.upload(e,t)}memcpy(e,t){this.gpuDataManager.memcpy(e,t)}async download(e,t){await this.gpuDataManager.download(e,t)}alloc(e){return this.gpuDataManager.create(e).id}free(e){return this.gpuDataManager.release(e)}createKernel(e,t,n,r){let i=ml.get(e);if(!i)throw new Error("kernel not implemented: ".concat(e));let a={kernelType:e,kernelName:r,kernelEntry:i[0],attributes:[i[1],n]};this.kernels.set(t,a)}releaseKernel(e){let t=this.kernelPersistentData.get(e);if(t){for(let e of t)this.gpuDataManager.release(e.id);this.kernelPersistentData.delete(e)}this.kernelCustomData.delete(e),this.kernels.delete(e)}computeKernel(e,t,n){let r=this.kernels.get(e);if(!r)throw new Error("kernel not created: ".concat(e));let i=r.kernelType,a=r.kernelName,o=r.kernelEntry,s=r.attributes;if(null!==this.currentKernelId)throw new Error('kernel "['.concat(i,"] ").concat(a,'" is not allowed to be called recursively'));this.currentKernelId=e,s[0]&&(s[1]=s[0](s[1]),s[0]=void 0),At("info",()=>'[WebGPU] Start to run kernel "['.concat(i,"] ").concat(a,'"...'));let c=this.env.debug;this.temporaryData=[];try{return c&&this.device.pushErrorScope("validation"),o(t,s[1]),0}catch(l){return n.push(Promise.resolve('[WebGPU] Kernel "['.concat(i,"] ").concat(a,'" failed. ').concat(l))),1}finally{c&&n.push(this.device.popErrorScope().then(e=>e?'GPU validation error for kernel "['.concat(i,"] ").concat(a,'": ').concat(e.message):null));for(let e of this.temporaryData)this.gpuDataManager.release(e.id);this.temporaryData=[],this.currentKernelId=null}}registerBuffer(e,t,n,r){let i=this.sessionExternalDataMapping.get(e);i||(i=new Map,this.sessionExternalDataMapping.set(e,i));let a=i.get(t),o=this.gpuDataManager.registerExternalBuffer(n,r,a);return i.set(t,[o,n]),o}unregisterBuffers(e){let t=this.sessionExternalDataMapping.get(e);t&&(t.forEach(e=>this.gpuDataManager.unregisterExternalBuffer(e[0])),this.sessionExternalDataMapping.delete(e))}getBuffer(e){let t=this.gpuDataManager.get(e);if(!t)throw new Error("no GPU data for buffer: ".concat(e));return t.buffer}createDownloader(e,t,n){return async()=>{let r=await an(this,e,t);return Lt(r.buffer,n)}}writeTimestamp(e){"inside-passes"===this.queryType&&this.computePassEncoder.writeTimestamp(this.querySet,e)}setQueryType(){var e;this.queryType="none",("default"===(null===(e=this.env.webgpu.profiling)||void 0===e?void 0:e.mode)||(typeof this.env.trace>"u"?this.env.wasm.trace:this.env.trace))&&(this.device.features.has("chromium-experimental-timestamp-query-inside-passes")?this.queryType="inside-passes":this.device.features.has("timestamp-query")&&(this.queryType="at-passes"),"none"!==this.queryType&&typeof this.querySet>"u"&&(this.querySet=this.device.createQuerySet({type:"timestamp",count:2*this.maxDispatchNumber}),this.queryResolveBuffer=this.device.createBuffer({size:2*this.maxDispatchNumber*8,usage:GPUBufferUsage.COPY_SRC|GPUBufferUsage.QUERY_RESOLVE})))}captureBegin(){At("info","captureBegin"),this.capturedCommandList.get(this.currentSessionId)||this.capturedCommandList.set(this.currentSessionId,[]),this.capturedPendingKernels.get(this.currentSessionId)||this.capturedPendingKernels.set(this.currentSessionId,[]),this.flush(),this.sessionStatus="capturing"}captureEnd(){At("info","captureEnd"),this.flush(),this.sessionStatus="default"}replay(){At("info","replay"),this.sessionStatus="replaying";let e=this.capturedCommandList.get(this.currentSessionId),t=this.capturedPendingKernels.get(this.currentSessionId),n=e.length;this.pendingKernels=[];for(let r=0;r<n;r++){let n=this.getComputePassEncoder(),i=e[r];this.writeTimestamp(2*this.pendingDispatchNumber),n.setPipeline(i.computePipeline),n.setBindGroup(0,i.bindGroup),n.dispatchWorkgroups(...i.dispatchGroup),this.writeTimestamp(2*this.pendingDispatchNumber+1),this.pendingDispatchNumber++,"none"!==this.queryType&&this.pendingKernels.push(t[r]),(this.pendingDispatchNumber>=this.maxDispatchNumber||"at-passes"===this.queryType)&&this.endComputePass(),this.pendingDispatchNumber>=this.maxDispatchNumber&&this.flush()}this.flush(),this.sessionStatus="default"}onCreateSession(){this.gpuDataManager.onCreateSession()}onReleaseSession(e){this.unregisterBuffers(e),this.capturedCommandList.has(e)&&this.capturedCommandList.delete(e),this.capturedPendingKernels.has(e)&&this.capturedPendingKernels.delete(e),this.gpuDataManager.onReleaseSession(e)}onRunStart(e){this.currentSessionId=e,this.setQueryType()}}}),Fu={};ie(Fu,{init:()=>qu});var ju,Vu,qu,Hu,Wu,Gu,Ku,Qu,Xu,Yu,Ju,$u,Zu,ed,td,nd,rd,id,ad,od,sd,cd,ld,ud,dd,hd,fd,pd,md,gd,yd,vd,wd,bd,_d,xd,Ed,Sd=re(()=>{El(),kl(),Tl(),Al(),ju=class e{constructor(e,t,n,r){this.module=e,this.dataType=t,this.data=n,this.dims=r}getFloat32Array(){if(1!==this.dataType)throw new Error("Invalid data type");let e=Rt.size(this.dims);return 0===e?new Float32Array:new Float32Array(this.module.HEAP8.buffer,this.data,e)}getBigInt64Array(){if(7!==this.dataType)throw new Error("Invalid data type");let e=Rt.size(this.dims);return 0===e?new BigInt64Array:new BigInt64Array(this.module.HEAP8.buffer,this.data,e)}getInt32Array(){if(6!==this.dataType)throw new Error("Invalid data type");let e=Rt.size(this.dims);return 0===e?new Int32Array:new Int32Array(this.module.HEAP8.buffer,this.data,e)}getUint16Array(){if(10!==this.dataType&&4!==this.dataType)throw new Error("Invalid data type");let e=Rt.size(this.dims);return 0===e?new Uint16Array:new Uint16Array(this.module.HEAP8.buffer,this.data,e)}reshape(t){if(Rt.size(t)!==Rt.size(this.dims))throw new Error("Invalid new shape");return new e(this.module,this.dataType,this.data,t)}},Vu=class{constructor(e,t,n){this.module=e,this.backend=t,this.customDataOffset=0,this.customDataSize=0,this.adapterInfo=t.adapterInfo;let r=e.PTR_SIZE,i=n/e.PTR_SIZE,a=4===r?"i32":"i64";this.opKernelContext=Number(e.getValue(r*i++,a));let o=Number(e.getValue(r*i++,a));this.outputCount=Number(e.getValue(r*i++,a)),this.customDataOffset=Number(e.getValue(r*i++,"*")),this.customDataSize=Number(e.getValue(r*i++,a));let s=[];for(let c=0;c<o;c++){let t=Number(e.getValue(r*i++,a)),n=Number(e.getValue(r*i++,"*")),o=Number(e.getValue(r*i++,a)),c=[];for(let s=0;s<o;s++)c.push(Number(e.getValue(r*i++,a)));s.push(new ju(e,t,n,c))}this.inputs=s}get kernelCustomData(){return this.backend.currentKernelCustomData}get customDataBuffer(){return this.module.HEAPU8.subarray(this.customDataOffset,this.customDataOffset+this.customDataSize)}compute(e,t){var n,r,i;let a=null!==(n=null===t||void 0===t||null===(r=t.inputs)||void 0===r?void 0:r.map(e=>"number"==typeof e?this.inputs[e]:e))&&void 0!==n?n:this.inputs,o=null!==(i=null===t||void 0===t?void 0:t.outputs)&&void 0!==i?i:[];return this.backend.run(e,a,o,(e,t,n)=>new ju(this.module,t,this.output(e,n),n),(e,t)=>{let n=gt(e,t);if(!n)throw new Error("Unsupported data type: ".concat(e));let r=n>0?this.backend.gpuDataManager.create(n).id:0;return new ju(this.module,e,r,t)},this.outputCount)}output(e,t){let n=this.module.stackSave();try{let n=this.module.PTR_SIZE,r=4===n?"i32":"i64",i=this.module.stackAlloc((1+t.length)*n);this.module.setValue(i,t.length,r);for(let e=0;e<t.length;e++)this.module.setValue(i+n*(e+1),t[e],r);return this.module._JsepOutput(this.opKernelContext,e,i)}catch(O_){throw new Error("Failed to generate kernel's output[".concat(e,"] with dims [").concat(t,"]. If you are running with pre-allocated output, please make sure the output type/dims are correct. Error: ").concat(O_))}finally{this.module.stackRestore(n)}}},qu=async(e,t,n,r)=>{let i=t.jsepInit;if(!i)throw new Error("Failed to initialize JSEP. The WebAssembly module is not built with JSEP support.");if("webgpu"===e){let e=new(0,(Bu(),ae(Du)).WebGpuBackend);await e.initialize(n,r),i("webgpu",[e,t=>e.alloc(Number(t)),t=>e.free(t),function(n,r,i){if(arguments.length>3&&void 0!==arguments[3]&&arguments[3])At("verbose",()=>"[WebGPU] jsepCopyGpuToGpu: src=".concat(Number(n),", dst=").concat(Number(r),", size=").concat(Number(i))),e.memcpy(Number(n),Number(r));else{At("verbose",()=>"[WebGPU] jsepCopyCpuToGpu: dataOffset=".concat(Number(n),", gpuDataId=").concat(Number(r),", size=").concat(Number(i)));let a=t.HEAPU8.subarray(Number(n>>>0),Number(n>>>0)+Number(i));e.upload(Number(r),a)}},async(n,r,i)=>{At("verbose",()=>"[WebGPU] jsepCopyGpuToCpu: gpuDataId=".concat(n,", dataOffset=").concat(r,", size=").concat(i)),await e.download(Number(n),()=>t.HEAPU8.subarray(Number(r)>>>0,Number(r+i)>>>0))},(n,r,i)=>e.createKernel(n,Number(r),i,t.UTF8ToString(t._JsepGetNodeName(Number(r)))),t=>e.releaseKernel(t),(n,r,i,a)=>{At("verbose",()=>"[WebGPU] jsepRun: sessionHandle=".concat(i,", kernel=").concat(n,", contextDataOffset=").concat(r));let o=new Vu(t,e,Number(r));return e.computeKernel(Number(n),o,a)},()=>e.captureBegin(),()=>e.captureEnd(),()=>e.replay()])}else{let e=new Jt(n);i("webnn",[e,()=>e.reserveTensorId(),t=>e.releaseTensorId(t),async(t,n,r,i,a)=>e.ensureTensor(t,n,r,i,a),(t,n)=>{e.uploadTensor(t,n)},async(t,n)=>e.downloadTensor(t,n),(t,n)=>e.registerMLContext(t,n),!!n.trace])}}}),kd=re(()=>{ke(),_l(),xl(),El(),wl(),bl(),Sl(),Hu=(e,t)=>{0!==rt()._OrtInit(e,t)&&ot("Can't initialize onnxruntime.")},Wu=async e=>{Hu(e.wasm.numThreads,vt(e.logLevel))},Gu=async(e,t)=>{var n,r;null===(n=(r=rt()).asyncInit)||void 0===n||n.call(r);let i=e.webgpu.adapter;if("webgpu"===t){if(typeof navigator>"u"||!navigator.gpu)throw new Error("WebGPU is not supported in current environment");if(i){if("object"!=typeof i.limits||"object"!=typeof i.features||"function"!=typeof i.requestDevice)throw new Error("Invalid GPU adapter set in `env.webgpu.adapter`. It must be a GPUAdapter object.")}else{let t=e.webgpu.powerPreference;if(void 0!==t&&"low-power"!==t&&"high-performance"!==t)throw new Error('Invalid powerPreference setting: "'.concat(t,'"'));let n=e.webgpu.forceFallbackAdapter;if(void 0!==n&&"boolean"!=typeof n)throw new Error('Invalid forceFallbackAdapter setting: "'.concat(n,'"'));if(i=await navigator.gpu.requestAdapter({powerPreference:t,forceFallbackAdapter:n}),!i)throw new Error('Failed to get GPU adapter. You may need to enable flag "--enable-unsafe-webgpu" if you are using Chrome.')}}if("webnn"===t&&(typeof navigator>"u"||!navigator.ml))throw new Error("WebNN is not supported in current environment");{let n=(Sd(),ae(Fu)).init;"webgpu"===t&&await n("webgpu",rt(),e,i),"webnn"===t&&await n("webnn",rt(),e)}},Ku=new Map,Qu=e=>{let t=rt(),n=t.stackSave();try{let n=t.PTR_SIZE,r=t.stackAlloc(2*n);0!==t._OrtGetInputOutputCount(e,r,r+n)&&ot("Can't get session input/output count.");let i=4===n?"i32":"i64";return[Number(t.getValue(r,i)),Number(t.getValue(r+n,i))]}finally{t.stackRestore(n)}},Xu=(e,t)=>{let n=rt(),r=n.stackSave(),i=0;try{let r=n.PTR_SIZE,a=n.stackAlloc(2*r);0!==n._OrtGetInputOutputMetadata(e,t,a,a+r)&&ot("Can't get session input/output metadata.");let o=Number(n.getValue(a,"*"));i=Number(n.getValue(a+r,"*"));let s=n.HEAP32[i/4];if(0===s)return[o,0];let c=n.HEAPU32[i/4+1],l=[];for(let e=0;e<c;e++){let t=Number(n.getValue(i+8+e*r,"*"));l.push(0!==t?n.UTF8ToString(t):Number(n.getValue(i+8+(e+c)*r,"*")))}return[o,s,l]}finally{n.stackRestore(r),0!==i&&n._OrtFree(i)}},Yu=e=>{let t=rt(),n=t._malloc(e.byteLength);if(0===n)throw new Error("Can't create a session. failed to allocate a buffer of size ".concat(e.byteLength,"."));return t.HEAPU8.set(e,n),[n,e.byteLength]},Ju=async(e,t)=>{let n,r,i=rt();Array.isArray(e)?[n,r]=e:e.buffer===i.HEAPU8.buffer?[n,r]=[e.byteOffset,e.byteLength]:[n,r]=Yu(e);let a=0,o=0,s=0,c=[],l=[],u=[];try{var d,h;if([o,c]=await ft(t),null!==t&&void 0!==t&&t.externalData&&i.mountExternalData){let e=[];for(let n of t.externalData){let t="string"==typeof n?n:n.path;e.push(xt("string"==typeof n?n:n.data).then(e=>{i.mountExternalData(t,e)}))}await Promise.all(e)}for(let n of null!==(f=null===t||void 0===t?void 0:t.executionProviders)&&void 0!==f?f:[]){var f;if("webnn"===("string"==typeof n?n:n.name)){if(i.shouldTransferToMLTensor=!1,"string"!=typeof n){let e=n,t=null===e||void 0===e?void 0:e.context,r=null===e||void 0===e?void 0:e.gpuDevice,a=null===e||void 0===e?void 0:e.deviceType,o=null===e||void 0===e?void 0:e.powerPreference;i.currentContext=t||(r?await i.webnnCreateMLContext(r):await i.webnnCreateMLContext({deviceType:a,powerPreference:o}))}else i.currentContext=await i.webnnCreateMLContext();break}}a=await i._OrtCreateSession(n,r,o),null!==(d=i.webgpuOnCreateSession)&&void 0!==d&&d.call(i,a),0===a&&ot("Can't create a session."),null!==(h=i.jsepOnCreateSession)&&void 0!==h&&h.call(i),i.currentContext&&(i.webnnRegisterMLContext(a,i.currentContext),i.currentContext=void 0,i.shouldTransferToMLTensor=!0);let[e,g]=Qu(a),y=!(null===t||void 0===t||!t.enableGraphCapture),v=[],w=[],b=[],_=[],x=[];for(let t=0;t<e;t++){let[e,n,r]=Xu(a,t);0===e&&ot("Can't get an input name."),l.push(e);let o=i.UTF8ToString(e);v.push(o),b.push(0===n?{name:o,isTensor:!1}:{name:o,isTensor:!0,type:mt(n),shape:r})}for(let n=0;n<g;n++){let[r,o,s]=Xu(a,n+e);0===r&&ot("Can't get an output name."),u.push(r);let c=i.UTF8ToString(r);w.push(c),_.push(0===o?{name:c,isTensor:!1}:{name:c,isTensor:!0,type:mt(o),shape:s});{var p,m;if(y&&void 0===(null===t||void 0===t?void 0:t.preferredOutputLocation)){x.push("gpu-buffer");continue}let e="string"==typeof(null===t||void 0===t?void 0:t.preferredOutputLocation)?t.preferredOutputLocation:null!==(p=null===t||void 0===t||null===(m=t.preferredOutputLocation)||void 0===m?void 0:m[c])&&void 0!==p?p:"cpu",n=i.webnnIsGraphOutput;if("cpu"===e&&n&&n(a,c)){x.push("ml-tensor-cpu-output");continue}if("cpu"!==e&&"cpu-pinned"!==e&&"gpu-buffer"!==e&&"ml-tensor"!==e)throw new Error("Not supported preferred output location: ".concat(e,"."));if(y&&"gpu-buffer"!==e)throw new Error("Not supported preferred output location: ".concat(e,". Only 'gpu-buffer' location is supported when enableGraphCapture is true."));x.push(e)}}let E=null;return x.some(e=>"gpu-buffer"===e||"ml-tensor"===e||"ml-tensor-cpu-output"===e)&&(s=i._OrtCreateBinding(a),0===s&&ot("Can't create IO binding."),E={handle:s,outputPreferredLocations:x,outputPreferredLocationsEncoded:x.map(e=>"ml-tensor-cpu-output"===e?"ml-tensor":e).map(e=>_t(e))}),Ku.set(a,[a,l,u,E,y,!1]),[a,v,w,b,_]}catch(P_){throw l.forEach(e=>i._OrtFree(e)),u.forEach(e=>i._OrtFree(e)),0!==s&&0!==i._OrtReleaseBinding(s)&&ot("Can't release IO binding."),0!==a&&0!==i._OrtReleaseSession(a)&&ot("Can't release session."),P_}finally{var g;i._free(n),0!==o&&0!==i._OrtReleaseSessionOptions(o)&&ot("Can't release session options."),c.forEach(e=>i._free(e)),null===(g=i.unmountExternalData)||void 0===g||g.call(i)}},$u=e=>{var t,n,r;let i=rt(),a=Ku.get(e);if(!a)throw new Error("cannot release session. invalid session id: ".concat(e));let[o,s,c,l,u]=a;l&&(u&&0!==i._OrtClearBoundOutputs(l.handle)&&ot("Can't clear bound outputs."),0!==i._OrtReleaseBinding(l.handle)&&ot("Can't release IO binding.")),null!==(t=i.jsepOnReleaseSession)&&void 0!==t&&t.call(i,e),null!==(n=i.webnnOnReleaseSession)&&void 0!==n&&n.call(i,e),null!==(r=i.webgpuOnReleaseSession)&&void 0!==r&&r.call(i,e),s.forEach(e=>i._OrtFree(e)),c.forEach(e=>i._OrtFree(e)),0!==i._OrtReleaseSession(o)&&ot("Can't release session."),Ku.delete(e)},Zu=async function(e,t,n,r,i,a){let o=arguments.length>6&&void 0!==arguments[6]&&arguments[6];if(!e)return void t.push(0);let s,c,l=rt(),u=l.PTR_SIZE,d=e[0],h=e[1],f=e[3],p=f;if("string"===d&&("gpu-buffer"===f||"ml-tensor"===f))throw new Error("String tensor is not supported on GPU.");if(o&&"gpu-buffer"!==f)throw new Error("External buffer must be provided for input/output index ".concat(a," when enableGraphCapture is true."));if("gpu-buffer"===f){let t=e[2].gpuBuffer;c=gt(pt(d),h);{let e=l.jsepRegisterBuffer;if(!e)throw new Error('Tensor location "gpu-buffer" is not supported without using WebGPU.');s=e(r,a,t,c)}}else if("ml-tensor"===f){let t=e[2].mlTensor;c=gt(pt(d),h);let n=l.webnnRegisterMLTensor;if(!n)throw new Error('Tensor location "ml-tensor" is not supported without using WebNN.');s=n(r,t,pt(d),h)}else{let t=e[2];if(Array.isArray(t)){c=u*t.length,s=l._malloc(c),n.push(s);for(let e=0;e<t.length;e++){if("string"!=typeof t[e])throw new TypeError("tensor data at index ".concat(e," is not a string"));l.setValue(s+e*u,it(t[e],n),"*")}}else{let e=l.webnnIsGraphInput,a=l.webnnIsGraphOutput;if("string"!==d&&e&&a){let o=l.UTF8ToString(i);if(e(r,o)||a(r,o)){let e=pt(d);c=gt(e,h),p="ml-tensor";let n=l.webnnCreateTemporaryTensor,i=l.webnnUploadTensor;if(!n||!i)throw new Error('Tensor location "ml-tensor" is not supported without using WebNN.');let a=await n(r,e,h);i(a,new Uint8Array(t.buffer,t.byteOffset,t.byteLength)),s=a}else c=t.byteLength,s=l._malloc(c),n.push(s),l.HEAPU8.set(new Uint8Array(t.buffer,t.byteOffset,c),s)}else c=t.byteLength,s=l._malloc(c),n.push(s),l.HEAPU8.set(new Uint8Array(t.buffer,t.byteOffset,c),s)}}let m=l.stackSave(),g=l.stackAlloc(4*h.length);try{h.forEach((e,t)=>l.setValue(g+t*u,e,4===u?"i32":"i64"));let e=l._OrtCreateTensor(pt(d),s,c,g,h.length,_t(p));0===e&&ot("Can't create tensor for input/output. session=".concat(r,", index=").concat(a,".")),t.push(e)}finally{l.stackRestore(m)}},ed=async(e,t,n,r,i,a)=>{let o=rt(),s=o.PTR_SIZE,c=Ku.get(e);if(!c)throw new Error("cannot run inference. invalid session id: ".concat(e));let l=c[0],u=c[1],d=c[2],h=c[3],f=c[4],p=c[5],m=t.length,g=r.length,y=0,v=[],w=[],b=[],_=[],x=o.stackSave(),E=o.stackAlloc(m*s),S=o.stackAlloc(m*s),k=o.stackAlloc(g*s),T=o.stackAlloc(g*s);try{var I,C;[y,v]=st(a),Q("wasm prepareInputOutputTensor");for(let r=0;r<m;r++)await Zu(n[r],w,_,e,u[t[r]],t[r],f);for(let t=0;t<g;t++)await Zu(i[t],b,_,e,d[r[t]],m+r[t],f);X("wasm prepareInputOutputTensor");for(let e=0;e<m;e++)o.setValue(E+e*s,w[e],"*"),o.setValue(S+e*s,u[t[e]],"*");for(let e=0;e<g;e++)o.setValue(k+e*s,b[e],"*"),o.setValue(T+e*s,d[r[e]],"*");if(h&&!p){let{handle:n,outputPreferredLocations:a,outputPreferredLocationsEncoded:s}=h;if(u.length!==m)throw new Error("input count from feeds (".concat(m,") is expected to be always equal to model's input count (").concat(u.length,")."));Q("wasm bindInputsOutputs");for(let r=0;r<m;r++){let i=t[r];0!==await o._OrtBindInput(n,u[i],w[r])&&ot("Can't bind input[".concat(r,"] for session=").concat(e,"."))}for(let t=0;t<g;t++){var A;let c=r[t];null!==(A=i[t])&&void 0!==A&&A[3]?0!==o._OrtBindOutput(n,d[c],b[t],0)&&ot("Can't bind pre-allocated output[".concat(t,"] for session=").concat(e,".")):0!==o._OrtBindOutput(n,d[c],0,s[c])&&ot("Can't bind output[".concat(t,"] to ").concat(a[t]," for session=").concat(e,"."))}X("wasm bindInputsOutputs"),Ku.set(e,[l,u,d,h,f,!0])}let c;null!==(I=o.jsepOnRunStart)&&void 0!==I&&I.call(o,l),null===(C=o.webnnOnRunStart)||void 0===C||C.call(o,l),c=h?await o._OrtRunWithBinding(l,h.handle,g,k,y):await o._OrtRun(l,S,E,m,T,g,k,y),0!==c&&ot("failed to call OrtRun().");let x=[],O=[];Q("wasm ProcessOutputTensor");for(let t=0;t<g;t++){let n=Number(o.getValue(k+t*s,"*"));if(n===b[t]){x.push(i[t]);continue}let a,c=o.stackSave(),l=o.stackAlloc(4*s),u=!1,d=0;try{0!==o._OrtGetTensorData(n,l,l+s,l+2*s,l+3*s)&&ot("Can't access output tensor data on index ".concat(t,"."));let i=4===s?"i32":"i64",c=Number(o.getValue(l,i));d=o.getValue(l+s,"*");let f=o.getValue(l+2*s,"*"),p=Number(o.getValue(l+3*s,i)),m=[];for(let e=0;e<p;e++)m.push(Number(o.getValue(f+e*s,i)));0!==o._OrtFree(f)&&ot("Can't free memory for tensor dims.");let g=m.reduce((e,t)=>e*t,1);a=mt(c);let y=null===h||void 0===h?void 0:h.outputPreferredLocations[r[t]];if("string"===a){if("gpu-buffer"===y||"ml-tensor"===y)throw new Error("String tensor is not supported on GPU.");let e=[];for(let t=0;t<g;t++){let n=o.getValue(d+t*s,"*"),r=o.getValue(d+(t+1)*s,"*"),i=t===g-1?void 0:r-n;e.push(o.UTF8ToString(n,i))}x.push([a,m,e,"cpu"])}else if("gpu-buffer"===y&&g>0){let e=o.jsepGetBuffer;if(!e)throw new Error('preferredLocation "gpu-buffer" is not supported without using WebGPU.');let t=e(d),r=gt(c,g);if(void 0===r||!wt(a))throw new Error("Unsupported data type: ".concat(a));u=!0,x.push([a,m,{gpuBuffer:t,download:o.jsepCreateDownloader(t,r,a),dispose:()=>{0!==o._OrtReleaseTensor(n)&&ot("Can't release tensor.")}},"gpu-buffer"])}else if("ml-tensor"===y&&g>0){let t=o.webnnEnsureTensor,r=o.webnnIsGraphInputOutputTypeSupported;if(!t||!r)throw new Error('preferredLocation "ml-tensor" is not supported without using WebNN.');if(void 0===gt(c,g)||!bt(a))throw new Error("Unsupported data type: ".concat(a));if(!r(e,a,!1))throw new Error('preferredLocation "ml-tensor" for '.concat(a," output is not supported by current WebNN Context."));let i=await t(e,d,c,m,!1);u=!0,x.push([a,m,{mlTensor:i,download:o.webnnCreateMLTensorDownloader(d,a),dispose:()=>{o.webnnReleaseTensorId(d),o._OrtReleaseTensor(n)}},"ml-tensor"])}else if("ml-tensor-cpu-output"===y&&g>0){let e=o.webnnCreateMLTensorDownloader(d,a)(),t=x.length;u=!0,O.push((async()=>{let r=[t,await e];return o.webnnReleaseTensorId(d),o._OrtReleaseTensor(n),r})()),x.push([a,m,[],"cpu"])}else{let e=new(yt(a))(g);new Uint8Array(e.buffer,e.byteOffset,e.byteLength).set(o.HEAPU8.subarray(d,d+e.byteLength)),x.push([a,m,e,"cpu"])}}finally{o.stackRestore(c),"string"===a&&d&&o._free(d),u||o._OrtReleaseTensor(n)}}h&&!f&&(0!==o._OrtClearBoundOutputs(h.handle)&&ot("Can't clear bound outputs."),Ku.set(e,[l,u,d,h,f,!1]));for(let[e,t]of await Promise.all(O))x[e][2]=t;return X("wasm ProcessOutputTensor"),x}finally{var O;null!==(O=o.webnnOnRunEnd)&&void 0!==O&&O.call(o,l),o.stackRestore(x),w.forEach(e=>o._OrtReleaseTensor(e)),b.forEach(e=>o._OrtReleaseTensor(e)),_.forEach(e=>o._free(e)),0!==y&&o._OrtReleaseRunOptions(y),v.forEach(e=>o._free(e))}},td=e=>{let t=rt(),n=Ku.get(e);if(!n)throw new Error("invalid session id");let r=n[0],i=t._OrtEndProfiling(r);0===i&&ot("Can't get an profile file name."),t._OrtFree(i)},nd=e=>{let t=[];for(let n of e){let e=n[2];!Array.isArray(e)&&"buffer"in e&&t.push(e.buffer)}return t}}),Td=re(()=>{ke(),kd(),wl(),vl(),rd=()=>!!I.wasm.proxy&&typeof document<"u",ad=!1,od=!1,sd=!1,ud=new Map,dd=(e,t)=>{let n=ud.get(e);n?n.push(t):ud.set(e,[t])},hd=()=>{if(ad||!od||sd||!id)throw new Error("worker not ready")},fd=e=>{switch(e.data.type){case"init-wasm":ad=!1,e.data.err?(sd=!0,ld[1](e.data.err)):(od=!0,ld[0]()),cd&&(URL.revokeObjectURL(cd),cd=void 0);break;case"init-ep":case"copy-from":case"create":case"release":case"run":case"end-profiling":{let t=ud.get(e.data.type);e.data.err?t.shift()[1](e.data.err):t.shift()[0](e.data.out);break}}},pd=async()=>{if(!od){if(ad)throw new Error("multiple calls to 'initWasm()' detected.");if(sd)throw new Error("previous call to 'initWasm()' failed.");if(ad=!0,rd())return new Promise((e,t)=>{var r;null!==(r=id)&&void 0!==r&&r.terminate(),Ge().then(r=>{let[i,a]=r;try{(id=a).onerror=e=>t(e),id.onmessage=fd,ld=[e,t];let r={type:"init-wasm",in:I};!r.in.wasm.wasmPaths&&(i||Me)&&(r.in.wasm.wasmPaths={wasm:new URL(n(98),n.b).href}),id.postMessage(r),cd=i}catch(O_){t(O_)}},t)});try{await nt(I.wasm),await Wu(I),od=!0}catch(S_){throw sd=!0,S_}finally{ad=!1}}},md=async e=>{if(rd())return hd(),new Promise((t,n)=>{dd("init-ep",[t,n]);let r={type:"init-ep",in:{epName:e,env:I}};id.postMessage(r)});await Gu(I,e)},gd=async e=>rd()?(hd(),new Promise((t,n)=>{dd("copy-from",[t,n]);let r={type:"copy-from",in:{buffer:e}};id.postMessage(r,[e.buffer])})):Yu(e),yd=async(e,t)=>{if(rd()){if(null!==t&&void 0!==t&&t.preferredOutputLocation)throw new Error('session option "preferredOutputLocation" is not supported for proxy.');return hd(),new Promise((n,r)=>{dd("create",[n,r]);let i={type:"create",in:{model:e,options:l({},t)}},a=[];e instanceof Uint8Array&&a.push(e.buffer),id.postMessage(i,a)})}return Ju(e,t)},vd=async e=>{if(rd())return hd(),new Promise((t,n)=>{dd("release",[t,n]);let r={type:"release",in:e};id.postMessage(r)});$u(e)},wd=async(e,t,n,r,i,a)=>{if(rd()){if(n.some(e=>"cpu"!==e[3]))throw new Error("input tensor on GPU is not supported for proxy.");if(i.some(e=>e))throw new Error("pre-allocated output tensor is not supported for proxy.");return hd(),new Promise((i,o)=>{dd("run",[i,o]);let s=n,c={type:"run",in:{sessionId:e,inputIndices:t,inputs:s,outputIndices:r,options:a}};id.postMessage(c,nd(s))})}return ed(e,t,n,r,i,a)},bd=async e=>{if(rd())return hd(),new Promise((t,n)=>{dd("end-profiling",[t,n]);let r={type:"end-profiling",in:e};id.postMessage(r)});td(e)}}),Id=re(()=>{ke(),Td(),El(),Te(),Sl(),_d=(e,t)=>{switch(e.location){case"cpu":return[e.type,e.dims,e.data,"cpu"];case"gpu-buffer":return[e.type,e.dims,{gpuBuffer:e.gpuBuffer},"gpu-buffer"];case"ml-tensor":return[e.type,e.dims,{mlTensor:e.mlTensor},"ml-tensor"];default:throw new Error("invalid data location: ".concat(e.location," for ").concat(t()))}},xd=e=>{switch(e[3]){case"cpu":return new q(e[0],e[2],e[1]);case"gpu-buffer":{let t=e[0];if(!wt(t))throw new Error("not supported data type: ".concat(t," for deserializing GPU tensor"));let{gpuBuffer:n,download:r,dispose:i}=e[2];return q.fromGpuBuffer(n,{dataType:t,dims:e[1],download:r,dispose:i})}case"ml-tensor":{let t=e[0];if(!bt(t))throw new Error("not supported data type: ".concat(t," for deserializing MLTensor tensor"));let{mlTensor:n,download:r,dispose:i}=e[2];return q.fromMLTensor(n,{dataType:t,dims:e[1],download:r,dispose:i})}default:throw new Error("invalid data location: ".concat(e[3]))}},Ed=class{async fetchModelAndCopyToWasmMemory(e){return gd(await xt(e))}async loadModel(e,t){let n;G(),n="string"==typeof e?await this.fetchModelAndCopyToWasmMemory(e):e,[this.sessionId,this.inputNames,this.outputNames,this.inputMetadata,this.outputMetadata]=await yd(n,t),K()}async dispose(){return vd(this.sessionId)}async run(e,t,n){G();let r=[],i=[];Object.entries(e).forEach(e=>{let t=e[0],n=e[1],a=this.inputNames.indexOf(t);if(-1===a)throw new Error("invalid input '".concat(t,"'"));r.push(n),i.push(a)});let a=[],o=[];Object.entries(t).forEach(e=>{let t=e[0],n=e[1],r=this.outputNames.indexOf(t);if(-1===r)throw new Error("invalid output '".concat(t,"'"));a.push(n),o.push(r)});let s=r.map((e,t)=>_d(e,()=>'input "'.concat(this.inputNames[i[t]],'"'))),c=a.map((e,t)=>e?_d(e,()=>'output "'.concat(this.outputNames[o[t]],'"')):null),l=await wd(this.sessionId,i,s,o,c,n),u={};for(let h=0;h<l.length;h++){var d;u[this.outputNames[o[h]]]=null!==(d=a[h])&&void 0!==d?d:xd(l[h])}return K(),u}startProfiling(){}endProfiling(){bd(this.sessionId)}}}),Cd={};ie(Cd,{OnnxruntimeWebAssemblyBackend:()=>Od,initializeFlags:()=>Ad,wasmBackend:()=>Nd});var Ad,Od,Nd,Rd=re(()=>{ke(),Td(),Id(),Ad=()=>{("number"!=typeof I.wasm.initTimeout||I.wasm.initTimeout<0)&&(I.wasm.initTimeout=0);let e=I.wasm.simd;if("boolean"!=typeof e&&void 0!==e&&"fixed"!==e&&"relaxed"!==e&&(console.warn('Property "env.wasm.simd" is set to unknown value "'.concat(e,'". Reset it to `false` and ignore SIMD feature checking.')),I.wasm.simd=!1),"boolean"!=typeof I.wasm.proxy&&(I.wasm.proxy=!1),"boolean"!=typeof I.wasm.trace&&(I.wasm.trace=!1),"number"!=typeof I.wasm.numThreads||!Number.isInteger(I.wasm.numThreads)||I.wasm.numThreads<=0)if(typeof self<"u"&&!self.crossOriginIsolated)I.wasm.numThreads=1;else{let e=typeof navigator>"u"?ne("node:os").cpus().length:navigator.hardwareConcurrency;I.wasm.numThreads=Math.min(4,Math.ceil((e||1)/2))}},Od=class{async init(e){Ad(),await pd(),await md(e)}async createInferenceSessionHandler(e,t){let n=new Ed;return await n.loadModel(e,t),n}},Nd=new Od});ke(),ke(),ke();{let e=(Rd(),ae(Cd)).wasmBackend;_("webgpu",e,5),_("webnn",e,5),_("cpu",e,10),_("wasm",e,10)}Object.defineProperty(I.versions,"web",{value:"1.23.2",enumerable:!0});const Pd=h("Navigation",[["polygon",{points:"3 11 22 2 13 21 11 13 3 11",key:"1ltx0t"}]]),Dd=h("MapPin",[["path",{d:"M20 10c0 6-8 12-8 12s-8-6-8-12a8 8 0 0 1 16 0Z",key:"2oe9fu"}],["circle",{cx:"12",cy:"10",r:"3",key:"ilqhr7"}]]),zd=h("Map",[["polygon",{points:"3 6 9 3 15 6 21 3 21 18 15 21 9 18 3 21",key:"ok2ie8"}],["line",{x1:"9",x2:"9",y1:"3",y2:"18",key:"w34qz5"}],["line",{x1:"15",x2:"15",y1:"6",y2:"21",key:"volv9a"}]]),Md=h("Lock",[["rect",{width:"18",height:"11",x:"3",y:"11",rx:"2",ry:"2",key:"1w4ew1"}],["path",{d:"M7 11V7a5 5 0 0 1 10 0v4",key:"fwvmzm"}]]),Ld=function(e){const t=[];let n=0;for(let r=0;r<e.length;r++){let i=e.charCodeAt(r);i<128?t[n++]=i:i<2048?(t[n++]=i>>6|192,t[n++]=63&i|128):55296===(64512&i)&&r+1<e.length&&56320===(64512&e.charCodeAt(r+1))?(i=65536+((1023&i)<<10)+(1023&e.charCodeAt(++r)),t[n++]=i>>18|240,t[n++]=i>>12&63|128,t[n++]=i>>6&63|128,t[n++]=63&i|128):(t[n++]=i>>12|224,t[n++]=i>>6&63|128,t[n++]=63&i|128)}return t},Ud={byteToCharMap_:null,charToByteMap_:null,byteToCharMapWebSafe_:null,charToByteMapWebSafe_:null,ENCODED_VALS_BASE:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",get ENCODED_VALS(){return this.ENCODED_VALS_BASE+"+/="},get ENCODED_VALS_WEBSAFE(){return this.ENCODED_VALS_BASE+"-_."},HAS_NATIVE_SUPPORT:"function"===typeof atob,encodeByteArray(e,t){if(!Array.isArray(e))throw Error("encodeByteArray takes an array as a parameter");this.init_();const n=t?this.byteToCharMapWebSafe_:this.byteToCharMap_,r=[];for(let i=0;i<e.length;i+=3){const t=e[i],a=i+1<e.length,o=a?e[i+1]:0,s=i+2<e.length,c=s?e[i+2]:0,l=t>>2,u=(3&t)<<4|o>>4;let d=(15&o)<<2|c>>6,h=63&c;s||(h=64,a||(d=64)),r.push(n[l],n[u],n[d],n[h])}return r.join("")},encodeString(e,t){return this.HAS_NATIVE_SUPPORT&&!t?btoa(e):this.encodeByteArray(Ld(e),t)},decodeString(e,t){return this.HAS_NATIVE_SUPPORT&&!t?atob(e):function(e){const t=[];let n=0,r=0;for(;n<e.length;){const i=e[n++];if(i<128)t[r++]=String.fromCharCode(i);else if(i>191&&i<224){const a=e[n++];t[r++]=String.fromCharCode((31&i)<<6|63&a)}else if(i>239&&i<365){const a=((7&i)<<18|(63&e[n++])<<12|(63&e[n++])<<6|63&e[n++])-65536;t[r++]=String.fromCharCode(55296+(a>>10)),t[r++]=String.fromCharCode(56320+(1023&a))}else{const a=e[n++],o=e[n++];t[r++]=String.fromCharCode((15&i)<<12|(63&a)<<6|63&o)}}return t.join("")}(this.decodeStringToByteArray(e,t))},decodeStringToByteArray(e,t){this.init_();const n=t?this.charToByteMapWebSafe_:this.charToByteMap_,r=[];for(let i=0;i<e.length;){const t=n[e.charAt(i++)],a=i<e.length?n[e.charAt(i)]:0;++i;const o=i<e.length?n[e.charAt(i)]:64;++i;const s=i<e.length?n[e.charAt(i)]:64;if(++i,null==t||null==a||null==o||null==s)throw new Bd;const c=t<<2|a>>4;if(r.push(c),64!==o){const e=a<<4&240|o>>2;if(r.push(e),64!==s){const e=o<<6&192|s;r.push(e)}}}return r},init_(){if(!this.byteToCharMap_){this.byteToCharMap_={},this.charToByteMap_={},this.byteToCharMapWebSafe_={},this.charToByteMapWebSafe_={};for(let e=0;e<this.ENCODED_VALS.length;e++)this.byteToCharMap_[e]=this.ENCODED_VALS.charAt(e),this.charToByteMap_[this.byteToCharMap_[e]]=e,this.byteToCharMapWebSafe_[e]=this.ENCODED_VALS_WEBSAFE.charAt(e),this.charToByteMapWebSafe_[this.byteToCharMapWebSafe_[e]]=e,e>=this.ENCODED_VALS_BASE.length&&(this.charToByteMap_[this.ENCODED_VALS_WEBSAFE.charAt(e)]=e,this.charToByteMapWebSafe_[this.ENCODED_VALS.charAt(e)]=e)}}};class Bd extends Error{constructor(){super(...arguments),this.name="DecodeBase64StringError"}}const Fd=function(e){return function(e){const t=Ld(e);return Ud.encodeByteArray(t,!0)}(e).replace(/\./g,"")},jd=function(e){try{return Ud.decodeString(e,!0)}catch(S_){console.error("base64Decode failed: ",S_)}return null};const Vd=()=>function(){if("undefined"!==typeof self)return self;if("undefined"!==typeof window)return window;if("undefined"!==typeof n.g)return n.g;throw new Error("Unable to locate global object.")}().__FIREBASE_DEFAULTS__,qd=()=>{try{return Vd()||(()=>{if("undefined"===typeof process)return;const e={NODE_ENV:"production",PUBLIC_URL:"/reef-monitor-app",WDS_SOCKET_HOST:void 0,WDS_SOCKET_PATH:void 0,WDS_SOCKET_PORT:void 0,FAST_REFRESH:!0}.__FIREBASE_DEFAULTS__;return e?JSON.parse(e):void 0})()||(()=>{if("undefined"===typeof document)return;let e;try{e=document.cookie.match(/__FIREBASE_DEFAULTS__=([^;]+)/)}catch(S_){return}const t=e&&jd(e[1]);return t&&JSON.parse(t)})()}catch(S_){return void console.info("Unable to get __FIREBASE_DEFAULTS__ due to: ".concat(S_))}},Hd=e=>{var t,n;return null===(n=null===(t=qd())||void 0===t?void 0:t.emulatorHosts)||void 0===n?void 0:n[e]},Wd=e=>{const t=Hd(e);if(!t)return;const n=t.lastIndexOf(":");if(n<=0||n+1===t.length)throw new Error("Invalid host ".concat(t," with no separate hostname and port!"));const r=parseInt(t.substring(n+1),10);return"["===t[0]?[t.substring(1,n-1),r]:[t.substring(0,n),r]},Gd=()=>{var e;return null===(e=qd())||void 0===e?void 0:e.config},Kd=e=>{var t;return null===(t=qd())||void 0===t?void 0:t["_".concat(e)]};class Qd{constructor(){this.reject=()=>{},this.resolve=()=>{},this.promise=new Promise((e,t)=>{this.resolve=e,this.reject=t})}wrapCallback(e){return(t,n)=>{t?this.reject(t):this.resolve(n),"function"===typeof e&&(this.promise.catch(()=>{}),1===e.length?e(t):e(t,n))}}}function Xd(e,t){if(e.uid)throw new Error('The "uid" field is no longer supported by mockUserToken. Please use "sub" instead for Firebase Auth User ID.');const n=t||"demo-project",r=e.iat||0,i=e.sub||e.user_id;if(!i)throw new Error("mockUserToken must contain 'sub' or 'user_id' field!");const a=Object.assign({iss:"https://securetoken.google.com/".concat(n),aud:n,iat:r,exp:r+3600,auth_time:r,sub:i,user_id:i,firebase:{sign_in_provider:"custom",identities:{}}},e);return[Fd(JSON.stringify({alg:"none",type:"JWT"})),Fd(JSON.stringify(a)),""].join(".")}function Yd(){return"undefined"!==typeof navigator&&"string"===typeof navigator.userAgent?navigator.userAgent:""}function Jd(){return!function(){var e;const t=null===(e=qd())||void 0===e?void 0:e.forceEnvironment;if("node"===t)return!0;if("browser"===t)return!1;try{return"[object process]"===Object.prototype.toString.call(n.g.process)}catch(S_){return!1}}()&&!!navigator.userAgent&&navigator.userAgent.includes("Safari")&&!navigator.userAgent.includes("Chrome")}function $d(){try{return"object"===typeof indexedDB}catch(S_){return!1}}class Zd extends Error{constructor(e,t,n){super(t),this.code=e,this.customData=n,this.name="FirebaseError",Object.setPrototypeOf(this,Zd.prototype),Error.captureStackTrace&&Error.captureStackTrace(this,eh.prototype.create)}}class eh{constructor(e,t,n){this.service=e,this.serviceName=t,this.errors=n}create(e){const t=(arguments.length<=1?void 0:arguments[1])||{},n="".concat(this.service,"/").concat(e),r=this.errors[e],i=r?function(e,t){return e.replace(th,(e,n)=>{const r=t[n];return null!=r?String(r):"<".concat(n,"?>")})}(r,t):"Error",a="".concat(this.serviceName,": ").concat(i," (").concat(n,").");return new Zd(n,a,t)}}const th=/\{\$([^}]+)}/g;function nh(e,t){if(e===t)return!0;const n=Object.keys(e),r=Object.keys(t);for(const i of n){if(!r.includes(i))return!1;const n=e[i],a=t[i];if(rh(n)&&rh(a)){if(!nh(n,a))return!1}else if(n!==a)return!1}for(const i of r)if(!n.includes(i))return!1;return!0}function rh(e){return null!==e&&"object"===typeof e}function ih(e){const t=[];for(const[n,r]of Object.entries(e))Array.isArray(r)?r.forEach(e=>{t.push(encodeURIComponent(n)+"="+encodeURIComponent(e))}):t.push(encodeURIComponent(n)+"="+encodeURIComponent(r));return t.length?"&"+t.join("&"):""}function ah(e){const t={};return e.replace(/^\?/,"").split("&").forEach(e=>{if(e){const[n,r]=e.split("=");t[decodeURIComponent(n)]=decodeURIComponent(r)}}),t}function oh(e){const t=e.indexOf("?");if(!t)return"";const n=e.indexOf("#",t);return e.substring(t,n>0?n:void 0)}class sh{constructor(e,t){this.observers=[],this.unsubscribes=[],this.observerCount=0,this.task=Promise.resolve(),this.finalized=!1,this.onNoObservers=t,this.task.then(()=>{e(this)}).catch(e=>{this.error(e)})}next(e){this.forEachObserver(t=>{t.next(e)})}error(e){this.forEachObserver(t=>{t.error(e)}),this.close(e)}complete(){this.forEachObserver(e=>{e.complete()}),this.close()}subscribe(e,t,n){let r;if(void 0===e&&void 0===t&&void 0===n)throw new Error("Missing Observer.");r=function(e,t){if("object"!==typeof e||null===e)return!1;for(const n of t)if(n in e&&"function"===typeof e[n])return!0;return!1}(e,["next","error","complete"])?e:{next:e,error:t,complete:n},void 0===r.next&&(r.next=ch),void 0===r.error&&(r.error=ch),void 0===r.complete&&(r.complete=ch);const i=this.unsubscribeOne.bind(this,this.observers.length);return this.finalized&&this.task.then(()=>{try{this.finalError?r.error(this.finalError):r.complete()}catch(S_){}}),this.observers.push(r),i}unsubscribeOne(e){void 0!==this.observers&&void 0!==this.observers[e]&&(delete this.observers[e],this.observerCount-=1,0===this.observerCount&&void 0!==this.onNoObservers&&this.onNoObservers(this))}forEachObserver(e){if(!this.finalized)for(let t=0;t<this.observers.length;t++)this.sendOne(t,e)}sendOne(e,t){this.task.then(()=>{if(void 0!==this.observers&&void 0!==this.observers[e])try{t(this.observers[e])}catch(S_){"undefined"!==typeof console&&console.error&&console.error(S_)}})}close(e){this.finalized||(this.finalized=!0,void 0!==e&&(this.finalError=e),this.task.then(()=>{this.observers=void 0,this.onNoObservers=void 0}))}}function ch(){}function lh(e){return e&&e._delegate?e._delegate:e}class uh{constructor(e,t,n){this.name=e,this.instanceFactory=t,this.type=n,this.multipleInstances=!1,this.serviceProps={},this.instantiationMode="LAZY",this.onInstanceCreated=null}setInstantiationMode(e){return this.instantiationMode=e,this}setMultipleInstances(e){return this.multipleInstances=e,this}setServiceProps(e){return this.serviceProps=e,this}setInstanceCreatedCallback(e){return this.onInstanceCreated=e,this}}const dh="[DEFAULT]";class hh{constructor(e,t){this.name=e,this.container=t,this.component=null,this.instances=new Map,this.instancesDeferred=new Map,this.instancesOptions=new Map,this.onInitCallbacks=new Map}get(e){const t=this.normalizeInstanceIdentifier(e);if(!this.instancesDeferred.has(t)){const e=new Qd;if(this.instancesDeferred.set(t,e),this.isInitialized(t)||this.shouldAutoInitialize())try{const n=this.getOrInitializeService({instanceIdentifier:t});n&&e.resolve(n)}catch(S_){}}return this.instancesDeferred.get(t).promise}getImmediate(e){var t;const n=this.normalizeInstanceIdentifier(null===e||void 0===e?void 0:e.identifier),r=null!==(t=null===e||void 0===e?void 0:e.optional)&&void 0!==t&&t;if(!this.isInitialized(n)&&!this.shouldAutoInitialize()){if(r)return null;throw Error("Service ".concat(this.name," is not available"))}try{return this.getOrInitializeService({instanceIdentifier:n})}catch(S_){if(r)return null;throw S_}}getComponent(){return this.component}setComponent(e){if(e.name!==this.name)throw Error("Mismatching Component ".concat(e.name," for Provider ").concat(this.name,"."));if(this.component)throw Error("Component for ".concat(this.name," has already been provided"));if(this.component=e,this.shouldAutoInitialize()){if(function(e){return"EAGER"===e.instantiationMode}(e))try{this.getOrInitializeService({instanceIdentifier:dh})}catch(S_){}for(const[e,t]of this.instancesDeferred.entries()){const n=this.normalizeInstanceIdentifier(e);try{const e=this.getOrInitializeService({instanceIdentifier:n});t.resolve(e)}catch(S_){}}}}clearInstance(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:dh;this.instancesDeferred.delete(e),this.instancesOptions.delete(e),this.instances.delete(e)}async delete(){const e=Array.from(this.instances.values());await Promise.all([...e.filter(e=>"INTERNAL"in e).map(e=>e.INTERNAL.delete()),...e.filter(e=>"_delete"in e).map(e=>e._delete())])}isComponentSet(){return null!=this.component}isInitialized(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:dh;return this.instances.has(e)}getOptions(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:dh;return this.instancesOptions.get(e)||{}}initialize(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};const{options:t={}}=e,n=this.normalizeInstanceIdentifier(e.instanceIdentifier);if(this.isInitialized(n))throw Error("".concat(this.name,"(").concat(n,") has already been initialized"));if(!this.isComponentSet())throw Error("Component ".concat(this.name," has not been registered yet"));const r=this.getOrInitializeService({instanceIdentifier:n,options:t});for(const[i,a]of this.instancesDeferred.entries()){n===this.normalizeInstanceIdentifier(i)&&a.resolve(r)}return r}onInit(e,t){var n;const r=this.normalizeInstanceIdentifier(t),i=null!==(n=this.onInitCallbacks.get(r))&&void 0!==n?n:new Set;i.add(e),this.onInitCallbacks.set(r,i);const a=this.instances.get(r);return a&&e(a,r),()=>{i.delete(e)}}invokeOnInitCallbacks(e,t){const n=this.onInitCallbacks.get(t);if(n)for(const r of n)try{r(e,t)}catch(we){}}getOrInitializeService(e){let{instanceIdentifier:t,options:n={}}=e,r=this.instances.get(t);if(!r&&this.component&&(r=this.component.instanceFactory(this.container,{instanceIdentifier:(i=t,i===dh?void 0:i),options:n}),this.instances.set(t,r),this.instancesOptions.set(t,n),this.invokeOnInitCallbacks(r,t),this.component.onInstanceCreated))try{this.component.onInstanceCreated(this.container,t,r)}catch(we){}var i;return r||null}normalizeInstanceIdentifier(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:dh;return this.component?this.component.multipleInstances?e:dh:e}shouldAutoInitialize(){return!!this.component&&"EXPLICIT"!==this.component.instantiationMode}}class fh{constructor(e){this.name=e,this.providers=new Map}addComponent(e){const t=this.getProvider(e.name);if(t.isComponentSet())throw new Error("Component ".concat(e.name," has already been registered with ").concat(this.name));t.setComponent(e)}addOrOverwriteComponent(e){this.getProvider(e.name).isComponentSet()&&this.providers.delete(e.name),this.addComponent(e)}getProvider(e){if(this.providers.has(e))return this.providers.get(e);const t=new hh(e,this);return this.providers.set(e,t),t}getProviders(){return Array.from(this.providers.values())}}const ph=[];var mh;!function(e){e[e.DEBUG=0]="DEBUG",e[e.VERBOSE=1]="VERBOSE",e[e.INFO=2]="INFO",e[e.WARN=3]="WARN",e[e.ERROR=4]="ERROR",e[e.SILENT=5]="SILENT"}(mh||(mh={}));const gh={debug:mh.DEBUG,verbose:mh.VERBOSE,info:mh.INFO,warn:mh.WARN,error:mh.ERROR,silent:mh.SILENT},yh=mh.INFO,vh={[mh.DEBUG]:"log",[mh.VERBOSE]:"log",[mh.INFO]:"info",[mh.WARN]:"warn",[mh.ERROR]:"error"},wh=function(e,t){if(t<e.logLevel)return;const n=(new Date).toISOString(),r=vh[t];if(!r)throw new Error("Attempted to log a message with an invalid logType (value: ".concat(t,")"));for(var i=arguments.length,a=new Array(i>2?i-2:0),o=2;o<i;o++)a[o-2]=arguments[o];console[r]("[".concat(n,"]  ").concat(e.name,":"),...a)};class bh{constructor(e){this.name=e,this._logLevel=yh,this._logHandler=wh,this._userLogHandler=null,ph.push(this)}get logLevel(){return this._logLevel}set logLevel(e){if(!(e in mh))throw new TypeError('Invalid value "'.concat(e,'" assigned to `logLevel`'));this._logLevel=e}setLogLevel(e){this._logLevel="string"===typeof e?gh[e]:e}get logHandler(){return this._logHandler}set logHandler(e){if("function"!==typeof e)throw new TypeError("Value assigned to `logHandler` must be a function");this._logHandler=e}get userLogHandler(){return this._userLogHandler}set userLogHandler(e){this._userLogHandler=e}debug(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];this._userLogHandler&&this._userLogHandler(this,mh.DEBUG,...t),this._logHandler(this,mh.DEBUG,...t)}log(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];this._userLogHandler&&this._userLogHandler(this,mh.VERBOSE,...t),this._logHandler(this,mh.VERBOSE,...t)}info(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];this._userLogHandler&&this._userLogHandler(this,mh.INFO,...t),this._logHandler(this,mh.INFO,...t)}warn(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];this._userLogHandler&&this._userLogHandler(this,mh.WARN,...t),this._logHandler(this,mh.WARN,...t)}error(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];this._userLogHandler&&this._userLogHandler(this,mh.ERROR,...t),this._logHandler(this,mh.ERROR,...t)}}let _h,xh;const Eh=new WeakMap,Sh=new WeakMap,kh=new WeakMap,Th=new WeakMap,Ih=new WeakMap;let Ch={get(e,t,n){if(e instanceof IDBTransaction){if("done"===t)return Sh.get(e);if("objectStoreNames"===t)return e.objectStoreNames||kh.get(e);if("store"===t)return n.objectStoreNames[1]?void 0:n.objectStore(n.objectStoreNames[0])}return Nh(e[t])},set:(e,t,n)=>(e[t]=n,!0),has:(e,t)=>e instanceof IDBTransaction&&("done"===t||"store"===t)||t in e};function Ah(e){return e!==IDBDatabase.prototype.transaction||"objectStoreNames"in IDBTransaction.prototype?(xh||(xh=[IDBCursor.prototype.advance,IDBCursor.prototype.continue,IDBCursor.prototype.continuePrimaryKey])).includes(e)?function(){for(var t=arguments.length,n=new Array(t),r=0;r<t;r++)n[r]=arguments[r];return e.apply(Rh(this),n),Nh(Eh.get(this))}:function(){for(var t=arguments.length,n=new Array(t),r=0;r<t;r++)n[r]=arguments[r];return Nh(e.apply(Rh(this),n))}:function(t){for(var n=arguments.length,r=new Array(n>1?n-1:0),i=1;i<n;i++)r[i-1]=arguments[i];const a=e.call(Rh(this),t,...r);return kh.set(a,t.sort?t.sort():[t]),Nh(a)}}function Oh(e){return"function"===typeof e?Ah(e):(e instanceof IDBTransaction&&function(e){if(Sh.has(e))return;const t=new Promise((t,n)=>{const r=()=>{e.removeEventListener("complete",i),e.removeEventListener("error",a),e.removeEventListener("abort",a)},i=()=>{t(),r()},a=()=>{n(e.error||new DOMException("AbortError","AbortError")),r()};e.addEventListener("complete",i),e.addEventListener("error",a),e.addEventListener("abort",a)});Sh.set(e,t)}(e),t=e,(_h||(_h=[IDBDatabase,IDBObjectStore,IDBIndex,IDBCursor,IDBTransaction])).some(e=>t instanceof e)?new Proxy(e,Ch):e);var t}function Nh(e){if(e instanceof IDBRequest)return function(e){const t=new Promise((t,n)=>{const r=()=>{e.removeEventListener("success",i),e.removeEventListener("error",a)},i=()=>{t(Nh(e.result)),r()},a=()=>{n(e.error),r()};e.addEventListener("success",i),e.addEventListener("error",a)});return t.then(t=>{t instanceof IDBCursor&&Eh.set(t,e)}).catch(()=>{}),Ih.set(t,e),t}(e);if(Th.has(e))return Th.get(e);const t=Oh(e);return t!==e&&(Th.set(e,t),Ih.set(t,e)),t}const Rh=e=>Ih.get(e);const Ph=["get","getKey","getAll","getAllKeys","count"],Dh=["put","add","delete","clear"],zh=new Map;function Mh(e,t){if(!(e instanceof IDBDatabase)||t in e||"string"!==typeof t)return;if(zh.get(t))return zh.get(t);const n=t.replace(/FromIndex$/,""),r=t!==n,i=Dh.includes(n);if(!(n in(r?IDBIndex:IDBObjectStore).prototype)||!i&&!Ph.includes(n))return;const a=async function(e){const t=this.transaction(e,i?"readwrite":"readonly");let a=t.store;for(var o=arguments.length,s=new Array(o>1?o-1:0),c=1;c<o;c++)s[c-1]=arguments[c];return r&&(a=a.index(s.shift())),(await Promise.all([a[n](...s),i&&t.done]))[0]};return zh.set(t,a),a}Ch=(e=>l(l({},e),{},{get:(t,n,r)=>Mh(t,n)||e.get(t,n,r),has:(t,n)=>!!Mh(t,n)||e.has(t,n)}))(Ch);class Lh{constructor(e){this.container=e}getPlatformInfoString(){return this.container.getProviders().map(e=>{if(function(e){const t=e.getComponent();return"VERSION"===(null===t||void 0===t?void 0:t.type)}(e)){const t=e.getImmediate();return"".concat(t.library,"/").concat(t.version)}return null}).filter(e=>e).join(" ")}}const Uh="@firebase/app",Bh="0.10.13",Fh=new bh("@firebase/app"),jh="@firebase/app-compat",Vh="@firebase/analytics-compat",qh="@firebase/analytics",Hh="@firebase/app-check-compat",Wh="@firebase/app-check",Gh="@firebase/auth",Kh="@firebase/auth-compat",Qh="@firebase/database",Xh="@firebase/data-connect",Yh="@firebase/database-compat",Jh="@firebase/functions",$h="@firebase/functions-compat",Zh="@firebase/installations",ef="@firebase/installations-compat",tf="@firebase/messaging",nf="@firebase/messaging-compat",rf="@firebase/performance",af="@firebase/performance-compat",of="@firebase/remote-config",sf="@firebase/remote-config-compat",cf="@firebase/storage",lf="@firebase/storage-compat",uf="@firebase/firestore",df="@firebase/vertexai-preview",hf="@firebase/firestore-compat",ff="firebase",pf="[DEFAULT]",mf={[Uh]:"fire-core",[jh]:"fire-core-compat",[qh]:"fire-analytics",[Vh]:"fire-analytics-compat",[Wh]:"fire-app-check",[Hh]:"fire-app-check-compat",[Gh]:"fire-auth",[Kh]:"fire-auth-compat",[Qh]:"fire-rtdb",[Xh]:"fire-data-connect",[Yh]:"fire-rtdb-compat",[Jh]:"fire-fn",[$h]:"fire-fn-compat",[Zh]:"fire-iid",[ef]:"fire-iid-compat",[tf]:"fire-fcm",[nf]:"fire-fcm-compat",[rf]:"fire-perf",[af]:"fire-perf-compat",[of]:"fire-rc",[sf]:"fire-rc-compat",[cf]:"fire-gcs",[lf]:"fire-gcs-compat",[uf]:"fire-fst",[hf]:"fire-fst-compat",[df]:"fire-vertex","fire-js":"fire-js",[ff]:"fire-js-all"},gf=new Map,yf=new Map,vf=new Map;function wf(e,t){try{e.container.addComponent(t)}catch(S_){Fh.debug("Component ".concat(t.name," failed to register with FirebaseApp ").concat(e.name),S_)}}function bf(e){const t=e.name;if(vf.has(t))return Fh.debug("There were multiple attempts to register component ".concat(t,".")),!1;vf.set(t,e);for(const n of gf.values())wf(n,e);for(const n of yf.values())wf(n,e);return!0}function _f(e,t){const n=e.container.getProvider("heartbeat").getImmediate({optional:!0});return n&&n.triggerHeartbeat(),e.container.getProvider(t)}function xf(e){return void 0!==e.settings}const Ef=new eh("app","Firebase",{"no-app":"No Firebase App '{$appName}' has been created - call initializeApp() first","bad-app-name":"Illegal App name: '{$appName}'","duplicate-app":"Firebase App named '{$appName}' already exists with different options or config","app-deleted":"Firebase App named '{$appName}' already deleted","server-app-deleted":"Firebase Server App has been deleted","no-options":"Need to provide options, when not being deployed to hosting via source.","invalid-app-argument":"firebase.{$appName}() takes either no argument or a Firebase App instance.","invalid-log-argument":"First argument to `onLog` must be null or a function.","idb-open":"Error thrown when opening IndexedDB. Original error: {$originalErrorMessage}.","idb-get":"Error thrown when reading from IndexedDB. Original error: {$originalErrorMessage}.","idb-set":"Error thrown when writing to IndexedDB. Original error: {$originalErrorMessage}.","idb-delete":"Error thrown when deleting from IndexedDB. Original error: {$originalErrorMessage}.","finalization-registry-not-supported":"FirebaseServerApp deleteOnDeref field defined but the JS runtime does not support FinalizationRegistry.","invalid-server-app-environment":"FirebaseServerApp is not for use in browser environments."});class Sf{constructor(e,t,n){this._isDeleted=!1,this._options=Object.assign({},e),this._config=Object.assign({},t),this._name=t.name,this._automaticDataCollectionEnabled=t.automaticDataCollectionEnabled,this._container=n,this.container.addComponent(new uh("app",()=>this,"PUBLIC"))}get automaticDataCollectionEnabled(){return this.checkDestroyed(),this._automaticDataCollectionEnabled}set automaticDataCollectionEnabled(e){this.checkDestroyed(),this._automaticDataCollectionEnabled=e}get name(){return this.checkDestroyed(),this._name}get options(){return this.checkDestroyed(),this._options}get config(){return this.checkDestroyed(),this._config}get container(){return this._container}get isDeleted(){return this._isDeleted}set isDeleted(e){this._isDeleted=e}checkDestroyed(){if(this.isDeleted)throw Ef.create("app-deleted",{appName:this._name})}}const kf="10.14.1";function Tf(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=e;if("object"!==typeof t){t={name:t}}const r=Object.assign({name:pf,automaticDataCollectionEnabled:!1},t),i=r.name;if("string"!==typeof i||!i)throw Ef.create("bad-app-name",{appName:String(i)});if(n||(n=Gd()),!n)throw Ef.create("no-options");const a=gf.get(i);if(a){if(nh(n,a.options)&&nh(r,a.config))return a;throw Ef.create("duplicate-app",{appName:i})}const o=new fh(i);for(const c of vf.values())o.addComponent(c);const s=new Sf(n,r,o);return gf.set(i,s),s}function If(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:pf;const t=gf.get(e);if(!t&&e===pf&&Gd())return Tf();if(!t)throw Ef.create("no-app",{appName:e});return t}function Cf(e,t,n){var r;let i=null!==(r=mf[e])&&void 0!==r?r:e;n&&(i+="-".concat(n));const a=i.match(/\s|\//),o=t.match(/\s|\//);if(a||o){const e=['Unable to register library "'.concat(i,'" with version "').concat(t,'":')];return a&&e.push('library name "'.concat(i,'" contains illegal characters (whitespace or "/")')),a&&o&&e.push("and"),o&&e.push('version name "'.concat(t,'" contains illegal characters (whitespace or "/")')),void Fh.warn(e.join(" "))}bf(new uh("".concat(i,"-version"),()=>({library:i,version:t}),"VERSION"))}const Af="firebase-heartbeat-store";let Of=null;function Nf(){return Of||(Of=function(e,t){let{blocked:n,upgrade:r,blocking:i,terminated:a}=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};const o=indexedDB.open(e,t),s=Nh(o);return r&&o.addEventListener("upgradeneeded",e=>{r(Nh(o.result),e.oldVersion,e.newVersion,Nh(o.transaction),e)}),n&&o.addEventListener("blocked",e=>n(e.oldVersion,e.newVersion,e)),s.then(e=>{a&&e.addEventListener("close",()=>a()),i&&e.addEventListener("versionchange",e=>i(e.oldVersion,e.newVersion,e))}).catch(()=>{}),s}("firebase-heartbeat-database",1,{upgrade:(e,t)=>{if(0===t)try{e.createObjectStore(Af)}catch(S_){console.warn(S_)}}}).catch(e=>{throw Ef.create("idb-open",{originalErrorMessage:e.message})})),Of}async function Rf(e,t){try{const n=(await Nf()).transaction(Af,"readwrite"),r=n.objectStore(Af);await r.put(t,Pf(e)),await n.done}catch(S_){if(S_ instanceof Zd)Fh.warn(S_.message);else{const t=Ef.create("idb-set",{originalErrorMessage:null===S_||void 0===S_?void 0:S_.message});Fh.warn(t.message)}}}function Pf(e){return"".concat(e.name,"!").concat(e.options.appId)}class Df{constructor(e){this.container=e,this._heartbeatsCache=null;const t=this.container.getProvider("app").getImmediate();this._storage=new Mf(t),this._heartbeatsCachePromise=this._storage.read().then(e=>(this._heartbeatsCache=e,e))}async triggerHeartbeat(){var e,t;try{const n=this.container.getProvider("platform-logger").getImmediate().getPlatformInfoString(),r=zf();if(null==(null===(e=this._heartbeatsCache)||void 0===e?void 0:e.heartbeats)&&(this._heartbeatsCache=await this._heartbeatsCachePromise,null==(null===(t=this._heartbeatsCache)||void 0===t?void 0:t.heartbeats)))return;if(this._heartbeatsCache.lastSentHeartbeatDate===r||this._heartbeatsCache.heartbeats.some(e=>e.date===r))return;return this._heartbeatsCache.heartbeats.push({date:r,agent:n}),this._heartbeatsCache.heartbeats=this._heartbeatsCache.heartbeats.filter(e=>{const t=new Date(e.date).valueOf();return Date.now()-t<=2592e6}),this._storage.overwrite(this._heartbeatsCache)}catch(S_){Fh.warn(S_)}}async getHeartbeatsHeader(){var e;try{if(null===this._heartbeatsCache&&await this._heartbeatsCachePromise,null==(null===(e=this._heartbeatsCache)||void 0===e?void 0:e.heartbeats)||0===this._heartbeatsCache.heartbeats.length)return"";const t=zf(),{heartbeatsToSend:n,unsentEntries:r}=function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1024;const n=[];let r=e.slice();for(const i of e){const e=n.find(e=>e.agent===i.agent);if(e){if(e.dates.push(i.date),Lf(n)>t){e.dates.pop();break}}else if(n.push({agent:i.agent,dates:[i.date]}),Lf(n)>t){n.pop();break}r=r.slice(1)}return{heartbeatsToSend:n,unsentEntries:r}}(this._heartbeatsCache.heartbeats),i=Fd(JSON.stringify({version:2,heartbeats:n}));return this._heartbeatsCache.lastSentHeartbeatDate=t,r.length>0?(this._heartbeatsCache.heartbeats=r,await this._storage.overwrite(this._heartbeatsCache)):(this._heartbeatsCache.heartbeats=[],this._storage.overwrite(this._heartbeatsCache)),i}catch(S_){return Fh.warn(S_),""}}}function zf(){return(new Date).toISOString().substring(0,10)}class Mf{constructor(e){this.app=e,this._canUseIndexedDBPromise=this.runIndexedDBEnvironmentCheck()}async runIndexedDBEnvironmentCheck(){return!!$d()&&new Promise((e,t)=>{try{let n=!0;const r="validate-browser-context-for-indexeddb-analytics-module",i=self.indexedDB.open(r);i.onsuccess=()=>{i.result.close(),n||self.indexedDB.deleteDatabase(r),e(!0)},i.onupgradeneeded=()=>{n=!1},i.onerror=()=>{var e;t((null===(e=i.error)||void 0===e?void 0:e.message)||"")}}catch(n){t(n)}}).then(()=>!0).catch(()=>!1)}async read(){if(await this._canUseIndexedDBPromise){const e=await async function(e){try{const t=(await Nf()).transaction(Af),n=await t.objectStore(Af).get(Pf(e));return await t.done,n}catch(S_){if(S_ instanceof Zd)Fh.warn(S_.message);else{const t=Ef.create("idb-get",{originalErrorMessage:null===S_||void 0===S_?void 0:S_.message});Fh.warn(t.message)}}}(this.app);return(null===e||void 0===e?void 0:e.heartbeats)?e:{heartbeats:[]}}return{heartbeats:[]}}async overwrite(e){var t;if(await this._canUseIndexedDBPromise){const n=await this.read();return Rf(this.app,{lastSentHeartbeatDate:null!==(t=e.lastSentHeartbeatDate)&&void 0!==t?t:n.lastSentHeartbeatDate,heartbeats:e.heartbeats})}}async add(e){var t;if(await this._canUseIndexedDBPromise){const n=await this.read();return Rf(this.app,{lastSentHeartbeatDate:null!==(t=e.lastSentHeartbeatDate)&&void 0!==t?t:n.lastSentHeartbeatDate,heartbeats:[...n.heartbeats,...e.heartbeats]})}}}function Lf(e){return Fd(JSON.stringify({version:2,heartbeats:e})).length}var Uf;Uf="",bf(new uh("platform-logger",e=>new Lh(e),"PRIVATE")),bf(new uh("heartbeat",e=>new Df(e),"PRIVATE")),Cf(Uh,Bh,Uf),Cf(Uh,Bh,"esm2017"),Cf("fire-js","");var Bf,Ff="undefined"!==typeof globalThis?globalThis:"undefined"!==typeof window?window:"undefined"!==typeof n.g?n.g:"undefined"!==typeof self?self:{},jf={};(function(){var e;function t(){this.blockSize=-1,this.blockSize=64,this.g=Array(4),this.B=Array(this.blockSize),this.o=this.h=0,this.s()}function n(e,t,n){n||(n=0);var r=Array(16);if("string"===typeof t)for(var i=0;16>i;++i)r[i]=t.charCodeAt(n++)|t.charCodeAt(n++)<<8|t.charCodeAt(n++)<<16|t.charCodeAt(n++)<<24;else for(i=0;16>i;++i)r[i]=t[n++]|t[n++]<<8|t[n++]<<16|t[n++]<<24;t=e.g[0],n=e.g[1],i=e.g[2];var a=e.g[3],o=t+(a^n&(i^a))+r[0]+3614090360&4294967295;o=(n=(i=(a=(t=(n=(i=(a=(t=(n=(i=(a=(t=(n=(i=(a=(t=(n=(i=(a=(t=(n=(i=(a=(t=(n=(i=(a=(t=(n=(i=(a=(t=(n=(i=(a=(t=(n=(i=(a=(t=(n=(i=(a=(t=(n=(i=(a=(t=(n=(i=(a=(t=(n=(i=(a=(t=(n=(i=(a=(t=n+(o<<7&4294967295|o>>>25))+((o=a+(i^t&(n^i))+r[1]+3905402710&4294967295)<<12&4294967295|o>>>20))+((o=i+(n^a&(t^n))+r[2]+606105819&4294967295)<<17&4294967295|o>>>15))+((o=n+(t^i&(a^t))+r[3]+3250441966&4294967295)<<22&4294967295|o>>>10))+((o=t+(a^n&(i^a))+r[4]+4118548399&4294967295)<<7&4294967295|o>>>25))+((o=a+(i^t&(n^i))+r[5]+1200080426&4294967295)<<12&4294967295|o>>>20))+((o=i+(n^a&(t^n))+r[6]+2821735955&4294967295)<<17&4294967295|o>>>15))+((o=n+(t^i&(a^t))+r[7]+4249261313&4294967295)<<22&4294967295|o>>>10))+((o=t+(a^n&(i^a))+r[8]+1770035416&4294967295)<<7&4294967295|o>>>25))+((o=a+(i^t&(n^i))+r[9]+2336552879&4294967295)<<12&4294967295|o>>>20))+((o=i+(n^a&(t^n))+r[10]+4294925233&4294967295)<<17&4294967295|o>>>15))+((o=n+(t^i&(a^t))+r[11]+2304563134&4294967295)<<22&4294967295|o>>>10))+((o=t+(a^n&(i^a))+r[12]+1804603682&4294967295)<<7&4294967295|o>>>25))+((o=a+(i^t&(n^i))+r[13]+4254626195&4294967295)<<12&4294967295|o>>>20))+((o=i+(n^a&(t^n))+r[14]+2792965006&4294967295)<<17&4294967295|o>>>15))+((o=n+(t^i&(a^t))+r[15]+1236535329&4294967295)<<22&4294967295|o>>>10))+((o=t+(i^a&(n^i))+r[1]+4129170786&4294967295)<<5&4294967295|o>>>27))+((o=a+(n^i&(t^n))+r[6]+3225465664&4294967295)<<9&4294967295|o>>>23))+((o=i+(t^n&(a^t))+r[11]+643717713&4294967295)<<14&4294967295|o>>>18))+((o=n+(a^t&(i^a))+r[0]+3921069994&4294967295)<<20&4294967295|o>>>12))+((o=t+(i^a&(n^i))+r[5]+3593408605&4294967295)<<5&4294967295|o>>>27))+((o=a+(n^i&(t^n))+r[10]+38016083&4294967295)<<9&4294967295|o>>>23))+((o=i+(t^n&(a^t))+r[15]+3634488961&4294967295)<<14&4294967295|o>>>18))+((o=n+(a^t&(i^a))+r[4]+3889429448&4294967295)<<20&4294967295|o>>>12))+((o=t+(i^a&(n^i))+r[9]+568446438&4294967295)<<5&4294967295|o>>>27))+((o=a+(n^i&(t^n))+r[14]+3275163606&4294967295)<<9&4294967295|o>>>23))+((o=i+(t^n&(a^t))+r[3]+4107603335&4294967295)<<14&4294967295|o>>>18))+((o=n+(a^t&(i^a))+r[8]+1163531501&4294967295)<<20&4294967295|o>>>12))+((o=t+(i^a&(n^i))+r[13]+2850285829&4294967295)<<5&4294967295|o>>>27))+((o=a+(n^i&(t^n))+r[2]+4243563512&4294967295)<<9&4294967295|o>>>23))+((o=i+(t^n&(a^t))+r[7]+1735328473&4294967295)<<14&4294967295|o>>>18))+((o=n+(a^t&(i^a))+r[12]+2368359562&4294967295)<<20&4294967295|o>>>12))+((o=t+(n^i^a)+r[5]+4294588738&4294967295)<<4&4294967295|o>>>28))+((o=a+(t^n^i)+r[8]+2272392833&4294967295)<<11&4294967295|o>>>21))+((o=i+(a^t^n)+r[11]+1839030562&4294967295)<<16&4294967295|o>>>16))+((o=n+(i^a^t)+r[14]+4259657740&4294967295)<<23&4294967295|o>>>9))+((o=t+(n^i^a)+r[1]+2763975236&4294967295)<<4&4294967295|o>>>28))+((o=a+(t^n^i)+r[4]+1272893353&4294967295)<<11&4294967295|o>>>21))+((o=i+(a^t^n)+r[7]+4139469664&4294967295)<<16&4294967295|o>>>16))+((o=n+(i^a^t)+r[10]+3200236656&4294967295)<<23&4294967295|o>>>9))+((o=t+(n^i^a)+r[13]+681279174&4294967295)<<4&4294967295|o>>>28))+((o=a+(t^n^i)+r[0]+3936430074&4294967295)<<11&4294967295|o>>>21))+((o=i+(a^t^n)+r[3]+3572445317&4294967295)<<16&4294967295|o>>>16))+((o=n+(i^a^t)+r[6]+76029189&4294967295)<<23&4294967295|o>>>9))+((o=t+(n^i^a)+r[9]+3654602809&4294967295)<<4&4294967295|o>>>28))+((o=a+(t^n^i)+r[12]+3873151461&4294967295)<<11&4294967295|o>>>21))+((o=i+(a^t^n)+r[15]+530742520&4294967295)<<16&4294967295|o>>>16))+((o=n+(i^a^t)+r[2]+3299628645&4294967295)<<23&4294967295|o>>>9))+((o=t+(i^(n|~a))+r[0]+4096336452&4294967295)<<6&4294967295|o>>>26))+((o=a+(n^(t|~i))+r[7]+1126891415&4294967295)<<10&4294967295|o>>>22))+((o=i+(t^(a|~n))+r[14]+2878612391&4294967295)<<15&4294967295|o>>>17))+((o=n+(a^(i|~t))+r[5]+4237533241&4294967295)<<21&4294967295|o>>>11))+((o=t+(i^(n|~a))+r[12]+1700485571&4294967295)<<6&4294967295|o>>>26))+((o=a+(n^(t|~i))+r[3]+2399980690&4294967295)<<10&4294967295|o>>>22))+((o=i+(t^(a|~n))+r[10]+4293915773&4294967295)<<15&4294967295|o>>>17))+((o=n+(a^(i|~t))+r[1]+2240044497&4294967295)<<21&4294967295|o>>>11))+((o=t+(i^(n|~a))+r[8]+1873313359&4294967295)<<6&4294967295|o>>>26))+((o=a+(n^(t|~i))+r[15]+4264355552&4294967295)<<10&4294967295|o>>>22))+((o=i+(t^(a|~n))+r[6]+2734768916&4294967295)<<15&4294967295|o>>>17))+((o=n+(a^(i|~t))+r[13]+1309151649&4294967295)<<21&4294967295|o>>>11))+((a=(t=n+((o=t+(i^(n|~a))+r[4]+4149444226&4294967295)<<6&4294967295|o>>>26))+((o=a+(n^(t|~i))+r[11]+3174756917&4294967295)<<10&4294967295|o>>>22))^((i=a+((o=i+(t^(a|~n))+r[2]+718787259&4294967295)<<15&4294967295|o>>>17))|~t))+r[9]+3951481745&4294967295,e.g[0]=e.g[0]+t&4294967295,e.g[1]=e.g[1]+(i+(o<<21&4294967295|o>>>11))&4294967295,e.g[2]=e.g[2]+i&4294967295,e.g[3]=e.g[3]+a&4294967295}function r(e,t){this.h=t;for(var n=[],r=!0,i=e.length-1;0<=i;i--){var a=0|e[i];r&&a==t||(n[i]=a,r=!1)}this.g=n}!function(e,t){function n(){}n.prototype=t.prototype,e.D=t.prototype,e.prototype=new n,e.prototype.constructor=e,e.C=function(e,n,r){for(var i=Array(arguments.length-2),a=2;a<arguments.length;a++)i[a-2]=arguments[a];return t.prototype[n].apply(e,i)}}(t,function(){this.blockSize=-1}),t.prototype.s=function(){this.g[0]=1732584193,this.g[1]=4023233417,this.g[2]=2562383102,this.g[3]=271733878,this.o=this.h=0},t.prototype.u=function(e,t){void 0===t&&(t=e.length);for(var r=t-this.blockSize,i=this.B,a=this.h,o=0;o<t;){if(0==a)for(;o<=r;)n(this,e,o),o+=this.blockSize;if("string"===typeof e){for(;o<t;)if(i[a++]=e.charCodeAt(o++),a==this.blockSize){n(this,i),a=0;break}}else for(;o<t;)if(i[a++]=e[o++],a==this.blockSize){n(this,i),a=0;break}}this.h=a,this.o+=t},t.prototype.v=function(){var e=Array((56>this.h?this.blockSize:2*this.blockSize)-this.h);e[0]=128;for(var t=1;t<e.length-8;++t)e[t]=0;var n=8*this.o;for(t=e.length-8;t<e.length;++t)e[t]=255&n,n/=256;for(this.u(e),e=Array(16),t=n=0;4>t;++t)for(var r=0;32>r;r+=8)e[n++]=this.g[t]>>>r&255;return e};var i={};function a(e){return-128<=e&&128>e?function(e,t){var n=i;return Object.prototype.hasOwnProperty.call(n,e)?n[e]:n[e]=t(e)}(e,function(e){return new r([0|e],0>e?-1:0)}):new r([0|e],0>e?-1:0)}function o(e){if(isNaN(e)||!isFinite(e))return s;if(0>e)return h(o(-e));for(var t=[],n=1,i=0;e>=n;i++)t[i]=e/n|0,n*=4294967296;return new r(t,0)}var s=a(0),c=a(1),l=a(16777216);function u(e){if(0!=e.h)return!1;for(var t=0;t<e.g.length;t++)if(0!=e.g[t])return!1;return!0}function d(e){return-1==e.h}function h(e){for(var t=e.g.length,n=[],i=0;i<t;i++)n[i]=~e.g[i];return new r(n,~e.h).add(c)}function f(e,t){return e.add(h(t))}function p(e,t){for(;(65535&e[t])!=e[t];)e[t+1]+=e[t]>>>16,e[t]&=65535,t++}function m(e,t){this.g=e,this.h=t}function g(e,t){if(u(t))throw Error("division by zero");if(u(e))return new m(s,s);if(d(e))return t=g(h(e),t),new m(h(t.g),h(t.h));if(d(t))return t=g(e,h(t)),new m(h(t.g),t.h);if(30<e.g.length){if(d(e)||d(t))throw Error("slowDivide_ only works with positive integers.");for(var n=c,r=t;0>=r.l(e);)n=y(n),r=y(r);var i=v(n,1),a=v(r,1);for(r=v(r,2),n=v(n,2);!u(r);){var l=a.add(r);0>=l.l(e)&&(i=i.add(n),a=l),r=v(r,1),n=v(n,1)}return t=f(e,i.j(t)),new m(i,t)}for(i=s;0<=e.l(t);){for(n=Math.max(1,Math.floor(e.m()/t.m())),r=48>=(r=Math.ceil(Math.log(n)/Math.LN2))?1:Math.pow(2,r-48),l=(a=o(n)).j(t);d(l)||0<l.l(e);)l=(a=o(n-=r)).j(t);u(a)&&(a=c),i=i.add(a),e=f(e,l)}return new m(i,e)}function y(e){for(var t=e.g.length+1,n=[],i=0;i<t;i++)n[i]=e.i(i)<<1|e.i(i-1)>>>31;return new r(n,e.h)}function v(e,t){var n=t>>5;t%=32;for(var i=e.g.length-n,a=[],o=0;o<i;o++)a[o]=0<t?e.i(o+n)>>>t|e.i(o+n+1)<<32-t:e.i(o+n);return new r(a,e.h)}(e=r.prototype).m=function(){if(d(this))return-h(this).m();for(var e=0,t=1,n=0;n<this.g.length;n++){var r=this.i(n);e+=(0<=r?r:4294967296+r)*t,t*=4294967296}return e},e.toString=function(e){if(2>(e=e||10)||36<e)throw Error("radix out of range: "+e);if(u(this))return"0";if(d(this))return"-"+h(this).toString(e);for(var t=o(Math.pow(e,6)),n=this,r="";;){var i=g(n,t).g,a=((0<(n=f(n,i.j(t))).g.length?n.g[0]:n.h)>>>0).toString(e);if(u(n=i))return a+r;for(;6>a.length;)a="0"+a;r=a+r}},e.i=function(e){return 0>e?0:e<this.g.length?this.g[e]:this.h},e.l=function(e){return d(e=f(this,e))?-1:u(e)?0:1},e.abs=function(){return d(this)?h(this):this},e.add=function(e){for(var t=Math.max(this.g.length,e.g.length),n=[],i=0,a=0;a<=t;a++){var o=i+(65535&this.i(a))+(65535&e.i(a)),s=(o>>>16)+(this.i(a)>>>16)+(e.i(a)>>>16);i=s>>>16,o&=65535,s&=65535,n[a]=s<<16|o}return new r(n,-2147483648&n[n.length-1]?-1:0)},e.j=function(e){if(u(this)||u(e))return s;if(d(this))return d(e)?h(this).j(h(e)):h(h(this).j(e));if(d(e))return h(this.j(h(e)));if(0>this.l(l)&&0>e.l(l))return o(this.m()*e.m());for(var t=this.g.length+e.g.length,n=[],i=0;i<2*t;i++)n[i]=0;for(i=0;i<this.g.length;i++)for(var a=0;a<e.g.length;a++){var c=this.i(i)>>>16,f=65535&this.i(i),m=e.i(a)>>>16,g=65535&e.i(a);n[2*i+2*a]+=f*g,p(n,2*i+2*a),n[2*i+2*a+1]+=c*g,p(n,2*i+2*a+1),n[2*i+2*a+1]+=f*m,p(n,2*i+2*a+1),n[2*i+2*a+2]+=c*m,p(n,2*i+2*a+2)}for(i=0;i<t;i++)n[i]=n[2*i+1]<<16|n[2*i];for(i=t;i<2*t;i++)n[i]=0;return new r(n,0)},e.A=function(e){return g(this,e).h},e.and=function(e){for(var t=Math.max(this.g.length,e.g.length),n=[],i=0;i<t;i++)n[i]=this.i(i)&e.i(i);return new r(n,this.h&e.h)},e.or=function(e){for(var t=Math.max(this.g.length,e.g.length),n=[],i=0;i<t;i++)n[i]=this.i(i)|e.i(i);return new r(n,this.h|e.h)},e.xor=function(e){for(var t=Math.max(this.g.length,e.g.length),n=[],i=0;i<t;i++)n[i]=this.i(i)^e.i(i);return new r(n,this.h^e.h)},t.prototype.digest=t.prototype.v,t.prototype.reset=t.prototype.s,t.prototype.update=t.prototype.u,jf.Md5=t,r.prototype.add=r.prototype.add,r.prototype.multiply=r.prototype.j,r.prototype.modulo=r.prototype.A,r.prototype.compare=r.prototype.l,r.prototype.toNumber=r.prototype.m,r.prototype.toString=r.prototype.toString,r.prototype.getBits=r.prototype.i,r.fromNumber=o,r.fromString=function e(t,n){if(0==t.length)throw Error("number format error: empty string");if(2>(n=n||10)||36<n)throw Error("radix out of range: "+n);if("-"==t.charAt(0))return h(e(t.substring(1),n));if(0<=t.indexOf("-"))throw Error('number format error: interior "-" character');for(var r=o(Math.pow(n,8)),i=s,a=0;a<t.length;a+=8){var c=Math.min(8,t.length-a),l=parseInt(t.substring(a,a+c),n);8>c?(c=o(Math.pow(n,c)),i=i.j(c).add(o(l))):i=(i=i.j(r)).add(o(l))}return i},Bf=jf.Integer=r}).apply("undefined"!==typeof Ff?Ff:"undefined"!==typeof self?self:"undefined"!==typeof window?window:{});var Vf,qf,Hf,Wf,Gf,Kf,Qf,Xf,Yf="undefined"!==typeof globalThis?globalThis:"undefined"!==typeof window?window:"undefined"!==typeof n.g?n.g:"undefined"!==typeof self?self:{},Jf={};(function(){var e,t="function"==typeof Object.defineProperties?Object.defineProperty:function(e,t,n){return e==Array.prototype||e==Object.prototype||(e[t]=n.value),e};var n=function(e){e=["object"==typeof globalThis&&globalThis,e,"object"==typeof window&&window,"object"==typeof self&&self,"object"==typeof Yf&&Yf];for(var t=0;t<e.length;++t){var n=e[t];if(n&&n.Math==Math)return n}throw Error("Cannot find global object")}(this);!function(e,r){if(r)e:{var i=n;e=e.split(".");for(var a=0;a<e.length-1;a++){var o=e[a];if(!(o in i))break e;i=i[o]}(r=r(a=i[e=e[e.length-1]]))!=a&&null!=r&&t(i,e,{configurable:!0,writable:!0,value:r})}}("Array.prototype.values",function(e){return e||function(){return function(e,t){e instanceof String&&(e+="");var n=0,r=!1,i={next:function(){if(!r&&n<e.length){var i=n++;return{value:t(i,e[i]),done:!1}}return r=!0,{done:!0,value:void 0}}};return i[Symbol.iterator]=function(){return i},i}(this,function(e,t){return t})}});var r=r||{},i=this||self;function a(e){var t=typeof e;return"array"==(t="object"!=t?t:e?Array.isArray(e)?"array":t:"null")||"object"==t&&"number"==typeof e.length}function o(e){var t=typeof e;return"object"==t&&null!=e||"function"==t}function s(e,t,n){return e.call.apply(e.bind,arguments)}function c(e,t,n){if(!e)throw Error();if(2<arguments.length){var r=Array.prototype.slice.call(arguments,2);return function(){var n=Array.prototype.slice.call(arguments);return Array.prototype.unshift.apply(n,r),e.apply(t,n)}}return function(){return e.apply(t,arguments)}}function l(e,t,n){return(l=Function.prototype.bind&&-1!=Function.prototype.bind.toString().indexOf("native code")?s:c).apply(null,arguments)}function u(e,t){var n=Array.prototype.slice.call(arguments,1);return function(){var t=n.slice();return t.push.apply(t,arguments),e.apply(this,t)}}function d(e,t){function n(){}n.prototype=t.prototype,e.aa=t.prototype,e.prototype=new n,e.prototype.constructor=e,e.Qb=function(e,n,r){for(var i=Array(arguments.length-2),a=2;a<arguments.length;a++)i[a-2]=arguments[a];return t.prototype[n].apply(e,i)}}function h(e){const t=e.length;if(0<t){const n=Array(t);for(let r=0;r<t;r++)n[r]=e[r];return n}return[]}function f(e,t){for(let n=1;n<arguments.length;n++){const t=arguments[n];if(a(t)){const n=e.length||0,r=t.length||0;e.length=n+r;for(let i=0;i<r;i++)e[n+i]=t[i]}else e.push(t)}}function p(e){return/^[\s\xa0]*$/.test(e)}function m(){var e=i.navigator;return e&&(e=e.userAgent)?e:""}function g(e){return g[" "](e),e}g[" "]=function(){};var y=-1!=m().indexOf("Gecko")&&!(-1!=m().toLowerCase().indexOf("webkit")&&-1==m().indexOf("Edge"))&&!(-1!=m().indexOf("Trident")||-1!=m().indexOf("MSIE"))&&-1==m().indexOf("Edge");function v(e,t,n){for(const r in e)t.call(n,e[r],r,e)}function w(e){const t={};for(const n in e)t[n]=e[n];return t}const b="constructor hasOwnProperty isPrototypeOf propertyIsEnumerable toLocaleString toString valueOf".split(" ");function _(e,t){let n,r;for(let i=1;i<arguments.length;i++){for(n in r=arguments[i],r)e[n]=r[n];for(let t=0;t<b.length;t++)n=b[t],Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}}function x(e){var t=1;e=e.split(":");const n=[];for(;0<t&&e.length;)n.push(e.shift()),t--;return e.length&&n.push(e.join(":")),n}function E(e){i.setTimeout(()=>{throw e},0)}function S(){var e=A;let t=null;return e.g&&(t=e.g,e.g=e.g.next,e.g||(e.h=null),t.next=null),t}var k=new class{constructor(e,t){this.i=e,this.j=t,this.h=0,this.g=null}get(){let e;return 0<this.h?(this.h--,e=this.g,this.g=e.next,e.next=null):e=this.i(),e}}(()=>new T,e=>e.reset());class T{constructor(){this.next=this.g=this.h=null}set(e,t){this.h=e,this.g=t,this.next=null}reset(){this.next=this.g=this.h=null}}let I,C=!1,A=new class{constructor(){this.h=this.g=null}add(e,t){const n=k.get();n.set(e,t),this.h?this.h.next=n:this.g=n,this.h=n}},O=()=>{const e=i.Promise.resolve(void 0);I=()=>{e.then(N)}};var N=()=>{for(var e;e=S();){try{e.h.call(e.g)}catch($_){E($_)}var t=k;t.j(e),100>t.h&&(t.h++,e.next=t.g,t.g=e)}C=!1};function R(){this.s=this.s,this.C=this.C}function P(e,t){this.type=e,this.g=this.target=t,this.defaultPrevented=!1}R.prototype.s=!1,R.prototype.ma=function(){this.s||(this.s=!0,this.N())},R.prototype.N=function(){if(this.C)for(;this.C.length;)this.C.shift()()},P.prototype.h=function(){this.defaultPrevented=!0};var D=function(){if(!i.addEventListener||!Object.defineProperty)return!1;var e=!1,t=Object.defineProperty({},"passive",{get:function(){e=!0}});try{const e=()=>{};i.addEventListener("test",e,t),i.removeEventListener("test",e,t)}catch($_){}return e}();function z(e,t){if(P.call(this,e?e.type:""),this.relatedTarget=this.g=this.target=null,this.button=this.screenY=this.screenX=this.clientY=this.clientX=0,this.key="",this.metaKey=this.shiftKey=this.altKey=this.ctrlKey=!1,this.state=null,this.pointerId=0,this.pointerType="",this.i=null,e){var n=this.type=e.type,r=e.changedTouches&&e.changedTouches.length?e.changedTouches[0]:null;if(this.target=e.target||e.srcElement,this.g=t,t=e.relatedTarget){if(y){e:{try{g(t.nodeName);var i=!0;break e}catch(P_){}i=!1}i||(t=null)}}else"mouseover"==n?t=e.fromElement:"mouseout"==n&&(t=e.toElement);this.relatedTarget=t,r?(this.clientX=void 0!==r.clientX?r.clientX:r.pageX,this.clientY=void 0!==r.clientY?r.clientY:r.pageY,this.screenX=r.screenX||0,this.screenY=r.screenY||0):(this.clientX=void 0!==e.clientX?e.clientX:e.pageX,this.clientY=void 0!==e.clientY?e.clientY:e.pageY,this.screenX=e.screenX||0,this.screenY=e.screenY||0),this.button=e.button,this.key=e.key||"",this.ctrlKey=e.ctrlKey,this.altKey=e.altKey,this.shiftKey=e.shiftKey,this.metaKey=e.metaKey,this.pointerId=e.pointerId||0,this.pointerType="string"===typeof e.pointerType?e.pointerType:M[e.pointerType]||"",this.state=e.state,this.i=e,e.defaultPrevented&&z.aa.h.call(this)}}d(z,P);var M={2:"touch",3:"pen",4:"mouse"};z.prototype.h=function(){z.aa.h.call(this);var e=this.i;e.preventDefault?e.preventDefault():e.returnValue=!1};var L="closure_listenable_"+(1e6*Math.random()|0),U=0;function B(e,t,n,r,i){this.listener=e,this.proxy=null,this.src=t,this.type=n,this.capture=!!r,this.ha=i,this.key=++U,this.da=this.fa=!1}function F(e){e.da=!0,e.listener=null,e.proxy=null,e.src=null,e.ha=null}function j(e){this.src=e,this.g={},this.h=0}function V(e,t){var n=t.type;if(n in e.g){var r,i=e.g[n],a=Array.prototype.indexOf.call(i,t,void 0);(r=0<=a)&&Array.prototype.splice.call(i,a,1),r&&(F(t),0==e.g[n].length&&(delete e.g[n],e.h--))}}function q(e,t,n,r){for(var i=0;i<e.length;++i){var a=e[i];if(!a.da&&a.listener==t&&a.capture==!!n&&a.ha==r)return i}return-1}j.prototype.add=function(e,t,n,r,i){var a=e.toString();(e=this.g[a])||(e=this.g[a]=[],this.h++);var o=q(e,t,r,i);return-1<o?(t=e[o],n||(t.fa=!1)):((t=new B(t,this.src,a,!!r,i)).fa=n,e.push(t)),t};var H="closure_lm_"+(1e6*Math.random()|0),W={};function G(e,t,n,r,i){if(r&&r.once)return Q(e,t,n,r,i);if(Array.isArray(t)){for(var a=0;a<t.length;a++)G(e,t[a],n,r,i);return null}return n=te(n),e&&e[L]?e.K(t,n,o(r)?!!r.capture:!!r,i):K(e,t,n,!1,r,i)}function K(e,t,n,r,i,a){if(!t)throw Error("Invalid event type");var s=o(i)?!!i.capture:!!i,c=Z(e);if(c||(e[H]=c=new j(e)),(n=c.add(t,n,r,s,a)).proxy)return n;if(r=function(){function e(n){return t.call(e.src,e.listener,n)}const t=$;return e}(),n.proxy=r,r.src=e,r.listener=n,e.addEventListener)D||(i=s),void 0===i&&(i=!1),e.addEventListener(t.toString(),r,i);else if(e.attachEvent)e.attachEvent(J(t.toString()),r);else{if(!e.addListener||!e.removeListener)throw Error("addEventListener and attachEvent are unavailable.");e.addListener(r)}return n}function Q(e,t,n,r,i){if(Array.isArray(t)){for(var a=0;a<t.length;a++)Q(e,t[a],n,r,i);return null}return n=te(n),e&&e[L]?e.L(t,n,o(r)?!!r.capture:!!r,i):K(e,t,n,!0,r,i)}function X(e,t,n,r,i){if(Array.isArray(t))for(var a=0;a<t.length;a++)X(e,t[a],n,r,i);else r=o(r)?!!r.capture:!!r,n=te(n),e&&e[L]?(e=e.i,(t=String(t).toString())in e.g&&(-1<(n=q(a=e.g[t],n,r,i))&&(F(a[n]),Array.prototype.splice.call(a,n,1),0==a.length&&(delete e.g[t],e.h--)))):e&&(e=Z(e))&&(t=e.g[t.toString()],e=-1,t&&(e=q(t,n,r,i)),(n=-1<e?t[e]:null)&&Y(n))}function Y(e){if("number"!==typeof e&&e&&!e.da){var t=e.src;if(t&&t[L])V(t.i,e);else{var n=e.type,r=e.proxy;t.removeEventListener?t.removeEventListener(n,r,e.capture):t.detachEvent?t.detachEvent(J(n),r):t.addListener&&t.removeListener&&t.removeListener(r),(n=Z(t))?(V(n,e),0==n.h&&(n.src=null,t[H]=null)):F(e)}}}function J(e){return e in W?W[e]:W[e]="on"+e}function $(e,t){if(e.da)e=!0;else{t=new z(t,this);var n=e.listener,r=e.ha||e.src;e.fa&&Y(e),e=n.call(r,t)}return e}function Z(e){return(e=e[H])instanceof j?e:null}var ee="__closure_events_fn_"+(1e9*Math.random()>>>0);function te(e){return"function"===typeof e?e:(e[ee]||(e[ee]=function(t){return e.handleEvent(t)}),e[ee])}function ne(){R.call(this),this.i=new j(this),this.M=this,this.F=null}function re(e,t){var n,r=e.F;if(r)for(n=[];r;r=r.F)n.push(r);if(e=e.M,r=t.type||t,"string"===typeof t)t=new P(t,e);else if(t instanceof P)t.target=t.target||e;else{var i=t;_(t=new P(r,e),i)}if(i=!0,n)for(var a=n.length-1;0<=a;a--){var o=t.g=n[a];i=ie(o,r,!0,t)&&i}if(i=ie(o=t.g=e,r,!0,t)&&i,i=ie(o,r,!1,t)&&i,n)for(a=0;a<n.length;a++)i=ie(o=t.g=n[a],r,!1,t)&&i}function ie(e,t,n,r){if(!(t=e.i.g[String(t)]))return!0;t=t.concat();for(var i=!0,a=0;a<t.length;++a){var o=t[a];if(o&&!o.da&&o.capture==n){var s=o.listener,c=o.ha||o.src;o.fa&&V(e.i,o),i=!1!==s.call(c,r)&&i}}return i&&!r.defaultPrevented}function ae(e,t,n){if("function"===typeof e)n&&(e=l(e,n));else{if(!e||"function"!=typeof e.handleEvent)throw Error("Invalid listener argument");e=l(e.handleEvent,e)}return 2147483647<Number(t)?-1:i.setTimeout(e,t||0)}function oe(e){e.g=ae(()=>{e.g=null,e.i&&(e.i=!1,oe(e))},e.l);const t=e.h;e.h=null,e.m.apply(null,t)}d(ne,R),ne.prototype[L]=!0,ne.prototype.removeEventListener=function(e,t,n,r){X(this,e,t,n,r)},ne.prototype.N=function(){if(ne.aa.N.call(this),this.i){var e,t=this.i;for(e in t.g){for(var n=t.g[e],r=0;r<n.length;r++)F(n[r]);delete t.g[e],t.h--}}this.F=null},ne.prototype.K=function(e,t,n,r){return this.i.add(String(e),t,!1,n,r)},ne.prototype.L=function(e,t,n,r){return this.i.add(String(e),t,!0,n,r)};class se extends R{constructor(e,t){super(),this.m=e,this.l=t,this.h=null,this.i=!1,this.g=null}j(e){this.h=arguments,this.g?this.i=!0:oe(this)}N(){super.N(),this.g&&(i.clearTimeout(this.g),this.g=null,this.i=!1,this.h=null)}}function ce(e){R.call(this),this.h=e,this.g={}}d(ce,R);var le=[];function ue(e){v(e.g,function(e,t){this.g.hasOwnProperty(t)&&Y(e)},e),e.g={}}ce.prototype.N=function(){ce.aa.N.call(this),ue(this)},ce.prototype.handleEvent=function(){throw Error("EventHandler.handleEvent not implemented")};var de=i.JSON.stringify,he=i.JSON.parse,fe=class{stringify(e){return i.JSON.stringify(e,void 0)}parse(e){return i.JSON.parse(e,void 0)}};function pe(){}function me(e){return e.h||(e.h=e.i())}function ge(){}pe.prototype.h=null;var ye={OPEN:"a",kb:"b",Ja:"c",wb:"d"};function ve(){P.call(this,"d")}function we(){P.call(this,"c")}d(ve,P),d(we,P);var be={},_e=null;function xe(){return _e=_e||new ne}function Ee(e){P.call(this,be.La,e)}function Se(e){const t=xe();re(t,new Ee(t))}function ke(e,t){P.call(this,be.STAT_EVENT,e),this.stat=t}function Te(e){const t=xe();re(t,new ke(t,e))}function Ie(e,t){P.call(this,be.Ma,e),this.size=t}function Ce(e,t){if("function"!==typeof e)throw Error("Fn must not be null and must be a function");return i.setTimeout(function(){e()},t)}function Ae(){this.g=!0}function Oe(e,t,n,r){e.info(function(){return"XMLHTTP TEXT ("+t+"): "+function(e,t){if(!e.g)return t;if(!t)return null;try{var n=JSON.parse(t);if(n)for(e=0;e<n.length;e++)if(Array.isArray(n[e])){var r=n[e];if(!(2>r.length)){var i=r[1];if(Array.isArray(i)&&!(1>i.length)){var a=i[0];if("noop"!=a&&"stop"!=a&&"close"!=a)for(var o=1;o<i.length;o++)i[o]=""}}}return de(n)}catch(s){return t}}(e,n)+(r?" "+r:"")})}be.La="serverreachability",d(Ee,P),be.STAT_EVENT="statevent",d(ke,P),be.Ma="timingevent",d(Ie,P),Ae.prototype.xa=function(){this.g=!1},Ae.prototype.info=function(){};var Ne,Re={NO_ERROR:0,gb:1,tb:2,sb:3,nb:4,rb:5,ub:6,Ia:7,TIMEOUT:8,xb:9},Pe={lb:"complete",Hb:"success",Ja:"error",Ia:"abort",zb:"ready",Ab:"readystatechange",TIMEOUT:"timeout",vb:"incrementaldata",yb:"progress",ob:"downloadprogress",Pb:"uploadprogress"};function De(){}function ze(e,t,n,r){this.j=e,this.i=t,this.l=n,this.R=r||1,this.U=new ce(this),this.I=45e3,this.H=null,this.o=!1,this.m=this.A=this.v=this.L=this.F=this.S=this.B=null,this.D=[],this.g=null,this.C=0,this.s=this.u=null,this.X=-1,this.J=!1,this.O=0,this.M=null,this.W=this.K=this.T=this.P=!1,this.h=new Me}function Me(){this.i=null,this.g="",this.h=!1}d(De,pe),De.prototype.g=function(){return new XMLHttpRequest},De.prototype.i=function(){return{}},Ne=new De;var Le={},Ue={};function Be(e,t,n){e.L=1,e.v=dt(ot(t)),e.m=n,e.P=!0,Fe(e,null)}function Fe(e,t){e.F=Date.now(),qe(e),e.A=ot(e.v);var n=e.A,r=e.R;Array.isArray(r)||(r=[String(r)]),St(n.i,"t",r),e.C=0,n=e.j.J,e.h=new Me,e.g=hn(e.j,n?t:null,!e.m),0<e.O&&(e.M=new se(l(e.Y,e,e.g),e.O)),t=e.U,n=e.g,r=e.ca;var i="readystatechange";Array.isArray(i)||(i&&(le[0]=i.toString()),i=le);for(var a=0;a<i.length;a++){var o=G(n,i[a],r||t.handleEvent,!1,t.h||t);if(!o)break;t.g[o.key]=o}t=e.H?w(e.H):{},e.m?(e.u||(e.u="POST"),t["Content-Type"]="application/x-www-form-urlencoded",e.g.ea(e.A,e.u,e.m,t)):(e.u="GET",e.g.ea(e.A,e.u,null,t)),Se(),function(e,t,n,r,i,a){e.info(function(){if(e.g)if(a)for(var o="",s=a.split("&"),c=0;c<s.length;c++){var l=s[c].split("=");if(1<l.length){var u=l[0];l=l[1];var d=u.split("_");o=2<=d.length&&"type"==d[1]?o+(u+"=")+l+"&":o+(u+"=redacted&")}}else o=null;else o=a;return"XMLHTTP REQ ("+r+") [attempt "+i+"]: "+t+"\n"+n+"\n"+o})}(e.i,e.u,e.A,e.l,e.R,e.m)}function je(e){return!!e.g&&("GET"==e.u&&2!=e.L&&e.j.Ca)}function Ve(e,t){var n=e.C,r=t.indexOf("\n",n);return-1==r?Ue:(n=Number(t.substring(n,r)),isNaN(n)?Le:(r+=1)+n>t.length?Ue:(t=t.slice(r,r+n),e.C=r+n,t))}function qe(e){e.S=Date.now()+e.I,He(e,e.I)}function He(e,t){if(null!=e.B)throw Error("WatchDog timer not null");e.B=Ce(l(e.ba,e),t)}function We(e){e.B&&(i.clearTimeout(e.B),e.B=null)}function Ge(e){0==e.j.G||e.J||sn(e.j,e)}function Ke(e){We(e);var t=e.M;t&&"function"==typeof t.ma&&t.ma(),e.M=null,ue(e.U),e.g&&(t=e.g,e.g=null,t.abort(),t.ma())}function Qe(e,t){try{var n=e.j;if(0!=n.G&&(n.g==e||Ze(n.h,e)))if(!e.K&&Ze(n.h,e)&&3==n.G){try{var r=n.Da.g.parse(t)}catch(u){r=null}if(Array.isArray(r)&&3==r.length){var i=r;if(0==i[0]){e:if(!n.u){if(n.g){if(!(n.g.F+3e3<e.F))break e;on(n),Xt(n)}nn(n),Te(18)}}else n.za=i[1],0<n.za-n.T&&37500>i[2]&&n.F&&0==n.v&&!n.C&&(n.C=Ce(l(n.Za,n),6e3));if(1>=$e(n.h)&&n.ca){try{n.ca()}catch(u){}n.ca=void 0}}else ln(n,11)}else if((e.K||n.g==e)&&on(n),!p(t))for(i=n.Da.g.parse(t),t=0;t<i.length;t++){let l=i[t];if(n.T=l[0],l=l[1],2==n.G)if("c"==l[0]){n.K=l[1],n.ia=l[2];const t=l[3];null!=t&&(n.la=t,n.j.info("VER="+n.la));const i=l[4];null!=i&&(n.Aa=i,n.j.info("SVER="+n.Aa));const u=l[5];null!=u&&"number"===typeof u&&0<u&&(r=1.5*u,n.L=r,n.j.info("backChannelRequestTimeoutMs_="+r)),r=n;const d=e.g;if(d){const e=d.g?d.g.getResponseHeader("X-Client-Wire-Protocol"):null;if(e){var a=r.h;a.g||-1==e.indexOf("spdy")&&-1==e.indexOf("quic")&&-1==e.indexOf("h2")||(a.j=a.l,a.g=new Set,a.h&&(et(a,a.h),a.h=null))}if(r.D){const e=d.g?d.g.getResponseHeader("X-HTTP-Session-Id"):null;e&&(r.ya=e,ut(r.I,r.D,e))}}n.G=3,n.l&&n.l.ua(),n.ba&&(n.R=Date.now()-e.F,n.j.info("Handshake RTT: "+n.R+"ms"));var o=e;if((r=n).qa=dn(r,r.J?r.ia:null,r.W),o.K){tt(r.h,o);var s=o,c=r.L;c&&(s.I=c),s.B&&(We(s),qe(s)),r.g=o}else tn(r);0<n.i.length&&Jt(n)}else"stop"!=l[0]&&"close"!=l[0]||ln(n,7);else 3==n.G&&("stop"==l[0]||"close"==l[0]?"stop"==l[0]?ln(n,7):Qt(n):"noop"!=l[0]&&n.l&&n.l.ta(l),n.v=0)}Se()}catch(u){}}ze.prototype.ca=function(e){e=e.target;const t=this.M;t&&3==Ht(e)?t.j():this.Y(e)},ze.prototype.Y=function(e){try{if(e==this.g)e:{const h=Ht(this.g);var t=this.g.Ba();this.g.Z();if(!(3>h)&&(3!=h||this.g&&(this.h.h||this.g.oa()||Wt(this.g)))){this.J||4!=h||7==t||Se(),We(this);var n=this.g.Z();this.X=n;t:if(je(this)){var r=Wt(this.g);e="";var a=r.length,o=4==Ht(this.g);if(!this.h.i){if("undefined"===typeof TextDecoder){Ke(this),Ge(this);var s="";break t}this.h.i=new i.TextDecoder}for(t=0;t<a;t++)this.h.h=!0,e+=this.h.i.decode(r[t],{stream:!(o&&t==a-1)});r.length=0,this.h.g+=e,this.C=0,s=this.h.g}else s=this.g.oa();if(this.o=200==n,function(e,t,n,r,i,a,o){e.info(function(){return"XMLHTTP RESP ("+r+") [ attempt "+i+"]: "+t+"\n"+n+"\n"+a+" "+o})}(this.i,this.u,this.A,this.l,this.R,h,n),this.o){if(this.T&&!this.K){t:{if(this.g){var c,l=this.g;if((c=l.g?l.g.getResponseHeader("X-HTTP-Initial-Response"):null)&&!p(c)){var u=c;break t}}u=null}if(!(n=u)){this.o=!1,this.s=3,Te(12),Ke(this),Ge(this);break e}Oe(this.i,this.l,n,"Initial handshake response via X-HTTP-Initial-Response"),this.K=!0,Qe(this,n)}if(this.P){let e;for(n=!0;!this.J&&this.C<s.length;){if(e=Ve(this,s),e==Ue){4==h&&(this.s=4,Te(14),n=!1),Oe(this.i,this.l,null,"[Incomplete Response]");break}if(e==Le){this.s=4,Te(15),Oe(this.i,this.l,s,"[Invalid Chunk]"),n=!1;break}Oe(this.i,this.l,e,null),Qe(this,e)}if(je(this)&&0!=this.C&&(this.h.g=this.h.g.slice(this.C),this.C=0),4!=h||0!=s.length||this.h.h||(this.s=1,Te(16),n=!1),this.o=this.o&&n,n){if(0<s.length&&!this.W){this.W=!0;var d=this.j;d.g==this&&d.ba&&!d.M&&(d.j.info("Great, no buffering proxy detected. Bytes received: "+s.length),rn(d),d.M=!0,Te(11))}}else Oe(this.i,this.l,s,"[Invalid Chunked Response]"),Ke(this),Ge(this)}else Oe(this.i,this.l,s,null),Qe(this,s);4==h&&Ke(this),this.o&&!this.J&&(4==h?sn(this.j,this):(this.o=!1,qe(this)))}else(function(e){const t={};e=(e.g&&2<=Ht(e)&&e.g.getAllResponseHeaders()||"").split("\r\n");for(let r=0;r<e.length;r++){if(p(e[r]))continue;var n=x(e[r]);const i=n[0];if("string"!==typeof(n=n[1]))continue;n=n.trim();const a=t[i]||[];t[i]=a,a.push(n)}!function(e,t){for(const n in e)t.call(void 0,e[n],n,e)}(t,function(e){return e.join(", ")})})(this.g),400==n&&0<s.indexOf("Unknown SID")?(this.s=3,Te(12)):(this.s=0,Te(13)),Ke(this),Ge(this)}}}catch($f){}},ze.prototype.cancel=function(){this.J=!0,Ke(this)},ze.prototype.ba=function(){this.B=null;const e=Date.now();0<=e-this.S?(function(e,t){e.info(function(){return"TIMEOUT: "+t})}(this.i,this.A),2!=this.L&&(Se(),Te(17)),Ke(this),this.s=2,Ge(this)):He(this,this.S-e)};var Xe=class{constructor(e,t){this.g=e,this.map=t}};function Ye(e){this.l=e||10,i.PerformanceNavigationTiming?e=0<(e=i.performance.getEntriesByType("navigation")).length&&("hq"==e[0].nextHopProtocol||"h2"==e[0].nextHopProtocol):e=!!(i.chrome&&i.chrome.loadTimes&&i.chrome.loadTimes()&&i.chrome.loadTimes().wasFetchedViaSpdy),this.j=e?this.l:1,this.g=null,1<this.j&&(this.g=new Set),this.h=null,this.i=[]}function Je(e){return!!e.h||!!e.g&&e.g.size>=e.j}function $e(e){return e.h?1:e.g?e.g.size:0}function Ze(e,t){return e.h?e.h==t:!!e.g&&e.g.has(t)}function et(e,t){e.g?e.g.add(t):e.h=t}function tt(e,t){e.h&&e.h==t?e.h=null:e.g&&e.g.has(t)&&e.g.delete(t)}function nt(e){if(null!=e.h)return e.i.concat(e.h.D);if(null!=e.g&&0!==e.g.size){let t=e.i;for(const n of e.g.values())t=t.concat(n.D);return t}return h(e.i)}function rt(e,t){if(e.forEach&&"function"==typeof e.forEach)e.forEach(t,void 0);else if(a(e)||"string"===typeof e)Array.prototype.forEach.call(e,t,void 0);else for(var n=function(e){if(e.na&&"function"==typeof e.na)return e.na();if(!e.V||"function"!=typeof e.V){if("undefined"!==typeof Map&&e instanceof Map)return Array.from(e.keys());if(!("undefined"!==typeof Set&&e instanceof Set)){if(a(e)||"string"===typeof e){var t=[];e=e.length;for(var n=0;n<e;n++)t.push(n);return t}t=[],n=0;for(const r in e)t[n++]=r;return t}}}(e),r=function(e){if(e.V&&"function"==typeof e.V)return e.V();if("undefined"!==typeof Map&&e instanceof Map||"undefined"!==typeof Set&&e instanceof Set)return Array.from(e.values());if("string"===typeof e)return e.split("");if(a(e)){for(var t=[],n=e.length,r=0;r<n;r++)t.push(e[r]);return t}for(r in t=[],n=0,e)t[n++]=e[r];return t}(e),i=r.length,o=0;o<i;o++)t.call(void 0,r[o],n&&n[o],e)}Ye.prototype.cancel=function(){if(this.i=nt(this),this.h)this.h.cancel(),this.h=null;else if(this.g&&0!==this.g.size){for(const e of this.g.values())e.cancel();this.g.clear()}};var it=RegExp("^(?:([^:/?#.]+):)?(?://(?:([^\\\\/?#]*)@)?([^\\\\/?#]*?)(?::([0-9]+))?(?=[\\\\/?#]|$))?([^?#]+)?(?:\\?([^#]*))?(?:#([\\s\\S]*))?$");function at(e){if(this.g=this.o=this.j="",this.s=null,this.m=this.l="",this.h=!1,e instanceof at){this.h=e.h,st(this,e.j),this.o=e.o,this.g=e.g,ct(this,e.s),this.l=e.l;var t=e.i,n=new bt;n.i=t.i,t.g&&(n.g=new Map(t.g),n.h=t.h),lt(this,n),this.m=e.m}else e&&(t=String(e).match(it))?(this.h=!1,st(this,t[1]||"",!0),this.o=ht(t[2]||""),this.g=ht(t[3]||"",!0),ct(this,t[4]),this.l=ht(t[5]||"",!0),lt(this,t[6]||"",!0),this.m=ht(t[7]||"")):(this.h=!1,this.i=new bt(null,this.h))}function ot(e){return new at(e)}function st(e,t,n){e.j=n?ht(t,!0):t,e.j&&(e.j=e.j.replace(/:$/,""))}function ct(e,t){if(t){if(t=Number(t),isNaN(t)||0>t)throw Error("Bad port number "+t);e.s=t}else e.s=null}function lt(e,t,n){t instanceof bt?(e.i=t,function(e,t){t&&!e.j&&(_t(e),e.i=null,e.g.forEach(function(e,t){var n=t.toLowerCase();t!=n&&(xt(this,t),St(this,n,e))},e)),e.j=t}(e.i,e.h)):(n||(t=ft(t,vt)),e.i=new bt(t,e.h))}function ut(e,t,n){e.i.set(t,n)}function dt(e){return ut(e,"zx",Math.floor(2147483648*Math.random()).toString(36)+Math.abs(Math.floor(2147483648*Math.random())^Date.now()).toString(36)),e}function ht(e,t){return e?t?decodeURI(e.replace(/%25/g,"%2525")):decodeURIComponent(e):""}function ft(e,t,n){return"string"===typeof e?(e=encodeURI(e).replace(t,pt),n&&(e=e.replace(/%25([0-9a-fA-F]{2})/g,"%$1")),e):null}function pt(e){return"%"+((e=e.charCodeAt(0))>>4&15).toString(16)+(15&e).toString(16)}at.prototype.toString=function(){var e=[],t=this.j;t&&e.push(ft(t,mt,!0),":");var n=this.g;return(n||"file"==t)&&(e.push("//"),(t=this.o)&&e.push(ft(t,mt,!0),"@"),e.push(encodeURIComponent(String(n)).replace(/%25([0-9a-fA-F]{2})/g,"%$1")),null!=(n=this.s)&&e.push(":",String(n))),(n=this.l)&&(this.g&&"/"!=n.charAt(0)&&e.push("/"),e.push(ft(n,"/"==n.charAt(0)?yt:gt,!0))),(n=this.i.toString())&&e.push("?",n),(n=this.m)&&e.push("#",ft(n,wt)),e.join("")};var mt=/[#\/\?@]/g,gt=/[#\?:]/g,yt=/[#\?]/g,vt=/[#\?@]/g,wt=/#/g;function bt(e,t){this.h=this.g=null,this.i=e||null,this.j=!!t}function _t(e){e.g||(e.g=new Map,e.h=0,e.i&&function(e,t){if(e){e=e.split("&");for(var n=0;n<e.length;n++){var r=e[n].indexOf("="),i=null;if(0<=r){var a=e[n].substring(0,r);i=e[n].substring(r+1)}else a=e[n];t(a,i?decodeURIComponent(i.replace(/\+/g," ")):"")}}}(e.i,function(t,n){e.add(decodeURIComponent(t.replace(/\+/g," ")),n)}))}function xt(e,t){_t(e),t=kt(e,t),e.g.has(t)&&(e.i=null,e.h-=e.g.get(t).length,e.g.delete(t))}function Et(e,t){return _t(e),t=kt(e,t),e.g.has(t)}function St(e,t,n){xt(e,t),0<n.length&&(e.i=null,e.g.set(kt(e,t),h(n)),e.h+=n.length)}function kt(e,t){return t=String(t),e.j&&(t=t.toLowerCase()),t}function Tt(e,t,n,r,i){try{i&&(i.onload=null,i.onerror=null,i.onabort=null,i.ontimeout=null),r(n)}catch(P_){}}function It(){this.g=new fe}function Ct(e,t,n){const r=n||"";try{rt(e,function(e,n){let i=e;o(e)&&(i=de(e)),t.push(r+n+"="+encodeURIComponent(i))})}catch(S_){throw t.push(r+"type="+encodeURIComponent("_badmap")),S_}}function At(e){this.l=e.Ub||null,this.j=e.eb||!1}function Ot(e,t){ne.call(this),this.D=e,this.o=t,this.m=void 0,this.status=this.readyState=0,this.responseType=this.responseText=this.response=this.statusText="",this.onreadystatechange=null,this.u=new Headers,this.h=null,this.B="GET",this.A="",this.g=!1,this.v=this.j=this.l=null}function Nt(e){e.j.read().then(e.Pa.bind(e)).catch(e.ga.bind(e))}function Rt(e){e.readyState=4,e.l=null,e.j=null,e.v=null,Pt(e)}function Pt(e){e.onreadystatechange&&e.onreadystatechange.call(e)}function Dt(e){let t="";return v(e,function(e,n){t+=n,t+=":",t+=e,t+="\r\n"}),t}function zt(e,t,n){e:{for(r in n){var r=!1;break e}r=!0}r||(n=Dt(n),"string"===typeof e?null!=n&&encodeURIComponent(String(n)):ut(e,t,n))}function Mt(e){ne.call(this),this.headers=new Map,this.o=e||null,this.h=!1,this.v=this.g=null,this.D="",this.m=0,this.l="",this.j=this.B=this.u=this.A=!1,this.I=null,this.H="",this.J=!1}(e=bt.prototype).add=function(e,t){_t(this),this.i=null,e=kt(this,e);var n=this.g.get(e);return n||this.g.set(e,n=[]),n.push(t),this.h+=1,this},e.forEach=function(e,t){_t(this),this.g.forEach(function(n,r){n.forEach(function(n){e.call(t,n,r,this)},this)},this)},e.na=function(){_t(this);const e=Array.from(this.g.values()),t=Array.from(this.g.keys()),n=[];for(let r=0;r<t.length;r++){const i=e[r];for(let e=0;e<i.length;e++)n.push(t[r])}return n},e.V=function(e){_t(this);let t=[];if("string"===typeof e)Et(this,e)&&(t=t.concat(this.g.get(kt(this,e))));else{e=Array.from(this.g.values());for(let n=0;n<e.length;n++)t=t.concat(e[n])}return t},e.set=function(e,t){return _t(this),this.i=null,Et(this,e=kt(this,e))&&(this.h-=this.g.get(e).length),this.g.set(e,[t]),this.h+=1,this},e.get=function(e,t){return e&&0<(e=this.V(e)).length?String(e[0]):t},e.toString=function(){if(this.i)return this.i;if(!this.g)return"";const e=[],t=Array.from(this.g.keys());for(var n=0;n<t.length;n++){var r=t[n];const a=encodeURIComponent(String(r)),o=this.V(r);for(r=0;r<o.length;r++){var i=a;""!==o[r]&&(i+="="+encodeURIComponent(String(o[r]))),e.push(i)}}return this.i=e.join("&")},d(At,pe),At.prototype.g=function(){return new Ot(this.l,this.j)},At.prototype.i=function(e){return function(){return e}}({}),d(Ot,ne),(e=Ot.prototype).open=function(e,t){if(0!=this.readyState)throw this.abort(),Error("Error reopening a connection");this.B=e,this.A=t,this.readyState=1,Pt(this)},e.send=function(e){if(1!=this.readyState)throw this.abort(),Error("need to call open() first. ");this.g=!0;const t={headers:this.u,method:this.B,credentials:this.m,cache:void 0};e&&(t.body=e),(this.D||i).fetch(new Request(this.A,t)).then(this.Sa.bind(this),this.ga.bind(this))},e.abort=function(){this.response=this.responseText="",this.u=new Headers,this.status=0,this.j&&this.j.cancel("Request was aborted.").catch(()=>{}),1<=this.readyState&&this.g&&4!=this.readyState&&(this.g=!1,Rt(this)),this.readyState=0},e.Sa=function(e){if(this.g&&(this.l=e,this.h||(this.status=this.l.status,this.statusText=this.l.statusText,this.h=e.headers,this.readyState=2,Pt(this)),this.g&&(this.readyState=3,Pt(this),this.g)))if("arraybuffer"===this.responseType)e.arrayBuffer().then(this.Qa.bind(this),this.ga.bind(this));else if("undefined"!==typeof i.ReadableStream&&"body"in e){if(this.j=e.body.getReader(),this.o){if(this.responseType)throw Error('responseType must be empty for "streamBinaryChunks" mode responses.');this.response=[]}else this.response=this.responseText="",this.v=new TextDecoder;Nt(this)}else e.text().then(this.Ra.bind(this),this.ga.bind(this))},e.Pa=function(e){if(this.g){if(this.o&&e.value)this.response.push(e.value);else if(!this.o){var t=e.value?e.value:new Uint8Array(0);(t=this.v.decode(t,{stream:!e.done}))&&(this.response=this.responseText+=t)}e.done?Rt(this):Pt(this),3==this.readyState&&Nt(this)}},e.Ra=function(e){this.g&&(this.response=this.responseText=e,Rt(this))},e.Qa=function(e){this.g&&(this.response=e,Rt(this))},e.ga=function(){this.g&&Rt(this)},e.setRequestHeader=function(e,t){this.u.append(e,t)},e.getResponseHeader=function(e){return this.h&&this.h.get(e.toLowerCase())||""},e.getAllResponseHeaders=function(){if(!this.h)return"";const e=[],t=this.h.entries();for(var n=t.next();!n.done;)n=n.value,e.push(n[0]+": "+n[1]),n=t.next();return e.join("\r\n")},Object.defineProperty(Ot.prototype,"withCredentials",{get:function(){return"include"===this.m},set:function(e){this.m=e?"include":"same-origin"}}),d(Mt,ne);var Lt=/^https?$/i,Ut=["POST","PUT"];function Bt(e,t){e.h=!1,e.g&&(e.j=!0,e.g.abort(),e.j=!1),e.l=t,e.m=5,Ft(e),Vt(e)}function Ft(e){e.A||(e.A=!0,re(e,"complete"),re(e,"error"))}function jt(e){if(e.h&&"undefined"!=typeof r&&(!e.v[1]||4!=Ht(e)||2!=e.Z()))if(e.u&&4==Ht(e))ae(e.Ea,0,e);else if(re(e,"readystatechange"),4==Ht(e)){e.h=!1;try{const r=e.Z();e:switch(r){case 200:case 201:case 202:case 204:case 206:case 304:case 1223:var t=!0;break e;default:t=!1}var n;if(!(n=t)){var a;if(a=0===r){var o=String(e.D).match(it)[1]||null;!o&&i.self&&i.self.location&&(o=i.self.location.protocol.slice(0,-1)),a=!Lt.test(o?o.toLowerCase():"")}n=a}if(n)re(e,"complete"),re(e,"success");else{e.m=6;try{var s=2<Ht(e)?e.g.statusText:""}catch(c){s=""}e.l=s+" ["+e.Z()+"]",Ft(e)}}finally{Vt(e)}}}function Vt(e,t){if(e.g){qt(e);const n=e.g,r=e.v[0]?()=>{}:null;e.g=null,e.v=null,t||re(e,"ready");try{n.onreadystatechange=r}catch(S_){}}}function qt(e){e.I&&(i.clearTimeout(e.I),e.I=null)}function Ht(e){return e.g?e.g.readyState:0}function Wt(e){try{if(!e.g)return null;if("response"in e.g)return e.g.response;switch(e.H){case"":case"text":return e.g.responseText;case"arraybuffer":if("mozResponseArrayBuffer"in e.g)return e.g.mozResponseArrayBuffer}return null}catch(tp){return null}}function Gt(e,t,n){return n&&n.internalChannelParams&&n.internalChannelParams[e]||t}function Kt(e){this.Aa=0,this.i=[],this.j=new Ae,this.ia=this.qa=this.I=this.W=this.g=this.ya=this.D=this.H=this.m=this.S=this.o=null,this.Ya=this.U=0,this.Va=Gt("failFast",!1,e),this.F=this.C=this.u=this.s=this.l=null,this.X=!0,this.za=this.T=-1,this.Y=this.v=this.B=0,this.Ta=Gt("baseRetryDelayMs",5e3,e),this.cb=Gt("retryDelaySeedMs",1e4,e),this.Wa=Gt("forwardChannelMaxRetries",2,e),this.wa=Gt("forwardChannelRequestTimeoutMs",2e4,e),this.pa=e&&e.xmlHttpFactory||void 0,this.Xa=e&&e.Tb||void 0,this.Ca=e&&e.useFetchStreams||!1,this.L=void 0,this.J=e&&e.supportsCrossDomainXhr||!1,this.K="",this.h=new Ye(e&&e.concurrentRequestLimit),this.Da=new It,this.P=e&&e.fastHandshake||!1,this.O=e&&e.encodeInitMessageHeaders||!1,this.P&&this.O&&(this.O=!1),this.Ua=e&&e.Rb||!1,e&&e.xa&&this.j.xa(),e&&e.forceLongPolling&&(this.X=!1),this.ba=!this.P&&this.X&&e&&e.detectBufferingProxy||!1,this.ja=void 0,e&&e.longPollingTimeout&&0<e.longPollingTimeout&&(this.ja=e.longPollingTimeout),this.ca=void 0,this.R=0,this.M=!1,this.ka=this.A=null}function Qt(e){if(Yt(e),3==e.G){var t=e.U++,n=ot(e.I);if(ut(n,"SID",e.K),ut(n,"RID",t),ut(n,"TYPE","terminate"),Zt(e,n),(t=new ze(e,e.j,t)).L=2,t.v=dt(ot(n)),n=!1,i.navigator&&i.navigator.sendBeacon)try{n=i.navigator.sendBeacon(t.v.toString(),"")}catch(r){}!n&&i.Image&&((new Image).src=t.v,n=!0),n||(t.g=hn(t.j,null),t.g.ea(t.v)),t.F=Date.now(),qe(t)}un(e)}function Xt(e){e.g&&(rn(e),e.g.cancel(),e.g=null)}function Yt(e){Xt(e),e.u&&(i.clearTimeout(e.u),e.u=null),on(e),e.h.cancel(),e.s&&("number"===typeof e.s&&i.clearTimeout(e.s),e.s=null)}function Jt(e){if(!Je(e.h)&&!e.s){e.s=!0;var t=e.Ga;I||O(),C||(I(),C=!0),A.add(t,e),e.B=0}}function $t(e,t){var n;n=t?t.l:e.U++;const r=ot(e.I);ut(r,"SID",e.K),ut(r,"RID",n),ut(r,"AID",e.T),Zt(e,r),e.m&&e.o&&zt(r,e.m,e.o),n=new ze(e,e.j,n,e.B+1),null===e.m&&(n.H=e.o),t&&(e.i=t.D.concat(e.i)),t=en(e,n,1e3),n.I=Math.round(.5*e.wa)+Math.round(.5*e.wa*Math.random()),et(e.h,n),Be(n,r,t)}function Zt(e,t){e.H&&v(e.H,function(e,n){ut(t,n,e)}),e.l&&rt({},function(e,n){ut(t,n,e)})}function en(e,t,n){n=Math.min(e.i.length,n);var r=e.l?l(e.l.Na,e.l,e):null;e:{var i=e.i;let t=-1;for(;;){const e=["count="+n];-1==t?0<n?(t=i[0].g,e.push("ofs="+t)):t=0:e.push("ofs="+t);let a=!0;for(let o=0;o<n;o++){let n=i[o].g;const s=i[o].map;if(n-=t,0>n)t=Math.max(0,i[o].g-100),a=!1;else try{Ct(s,e,"req"+n+"_")}catch($f){r&&r(s)}}if(a){r=e.join("&");break e}}}return e=e.i.splice(0,n),t.D=e,r}function tn(e){if(!e.g&&!e.u){e.Y=1;var t=e.Fa;I||O(),C||(I(),C=!0),A.add(t,e),e.v=0}}function nn(e){return!(e.g||e.u||3<=e.v)&&(e.Y++,e.u=Ce(l(e.Fa,e),cn(e,e.v)),e.v++,!0)}function rn(e){null!=e.A&&(i.clearTimeout(e.A),e.A=null)}function an(e){e.g=new ze(e,e.j,"rpc",e.Y),null===e.m&&(e.g.H=e.o),e.g.O=0;var t=ot(e.qa);ut(t,"RID","rpc"),ut(t,"SID",e.K),ut(t,"AID",e.T),ut(t,"CI",e.F?"0":"1"),!e.F&&e.ja&&ut(t,"TO",e.ja),ut(t,"TYPE","xmlhttp"),Zt(e,t),e.m&&e.o&&zt(t,e.m,e.o),e.L&&(e.g.I=e.L);var n=e.g;e=e.ia,n.L=1,n.v=dt(ot(t)),n.m=null,n.P=!0,Fe(n,e)}function on(e){null!=e.C&&(i.clearTimeout(e.C),e.C=null)}function sn(e,t){var n=null;if(e.g==t){on(e),rn(e),e.g=null;var r=2}else{if(!Ze(e.h,t))return;n=t.D,tt(e.h,t),r=1}if(0!=e.G)if(t.o)if(1==r){n=t.m?t.m.length:0,t=Date.now()-t.F;var i=e.B;re(r=xe(),new Ie(r,n)),Jt(e)}else tn(e);else if(3==(i=t.s)||0==i&&0<t.X||!(1==r&&function(e,t){return!($e(e.h)>=e.h.j-(e.s?1:0))&&(e.s?(e.i=t.D.concat(e.i),!0):!(1==e.G||2==e.G||e.B>=(e.Va?0:e.Wa))&&(e.s=Ce(l(e.Ga,e,t),cn(e,e.B)),e.B++,!0))}(e,t)||2==r&&nn(e)))switch(n&&0<n.length&&(t=e.h,t.i=t.i.concat(n)),i){case 1:ln(e,5);break;case 4:ln(e,10);break;case 3:ln(e,6);break;default:ln(e,2)}}function cn(e,t){let n=e.Ta+Math.floor(Math.random()*e.cb);return e.isActive()||(n*=2),n*t}function ln(e,t){if(e.j.info("Error code "+t),2==t){var n=l(e.fb,e),r=e.Xa;const t=!r;r=new at(r||"//www.google.com/images/cleardot.gif"),i.location&&"http"==i.location.protocol||st(r,"https"),dt(r),t?function(e,t){const n=new Ae;if(i.Image){const r=new Image;r.onload=u(Tt,n,"TestLoadImage: loaded",!0,t,r),r.onerror=u(Tt,n,"TestLoadImage: error",!1,t,r),r.onabort=u(Tt,n,"TestLoadImage: abort",!1,t,r),r.ontimeout=u(Tt,n,"TestLoadImage: timeout",!1,t,r),i.setTimeout(function(){r.ontimeout&&r.ontimeout()},1e4),r.src=e}else t(!1)}(r.toString(),n):function(e,t){new Ae;const n=new AbortController,r=setTimeout(()=>{n.abort(),Tt(0,0,!1,t)},1e4);fetch(e,{signal:n.signal}).then(e=>{clearTimeout(r),e.ok?Tt(0,0,!0,t):Tt(0,0,!1,t)}).catch(()=>{clearTimeout(r),Tt(0,0,!1,t)})}(r.toString(),n)}else Te(2);e.G=0,e.l&&e.l.sa(t),un(e),Yt(e)}function un(e){if(e.G=0,e.ka=[],e.l){const t=nt(e.h);0==t.length&&0==e.i.length||(f(e.ka,t),f(e.ka,e.i),e.h.i.length=0,h(e.i),e.i.length=0),e.l.ra()}}function dn(e,t,n){var r=n instanceof at?ot(n):new at(n);if(""!=r.g)t&&(r.g=t+"."+r.g),ct(r,r.s);else{var a=i.location;r=a.protocol,t=t?t+"."+a.hostname:a.hostname,a=+a.port;var o=new at(null);r&&st(o,r),t&&(o.g=t),a&&ct(o,a),n&&(o.l=n),r=o}return n=e.D,t=e.ya,n&&t&&ut(r,n,t),ut(r,"VER",e.la),Zt(e,r),r}function hn(e,t,n){if(t&&!e.J)throw Error("Can't create secondary domain capable XhrIo object.");return(t=e.Ca&&!e.pa?new Mt(new At({eb:n})):new Mt(e.pa)).Ha(e.J),t}function fn(){}function pn(){}function mn(e,t){ne.call(this),this.g=new Kt(t),this.l=e,this.h=t&&t.messageUrlParams||null,e=t&&t.messageHeaders||null,t&&t.clientProtocolHeaderRequired&&(e?e["X-Client-Protocol"]="webchannel":e={"X-Client-Protocol":"webchannel"}),this.g.o=e,e=t&&t.initMessageHeaders||null,t&&t.messageContentType&&(e?e["X-WebChannel-Content-Type"]=t.messageContentType:e={"X-WebChannel-Content-Type":t.messageContentType}),t&&t.va&&(e?e["X-WebChannel-Client-Profile"]=t.va:e={"X-WebChannel-Client-Profile":t.va}),this.g.S=e,(e=t&&t.Sb)&&!p(e)&&(this.g.m=e),this.v=t&&t.supportsCrossDomainXhr||!1,this.u=t&&t.sendRawJson||!1,(t=t&&t.httpSessionIdParam)&&!p(t)&&(this.g.D=t,null!==(e=this.h)&&t in e&&(t in(e=this.h)&&delete e[t])),this.j=new vn(this)}function gn(e){ve.call(this),e.__headers__&&(this.headers=e.__headers__,this.statusCode=e.__status__,delete e.__headers__,delete e.__status__);var t=e.__sm__;if(t){e:{for(const n in t){e=n;break e}e=void 0}(this.i=e)&&(e=this.i,t=null!==t&&e in t?t[e]:void 0),this.data=t}else this.data=e}function yn(){we.call(this),this.status=1}function vn(e){this.g=e}(e=Mt.prototype).Ha=function(e){this.J=e},e.ea=function(e,t,n,r){if(this.g)throw Error("[goog.net.XhrIo] Object is active with another request="+this.D+"; newUri="+e);t=t?t.toUpperCase():"GET",this.D=e,this.l="",this.m=0,this.A=!1,this.h=!0,this.g=this.o?this.o.g():Ne.g(),this.v=this.o?me(this.o):me(Ne),this.g.onreadystatechange=l(this.Ea,this);try{this.B=!0,this.g.open(t,String(e),!0),this.B=!1}catch(P_){return void Bt(this,P_)}if(e=n||"",n=new Map(this.headers),r)if(Object.getPrototypeOf(r)===Object.prototype)for(var a in r)n.set(a,r[a]);else{if("function"!==typeof r.keys||"function"!==typeof r.get)throw Error("Unknown input type for opt_headers: "+String(r));for(const e of r.keys())n.set(e,r.get(e))}r=Array.from(n.keys()).find(e=>"content-type"==e.toLowerCase()),a=i.FormData&&e instanceof i.FormData,!(0<=Array.prototype.indexOf.call(Ut,t,void 0))||r||a||n.set("Content-Type","application/x-www-form-urlencoded;charset=utf-8");for(const[i,o]of n)this.g.setRequestHeader(i,o);this.H&&(this.g.responseType=this.H),"withCredentials"in this.g&&this.g.withCredentials!==this.J&&(this.g.withCredentials=this.J);try{qt(this),this.u=!0,this.g.send(e),this.u=!1}catch(P_){Bt(this,P_)}},e.abort=function(e){this.g&&this.h&&(this.h=!1,this.j=!0,this.g.abort(),this.j=!1,this.m=e||7,re(this,"complete"),re(this,"abort"),Vt(this))},e.N=function(){this.g&&(this.h&&(this.h=!1,this.j=!0,this.g.abort(),this.j=!1),Vt(this,!0)),Mt.aa.N.call(this)},e.Ea=function(){this.s||(this.B||this.u||this.j?jt(this):this.bb())},e.bb=function(){jt(this)},e.isActive=function(){return!!this.g},e.Z=function(){try{return 2<Ht(this)?this.g.status:-1}catch(N_){return-1}},e.oa=function(){try{return this.g?this.g.responseText:""}catch(N_){return""}},e.Oa=function(e){if(this.g){var t=this.g.responseText;return e&&0==t.indexOf(e)&&(t=t.substring(e.length)),he(t)}},e.Ba=function(){return this.m},e.Ka=function(){return"string"===typeof this.l?this.l:String(this.l)},(e=Kt.prototype).la=8,e.G=1,e.connect=function(e,t,n,r){Te(0),this.W=e,this.H=t||{},n&&void 0!==r&&(this.H.OSID=n,this.H.OAID=r),this.F=this.X,this.I=dn(this,null,this.W),Jt(this)},e.Ga=function(e){if(this.s)if(this.s=null,1==this.G){if(!e){this.U=Math.floor(1e5*Math.random()),e=this.U++;const i=new ze(this,this.j,e);let a=this.o;if(this.S&&(a?(a=w(a),_(a,this.S)):a=this.S),null!==this.m||this.O||(i.H=a,a=null),this.P)e:{for(var t=0,n=0;n<this.i.length;n++){var r=this.i[n];if(void 0===(r="__data__"in r.map&&"string"===typeof(r=r.map.__data__)?r.length:void 0))break;if(4096<(t+=r)){t=n;break e}if(4096===t||n===this.i.length-1){t=n+1;break e}}t=1e3}else t=1e3;t=en(this,i,t),ut(n=ot(this.I),"RID",e),ut(n,"CVER",22),this.D&&ut(n,"X-HTTP-Session-Id",this.D),Zt(this,n),a&&(this.O?t="headers="+encodeURIComponent(String(Dt(a)))+"&"+t:this.m&&zt(n,this.m,a)),et(this.h,i),this.Ua&&ut(n,"TYPE","init"),this.P?(ut(n,"$req",t),ut(n,"SID","null"),i.T=!0,Be(i,n,null)):Be(i,n,t),this.G=2}}else 3==this.G&&(e?$t(this,e):0==this.i.length||Je(this.h)||$t(this))},e.Fa=function(){if(this.u=null,an(this),this.ba&&!(this.M||null==this.g||0>=this.R)){var e=2*this.R;this.j.info("BP detection timer enabled: "+e),this.A=Ce(l(this.ab,this),e)}},e.ab=function(){this.A&&(this.A=null,this.j.info("BP detection timeout reached."),this.j.info("Buffering proxy detected and switch to long-polling!"),this.F=!1,this.M=!0,Te(10),Xt(this),an(this))},e.Za=function(){null!=this.C&&(this.C=null,Xt(this),nn(this),Te(19))},e.fb=function(e){e?(this.j.info("Successfully pinged google.com"),Te(2)):(this.j.info("Failed to ping google.com"),Te(1))},e.isActive=function(){return!!this.l&&this.l.isActive(this)},(e=fn.prototype).ua=function(){},e.ta=function(){},e.sa=function(){},e.ra=function(){},e.isActive=function(){return!0},e.Na=function(){},pn.prototype.g=function(e,t){return new mn(e,t)},d(mn,ne),mn.prototype.m=function(){this.g.l=this.j,this.v&&(this.g.J=!0),this.g.connect(this.l,this.h||void 0)},mn.prototype.close=function(){Qt(this.g)},mn.prototype.o=function(e){var t=this.g;if("string"===typeof e){var n={};n.__data__=e,e=n}else this.u&&((n={}).__data__=de(e),e=n);t.i.push(new Xe(t.Ya++,e)),3==t.G&&Jt(t)},mn.prototype.N=function(){this.g.l=null,delete this.j,Qt(this.g),delete this.g,mn.aa.N.call(this)},d(gn,ve),d(yn,we),d(vn,fn),vn.prototype.ua=function(){re(this.g,"a")},vn.prototype.ta=function(e){re(this.g,new gn(e))},vn.prototype.sa=function(e){re(this.g,new yn)},vn.prototype.ra=function(){re(this.g,"b")},pn.prototype.createWebChannel=pn.prototype.g,mn.prototype.send=mn.prototype.o,mn.prototype.open=mn.prototype.m,mn.prototype.close=mn.prototype.close,Xf=Jf.createWebChannelTransport=function(){return new pn},Qf=Jf.getStatEventTarget=function(){return xe()},Kf=Jf.Event=be,Gf=Jf.Stat={mb:0,pb:1,qb:2,Jb:3,Ob:4,Lb:5,Mb:6,Kb:7,Ib:8,Nb:9,PROXY:10,NOPROXY:11,Gb:12,Cb:13,Db:14,Bb:15,Eb:16,Fb:17,ib:18,hb:19,jb:20},Re.NO_ERROR=0,Re.TIMEOUT=8,Re.HTTP_ERROR=6,Wf=Jf.ErrorCode=Re,Pe.COMPLETE="complete",Hf=Jf.EventType=Pe,ge.EventType=ye,ye.OPEN="a",ye.CLOSE="b",ye.ERROR="c",ye.MESSAGE="d",ne.prototype.listen=ne.prototype.K,qf=Jf.WebChannel=ge,Jf.FetchXmlHttpFactory=At,Mt.prototype.listenOnce=Mt.prototype.L,Mt.prototype.getLastError=Mt.prototype.Ka,Mt.prototype.getLastErrorCode=Mt.prototype.Ba,Mt.prototype.getStatus=Mt.prototype.Z,Mt.prototype.getResponseJson=Mt.prototype.Oa,Mt.prototype.getResponseText=Mt.prototype.oa,Mt.prototype.send=Mt.prototype.ea,Mt.prototype.setWithCredentials=Mt.prototype.Ha,Vf=Jf.XhrIo=Mt}).apply("undefined"!==typeof Yf?Yf:"undefined"!==typeof self?self:"undefined"!==typeof window?window:{});const $f="@firebase/firestore";class Zf{constructor(e){this.uid=e}isAuthenticated(){return null!=this.uid}toKey(){return this.isAuthenticated()?"uid:"+this.uid:"anonymous-user"}isEqual(e){return e.uid===this.uid}}Zf.UNAUTHENTICATED=new Zf(null),Zf.GOOGLE_CREDENTIALS=new Zf("google-credentials-uid"),Zf.FIRST_PARTY=new Zf("first-party-uid"),Zf.MOCK_USER=new Zf("mock-user");let ep="10.14.0";const tp=new bh("@firebase/firestore");function np(){return tp.logLevel}function rp(e){if(tp.logLevel<=mh.DEBUG){for(var t=arguments.length,n=new Array(t>1?t-1:0),r=1;r<t;r++)n[r-1]=arguments[r];const i=n.map(op);tp.debug("Firestore (".concat(ep,"): ").concat(e),...i)}}function ip(e){if(tp.logLevel<=mh.ERROR){for(var t=arguments.length,n=new Array(t>1?t-1:0),r=1;r<t;r++)n[r-1]=arguments[r];const i=n.map(op);tp.error("Firestore (".concat(ep,"): ").concat(e),...i)}}function ap(e){if(tp.logLevel<=mh.WARN){for(var t=arguments.length,n=new Array(t>1?t-1:0),r=1;r<t;r++)n[r-1]=arguments[r];const i=n.map(op);tp.warn("Firestore (".concat(ep,"): ").concat(e),...i)}}function op(e){if("string"==typeof e)return e;try{return function(e){return JSON.stringify(e)}(e)}catch(k_){return e}}function sp(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"Unexpected state";const t="FIRESTORE (".concat(ep,") INTERNAL ASSERTION FAILED: ")+e;throw ip(t),new Error(t)}function cp(e,t){e||sp()}function lp(e,t){return e}const up={OK:"ok",CANCELLED:"cancelled",UNKNOWN:"unknown",INVALID_ARGUMENT:"invalid-argument",DEADLINE_EXCEEDED:"deadline-exceeded",NOT_FOUND:"not-found",ALREADY_EXISTS:"already-exists",PERMISSION_DENIED:"permission-denied",UNAUTHENTICATED:"unauthenticated",RESOURCE_EXHAUSTED:"resource-exhausted",FAILED_PRECONDITION:"failed-precondition",ABORTED:"aborted",OUT_OF_RANGE:"out-of-range",UNIMPLEMENTED:"unimplemented",INTERNAL:"internal",UNAVAILABLE:"unavailable",DATA_LOSS:"data-loss"};class dp extends Zd{constructor(e,t){super(e,t),this.code=e,this.message=t,this.toString=()=>"".concat(this.name,": [code=").concat(this.code,"]: ").concat(this.message)}}class hp{constructor(){this.promise=new Promise((e,t)=>{this.resolve=e,this.reject=t})}}class fp{constructor(e,t){this.user=t,this.type="OAuth",this.headers=new Map,this.headers.set("Authorization","Bearer ".concat(e))}}class pp{getToken(){return Promise.resolve(null)}invalidateToken(){}start(e,t){e.enqueueRetryable(()=>t(Zf.UNAUTHENTICATED))}shutdown(){}}class mp{constructor(e){this.token=e,this.changeListener=null}getToken(){return Promise.resolve(this.token)}invalidateToken(){}start(e,t){this.changeListener=t,e.enqueueRetryable(()=>t(this.token.user))}shutdown(){this.changeListener=null}}class gp{constructor(e){this.t=e,this.currentUser=Zf.UNAUTHENTICATED,this.i=0,this.forceRefresh=!1,this.auth=null}start(e,t){cp(void 0===this.o);let n=this.i;const r=e=>this.i!==n?(n=this.i,t(e)):Promise.resolve();let i=new hp;this.o=()=>{this.i++,this.currentUser=this.u(),i.resolve(),i=new hp,e.enqueueRetryable(()=>r(this.currentUser))};const a=()=>{const t=i;e.enqueueRetryable(async()=>{await t.promise,await r(this.currentUser)})},o=e=>{rp("FirebaseAuthCredentialsProvider","Auth detected"),this.auth=e,this.o&&(this.auth.addAuthTokenListener(this.o),a())};this.t.onInit(e=>o(e)),setTimeout(()=>{if(!this.auth){const e=this.t.getImmediate({optional:!0});e?o(e):(rp("FirebaseAuthCredentialsProvider","Auth not yet detected"),i.resolve(),i=new hp)}},0),a()}getToken(){const e=this.i,t=this.forceRefresh;return this.forceRefresh=!1,this.auth?this.auth.getToken(t).then(t=>this.i!==e?(rp("FirebaseAuthCredentialsProvider","getToken aborted due to token change."),this.getToken()):t?(cp("string"==typeof t.accessToken),new fp(t.accessToken,this.currentUser)):null):Promise.resolve(null)}invalidateToken(){this.forceRefresh=!0}shutdown(){this.auth&&this.o&&this.auth.removeAuthTokenListener(this.o),this.o=void 0}u(){const e=this.auth&&this.auth.getUid();return cp(null===e||"string"==typeof e),new Zf(e)}}class yp{constructor(e,t,n){this.l=e,this.h=t,this.P=n,this.type="FirstParty",this.user=Zf.FIRST_PARTY,this.I=new Map}T(){return this.P?this.P():null}get headers(){this.I.set("X-Goog-AuthUser",this.l);const e=this.T();return e&&this.I.set("Authorization",e),this.h&&this.I.set("X-Goog-Iam-Authorization-Token",this.h),this.I}}class vp{constructor(e,t,n){this.l=e,this.h=t,this.P=n}getToken(){return Promise.resolve(new yp(this.l,this.h,this.P))}start(e,t){e.enqueueRetryable(()=>t(Zf.FIRST_PARTY))}shutdown(){}invalidateToken(){}}class wp{constructor(e){this.value=e,this.type="AppCheck",this.headers=new Map,e&&e.length>0&&this.headers.set("x-firebase-appcheck",this.value)}}class bp{constructor(e){this.A=e,this.forceRefresh=!1,this.appCheck=null,this.R=null}start(e,t){cp(void 0===this.o);const n=e=>{null!=e.error&&rp("FirebaseAppCheckTokenProvider","Error getting App Check token; using placeholder token instead. Error: ".concat(e.error.message));const n=e.token!==this.R;return this.R=e.token,rp("FirebaseAppCheckTokenProvider","Received ".concat(n?"new":"existing"," token.")),n?t(e.token):Promise.resolve()};this.o=t=>{e.enqueueRetryable(()=>n(t))};const r=e=>{rp("FirebaseAppCheckTokenProvider","AppCheck detected"),this.appCheck=e,this.o&&this.appCheck.addTokenListener(this.o)};this.A.onInit(e=>r(e)),setTimeout(()=>{if(!this.appCheck){const e=this.A.getImmediate({optional:!0});e?r(e):rp("FirebaseAppCheckTokenProvider","AppCheck not yet detected")}},0)}getToken(){const e=this.forceRefresh;return this.forceRefresh=!1,this.appCheck?this.appCheck.getToken(e).then(e=>e?(cp("string"==typeof e.token),this.R=e.token,new wp(e.token)):null):Promise.resolve(null)}invalidateToken(){this.forceRefresh=!0}shutdown(){this.appCheck&&this.o&&this.appCheck.removeTokenListener(this.o),this.o=void 0}}function _p(e){const t="undefined"!=typeof self&&(self.crypto||self.msCrypto),n=new Uint8Array(e);if(t&&"function"==typeof t.getRandomValues)t.getRandomValues(n);else for(let r=0;r<e;r++)n[r]=Math.floor(256*Math.random());return n}class xp{static newId(){const e="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",t=62*Math.floor(256/62);let n="";for(;n.length<20;){const r=_p(40);for(let i=0;i<r.length;++i)n.length<20&&r[i]<t&&(n+=e.charAt(r[i]%62))}return n}}function Ep(e,t){return e<t?-1:e>t?1:0}function Sp(e,t,n){return e.length===t.length&&e.every((e,r)=>n(e,t[r]))}class kp{constructor(e,t){if(this.seconds=e,this.nanoseconds=t,t<0)throw new dp(up.INVALID_ARGUMENT,"Timestamp nanoseconds out of range: "+t);if(t>=1e9)throw new dp(up.INVALID_ARGUMENT,"Timestamp nanoseconds out of range: "+t);if(e<-62135596800)throw new dp(up.INVALID_ARGUMENT,"Timestamp seconds out of range: "+e);if(e>=253402300800)throw new dp(up.INVALID_ARGUMENT,"Timestamp seconds out of range: "+e)}static now(){return kp.fromMillis(Date.now())}static fromDate(e){return kp.fromMillis(e.getTime())}static fromMillis(e){const t=Math.floor(e/1e3),n=Math.floor(1e6*(e-1e3*t));return new kp(t,n)}toDate(){return new Date(this.toMillis())}toMillis(){return 1e3*this.seconds+this.nanoseconds/1e6}_compareTo(e){return this.seconds===e.seconds?Ep(this.nanoseconds,e.nanoseconds):Ep(this.seconds,e.seconds)}isEqual(e){return e.seconds===this.seconds&&e.nanoseconds===this.nanoseconds}toString(){return"Timestamp(seconds="+this.seconds+", nanoseconds="+this.nanoseconds+")"}toJSON(){return{seconds:this.seconds,nanoseconds:this.nanoseconds}}valueOf(){const e=this.seconds- -62135596800;return String(e).padStart(12,"0")+"."+String(this.nanoseconds).padStart(9,"0")}}class Tp{constructor(e){this.timestamp=e}static fromTimestamp(e){return new Tp(e)}static min(){return new Tp(new kp(0,0))}static max(){return new Tp(new kp(253402300799,999999999))}compareTo(e){return this.timestamp._compareTo(e.timestamp)}isEqual(e){return this.timestamp.isEqual(e.timestamp)}toMicroseconds(){return 1e6*this.timestamp.seconds+this.timestamp.nanoseconds/1e3}toString(){return"SnapshotVersion("+this.timestamp.toString()+")"}toTimestamp(){return this.timestamp}}class Ip{constructor(e,t,n){void 0===t?t=0:t>e.length&&sp(),void 0===n?n=e.length-t:n>e.length-t&&sp(),this.segments=e,this.offset=t,this.len=n}get length(){return this.len}isEqual(e){return 0===Ip.comparator(this,e)}child(e){const t=this.segments.slice(this.offset,this.limit());return e instanceof Ip?e.forEach(e=>{t.push(e)}):t.push(e),this.construct(t)}limit(){return this.offset+this.length}popFirst(e){return e=void 0===e?1:e,this.construct(this.segments,this.offset+e,this.length-e)}popLast(){return this.construct(this.segments,this.offset,this.length-1)}firstSegment(){return this.segments[this.offset]}lastSegment(){return this.get(this.length-1)}get(e){return this.segments[this.offset+e]}isEmpty(){return 0===this.length}isPrefixOf(e){if(e.length<this.length)return!1;for(let t=0;t<this.length;t++)if(this.get(t)!==e.get(t))return!1;return!0}isImmediateParentOf(e){if(this.length+1!==e.length)return!1;for(let t=0;t<this.length;t++)if(this.get(t)!==e.get(t))return!1;return!0}forEach(e){for(let t=this.offset,n=this.limit();t<n;t++)e(this.segments[t])}toArray(){return this.segments.slice(this.offset,this.limit())}static comparator(e,t){const n=Math.min(e.length,t.length);for(let r=0;r<n;r++){const n=e.get(r),i=t.get(r);if(n<i)return-1;if(n>i)return 1}return e.length<t.length?-1:e.length>t.length?1:0}}class Cp extends Ip{construct(e,t,n){return new Cp(e,t,n)}canonicalString(){return this.toArray().join("/")}toString(){return this.canonicalString()}toUriEncodedString(){return this.toArray().map(encodeURIComponent).join("/")}static fromString(){const e=[];for(var t=arguments.length,n=new Array(t),r=0;r<t;r++)n[r]=arguments[r];for(const i of n){if(i.indexOf("//")>=0)throw new dp(up.INVALID_ARGUMENT,"Invalid segment (".concat(i,"). Paths must not contain // in them."));e.push(...i.split("/").filter(e=>e.length>0))}return new Cp(e)}static emptyPath(){return new Cp([])}}const Ap=/^[_a-zA-Z][_a-zA-Z0-9]*$/;class Op extends Ip{construct(e,t,n){return new Op(e,t,n)}static isValidIdentifier(e){return Ap.test(e)}canonicalString(){return this.toArray().map(e=>(e=e.replace(/\\/g,"\\\\").replace(/`/g,"\\`"),Op.isValidIdentifier(e)||(e="`"+e+"`"),e)).join(".")}toString(){return this.canonicalString()}isKeyField(){return 1===this.length&&"__name__"===this.get(0)}static keyField(){return new Op(["__name__"])}static fromServerFormat(e){const t=[];let n="",r=0;const i=()=>{if(0===n.length)throw new dp(up.INVALID_ARGUMENT,"Invalid field path (".concat(e,"). Paths must not be empty, begin with '.', end with '.', or contain '..'"));t.push(n),n=""};let a=!1;for(;r<e.length;){const t=e[r];if("\\"===t){if(r+1===e.length)throw new dp(up.INVALID_ARGUMENT,"Path has trailing escape character: "+e);const t=e[r+1];if("\\"!==t&&"."!==t&&"`"!==t)throw new dp(up.INVALID_ARGUMENT,"Path has invalid escape sequence: "+e);n+=t,r+=2}else"`"===t?(a=!a,r++):"."!==t||a?(n+=t,r++):(i(),r++)}if(i(),a)throw new dp(up.INVALID_ARGUMENT,"Unterminated ` in path: "+e);return new Op(t)}static emptyPath(){return new Op([])}}class Np{constructor(e){this.path=e}static fromPath(e){return new Np(Cp.fromString(e))}static fromName(e){return new Np(Cp.fromString(e).popFirst(5))}static empty(){return new Np(Cp.emptyPath())}get collectionGroup(){return this.path.popLast().lastSegment()}hasCollectionId(e){return this.path.length>=2&&this.path.get(this.path.length-2)===e}getCollectionGroup(){return this.path.get(this.path.length-2)}getCollectionPath(){return this.path.popLast()}isEqual(e){return null!==e&&0===Cp.comparator(this.path,e.path)}toString(){return this.path.toString()}static comparator(e,t){return Cp.comparator(e.path,t.path)}static isDocumentKey(e){return e.length%2==0}static fromSegments(e){return new Np(new Cp(e.slice()))}}class Rp{constructor(e,t,n,r){this.indexId=e,this.collectionGroup=t,this.fields=n,this.indexState=r}}Rp.UNKNOWN_ID=-1;function Pp(e,t){const n=e.toTimestamp().seconds,r=e.toTimestamp().nanoseconds+1,i=Tp.fromTimestamp(1e9===r?new kp(n+1,0):new kp(n,r));return new zp(i,Np.empty(),t)}function Dp(e){return new zp(e.readTime,e.key,-1)}class zp{constructor(e,t,n){this.readTime=e,this.documentKey=t,this.largestBatchId=n}static min(){return new zp(Tp.min(),Np.empty(),-1)}static max(){return new zp(Tp.max(),Np.empty(),-1)}}function Mp(e,t){let n=e.readTime.compareTo(t.readTime);return 0!==n?n:(n=Np.comparator(e.documentKey,t.documentKey),0!==n?n:Ep(e.largestBatchId,t.largestBatchId))}const Lp="The current tab is not in the required state to perform this operation. It might be necessary to refresh the browser tab.";class Up{constructor(){this.onCommittedListeners=[]}addOnCommittedListener(e){this.onCommittedListeners.push(e)}raiseOnCommittedEvent(){this.onCommittedListeners.forEach(e=>e())}}async function Bp(e){if(e.code!==up.FAILED_PRECONDITION||e.message!==Lp)throw e;rp("LocalStore","Unexpectedly lost primary lease")}class Fp{constructor(e){this.nextCallback=null,this.catchCallback=null,this.result=void 0,this.error=void 0,this.isDone=!1,this.callbackAttached=!1,e(e=>{this.isDone=!0,this.result=e,this.nextCallback&&this.nextCallback(e)},e=>{this.isDone=!0,this.error=e,this.catchCallback&&this.catchCallback(e)})}catch(e){return this.next(void 0,e)}next(e,t){return this.callbackAttached&&sp(),this.callbackAttached=!0,this.isDone?this.error?this.wrapFailure(t,this.error):this.wrapSuccess(e,this.result):new Fp((n,r)=>{this.nextCallback=t=>{this.wrapSuccess(e,t).next(n,r)},this.catchCallback=e=>{this.wrapFailure(t,e).next(n,r)}})}toPromise(){return new Promise((e,t)=>{this.next(e,t)})}wrapUserFunction(e){try{const t=e();return t instanceof Fp?t:Fp.resolve(t)}catch(e){return Fp.reject(e)}}wrapSuccess(e,t){return e?this.wrapUserFunction(()=>e(t)):Fp.resolve(t)}wrapFailure(e,t){return e?this.wrapUserFunction(()=>e(t)):Fp.reject(t)}static resolve(e){return new Fp((t,n)=>{t(e)})}static reject(e){return new Fp((t,n)=>{n(e)})}static waitFor(e){return new Fp((t,n)=>{let r=0,i=0,a=!1;e.forEach(e=>{++r,e.next(()=>{++i,a&&i===r&&t()},e=>n(e))}),a=!0,i===r&&t()})}static or(e){let t=Fp.resolve(!1);for(const n of e)t=t.next(e=>e?Fp.resolve(e):n());return t}static forEach(e,t){const n=[];return e.forEach((e,r)=>{n.push(t.call(this,e,r))}),this.waitFor(n)}static mapArray(e,t){return new Fp((n,r)=>{const i=e.length,a=new Array(i);let o=0;for(let s=0;s<i;s++){const c=s;t(e[c]).next(e=>{a[c]=e,++o,o===i&&n(a)},e=>r(e))}})}static doWhile(e,t){return new Fp((n,r)=>{const i=()=>{!0===e()?t().next(()=>{i()},r):n()};i()})}}function jp(e){const t=e.match(/Android ([\d.]+)/i),n=t?t[1].split(".").slice(0,2).join("."):"-1";return Number(n)}function Vp(e){return"IndexedDbTransactionError"===e.name}class qp{constructor(e,t){this.previousValue=e,t&&(t.sequenceNumberHandler=e=>this.ie(e),this.se=e=>t.writeSequenceNumber(e))}ie(e){return this.previousValue=Math.max(e,this.previousValue),this.previousValue}next(){const e=++this.previousValue;return this.se&&this.se(e),e}}function Hp(e){return null==e}function Wp(e){return 0===e&&1/e==-1/0}function Gp(e){return"number"==typeof e&&Number.isInteger(e)&&!Wp(e)&&e<=Number.MAX_SAFE_INTEGER&&e>=Number.MIN_SAFE_INTEGER}qp.oe=-1;const Kp=["mutationQueues","mutations","documentMutations","remoteDocuments","targets","owner","targetGlobal","targetDocuments","clientMetadata","remoteDocumentGlobal","collectionParents","bundles","namedQueries"],Qp=["mutationQueues","mutations","documentMutations","remoteDocumentsV14","targets","owner","targetGlobal","targetDocuments","clientMetadata","remoteDocumentGlobal","collectionParents","bundles","namedQueries","documentOverlays"],Xp=Qp,Yp=[...Xp,"indexConfiguration","indexState","indexEntries"];function Jp(e){let t=0;for(const n in e)Object.prototype.hasOwnProperty.call(e,n)&&t++;return t}function $p(e,t){for(const n in e)Object.prototype.hasOwnProperty.call(e,n)&&t(n,e[n])}function Zp(e){for(const t in e)if(Object.prototype.hasOwnProperty.call(e,t))return!1;return!0}class em{constructor(e,t){this.comparator=e,this.root=t||nm.EMPTY}insert(e,t){return new em(this.comparator,this.root.insert(e,t,this.comparator).copy(null,null,nm.BLACK,null,null))}remove(e){return new em(this.comparator,this.root.remove(e,this.comparator).copy(null,null,nm.BLACK,null,null))}get(e){let t=this.root;for(;!t.isEmpty();){const n=this.comparator(e,t.key);if(0===n)return t.value;n<0?t=t.left:n>0&&(t=t.right)}return null}indexOf(e){let t=0,n=this.root;for(;!n.isEmpty();){const r=this.comparator(e,n.key);if(0===r)return t+n.left.size;r<0?n=n.left:(t+=n.left.size+1,n=n.right)}return-1}isEmpty(){return this.root.isEmpty()}get size(){return this.root.size}minKey(){return this.root.minKey()}maxKey(){return this.root.maxKey()}inorderTraversal(e){return this.root.inorderTraversal(e)}forEach(e){this.inorderTraversal((t,n)=>(e(t,n),!1))}toString(){const e=[];return this.inorderTraversal((t,n)=>(e.push("".concat(t,":").concat(n)),!1)),"{".concat(e.join(", "),"}")}reverseTraversal(e){return this.root.reverseTraversal(e)}getIterator(){return new tm(this.root,null,this.comparator,!1)}getIteratorFrom(e){return new tm(this.root,e,this.comparator,!1)}getReverseIterator(){return new tm(this.root,null,this.comparator,!0)}getReverseIteratorFrom(e){return new tm(this.root,e,this.comparator,!0)}}class tm{constructor(e,t,n,r){this.isReverse=r,this.nodeStack=[];let i=1;for(;!e.isEmpty();)if(i=t?n(e.key,t):1,t&&r&&(i*=-1),i<0)e=this.isReverse?e.left:e.right;else{if(0===i){this.nodeStack.push(e);break}this.nodeStack.push(e),e=this.isReverse?e.right:e.left}}getNext(){let e=this.nodeStack.pop();const t={key:e.key,value:e.value};if(this.isReverse)for(e=e.left;!e.isEmpty();)this.nodeStack.push(e),e=e.right;else for(e=e.right;!e.isEmpty();)this.nodeStack.push(e),e=e.left;return t}hasNext(){return this.nodeStack.length>0}peek(){if(0===this.nodeStack.length)return null;const e=this.nodeStack[this.nodeStack.length-1];return{key:e.key,value:e.value}}}class nm{constructor(e,t,n,r,i){this.key=e,this.value=t,this.color=null!=n?n:nm.RED,this.left=null!=r?r:nm.EMPTY,this.right=null!=i?i:nm.EMPTY,this.size=this.left.size+1+this.right.size}copy(e,t,n,r,i){return new nm(null!=e?e:this.key,null!=t?t:this.value,null!=n?n:this.color,null!=r?r:this.left,null!=i?i:this.right)}isEmpty(){return!1}inorderTraversal(e){return this.left.inorderTraversal(e)||e(this.key,this.value)||this.right.inorderTraversal(e)}reverseTraversal(e){return this.right.reverseTraversal(e)||e(this.key,this.value)||this.left.reverseTraversal(e)}min(){return this.left.isEmpty()?this:this.left.min()}minKey(){return this.min().key}maxKey(){return this.right.isEmpty()?this.key:this.right.maxKey()}insert(e,t,n){let r=this;const i=n(e,r.key);return r=i<0?r.copy(null,null,null,r.left.insert(e,t,n),null):0===i?r.copy(null,t,null,null,null):r.copy(null,null,null,null,r.right.insert(e,t,n)),r.fixUp()}removeMin(){if(this.left.isEmpty())return nm.EMPTY;let e=this;return e.left.isRed()||e.left.left.isRed()||(e=e.moveRedLeft()),e=e.copy(null,null,null,e.left.removeMin(),null),e.fixUp()}remove(e,t){let n,r=this;if(t(e,r.key)<0)r.left.isEmpty()||r.left.isRed()||r.left.left.isRed()||(r=r.moveRedLeft()),r=r.copy(null,null,null,r.left.remove(e,t),null);else{if(r.left.isRed()&&(r=r.rotateRight()),r.right.isEmpty()||r.right.isRed()||r.right.left.isRed()||(r=r.moveRedRight()),0===t(e,r.key)){if(r.right.isEmpty())return nm.EMPTY;n=r.right.min(),r=r.copy(n.key,n.value,null,null,r.right.removeMin())}r=r.copy(null,null,null,null,r.right.remove(e,t))}return r.fixUp()}isRed(){return this.color}fixUp(){let e=this;return e.right.isRed()&&!e.left.isRed()&&(e=e.rotateLeft()),e.left.isRed()&&e.left.left.isRed()&&(e=e.rotateRight()),e.left.isRed()&&e.right.isRed()&&(e=e.colorFlip()),e}moveRedLeft(){let e=this.colorFlip();return e.right.left.isRed()&&(e=e.copy(null,null,null,null,e.right.rotateRight()),e=e.rotateLeft(),e=e.colorFlip()),e}moveRedRight(){let e=this.colorFlip();return e.left.left.isRed()&&(e=e.rotateRight(),e=e.colorFlip()),e}rotateLeft(){const e=this.copy(null,null,nm.RED,null,this.right.left);return this.right.copy(null,null,this.color,e,null)}rotateRight(){const e=this.copy(null,null,nm.RED,this.left.right,null);return this.left.copy(null,null,this.color,null,e)}colorFlip(){const e=this.left.copy(null,null,!this.left.color,null,null),t=this.right.copy(null,null,!this.right.color,null,null);return this.copy(null,null,!this.color,e,t)}checkMaxDepth(){const e=this.check();return Math.pow(2,e)<=this.size+1}check(){if(this.isRed()&&this.left.isRed())throw sp();if(this.right.isRed())throw sp();const e=this.left.check();if(e!==this.right.check())throw sp();return e+(this.isRed()?0:1)}}nm.EMPTY=null,nm.RED=!0,nm.BLACK=!1,nm.EMPTY=new class{constructor(){this.size=0}get key(){throw sp()}get value(){throw sp()}get color(){throw sp()}get left(){throw sp()}get right(){throw sp()}copy(e,t,n,r,i){return this}insert(e,t,n){return new nm(e,t)}remove(e,t){return this}isEmpty(){return!0}inorderTraversal(e){return!1}reverseTraversal(e){return!1}minKey(){return null}maxKey(){return null}isRed(){return!1}checkMaxDepth(){return!0}check(){return 0}};class rm{constructor(e){this.comparator=e,this.data=new em(this.comparator)}has(e){return null!==this.data.get(e)}first(){return this.data.minKey()}last(){return this.data.maxKey()}get size(){return this.data.size}indexOf(e){return this.data.indexOf(e)}forEach(e){this.data.inorderTraversal((t,n)=>(e(t),!1))}forEachInRange(e,t){const n=this.data.getIteratorFrom(e[0]);for(;n.hasNext();){const r=n.getNext();if(this.comparator(r.key,e[1])>=0)return;t(r.key)}}forEachWhile(e,t){let n;for(n=void 0!==t?this.data.getIteratorFrom(t):this.data.getIterator();n.hasNext();)if(!e(n.getNext().key))return}firstAfterOrEqual(e){const t=this.data.getIteratorFrom(e);return t.hasNext()?t.getNext().key:null}getIterator(){return new im(this.data.getIterator())}getIteratorFrom(e){return new im(this.data.getIteratorFrom(e))}add(e){return this.copy(this.data.remove(e).insert(e,!0))}delete(e){return this.has(e)?this.copy(this.data.remove(e)):this}isEmpty(){return this.data.isEmpty()}unionWith(e){let t=this;return t.size<e.size&&(t=e,e=this),e.forEach(e=>{t=t.add(e)}),t}isEqual(e){if(!(e instanceof rm))return!1;if(this.size!==e.size)return!1;const t=this.data.getIterator(),n=e.data.getIterator();for(;t.hasNext();){const e=t.getNext().key,r=n.getNext().key;if(0!==this.comparator(e,r))return!1}return!0}toArray(){const e=[];return this.forEach(t=>{e.push(t)}),e}toString(){const e=[];return this.forEach(t=>e.push(t)),"SortedSet("+e.toString()+")"}copy(e){const t=new rm(this.comparator);return t.data=e,t}}class im{constructor(e){this.iter=e}getNext(){return this.iter.getNext().key}hasNext(){return this.iter.hasNext()}}class am{constructor(e){this.fields=e,e.sort(Op.comparator)}static empty(){return new am([])}unionWith(e){let t=new rm(Op.comparator);for(const n of this.fields)t=t.add(n);for(const n of e)t=t.add(n);return new am(t.toArray())}covers(e){for(const t of this.fields)if(t.isPrefixOf(e))return!0;return!1}isEqual(e){return Sp(this.fields,e.fields,(e,t)=>e.isEqual(t))}}class om extends Error{constructor(){super(...arguments),this.name="Base64DecodeError"}}class sm{constructor(e){this.binaryString=e}static fromBase64String(e){const t=function(e){try{return atob(e)}catch(e){throw"undefined"!=typeof DOMException&&e instanceof DOMException?new om("Invalid base64 string: "+e):e}}(e);return new sm(t)}static fromUint8Array(e){const t=function(e){let t="";for(let n=0;n<e.length;++n)t+=String.fromCharCode(e[n]);return t}(e);return new sm(t)}[Symbol.iterator](){let e=0;return{next:()=>e<this.binaryString.length?{value:this.binaryString.charCodeAt(e++),done:!1}:{value:void 0,done:!0}}}toBase64(){return function(e){return btoa(e)}(this.binaryString)}toUint8Array(){return function(e){const t=new Uint8Array(e.length);for(let n=0;n<e.length;n++)t[n]=e.charCodeAt(n);return t}(this.binaryString)}approximateByteSize(){return 2*this.binaryString.length}compareTo(e){return Ep(this.binaryString,e.binaryString)}isEqual(e){return this.binaryString===e.binaryString}}sm.EMPTY_BYTE_STRING=new sm("");const cm=new RegExp(/^\d{4}-\d\d-\d\dT\d\d:\d\d:\d\d(?:\.(\d+))?Z$/);function lm(e){if(cp(!!e),"string"==typeof e){let t=0;const n=cm.exec(e);if(cp(!!n),n[1]){let e=n[1];e=(e+"000000000").substr(0,9),t=Number(e)}const r=new Date(e);return{seconds:Math.floor(r.getTime()/1e3),nanos:t}}return{seconds:um(e.seconds),nanos:um(e.nanos)}}function um(e){return"number"==typeof e?e:"string"==typeof e?Number(e):0}function dm(e){return"string"==typeof e?sm.fromBase64String(e):sm.fromUint8Array(e)}function hm(e){var t,n;return"server_timestamp"===(null===(n=((null===(t=null==e?void 0:e.mapValue)||void 0===t?void 0:t.fields)||{}).__type__)||void 0===n?void 0:n.stringValue)}function fm(e){const t=e.mapValue.fields.__previous_value__;return hm(t)?fm(t):t}function pm(e){const t=lm(e.mapValue.fields.__local_write_time__.timestampValue);return new kp(t.seconds,t.nanos)}class mm{constructor(e,t,n,r,i,a,o,s,c){this.databaseId=e,this.appId=t,this.persistenceKey=n,this.host=r,this.ssl=i,this.forceLongPolling=a,this.autoDetectLongPolling=o,this.longPollingOptions=s,this.useFetchStreams=c}}class gm{constructor(e,t){this.projectId=e,this.database=t||"(default)"}static empty(){return new gm("","")}get isDefaultDatabase(){return"(default)"===this.database}isEqual(e){return e instanceof gm&&e.projectId===this.projectId&&e.database===this.database}}const ym={mapValue:{fields:{__type__:{stringValue:"__max__"}}}};function vm(e){return"nullValue"in e?0:"booleanValue"in e?1:"integerValue"in e||"doubleValue"in e?2:"timestampValue"in e?3:"stringValue"in e?5:"bytesValue"in e?6:"referenceValue"in e?7:"geoPointValue"in e?8:"arrayValue"in e?9:"mapValue"in e?hm(e)?4:Nm(e)?9007199254740991:Am(e)?10:11:sp()}function wm(e,t){if(e===t)return!0;const n=vm(e);if(n!==vm(t))return!1;switch(n){case 0:case 9007199254740991:return!0;case 1:return e.booleanValue===t.booleanValue;case 4:return pm(e).isEqual(pm(t));case 3:return function(e,t){if("string"==typeof e.timestampValue&&"string"==typeof t.timestampValue&&e.timestampValue.length===t.timestampValue.length)return e.timestampValue===t.timestampValue;const n=lm(e.timestampValue),r=lm(t.timestampValue);return n.seconds===r.seconds&&n.nanos===r.nanos}(e,t);case 5:return e.stringValue===t.stringValue;case 6:return function(e,t){return dm(e.bytesValue).isEqual(dm(t.bytesValue))}(e,t);case 7:return e.referenceValue===t.referenceValue;case 8:return function(e,t){return um(e.geoPointValue.latitude)===um(t.geoPointValue.latitude)&&um(e.geoPointValue.longitude)===um(t.geoPointValue.longitude)}(e,t);case 2:return function(e,t){if("integerValue"in e&&"integerValue"in t)return um(e.integerValue)===um(t.integerValue);if("doubleValue"in e&&"doubleValue"in t){const n=um(e.doubleValue),r=um(t.doubleValue);return n===r?Wp(n)===Wp(r):isNaN(n)&&isNaN(r)}return!1}(e,t);case 9:return Sp(e.arrayValue.values||[],t.arrayValue.values||[],wm);case 10:case 11:return function(e,t){const n=e.mapValue.fields||{},r=t.mapValue.fields||{};if(Jp(n)!==Jp(r))return!1;for(const i in n)if(n.hasOwnProperty(i)&&(void 0===r[i]||!wm(n[i],r[i])))return!1;return!0}(e,t);default:return sp()}}function bm(e,t){return void 0!==(e.values||[]).find(e=>wm(e,t))}function _m(e,t){if(e===t)return 0;const n=vm(e),r=vm(t);if(n!==r)return Ep(n,r);switch(n){case 0:case 9007199254740991:return 0;case 1:return Ep(e.booleanValue,t.booleanValue);case 2:return function(e,t){const n=um(e.integerValue||e.doubleValue),r=um(t.integerValue||t.doubleValue);return n<r?-1:n>r?1:n===r?0:isNaN(n)?isNaN(r)?0:-1:1}(e,t);case 3:return xm(e.timestampValue,t.timestampValue);case 4:return xm(pm(e),pm(t));case 5:return Ep(e.stringValue,t.stringValue);case 6:return function(e,t){const n=dm(e),r=dm(t);return n.compareTo(r)}(e.bytesValue,t.bytesValue);case 7:return function(e,t){const n=e.split("/"),r=t.split("/");for(let i=0;i<n.length&&i<r.length;i++){const e=Ep(n[i],r[i]);if(0!==e)return e}return Ep(n.length,r.length)}(e.referenceValue,t.referenceValue);case 8:return function(e,t){const n=Ep(um(e.latitude),um(t.latitude));return 0!==n?n:Ep(um(e.longitude),um(t.longitude))}(e.geoPointValue,t.geoPointValue);case 9:return Em(e.arrayValue,t.arrayValue);case 10:return function(e,t){var n,r,i,a;const o=e.fields||{},s=t.fields||{},c=null===(n=o.value)||void 0===n?void 0:n.arrayValue,l=null===(r=s.value)||void 0===r?void 0:r.arrayValue,u=Ep((null===(i=null==c?void 0:c.values)||void 0===i?void 0:i.length)||0,(null===(a=null==l?void 0:l.values)||void 0===a?void 0:a.length)||0);return 0!==u?u:Em(c,l)}(e.mapValue,t.mapValue);case 11:return function(e,t){if(e===ym.mapValue&&t===ym.mapValue)return 0;if(e===ym.mapValue)return 1;if(t===ym.mapValue)return-1;const n=e.fields||{},r=Object.keys(n),i=t.fields||{},a=Object.keys(i);r.sort(),a.sort();for(let o=0;o<r.length&&o<a.length;++o){const e=Ep(r[o],a[o]);if(0!==e)return e;const t=_m(n[r[o]],i[a[o]]);if(0!==t)return t}return Ep(r.length,a.length)}(e.mapValue,t.mapValue);default:throw sp()}}function xm(e,t){if("string"==typeof e&&"string"==typeof t&&e.length===t.length)return Ep(e,t);const n=lm(e),r=lm(t),i=Ep(n.seconds,r.seconds);return 0!==i?i:Ep(n.nanos,r.nanos)}function Em(e,t){const n=e.values||[],r=t.values||[];for(let i=0;i<n.length&&i<r.length;++i){const e=_m(n[i],r[i]);if(e)return e}return Ep(n.length,r.length)}function Sm(e){return km(e)}function km(e){return"nullValue"in e?"null":"booleanValue"in e?""+e.booleanValue:"integerValue"in e?""+e.integerValue:"doubleValue"in e?""+e.doubleValue:"timestampValue"in e?function(e){const t=lm(e);return"time(".concat(t.seconds,",").concat(t.nanos,")")}(e.timestampValue):"stringValue"in e?e.stringValue:"bytesValue"in e?function(e){return dm(e).toBase64()}(e.bytesValue):"referenceValue"in e?function(e){return Np.fromName(e).toString()}(e.referenceValue):"geoPointValue"in e?function(e){return"geo(".concat(e.latitude,",").concat(e.longitude,")")}(e.geoPointValue):"arrayValue"in e?function(e){let t="[",n=!0;for(const r of e.values||[])n?n=!1:t+=",",t+=km(r);return t+"]"}(e.arrayValue):"mapValue"in e?function(e){const t=Object.keys(e.fields||{}).sort();let n="{",r=!0;for(const i of t)r?r=!1:n+=",",n+="".concat(i,":").concat(km(e.fields[i]));return n+"}"}(e.mapValue):sp()}function Tm(e){return!!e&&"integerValue"in e}function Im(e){return!!e&&"arrayValue"in e}function Cm(e){return!!e&&"mapValue"in e}function Am(e){var t,n;return"__vector__"===(null===(n=((null===(t=null==e?void 0:e.mapValue)||void 0===t?void 0:t.fields)||{}).__type__)||void 0===n?void 0:n.stringValue)}function Om(e){if(e.geoPointValue)return{geoPointValue:Object.assign({},e.geoPointValue)};if(e.timestampValue&&"object"==typeof e.timestampValue)return{timestampValue:Object.assign({},e.timestampValue)};if(e.mapValue){const t={mapValue:{fields:{}}};return $p(e.mapValue.fields,(e,n)=>t.mapValue.fields[e]=Om(n)),t}if(e.arrayValue){const t={arrayValue:{values:[]}};for(let n=0;n<(e.arrayValue.values||[]).length;++n)t.arrayValue.values[n]=Om(e.arrayValue.values[n]);return t}return Object.assign({},e)}function Nm(e){return"__max__"===(((e.mapValue||{}).fields||{}).__type__||{}).stringValue}class Rm{constructor(e){this.value=e}static empty(){return new Rm({mapValue:{}})}field(e){if(e.isEmpty())return this.value;{let t=this.value;for(let n=0;n<e.length-1;++n)if(t=(t.mapValue.fields||{})[e.get(n)],!Cm(t))return null;return t=(t.mapValue.fields||{})[e.lastSegment()],t||null}}set(e,t){this.getFieldsMap(e.popLast())[e.lastSegment()]=Om(t)}setAll(e){let t=Op.emptyPath(),n={},r=[];e.forEach((e,i)=>{if(!t.isImmediateParentOf(i)){const e=this.getFieldsMap(t);this.applyChanges(e,n,r),n={},r=[],t=i.popLast()}e?n[i.lastSegment()]=Om(e):r.push(i.lastSegment())});const i=this.getFieldsMap(t);this.applyChanges(i,n,r)}delete(e){const t=this.field(e.popLast());Cm(t)&&t.mapValue.fields&&delete t.mapValue.fields[e.lastSegment()]}isEqual(e){return wm(this.value,e.value)}getFieldsMap(e){let t=this.value;t.mapValue.fields||(t.mapValue={fields:{}});for(let n=0;n<e.length;++n){let r=t.mapValue.fields[e.get(n)];Cm(r)&&r.mapValue.fields||(r={mapValue:{fields:{}}},t.mapValue.fields[e.get(n)]=r),t=r}return t.mapValue.fields}applyChanges(e,t,n){$p(t,(t,n)=>e[t]=n);for(const r of n)delete e[r]}clone(){return new Rm(Om(this.value))}}function Pm(e){const t=[];return $p(e.fields,(e,n)=>{const r=new Op([e]);if(Cm(n)){const e=Pm(n.mapValue).fields;if(0===e.length)t.push(r);else for(const n of e)t.push(r.child(n))}else t.push(r)}),new am(t)}class Dm{constructor(e,t,n,r,i,a,o){this.key=e,this.documentType=t,this.version=n,this.readTime=r,this.createTime=i,this.data=a,this.documentState=o}static newInvalidDocument(e){return new Dm(e,0,Tp.min(),Tp.min(),Tp.min(),Rm.empty(),0)}static newFoundDocument(e,t,n,r){return new Dm(e,1,t,Tp.min(),n,r,0)}static newNoDocument(e,t){return new Dm(e,2,t,Tp.min(),Tp.min(),Rm.empty(),0)}static newUnknownDocument(e,t){return new Dm(e,3,t,Tp.min(),Tp.min(),Rm.empty(),2)}convertToFoundDocument(e,t){return!this.createTime.isEqual(Tp.min())||2!==this.documentType&&0!==this.documentType||(this.createTime=e),this.version=e,this.documentType=1,this.data=t,this.documentState=0,this}convertToNoDocument(e){return this.version=e,this.documentType=2,this.data=Rm.empty(),this.documentState=0,this}convertToUnknownDocument(e){return this.version=e,this.documentType=3,this.data=Rm.empty(),this.documentState=2,this}setHasCommittedMutations(){return this.documentState=2,this}setHasLocalMutations(){return this.documentState=1,this.version=Tp.min(),this}setReadTime(e){return this.readTime=e,this}get hasLocalMutations(){return 1===this.documentState}get hasCommittedMutations(){return 2===this.documentState}get hasPendingWrites(){return this.hasLocalMutations||this.hasCommittedMutations}isValidDocument(){return 0!==this.documentType}isFoundDocument(){return 1===this.documentType}isNoDocument(){return 2===this.documentType}isUnknownDocument(){return 3===this.documentType}isEqual(e){return e instanceof Dm&&this.key.isEqual(e.key)&&this.version.isEqual(e.version)&&this.documentType===e.documentType&&this.documentState===e.documentState&&this.data.isEqual(e.data)}mutableCopy(){return new Dm(this.key,this.documentType,this.version,this.readTime,this.createTime,this.data.clone(),this.documentState)}toString(){return"Document(".concat(this.key,", ").concat(this.version,", ").concat(JSON.stringify(this.data.value),", {createTime: ").concat(this.createTime,"}), {documentType: ").concat(this.documentType,"}), {documentState: ").concat(this.documentState,"})")}}class zm{constructor(e,t){this.position=e,this.inclusive=t}}function Mm(e,t,n){let r=0;for(let i=0;i<e.position.length;i++){const a=t[i],o=e.position[i];if(r=a.field.isKeyField()?Np.comparator(Np.fromName(o.referenceValue),n.key):_m(o,n.data.field(a.field)),"desc"===a.dir&&(r*=-1),0!==r)break}return r}function Lm(e,t){if(null===e)return null===t;if(null===t)return!1;if(e.inclusive!==t.inclusive||e.position.length!==t.position.length)return!1;for(let n=0;n<e.position.length;n++)if(!wm(e.position[n],t.position[n]))return!1;return!0}class Um{constructor(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"asc";this.field=e,this.dir=t}}function Bm(e,t){return e.dir===t.dir&&e.field.isEqual(t.field)}class Fm{}class jm extends Fm{constructor(e,t,n){super(),this.field=e,this.op=t,this.value=n}static create(e,t,n){return e.isKeyField()?"in"===t||"not-in"===t?this.createKeyFieldInFilter(e,t,n):new Xm(e,t,n):"array-contains"===t?new Zm(e,n):"in"===t?new eg(e,n):"not-in"===t?new tg(e,n):"array-contains-any"===t?new ng(e,n):new jm(e,t,n)}static createKeyFieldInFilter(e,t,n){return"in"===t?new Ym(e,n):new Jm(e,n)}matches(e){const t=e.data.field(this.field);return"!="===this.op?null!==t&&this.matchesComparison(_m(t,this.value)):null!==t&&vm(this.value)===vm(t)&&this.matchesComparison(_m(t,this.value))}matchesComparison(e){switch(this.op){case"<":return e<0;case"<=":return e<=0;case"==":return 0===e;case"!=":return 0!==e;case">":return e>0;case">=":return e>=0;default:return sp()}}isInequality(){return["<","<=",">",">=","!=","not-in"].indexOf(this.op)>=0}getFlattenedFilters(){return[this]}getFilters(){return[this]}}class Vm extends Fm{constructor(e,t){super(),this.filters=e,this.op=t,this.ae=null}static create(e,t){return new Vm(e,t)}matches(e){return qm(this)?void 0===this.filters.find(t=>!t.matches(e)):void 0!==this.filters.find(t=>t.matches(e))}getFlattenedFilters(){return null!==this.ae||(this.ae=this.filters.reduce((e,t)=>e.concat(t.getFlattenedFilters()),[])),this.ae}getFilters(){return Object.assign([],this.filters)}}function qm(e){return"and"===e.op}function Hm(e){return Wm(e)&&qm(e)}function Wm(e){for(const t of e.filters)if(t instanceof Vm)return!1;return!0}function Gm(e){if(e instanceof jm)return e.field.canonicalString()+e.op.toString()+Sm(e.value);if(Hm(e))return e.filters.map(e=>Gm(e)).join(",");{const t=e.filters.map(e=>Gm(e)).join(",");return"".concat(e.op,"(").concat(t,")")}}function Km(e,t){return e instanceof jm?function(e,t){return t instanceof jm&&e.op===t.op&&e.field.isEqual(t.field)&&wm(e.value,t.value)}(e,t):e instanceof Vm?function(e,t){return t instanceof Vm&&e.op===t.op&&e.filters.length===t.filters.length&&e.filters.reduce((e,n,r)=>e&&Km(n,t.filters[r]),!0)}(e,t):void sp()}function Qm(e){return e instanceof jm?function(e){return"".concat(e.field.canonicalString()," ").concat(e.op," ").concat(Sm(e.value))}(e):e instanceof Vm?function(e){return e.op.toString()+" {"+e.getFilters().map(Qm).join(" ,")+"}"}(e):"Filter"}class Xm extends jm{constructor(e,t,n){super(e,t,n),this.key=Np.fromName(n.referenceValue)}matches(e){const t=Np.comparator(e.key,this.key);return this.matchesComparison(t)}}class Ym extends jm{constructor(e,t){super(e,"in",t),this.keys=$m("in",t)}matches(e){return this.keys.some(t=>t.isEqual(e.key))}}class Jm extends jm{constructor(e,t){super(e,"not-in",t),this.keys=$m("not-in",t)}matches(e){return!this.keys.some(t=>t.isEqual(e.key))}}function $m(e,t){var n;return((null===(n=t.arrayValue)||void 0===n?void 0:n.values)||[]).map(e=>Np.fromName(e.referenceValue))}class Zm extends jm{constructor(e,t){super(e,"array-contains",t)}matches(e){const t=e.data.field(this.field);return Im(t)&&bm(t.arrayValue,this.value)}}class eg extends jm{constructor(e,t){super(e,"in",t)}matches(e){const t=e.data.field(this.field);return null!==t&&bm(this.value.arrayValue,t)}}class tg extends jm{constructor(e,t){super(e,"not-in",t)}matches(e){if(bm(this.value.arrayValue,{nullValue:"NULL_VALUE"}))return!1;const t=e.data.field(this.field);return null!==t&&!bm(this.value.arrayValue,t)}}class ng extends jm{constructor(e,t){super(e,"array-contains-any",t)}matches(e){const t=e.data.field(this.field);return!(!Im(t)||!t.arrayValue.values)&&t.arrayValue.values.some(e=>bm(this.value.arrayValue,e))}}class rg{constructor(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:[],r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:[],i=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null,a=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,o=arguments.length>6&&void 0!==arguments[6]?arguments[6]:null;this.path=e,this.collectionGroup=t,this.orderBy=n,this.filters=r,this.limit=i,this.startAt=a,this.endAt=o,this.ue=null}}function ig(e){return new rg(e,arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,arguments.length>2&&void 0!==arguments[2]?arguments[2]:[],arguments.length>3&&void 0!==arguments[3]?arguments[3]:[],arguments.length>4&&void 0!==arguments[4]?arguments[4]:null,arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,arguments.length>6&&void 0!==arguments[6]?arguments[6]:null)}function ag(e){const t=lp(e);if(null===t.ue){let e=t.path.canonicalString();null!==t.collectionGroup&&(e+="|cg:"+t.collectionGroup),e+="|f:",e+=t.filters.map(e=>Gm(e)).join(","),e+="|ob:",e+=t.orderBy.map(e=>function(e){return e.field.canonicalString()+e.dir}(e)).join(","),Hp(t.limit)||(e+="|l:",e+=t.limit),t.startAt&&(e+="|lb:",e+=t.startAt.inclusive?"b:":"a:",e+=t.startAt.position.map(e=>Sm(e)).join(",")),t.endAt&&(e+="|ub:",e+=t.endAt.inclusive?"a:":"b:",e+=t.endAt.position.map(e=>Sm(e)).join(",")),t.ue=e}return t.ue}function og(e,t){if(e.limit!==t.limit)return!1;if(e.orderBy.length!==t.orderBy.length)return!1;for(let n=0;n<e.orderBy.length;n++)if(!Bm(e.orderBy[n],t.orderBy[n]))return!1;if(e.filters.length!==t.filters.length)return!1;for(let n=0;n<e.filters.length;n++)if(!Km(e.filters[n],t.filters[n]))return!1;return e.collectionGroup===t.collectionGroup&&!!e.path.isEqual(t.path)&&!!Lm(e.startAt,t.startAt)&&Lm(e.endAt,t.endAt)}class sg{constructor(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:[],r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:[],i=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null,a=arguments.length>5&&void 0!==arguments[5]?arguments[5]:"F",o=arguments.length>6&&void 0!==arguments[6]?arguments[6]:null,s=arguments.length>7&&void 0!==arguments[7]?arguments[7]:null;this.path=e,this.collectionGroup=t,this.explicitOrderBy=n,this.filters=r,this.limit=i,this.limitType=a,this.startAt=o,this.endAt=s,this.ce=null,this.le=null,this.he=null,this.startAt,this.endAt}}function cg(e,t,n,r,i,a,o,s){return new sg(e,t,n,r,i,a,o,s)}function lg(e){return new sg(e)}function ug(e){return 0===e.filters.length&&null===e.limit&&null==e.startAt&&null==e.endAt&&(0===e.explicitOrderBy.length||1===e.explicitOrderBy.length&&e.explicitOrderBy[0].field.isKeyField())}function dg(e){return null!==e.collectionGroup}function hg(e){const t=lp(e);if(null===t.ce){t.ce=[];const e=new Set;for(const i of t.explicitOrderBy)t.ce.push(i),e.add(i.field.canonicalString());const n=t.explicitOrderBy.length>0?t.explicitOrderBy[t.explicitOrderBy.length-1].dir:"asc",r=function(e){let t=new rm(Op.comparator);return e.filters.forEach(e=>{e.getFlattenedFilters().forEach(e=>{e.isInequality()&&(t=t.add(e.field))})}),t}(t);r.forEach(r=>{e.has(r.canonicalString())||r.isKeyField()||t.ce.push(new Um(r,n))}),e.has(Op.keyField().canonicalString())||t.ce.push(new Um(Op.keyField(),n))}return t.ce}function fg(e){const t=lp(e);return t.le||(t.le=pg(t,hg(e))),t.le}function pg(e,t){if("F"===e.limitType)return ig(e.path,e.collectionGroup,t,e.filters,e.limit,e.startAt,e.endAt);{t=t.map(e=>{const t="desc"===e.dir?"asc":"desc";return new Um(e.field,t)});const n=e.endAt?new zm(e.endAt.position,e.endAt.inclusive):null,r=e.startAt?new zm(e.startAt.position,e.startAt.inclusive):null;return ig(e.path,e.collectionGroup,t,e.filters,e.limit,n,r)}}function mg(e,t,n){return new sg(e.path,e.collectionGroup,e.explicitOrderBy.slice(),e.filters.slice(),t,n,e.startAt,e.endAt)}function gg(e,t){return og(fg(e),fg(t))&&e.limitType===t.limitType}function yg(e){return"".concat(ag(fg(e)),"|lt:").concat(e.limitType)}function vg(e){return"Query(target=".concat(function(e){let t=e.path.canonicalString();return null!==e.collectionGroup&&(t+=" collectionGroup="+e.collectionGroup),e.filters.length>0&&(t+=", filters: [".concat(e.filters.map(e=>Qm(e)).join(", "),"]")),Hp(e.limit)||(t+=", limit: "+e.limit),e.orderBy.length>0&&(t+=", orderBy: [".concat(e.orderBy.map(e=>function(e){return"".concat(e.field.canonicalString()," (").concat(e.dir,")")}(e)).join(", "),"]")),e.startAt&&(t+=", startAt: ",t+=e.startAt.inclusive?"b:":"a:",t+=e.startAt.position.map(e=>Sm(e)).join(",")),e.endAt&&(t+=", endAt: ",t+=e.endAt.inclusive?"a:":"b:",t+=e.endAt.position.map(e=>Sm(e)).join(",")),"Target(".concat(t,")")}(fg(e)),"; limitType=").concat(e.limitType,")")}function wg(e,t){return t.isFoundDocument()&&function(e,t){const n=t.key.path;return null!==e.collectionGroup?t.key.hasCollectionId(e.collectionGroup)&&e.path.isPrefixOf(n):Np.isDocumentKey(e.path)?e.path.isEqual(n):e.path.isImmediateParentOf(n)}(e,t)&&function(e,t){for(const n of hg(e))if(!n.field.isKeyField()&&null===t.data.field(n.field))return!1;return!0}(e,t)&&function(e,t){for(const n of e.filters)if(!n.matches(t))return!1;return!0}(e,t)&&function(e,t){return!(e.startAt&&!function(e,t,n){const r=Mm(e,t,n);return e.inclusive?r<=0:r<0}(e.startAt,hg(e),t))&&!(e.endAt&&!function(e,t,n){const r=Mm(e,t,n);return e.inclusive?r>=0:r>0}(e.endAt,hg(e),t))}(e,t)}function bg(e){return(t,n)=>{let r=!1;for(const i of hg(e)){const e=_g(i,t,n);if(0!==e)return e;r=r||i.field.isKeyField()}return 0}}function _g(e,t,n){const r=e.field.isKeyField()?Np.comparator(t.key,n.key):function(e,t,n){const r=t.data.field(e),i=n.data.field(e);return null!==r&&null!==i?_m(r,i):sp()}(e.field,t,n);switch(e.dir){case"asc":return r;case"desc":return-1*r;default:return sp()}}class xg{constructor(e,t){this.mapKeyFn=e,this.equalsFn=t,this.inner={},this.innerSize=0}get(e){const t=this.mapKeyFn(e),n=this.inner[t];if(void 0!==n)for(const[r,i]of n)if(this.equalsFn(r,e))return i}has(e){return void 0!==this.get(e)}set(e,t){const n=this.mapKeyFn(e),r=this.inner[n];if(void 0===r)return this.inner[n]=[[e,t]],void this.innerSize++;for(let i=0;i<r.length;i++)if(this.equalsFn(r[i][0],e))return void(r[i]=[e,t]);r.push([e,t]),this.innerSize++}delete(e){const t=this.mapKeyFn(e),n=this.inner[t];if(void 0===n)return!1;for(let r=0;r<n.length;r++)if(this.equalsFn(n[r][0],e))return 1===n.length?delete this.inner[t]:n.splice(r,1),this.innerSize--,!0;return!1}forEach(e){$p(this.inner,(t,n)=>{for(const[r,i]of n)e(r,i)})}isEmpty(){return Zp(this.inner)}size(){return this.innerSize}}const Eg=new em(Np.comparator);function Sg(){return Eg}const kg=new em(Np.comparator);function Tg(){let e=kg;for(var t=arguments.length,n=new Array(t),r=0;r<t;r++)n[r]=arguments[r];for(const i of n)e=e.insert(i.key,i);return e}function Ig(e){let t=kg;return e.forEach((e,n)=>t=t.insert(e,n.overlayedDocument)),t}function Cg(){return Og()}function Ag(){return Og()}function Og(){return new xg(e=>e.toString(),(e,t)=>e.isEqual(t))}const Ng=new em(Np.comparator),Rg=new rm(Np.comparator);function Pg(){let e=Rg;for(var t=arguments.length,n=new Array(t),r=0;r<t;r++)n[r]=arguments[r];for(const i of n)e=e.add(i);return e}const Dg=new rm(Ep);function zg(){return Dg}function Mg(e,t){if(e.useProto3Json){if(isNaN(t))return{doubleValue:"NaN"};if(t===1/0)return{doubleValue:"Infinity"};if(t===-1/0)return{doubleValue:"-Infinity"}}return{doubleValue:Wp(t)?"-0":t}}function Lg(e){return{integerValue:""+e}}function Ug(e,t){return Gp(t)?Lg(t):Mg(e,t)}class Bg{constructor(){this._=void 0}}function Fg(e,t,n){return e instanceof qg?function(e,t){const n={fields:{__type__:{stringValue:"server_timestamp"},__local_write_time__:{timestampValue:{seconds:e.seconds,nanos:e.nanoseconds}}}};return t&&hm(t)&&(t=fm(t)),t&&(n.fields.__previous_value__=t),{mapValue:n}}(n,t):e instanceof Hg?Wg(e,t):e instanceof Gg?Kg(e,t):function(e,t){const n=Vg(e,t),r=Xg(n)+Xg(e.Pe);return Tm(n)&&Tm(e.Pe)?Lg(r):Mg(e.serializer,r)}(e,t)}function jg(e,t,n){return e instanceof Hg?Wg(e,t):e instanceof Gg?Kg(e,t):n}function Vg(e,t){return e instanceof Qg?function(e){return Tm(e)||function(e){return!!e&&"doubleValue"in e}(e)}(t)?t:{integerValue:0}:null}class qg extends Bg{}class Hg extends Bg{constructor(e){super(),this.elements=e}}function Wg(e,t){const n=Yg(t);for(const r of e.elements)n.some(e=>wm(e,r))||n.push(r);return{arrayValue:{values:n}}}class Gg extends Bg{constructor(e){super(),this.elements=e}}function Kg(e,t){let n=Yg(t);for(const r of e.elements)n=n.filter(e=>!wm(e,r));return{arrayValue:{values:n}}}class Qg extends Bg{constructor(e,t){super(),this.serializer=e,this.Pe=t}}function Xg(e){return um(e.integerValue||e.doubleValue)}function Yg(e){return Im(e)&&e.arrayValue.values?e.arrayValue.values.slice():[]}class Jg{constructor(e,t){this.version=e,this.transformResults=t}}class $g{constructor(e,t){this.updateTime=e,this.exists=t}static none(){return new $g}static exists(e){return new $g(void 0,e)}static updateTime(e){return new $g(e)}get isNone(){return void 0===this.updateTime&&void 0===this.exists}isEqual(e){return this.exists===e.exists&&(this.updateTime?!!e.updateTime&&this.updateTime.isEqual(e.updateTime):!e.updateTime)}}function Zg(e,t){return void 0!==e.updateTime?t.isFoundDocument()&&t.version.isEqual(e.updateTime):void 0===e.exists||e.exists===t.isFoundDocument()}class ey{}function ty(e,t){if(!e.hasLocalMutations||t&&0===t.fields.length)return null;if(null===t)return e.isNoDocument()?new dy(e.key,$g.none()):new oy(e.key,e.data,$g.none());{const n=e.data,r=Rm.empty();let i=new rm(Op.comparator);for(let e of t.fields)if(!i.has(e)){let t=n.field(e);null===t&&e.length>1&&(e=e.popLast(),t=n.field(e)),null===t?r.delete(e):r.set(e,t),i=i.add(e)}return new sy(e.key,r,new am(i.toArray()),$g.none())}}function ny(e,t,n){e instanceof oy?function(e,t,n){const r=e.value.clone(),i=ly(e.fieldTransforms,t,n.transformResults);r.setAll(i),t.convertToFoundDocument(n.version,r).setHasCommittedMutations()}(e,t,n):e instanceof sy?function(e,t,n){if(!Zg(e.precondition,t))return void t.convertToUnknownDocument(n.version);const r=ly(e.fieldTransforms,t,n.transformResults),i=t.data;i.setAll(cy(e)),i.setAll(r),t.convertToFoundDocument(n.version,i).setHasCommittedMutations()}(e,t,n):function(e,t,n){t.convertToNoDocument(n.version).setHasCommittedMutations()}(0,t,n)}function ry(e,t,n,r){return e instanceof oy?function(e,t,n,r){if(!Zg(e.precondition,t))return n;const i=e.value.clone(),a=uy(e.fieldTransforms,r,t);return i.setAll(a),t.convertToFoundDocument(t.version,i).setHasLocalMutations(),null}(e,t,n,r):e instanceof sy?function(e,t,n,r){if(!Zg(e.precondition,t))return n;const i=uy(e.fieldTransforms,r,t),a=t.data;return a.setAll(cy(e)),a.setAll(i),t.convertToFoundDocument(t.version,a).setHasLocalMutations(),null===n?null:n.unionWith(e.fieldMask.fields).unionWith(e.fieldTransforms.map(e=>e.field))}(e,t,n,r):function(e,t,n){return Zg(e.precondition,t)?(t.convertToNoDocument(t.version).setHasLocalMutations(),null):n}(e,t,n)}function iy(e,t){let n=null;for(const r of e.fieldTransforms){const e=t.data.field(r.field),i=Vg(r.transform,e||null);null!=i&&(null===n&&(n=Rm.empty()),n.set(r.field,i))}return n||null}function ay(e,t){return e.type===t.type&&!!e.key.isEqual(t.key)&&!!e.precondition.isEqual(t.precondition)&&!!function(e,t){return void 0===e&&void 0===t||!(!e||!t)&&Sp(e,t,(e,t)=>function(e,t){return e.field.isEqual(t.field)&&function(e,t){return e instanceof Hg&&t instanceof Hg||e instanceof Gg&&t instanceof Gg?Sp(e.elements,t.elements,wm):e instanceof Qg&&t instanceof Qg?wm(e.Pe,t.Pe):e instanceof qg&&t instanceof qg}(e.transform,t.transform)}(e,t))}(e.fieldTransforms,t.fieldTransforms)&&(0===e.type?e.value.isEqual(t.value):1!==e.type||e.data.isEqual(t.data)&&e.fieldMask.isEqual(t.fieldMask))}class oy extends ey{constructor(e,t,n){let r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:[];super(),this.key=e,this.value=t,this.precondition=n,this.fieldTransforms=r,this.type=0}getFieldMask(){return null}}class sy extends ey{constructor(e,t,n,r){let i=arguments.length>4&&void 0!==arguments[4]?arguments[4]:[];super(),this.key=e,this.data=t,this.fieldMask=n,this.precondition=r,this.fieldTransforms=i,this.type=1}getFieldMask(){return this.fieldMask}}function cy(e){const t=new Map;return e.fieldMask.fields.forEach(n=>{if(!n.isEmpty()){const r=e.data.field(n);t.set(n,r)}}),t}function ly(e,t,n){const r=new Map;cp(e.length===n.length);for(let i=0;i<n.length;i++){const a=e[i],o=a.transform,s=t.data.field(a.field);r.set(a.field,jg(o,s,n[i]))}return r}function uy(e,t,n){const r=new Map;for(const i of e){const e=i.transform,a=n.data.field(i.field);r.set(i.field,Fg(e,a,t))}return r}class dy extends ey{constructor(e,t){super(),this.key=e,this.precondition=t,this.type=2,this.fieldTransforms=[]}getFieldMask(){return null}}class hy extends ey{constructor(e,t){super(),this.key=e,this.precondition=t,this.type=3,this.fieldTransforms=[]}getFieldMask(){return null}}class fy{constructor(e,t,n,r){this.batchId=e,this.localWriteTime=t,this.baseMutations=n,this.mutations=r}applyToRemoteDocument(e,t){const n=t.mutationResults;for(let r=0;r<this.mutations.length;r++){const t=this.mutations[r];t.key.isEqual(e.key)&&ny(t,e,n[r])}}applyToLocalView(e,t){for(const n of this.baseMutations)n.key.isEqual(e.key)&&(t=ry(n,e,t,this.localWriteTime));for(const n of this.mutations)n.key.isEqual(e.key)&&(t=ry(n,e,t,this.localWriteTime));return t}applyToLocalDocumentSet(e,t){const n=Ag();return this.mutations.forEach(r=>{const i=e.get(r.key),a=i.overlayedDocument;let o=this.applyToLocalView(a,i.mutatedFields);o=t.has(r.key)?null:o;const s=ty(a,o);null!==s&&n.set(r.key,s),a.isValidDocument()||a.convertToNoDocument(Tp.min())}),n}keys(){return this.mutations.reduce((e,t)=>e.add(t.key),Pg())}isEqual(e){return this.batchId===e.batchId&&Sp(this.mutations,e.mutations,(e,t)=>ay(e,t))&&Sp(this.baseMutations,e.baseMutations,(e,t)=>ay(e,t))}}class py{constructor(e,t,n,r){this.batch=e,this.commitVersion=t,this.mutationResults=n,this.docVersions=r}static from(e,t,n){cp(e.mutations.length===n.length);let r=Ng;const i=e.mutations;for(let a=0;a<i.length;a++)r=r.insert(i[a].key,n[a].version);return new py(e,t,n,r)}}class my{constructor(e,t){this.largestBatchId=e,this.mutation=t}getKey(){return this.mutation.key}isEqual(e){return null!==e&&this.mutation===e.mutation}toString(){return"Overlay{\n      largestBatchId: ".concat(this.largestBatchId,",\n      mutation: ").concat(this.mutation.toString(),"\n    }")}}var gy,yy;function vy(e){switch(e){default:return sp();case up.CANCELLED:case up.UNKNOWN:case up.DEADLINE_EXCEEDED:case up.RESOURCE_EXHAUSTED:case up.INTERNAL:case up.UNAVAILABLE:case up.UNAUTHENTICATED:return!1;case up.INVALID_ARGUMENT:case up.NOT_FOUND:case up.ALREADY_EXISTS:case up.PERMISSION_DENIED:case up.FAILED_PRECONDITION:case up.ABORTED:case up.OUT_OF_RANGE:case up.UNIMPLEMENTED:case up.DATA_LOSS:return!0}}function wy(e){if(void 0===e)return ip("GRPC error has no .code"),up.UNKNOWN;switch(e){case gy.OK:return up.OK;case gy.CANCELLED:return up.CANCELLED;case gy.UNKNOWN:return up.UNKNOWN;case gy.DEADLINE_EXCEEDED:return up.DEADLINE_EXCEEDED;case gy.RESOURCE_EXHAUSTED:return up.RESOURCE_EXHAUSTED;case gy.INTERNAL:return up.INTERNAL;case gy.UNAVAILABLE:return up.UNAVAILABLE;case gy.UNAUTHENTICATED:return up.UNAUTHENTICATED;case gy.INVALID_ARGUMENT:return up.INVALID_ARGUMENT;case gy.NOT_FOUND:return up.NOT_FOUND;case gy.ALREADY_EXISTS:return up.ALREADY_EXISTS;case gy.PERMISSION_DENIED:return up.PERMISSION_DENIED;case gy.FAILED_PRECONDITION:return up.FAILED_PRECONDITION;case gy.ABORTED:return up.ABORTED;case gy.OUT_OF_RANGE:return up.OUT_OF_RANGE;case gy.UNIMPLEMENTED:return up.UNIMPLEMENTED;case gy.DATA_LOSS:return up.DATA_LOSS;default:return sp()}}(yy=gy||(gy={}))[yy.OK=0]="OK",yy[yy.CANCELLED=1]="CANCELLED",yy[yy.UNKNOWN=2]="UNKNOWN",yy[yy.INVALID_ARGUMENT=3]="INVALID_ARGUMENT",yy[yy.DEADLINE_EXCEEDED=4]="DEADLINE_EXCEEDED",yy[yy.NOT_FOUND=5]="NOT_FOUND",yy[yy.ALREADY_EXISTS=6]="ALREADY_EXISTS",yy[yy.PERMISSION_DENIED=7]="PERMISSION_DENIED",yy[yy.UNAUTHENTICATED=16]="UNAUTHENTICATED",yy[yy.RESOURCE_EXHAUSTED=8]="RESOURCE_EXHAUSTED",yy[yy.FAILED_PRECONDITION=9]="FAILED_PRECONDITION",yy[yy.ABORTED=10]="ABORTED",yy[yy.OUT_OF_RANGE=11]="OUT_OF_RANGE",yy[yy.UNIMPLEMENTED=12]="UNIMPLEMENTED",yy[yy.INTERNAL=13]="INTERNAL",yy[yy.UNAVAILABLE=14]="UNAVAILABLE",yy[yy.DATA_LOSS=15]="DATA_LOSS";new Bf([4294967295,4294967295],0);Error;class by{constructor(e,t){this.databaseId=e,this.useProto3Json=t}}function _y(e,t){return e.useProto3Json?"".concat(new Date(1e3*t.seconds).toISOString().replace(/\.\d*/,"").replace("Z",""),".").concat(("000000000"+t.nanoseconds).slice(-9),"Z"):{seconds:""+t.seconds,nanos:t.nanoseconds}}function xy(e,t){return e.useProto3Json?t.toBase64():t.toUint8Array()}function Ey(e,t){return _y(e,t.toTimestamp())}function Sy(e){return cp(!!e),Tp.fromTimestamp(function(e){const t=lm(e);return new kp(t.seconds,t.nanos)}(e))}function ky(e,t){return Ty(e,t).canonicalString()}function Ty(e,t){const n=function(e){return new Cp(["projects",e.projectId,"databases",e.database])}(e).child("documents");return void 0===t?n:n.child(t)}function Iy(e){const t=Cp.fromString(e);return cp(Uy(t)),t}function Cy(e,t){return ky(e.databaseId,t.path)}function Ay(e){const t=Iy(e);return 4===t.length?Cp.emptyPath():Ny(t)}function Oy(e){return new Cp(["projects",e.databaseId.projectId,"databases",e.databaseId.database]).canonicalString()}function Ny(e){return cp(e.length>4&&"documents"===e.get(4)),e.popFirst(5)}function Ry(e,t,n){return{name:Cy(e,t),fields:n.value.mapValue.fields}}function Py(e,t){let n;if(t instanceof oy)n={update:Ry(e,t.key,t.value)};else if(t instanceof dy)n={delete:Cy(e,t.key)};else if(t instanceof sy)n={update:Ry(e,t.key,t.data),updateMask:Ly(t.fieldMask)};else{if(!(t instanceof hy))return sp();n={verify:Cy(e,t.key)}}return t.fieldTransforms.length>0&&(n.updateTransforms=t.fieldTransforms.map(e=>function(e,t){const n=t.transform;if(n instanceof qg)return{fieldPath:t.field.canonicalString(),setToServerValue:"REQUEST_TIME"};if(n instanceof Hg)return{fieldPath:t.field.canonicalString(),appendMissingElements:{values:n.elements}};if(n instanceof Gg)return{fieldPath:t.field.canonicalString(),removeAllFromArray:{values:n.elements}};if(n instanceof Qg)return{fieldPath:t.field.canonicalString(),increment:n.Pe};throw sp()}(0,e))),t.precondition.isNone||(n.currentDocument=function(e,t){return void 0!==t.updateTime?{updateTime:Ey(e,t.updateTime)}:void 0!==t.exists?{exists:t.exists}:sp()}(e,t.precondition)),n}function Dy(e){let t=Ay(e.parent);const n=e.structuredQuery,r=n.from?n.from.length:0;let i=null;if(r>0){cp(1===r);const e=n.from[0];e.allDescendants?i=e.collectionId:t=t.child(e.collectionId)}let a=[];n.where&&(a=function(e){const t=zy(e);return t instanceof Vm&&Hm(t)?t.getFilters():[t]}(n.where));let o=[];n.orderBy&&(o=function(e){return e.map(e=>function(e){return new Um(My(e.field),function(e){switch(e){case"ASCENDING":return"asc";case"DESCENDING":return"desc";default:return}}(e.direction))}(e))}(n.orderBy));let s=null;n.limit&&(s=function(e){let t;return t="object"==typeof e?e.value:e,Hp(t)?null:t}(n.limit));let c=null;n.startAt&&(c=function(e){const t=!!e.before,n=e.values||[];return new zm(n,t)}(n.startAt));let l=null;return n.endAt&&(l=function(e){const t=!e.before,n=e.values||[];return new zm(n,t)}(n.endAt)),cg(t,i,o,a,s,"F",c,l)}function zy(e){return void 0!==e.unaryFilter?function(e){switch(e.unaryFilter.op){case"IS_NAN":const t=My(e.unaryFilter.field);return jm.create(t,"==",{doubleValue:NaN});case"IS_NULL":const n=My(e.unaryFilter.field);return jm.create(n,"==",{nullValue:"NULL_VALUE"});case"IS_NOT_NAN":const r=My(e.unaryFilter.field);return jm.create(r,"!=",{doubleValue:NaN});case"IS_NOT_NULL":const i=My(e.unaryFilter.field);return jm.create(i,"!=",{nullValue:"NULL_VALUE"});default:return sp()}}(e):void 0!==e.fieldFilter?function(e){return jm.create(My(e.fieldFilter.field),function(e){switch(e){case"EQUAL":return"==";case"NOT_EQUAL":return"!=";case"GREATER_THAN":return">";case"GREATER_THAN_OR_EQUAL":return">=";case"LESS_THAN":return"<";case"LESS_THAN_OR_EQUAL":return"<=";case"ARRAY_CONTAINS":return"array-contains";case"IN":return"in";case"NOT_IN":return"not-in";case"ARRAY_CONTAINS_ANY":return"array-contains-any";default:return sp()}}(e.fieldFilter.op),e.fieldFilter.value)}(e):void 0!==e.compositeFilter?function(e){return Vm.create(e.compositeFilter.filters.map(e=>zy(e)),function(e){switch(e){case"AND":return"and";case"OR":return"or";default:return sp()}}(e.compositeFilter.op))}(e):sp()}function My(e){return Op.fromServerFormat(e.fieldPath)}function Ly(e){const t=[];return e.fields.forEach(e=>t.push(e.canonicalString())),{fieldPaths:t}}function Uy(e){return e.length>=4&&"projects"===e.get(0)&&"databases"===e.get(2)}class By{constructor(e){this.ct=e}}function Fy(e){const t=Dy({parent:e.parent,structuredQuery:e.structuredQuery});return"LAST"===e.limitType?mg(t,t.limit,"L"):t}class jy{constructor(){}It(e,t){this.Tt(e,t),t.Et()}Tt(e,t){if("nullValue"in e)this.dt(t,5);else if("booleanValue"in e)this.dt(t,10),t.At(e.booleanValue?1:0);else if("integerValue"in e)this.dt(t,15),t.At(um(e.integerValue));else if("doubleValue"in e){const n=um(e.doubleValue);isNaN(n)?this.dt(t,13):(this.dt(t,15),Wp(n)?t.At(0):t.At(n))}else if("timestampValue"in e){let n=e.timestampValue;this.dt(t,20),"string"==typeof n&&(n=lm(n)),t.Rt("".concat(n.seconds||"")),t.At(n.nanos||0)}else if("stringValue"in e)this.Vt(e.stringValue,t),this.ft(t);else if("bytesValue"in e)this.dt(t,30),t.gt(dm(e.bytesValue)),this.ft(t);else if("referenceValue"in e)this.yt(e.referenceValue,t);else if("geoPointValue"in e){const n=e.geoPointValue;this.dt(t,45),t.At(n.latitude||0),t.At(n.longitude||0)}else"mapValue"in e?Nm(e)?this.dt(t,Number.MAX_SAFE_INTEGER):Am(e)?this.wt(e.mapValue,t):(this.St(e.mapValue,t),this.ft(t)):"arrayValue"in e?(this.bt(e.arrayValue,t),this.ft(t)):sp()}Vt(e,t){this.dt(t,25),this.Dt(e,t)}Dt(e,t){t.Rt(e)}St(e,t){const n=e.fields||{};this.dt(t,55);for(const r of Object.keys(n))this.Vt(r,t),this.Tt(n[r],t)}wt(e,t){var n,r;const i=e.fields||{};this.dt(t,53);const a="value",o=(null===(r=null===(n=i[a].arrayValue)||void 0===n?void 0:n.values)||void 0===r?void 0:r.length)||0;this.dt(t,15),t.At(um(o)),this.Vt(a,t),this.Tt(i[a],t)}bt(e,t){const n=e.values||[];this.dt(t,50);for(const r of n)this.Tt(r,t)}yt(e,t){this.dt(t,37),Np.fromName(e).path.forEach(e=>{this.dt(t,60),this.Dt(e,t)})}dt(e,t){e.At(t)}ft(e){e.At(2)}}jy.vt=new jy;class Vy{constructor(){this.un=new qy}addToCollectionParentIndex(e,t){return this.un.add(t),Fp.resolve()}getCollectionParents(e,t){return Fp.resolve(this.un.getEntries(t))}addFieldIndex(e,t){return Fp.resolve()}deleteFieldIndex(e,t){return Fp.resolve()}deleteAllFieldIndexes(e){return Fp.resolve()}createTargetIndexes(e,t){return Fp.resolve()}getDocumentsMatchingTarget(e,t){return Fp.resolve(null)}getIndexType(e,t){return Fp.resolve(0)}getFieldIndexes(e,t){return Fp.resolve([])}getNextCollectionGroupToUpdate(e){return Fp.resolve(null)}getMinOffset(e,t){return Fp.resolve(zp.min())}getMinOffsetFromCollectionGroup(e,t){return Fp.resolve(zp.min())}updateCollectionGroup(e,t,n){return Fp.resolve()}updateIndexEntries(e,t){return Fp.resolve()}}class qy{constructor(){this.index={}}add(e){const t=e.lastSegment(),n=e.popLast(),r=this.index[t]||new rm(Cp.comparator),i=!r.has(n);return this.index[t]=r.add(n),i}has(e){const t=e.lastSegment(),n=e.popLast(),r=this.index[t];return r&&r.has(n)}getEntries(e){return(this.index[e]||new rm(Cp.comparator)).toArray()}}new Uint8Array(0);class Hy{constructor(e,t,n){this.cacheSizeCollectionThreshold=e,this.percentileToCollect=t,this.maximumSequenceNumbersToCollect=n}static withCacheSize(e){return new Hy(e,Hy.DEFAULT_COLLECTION_PERCENTILE,Hy.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT)}}Hy.DEFAULT_COLLECTION_PERCENTILE=10,Hy.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT=1e3,Hy.DEFAULT=new Hy(41943040,Hy.DEFAULT_COLLECTION_PERCENTILE,Hy.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT),Hy.DISABLED=new Hy(-1,0,0);class Wy{constructor(e){this.Ln=e}next(){return this.Ln+=2,this.Ln}static Bn(){return new Wy(0)}static kn(){return new Wy(-1)}}class Gy{constructor(){this.changes=new xg(e=>e.toString(),(e,t)=>e.isEqual(t)),this.changesApplied=!1}addEntry(e){this.assertNotApplied(),this.changes.set(e.key,e)}removeEntry(e,t){this.assertNotApplied(),this.changes.set(e,Dm.newInvalidDocument(e).setReadTime(t))}getEntry(e,t){this.assertNotApplied();const n=this.changes.get(t);return void 0!==n?Fp.resolve(n):this.getFromCache(e,t)}getEntries(e,t){return this.getAllFromCache(e,t)}apply(e){return this.assertNotApplied(),this.changesApplied=!0,this.applyChanges(e)}assertNotApplied(){}}class Ky{constructor(e,t){this.overlayedDocument=e,this.mutatedFields=t}}class Qy{constructor(e,t,n,r){this.remoteDocumentCache=e,this.mutationQueue=t,this.documentOverlayCache=n,this.indexManager=r}getDocument(e,t){let n=null;return this.documentOverlayCache.getOverlay(e,t).next(r=>(n=r,this.remoteDocumentCache.getEntry(e,t))).next(e=>(null!==n&&ry(n.mutation,e,am.empty(),kp.now()),e))}getDocuments(e,t){return this.remoteDocumentCache.getEntries(e,t).next(t=>this.getLocalViewOfDocuments(e,t,Pg()).next(()=>t))}getLocalViewOfDocuments(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:Pg();const r=Cg();return this.populateOverlays(e,r,t).next(()=>this.computeViews(e,t,r,n).next(e=>{let t=Tg();return e.forEach((e,n)=>{t=t.insert(e,n.overlayedDocument)}),t}))}getOverlayedDocuments(e,t){const n=Cg();return this.populateOverlays(e,n,t).next(()=>this.computeViews(e,t,n,Pg()))}populateOverlays(e,t,n){const r=[];return n.forEach(e=>{t.has(e)||r.push(e)}),this.documentOverlayCache.getOverlays(e,r).next(e=>{e.forEach((e,n)=>{t.set(e,n)})})}computeViews(e,t,n,r){let i=Sg();const a=Og(),o=Og();return t.forEach((e,t)=>{const o=n.get(t.key);r.has(t.key)&&(void 0===o||o.mutation instanceof sy)?i=i.insert(t.key,t):void 0!==o?(a.set(t.key,o.mutation.getFieldMask()),ry(o.mutation,t,o.mutation.getFieldMask(),kp.now())):a.set(t.key,am.empty())}),this.recalculateAndSaveOverlays(e,i).next(e=>(e.forEach((e,t)=>a.set(e,t)),t.forEach((e,t)=>{var n;return o.set(e,new Ky(t,null!==(n=a.get(e))&&void 0!==n?n:null))}),o))}recalculateAndSaveOverlays(e,t){const n=Og();let r=new em((e,t)=>e-t),i=Pg();return this.mutationQueue.getAllMutationBatchesAffectingDocumentKeys(e,t).next(e=>{for(const i of e)i.keys().forEach(e=>{const a=t.get(e);if(null===a)return;let o=n.get(e)||am.empty();o=i.applyToLocalView(a,o),n.set(e,o);const s=(r.get(i.batchId)||Pg()).add(e);r=r.insert(i.batchId,s)})}).next(()=>{const a=[],o=r.getReverseIterator();for(;o.hasNext();){const r=o.getNext(),s=r.key,c=r.value,l=Ag();c.forEach(e=>{if(!i.has(e)){const r=ty(t.get(e),n.get(e));null!==r&&l.set(e,r),i=i.add(e)}}),a.push(this.documentOverlayCache.saveOverlays(e,s,l))}return Fp.waitFor(a)}).next(()=>n)}recalculateAndSaveOverlaysForDocumentKeys(e,t){return this.remoteDocumentCache.getEntries(e,t).next(t=>this.recalculateAndSaveOverlays(e,t))}getDocumentsMatchingQuery(e,t,n,r){return function(e){return Np.isDocumentKey(e.path)&&null===e.collectionGroup&&0===e.filters.length}(t)?this.getDocumentsMatchingDocumentQuery(e,t.path):dg(t)?this.getDocumentsMatchingCollectionGroupQuery(e,t,n,r):this.getDocumentsMatchingCollectionQuery(e,t,n,r)}getNextDocuments(e,t,n,r){return this.remoteDocumentCache.getAllFromCollectionGroup(e,t,n,r).next(i=>{const a=r-i.size>0?this.documentOverlayCache.getOverlaysForCollectionGroup(e,t,n.largestBatchId,r-i.size):Fp.resolve(Cg());let o=-1,s=i;return a.next(t=>Fp.forEach(t,(t,n)=>(o<n.largestBatchId&&(o=n.largestBatchId),i.get(t)?Fp.resolve():this.remoteDocumentCache.getEntry(e,t).next(e=>{s=s.insert(t,e)}))).next(()=>this.populateOverlays(e,t,i)).next(()=>this.computeViews(e,s,t,Pg())).next(e=>({batchId:o,changes:Ig(e)})))})}getDocumentsMatchingDocumentQuery(e,t){return this.getDocument(e,new Np(t)).next(e=>{let t=Tg();return e.isFoundDocument()&&(t=t.insert(e.key,e)),t})}getDocumentsMatchingCollectionGroupQuery(e,t,n,r){const i=t.collectionGroup;let a=Tg();return this.indexManager.getCollectionParents(e,i).next(o=>Fp.forEach(o,o=>{const s=function(e,t){return new sg(t,null,e.explicitOrderBy.slice(),e.filters.slice(),e.limit,e.limitType,e.startAt,e.endAt)}(t,o.child(i));return this.getDocumentsMatchingCollectionQuery(e,s,n,r).next(e=>{e.forEach((e,t)=>{a=a.insert(e,t)})})}).next(()=>a))}getDocumentsMatchingCollectionQuery(e,t,n,r){let i;return this.documentOverlayCache.getOverlaysForCollection(e,t.path,n.largestBatchId).next(a=>(i=a,this.remoteDocumentCache.getDocumentsMatchingQuery(e,t,n,i,r))).next(e=>{i.forEach((t,n)=>{const r=n.getKey();null===e.get(r)&&(e=e.insert(r,Dm.newInvalidDocument(r)))});let n=Tg();return e.forEach((e,r)=>{const a=i.get(e);void 0!==a&&ry(a.mutation,r,am.empty(),kp.now()),wg(t,r)&&(n=n.insert(e,r))}),n})}}class Xy{constructor(e){this.serializer=e,this.hr=new Map,this.Pr=new Map}getBundleMetadata(e,t){return Fp.resolve(this.hr.get(t))}saveBundleMetadata(e,t){return this.hr.set(t.id,function(e){return{id:e.id,version:e.version,createTime:Sy(e.createTime)}}(t)),Fp.resolve()}getNamedQuery(e,t){return Fp.resolve(this.Pr.get(t))}saveNamedQuery(e,t){return this.Pr.set(t.name,function(e){return{name:e.name,query:Fy(e.bundledQuery),readTime:Sy(e.readTime)}}(t)),Fp.resolve()}}class Yy{constructor(){this.overlays=new em(Np.comparator),this.Ir=new Map}getOverlay(e,t){return Fp.resolve(this.overlays.get(t))}getOverlays(e,t){const n=Cg();return Fp.forEach(t,t=>this.getOverlay(e,t).next(e=>{null!==e&&n.set(t,e)})).next(()=>n)}saveOverlays(e,t,n){return n.forEach((n,r)=>{this.ht(e,t,r)}),Fp.resolve()}removeOverlaysForBatchId(e,t,n){const r=this.Ir.get(n);return void 0!==r&&(r.forEach(e=>this.overlays=this.overlays.remove(e)),this.Ir.delete(n)),Fp.resolve()}getOverlaysForCollection(e,t,n){const r=Cg(),i=t.length+1,a=new Np(t.child("")),o=this.overlays.getIteratorFrom(a);for(;o.hasNext();){const e=o.getNext().value,a=e.getKey();if(!t.isPrefixOf(a.path))break;a.path.length===i&&e.largestBatchId>n&&r.set(e.getKey(),e)}return Fp.resolve(r)}getOverlaysForCollectionGroup(e,t,n,r){let i=new em((e,t)=>e-t);const a=this.overlays.getIterator();for(;a.hasNext();){const e=a.getNext().value;if(e.getKey().getCollectionGroup()===t&&e.largestBatchId>n){let t=i.get(e.largestBatchId);null===t&&(t=Cg(),i=i.insert(e.largestBatchId,t)),t.set(e.getKey(),e)}}const o=Cg(),s=i.getIterator();for(;s.hasNext()&&(s.getNext().value.forEach((e,t)=>o.set(e,t)),!(o.size()>=r)););return Fp.resolve(o)}ht(e,t,n){const r=this.overlays.get(n.key);if(null!==r){const e=this.Ir.get(r.largestBatchId).delete(n.key);this.Ir.set(r.largestBatchId,e)}this.overlays=this.overlays.insert(n.key,new my(t,n));let i=this.Ir.get(t);void 0===i&&(i=Pg(),this.Ir.set(t,i)),this.Ir.set(t,i.add(n.key))}}class Jy{constructor(){this.sessionToken=sm.EMPTY_BYTE_STRING}getSessionToken(e){return Fp.resolve(this.sessionToken)}setSessionToken(e,t){return this.sessionToken=t,Fp.resolve()}}class $y{constructor(){this.Tr=new rm(Zy.Er),this.dr=new rm(Zy.Ar)}isEmpty(){return this.Tr.isEmpty()}addReference(e,t){const n=new Zy(e,t);this.Tr=this.Tr.add(n),this.dr=this.dr.add(n)}Rr(e,t){e.forEach(e=>this.addReference(e,t))}removeReference(e,t){this.Vr(new Zy(e,t))}mr(e,t){e.forEach(e=>this.removeReference(e,t))}gr(e){const t=new Np(new Cp([])),n=new Zy(t,e),r=new Zy(t,e+1),i=[];return this.dr.forEachInRange([n,r],e=>{this.Vr(e),i.push(e.key)}),i}pr(){this.Tr.forEach(e=>this.Vr(e))}Vr(e){this.Tr=this.Tr.delete(e),this.dr=this.dr.delete(e)}yr(e){const t=new Np(new Cp([])),n=new Zy(t,e),r=new Zy(t,e+1);let i=Pg();return this.dr.forEachInRange([n,r],e=>{i=i.add(e.key)}),i}containsKey(e){const t=new Zy(e,0),n=this.Tr.firstAfterOrEqual(t);return null!==n&&e.isEqual(n.key)}}class Zy{constructor(e,t){this.key=e,this.wr=t}static Er(e,t){return Np.comparator(e.key,t.key)||Ep(e.wr,t.wr)}static Ar(e,t){return Ep(e.wr,t.wr)||Np.comparator(e.key,t.key)}}class ev{constructor(e,t){this.indexManager=e,this.referenceDelegate=t,this.mutationQueue=[],this.Sr=1,this.br=new rm(Zy.Er)}checkEmpty(e){return Fp.resolve(0===this.mutationQueue.length)}addMutationBatch(e,t,n,r){const i=this.Sr;this.Sr++,this.mutationQueue.length>0&&this.mutationQueue[this.mutationQueue.length-1];const a=new fy(i,t,n,r);this.mutationQueue.push(a);for(const o of r)this.br=this.br.add(new Zy(o.key,i)),this.indexManager.addToCollectionParentIndex(e,o.key.path.popLast());return Fp.resolve(a)}lookupMutationBatch(e,t){return Fp.resolve(this.Dr(t))}getNextMutationBatchAfterBatchId(e,t){const n=t+1,r=this.vr(n),i=r<0?0:r;return Fp.resolve(this.mutationQueue.length>i?this.mutationQueue[i]:null)}getHighestUnacknowledgedBatchId(){return Fp.resolve(0===this.mutationQueue.length?-1:this.Sr-1)}getAllMutationBatches(e){return Fp.resolve(this.mutationQueue.slice())}getAllMutationBatchesAffectingDocumentKey(e,t){const n=new Zy(t,0),r=new Zy(t,Number.POSITIVE_INFINITY),i=[];return this.br.forEachInRange([n,r],e=>{const t=this.Dr(e.wr);i.push(t)}),Fp.resolve(i)}getAllMutationBatchesAffectingDocumentKeys(e,t){let n=new rm(Ep);return t.forEach(e=>{const t=new Zy(e,0),r=new Zy(e,Number.POSITIVE_INFINITY);this.br.forEachInRange([t,r],e=>{n=n.add(e.wr)})}),Fp.resolve(this.Cr(n))}getAllMutationBatchesAffectingQuery(e,t){const n=t.path,r=n.length+1;let i=n;Np.isDocumentKey(i)||(i=i.child(""));const a=new Zy(new Np(i),0);let o=new rm(Ep);return this.br.forEachWhile(e=>{const t=e.key.path;return!!n.isPrefixOf(t)&&(t.length===r&&(o=o.add(e.wr)),!0)},a),Fp.resolve(this.Cr(o))}Cr(e){const t=[];return e.forEach(e=>{const n=this.Dr(e);null!==n&&t.push(n)}),t}removeMutationBatch(e,t){cp(0===this.Fr(t.batchId,"removed")),this.mutationQueue.shift();let n=this.br;return Fp.forEach(t.mutations,r=>{const i=new Zy(r.key,t.batchId);return n=n.delete(i),this.referenceDelegate.markPotentiallyOrphaned(e,r.key)}).next(()=>{this.br=n})}On(e){}containsKey(e,t){const n=new Zy(t,0),r=this.br.firstAfterOrEqual(n);return Fp.resolve(t.isEqual(r&&r.key))}performConsistencyCheck(e){return this.mutationQueue.length,Fp.resolve()}Fr(e,t){return this.vr(e)}vr(e){return 0===this.mutationQueue.length?0:e-this.mutationQueue[0].batchId}Dr(e){const t=this.vr(e);return t<0||t>=this.mutationQueue.length?null:this.mutationQueue[t]}}class tv{constructor(e){this.Mr=e,this.docs=new em(Np.comparator),this.size=0}setIndexManager(e){this.indexManager=e}addEntry(e,t){const n=t.key,r=this.docs.get(n),i=r?r.size:0,a=this.Mr(t);return this.docs=this.docs.insert(n,{document:t.mutableCopy(),size:a}),this.size+=a-i,this.indexManager.addToCollectionParentIndex(e,n.path.popLast())}removeEntry(e){const t=this.docs.get(e);t&&(this.docs=this.docs.remove(e),this.size-=t.size)}getEntry(e,t){const n=this.docs.get(t);return Fp.resolve(n?n.document.mutableCopy():Dm.newInvalidDocument(t))}getEntries(e,t){let n=Sg();return t.forEach(e=>{const t=this.docs.get(e);n=n.insert(e,t?t.document.mutableCopy():Dm.newInvalidDocument(e))}),Fp.resolve(n)}getDocumentsMatchingQuery(e,t,n,r){let i=Sg();const a=t.path,o=new Np(a.child("")),s=this.docs.getIteratorFrom(o);for(;s.hasNext();){const{key:e,value:{document:o}}=s.getNext();if(!a.isPrefixOf(e.path))break;e.path.length>a.length+1||Mp(Dp(o),n)<=0||(r.has(o.key)||wg(t,o))&&(i=i.insert(o.key,o.mutableCopy()))}return Fp.resolve(i)}getAllFromCollectionGroup(e,t,n,r){sp()}Or(e,t){return Fp.forEach(this.docs,e=>t(e))}newChangeBuffer(e){return new nv(this)}getSize(e){return Fp.resolve(this.size)}}class nv extends Gy{constructor(e){super(),this.cr=e}applyChanges(e){const t=[];return this.changes.forEach((n,r)=>{r.isValidDocument()?t.push(this.cr.addEntry(e,r)):this.cr.removeEntry(n)}),Fp.waitFor(t)}getFromCache(e,t){return this.cr.getEntry(e,t)}getAllFromCache(e,t){return this.cr.getEntries(e,t)}}class rv{constructor(e){this.persistence=e,this.Nr=new xg(e=>ag(e),og),this.lastRemoteSnapshotVersion=Tp.min(),this.highestTargetId=0,this.Lr=0,this.Br=new $y,this.targetCount=0,this.kr=Wy.Bn()}forEachTarget(e,t){return this.Nr.forEach((e,n)=>t(n)),Fp.resolve()}getLastRemoteSnapshotVersion(e){return Fp.resolve(this.lastRemoteSnapshotVersion)}getHighestSequenceNumber(e){return Fp.resolve(this.Lr)}allocateTargetId(e){return this.highestTargetId=this.kr.next(),Fp.resolve(this.highestTargetId)}setTargetsMetadata(e,t,n){return n&&(this.lastRemoteSnapshotVersion=n),t>this.Lr&&(this.Lr=t),Fp.resolve()}Kn(e){this.Nr.set(e.target,e);const t=e.targetId;t>this.highestTargetId&&(this.kr=new Wy(t),this.highestTargetId=t),e.sequenceNumber>this.Lr&&(this.Lr=e.sequenceNumber)}addTargetData(e,t){return this.Kn(t),this.targetCount+=1,Fp.resolve()}updateTargetData(e,t){return this.Kn(t),Fp.resolve()}removeTargetData(e,t){return this.Nr.delete(t.target),this.Br.gr(t.targetId),this.targetCount-=1,Fp.resolve()}removeTargets(e,t,n){let r=0;const i=[];return this.Nr.forEach((a,o)=>{o.sequenceNumber<=t&&null===n.get(o.targetId)&&(this.Nr.delete(a),i.push(this.removeMatchingKeysForTargetId(e,o.targetId)),r++)}),Fp.waitFor(i).next(()=>r)}getTargetCount(e){return Fp.resolve(this.targetCount)}getTargetData(e,t){const n=this.Nr.get(t)||null;return Fp.resolve(n)}addMatchingKeys(e,t,n){return this.Br.Rr(t,n),Fp.resolve()}removeMatchingKeys(e,t,n){this.Br.mr(t,n);const r=this.persistence.referenceDelegate,i=[];return r&&t.forEach(t=>{i.push(r.markPotentiallyOrphaned(e,t))}),Fp.waitFor(i)}removeMatchingKeysForTargetId(e,t){return this.Br.gr(t),Fp.resolve()}getMatchingKeysForTargetId(e,t){const n=this.Br.yr(t);return Fp.resolve(n)}containsKey(e,t){return Fp.resolve(this.Br.containsKey(t))}}class iv{constructor(e,t){this.qr={},this.overlays={},this.Qr=new qp(0),this.Kr=!1,this.Kr=!0,this.$r=new Jy,this.referenceDelegate=e(this),this.Ur=new rv(this),this.indexManager=new Vy,this.remoteDocumentCache=function(e){return new tv(e)}(e=>this.referenceDelegate.Wr(e)),this.serializer=new By(t),this.Gr=new Xy(this.serializer)}start(){return Promise.resolve()}shutdown(){return this.Kr=!1,Promise.resolve()}get started(){return this.Kr}setDatabaseDeletedListener(){}setNetworkEnabled(){}getIndexManager(e){return this.indexManager}getDocumentOverlayCache(e){let t=this.overlays[e.toKey()];return t||(t=new Yy,this.overlays[e.toKey()]=t),t}getMutationQueue(e,t){let n=this.qr[e.toKey()];return n||(n=new ev(t,this.referenceDelegate),this.qr[e.toKey()]=n),n}getGlobalsCache(){return this.$r}getTargetCache(){return this.Ur}getRemoteDocumentCache(){return this.remoteDocumentCache}getBundleCache(){return this.Gr}runTransaction(e,t,n){rp("MemoryPersistence","Starting transaction:",e);const r=new av(this.Qr.next());return this.referenceDelegate.zr(),n(r).next(e=>this.referenceDelegate.jr(r).next(()=>e)).toPromise().then(e=>(r.raiseOnCommittedEvent(),e))}Hr(e,t){return Fp.or(Object.values(this.qr).map(n=>()=>n.containsKey(e,t)))}}class av extends Up{constructor(e){super(),this.currentSequenceNumber=e}}class ov{constructor(e){this.persistence=e,this.Jr=new $y,this.Yr=null}static Zr(e){return new ov(e)}get Xr(){if(this.Yr)return this.Yr;throw sp()}addReference(e,t,n){return this.Jr.addReference(n,t),this.Xr.delete(n.toString()),Fp.resolve()}removeReference(e,t,n){return this.Jr.removeReference(n,t),this.Xr.add(n.toString()),Fp.resolve()}markPotentiallyOrphaned(e,t){return this.Xr.add(t.toString()),Fp.resolve()}removeTarget(e,t){this.Jr.gr(t.targetId).forEach(e=>this.Xr.add(e.toString()));const n=this.persistence.getTargetCache();return n.getMatchingKeysForTargetId(e,t.targetId).next(e=>{e.forEach(e=>this.Xr.add(e.toString()))}).next(()=>n.removeTargetData(e,t))}zr(){this.Yr=new Set}jr(e){const t=this.persistence.getRemoteDocumentCache().newChangeBuffer();return Fp.forEach(this.Xr,n=>{const r=Np.fromPath(n);return this.ei(e,r).next(e=>{e||t.removeEntry(r,Tp.min())})}).next(()=>(this.Yr=null,t.apply(e)))}updateLimboDocument(e,t){return this.ei(e,t).next(e=>{e?this.Xr.delete(t.toString()):this.Xr.add(t.toString())})}Wr(e){return 0}ei(e,t){return Fp.or([()=>Fp.resolve(this.Jr.containsKey(t)),()=>this.persistence.getTargetCache().containsKey(e,t),()=>this.persistence.Hr(e,t)])}}class sv{constructor(e,t,n,r){this.targetId=e,this.fromCache=t,this.$i=n,this.Ui=r}static Wi(e,t){let n=Pg(),r=Pg();for(const i of t.docChanges)switch(i.type){case 0:n=n.add(i.doc.key);break;case 1:r=r.add(i.doc.key)}return new sv(e,t.fromCache,n,r)}}class cv{constructor(){this._documentReadCount=0}get documentReadCount(){return this._documentReadCount}incrementDocumentReadCount(e){this._documentReadCount+=e}}class lv{constructor(){this.Gi=!1,this.zi=!1,this.ji=100,this.Hi=Jd()?8:jp(Yd())>0?6:4}initialize(e,t){this.Ji=e,this.indexManager=t,this.Gi=!0}getDocumentsMatchingQuery(e,t,n,r){const i={result:null};return this.Yi(e,t).next(e=>{i.result=e}).next(()=>{if(!i.result)return this.Zi(e,t,r,n).next(e=>{i.result=e})}).next(()=>{if(i.result)return;const n=new cv;return this.Xi(e,t,n).next(r=>{if(i.result=r,this.zi)return this.es(e,t,n,r.size)})}).next(()=>i.result)}es(e,t,n,r){return n.documentReadCount<this.ji?(np()<=mh.DEBUG&&rp("QueryEngine","SDK will not create cache indexes for query:",vg(t),"since it only creates cache indexes for collection contains","more than or equal to",this.ji,"documents"),Fp.resolve()):(np()<=mh.DEBUG&&rp("QueryEngine","Query:",vg(t),"scans",n.documentReadCount,"local documents and returns",r,"documents as results."),n.documentReadCount>this.Hi*r?(np()<=mh.DEBUG&&rp("QueryEngine","The SDK decides to create cache indexes for query:",vg(t),"as using cache indexes may help improve performance."),this.indexManager.createTargetIndexes(e,fg(t))):Fp.resolve())}Yi(e,t){if(ug(t))return Fp.resolve(null);let n=fg(t);return this.indexManager.getIndexType(e,n).next(r=>0===r?null:(null!==t.limit&&1===r&&(t=mg(t,null,"F"),n=fg(t)),this.indexManager.getDocumentsMatchingTarget(e,n).next(r=>{const i=Pg(...r);return this.Ji.getDocuments(e,i).next(r=>this.indexManager.getMinOffset(e,n).next(n=>{const a=this.ts(t,r);return this.ns(t,a,i,n.readTime)?this.Yi(e,mg(t,null,"F")):this.rs(e,a,t,n)}))})))}Zi(e,t,n,r){return ug(t)||r.isEqual(Tp.min())?Fp.resolve(null):this.Ji.getDocuments(e,n).next(i=>{const a=this.ts(t,i);return this.ns(t,a,n,r)?Fp.resolve(null):(np()<=mh.DEBUG&&rp("QueryEngine","Re-using previous result from %s to execute query: %s",r.toString(),vg(t)),this.rs(e,a,t,Pp(r,-1)).next(e=>e))})}ts(e,t){let n=new rm(bg(e));return t.forEach((t,r)=>{wg(e,r)&&(n=n.add(r))}),n}ns(e,t,n,r){if(null===e.limit)return!1;if(n.size!==t.size)return!0;const i="F"===e.limitType?t.last():t.first();return!!i&&(i.hasPendingWrites||i.version.compareTo(r)>0)}Xi(e,t,n){return np()<=mh.DEBUG&&rp("QueryEngine","Using full collection scan to execute query:",vg(t)),this.Ji.getDocumentsMatchingQuery(e,t,zp.min(),n)}rs(e,t,n,r){return this.Ji.getDocumentsMatchingQuery(e,n,r).next(e=>(t.forEach(t=>{e=e.insert(t.key,t)}),e))}}class uv{constructor(e,t,n,r){this.persistence=e,this.ss=t,this.serializer=r,this.os=new em(Ep),this._s=new xg(e=>ag(e),og),this.us=new Map,this.cs=e.getRemoteDocumentCache(),this.Ur=e.getTargetCache(),this.Gr=e.getBundleCache(),this.ls(n)}ls(e){this.documentOverlayCache=this.persistence.getDocumentOverlayCache(e),this.indexManager=this.persistence.getIndexManager(e),this.mutationQueue=this.persistence.getMutationQueue(e,this.indexManager),this.localDocuments=new Qy(this.cs,this.mutationQueue,this.documentOverlayCache,this.indexManager),this.cs.setIndexManager(this.indexManager),this.ss.initialize(this.localDocuments,this.indexManager)}collectGarbage(e){return this.persistence.runTransaction("Collect garbage","readwrite-primary",t=>e.collect(t,this.os))}}function dv(e,t,n,r){return new uv(e,t,n,r)}async function hv(e,t){const n=lp(e);return await n.persistence.runTransaction("Handle user change","readonly",e=>{let r;return n.mutationQueue.getAllMutationBatches(e).next(i=>(r=i,n.ls(t),n.mutationQueue.getAllMutationBatches(e))).next(t=>{const i=[],a=[];let o=Pg();for(const e of r){i.push(e.batchId);for(const t of e.mutations)o=o.add(t.key)}for(const e of t){a.push(e.batchId);for(const t of e.mutations)o=o.add(t.key)}return n.localDocuments.getDocuments(e,o).next(e=>({hs:e,removedBatchIds:i,addedBatchIds:a}))})})}function fv(e){const t=lp(e);return t.persistence.runTransaction("Get last remote snapshot version","readonly",e=>t.Ur.getLastRemoteSnapshotVersion(e))}function pv(e,t){const n=lp(e);return n.persistence.runTransaction("Get next mutation batch","readonly",e=>(void 0===t&&(t=-1),n.mutationQueue.getNextMutationBatchAfterBatchId(e,t)))}class mv{constructor(){this.activeTargetIds=zg()}fs(e){this.activeTargetIds=this.activeTargetIds.add(e)}gs(e){this.activeTargetIds=this.activeTargetIds.delete(e)}Vs(){const e={activeTargetIds:this.activeTargetIds.toArray(),updateTimeMs:Date.now()};return JSON.stringify(e)}}class gv{constructor(){this.so=new mv,this.oo={},this.onlineStateHandler=null,this.sequenceNumberHandler=null}addPendingMutation(e){}updateMutationState(e,t,n){}addLocalQueryTarget(e){return(!(arguments.length>1&&void 0!==arguments[1])||arguments[1])&&this.so.fs(e),this.oo[e]||"not-current"}updateQueryState(e,t,n){this.oo[e]=t}removeLocalQueryTarget(e){this.so.gs(e)}isLocalQueryTarget(e){return this.so.activeTargetIds.has(e)}clearQueryState(e){delete this.oo[e]}getAllActiveQueryTargets(){return this.so.activeTargetIds}isActiveQueryTarget(e){return this.so.activeTargetIds.has(e)}start(){return this.so=new mv,Promise.resolve()}handleUserChange(e,t,n){}setOnlineState(e){}shutdown(){}writeSequenceNumber(e){}notifyBundleLoaded(e){}}class yv{_o(e){}shutdown(){}}class vv{constructor(){this.ao=()=>this.uo(),this.co=()=>this.lo(),this.ho=[],this.Po()}_o(e){this.ho.push(e)}shutdown(){window.removeEventListener("online",this.ao),window.removeEventListener("offline",this.co)}Po(){window.addEventListener("online",this.ao),window.addEventListener("offline",this.co)}uo(){rp("ConnectivityMonitor","Network connectivity changed: AVAILABLE");for(const e of this.ho)e(0)}lo(){rp("ConnectivityMonitor","Network connectivity changed: UNAVAILABLE");for(const e of this.ho)e(1)}static D(){return"undefined"!=typeof window&&void 0!==window.addEventListener&&void 0!==window.removeEventListener}}let wv=null;function bv(){return null===wv?wv=268435456+Math.round(2147483648*Math.random()):wv++,"0x"+wv.toString(16)}const _v={BatchGetDocuments:"batchGet",Commit:"commit",RunQuery:"runQuery",RunAggregationQuery:"runAggregationQuery"};class xv{constructor(e){this.Io=e.Io,this.To=e.To}Eo(e){this.Ao=e}Ro(e){this.Vo=e}mo(e){this.fo=e}onMessage(e){this.po=e}close(){this.To()}send(e){this.Io(e)}yo(){this.Ao()}wo(){this.Vo()}So(e){this.fo(e)}bo(e){this.po(e)}}const Ev="WebChannelConnection";class Sv extends class{constructor(e){this.databaseInfo=e,this.databaseId=e.databaseId;const t=e.ssl?"https":"http",n=encodeURIComponent(this.databaseId.projectId),r=encodeURIComponent(this.databaseId.database);this.Do=t+"://"+e.host,this.vo="projects/".concat(n,"/databases/").concat(r),this.Co="(default)"===this.databaseId.database?"project_id=".concat(n):"project_id=".concat(n,"&database_id=").concat(r)}get Fo(){return!1}Mo(e,t,n,r,i){const a=bv(),o=this.xo(e,t.toUriEncodedString());rp("RestConnection","Sending RPC '".concat(e,"' ").concat(a,":"),o,n);const s={"google-cloud-resource-prefix":this.vo,"x-goog-request-params":this.Co};return this.Oo(s,r,i),this.No(e,o,s,n).then(t=>(rp("RestConnection","Received RPC '".concat(e,"' ").concat(a,": "),t),t),t=>{throw ap("RestConnection","RPC '".concat(e,"' ").concat(a," failed with error: "),t,"url: ",o,"request:",n),t})}Lo(e,t,n,r,i,a){return this.Mo(e,t,n,r,i)}Oo(e,t,n){e["X-Goog-Api-Client"]="gl-js/ fire/"+ep,e["Content-Type"]="text/plain",this.databaseInfo.appId&&(e["X-Firebase-GMPID"]=this.databaseInfo.appId),t&&t.headers.forEach((t,n)=>e[n]=t),n&&n.headers.forEach((t,n)=>e[n]=t)}xo(e,t){const n=_v[e];return"".concat(this.Do,"/v1/").concat(t,":").concat(n)}terminate(){}}{constructor(e){super(e),this.forceLongPolling=e.forceLongPolling,this.autoDetectLongPolling=e.autoDetectLongPolling,this.useFetchStreams=e.useFetchStreams,this.longPollingOptions=e.longPollingOptions}No(e,t,n,r){const i=bv();return new Promise((a,o)=>{const s=new Vf;s.setWithCredentials(!0),s.listenOnce(Hf.COMPLETE,()=>{try{switch(s.getLastErrorCode()){case Wf.NO_ERROR:const t=s.getResponseJson();rp(Ev,"XHR for RPC '".concat(e,"' ").concat(i," received:"),JSON.stringify(t)),a(t);break;case Wf.TIMEOUT:rp(Ev,"RPC '".concat(e,"' ").concat(i," timed out")),o(new dp(up.DEADLINE_EXCEEDED,"Request time out"));break;case Wf.HTTP_ERROR:const n=s.getStatus();if(rp(Ev,"RPC '".concat(e,"' ").concat(i," failed with status:"),n,"response text:",s.getResponseText()),n>0){let e=s.getResponseJson();Array.isArray(e)&&(e=e[0]);const t=null==e?void 0:e.error;if(t&&t.status&&t.message){const e=function(e){const t=e.toLowerCase().replace(/_/g,"-");return Object.values(up).indexOf(t)>=0?t:up.UNKNOWN}(t.status);o(new dp(e,t.message))}else o(new dp(up.UNKNOWN,"Server responded with status "+s.getStatus()))}else o(new dp(up.UNAVAILABLE,"Connection failed."));break;default:sp()}}finally{rp(Ev,"RPC '".concat(e,"' ").concat(i," completed."))}});const c=JSON.stringify(r);rp(Ev,"RPC '".concat(e,"' ").concat(i," sending request:"),r),s.send(t,"POST",c,n,15)})}Bo(e,t,n){const r=bv(),i=[this.Do,"/","google.firestore.v1.Firestore","/",e,"/channel"],a=Xf(),o=Qf(),s={httpSessionIdParam:"gsessionid",initMessageHeaders:{},messageUrlParams:{database:"projects/".concat(this.databaseId.projectId,"/databases/").concat(this.databaseId.database)},sendRawJson:!0,supportsCrossDomainXhr:!0,internalChannelParams:{forwardChannelRequestTimeoutMs:6e5},forceLongPolling:this.forceLongPolling,detectBufferingProxy:this.autoDetectLongPolling},c=this.longPollingOptions.timeoutSeconds;void 0!==c&&(s.longPollingTimeout=Math.round(1e3*c)),this.useFetchStreams&&(s.useFetchStreams=!0),this.Oo(s.initMessageHeaders,t,n),s.encodeInitMessageHeaders=!0;const l=i.join("");rp(Ev,"Creating RPC '".concat(e,"' stream ").concat(r,": ").concat(l),s);const u=a.createWebChannel(l,s);let d=!1,h=!1;const f=new xv({Io:t=>{h?rp(Ev,"Not sending because RPC '".concat(e,"' stream ").concat(r," is closed:"),t):(d||(rp(Ev,"Opening RPC '".concat(e,"' stream ").concat(r," transport.")),u.open(),d=!0),rp(Ev,"RPC '".concat(e,"' stream ").concat(r," sending:"),t),u.send(t))},To:()=>u.close()}),p=(e,t,n)=>{e.listen(t,e=>{try{n(e)}catch(e){setTimeout(()=>{throw e},0)}})};return p(u,qf.EventType.OPEN,()=>{h||(rp(Ev,"RPC '".concat(e,"' stream ").concat(r," transport opened.")),f.yo())}),p(u,qf.EventType.CLOSE,()=>{h||(h=!0,rp(Ev,"RPC '".concat(e,"' stream ").concat(r," transport closed")),f.So())}),p(u,qf.EventType.ERROR,t=>{h||(h=!0,ap(Ev,"RPC '".concat(e,"' stream ").concat(r," transport errored:"),t),f.So(new dp(up.UNAVAILABLE,"The operation could not be completed")))}),p(u,qf.EventType.MESSAGE,t=>{var n;if(!h){const i=t.data[0];cp(!!i);const a=i,o=a.error||(null===(n=a[0])||void 0===n?void 0:n.error);if(o){rp(Ev,"RPC '".concat(e,"' stream ").concat(r," received error:"),o);const t=o.status;let n=function(e){const t=gy[e];if(void 0!==t)return wy(t)}(t),i=o.message;void 0===n&&(n=up.INTERNAL,i="Unknown error status: "+t+" with message "+o.message),h=!0,f.So(new dp(n,i)),u.close()}else rp(Ev,"RPC '".concat(e,"' stream ").concat(r," received:"),i),f.bo(i)}}),p(o,Kf.STAT_EVENT,t=>{t.stat===Gf.PROXY?rp(Ev,"RPC '".concat(e,"' stream ").concat(r," detected buffering proxy")):t.stat===Gf.NOPROXY&&rp(Ev,"RPC '".concat(e,"' stream ").concat(r," detected no buffering proxy"))}),setTimeout(()=>{f.wo()},0),f}}function kv(){return"undefined"!=typeof document?document:null}function Tv(e){return new by(e,!0)}class Iv{constructor(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1e3,r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:1.5,i=arguments.length>4&&void 0!==arguments[4]?arguments[4]:6e4;this.ui=e,this.timerId=t,this.ko=n,this.qo=r,this.Qo=i,this.Ko=0,this.$o=null,this.Uo=Date.now(),this.reset()}reset(){this.Ko=0}Wo(){this.Ko=this.Qo}Go(e){this.cancel();const t=Math.floor(this.Ko+this.zo()),n=Math.max(0,Date.now()-this.Uo),r=Math.max(0,t-n);r>0&&rp("ExponentialBackoff","Backing off for ".concat(r," ms (base delay: ").concat(this.Ko," ms, delay with jitter: ").concat(t," ms, last attempt: ").concat(n," ms ago)")),this.$o=this.ui.enqueueAfterDelay(this.timerId,r,()=>(this.Uo=Date.now(),e())),this.Ko*=this.qo,this.Ko<this.ko&&(this.Ko=this.ko),this.Ko>this.Qo&&(this.Ko=this.Qo)}jo(){null!==this.$o&&(this.$o.skipDelay(),this.$o=null)}cancel(){null!==this.$o&&(this.$o.cancel(),this.$o=null)}zo(){return(Math.random()-.5)*this.Ko}}class Cv{constructor(e,t,n,r,i,a,o,s){this.ui=e,this.Ho=n,this.Jo=r,this.connection=i,this.authCredentialsProvider=a,this.appCheckCredentialsProvider=o,this.listener=s,this.state=0,this.Yo=0,this.Zo=null,this.Xo=null,this.stream=null,this.e_=0,this.t_=new Iv(e,t)}n_(){return 1===this.state||5===this.state||this.r_()}r_(){return 2===this.state||3===this.state}start(){this.e_=0,4!==this.state?this.auth():this.i_()}async stop(){this.n_()&&await this.close(0)}s_(){this.state=0,this.t_.reset()}o_(){this.r_()&&null===this.Zo&&(this.Zo=this.ui.enqueueAfterDelay(this.Ho,6e4,()=>this.__()))}a_(e){this.u_(),this.stream.send(e)}async __(){if(this.r_())return this.close(0)}u_(){this.Zo&&(this.Zo.cancel(),this.Zo=null)}c_(){this.Xo&&(this.Xo.cancel(),this.Xo=null)}async close(e,t){this.u_(),this.c_(),this.t_.cancel(),this.Yo++,4!==e?this.t_.reset():t&&t.code===up.RESOURCE_EXHAUSTED?(ip(t.toString()),ip("Using maximum backoff delay to prevent overloading the backend."),this.t_.Wo()):t&&t.code===up.UNAUTHENTICATED&&3!==this.state&&(this.authCredentialsProvider.invalidateToken(),this.appCheckCredentialsProvider.invalidateToken()),null!==this.stream&&(this.l_(),this.stream.close(),this.stream=null),this.state=e,await this.listener.mo(t)}l_(){}auth(){this.state=1;const e=this.h_(this.Yo),t=this.Yo;Promise.all([this.authCredentialsProvider.getToken(),this.appCheckCredentialsProvider.getToken()]).then(e=>{let[n,r]=e;this.Yo===t&&this.P_(n,r)},t=>{e(()=>{const e=new dp(up.UNKNOWN,"Fetching auth token failed: "+t.message);return this.I_(e)})})}P_(e,t){const n=this.h_(this.Yo);this.stream=this.T_(e,t),this.stream.Eo(()=>{n(()=>this.listener.Eo())}),this.stream.Ro(()=>{n(()=>(this.state=2,this.Xo=this.ui.enqueueAfterDelay(this.Jo,1e4,()=>(this.r_()&&(this.state=3),Promise.resolve())),this.listener.Ro()))}),this.stream.mo(e=>{n(()=>this.I_(e))}),this.stream.onMessage(e=>{n(()=>1==++this.e_?this.E_(e):this.onNext(e))})}i_(){this.state=5,this.t_.Go(async()=>{this.state=0,this.start()})}I_(e){return rp("PersistentStream","close with error: ".concat(e)),this.stream=null,this.close(4,e)}h_(e){return t=>{this.ui.enqueueAndForget(()=>this.Yo===e?t():(rp("PersistentStream","stream callback skipped by getCloseGuardedDispatcher."),Promise.resolve()))}}}class Av extends Cv{constructor(e,t,n,r,i,a){super(e,"write_stream_connection_backoff","write_stream_idle","health_check_timeout",t,n,r,a),this.serializer=i}get V_(){return this.e_>0}start(){this.lastStreamToken=void 0,super.start()}l_(){this.V_&&this.m_([])}T_(e,t){return this.connection.Bo("Write",e,t)}E_(e){return cp(!!e.streamToken),this.lastStreamToken=e.streamToken,cp(!e.writeResults||0===e.writeResults.length),this.listener.f_()}onNext(e){cp(!!e.streamToken),this.lastStreamToken=e.streamToken,this.t_.reset();const t=function(e,t){return e&&e.length>0?(cp(void 0!==t),e.map(e=>function(e,t){let n=e.updateTime?Sy(e.updateTime):Sy(t);return n.isEqual(Tp.min())&&(n=Sy(t)),new Jg(n,e.transformResults||[])}(e,t))):[]}(e.writeResults,e.commitTime),n=Sy(e.commitTime);return this.listener.g_(n,t)}p_(){const e={};e.database=Oy(this.serializer),this.a_(e)}m_(e){const t={streamToken:this.lastStreamToken,writes:e.map(e=>Py(this.serializer,e))};this.a_(t)}}class Ov extends class{}{constructor(e,t,n,r){super(),this.authCredentials=e,this.appCheckCredentials=t,this.connection=n,this.serializer=r,this.y_=!1}w_(){if(this.y_)throw new dp(up.FAILED_PRECONDITION,"The client has already been terminated.")}Mo(e,t,n,r){return this.w_(),Promise.all([this.authCredentials.getToken(),this.appCheckCredentials.getToken()]).then(i=>{let[a,o]=i;return this.connection.Mo(e,Ty(t,n),r,a,o)}).catch(e=>{throw"FirebaseError"===e.name?(e.code===up.UNAUTHENTICATED&&(this.authCredentials.invalidateToken(),this.appCheckCredentials.invalidateToken()),e):new dp(up.UNKNOWN,e.toString())})}Lo(e,t,n,r,i){return this.w_(),Promise.all([this.authCredentials.getToken(),this.appCheckCredentials.getToken()]).then(a=>{let[o,s]=a;return this.connection.Lo(e,Ty(t,n),r,o,s,i)}).catch(e=>{throw"FirebaseError"===e.name?(e.code===up.UNAUTHENTICATED&&(this.authCredentials.invalidateToken(),this.appCheckCredentials.invalidateToken()),e):new dp(up.UNKNOWN,e.toString())})}terminate(){this.y_=!0,this.connection.terminate()}}class Nv{constructor(e,t){this.asyncQueue=e,this.onlineStateHandler=t,this.state="Unknown",this.S_=0,this.b_=null,this.D_=!0}v_(){0===this.S_&&(this.C_("Unknown"),this.b_=this.asyncQueue.enqueueAfterDelay("online_state_timeout",1e4,()=>(this.b_=null,this.F_("Backend didn't respond within 10 seconds."),this.C_("Offline"),Promise.resolve())))}M_(e){"Online"===this.state?this.C_("Unknown"):(this.S_++,this.S_>=1&&(this.x_(),this.F_("Connection failed 1 times. Most recent error: ".concat(e.toString())),this.C_("Offline")))}set(e){this.x_(),this.S_=0,"Online"===e&&(this.D_=!1),this.C_(e)}C_(e){e!==this.state&&(this.state=e,this.onlineStateHandler(e))}F_(e){const t="Could not reach Cloud Firestore backend. ".concat(e,"\nThis typically indicates that your device does not have a healthy Internet connection at the moment. The client will operate in offline mode until it is able to successfully connect to the backend.");this.D_?(ip(t),this.D_=!1):rp("OnlineStateTracker",t)}x_(){null!==this.b_&&(this.b_.cancel(),this.b_=null)}}class Rv{constructor(e,t,n,r,i){this.localStore=e,this.datastore=t,this.asyncQueue=n,this.remoteSyncer={},this.O_=[],this.N_=new Map,this.L_=new Set,this.B_=[],this.k_=i,this.k_._o(e=>{n.enqueueAndForget(async()=>{zv(this)&&(rp("RemoteStore","Restarting streams for network reachability change."),await async function(e){const t=lp(e);t.L_.add(4),await Dv(t),t.q_.set("Unknown"),t.L_.delete(4),await Pv(t)}(this))})}),this.q_=new Nv(n,r)}}async function Pv(e){if(zv(e))for(const t of e.B_)await t(!0)}async function Dv(e){for(const t of e.B_)await t(!1)}function zv(e){return 0===lp(e).L_.size}async function Mv(e,t,n){if(!Vp(t))throw t;e.L_.add(1),await Dv(e),e.q_.set("Offline"),n||(n=()=>fv(e.localStore)),e.asyncQueue.enqueueRetryable(async()=>{rp("RemoteStore","Retrying IndexedDB access"),await n(),e.L_.delete(1),await Pv(e)})}function Lv(e,t){return t().catch(n=>Mv(e,n,t))}async function Uv(e){const t=lp(e),n=Xv(t);let r=t.O_.length>0?t.O_[t.O_.length-1].batchId:-1;for(;Bv(t);)try{const e=await pv(t.localStore,r);if(null===e){0===t.O_.length&&n.o_();break}r=e.batchId,Fv(t,e)}catch(e){await Mv(t,e)}jv(t)&&Vv(t)}function Bv(e){return zv(e)&&e.O_.length<10}function Fv(e,t){e.O_.push(t);const n=Xv(e);n.r_()&&n.V_&&n.m_(t.mutations)}function jv(e){return zv(e)&&!Xv(e).n_()&&e.O_.length>0}function Vv(e){Xv(e).start()}async function qv(e){Xv(e).p_()}async function Hv(e){const t=Xv(e);for(const n of e.O_)t.m_(n.mutations)}async function Wv(e,t,n){const r=e.O_.shift(),i=py.from(r,t,n);await Lv(e,()=>e.remoteSyncer.applySuccessfulWrite(i)),await Uv(e)}async function Gv(e,t){t&&Xv(e).V_&&await async function(e,t){if(function(e){return vy(e)&&e!==up.ABORTED}(t.code)){const n=e.O_.shift();Xv(e).s_(),await Lv(e,()=>e.remoteSyncer.rejectFailedWrite(n.batchId,t)),await Uv(e)}}(e,t),jv(e)&&Vv(e)}async function Kv(e,t){const n=lp(e);n.asyncQueue.verifyOperationInProgress(),rp("RemoteStore","RemoteStore received new credentials");const r=zv(n);n.L_.add(3),await Dv(n),r&&n.q_.set("Unknown"),await n.remoteSyncer.handleCredentialChange(t),n.L_.delete(3),await Pv(n)}async function Qv(e,t){const n=lp(e);t?(n.L_.delete(2),await Pv(n)):t||(n.L_.add(2),await Dv(n),n.q_.set("Unknown"))}function Xv(e){return e.U_||(e.U_=function(e,t,n){const r=lp(e);return r.w_(),new Av(t,r.connection,r.authCredentials,r.appCheckCredentials,r.serializer,n)}(e.datastore,e.asyncQueue,{Eo:()=>Promise.resolve(),Ro:qv.bind(null,e),mo:Gv.bind(null,e),f_:Hv.bind(null,e),g_:Wv.bind(null,e)}),e.B_.push(async t=>{t?(e.U_.s_(),await Uv(e)):(await e.U_.stop(),e.O_.length>0&&(rp("RemoteStore","Stopping write stream with ".concat(e.O_.length," pending writes")),e.O_=[]))})),e.U_}class Yv{constructor(e,t,n,r,i){this.asyncQueue=e,this.timerId=t,this.targetTimeMs=n,this.op=r,this.removalCallback=i,this.deferred=new hp,this.then=this.deferred.promise.then.bind(this.deferred.promise),this.deferred.promise.catch(e=>{})}get promise(){return this.deferred.promise}static createAndSchedule(e,t,n,r,i){const a=Date.now()+n,o=new Yv(e,t,a,r,i);return o.start(n),o}start(e){this.timerHandle=setTimeout(()=>this.handleDelayElapsed(),e)}skipDelay(){return this.handleDelayElapsed()}cancel(e){null!==this.timerHandle&&(this.clearTimeout(),this.deferred.reject(new dp(up.CANCELLED,"Operation cancelled"+(e?": "+e:""))))}handleDelayElapsed(){this.asyncQueue.enqueueAndForget(()=>null!==this.timerHandle?(this.clearTimeout(),this.op().then(e=>this.deferred.resolve(e))):Promise.resolve())}clearTimeout(){null!==this.timerHandle&&(this.removalCallback(this),clearTimeout(this.timerHandle),this.timerHandle=null)}}function Jv(e,t){if(ip("AsyncQueue","".concat(t,": ").concat(e)),Vp(e))return new dp(up.UNAVAILABLE,"".concat(t,": ").concat(e));throw e}class $v{constructor(){this.queries=Zv(),this.onlineState="Unknown",this.Y_=new Set}terminate(){!function(e,t){const n=lp(e),r=n.queries;n.queries=Zv(),r.forEach((e,n)=>{for(const r of n.j_)r.onError(t)})}(this,new dp(up.ABORTED,"Firestore shutting down"))}}function Zv(){return new xg(e=>yg(e),gg)}function ew(e){e.Y_.forEach(e=>{e.next()})}var tw,nw;(nw=tw||(tw={})).ea="default",nw.Cache="cache";class rw{constructor(e,t,n,r,i,a){this.localStore=e,this.remoteStore=t,this.eventManager=n,this.sharedClientState=r,this.currentUser=i,this.maxConcurrentLimboResolutions=a,this.Ca={},this.Fa=new xg(e=>yg(e),gg),this.Ma=new Map,this.xa=new Set,this.Oa=new em(Np.comparator),this.Na=new Map,this.La=new $y,this.Ba={},this.ka=new Map,this.qa=Wy.kn(),this.onlineState="Unknown",this.Qa=void 0}get isPrimaryClient(){return!0===this.Qa}}function iw(e,t,n){const r=lp(e);if(r.isPrimaryClient&&0===n||!r.isPrimaryClient&&1===n){const e=[];r.Fa.forEach((n,r)=>{const i=r.view.Z_(t);i.snapshot&&e.push(i.snapshot)}),function(e,t){const n=lp(e);n.onlineState=t;let r=!1;n.queries.forEach((e,n)=>{for(const i of n.j_)i.Z_(t)&&(r=!0)}),r&&ew(n)}(r.eventManager,t),e.length&&r.Ca.d_(e),r.onlineState=t,r.isPrimaryClient&&r.sharedClientState.setOnlineState(t)}}async function aw(e,t){const n=lp(e),r=t.batch.batchId;try{const e=await function(e,t){const n=lp(e);return n.persistence.runTransaction("Acknowledge batch","readwrite-primary",e=>{const r=t.batch.keys(),i=n.cs.newChangeBuffer({trackRemovals:!0});return function(e,t,n,r){const i=n.batch,a=i.keys();let o=Fp.resolve();return a.forEach(e=>{o=o.next(()=>r.getEntry(t,e)).next(t=>{const a=n.docVersions.get(e);cp(null!==a),t.version.compareTo(a)<0&&(i.applyToRemoteDocument(t,n),t.isValidDocument()&&(t.setReadTime(n.commitVersion),r.addEntry(t)))})}),o.next(()=>e.mutationQueue.removeMutationBatch(t,i))}(n,e,t,i).next(()=>i.apply(e)).next(()=>n.mutationQueue.performConsistencyCheck(e)).next(()=>n.documentOverlayCache.removeOverlaysForBatchId(e,r,t.batch.batchId)).next(()=>n.localDocuments.recalculateAndSaveOverlaysForDocumentKeys(e,function(e){let t=Pg();for(let n=0;n<e.mutationResults.length;++n)e.mutationResults[n].transformResults.length>0&&(t=t.add(e.batch.mutations[n].key));return t}(t))).next(()=>n.localDocuments.getDocuments(e,r))})}(n.localStore,t);cw(n,r,null),sw(n,r),n.sharedClientState.updateMutationState(r,"acknowledged"),await lw(n,e)}catch(e){await Bp(e)}}async function ow(e,t,n){const r=lp(e);try{const e=await function(e,t){const n=lp(e);return n.persistence.runTransaction("Reject batch","readwrite-primary",e=>{let r;return n.mutationQueue.lookupMutationBatch(e,t).next(t=>(cp(null!==t),r=t.keys(),n.mutationQueue.removeMutationBatch(e,t))).next(()=>n.mutationQueue.performConsistencyCheck(e)).next(()=>n.documentOverlayCache.removeOverlaysForBatchId(e,r,t)).next(()=>n.localDocuments.recalculateAndSaveOverlaysForDocumentKeys(e,r)).next(()=>n.localDocuments.getDocuments(e,r))})}(r.localStore,t);cw(r,t,n),sw(r,t),r.sharedClientState.updateMutationState(t,"rejected",n),await lw(r,e)}catch(n){await Bp(n)}}function sw(e,t){(e.ka.get(t)||[]).forEach(e=>{e.resolve()}),e.ka.delete(t)}function cw(e,t,n){const r=lp(e);let i=r.Ba[r.currentUser.toKey()];if(i){const e=i.get(t);e&&(n?e.reject(n):e.resolve(),i=i.remove(t)),r.Ba[r.currentUser.toKey()]=i}}async function lw(e,t,n){const r=lp(e),i=[],a=[],o=[];r.Fa.isEmpty()||(r.Fa.forEach((e,s)=>{o.push(r.Ka(s,t,n).then(e=>{var t;if((e||n)&&r.isPrimaryClient){const i=e?!e.fromCache:null===(t=null==n?void 0:n.targetChanges.get(s.targetId))||void 0===t?void 0:t.current;r.sharedClientState.updateQueryState(s.targetId,i?"current":"not-current")}if(e){i.push(e);const t=sv.Wi(s.targetId,e);a.push(t)}}))}),await Promise.all(o),r.Ca.d_(i),await async function(e,t){const n=lp(e);try{await n.persistence.runTransaction("notifyLocalViewChanges","readwrite",e=>Fp.forEach(t,t=>Fp.forEach(t.$i,r=>n.persistence.referenceDelegate.addReference(e,t.targetId,r)).next(()=>Fp.forEach(t.Ui,r=>n.persistence.referenceDelegate.removeReference(e,t.targetId,r)))))}catch(e){if(!Vp(e))throw e;rp("LocalStore","Failed to update sequence numbers: "+e)}for(const r of t){const e=r.targetId;if(!r.fromCache){const t=n.os.get(e),r=t.snapshotVersion,i=t.withLastLimboFreeSnapshotVersion(r);n.os=n.os.insert(e,i)}}}(r.localStore,a))}async function uw(e,t){const n=lp(e);if(!n.currentUser.isEqual(t)){rp("SyncEngine","User change. New user:",t.toKey());const e=await hv(n.localStore,t);n.currentUser=t,function(e,t){e.ka.forEach(e=>{e.forEach(e=>{e.reject(new dp(up.CANCELLED,t))})}),e.ka.clear()}(n,"'waitForPendingWrites' promise is rejected due to a user change."),n.sharedClientState.handleUserChange(t,e.removedBatchIds,e.addedBatchIds),await lw(n,e.hs)}}function dw(e){const t=lp(e);return t.remoteStore.remoteSyncer.applySuccessfulWrite=aw.bind(null,t),t.remoteStore.remoteSyncer.rejectFailedWrite=ow.bind(null,t),t}class hw{constructor(){this.kind="memory",this.synchronizeTabs=!1}async initialize(e){this.serializer=Tv(e.databaseInfo.databaseId),this.sharedClientState=this.Wa(e),this.persistence=this.Ga(e),await this.persistence.start(),this.localStore=this.za(e),this.gcScheduler=this.ja(e,this.localStore),this.indexBackfillerScheduler=this.Ha(e,this.localStore)}ja(e,t){return null}Ha(e,t){return null}za(e){return dv(this.persistence,new lv,e.initialUser,this.serializer)}Ga(e){return new iv(ov.Zr,this.serializer)}Wa(e){return new gv}async terminate(){var e,t;null===(e=this.gcScheduler)||void 0===e||e.stop(),null===(t=this.indexBackfillerScheduler)||void 0===t||t.stop(),this.sharedClientState.shutdown(),await this.persistence.shutdown()}}hw.provider={build:()=>new hw};class fw{async initialize(e,t){this.localStore||(this.localStore=e.localStore,this.sharedClientState=e.sharedClientState,this.datastore=this.createDatastore(t),this.remoteStore=this.createRemoteStore(t),this.eventManager=this.createEventManager(t),this.syncEngine=this.createSyncEngine(t,!e.synchronizeTabs),this.sharedClientState.onlineStateHandler=e=>iw(this.syncEngine,e,1),this.remoteStore.remoteSyncer.handleCredentialChange=uw.bind(null,this.syncEngine),await Qv(this.remoteStore,this.syncEngine.isPrimaryClient))}createEventManager(e){return new $v}createDatastore(e){const t=Tv(e.databaseInfo.databaseId),n=function(e){return new Sv(e)}(e.databaseInfo);return function(e,t,n,r){return new Ov(e,t,n,r)}(e.authCredentials,e.appCheckCredentials,n,t)}createRemoteStore(e){return function(e,t,n,r,i){return new Rv(e,t,n,r,i)}(this.localStore,this.datastore,e.asyncQueue,e=>iw(this.syncEngine,e,0),vv.D()?new vv:new yv)}createSyncEngine(e,t){return function(e,t,n,r,i,a,o){const s=new rw(e,t,n,r,i,a);return o&&(s.Qa=!0),s}(this.localStore,this.remoteStore,this.eventManager,this.sharedClientState,e.initialUser,e.maxConcurrentLimboResolutions,t)}async terminate(){var e,t;await async function(e){const t=lp(e);rp("RemoteStore","RemoteStore shutting down."),t.L_.add(5),await Dv(t),t.k_.shutdown(),t.q_.set("Unknown")}(this.remoteStore),null===(e=this.datastore)||void 0===e||e.terminate(),null===(t=this.eventManager)||void 0===t||t.terminate()}}fw.provider={build:()=>new fw};class pw{constructor(e,t,n,r,i){this.authCredentials=e,this.appCheckCredentials=t,this.asyncQueue=n,this.databaseInfo=r,this.user=Zf.UNAUTHENTICATED,this.clientId=xp.newId(),this.authCredentialListener=()=>Promise.resolve(),this.appCheckCredentialListener=()=>Promise.resolve(),this._uninitializedComponentsProvider=i,this.authCredentials.start(n,async e=>{rp("FirestoreClient","Received user=",e.uid),await this.authCredentialListener(e),this.user=e}),this.appCheckCredentials.start(n,e=>(rp("FirestoreClient","Received new app check token=",e),this.appCheckCredentialListener(e,this.user)))}get configuration(){return{asyncQueue:this.asyncQueue,databaseInfo:this.databaseInfo,clientId:this.clientId,authCredentials:this.authCredentials,appCheckCredentials:this.appCheckCredentials,initialUser:this.user,maxConcurrentLimboResolutions:100}}setCredentialChangeListener(e){this.authCredentialListener=e}setAppCheckTokenChangeListener(e){this.appCheckCredentialListener=e}terminate(){this.asyncQueue.enterRestrictedMode();const e=new hp;return this.asyncQueue.enqueueAndForgetEvenWhileRestricted(async()=>{try{this._onlineComponents&&await this._onlineComponents.terminate(),this._offlineComponents&&await this._offlineComponents.terminate(),this.authCredentials.shutdown(),this.appCheckCredentials.shutdown(),e.resolve()}catch(k_){const n=Jv(k_,"Failed to shutdown persistence");e.reject(n)}}),e.promise}}async function mw(e,t){e.asyncQueue.verifyOperationInProgress(),rp("FirestoreClient","Initializing OfflineComponentProvider");const n=e.configuration;await t.initialize(n);let r=n.initialUser;e.setCredentialChangeListener(async e=>{r.isEqual(e)||(await hv(t.localStore,e),r=e)}),t.persistence.setDatabaseDeletedListener(()=>e.terminate()),e._offlineComponents=t}async function gw(e,t){e.asyncQueue.verifyOperationInProgress();const n=await yw(e);rp("FirestoreClient","Initializing OnlineComponentProvider"),await t.initialize(n,e.configuration),e.setCredentialChangeListener(e=>Kv(t.remoteStore,e)),e.setAppCheckTokenChangeListener((e,n)=>Kv(t.remoteStore,n)),e._onlineComponents=t}async function yw(e){if(!e._offlineComponents)if(e._uninitializedComponentsProvider){rp("FirestoreClient","Using user provided OfflineComponentProvider");try{await mw(e,e._uninitializedComponentsProvider._offline)}catch(k_){const n=k_;if(!function(e){return"FirebaseError"===e.name?e.code===up.FAILED_PRECONDITION||e.code===up.UNIMPLEMENTED:!("undefined"!=typeof DOMException&&e instanceof DOMException)||22===e.code||20===e.code||11===e.code}(n))throw n;ap("Error using user provided cache. Falling back to memory cache: "+n),await mw(e,new hw)}}else rp("FirestoreClient","Using default OfflineComponentProvider"),await mw(e,new hw);return e._offlineComponents}async function vw(e){return e._onlineComponents||(e._uninitializedComponentsProvider?(rp("FirestoreClient","Using user provided OnlineComponentProvider"),await gw(e,e._uninitializedComponentsProvider._online)):(rp("FirestoreClient","Using default OnlineComponentProvider"),await gw(e,new fw))),e._onlineComponents}function ww(e){return vw(e).then(e=>e.syncEngine)}function bw(e){const t={};return void 0!==e.timeoutSeconds&&(t.timeoutSeconds=e.timeoutSeconds),t}const _w=new Map;function xw(e,t,n){if(!n)throw new dp(up.INVALID_ARGUMENT,"Function ".concat(e,"() cannot be called with an empty ").concat(t,"."))}function Ew(e){if(!Np.isDocumentKey(e))throw new dp(up.INVALID_ARGUMENT,"Invalid document reference. Document references must have an even number of segments, but ".concat(e," has ").concat(e.length,"."))}function Sw(e){if(Np.isDocumentKey(e))throw new dp(up.INVALID_ARGUMENT,"Invalid collection reference. Collection references must have an odd number of segments, but ".concat(e," has ").concat(e.length,"."))}function kw(e){if(void 0===e)return"undefined";if(null===e)return"null";if("string"==typeof e)return e.length>20&&(e="".concat(e.substring(0,20),"...")),JSON.stringify(e);if("number"==typeof e||"boolean"==typeof e)return""+e;if("object"==typeof e){if(e instanceof Array)return"an array";{const t=function(e){return e.constructor?e.constructor.name:null}(e);return t?"a custom ".concat(t," object"):"an object"}}return"function"==typeof e?"a function":sp()}function Tw(e,t){if("_delegate"in e&&(e=e._delegate),!(e instanceof t)){if(t.name===e.constructor.name)throw new dp(up.INVALID_ARGUMENT,"Type does not match the expected instance. Did you pass a reference from a different Firestore SDK?");{const n=kw(e);throw new dp(up.INVALID_ARGUMENT,"Expected type '".concat(t.name,"', but it was: ").concat(n))}}return e}class Iw{constructor(e){var t,n;if(void 0===e.host){if(void 0!==e.ssl)throw new dp(up.INVALID_ARGUMENT,"Can't provide ssl option if host option is not set");this.host="firestore.googleapis.com",this.ssl=!0}else this.host=e.host,this.ssl=null===(t=e.ssl)||void 0===t||t;if(this.credentials=e.credentials,this.ignoreUndefinedProperties=!!e.ignoreUndefinedProperties,this.localCache=e.localCache,void 0===e.cacheSizeBytes)this.cacheSizeBytes=41943040;else{if(-1!==e.cacheSizeBytes&&e.cacheSizeBytes<1048576)throw new dp(up.INVALID_ARGUMENT,"cacheSizeBytes must be at least 1048576");this.cacheSizeBytes=e.cacheSizeBytes}(function(e,t,n,r){if(!0===t&&!0===r)throw new dp(up.INVALID_ARGUMENT,"".concat(e," and ").concat(n," cannot be used together."))})("experimentalForceLongPolling",e.experimentalForceLongPolling,"experimentalAutoDetectLongPolling",e.experimentalAutoDetectLongPolling),this.experimentalForceLongPolling=!!e.experimentalForceLongPolling,this.experimentalForceLongPolling?this.experimentalAutoDetectLongPolling=!1:void 0===e.experimentalAutoDetectLongPolling?this.experimentalAutoDetectLongPolling=!0:this.experimentalAutoDetectLongPolling=!!e.experimentalAutoDetectLongPolling,this.experimentalLongPollingOptions=bw(null!==(n=e.experimentalLongPollingOptions)&&void 0!==n?n:{}),function(e){if(void 0!==e.timeoutSeconds){if(isNaN(e.timeoutSeconds))throw new dp(up.INVALID_ARGUMENT,"invalid long polling timeout: ".concat(e.timeoutSeconds," (must not be NaN)"));if(e.timeoutSeconds<5)throw new dp(up.INVALID_ARGUMENT,"invalid long polling timeout: ".concat(e.timeoutSeconds," (minimum allowed value is 5)"));if(e.timeoutSeconds>30)throw new dp(up.INVALID_ARGUMENT,"invalid long polling timeout: ".concat(e.timeoutSeconds," (maximum allowed value is 30)"))}}(this.experimentalLongPollingOptions),this.useFetchStreams=!!e.useFetchStreams}isEqual(e){return this.host===e.host&&this.ssl===e.ssl&&this.credentials===e.credentials&&this.cacheSizeBytes===e.cacheSizeBytes&&this.experimentalForceLongPolling===e.experimentalForceLongPolling&&this.experimentalAutoDetectLongPolling===e.experimentalAutoDetectLongPolling&&function(e,t){return e.timeoutSeconds===t.timeoutSeconds}(this.experimentalLongPollingOptions,e.experimentalLongPollingOptions)&&this.ignoreUndefinedProperties===e.ignoreUndefinedProperties&&this.useFetchStreams===e.useFetchStreams}}class Cw{constructor(e,t,n,r){this._authCredentials=e,this._appCheckCredentials=t,this._databaseId=n,this._app=r,this.type="firestore-lite",this._persistenceKey="(lite)",this._settings=new Iw({}),this._settingsFrozen=!1,this._terminateTask="notTerminated"}get app(){if(!this._app)throw new dp(up.FAILED_PRECONDITION,"Firestore was not initialized using the Firebase SDK. 'app' is not available");return this._app}get _initialized(){return this._settingsFrozen}get _terminated(){return"notTerminated"!==this._terminateTask}_setSettings(e){if(this._settingsFrozen)throw new dp(up.FAILED_PRECONDITION,"Firestore has already been started and its settings can no longer be changed. You can only modify settings before calling any other methods on a Firestore object.");this._settings=new Iw(e),void 0!==e.credentials&&(this._authCredentials=function(e){if(!e)return new pp;switch(e.type){case"firstParty":return new vp(e.sessionIndex||"0",e.iamToken||null,e.authTokenFactory||null);case"provider":return e.client;default:throw new dp(up.INVALID_ARGUMENT,"makeAuthCredentialsProvider failed due to invalid credential type")}}(e.credentials))}_getSettings(){return this._settings}_freezeSettings(){return this._settingsFrozen=!0,this._settings}_delete(){return"notTerminated"===this._terminateTask&&(this._terminateTask=this._terminate()),this._terminateTask}async _restart(){"notTerminated"===this._terminateTask?await this._terminate():this._terminateTask="notTerminated"}toJSON(){return{app:this._app,databaseId:this._databaseId,settings:this._settings}}_terminate(){return function(e){const t=_w.get(e);t&&(rp("ComponentProvider","Removing Datastore"),_w.delete(e),t.terminate())}(this),Promise.resolve()}}class Aw{constructor(e,t,n){this.converter=t,this._query=n,this.type="query",this.firestore=e}withConverter(e){return new Aw(this.firestore,e,this._query)}}class Ow{constructor(e,t,n){this.converter=t,this._key=n,this.type="document",this.firestore=e}get _path(){return this._key.path}get id(){return this._key.path.lastSegment()}get path(){return this._key.path.canonicalString()}get parent(){return new Nw(this.firestore,this.converter,this._key.path.popLast())}withConverter(e){return new Ow(this.firestore,e,this._key)}}class Nw extends Aw{constructor(e,t,n){super(e,t,lg(n)),this._path=n,this.type="collection"}get id(){return this._query.path.lastSegment()}get path(){return this._query.path.canonicalString()}get parent(){const e=this._path.popLast();return e.isEmpty()?null:new Ow(this.firestore,null,new Np(e))}withConverter(e){return new Nw(this.firestore,e,this._path)}}class Rw{constructor(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:Promise.resolve();this.Pu=[],this.Iu=!1,this.Tu=[],this.Eu=null,this.du=!1,this.Au=!1,this.Ru=[],this.t_=new Iv(this,"async_queue_retry"),this.Vu=()=>{const e=kv();e&&rp("AsyncQueue","Visibility state changed to "+e.visibilityState),this.t_.jo()},this.mu=e;const t=kv();t&&"function"==typeof t.addEventListener&&t.addEventListener("visibilitychange",this.Vu)}get isShuttingDown(){return this.Iu}enqueueAndForget(e){this.enqueue(e)}enqueueAndForgetEvenWhileRestricted(e){this.fu(),this.gu(e)}enterRestrictedMode(e){if(!this.Iu){this.Iu=!0,this.Au=e||!1;const t=kv();t&&"function"==typeof t.removeEventListener&&t.removeEventListener("visibilitychange",this.Vu)}}enqueue(e){if(this.fu(),this.Iu)return new Promise(()=>{});const t=new hp;return this.gu(()=>this.Iu&&this.Au?Promise.resolve():(e().then(t.resolve,t.reject),t.promise)).then(()=>t.promise)}enqueueRetryable(e){this.enqueueAndForget(()=>(this.Pu.push(e),this.pu()))}async pu(){if(0!==this.Pu.length){try{await this.Pu[0](),this.Pu.shift(),this.t_.reset()}catch(S_){if(!Vp(S_))throw S_;rp("AsyncQueue","Operation failed with retryable error: "+S_)}this.Pu.length>0&&this.t_.Go(()=>this.pu())}}gu(e){const t=this.mu.then(()=>(this.du=!0,e().catch(e=>{this.Eu=e,this.du=!1;const t=function(e){let t=e.message||"";return e.stack&&(t=e.stack.includes(e.message)?e.stack:e.message+"\n"+e.stack),t}(e);throw ip("INTERNAL UNHANDLED ERROR: ",t),e}).then(e=>(this.du=!1,e))));return this.mu=t,t}enqueueAfterDelay(e,t,n){this.fu(),this.Ru.indexOf(e)>-1&&(t=0);const r=Yv.createAndSchedule(this,e,t,n,e=>this.yu(e));return this.Tu.push(r),r}fu(){this.Eu&&sp()}verifyOperationInProgress(){}async wu(){let e;do{e=this.mu,await e}while(e!==this.mu)}Su(e){for(const t of this.Tu)if(t.timerId===e)return!0;return!1}bu(e){return this.wu().then(()=>{this.Tu.sort((e,t)=>e.targetTimeMs-t.targetTimeMs);for(const t of this.Tu)if(t.skipDelay(),"all"!==e&&t.timerId===e)break;return this.wu()})}Du(e){this.Ru.push(e)}yu(e){const t=this.Tu.indexOf(e);this.Tu.splice(t,1)}}class Pw extends Cw{constructor(e,t,n,r){super(e,t,n,r),this.type="firestore",this._queue=new Rw,this._persistenceKey=(null==r?void 0:r.name)||"[DEFAULT]"}async _terminate(){if(this._firestoreClient){const e=this._firestoreClient.terminate();this._queue=new Rw(e),this._firestoreClient=void 0,await e}}}function Dw(e){if(e._terminated)throw new dp(up.FAILED_PRECONDITION,"The client has already been terminated.");return e._firestoreClient||zw(e),e._firestoreClient}function zw(e){var t,n,r;const i=e._freezeSettings(),a=function(e,t,n,r){return new mm(e,t,n,r.host,r.ssl,r.experimentalForceLongPolling,r.experimentalAutoDetectLongPolling,bw(r.experimentalLongPollingOptions),r.useFetchStreams)}(e._databaseId,(null===(t=e._app)||void 0===t?void 0:t.options.appId)||"",e._persistenceKey,i);e._componentsProvider||(null===(n=i.localCache)||void 0===n?void 0:n._offlineComponentProvider)&&(null===(r=i.localCache)||void 0===r?void 0:r._onlineComponentProvider)&&(e._componentsProvider={_offline:i.localCache._offlineComponentProvider,_online:i.localCache._onlineComponentProvider}),e._firestoreClient=new pw(e._authCredentials,e._appCheckCredentials,e._queue,a,e._componentsProvider&&function(e){const t=null==e?void 0:e._online.build();return{_offline:null==e?void 0:e._offline.build(t),_online:t}}(e._componentsProvider))}class Mw{constructor(e){this._byteString=e}static fromBase64String(e){try{return new Mw(sm.fromBase64String(e))}catch(e){throw new dp(up.INVALID_ARGUMENT,"Failed to construct data from Base64 string: "+e)}}static fromUint8Array(e){return new Mw(sm.fromUint8Array(e))}toBase64(){return this._byteString.toBase64()}toUint8Array(){return this._byteString.toUint8Array()}toString(){return"Bytes(base64: "+this.toBase64()+")"}isEqual(e){return this._byteString.isEqual(e._byteString)}}class Lw{constructor(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];for(let r=0;r<t.length;++r)if(0===t[r].length)throw new dp(up.INVALID_ARGUMENT,"Invalid field name at argument $(i + 1). Field names must not be empty.");this._internalPath=new Op(t)}isEqual(e){return this._internalPath.isEqual(e._internalPath)}}class Uw{constructor(e){this._methodName=e}}class Bw{constructor(e,t){if(!isFinite(e)||e<-90||e>90)throw new dp(up.INVALID_ARGUMENT,"Latitude must be a number between -90 and 90, but was: "+e);if(!isFinite(t)||t<-180||t>180)throw new dp(up.INVALID_ARGUMENT,"Longitude must be a number between -180 and 180, but was: "+t);this._lat=e,this._long=t}get latitude(){return this._lat}get longitude(){return this._long}isEqual(e){return this._lat===e._lat&&this._long===e._long}toJSON(){return{latitude:this._lat,longitude:this._long}}_compareTo(e){return Ep(this._lat,e._lat)||Ep(this._long,e._long)}}class Fw{constructor(e){this._values=(e||[]).map(e=>e)}toArray(){return this._values.map(e=>e)}isEqual(e){return function(e,t){if(e.length!==t.length)return!1;for(let n=0;n<e.length;++n)if(e[n]!==t[n])return!1;return!0}(this._values,e._values)}}const jw=/^__.*__$/;class Vw{constructor(e,t,n){this.data=e,this.fieldMask=t,this.fieldTransforms=n}toMutation(e,t){return null!==this.fieldMask?new sy(e,this.data,this.fieldMask,t,this.fieldTransforms):new oy(e,this.data,t,this.fieldTransforms)}}function qw(e){switch(e){case 0:case 2:case 1:return!0;case 3:case 4:return!1;default:throw sp()}}class Hw{constructor(e,t,n,r,i,a){this.settings=e,this.databaseId=t,this.serializer=n,this.ignoreUndefinedProperties=r,void 0===i&&this.vu(),this.fieldTransforms=i||[],this.fieldMask=a||[]}get path(){return this.settings.path}get Cu(){return this.settings.Cu}Fu(e){return new Hw(Object.assign(Object.assign({},this.settings),e),this.databaseId,this.serializer,this.ignoreUndefinedProperties,this.fieldTransforms,this.fieldMask)}Mu(e){var t;const n=null===(t=this.path)||void 0===t?void 0:t.child(e),r=this.Fu({path:n,xu:!1});return r.Ou(e),r}Nu(e){var t;const n=null===(t=this.path)||void 0===t?void 0:t.child(e),r=this.Fu({path:n,xu:!1});return r.vu(),r}Lu(e){return this.Fu({path:void 0,xu:!0})}Bu(e){return tb(e,this.settings.methodName,this.settings.ku||!1,this.path,this.settings.qu)}contains(e){return void 0!==this.fieldMask.find(t=>e.isPrefixOf(t))||void 0!==this.fieldTransforms.find(t=>e.isPrefixOf(t.field))}vu(){if(this.path)for(let e=0;e<this.path.length;e++)this.Ou(this.path.get(e))}Ou(e){if(0===e.length)throw this.Bu("Document fields must not be empty");if(qw(this.Cu)&&jw.test(e))throw this.Bu('Document fields cannot begin and end with "__"')}}class Ww{constructor(e,t,n){this.databaseId=e,this.ignoreUndefinedProperties=t,this.serializer=n||Tv(e)}Qu(e,t,n){let r=arguments.length>3&&void 0!==arguments[3]&&arguments[3];return new Hw({Cu:e,methodName:t,qu:n,path:Op.emptyPath(),xu:!1,ku:r},this.databaseId,this.serializer,this.ignoreUndefinedProperties)}}function Gw(e){const t=e._freezeSettings(),n=Tv(e._databaseId);return new Ww(e._databaseId,!!t.ignoreUndefinedProperties,n)}function Kw(e,t,n,r,i){let a=arguments.length>5&&void 0!==arguments[5]?arguments[5]:{};const o=e.Qu(a.merge||a.mergeFields?2:0,t,n,i);Jw("Data must be an object, but it was:",o,r);const s=Xw(r,o);let c,l;if(a.merge)c=new am(o.fieldMask),l=o.fieldTransforms;else if(a.mergeFields){const e=[];for(const r of a.mergeFields){const i=$w(t,r,n);if(!o.contains(i))throw new dp(up.INVALID_ARGUMENT,"Field '".concat(i,"' is specified in your field mask but missing from your input data."));nb(e,i)||e.push(i)}c=new am(e),l=o.fieldTransforms.filter(e=>c.covers(e.field))}else c=null,l=o.fieldTransforms;return new Vw(new Rm(s),c,l)}function Qw(e,t){if(Yw(e=lh(e)))return Jw("Unsupported field value:",t,e),Xw(e,t);if(e instanceof Uw)return function(e,t){if(!qw(t.Cu))throw t.Bu("".concat(e._methodName,"() can only be used with update() and set()"));if(!t.path)throw t.Bu("".concat(e._methodName,"() is not currently supported inside arrays"));const n=e._toFieldTransform(t);n&&t.fieldTransforms.push(n)}(e,t),null;if(void 0===e&&t.ignoreUndefinedProperties)return null;if(t.path&&t.fieldMask.push(t.path),e instanceof Array){if(t.settings.xu&&4!==t.Cu)throw t.Bu("Nested arrays are not supported");return function(e,t){const n=[];let r=0;for(const i of e){let e=Qw(i,t.Lu(r));null==e&&(e={nullValue:"NULL_VALUE"}),n.push(e),r++}return{arrayValue:{values:n}}}(e,t)}return function(e,t){if(null===(e=lh(e)))return{nullValue:"NULL_VALUE"};if("number"==typeof e)return Ug(t.serializer,e);if("boolean"==typeof e)return{booleanValue:e};if("string"==typeof e)return{stringValue:e};if(e instanceof Date){const n=kp.fromDate(e);return{timestampValue:_y(t.serializer,n)}}if(e instanceof kp){const n=new kp(e.seconds,1e3*Math.floor(e.nanoseconds/1e3));return{timestampValue:_y(t.serializer,n)}}if(e instanceof Bw)return{geoPointValue:{latitude:e.latitude,longitude:e.longitude}};if(e instanceof Mw)return{bytesValue:xy(t.serializer,e._byteString)};if(e instanceof Ow){const n=t.databaseId,r=e.firestore._databaseId;if(!r.isEqual(n))throw t.Bu("Document reference is for database ".concat(r.projectId,"/").concat(r.database," but should be for database ").concat(n.projectId,"/").concat(n.database));return{referenceValue:ky(e.firestore._databaseId||t.databaseId,e._key.path)}}if(e instanceof Fw)return function(e,t){return{mapValue:{fields:{__type__:{stringValue:"__vector__"},value:{arrayValue:{values:e.toArray().map(e=>{if("number"!=typeof e)throw t.Bu("VectorValues must only contain numeric values.");return Mg(t.serializer,e)})}}}}}}(e,t);throw t.Bu("Unsupported field value: ".concat(kw(e)))}(e,t)}function Xw(e,t){const n={};return Zp(e)?t.path&&t.path.length>0&&t.fieldMask.push(t.path):$p(e,(e,r)=>{const i=Qw(r,t.Mu(e));null!=i&&(n[e]=i)}),{mapValue:{fields:n}}}function Yw(e){return!("object"!=typeof e||null===e||e instanceof Array||e instanceof Date||e instanceof kp||e instanceof Bw||e instanceof Mw||e instanceof Ow||e instanceof Uw||e instanceof Fw)}function Jw(e,t,n){if(!Yw(n)||!function(e){return"object"==typeof e&&null!==e&&(Object.getPrototypeOf(e)===Object.prototype||null===Object.getPrototypeOf(e))}(n)){const r=kw(n);throw"an object"===r?t.Bu(e+" a custom object"):t.Bu(e+" "+r)}}function $w(e,t,n){if((t=lh(t))instanceof Lw)return t._internalPath;if("string"==typeof t)return eb(e,t);throw tb("Field path arguments must be of type string or ",e,!1,void 0,n)}const Zw=new RegExp("[~\\*/\\[\\]]");function eb(e,t,n){if(t.search(Zw)>=0)throw tb("Invalid field path (".concat(t,"). Paths must not contain '~', '*', '/', '[', or ']'"),e,!1,void 0,n);try{return new Lw(...t.split("."))._internalPath}catch(C_){throw tb("Invalid field path (".concat(t,"). Paths must not be empty, begin with '.', end with '.', or contain '..'"),e,!1,void 0,n)}}function tb(e,t,n,r,i){const a=r&&!r.isEmpty(),o=void 0!==i;let s="Function ".concat(t,"() called with invalid data");n&&(s+=" (via `toFirestore()`)"),s+=". ";let c="";return(a||o)&&(c+=" (found",a&&(c+=" in field ".concat(r)),o&&(c+=" in document ".concat(i)),c+=")"),new dp(up.INVALID_ARGUMENT,s+e+c)}function nb(e,t){return e.some(e=>e.isEqual(t))}function rb(e,t,n){let r;return r=e?n&&(n.merge||n.mergeFields)?e.toFirestore(t,n):e.toFirestore(t):t,r}function ib(e,t){const n=Tw(e.firestore,Pw),r=function(e,t){for(var n=arguments.length,r=new Array(n>2?n-2:0),i=2;i<n;i++)r[i-2]=arguments[i];if(e=lh(e),1===arguments.length&&(t=xp.newId()),xw("doc","path",t),e instanceof Cw){const n=Cp.fromString(t,...r);return Ew(n),new Ow(e,null,new Np(n))}{if(!(e instanceof Ow||e instanceof Nw))throw new dp(up.INVALID_ARGUMENT,"Expected first argument to collection() to be a CollectionReference, a DocumentReference or FirebaseFirestore");const n=e._path.child(Cp.fromString(t,...r));return Ew(n),new Ow(e.firestore,e instanceof Nw?e.converter:null,new Np(n))}}(e),i=rb(e.converter,t);return ab(n,[Kw(Gw(e.firestore),"addDoc",r._key,i,null!==e.converter,{}).toMutation(r._key,$g.exists(!1))]).then(()=>r)}function ab(e,t){return function(e,t){const n=new hp;return e.asyncQueue.enqueueAndForget(async()=>async function(e,t,n){const r=dw(e);try{const e=await function(e,t){const n=lp(e),r=kp.now(),i=t.reduce((e,t)=>e.add(t.key),Pg());let a,o;return n.persistence.runTransaction("Locally write mutations","readwrite",e=>{let s=Sg(),c=Pg();return n.cs.getEntries(e,i).next(e=>{s=e,s.forEach((e,t)=>{t.isValidDocument()||(c=c.add(e))})}).next(()=>n.localDocuments.getOverlayedDocuments(e,s)).next(i=>{a=i;const o=[];for(const e of t){const t=iy(e,a.get(e.key).overlayedDocument);null!=t&&o.push(new sy(e.key,t,Pm(t.value.mapValue),$g.exists(!0)))}return n.mutationQueue.addMutationBatch(e,r,o,t)}).next(t=>{o=t;const r=t.applyToLocalDocumentSet(a,c);return n.documentOverlayCache.saveOverlays(e,t.batchId,r)})}).then(()=>({batchId:o.batchId,changes:Ig(a)}))}(r.localStore,t);r.sharedClientState.addPendingMutation(e.batchId),function(e,t,n){let r=e.Ba[e.currentUser.toKey()];r||(r=new em(Ep)),r=r.insert(t,n),e.Ba[e.currentUser.toKey()]=r}(r,e.batchId,n),await lw(r,e.changes),await Uv(r.remoteStore)}catch(e){const t=Jv(e,"Failed to persist write");n.reject(t)}}(await ww(e),t,n)),n.promise}(Dw(e),t)}new WeakMap;!function(e){let t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];!function(e){ep=e}(kf),bf(new uh("firestore",(e,n)=>{let{instanceIdentifier:r,options:i}=n;const a=e.getProvider("app").getImmediate(),o=new Pw(new gp(e.getProvider("auth-internal")),new bp(e.getProvider("app-check-internal")),function(e,t){if(!Object.prototype.hasOwnProperty.apply(e.options,["projectId"]))throw new dp(up.INVALID_ARGUMENT,'"projectId" not provided in firebase.initializeApp.');return new gm(e.options.projectId,t)}(a,r),a);return i=Object.assign({useFetchStreams:t},i),o._setSettings(i),o},"PUBLIC").setMultipleInstances(!0)),Cf($f,"4.7.3",e),Cf($f,"4.7.3","esm2017")}();const ob="firebasestorage.googleapis.com",sb="storageBucket";class cb extends Zd{constructor(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;super(db(e),"Firebase Storage: ".concat(t," (").concat(db(e),")")),this.status_=n,this.customData={serverResponse:null},this._baseMessage=this.message,Object.setPrototypeOf(this,cb.prototype)}get status(){return this.status_}set status(e){this.status_=e}_codeEquals(e){return db(e)===this.code}get serverResponse(){return this.customData.serverResponse}set serverResponse(e){this.customData.serverResponse=e,this.customData.serverResponse?this.message="".concat(this._baseMessage,"\n").concat(this.customData.serverResponse):this.message=this._baseMessage}}var lb,ub;function db(e){return"storage/"+e}function hb(){return new cb(lb.UNKNOWN,"An unknown error occurred, please check the error payload for server response.")}function fb(){return new cb(lb.RETRY_LIMIT_EXCEEDED,"Max retry time for operation exceeded, please try again.")}function pb(){return new cb(lb.CANCELED,"User canceled the upload/download.")}function mb(){return new cb(lb.CANNOT_SLICE_BLOB,"Cannot slice blob for upload. Please retry the upload.")}function gb(e){return new cb(lb.INVALID_ARGUMENT,e)}function yb(){return new cb(lb.APP_DELETED,"The Firebase app was deleted.")}function vb(e,t){return new cb(lb.INVALID_FORMAT,"String does not match format '"+e+"': "+t)}function wb(e){throw new cb(lb.INTERNAL_ERROR,"Internal error: "+e)}!function(e){e.UNKNOWN="unknown",e.OBJECT_NOT_FOUND="object-not-found",e.BUCKET_NOT_FOUND="bucket-not-found",e.PROJECT_NOT_FOUND="project-not-found",e.QUOTA_EXCEEDED="quota-exceeded",e.UNAUTHENTICATED="unauthenticated",e.UNAUTHORIZED="unauthorized",e.UNAUTHORIZED_APP="unauthorized-app",e.RETRY_LIMIT_EXCEEDED="retry-limit-exceeded",e.INVALID_CHECKSUM="invalid-checksum",e.CANCELED="canceled",e.INVALID_EVENT_NAME="invalid-event-name",e.INVALID_URL="invalid-url",e.INVALID_DEFAULT_BUCKET="invalid-default-bucket",e.NO_DEFAULT_BUCKET="no-default-bucket",e.CANNOT_SLICE_BLOB="cannot-slice-blob",e.SERVER_FILE_WRONG_SIZE="server-file-wrong-size",e.NO_DOWNLOAD_URL="no-download-url",e.INVALID_ARGUMENT="invalid-argument",e.INVALID_ARGUMENT_COUNT="invalid-argument-count",e.APP_DELETED="app-deleted",e.INVALID_ROOT_OPERATION="invalid-root-operation",e.INVALID_FORMAT="invalid-format",e.INTERNAL_ERROR="internal-error",e.UNSUPPORTED_ENVIRONMENT="unsupported-environment"}(lb||(lb={}));class bb{constructor(e,t){this.bucket=e,this.path_=t}get path(){return this.path_}get isRoot(){return 0===this.path.length}fullServerUrl(){const e=encodeURIComponent;return"/b/"+e(this.bucket)+"/o/"+e(this.path)}bucketOnlyServerUrl(){return"/b/"+encodeURIComponent(this.bucket)+"/o"}static makeFromBucketSpec(e,t){let n;try{n=bb.makeFromUrl(e,t)}catch(S_){return new bb(e,"")}if(""===n.path)return n;throw r=e,new cb(lb.INVALID_DEFAULT_BUCKET,"Invalid default bucket '"+r+"'.");var r}static makeFromUrl(e,t){let n=null;const r="([A-Za-z0-9.\\-_]+)";const i=new RegExp("^gs://"+r+"(/(.*))?$","i");function a(e){e.path_=decodeURIComponent(e.path)}const o=t.replace(/[.]/g,"\\."),s=[{regex:i,indices:{bucket:1,path:3},postModify:function(e){"/"===e.path.charAt(e.path.length-1)&&(e.path_=e.path_.slice(0,-1))}},{regex:new RegExp("^https?://".concat(o,"/").concat("v[A-Za-z0-9_]+","/b/").concat(r,"/o").concat("(/([^?#]*).*)?$"),"i"),indices:{bucket:1,path:3},postModify:a},{regex:new RegExp("^https?://".concat(t===ob?"(?:storage.googleapis.com|storage.cloud.google.com)":t,"/").concat(r,"/").concat("([^?#]*)"),"i"),indices:{bucket:1,path:2},postModify:a}];for(let c=0;c<s.length;c++){const t=s[c],r=t.regex.exec(e);if(r){const e=r[t.indices.bucket];let i=r[t.indices.path];i||(i=""),n=new bb(e,i),t.postModify(n);break}}if(null==n)throw function(e){return new cb(lb.INVALID_URL,"Invalid URL '"+e+"'.")}(e);return n}}class _b{constructor(e){this.promise_=Promise.reject(e)}getPromise(){return this.promise_}cancel(){}}function xb(e){return"string"===typeof e||e instanceof String}function Eb(e){return Sb()&&e instanceof Blob}function Sb(){return"undefined"!==typeof Blob}function kb(e,t,n,r){if(r<t)throw gb("Invalid value for '".concat(e,"'. Expected ").concat(t," or greater."));if(r>n)throw gb("Invalid value for '".concat(e,"'. Expected ").concat(n," or less."))}function Tb(e,t,n){let r=t;return null==n&&(r="https://".concat(t)),"".concat(n,"://").concat(r,"/v0").concat(e)}function Ib(e){const t=encodeURIComponent;let n="?";for(const r in e)if(e.hasOwnProperty(r)){n=n+(t(r)+"="+t(e[r]))+"&"}return n=n.slice(0,-1),n}function Cb(e,t){const n=e>=500&&e<600,r=-1!==[408,429].indexOf(e),i=-1!==t.indexOf(e);return n||r||i}!function(e){e[e.NO_ERROR=0]="NO_ERROR",e[e.NETWORK_ERROR=1]="NETWORK_ERROR",e[e.ABORT=2]="ABORT"}(ub||(ub={}));class Ab{constructor(e,t,n,r,i,a,o,s,c,l,u){let d=!(arguments.length>11&&void 0!==arguments[11])||arguments[11];this.url_=e,this.method_=t,this.headers_=n,this.body_=r,this.successCodes_=i,this.additionalRetryCodes_=a,this.callback_=o,this.errorCallback_=s,this.timeout_=c,this.progressCallback_=l,this.connectionFactory_=u,this.retry=d,this.pendingConnection_=null,this.backoffId_=null,this.canceled_=!1,this.appDelete_=!1,this.promise_=new Promise((e,t)=>{this.resolve_=e,this.reject_=t,this.start_()})}start_(){const e=(e,t)=>{if(t)return void e(!1,new Ob(!1,null,!0));const n=this.connectionFactory_();this.pendingConnection_=n;const r=e=>{const t=e.loaded,n=e.lengthComputable?e.total:-1;null!==this.progressCallback_&&this.progressCallback_(t,n)};null!==this.progressCallback_&&n.addUploadProgressListener(r),n.send(this.url_,this.method_,this.body_,this.headers_).then(()=>{null!==this.progressCallback_&&n.removeUploadProgressListener(r),this.pendingConnection_=null;const t=n.getErrorCode()===ub.NO_ERROR,i=n.getStatus();if(!t||Cb(i,this.additionalRetryCodes_)&&this.retry){const t=n.getErrorCode()===ub.ABORT;return void e(!1,new Ob(!1,null,t))}const a=-1!==this.successCodes_.indexOf(i);e(!0,new Ob(a,n))})},t=(e,t)=>{const n=this.resolve_,r=this.reject_,i=t.connection;if(t.wasSuccessCode)try{const e=this.callback_(i,i.getResponse());void 0!==e?n(e):n()}catch(S_){r(S_)}else if(null!==i){const e=hb();e.serverResponse=i.getErrorText(),this.errorCallback_?r(this.errorCallback_(i,e)):r(e)}else if(t.canceled){r(this.appDelete_?yb():pb())}else{r(fb())}};this.canceled_?t(0,new Ob(!1,null,!0)):this.backoffId_=function(e,t,n){let r=1,i=null,a=null,o=!1,s=0;function c(){return 2===s}let l=!1;function u(){if(!l){l=!0;for(var e=arguments.length,n=new Array(e),r=0;r<e;r++)n[r]=arguments[r];t.apply(null,n)}}function d(t){i=setTimeout(()=>{i=null,e(f,c())},t)}function h(){a&&clearTimeout(a)}function f(e){if(l)return void h();for(var t=arguments.length,n=new Array(t>1?t-1:0),i=1;i<t;i++)n[i-1]=arguments[i];if(e)return h(),void u.call(null,e,...n);if(c()||o)return h(),void u.call(null,e,...n);let a;r<64&&(r*=2),1===s?(s=2,a=0):a=1e3*(r+Math.random()),d(a)}let p=!1;function m(e){p||(p=!0,h(),l||(null!==i?(e||(s=2),clearTimeout(i),d(0)):e||(s=1)))}return d(0),a=setTimeout(()=>{o=!0,m(!0)},n),m}(e,t,this.timeout_)}getPromise(){return this.promise_}cancel(e){this.canceled_=!0,this.appDelete_=e||!1,null!==this.backoffId_&&function(e){e(!1)}(this.backoffId_),null!==this.pendingConnection_&&this.pendingConnection_.abort()}}class Ob{constructor(e,t,n){this.wasSuccessCode=e,this.connection=t,this.canceled=!!n}}function Nb(){return"undefined"!==typeof BlobBuilder?BlobBuilder:"undefined"!==typeof WebKitBlobBuilder?WebKitBlobBuilder:void 0}function Rb(){const e=Nb();for(var t=arguments.length,n=new Array(t),r=0;r<t;r++)n[r]=arguments[r];if(void 0!==e){const t=new e;for(let e=0;e<n.length;e++)t.append(n[e]);return t.getBlob()}if(Sb())return new Blob(n);throw new cb(lb.UNSUPPORTED_ENVIRONMENT,"This browser doesn't seem to support creating Blobs")}function Pb(e){if("undefined"===typeof atob)throw t="base-64",new cb(lb.UNSUPPORTED_ENVIRONMENT,"".concat(t," is missing. Make sure to install the required polyfills. See https://firebase.google.com/docs/web/environments-js-sdk#polyfills for more information."));var t;return atob(e)}const Db="raw",zb="base64",Mb="base64url",Lb="data_url";class Ub{constructor(e,t){this.data=e,this.contentType=t||null}}function Bb(e,t){switch(e){case Db:return new Ub(Fb(t));case zb:case Mb:return new Ub(jb(e,t));case Lb:return new Ub(function(e){const t=new Vb(e);return t.base64?jb(zb,t.rest):function(e){let t;try{t=decodeURIComponent(e)}catch(S_){throw vb(Lb,"Malformed data URL.")}return Fb(t)}(t.rest)}(t),new Vb(t).contentType)}throw hb()}function Fb(e){const t=[];for(let n=0;n<e.length;n++){let r=e.charCodeAt(n);if(r<=127)t.push(r);else if(r<=2047)t.push(192|r>>6,128|63&r);else if(55296===(64512&r)){if(n<e.length-1&&56320===(64512&e.charCodeAt(n+1))){r=65536|(1023&r)<<10|1023&e.charCodeAt(++n),t.push(240|r>>18,128|r>>12&63,128|r>>6&63,128|63&r)}else t.push(239,191,189)}else 56320===(64512&r)?t.push(239,191,189):t.push(224|r>>12,128|r>>6&63,128|63&r)}return new Uint8Array(t)}function jb(e,t){switch(e){case zb:{const n=-1!==t.indexOf("-"),r=-1!==t.indexOf("_");if(n||r){throw vb(e,"Invalid character '"+(n?"-":"_")+"' found: is it base64url encoded?")}break}case Mb:{const n=-1!==t.indexOf("+"),r=-1!==t.indexOf("/");if(n||r){throw vb(e,"Invalid character '"+(n?"+":"/")+"' found: is it base64 encoded?")}t=t.replace(/-/g,"+").replace(/_/g,"/");break}}let n;try{n=Pb(t)}catch(S_){if(S_.message.includes("polyfill"))throw S_;throw vb(e,"Invalid character found")}const r=new Uint8Array(n.length);for(let i=0;i<n.length;i++)r[i]=n.charCodeAt(i);return r}class Vb{constructor(e){this.base64=!1,this.contentType=null;const t=e.match(/^data:([^,]+)?,/);if(null===t)throw vb(Lb,"Must be formatted 'data:[<mediatype>][;base64],<data>");const n=t[1]||null;null!=n&&(this.base64=function(e,t){const n=e.length>=t.length;if(!n)return!1;return e.substring(e.length-t.length)===t}(n,";base64"),this.contentType=this.base64?n.substring(0,n.length-7):n),this.rest=e.substring(e.indexOf(",")+1)}}class qb{constructor(e,t){let n=0,r="";Eb(e)?(this.data_=e,n=e.size,r=e.type):e instanceof ArrayBuffer?(t?this.data_=new Uint8Array(e):(this.data_=new Uint8Array(e.byteLength),this.data_.set(new Uint8Array(e))),n=this.data_.length):e instanceof Uint8Array&&(t?this.data_=e:(this.data_=new Uint8Array(e.length),this.data_.set(e)),n=e.length),this.size_=n,this.type_=r}size(){return this.size_}type(){return this.type_}slice(e,t){if(Eb(this.data_)){const n=function(e,t,n){return e.webkitSlice?e.webkitSlice(t,n):e.mozSlice?e.mozSlice(t,n):e.slice?e.slice(t,n):null}(this.data_,e,t);return null===n?null:new qb(n)}{const n=new Uint8Array(this.data_.buffer,e,t-e);return new qb(n,!0)}}static getBlob(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];if(Sb()){const e=t.map(e=>e instanceof qb?e.data_:e);return new qb(Rb.apply(null,e))}{const e=t.map(e=>xb(e)?Bb(Db,e).data:e.data_);let n=0;e.forEach(e=>{n+=e.byteLength});const r=new Uint8Array(n);let i=0;return e.forEach(e=>{for(let t=0;t<e.length;t++)r[i++]=e[t]}),new qb(r,!0)}}uploadData(){return this.data_}}function Hb(e){let t;try{t=JSON.parse(e)}catch(S_){return null}return"object"!==typeof(n=t)||Array.isArray(n)?null:t;var n}function Wb(e){const t=e.lastIndexOf("/",e.length-2);return-1===t?e:e.slice(t+1)}function Gb(e,t){return t}class Kb{constructor(e,t,n,r){this.server=e,this.local=t||e,this.writable=!!n,this.xform=r||Gb}}let Qb=null;function Xb(){if(Qb)return Qb;const e=[];e.push(new Kb("bucket")),e.push(new Kb("generation")),e.push(new Kb("metageneration")),e.push(new Kb("name","fullPath",!0));const t=new Kb("name");t.xform=function(e,t){return function(e){return!xb(e)||e.length<2?e:Wb(e)}(t)},e.push(t);const n=new Kb("size");return n.xform=function(e,t){return void 0!==t?Number(t):t},e.push(n),e.push(new Kb("timeCreated")),e.push(new Kb("updated")),e.push(new Kb("md5Hash",null,!0)),e.push(new Kb("cacheControl",null,!0)),e.push(new Kb("contentDisposition",null,!0)),e.push(new Kb("contentEncoding",null,!0)),e.push(new Kb("contentLanguage",null,!0)),e.push(new Kb("contentType",null,!0)),e.push(new Kb("metadata","customMetadata",!0)),Qb=e,Qb}function Yb(e,t,n){const r={type:"file"},i=n.length;for(let a=0;a<i;a++){const e=n[a];r[e.local]=e.xform(r,t[e.server])}return function(e,t){Object.defineProperty(e,"ref",{get:function(){const n=e.bucket,r=e.fullPath,i=new bb(n,r);return t._makeStorageReference(i)}})}(r,e),r}function Jb(e,t,n){const r=Hb(t);if(null===r)return null;return Yb(e,r,n)}function $b(e,t){const n={},r=t.length;for(let i=0;i<r;i++){const r=t[i];r.writable&&(n[r.server]=e[r.local])}return JSON.stringify(n)}class Zb{constructor(e,t,n,r){this.url=e,this.method=t,this.handler=n,this.timeout=r,this.urlParams={},this.headers={},this.body=null,this.errorHandler=null,this.progressCallback=null,this.successCodes=[200],this.additionalRetryCodes=[]}}function e_(e){if(!e)throw hb()}function t_(e,t){return function(n,r){const i=Jb(e,r,t);return e_(null!==i),i}}function n_(e,t){return function(n,r){const i=Jb(e,r,t);return e_(null!==i),function(e,t,n,r){const i=Hb(t);if(null===i)return null;if(!xb(i.downloadTokens))return null;const a=i.downloadTokens;if(0===a.length)return null;const o=encodeURIComponent;return a.split(",").map(t=>{const i=e.bucket,a=e.fullPath;return Tb("/b/"+o(i)+"/o/"+o(a),n,r)+Ib({alt:"media",token:t})})[0]}(i,r,e.host,e._protocol)}}function r_(e){return function(t,n){let r;var i,a;return 401===t.getStatus()?r=t.getErrorText().includes("Firebase App Check token is invalid")?new cb(lb.UNAUTHORIZED_APP,"This app does not have permission to access Firebase Storage on this project."):new cb(lb.UNAUTHENTICATED,"User is not authenticated, please authenticate using Firebase Authentication and try again."):402===t.getStatus()?(a=e.bucket,r=new cb(lb.QUOTA_EXCEEDED,"Quota for bucket '"+a+"' exceeded, please view quota on https://firebase.google.com/pricing/.")):403===t.getStatus()?(i=e.path,r=new cb(lb.UNAUTHORIZED,"User does not have permission to access '"+i+"'.")):r=n,r.status=t.getStatus(),r.serverResponse=n.serverResponse,r}}function i_(e){const t=r_(e);return function(n,r){let i=t(n,r);var a;return 404===n.getStatus()&&(a=e.path,i=new cb(lb.OBJECT_NOT_FOUND,"Object '"+a+"' does not exist.")),i.serverResponse=r.serverResponse,i}}function a_(e,t,n){const r=Object.assign({},n);return r.fullPath=e.path,r.size=t.size(),r.contentType||(r.contentType=function(e,t){return e&&e.contentType||t&&t.type()||"application/octet-stream"}(null,t)),r}function o_(e,t,n,r,i){const a=t.bucketOnlyServerUrl(),o={"X-Goog-Upload-Protocol":"multipart"};const s=function(){let e="";for(let t=0;t<2;t++)e+=Math.random().toString().slice(2);return e}();o["Content-Type"]="multipart/related; boundary="+s;const c=a_(t,r,i),l="--"+s+"\r\nContent-Type: application/json; charset=utf-8\r\n\r\n"+$b(c,n)+"\r\n--"+s+"\r\nContent-Type: "+c.contentType+"\r\n\r\n",u="\r\n--"+s+"--",d=qb.getBlob(l,r,u);if(null===d)throw mb();const h={name:c.fullPath},f=Tb(a,e.host,e._protocol),p=e.maxUploadRetryTime,m=new Zb(f,"POST",t_(e,n),p);return m.urlParams=h,m.headers=o,m.body=d.uploadData(),m.errorHandler=r_(t),m}class s_{constructor(){this.sent_=!1,this.xhr_=new XMLHttpRequest,this.initXhr(),this.errorCode_=ub.NO_ERROR,this.sendPromise_=new Promise(e=>{this.xhr_.addEventListener("abort",()=>{this.errorCode_=ub.ABORT,e()}),this.xhr_.addEventListener("error",()=>{this.errorCode_=ub.NETWORK_ERROR,e()}),this.xhr_.addEventListener("load",()=>{e()})})}send(e,t,n,r){if(this.sent_)throw wb("cannot .send() more than once");if(this.sent_=!0,this.xhr_.open(t,e,!0),void 0!==r)for(const i in r)r.hasOwnProperty(i)&&this.xhr_.setRequestHeader(i,r[i].toString());return void 0!==n?this.xhr_.send(n):this.xhr_.send(),this.sendPromise_}getErrorCode(){if(!this.sent_)throw wb("cannot .getErrorCode() before sending");return this.errorCode_}getStatus(){if(!this.sent_)throw wb("cannot .getStatus() before sending");try{return this.xhr_.status}catch(S_){return-1}}getResponse(){if(!this.sent_)throw wb("cannot .getResponse() before sending");return this.xhr_.response}getErrorText(){if(!this.sent_)throw wb("cannot .getErrorText() before sending");return this.xhr_.statusText}abort(){this.xhr_.abort()}getResponseHeader(e){return this.xhr_.getResponseHeader(e)}addUploadProgressListener(e){null!=this.xhr_.upload&&this.xhr_.upload.addEventListener("progress",e)}removeUploadProgressListener(e){null!=this.xhr_.upload&&this.xhr_.upload.removeEventListener("progress",e)}}class c_ extends s_{initXhr(){this.xhr_.responseType="text"}}function l_(){return new c_}class u_{constructor(e,t){this._service=e,this._location=t instanceof bb?t:bb.makeFromUrl(t,e.host)}toString(){return"gs://"+this._location.bucket+"/"+this._location.path}_newRef(e,t){return new u_(e,t)}get root(){const e=new bb(this._location.bucket,"");return this._newRef(this._service,e)}get bucket(){return this._location.bucket}get fullPath(){return this._location.path}get name(){return Wb(this._location.path)}get storage(){return this._service}get parent(){const e=function(e){if(0===e.length)return null;const t=e.lastIndexOf("/");return-1===t?"":e.slice(0,t)}(this._location.path);if(null===e)return null;const t=new bb(this._location.bucket,e);return new u_(this._service,t)}_throwIfRoot(e){if(""===this._location.path)throw function(e){return new cb(lb.INVALID_ROOT_OPERATION,"The operation '"+e+"' cannot be performed on a root reference, create a non-root reference using child, such as .child('file.png').")}(e)}}function d_(e,t,n){e._throwIfRoot("uploadBytes");const r=o_(e.storage,e._location,Xb(),new qb(t,!0),n);return e.storage.makeRequestWithTokens(r,l_).then(t=>({metadata:t,ref:e}))}function h_(e){e._throwIfRoot("getDownloadURL");const t=function(e,t,n){const r=Tb(t.fullServerUrl(),e.host,e._protocol),i=e.maxOperationRetryTime,a=new Zb(r,"GET",n_(e,n),i);return a.errorHandler=i_(t),a}(e.storage,e._location,Xb());return e.storage.makeRequestWithTokens(t,l_).then(e=>{if(null===e)throw new cb(lb.NO_DOWNLOAD_URL,"The given file does not have any download URLs.");return e})}function f_(e,t){const n=function(e,t){const n=t.split("/").filter(e=>e.length>0).join("/");return 0===e.length?n:e+"/"+n}(e._location.path,t),r=new bb(e._location.bucket,n);return new u_(e.storage,r)}function p_(e,t){if(e instanceof y_){const n=e;if(null==n._bucket)throw new cb(lb.NO_DEFAULT_BUCKET,"No default bucket found. Did you set the '"+sb+"' property when initializing the app?");const r=new u_(n,n._bucket);return null!=t?p_(r,t):r}return void 0!==t?f_(e,t):e}function m_(e,t){if(t&&/^[A-Za-z]+:\/\//.test(t)){if(e instanceof y_)return new u_(e,t);throw gb("To use ref(service, url), the first argument must be a Storage instance.")}return p_(e,t)}function g_(e,t){const n=null===t||void 0===t?void 0:t[sb];return null==n?null:bb.makeFromBucketSpec(n,e)}class y_{constructor(e,t,n,r,i){this.app=e,this._authProvider=t,this._appCheckProvider=n,this._url=r,this._firebaseVersion=i,this._bucket=null,this._host=ob,this._protocol="https",this._appId=null,this._deleted=!1,this._maxOperationRetryTime=12e4,this._maxUploadRetryTime=6e5,this._requests=new Set,this._bucket=null!=r?bb.makeFromBucketSpec(r,this._host):g_(this._host,this.app.options)}get host(){return this._host}set host(e){this._host=e,null!=this._url?this._bucket=bb.makeFromBucketSpec(this._url,e):this._bucket=g_(e,this.app.options)}get maxUploadRetryTime(){return this._maxUploadRetryTime}set maxUploadRetryTime(e){kb("time",0,Number.POSITIVE_INFINITY,e),this._maxUploadRetryTime=e}get maxOperationRetryTime(){return this._maxOperationRetryTime}set maxOperationRetryTime(e){kb("time",0,Number.POSITIVE_INFINITY,e),this._maxOperationRetryTime=e}async _getAuthToken(){if(this._overrideAuthToken)return this._overrideAuthToken;const e=this._authProvider.getImmediate({optional:!0});if(e){const t=await e.getToken();if(null!==t)return t.accessToken}return null}async _getAppCheckToken(){const e=this._appCheckProvider.getImmediate({optional:!0});if(e){return(await e.getToken()).token}return null}_delete(){return this._deleted||(this._deleted=!0,this._requests.forEach(e=>e.cancel()),this._requests.clear()),Promise.resolve()}_makeStorageReference(e){return new u_(this,e)}_makeRequest(e,t,n,r){let i=!(arguments.length>4&&void 0!==arguments[4])||arguments[4];if(this._deleted)return new _b(yb());{const a=function(e,t,n,r,i,a){let o=!(arguments.length>6&&void 0!==arguments[6])||arguments[6];const s=Ib(e.urlParams),c=e.url+s,l=Object.assign({},e.headers);return function(e,t){t&&(e["X-Firebase-GMPID"]=t)}(l,t),function(e,t){null!==t&&t.length>0&&(e.Authorization="Firebase "+t)}(l,n),function(e,t){e["X-Firebase-Storage-Version"]="webjs/"+(null!==t&&void 0!==t?t:"AppManager")}(l,a),function(e,t){null!==t&&(e["X-Firebase-AppCheck"]=t)}(l,r),new Ab(c,e.method,l,e.body,e.successCodes,e.additionalRetryCodes,e.handler,e.errorHandler,e.timeout,e.progressCallback,i,o)}(e,this._appId,n,r,t,this._firebaseVersion,i);return this._requests.add(a),a.getPromise().then(()=>this._requests.delete(a),()=>this._requests.delete(a)),a}}async makeRequestWithTokens(e,t){const[n,r]=await Promise.all([this._getAuthToken(),this._getAppCheckToken()]);return this._makeRequest(e,t,n,r).getPromise()}}const v_="@firebase/storage",w_="0.13.2",b_="storage";function __(e,t){let{instanceIdentifier:n}=t;const r=e.getProvider("app").getImmediate(),i=e.getProvider("auth-internal"),a=e.getProvider("app-check-internal");return new y_(r,i,a,n,kf)}function x_(e,t){return new Promise(function(n,r){let i;return E_(e).then(function(e){try{return i=e,n(new Blob([t.slice(0,2),i,t.slice(2)],{type:"image/jpeg"}))}catch(e){return r(e)}},r)})}bf(new uh(b_,__,"PUBLIC").setMultipleInstances(!0)),Cf(v_,w_,""),Cf(v_,w_,"esm2017");const E_=e=>new Promise((t,n)=>{const r=new FileReader;r.addEventListener("load",e=>{let{target:{result:r}}=e;const i=new DataView(r);let a=0;if(65496!==i.getUint16(a))return n("not a valid JPEG");for(a+=2;;){const e=i.getUint16(a);if(65498===e)break;const o=i.getUint16(a+2);if(65505===e&&1165519206===i.getUint32(a+4)){const e=a+10;let s;switch(i.getUint16(e)){case 18761:s=!0;break;case 19789:s=!1;break;default:return n("TIFF header contains invalid endian")}if(42!==i.getUint16(e+2,s))return n("TIFF header contains invalid version");const c=i.getUint32(e+4,s),l=e+c+2+12*i.getUint16(e+c,s);for(let t=e+c+2;t<l;t+=12)if(274==i.getUint16(t,s)){if(3!==i.getUint16(t+2,s))return n("Orientation data type is invalid");if(1!==i.getUint32(t+4,s))return n("Orientation data count is invalid");i.setUint16(t+8,1,s);break}return t(r.slice(a,a+2+o))}a+=2+o}return t(new Blob)}),r.readAsArrayBuffer(e)});var S_={},k_={get exports(){return S_},set exports(e){S_=e}};!function(){var e,t,n={};k_.exports=n,n.parse=function(e,t){for(var r=n.bin.readUshort,i=n.bin.readUint,a=0,o={},s=new Uint8Array(e),c=s.length-4;101010256!=i(s,c);)c--;a=c,a+=4;var l=r(s,a+=4);r(s,a+=2);var u=i(s,a+=2),d=i(s,a+=4);a+=4,a=d;for(var h=0;h<l;h++){i(s,a),a+=4,a+=4,a+=4,i(s,a+=4),u=i(s,a+=4);var f=i(s,a+=4),p=r(s,a+=4),m=r(s,a+2),g=r(s,a+4);a+=6;var y=i(s,a+=8);a+=4,a+=p+m+g,n._readLocal(s,y,o,u,f,t)}return o},n._readLocal=function(e,t,r,i,a,o){var s=n.bin.readUshort,c=n.bin.readUint;c(e,t),s(e,t+=4),s(e,t+=2);var l=s(e,t+=2);c(e,t+=2),c(e,t+=4),t+=4;var u=s(e,t+=8),d=s(e,t+=2);t+=2;var h=n.bin.readUTF8(e,t,u);if(t+=u,t+=d,o)r[h]={size:a,csize:i};else{var f=new Uint8Array(e.buffer,t);if(0==l)r[h]=new Uint8Array(f.buffer.slice(t,t+i));else{if(8!=l)throw"unknown compression method: "+l;var p=new Uint8Array(a);n.inflateRaw(f,p),r[h]=p}}},n.inflateRaw=function(e,t){return n.F.inflate(e,t)},n.inflate=function(e,t){return e[0],e[1],n.inflateRaw(new Uint8Array(e.buffer,e.byteOffset+2,e.length-6),t)},n.deflate=function(e,t){null==t&&(t={level:6});var r=0,i=new Uint8Array(50+Math.floor(1.1*e.length));i[r]=120,i[r+1]=156,r+=2,r=n.F.deflateRaw(e,i,r,t.level);var a=n.adler(e,0,e.length);return i[r+0]=a>>>24&255,i[r+1]=a>>>16&255,i[r+2]=a>>>8&255,i[r+3]=a>>>0&255,new Uint8Array(i.buffer,0,r+4)},n.deflateRaw=function(e,t){null==t&&(t={level:6});var r=new Uint8Array(50+Math.floor(1.1*e.length)),i=n.F.deflateRaw(e,r,i,t.level);return new Uint8Array(r.buffer,0,i)},n.encode=function(e,t){null==t&&(t=!1);var r=0,i=n.bin.writeUint,a=n.bin.writeUshort,o={};for(var s in e){var c=!n._noNeed(s)&&!t,l=e[s],u=n.crc.crc(l,0,l.length);o[s]={cpr:c,usize:l.length,crc:u,file:c?n.deflateRaw(l):l}}for(var s in o)r+=o[s].file.length+30+46+2*n.bin.sizeUTF8(s);r+=22;var d=new Uint8Array(r),h=0,f=[];for(var s in o){var p=o[s];f.push(h),h=n._writeHeader(d,h,s,p,0)}var m=0,g=h;for(var s in o)p=o[s],f.push(h),h=n._writeHeader(d,h,s,p,1,f[m++]);var y=h-g;return i(d,h,101010256),h+=4,a(d,h+=4,m),a(d,h+=2,m),i(d,h+=2,y),i(d,h+=4,g),h+=4,h+=2,d.buffer},n._noNeed=function(e){var t=e.split(".").pop().toLowerCase();return-1!="png,jpg,jpeg,zip".indexOf(t)},n._writeHeader=function(e,t,r,i,a,o){var s=n.bin.writeUint,c=n.bin.writeUshort,l=i.file;return s(e,t,0==a?67324752:33639248),t+=4,1==a&&(t+=2),c(e,t,20),c(e,t+=2,0),c(e,t+=2,i.cpr?8:0),s(e,t+=2,0),s(e,t+=4,i.crc),s(e,t+=4,l.length),s(e,t+=4,i.usize),c(e,t+=4,n.bin.sizeUTF8(r)),c(e,t+=2,0),t+=2,1==a&&(t+=2,t+=2,s(e,t+=6,o),t+=4),t+=n.bin.writeUTF8(e,t,r),0==a&&(e.set(l,t),t+=l.length),t},n.crc={table:function(){for(var e=new Uint32Array(256),t=0;t<256;t++){for(var n=t,r=0;r<8;r++)1&n?n=3988292384^n>>>1:n>>>=1;e[t]=n}return e}(),update:function(e,t,r,i){for(var a=0;a<i;a++)e=n.crc.table[255&(e^t[r+a])]^e>>>8;return e},crc:function(e,t,r){return 4294967295^n.crc.update(4294967295,e,t,r)}},n.adler=function(e,t,n){for(var r=1,i=0,a=t,o=t+n;a<o;){for(var s=Math.min(a+5552,o);a<s;)i+=r+=e[a++];r%=65521,i%=65521}return i<<16|r},n.bin={readUshort:function(e,t){return e[t]|e[t+1]<<8},writeUshort:function(e,t,n){e[t]=255&n,e[t+1]=n>>8&255},readUint:function(e,t){return 16777216*e[t+3]+(e[t+2]<<16|e[t+1]<<8|e[t])},writeUint:function(e,t,n){e[t]=255&n,e[t+1]=n>>8&255,e[t+2]=n>>16&255,e[t+3]=n>>24&255},readASCII:function(e,t,n){for(var r="",i=0;i<n;i++)r+=String.fromCharCode(e[t+i]);return r},writeASCII:function(e,t,n){for(var r=0;r<n.length;r++)e[t+r]=n.charCodeAt(r)},pad:function(e){return e.length<2?"0"+e:e},readUTF8:function(e,t,r){for(var i,a="",o=0;o<r;o++)a+="%"+n.bin.pad(e[t+o].toString(16));try{i=decodeURIComponent(a)}catch(i){return n.bin.readASCII(e,t,r)}return i},writeUTF8:function(e,t,n){for(var r=n.length,i=0,a=0;a<r;a++){var o=n.charCodeAt(a);if(0==(4294967168&o))e[t+i]=o,i++;else if(0==(4294965248&o))e[t+i]=192|o>>6,e[t+i+1]=128|63&o,i+=2;else if(0==(4294901760&o))e[t+i]=224|o>>12,e[t+i+1]=128|o>>6&63,e[t+i+2]=128|63&o,i+=3;else{if(0!=(4292870144&o))throw"e";e[t+i]=240|o>>18,e[t+i+1]=128|o>>12&63,e[t+i+2]=128|o>>6&63,e[t+i+3]=128|63&o,i+=4}}return i},sizeUTF8:function(e){for(var t=e.length,n=0,r=0;r<t;r++){var i=e.charCodeAt(r);if(0==(4294967168&i))n++;else if(0==(4294965248&i))n+=2;else if(0==(4294901760&i))n+=3;else{if(0!=(4292870144&i))throw"e";n+=4}}return n}},n.F={},n.F.deflateRaw=function(e,t,r,i){var a=[[0,0,0,0,0],[4,4,8,4,0],[4,5,16,8,0],[4,6,16,16,0],[4,10,16,32,0],[8,16,32,32,0],[8,16,128,128,0],[8,32,128,256,0],[32,128,258,1024,1],[32,258,258,4096,1]][i],o=n.F.U,s=n.F._goodIndex;n.F._hash;var c=n.F._putsE,l=0,u=r<<3,d=0,h=e.length;if(0==i){for(;l<h;)c(t,u,l+(S=Math.min(65535,h-l))==h?1:0),u=n.F._copyExact(e,l,S,t,u+8),l+=S;return u>>>3}var f=o.lits,p=o.strt,m=o.prev,g=0,y=0,v=0,w=0,b=0,_=0;for(h>2&&(p[_=n.F._hash(e,0)]=0),l=0;l<h;l++){if(b=_,l+1<h-2){_=n.F._hash(e,l+1);var x=l+1&32767;m[x]=p[_],p[_]=x}if(d<=l){(g>14e3||y>26697)&&h-l>100&&(d<l&&(f[g]=l-d,g+=2,d=l),u=n.F._writeBlock(l==h-1||d==h?1:0,f,g,w,e,v,l-v,t,u),g=y=w=0,v=l);var E=0;l<h-2&&(E=n.F._bestMatch(e,l,m,b,Math.min(a[2],h-l),a[3]));var S=E>>>16,k=65535&E;if(0!=E){k=65535&E;var T=s(S=E>>>16,o.of0);o.lhst[257+T]++;var I=s(k,o.df0);o.dhst[I]++,w+=o.exb[T]+o.dxb[I],f[g]=S<<23|l-d,f[g+1]=k<<16|T<<8|I,g+=2,d=l+S}else o.lhst[e[l]]++;y++}}for(v==l&&0!=e.length||(d<l&&(f[g]=l-d,g+=2,d=l),u=n.F._writeBlock(1,f,g,w,e,v,l-v,t,u),g=0,y=0,g=y=w=0,v=l);0!=(7&u);)u++;return u>>>3},n.F._bestMatch=function(e,t,r,i,a,o){var s=32767&t,c=r[s],l=s-c+32768&32767;if(c==s||i!=n.F._hash(e,t-l))return 0;for(var u=0,d=0,h=Math.min(32767,t);l<=h&&0!=--o&&c!=s;){if(0==u||e[t+u]==e[t+u-l]){var f=n.F._howLong(e,t,l);if(f>u){if(d=l,(u=f)>=a)break;l+2<f&&(f=l+2);for(var p=0,m=0;m<f-2;m++){var g=t-l+m+32768&32767,y=g-r[g]+32768&32767;y>p&&(p=y,c=g)}}}l+=(s=c)-(c=r[s])+32768&32767}return u<<16|d},n.F._howLong=function(e,t,n){if(e[t]!=e[t-n]||e[t+1]!=e[t+1-n]||e[t+2]!=e[t+2-n])return 0;var r=t,i=Math.min(e.length,t+258);for(t+=3;t<i&&e[t]==e[t-n];)t++;return t-r},n.F._hash=function(e,t){return(e[t]<<8|e[t+1])+(e[t+2]<<4)&65535},n.saved=0,n.F._writeBlock=function(e,t,r,i,a,o,s,c,l){var u,d,h,f,p,m,g,y,v,w=n.F.U,b=n.F._putsF,_=n.F._putsE;w.lhst[256]++,d=(u=n.F.getTrees())[0],h=u[1],f=u[2],p=u[3],m=u[4],g=u[5],y=u[6],v=u[7];var x=32+(0==(l+3&7)?0:8-(l+3&7))+(s<<3),E=i+n.F.contSize(w.fltree,w.lhst)+n.F.contSize(w.fdtree,w.dhst),S=i+n.F.contSize(w.ltree,w.lhst)+n.F.contSize(w.dtree,w.dhst);S+=14+3*g+n.F.contSize(w.itree,w.ihst)+(2*w.ihst[16]+3*w.ihst[17]+7*w.ihst[18]);for(var k=0;k<286;k++)w.lhst[k]=0;for(k=0;k<30;k++)w.dhst[k]=0;for(k=0;k<19;k++)w.ihst[k]=0;var T=x<E&&x<S?0:E<S?1:2;if(b(c,l,e),b(c,l+1,T),l+=3,0==T){for(;0!=(7&l);)l++;l=n.F._copyExact(a,o,s,c,l)}else{var I,C;if(1==T&&(I=w.fltree,C=w.fdtree),2==T){n.F.makeCodes(w.ltree,d),n.F.revCodes(w.ltree,d),n.F.makeCodes(w.dtree,h),n.F.revCodes(w.dtree,h),n.F.makeCodes(w.itree,f),n.F.revCodes(w.itree,f),I=w.ltree,C=w.dtree,_(c,l,p-257),_(c,l+=5,m-1),_(c,l+=5,g-4),l+=4;for(var A=0;A<g;A++)_(c,l+3*A,w.itree[1+(w.ordr[A]<<1)]);l+=3*g,l=n.F._codeTiny(y,w.itree,c,l),l=n.F._codeTiny(v,w.itree,c,l)}for(var O=o,N=0;N<r;N+=2){for(var R=t[N],P=R>>>23,D=O+(8388607&R);O<D;)l=n.F._writeLit(a[O++],I,c,l);if(0!=P){var z=t[N+1],M=z>>16,L=z>>8&255,U=255&z;_(c,l=n.F._writeLit(257+L,I,c,l),P-w.of0[L]),l+=w.exb[L],b(c,l=n.F._writeLit(U,C,c,l),M-w.df0[U]),l+=w.dxb[U],O+=P}}l=n.F._writeLit(256,I,c,l)}return l},n.F._copyExact=function(e,t,n,r,i){var a=i>>>3;return r[a]=n,r[a+1]=n>>>8,r[a+2]=255-r[a],r[a+3]=255-r[a+1],a+=4,r.set(new Uint8Array(e.buffer,t,n),a),i+(n+4<<3)},n.F.getTrees=function(){for(var e=n.F.U,t=n.F._hufTree(e.lhst,e.ltree,15),r=n.F._hufTree(e.dhst,e.dtree,15),i=[],a=n.F._lenCodes(e.ltree,i),o=[],s=n.F._lenCodes(e.dtree,o),c=0;c<i.length;c+=2)e.ihst[i[c]]++;for(c=0;c<o.length;c+=2)e.ihst[o[c]]++;for(var l=n.F._hufTree(e.ihst,e.itree,7),u=19;u>4&&0==e.itree[1+(e.ordr[u-1]<<1)];)u--;return[t,r,l,a,s,u,i,o]},n.F.getSecond=function(e){for(var t=[],n=0;n<e.length;n+=2)t.push(e[n+1]);return t},n.F.nonZero=function(e){for(var t="",n=0;n<e.length;n+=2)0!=e[n+1]&&(t+=(n>>1)+",");return t},n.F.contSize=function(e,t){for(var n=0,r=0;r<t.length;r++)n+=t[r]*e[1+(r<<1)];return n},n.F._codeTiny=function(e,t,r,i){for(var a=0;a<e.length;a+=2){var o=e[a],s=e[a+1];i=n.F._writeLit(o,t,r,i);var c=16==o?2:17==o?3:7;o>15&&(n.F._putsE(r,i,s,c),i+=c)}return i},n.F._lenCodes=function(e,t){for(var n=e.length;2!=n&&0==e[n-1];)n-=2;for(var r=0;r<n;r+=2){var i=e[r+1],a=r+3<n?e[r+3]:-1,o=r+5<n?e[r+5]:-1,s=0==r?-1:e[r-1];if(0==i&&a==i&&o==i){for(var c=r+5;c+2<n&&e[c+2]==i;)c+=2;(l=Math.min(c+1-r>>>1,138))<11?t.push(17,l-3):t.push(18,l-11),r+=2*l-2}else if(i==s&&a==i&&o==i){for(c=r+5;c+2<n&&e[c+2]==i;)c+=2;var l=Math.min(c+1-r>>>1,6);t.push(16,l-3),r+=2*l-2}else t.push(i,0)}return n>>>1},n.F._hufTree=function(e,t,r){var i=[],a=e.length,o=t.length,s=0;for(s=0;s<o;s+=2)t[s]=0,t[s+1]=0;for(s=0;s<a;s++)0!=e[s]&&i.push({lit:s,f:e[s]});var c=i.length,l=i.slice(0);if(0==c)return 0;if(1==c){var u=i[0].lit;return l=0==u?1:0,t[1+(u<<1)]=1,t[1+(l<<1)]=1,1}i.sort(function(e,t){return e.f-t.f});var d=i[0],h=i[1],f=0,p=1,m=2;for(i[0]={lit:-1,f:d.f+h.f,l:d,r:h,d:0};p!=c-1;)d=f!=p&&(m==c||i[f].f<i[m].f)?i[f++]:i[m++],h=f!=p&&(m==c||i[f].f<i[m].f)?i[f++]:i[m++],i[p++]={lit:-1,f:d.f+h.f,l:d,r:h};var g=n.F.setDepth(i[p-1],0);for(g>r&&(n.F.restrictDepth(l,r,g),g=r),s=0;s<c;s++)t[1+(l[s].lit<<1)]=l[s].d;return g},n.F.setDepth=function(e,t){return-1!=e.lit?(e.d=t,t):Math.max(n.F.setDepth(e.l,t+1),n.F.setDepth(e.r,t+1))},n.F.restrictDepth=function(e,t,n){var r=0,i=1<<n-t,a=0;for(e.sort(function(e,t){return t.d==e.d?e.f-t.f:t.d-e.d}),r=0;r<e.length&&e[r].d>t;r++){var o=e[r].d;e[r].d=t,a+=i-(1<<n-o)}for(a>>>=n-t;a>0;)(o=e[r].d)<t?(e[r].d++,a-=1<<t-o-1):r++;for(;r>=0;r--)e[r].d==t&&a<0&&(e[r].d--,a++);0!=a&&console.log("debt left")},n.F._goodIndex=function(e,t){var n=0;return t[16|n]<=e&&(n|=16),t[8|n]<=e&&(n|=8),t[4|n]<=e&&(n|=4),t[2|n]<=e&&(n|=2),t[1|n]<=e&&(n|=1),n},n.F._writeLit=function(e,t,r,i){return n.F._putsF(r,i,t[e<<1]),i+t[1+(e<<1)]},n.F.inflate=function(e,t){var r=Uint8Array;if(3==e[0]&&0==e[1])return t||new r(0);var i=n.F,a=i._bitsF,o=i._bitsE,s=i._decodeTiny,c=i.makeCodes,l=i.codes2map,u=i._get17,d=i.U,h=null==t;h&&(t=new r(e.length>>>2<<3));for(var f,p,m=0,g=0,y=0,v=0,w=0,b=0,_=0,x=0,E=0;0==m;)if(m=a(e,E,1),g=a(e,E+1,2),E+=3,0!=g){if(h&&(t=n.F._check(t,x+(1<<17))),1==g&&(f=d.flmap,p=d.fdmap,b=511,_=31),2==g){y=o(e,E,5)+257,v=o(e,E+5,5)+1,w=o(e,E+10,4)+4,E+=14;for(var S=0;S<38;S+=2)d.itree[S]=0,d.itree[S+1]=0;var k=1;for(S=0;S<w;S++){var T=o(e,E+3*S,3);d.itree[1+(d.ordr[S]<<1)]=T,T>k&&(k=T)}E+=3*w,c(d.itree,k),l(d.itree,k,d.imap),f=d.lmap,p=d.dmap,E=s(d.imap,(1<<k)-1,y+v,e,E,d.ttree);var I=i._copyOut(d.ttree,0,y,d.ltree);b=(1<<I)-1;var C=i._copyOut(d.ttree,y,v,d.dtree);_=(1<<C)-1,c(d.ltree,I),l(d.ltree,I,f),c(d.dtree,C),l(d.dtree,C,p)}for(;;){var A=f[u(e,E)&b];E+=15&A;var O=A>>>4;if(O>>>8==0)t[x++]=O;else{if(256==O)break;var N=x+O-254;if(O>264){var R=d.ldef[O-257];N=x+(R>>>3)+o(e,E,7&R),E+=7&R}var P=p[u(e,E)&_];E+=15&P;var D=P>>>4,z=d.ddef[D],M=(z>>>4)+a(e,E,15&z);for(E+=15&z,h&&(t=n.F._check(t,x+(1<<17)));x<N;)t[x]=t[x++-M],t[x]=t[x++-M],t[x]=t[x++-M],t[x]=t[x++-M];x=N}}}else{0!=(7&E)&&(E+=8-(7&E));var L=4+(E>>>3),U=e[L-4]|e[L-3]<<8;h&&(t=n.F._check(t,x+U)),t.set(new r(e.buffer,e.byteOffset+L,U),x),E=L+U<<3,x+=U}return t.length==x?t:t.slice(0,x)},n.F._check=function(e,t){var n=e.length;if(t<=n)return e;var r=new Uint8Array(Math.max(n<<1,t));return r.set(e,0),r},n.F._decodeTiny=function(e,t,r,i,a,o){for(var s=n.F._bitsE,c=n.F._get17,l=0;l<r;){var u=e[c(i,a)&t];a+=15&u;var d=u>>>4;if(d<=15)o[l]=d,l++;else{var h=0,f=0;16==d?(f=3+s(i,a,2),a+=2,h=o[l-1]):17==d?(f=3+s(i,a,3),a+=3):18==d&&(f=11+s(i,a,7),a+=7);for(var p=l+f;l<p;)o[l]=h,l++}}return a},n.F._copyOut=function(e,t,n,r){for(var i=0,a=0,o=r.length>>>1;a<n;){var s=e[a+t];r[a<<1]=0,r[1+(a<<1)]=s,s>i&&(i=s),a++}for(;a<o;)r[a<<1]=0,r[1+(a<<1)]=0,a++;return i},n.F.makeCodes=function(e,t){for(var r,i,a,o,s=n.F.U,c=e.length,l=s.bl_count,u=0;u<=t;u++)l[u]=0;for(u=1;u<c;u+=2)l[e[u]]++;var d=s.next_code;for(r=0,l[0]=0,i=1;i<=t;i++)r=r+l[i-1]<<1,d[i]=r;for(a=0;a<c;a+=2)0!=(o=e[a+1])&&(e[a]=d[o],d[o]++)},n.F.codes2map=function(e,t,r){for(var i=e.length,a=n.F.U.rev15,o=0;o<i;o+=2)if(0!=e[o+1])for(var s=o>>1,c=e[o+1],l=s<<4|c,u=t-c,d=e[o]<<u,h=d+(1<<u);d!=h;)r[a[d]>>>15-t]=l,d++},n.F.revCodes=function(e,t){for(var r=n.F.U.rev15,i=15-t,a=0;a<e.length;a+=2){var o=e[a]<<t-e[a+1];e[a]=r[o]>>>i}},n.F._putsE=function(e,t,n){n<<=7&t;var r=t>>>3;e[r]|=n,e[r+1]|=n>>>8},n.F._putsF=function(e,t,n){n<<=7&t;var r=t>>>3;e[r]|=n,e[r+1]|=n>>>8,e[r+2]|=n>>>16},n.F._bitsE=function(e,t,n){return(e[t>>>3]|e[1+(t>>>3)]<<8)>>>(7&t)&(1<<n)-1},n.F._bitsF=function(e,t,n){return(e[t>>>3]|e[1+(t>>>3)]<<8|e[2+(t>>>3)]<<16)>>>(7&t)&(1<<n)-1},n.F._get17=function(e,t){return(e[t>>>3]|e[1+(t>>>3)]<<8|e[2+(t>>>3)]<<16)>>>(7&t)},n.F._get25=function(e,t){return(e[t>>>3]|e[1+(t>>>3)]<<8|e[2+(t>>>3)]<<16|e[3+(t>>>3)]<<24)>>>(7&t)},n.F.U=(e=Uint16Array,t=Uint32Array,{next_code:new e(16),bl_count:new e(16),ordr:[16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15],of0:[3,4,5,6,7,8,9,10,11,13,15,17,19,23,27,31,35,43,51,59,67,83,99,115,131,163,195,227,258,999,999,999],exb:[0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0,0,0,0],ldef:new e(32),df0:[1,2,3,4,5,7,9,13,17,25,33,49,65,97,129,193,257,385,513,769,1025,1537,2049,3073,4097,6145,8193,12289,16385,24577,65535,65535],dxb:[0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13,0,0],ddef:new t(32),flmap:new e(512),fltree:[],fdmap:new e(32),fdtree:[],lmap:new e(32768),ltree:[],ttree:[],dmap:new e(32768),dtree:[],imap:new e(512),itree:[],rev15:new e(32768),lhst:new t(286),dhst:new t(30),ihst:new t(19),lits:new t(15e3),strt:new e(65536),prev:new e(32768)}),function(){for(var e=n.F.U,t=0;t<32768;t++){var r=t;r=(4278255360&(r=(4042322160&(r=(3435973836&(r=(2863311530&r)>>>1|(1431655765&r)<<1))>>>2|(858993459&r)<<2))>>>4|(252645135&r)<<4))>>>8|(16711935&r)<<8,e.rev15[t]=(r>>>16|r<<16)>>>17}function i(e,t,n){for(;0!=t--;)e.push(0,n)}for(t=0;t<32;t++)e.ldef[t]=e.of0[t]<<3|e.exb[t],e.ddef[t]=e.df0[t]<<4|e.dxb[t];i(e.fltree,144,8),i(e.fltree,112,9),i(e.fltree,24,7),i(e.fltree,8,8),n.F.makeCodes(e.fltree,9),n.F.codes2map(e.fltree,9,e.flmap),n.F.revCodes(e.fltree,9),i(e.fdtree,32,5),n.F.makeCodes(e.fdtree,5),n.F.codes2map(e.fdtree,5,e.fdmap),n.F.revCodes(e.fdtree,5),i(e.itree,19,0),i(e.ltree,286,0),i(e.dtree,30,0),i(e.ttree,320,0)}()}();var T_=function(e,t){return t.forEach(function(t){t&&"string"!=typeof t&&!Array.isArray(t)&&Object.keys(t).forEach(function(n){if("default"!==n&&!(n in e)){var r=Object.getOwnPropertyDescriptor(t,n);Object.defineProperty(e,n,r.get?r:{enumerable:!0,get:function(){return t[n]}})}})}),Object.freeze(e)}({__proto__:null,default:S_},[S_]);const I_=function(){var e={nextZero(e,t){for(;0!=e[t];)t++;return t},readUshort:(e,t)=>e[t]<<8|e[t+1],writeUshort(e,t,n){e[t]=n>>8&255,e[t+1]=255&n},readUint:(e,t)=>16777216*e[t]+(e[t+1]<<16|e[t+2]<<8|e[t+3]),writeUint(e,t,n){e[t]=n>>24&255,e[t+1]=n>>16&255,e[t+2]=n>>8&255,e[t+3]=255&n},readASCII(e,t,n){let r="";for(let i=0;i<n;i++)r+=String.fromCharCode(e[t+i]);return r},writeASCII(e,t,n){for(let r=0;r<n.length;r++)e[t+r]=n.charCodeAt(r)},readBytes(e,t,n){const r=[];for(let i=0;i<n;i++)r.push(e[t+i]);return r},pad:e=>e.length<2?"0".concat(e):e,readUTF8(t,n,r){let i,a="";for(let o=0;o<r;o++)a+="%".concat(e.pad(t[n+o].toString(16)));try{i=decodeURIComponent(a)}catch(i){return e.readASCII(t,n,r)}return i}};function t(t,n,r,i){const o=n*r,s=a(i),c=Math.ceil(n*s/8),l=new Uint8Array(4*o),u=new Uint32Array(l.buffer),{ctype:d}=i,{depth:h}=i,f=e.readUshort;if(6==d){const e=o<<2;if(8==h)for(var p=0;p<e;p+=4)l[p]=t[p],l[p+1]=t[p+1],l[p+2]=t[p+2],l[p+3]=t[p+3];if(16==h)for(p=0;p<e;p++)l[p]=t[p<<1]}else if(2==d){const e=i.tabs.tRNS;if(null==e){if(8==h)for(p=0;p<o;p++){var m=3*p;u[p]=255<<24|t[m+2]<<16|t[m+1]<<8|t[m]}if(16==h)for(p=0;p<o;p++)m=6*p,u[p]=255<<24|t[m+4]<<16|t[m+2]<<8|t[m]}else{var g=e[0];const n=e[1],r=e[2];if(8==h)for(p=0;p<o;p++){var y=p<<2;m=3*p,u[p]=255<<24|t[m+2]<<16|t[m+1]<<8|t[m],t[m]==g&&t[m+1]==n&&t[m+2]==r&&(l[y+3]=0)}if(16==h)for(p=0;p<o;p++)y=p<<2,m=6*p,u[p]=255<<24|t[m+4]<<16|t[m+2]<<8|t[m],f(t,m)==g&&f(t,m+2)==n&&f(t,m+4)==r&&(l[y+3]=0)}}else if(3==d){const e=i.tabs.PLTE,a=i.tabs.tRNS,s=a?a.length:0;if(1==h)for(var v=0;v<r;v++){var w=v*c,b=v*n;for(p=0;p<n;p++){y=b+p<<2;var _=3*(x=t[w+(p>>3)]>>7-(7&p)&1);l[y]=e[_],l[y+1]=e[_+1],l[y+2]=e[_+2],l[y+3]=x<s?a[x]:255}}if(2==h)for(v=0;v<r;v++)for(w=v*c,b=v*n,p=0;p<n;p++)y=b+p<<2,_=3*(x=t[w+(p>>2)]>>6-((3&p)<<1)&3),l[y]=e[_],l[y+1]=e[_+1],l[y+2]=e[_+2],l[y+3]=x<s?a[x]:255;if(4==h)for(v=0;v<r;v++)for(w=v*c,b=v*n,p=0;p<n;p++)y=b+p<<2,_=3*(x=t[w+(p>>1)]>>4-((1&p)<<2)&15),l[y]=e[_],l[y+1]=e[_+1],l[y+2]=e[_+2],l[y+3]=x<s?a[x]:255;if(8==h)for(p=0;p<o;p++){var x;y=p<<2,_=3*(x=t[p]),l[y]=e[_],l[y+1]=e[_+1],l[y+2]=e[_+2],l[y+3]=x<s?a[x]:255}}else if(4==d){if(8==h)for(p=0;p<o;p++){y=p<<2;var E=t[S=p<<1];l[y]=E,l[y+1]=E,l[y+2]=E,l[y+3]=t[S+1]}if(16==h)for(p=0;p<o;p++){var S;y=p<<2,E=t[S=p<<2],l[y]=E,l[y+1]=E,l[y+2]=E,l[y+3]=t[S+2]}}else if(0==d)for(g=i.tabs.tRNS?i.tabs.tRNS:-1,v=0;v<r;v++){const e=v*c,r=v*n;if(1==h)for(var k=0;k<n;k++){var T=(E=255*(t[e+(k>>>3)]>>>7-(7&k)&1))==255*g?0:255;u[r+k]=T<<24|E<<16|E<<8|E}else if(2==h)for(k=0;k<n;k++)T=(E=85*(t[e+(k>>>2)]>>>6-((3&k)<<1)&3))==85*g?0:255,u[r+k]=T<<24|E<<16|E<<8|E;else if(4==h)for(k=0;k<n;k++)T=(E=17*(t[e+(k>>>1)]>>>4-((1&k)<<2)&15))==17*g?0:255,u[r+k]=T<<24|E<<16|E<<8|E;else if(8==h)for(k=0;k<n;k++)T=(E=t[e+k])==g?0:255,u[r+k]=T<<24|E<<16|E<<8|E;else if(16==h)for(k=0;k<n;k++)E=t[e+(k<<1)],T=f(t,e+(k<<1))==g?0:255,u[r+k]=T<<24|E<<16|E<<8|E}return l}function n(e,t,n,s){const c=a(e),l=Math.ceil(n*c/8),u=new Uint8Array((l+1+e.interlace)*s);return t=e.tabs.CgBI?i(t,u):r(t,u),0==e.interlace?t=o(t,e,0,n,s):1==e.interlace&&(t=function(e,t){const n=t.width,r=t.height,i=a(t),s=i>>3,c=Math.ceil(n*i/8),l=new Uint8Array(r*c);let u=0;const d=[0,0,4,0,2,0,1],h=[0,4,0,2,0,1,0],f=[8,8,8,4,4,2,2],p=[8,8,4,4,2,2,1];let m=0;for(;m<7;){const a=f[m],y=p[m];let v=0,w=0,b=d[m];for(;b<r;)b+=a,w++;let _=h[m];for(;_<n;)_+=y,v++;const x=Math.ceil(v*i/8);o(e,t,u,v,w);let E=0,S=d[m];for(;S<r;){let t=h[m],r=u+E*x<<3;for(;t<n;){var g;if(1==i&&(g=(g=e[r>>3])>>7-(7&r)&1,l[S*c+(t>>3)]|=g<<7-(7&t)),2==i&&(g=(g=e[r>>3])>>6-(7&r)&3,l[S*c+(t>>2)]|=g<<6-((3&t)<<1)),4==i&&(g=(g=e[r>>3])>>4-(7&r)&15,l[S*c+(t>>1)]|=g<<4-((1&t)<<2)),i>=8){const n=S*c+t*s;for(let t=0;t<s;t++)l[n+t]=e[(r>>3)+t]}r+=i,t+=y}E++,S+=a}v*w!=0&&(u+=w*(1+x)),m+=1}return l}(t,e)),t}function r(e,t){return i(new Uint8Array(e.buffer,2,e.length-6),t)}var i=function(){const e={H:{}};return e.H.N=function(t,n){const r=Uint8Array;let i,a,o=0,s=0,c=0,l=0,u=0,d=0,h=0,f=0,p=0;if(3==t[0]&&0==t[1])return n||new r(0);const m=e.H,g=m.b,y=m.e,v=m.R,w=m.n,b=m.A,_=m.Z,x=m.m,E=null==n;for(E&&(n=new r(t.length>>>2<<5));0==o;)if(o=g(t,p,1),s=g(t,p+1,2),p+=3,0!=s){if(E&&(n=e.H.W(n,f+(1<<17))),1==s&&(i=x.J,a=x.h,d=511,h=31),2==s){c=y(t,p,5)+257,l=y(t,p+5,5)+1,u=y(t,p+10,4)+4,p+=14;let e=1;for(var S=0;S<38;S+=2)x.Q[S]=0,x.Q[S+1]=0;for(S=0;S<u;S++){const n=y(t,p+3*S,3);x.Q[1+(x.X[S]<<1)]=n,n>e&&(e=n)}p+=3*u,w(x.Q,e),b(x.Q,e,x.u),i=x.w,a=x.d,p=v(x.u,(1<<e)-1,c+l,t,p,x.v);const n=m.V(x.v,0,c,x.C);d=(1<<n)-1;const r=m.V(x.v,c,l,x.D);h=(1<<r)-1,w(x.C,n),b(x.C,n,i),w(x.D,r),b(x.D,r,a)}for(;;){const e=i[_(t,p)&d];p+=15&e;const r=e>>>4;if(r>>>8==0)n[f++]=r;else{if(256==r)break;{let e=f+r-254;if(r>264){const n=x.q[r-257];e=f+(n>>>3)+y(t,p,7&n),p+=7&n}const i=a[_(t,p)&h];p+=15&i;const o=i>>>4,s=x.c[o],c=(s>>>4)+g(t,p,15&s);for(p+=15&s;f<e;)n[f]=n[f++-c],n[f]=n[f++-c],n[f]=n[f++-c],n[f]=n[f++-c];f=e}}}}else{0!=(7&p)&&(p+=8-(7&p));const i=4+(p>>>3),a=t[i-4]|t[i-3]<<8;E&&(n=e.H.W(n,f+a)),n.set(new r(t.buffer,t.byteOffset+i,a),f),p=i+a<<3,f+=a}return n.length==f?n:n.slice(0,f)},e.H.W=function(e,t){const n=e.length;if(t<=n)return e;const r=new Uint8Array(n<<1);return r.set(e,0),r},e.H.R=function(t,n,r,i,a,o){const s=e.H.e,c=e.H.Z;let l=0;for(;l<r;){const e=t[c(i,a)&n];a+=15&e;const r=e>>>4;if(r<=15)o[l]=r,l++;else{let e=0,t=0;16==r?(t=3+s(i,a,2),a+=2,e=o[l-1]):17==r?(t=3+s(i,a,3),a+=3):18==r&&(t=11+s(i,a,7),a+=7);const n=l+t;for(;l<n;)o[l]=e,l++}}return a},e.H.V=function(e,t,n,r){let i=0,a=0;const o=r.length>>>1;for(;a<n;){const n=e[a+t];r[a<<1]=0,r[1+(a<<1)]=n,n>i&&(i=n),a++}for(;a<o;)r[a<<1]=0,r[1+(a<<1)]=0,a++;return i},e.H.n=function(t,n){const r=e.H.m,i=t.length;let a,o,s,c;const l=r.j;for(var u=0;u<=n;u++)l[u]=0;for(u=1;u<i;u+=2)l[t[u]]++;const d=r.K;for(a=0,l[0]=0,o=1;o<=n;o++)a=a+l[o-1]<<1,d[o]=a;for(s=0;s<i;s+=2)c=t[s+1],0!=c&&(t[s]=d[c],d[c]++)},e.H.A=function(t,n,r){const i=t.length,a=e.H.m.r;for(let e=0;e<i;e+=2)if(0!=t[e+1]){const i=e>>1,o=t[e+1],s=i<<4|o,c=n-o;let l=t[e]<<c;const u=l+(1<<c);for(;l!=u;)r[a[l]>>>15-n]=s,l++}},e.H.l=function(t,n){const r=e.H.m.r,i=15-n;for(let e=0;e<t.length;e+=2){const a=t[e]<<n-t[e+1];t[e]=r[a]>>>i}},e.H.M=function(e,t,n){n<<=7&t;const r=t>>>3;e[r]|=n,e[r+1]|=n>>>8},e.H.I=function(e,t,n){n<<=7&t;const r=t>>>3;e[r]|=n,e[r+1]|=n>>>8,e[r+2]|=n>>>16},e.H.e=function(e,t,n){return(e[t>>>3]|e[1+(t>>>3)]<<8)>>>(7&t)&(1<<n)-1},e.H.b=function(e,t,n){return(e[t>>>3]|e[1+(t>>>3)]<<8|e[2+(t>>>3)]<<16)>>>(7&t)&(1<<n)-1},e.H.Z=function(e,t){return(e[t>>>3]|e[1+(t>>>3)]<<8|e[2+(t>>>3)]<<16)>>>(7&t)},e.H.i=function(e,t){return(e[t>>>3]|e[1+(t>>>3)]<<8|e[2+(t>>>3)]<<16|e[3+(t>>>3)]<<24)>>>(7&t)},e.H.m=function(){const e=Uint16Array,t=Uint32Array;return{K:new e(16),j:new e(16),X:[16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15],S:[3,4,5,6,7,8,9,10,11,13,15,17,19,23,27,31,35,43,51,59,67,83,99,115,131,163,195,227,258,999,999,999],T:[0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0,0,0,0],q:new e(32),p:[1,2,3,4,5,7,9,13,17,25,33,49,65,97,129,193,257,385,513,769,1025,1537,2049,3073,4097,6145,8193,12289,16385,24577,65535,65535],z:[0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13,0,0],c:new t(32),J:new e(512),_:[],h:new e(32),$:[],w:new e(32768),C:[],v:[],d:new e(32768),D:[],u:new e(512),Q:[],r:new e(32768),s:new t(286),Y:new t(30),a:new t(19),t:new t(15e3),k:new e(65536),g:new e(32768)}}(),function(){const t=e.H.m;for(var n=0;n<32768;n++){let e=n;e=(2863311530&e)>>>1|(1431655765&e)<<1,e=(3435973836&e)>>>2|(858993459&e)<<2,e=(4042322160&e)>>>4|(252645135&e)<<4,e=(4278255360&e)>>>8|(16711935&e)<<8,t.r[n]=(e>>>16|e<<16)>>>17}function r(e,t,n){for(;0!=t--;)e.push(0,n)}for(n=0;n<32;n++)t.q[n]=t.S[n]<<3|t.T[n],t.c[n]=t.p[n]<<4|t.z[n];r(t._,144,8),r(t._,112,9),r(t._,24,7),r(t._,8,8),e.H.n(t._,9),e.H.A(t._,9,t.J),e.H.l(t._,9),r(t.$,32,5),e.H.n(t.$,5),e.H.A(t.$,5,t.h),e.H.l(t.$,5),r(t.Q,19,0),r(t.C,286,0),r(t.D,30,0),r(t.v,320,0)}(),e.H.N}();function a(e){return[1,null,3,1,2,null,4][e.ctype]*e.depth}function o(e,t,n,r,i){let o=a(t);const c=Math.ceil(r*o/8);let l,u;o=Math.ceil(o/8);let d=e[n],h=0;if(d>1&&(e[n]=[0,0,1][d-2]),3==d)for(h=o;h<c;h++)e[h+1]=e[h+1]+(e[h+1-o]>>>1)&255;for(let a=0;a<i;a++)if(l=n+a*c,u=l+a+1,d=e[u-1],h=0,0==d)for(;h<c;h++)e[l+h]=e[u+h];else if(1==d){for(;h<o;h++)e[l+h]=e[u+h];for(;h<c;h++)e[l+h]=e[u+h]+e[l+h-o]}else if(2==d)for(;h<c;h++)e[l+h]=e[u+h]+e[l+h-c];else if(3==d){for(;h<o;h++)e[l+h]=e[u+h]+(e[l+h-c]>>>1);for(;h<c;h++)e[l+h]=e[u+h]+(e[l+h-c]+e[l+h-o]>>>1)}else{for(;h<o;h++)e[l+h]=e[u+h]+s(0,e[l+h-c],0);for(;h<c;h++)e[l+h]=e[u+h]+s(e[l+h-o],e[l+h-c],e[l+h-o-c])}return e}function s(e,t,n){const r=e+t-n,i=r-e,a=r-t,o=r-n;return i*i<=a*a&&i*i<=o*o?e:a*a<=o*o?t:n}function c(t,n,r){r.width=e.readUint(t,n),n+=4,r.height=e.readUint(t,n),n+=4,r.depth=t[n],n++,r.ctype=t[n],n++,r.compress=t[n],n++,r.filter=t[n],n++,r.interlace=t[n],n++}function l(e,t,n,r,i,a,o,s,c){const l=Math.min(t,i),u=Math.min(n,a);let d=0,h=0;for(let _=0;_<u;_++)for(let n=0;n<l;n++)if(o>=0&&s>=0?(d=_*t+n<<2,h=(s+_)*i+o+n<<2):(d=(-s+_)*t-o+n<<2,h=_*i+n<<2),0==c)r[h]=e[d],r[h+1]=e[d+1],r[h+2]=e[d+2],r[h+3]=e[d+3];else if(1==c){var f=e[d+3]*(1/255),p=e[d]*f,m=e[d+1]*f,g=e[d+2]*f,y=r[h+3]*(1/255),v=r[h]*y,w=r[h+1]*y,b=r[h+2]*y;const t=1-f,n=f+y*t,i=0==n?0:1/n;r[h+3]=255*n,r[h+0]=(p+v*t)*i,r[h+1]=(m+w*t)*i,r[h+2]=(g+b*t)*i}else if(2==c)f=e[d+3],p=e[d],m=e[d+1],g=e[d+2],y=r[h+3],v=r[h],w=r[h+1],b=r[h+2],f==y&&p==v&&m==w&&g==b?(r[h]=0,r[h+1]=0,r[h+2]=0,r[h+3]=0):(r[h]=p,r[h+1]=m,r[h+2]=g,r[h+3]=f);else if(3==c){if(f=e[d+3],p=e[d],m=e[d+1],g=e[d+2],y=r[h+3],v=r[h],w=r[h+1],b=r[h+2],f==y&&p==v&&m==w&&g==b)continue;if(f<220&&y>20)return!1}return!0}return{decode:function(t){const a=new Uint8Array(t);let o=8;const s=e,l=s.readUshort,u=s.readUint,d={tabs:{},frames:[]},h=new Uint8Array(a.length);let f,p=0,m=0;const g=[137,80,78,71,13,10,26,10];for(var y=0;y<8;y++)if(a[y]!=g[y])throw"The input is not a PNG file!";for(;o<a.length;){const t=s.readUint(a,o);o+=4;const g=s.readASCII(a,o,4);if(o+=4,"IHDR"==g)c(a,o,d);else if("iCCP"==g){for(var v=o;0!=a[v];)v++;s.readASCII(a,o,v-o),a[v+1];const n=a.slice(v+2,o+t);let c=null;try{c=r(n)}catch(e){c=i(n)}d.tabs[g]=c}else if("CgBI"==g)d.tabs[g]=a.slice(o,o+4);else if("IDAT"==g){for(y=0;y<t;y++)h[p+y]=a[o+y];p+=t}else if("acTL"==g)d.tabs[g]={num_frames:u(a,o),num_plays:u(a,o+4)},f=new Uint8Array(a.length);else if("fcTL"==g){0!=m&&((S=d.frames[d.frames.length-1]).data=n(d,f.slice(0,m),S.rect.width,S.rect.height),m=0);const e={x:u(a,o+12),y:u(a,o+16),width:u(a,o+4),height:u(a,o+8)};let t=l(a,o+22);t=l(a,o+20)/(0==t?100:t);const r={rect:e,delay:Math.round(1e3*t),dispose:a[o+24],blend:a[o+25]};d.frames.push(r)}else if("fdAT"==g){for(y=0;y<t-4;y++)f[m+y]=a[o+y+4];m+=t-4}else if("pHYs"==g)d.tabs[g]=[s.readUint(a,o),s.readUint(a,o+4),a[o+8]];else if("cHRM"==g)for(d.tabs[g]=[],y=0;y<8;y++)d.tabs[g].push(s.readUint(a,o+4*y));else if("tEXt"==g||"zTXt"==g){null==d.tabs[g]&&(d.tabs[g]={});var w=s.nextZero(a,o),b=s.readASCII(a,o,w-o),_=o+t-w-1;if("tEXt"==g)E=s.readASCII(a,w+1,_);else{var x=r(a.slice(w+2,w+2+_));E=s.readUTF8(x,0,x.length)}d.tabs[g][b]=E}else if("iTXt"==g){null==d.tabs[g]&&(d.tabs[g]={}),w=0,v=o,w=s.nextZero(a,v),b=s.readASCII(a,v,w-v);const e=a[v=w+1];var E;a[v+1],v+=2,w=s.nextZero(a,v),s.readASCII(a,v,w-v),v=w+1,w=s.nextZero(a,v),s.readUTF8(a,v,w-v),_=t-((v=w+1)-o),0==e?E=s.readUTF8(a,v,_):(x=r(a.slice(v,v+_)),E=s.readUTF8(x,0,x.length)),d.tabs[g][b]=E}else if("PLTE"==g)d.tabs[g]=s.readBytes(a,o,t);else if("hIST"==g){const e=d.tabs.PLTE.length/3;for(d.tabs[g]=[],y=0;y<e;y++)d.tabs[g].push(l(a,o+2*y))}else if("tRNS"==g)3==d.ctype?d.tabs[g]=s.readBytes(a,o,t):0==d.ctype?d.tabs[g]=l(a,o):2==d.ctype&&(d.tabs[g]=[l(a,o),l(a,o+2),l(a,o+4)]);else if("gAMA"==g)d.tabs[g]=s.readUint(a,o)/1e5;else if("sRGB"==g)d.tabs[g]=a[o];else if("bKGD"==g)0==d.ctype||4==d.ctype?d.tabs[g]=[l(a,o)]:2==d.ctype||6==d.ctype?d.tabs[g]=[l(a,o),l(a,o+2),l(a,o+4)]:3==d.ctype&&(d.tabs[g]=a[o]);else if("IEND"==g)break;o+=t,s.readUint(a,o),o+=4}var S;return 0!=m&&((S=d.frames[d.frames.length-1]).data=n(d,f.slice(0,m),S.rect.width,S.rect.height)),d.data=n(d,h,d.width,d.height),delete d.compress,delete d.interlace,delete d.filter,d},toRGBA8:function(e){const n=e.width,r=e.height;if(null==e.tabs.acTL)return[t(e.data,n,r,e).buffer];const i=[];null==e.frames[0].data&&(e.frames[0].data=e.data);const a=n*r*4,o=new Uint8Array(a),s=new Uint8Array(a),c=new Uint8Array(a);for(let d=0;d<e.frames.length;d++){const h=e.frames[d],f=h.rect.x,p=h.rect.y,m=h.rect.width,g=h.rect.height,y=t(h.data,m,g,e);if(0!=d)for(var u=0;u<a;u++)c[u]=o[u];if(0==h.blend?l(y,m,g,o,n,r,f,p,0):1==h.blend&&l(y,m,g,o,n,r,f,p,1),i.push(o.buffer.slice(0)),0==h.dispose);else if(1==h.dispose)l(s,m,g,o,n,r,f,p,0);else if(2==h.dispose)for(u=0;u<a;u++)o[u]=c[u]}return i},_paeth:s,_copyTile:l,_bin:e}}();!function(){const{_copyTile:e}=I_,{_bin:t}=I_,n=I_._paeth;var r={table:function(){const e=new Uint32Array(256);for(let t=0;t<256;t++){let n=t;for(let e=0;e<8;e++)1&n?n=3988292384^n>>>1:n>>>=1;e[t]=n}return e}(),update(e,t,n,i){for(let a=0;a<i;a++)e=r.table[255&(e^t[n+a])]^e>>>8;return e},crc:(e,t,n)=>4294967295^r.update(4294967295,e,t,n)};function i(e,t,n,r){t[n]+=e[0]*r>>4,t[n+1]+=e[1]*r>>4,t[n+2]+=e[2]*r>>4,t[n+3]+=e[3]*r>>4}function a(e){return Math.max(0,Math.min(255,e))}function o(e,t){const n=e[0]-t[0],r=e[1]-t[1],i=e[2]-t[2],a=e[3]-t[3];return n*n+r*r+i*i+a*a}function s(e,t,n,r,s,c,l){null==l&&(l=1);const u=r.length,d=[];for(var h=0;h<u;h++){const e=r[h];d.push([e>>>0&255,e>>>8&255,e>>>16&255,e>>>24&255])}for(h=0;h<u;h++){let e=4294967295;for(var f=0,p=0;p<u;p++){var m=o(d[h],d[p]);p!=h&&m<e&&(e=m,f=p)}}const g=new Uint32Array(s.buffer),y=new Int16Array(t*n*4),v=[0,8,2,10,12,4,14,6,3,11,1,9,15,7,13,5];for(h=0;h<v.length;h++)v[h]=255*((v[h]+.5)/16-.5);for(let b=0;b<n;b++)for(let s=0;s<t;s++){var w;h=4*(b*t+s),2!=l?w=[a(e[h]+y[h]),a(e[h+1]+y[h+1]),a(e[h+2]+y[h+2]),a(e[h+3]+y[h+3])]:(m=v[4*(3&b)+(3&s)],w=[a(e[h]+m),a(e[h+1]+m),a(e[h+2]+m),a(e[h+3]+m)]),f=0;let _=16777215;for(p=0;p<u;p++){const e=o(w,d[p]);e<_&&(_=e,f=p)}const x=d[f],E=[w[0]-x[0],w[1]-x[1],w[2]-x[2],w[3]-x[3]];1==l&&(s!=t-1&&i(E,y,h+4,7),b!=n-1&&(0!=s&&i(E,y,h+4*t-4,3),i(E,y,h+4*t,5),s!=t-1&&i(E,y,h+4*t+4,1))),c[h>>2]=f,g[h>>2]=r[f]}}function c(e,n,i,a,o){null==o&&(o={});const{crc:s}=r,c=t.writeUint,l=t.writeUshort,u=t.writeASCII;let d=8;const h=e.frames.length>1;let f,p=!1,m=33+(h?20:0);if(null!=o.sRGB&&(m+=13),null!=o.pHYs&&(m+=21),null!=o.iCCP&&(f=pako.deflate(o.iCCP),m+=21+f.length+4),3==e.ctype){for(var g=e.plte.length,y=0;y<g;y++)e.plte[y]>>>24!=255&&(p=!0);m+=8+3*g+4+(p?8+1*g+4:0)}for(var v=0;v<e.frames.length;v++)h&&(m+=38),m+=(x=e.frames[v]).cimg.length+12,0!=v&&(m+=4);m+=12;const w=new Uint8Array(m),b=[137,80,78,71,13,10,26,10];for(y=0;y<8;y++)w[y]=b[y];if(c(w,d,13),d+=4,u(w,d,"IHDR"),d+=4,c(w,d,n),d+=4,c(w,d,i),d+=4,w[d]=e.depth,d++,w[d]=e.ctype,d++,w[d]=0,d++,w[d]=0,d++,w[d]=0,d++,c(w,d,s(w,d-17,17)),d+=4,null!=o.sRGB&&(c(w,d,1),d+=4,u(w,d,"sRGB"),d+=4,w[d]=o.sRGB,d++,c(w,d,s(w,d-5,5)),d+=4),null!=o.iCCP){const e=13+f.length;c(w,d,e),d+=4,u(w,d,"iCCP"),d+=4,u(w,d,"ICC profile"),d+=11,d+=2,w.set(f,d),d+=f.length,c(w,d,s(w,d-(e+4),e+4)),d+=4}if(null!=o.pHYs&&(c(w,d,9),d+=4,u(w,d,"pHYs"),d+=4,c(w,d,o.pHYs[0]),d+=4,c(w,d,o.pHYs[1]),d+=4,w[d]=o.pHYs[2],d++,c(w,d,s(w,d-13,13)),d+=4),h&&(c(w,d,8),d+=4,u(w,d,"acTL"),d+=4,c(w,d,e.frames.length),d+=4,c(w,d,null!=o.loop?o.loop:0),d+=4,c(w,d,s(w,d-12,12)),d+=4),3==e.ctype){for(c(w,d,3*(g=e.plte.length)),d+=4,u(w,d,"PLTE"),d+=4,y=0;y<g;y++){const t=3*y,n=e.plte[y],r=255&n,i=n>>>8&255,a=n>>>16&255;w[d+t+0]=r,w[d+t+1]=i,w[d+t+2]=a}if(d+=3*g,c(w,d,s(w,d-3*g-4,3*g+4)),d+=4,p){for(c(w,d,g),d+=4,u(w,d,"tRNS"),d+=4,y=0;y<g;y++)w[d+y]=e.plte[y]>>>24&255;d+=g,c(w,d,s(w,d-g-4,g+4)),d+=4}}let _=0;for(v=0;v<e.frames.length;v++){var x=e.frames[v];h&&(c(w,d,26),d+=4,u(w,d,"fcTL"),d+=4,c(w,d,_++),d+=4,c(w,d,x.rect.width),d+=4,c(w,d,x.rect.height),d+=4,c(w,d,x.rect.x),d+=4,c(w,d,x.rect.y),d+=4,l(w,d,a[v]),d+=2,l(w,d,1e3),d+=2,w[d]=x.dispose,d++,w[d]=x.blend,d++,c(w,d,s(w,d-30,30)),d+=4);const t=x.cimg;c(w,d,(g=t.length)+(0==v?0:4)),d+=4;const n=d;u(w,d,0==v?"IDAT":"fdAT"),d+=4,0!=v&&(c(w,d,_++),d+=4),w.set(t,d),d+=g,c(w,d,s(w,n,d-n)),d+=4}return c(w,d,0),d+=4,u(w,d,"IEND"),d+=4,c(w,d,s(w,d-4,4)),d+=4,w.buffer}function l(e,t,n){for(let r=0;r<e.frames.length;r++){const i=e.frames[r];i.rect.width;const a=i.rect.height,o=new Uint8Array(a*i.bpl+a);i.cimg=f(i.img,a,i.bpp,i.bpl,o,t,n)}}function u(t,n,r,i,a){const o=a[0],c=a[1],l=a[2],u=a[3],f=a[4],p=a[5];let g=6,y=8,v=255;for(var w=0;w<t.length;w++){const e=new Uint8Array(t[w]);for(var b=e.length,_=0;_<b;_+=4)v&=e[_+3]}const x=255!=v,E=function(t,n,r,i,a,o){const s=[];for(var c=0;c<t.length;c++){const d=new Uint8Array(t[c]),f=new Uint32Array(d.buffer);var l;let m=0,g=0,y=n,v=r,w=i?1:0;if(0!=c){const b=o||i||1==c||0!=s[c-2].dispose?1:2;let _=0,x=1e9;for(let e=0;e<b;e++){var u=new Uint8Array(t[c-1-e]);const i=new Uint32Array(t[c-1-e]);let o=n,s=r,l=-1,d=-1;for(let e=0;e<r;e++)for(let t=0;t<n;t++)f[p=e*n+t]!=i[p]&&(t<o&&(o=t),t>l&&(l=t),e<s&&(s=e),e>d&&(d=e));-1==l&&(o=s=l=d=0),a&&(1==(1&o)&&o--,1==(1&s)&&s--);const h=(l-o+1)*(d-s+1);h<x&&(x=h,_=e,m=o,g=s,y=l-o+1,v=d-s+1)}u=new Uint8Array(t[c-1-_]),1==_&&(s[c-1].dispose=2),l=new Uint8Array(y*v*4),e(u,n,r,l,y,v,-m,-g,0),w=e(d,n,r,l,y,v,-m,-g,3)?1:0,1==w?h(d,n,r,l,{x:m,y:g,width:y,height:v}):e(d,n,r,l,y,v,-m,-g,0)}else l=d.slice(0);s.push({rect:{x:m,y:g,width:y,height:v},img:l,blend:w,dispose:0})}if(i)for(c=0;c<s.length;c++){if(1==(m=s[c]).blend)continue;const e=m.rect,i=s[c-1].rect,o=Math.min(e.x,i.x),l=Math.min(e.y,i.y),u={x:o,y:l,width:Math.max(e.x+e.width,i.x+i.width)-o,height:Math.max(e.y+e.height,i.y+i.height)-l};s[c-1].dispose=1,c-1!=0&&d(t,n,r,s,c-1,u,a),d(t,n,r,s,c,u,a)}let f=0;if(1!=t.length)for(var p=0;p<s.length;p++){var m;f+=(m=s[p]).rect.width*m.rect.height}return s}(t,n,r,o,c,l),S={},k=[],T=[];if(0!=i){const e=[];for(_=0;_<E.length;_++)e.push(E[_].img.buffer);const t=function(e){let t=0;for(var n=0;n<e.length;n++)t+=e[n].byteLength;const r=new Uint8Array(t);let i=0;for(n=0;n<e.length;n++){const t=new Uint8Array(e[n]),a=t.length;for(let e=0;e<a;e+=4){let n=t[e],a=t[e+1],o=t[e+2];const s=t[e+3];0==s&&(n=a=o=0),r[i+e]=n,r[i+e+1]=a,r[i+e+2]=o,r[i+e+3]=s}i+=a}return r.buffer}(e),n=m(t,i);for(_=0;_<n.plte.length;_++)k.push(n.plte[_].est.rgba);let r=0;for(_=0;_<E.length;_++){const e=(C=E[_]).img.length;var I=new Uint8Array(n.inds.buffer,r>>2,e>>2);T.push(I);const t=new Uint8Array(n.abuf,r,e);p&&s(C.img,C.rect.width,C.rect.height,k,t,I),C.img.set(t),r+=e}}else for(w=0;w<E.length;w++){var C=E[w];const e=new Uint32Array(C.img.buffer);var A=C.rect.width;for(b=e.length,I=new Uint8Array(b),T.push(I),_=0;_<b;_++){const t=e[_];if(0!=_&&t==e[_-1])I[_]=I[_-1];else if(_>A&&t==e[_-A])I[_]=I[_-A];else{let e=S[t];if(null==e&&(S[t]=e=k.length,k.push(t),k.length>=300))break;I[_]=e}}}const O=k.length;for(O<=256&&0==f&&(y=O<=2?1:O<=4?2:O<=16?4:8,y=Math.max(y,u)),w=0;w<E.length;w++){(C=E[w]).rect.x,C.rect.y,A=C.rect.width;const e=C.rect.height;let t=C.img;new Uint32Array(t.buffer);let n=4*A,r=4;if(O<=256&&0==f){n=Math.ceil(y*A/8);var N=new Uint8Array(n*e);const i=T[w];for(let t=0;t<e;t++){_=t*n;const e=t*A;if(8==y)for(var R=0;R<A;R++)N[_+R]=i[e+R];else if(4==y)for(R=0;R<A;R++)N[_+(R>>1)]|=i[e+R]<<4-4*(1&R);else if(2==y)for(R=0;R<A;R++)N[_+(R>>2)]|=i[e+R]<<6-2*(3&R);else if(1==y)for(R=0;R<A;R++)N[_+(R>>3)]|=i[e+R]<<7-1*(7&R)}t=N,g=3,r=1}else if(0==x&&1==E.length){N=new Uint8Array(A*e*3);const i=A*e;for(_=0;_<i;_++){const e=3*_,n=4*_;N[e]=t[n],N[e+1]=t[n+1],N[e+2]=t[n+2]}t=N,g=2,r=3,n=3*A}C.img=t,C.bpl=n,C.bpp=r}return{ctype:g,depth:y,plte:k,frames:E}}function d(t,n,r,i,a,o,s){const c=Uint8Array,l=Uint32Array,u=new c(t[a-1]),d=new l(t[a-1]),f=a+1<t.length?new c(t[a+1]):null,p=new c(t[a]),m=new l(p.buffer);let g=n,y=r,v=-1,w=-1;for(let e=0;e<o.height;e++)for(let t=0;t<o.width;t++){const r=o.x+t,s=o.y+e,c=s*n+r,l=m[c];0==l||0==i[a-1].dispose&&d[c]==l&&(null==f||0!=f[4*c+3])||(r<g&&(g=r),r>v&&(v=r),s<y&&(y=s),s>w&&(w=s))}-1==v&&(g=y=v=w=0),s&&(1==(1&g)&&g--,1==(1&y)&&y--),o={x:g,y:y,width:v-g+1,height:w-y+1};const b=i[a];b.rect=o,b.blend=1,b.img=new Uint8Array(o.width*o.height*4),0==i[a-1].dispose?(e(u,n,r,b.img,o.width,o.height,-o.x,-o.y,0),h(p,n,r,b.img,o)):e(p,n,r,b.img,o.width,o.height,-o.x,-o.y,0)}function h(t,n,r,i,a){e(t,n,r,i,a.width,a.height,-a.x,-a.y,2)}function f(e,t,n,r,i,a,o){const s=[];let c,l=[0,1,2,3,4];-1!=a?l=[a]:(t*r>5e5||1==n)&&(l=[0]),o&&(c={level:0});const u=T_;for(var d=0;d<l.length;d++){for(let a=0;a<t;a++)p(i,e,a,r,n,l[d]);s.push(u.deflate(i,c))}let h,f=1e9;for(d=0;d<s.length;d++)s[d].length<f&&(h=d,f=s[d].length);return s[h]}function p(e,t,r,i,a,o){const s=r*i;let c=s+r;if(e[c]=o,c++,0==o)if(i<500)for(var l=0;l<i;l++)e[c+l]=t[s+l];else e.set(new Uint8Array(t.buffer,s,i),c);else if(1==o){for(l=0;l<a;l++)e[c+l]=t[s+l];for(l=a;l<i;l++)e[c+l]=t[s+l]-t[s+l-a]+256&255}else if(0==r){for(l=0;l<a;l++)e[c+l]=t[s+l];if(2==o)for(l=a;l<i;l++)e[c+l]=t[s+l];if(3==o)for(l=a;l<i;l++)e[c+l]=t[s+l]-(t[s+l-a]>>1)+256&255;if(4==o)for(l=a;l<i;l++)e[c+l]=t[s+l]-n(t[s+l-a],0,0)+256&255}else{if(2==o)for(l=0;l<i;l++)e[c+l]=t[s+l]+256-t[s+l-i]&255;if(3==o){for(l=0;l<a;l++)e[c+l]=t[s+l]+256-(t[s+l-i]>>1)&255;for(l=a;l<i;l++)e[c+l]=t[s+l]+256-(t[s+l-i]+t[s+l-a]>>1)&255}if(4==o){for(l=0;l<a;l++)e[c+l]=t[s+l]+256-n(0,t[s+l-i],0)&255;for(l=a;l<i;l++)e[c+l]=t[s+l]+256-n(t[s+l-a],t[s+l-i],t[s+l-a-i])&255}}}function m(e,t){const n=new Uint8Array(e),r=n.slice(0),i=new Uint32Array(r.buffer),a=g(r,t),o=a[0],s=a[1],c=n.length,l=new Uint8Array(c>>2);let u;if(n.length<2e7)for(var d=0;d<c;d+=4)u=y(o,h=n[d]*(1/255),f=n[d+1]*(1/255),p=n[d+2]*(1/255),m=n[d+3]*(1/255)),l[d>>2]=u.ind,i[d>>2]=u.est.rgba;else for(d=0;d<c;d+=4){var h=n[d]*(1/255),f=n[d+1]*(1/255),p=n[d+2]*(1/255),m=n[d+3]*(1/255);for(u=o;u.left;)u=v(u.est,h,f,p,m)<=0?u.left:u.right;l[d>>2]=u.ind,i[d>>2]=u.est.rgba}return{abuf:r.buffer,inds:l,plte:s}}function g(e,t,n){null==n&&(n=1e-4);const r=new Uint32Array(e.buffer),i={i0:0,i1:e.length,bst:null,est:null,tdst:0,left:null,right:null};i.bst=_(e,i.i0,i.i1),i.est=x(i.bst);const a=[i];for(;a.length<t;){let t=0,i=0;for(var o=0;o<a.length;o++)a[o].est.L>t&&(t=a[o].est.L,i=o);if(t<n)break;const s=a[i],c=w(e,r,s.i0,s.i1,s.est.e,s.est.eMq255);if(s.i0>=c||s.i1<=c){s.est.L=0;continue}const l={i0:s.i0,i1:c,bst:null,est:null,tdst:0,left:null,right:null};l.bst=_(e,l.i0,l.i1),l.est=x(l.bst);const u={i0:c,i1:s.i1,bst:null,est:null,tdst:0,left:null,right:null};for(u.bst={R:[],m:[],N:s.bst.N-l.bst.N},o=0;o<16;o++)u.bst.R[o]=s.bst.R[o]-l.bst.R[o];for(o=0;o<4;o++)u.bst.m[o]=s.bst.m[o]-l.bst.m[o];u.est=x(u.bst),s.left=l,s.right=u,a[i]=l,a.push(u)}for(a.sort((e,t)=>t.bst.N-e.bst.N),o=0;o<a.length;o++)a[o].ind=o;return[i,a]}function y(e,t,n,r,i){if(null==e.left)return e.tdst=function(e,t,n,r,i){const a=t-e[0],o=n-e[1],s=r-e[2],c=i-e[3];return a*a+o*o+s*s+c*c}(e.est.q,t,n,r,i),e;const a=v(e.est,t,n,r,i);let o=e.left,s=e.right;a>0&&(o=e.right,s=e.left);const c=y(o,t,n,r,i);if(c.tdst<=a*a)return c;const l=y(s,t,n,r,i);return l.tdst<c.tdst?l:c}function v(e,t,n,r,i){const{e:a}=e;return a[0]*t+a[1]*n+a[2]*r+a[3]*i-e.eMq}function w(e,t,n,r,i,a){for(r-=4;n<r;){for(;b(e,n,i)<=a;)n+=4;for(;b(e,r,i)>a;)r-=4;if(n>=r)break;const o=t[n>>2];t[n>>2]=t[r>>2],t[r>>2]=o,n+=4,r-=4}for(;b(e,n,i)>a;)n-=4;return n+4}function b(e,t,n){return e[t]*n[0]+e[t+1]*n[1]+e[t+2]*n[2]+e[t+3]*n[3]}function _(e,t,n){const r=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],i=[0,0,0,0],a=n-t>>2;for(let o=t;o<n;o+=4){const t=e[o]*(1/255),n=e[o+1]*(1/255),a=e[o+2]*(1/255),s=e[o+3]*(1/255);i[0]+=t,i[1]+=n,i[2]+=a,i[3]+=s,r[0]+=t*t,r[1]+=t*n,r[2]+=t*a,r[3]+=t*s,r[5]+=n*n,r[6]+=n*a,r[7]+=n*s,r[10]+=a*a,r[11]+=a*s,r[15]+=s*s}return r[4]=r[1],r[8]=r[2],r[9]=r[6],r[12]=r[3],r[13]=r[7],r[14]=r[11],{R:r,m:i,N:a}}function x(e){const{R:t}=e,{m:n}=e,{N:r}=e,i=n[0],a=n[1],o=n[2],s=n[3],c=0==r?0:1/r,l=[t[0]-i*i*c,t[1]-i*a*c,t[2]-i*o*c,t[3]-i*s*c,t[4]-a*i*c,t[5]-a*a*c,t[6]-a*o*c,t[7]-a*s*c,t[8]-o*i*c,t[9]-o*a*c,t[10]-o*o*c,t[11]-o*s*c,t[12]-s*i*c,t[13]-s*a*c,t[14]-s*o*c,t[15]-s*s*c],u=l,d=E;let h=[Math.random(),Math.random(),Math.random(),Math.random()],f=0,p=0;if(0!=r)for(let g=0;g<16&&(h=d.multVec(u,h),p=Math.sqrt(d.dot(h,h)),h=d.sml(1/p,h),!(0!=g&&Math.abs(p-f)<1e-9));g++)f=p;const m=[i*c,a*c,o*c,s*c];return{Cov:l,q:m,e:h,L:f,eMq255:d.dot(d.sml(255,m),h),eMq:d.dot(h,m),rgba:(Math.round(255*m[3])<<24|Math.round(255*m[2])<<16|Math.round(255*m[1])<<8|Math.round(255*m[0]))>>>0}}var E={multVec:(e,t)=>[e[0]*t[0]+e[1]*t[1]+e[2]*t[2]+e[3]*t[3],e[4]*t[0]+e[5]*t[1]+e[6]*t[2]+e[7]*t[3],e[8]*t[0]+e[9]*t[1]+e[10]*t[2]+e[11]*t[3],e[12]*t[0]+e[13]*t[1]+e[14]*t[2]+e[15]*t[3]],dot:(e,t)=>e[0]*t[0]+e[1]*t[1]+e[2]*t[2]+e[3]*t[3],sml:(e,t)=>[e*t[0],e*t[1],e*t[2],e*t[3]]};I_.encode=function(e,t,n,r,i,a,o){null==r&&(r=0),null==o&&(o=!1);const s=u(e,t,n,r,[!1,!1,!1,0,o,!1]);return l(s,-1),c(s,t,n,i,a)},I_.encodeLL=function(e,t,n,r,i,a,o,s){const u={ctype:0+(1==r?0:2)+(0==i?0:4),depth:a,frames:[]},d=(r+i)*a,h=d*t;for(let c=0;c<e.length;c++)u.frames.push({rect:{x:0,y:0,width:t,height:n},img:new Uint8Array(e[c]),blend:0,dispose:1,bpp:Math.ceil(d/8),bpl:Math.ceil(h/8)});return l(u,0,!0),c(u,t,n,o,s)},I_.encode.compress=u,I_.encode.dither=s,I_.quantize=m,I_.quantize.getKDtree=g,I_.quantize.getNearest=y}();const C_={toArrayBuffer(e,t){const n=e.width,r=e.height,i=n<<2,a=e.getContext("2d").getImageData(0,0,n,r),o=new Uint32Array(a.data.buffer),s=(32*n+31)/32<<2,c=s*r,l=122+c,u=new ArrayBuffer(l),d=new DataView(u),h=1<<20;let f,p,m,g,y=h,v=0,w=0,b=0;function _(e){d.setUint16(w,e,!0),w+=2}function x(e){d.setUint32(w,e,!0),w+=4}function E(e){w+=e}_(19778),x(l),E(4),x(122),x(108),x(n),x(-r>>>0),_(1),_(32),x(3),x(c),x(2835),x(2835),E(8),x(16711680),x(65280),x(255),x(4278190080),x(1466527264),function e(){for(;v<r&&y>0;){for(g=122+v*s,f=0;f<i;)y--,p=o[b++],m=p>>>24,d.setUint32(g+f,p<<8|m),f+=4;v++}b<o.length?(y=h,setTimeout(e,C_._dly)):t(u)}()},toBlob(e,t){this.toArrayBuffer(e,e=>{t(new Blob([e],{type:"image/bmp"}))})},_dly:9};var A_={CHROME:"CHROME",FIREFOX:"FIREFOX",DESKTOP_SAFARI:"DESKTOP_SAFARI",IE:"IE",IOS:"IOS",ETC:"ETC"},O_={[A_.CHROME]:16384,[A_.FIREFOX]:11180,[A_.DESKTOP_SAFARI]:16384,[A_.IE]:8192,[A_.IOS]:4096,[A_.ETC]:8192};const N_="undefined"!=typeof window,R_="undefined"!=typeof WorkerGlobalScope&&self instanceof WorkerGlobalScope,P_=N_&&window.cordova&&window.cordova.require&&window.cordova.require("cordova/modulemapper"),D_=(N_||R_)&&(P_&&P_.getOriginalSymbol(window,"File")||"undefined"!=typeof File&&File),z_=(N_||R_)&&(P_&&P_.getOriginalSymbol(window,"FileReader")||"undefined"!=typeof FileReader&&FileReader);function M_(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:Date.now();return new Promise(r=>{const i=e.split(","),a=i[0].match(/:(.*?);/)[1],o=globalThis.atob(i[1]);let s=o.length;const c=new Uint8Array(s);for(;s--;)c[s]=o.charCodeAt(s);const l=new Blob([c],{type:a});l.name=t,l.lastModified=n,r(l)})}function L_(e){return new Promise((t,n)=>{const r=new z_;r.onload=()=>t(r.result),r.onerror=e=>n(e),r.readAsDataURL(e)})}function U_(e){return new Promise((t,n)=>{const r=new Image;r.onload=()=>t(r),r.onerror=e=>n(e),r.src=e})}function B_(){if(void 0!==B_.cachedResult)return B_.cachedResult;let e=A_.ETC;const{userAgent:t}=navigator;return/Chrom(e|ium)/i.test(t)?e=A_.CHROME:/iP(ad|od|hone)/i.test(t)&&/WebKit/i.test(t)?e=A_.IOS:/Safari/i.test(t)?e=A_.DESKTOP_SAFARI:/Firefox/i.test(t)?e=A_.FIREFOX:(/MSIE/i.test(t)||1==!!document.documentMode)&&(e=A_.IE),B_.cachedResult=e,B_.cachedResult}function F_(e,t){const n=B_(),r=O_[n];let i=e,a=t,o=i*a;const s=i>a?a/i:i/a;for(;o>r*r;){const e=(r+i)/2,t=(r+a)/2;e<t?(a=t,i=t*s):(a=e*s,i=e),o=i*a}return{width:i,height:a}}function j_(e,t){let n,r;try{if(n=new OffscreenCanvas(e,t),r=n.getContext("2d"),null===r)throw new Error("getContext of OffscreenCanvas returns null")}catch(e){n=document.createElement("canvas"),r=n.getContext("2d")}return n.width=e,n.height=t,[n,r]}function V_(e,t){const{width:n,height:r}=F_(e.width,e.height),[i,a]=j_(n,r);return t&&/jpe?g/.test(t)&&(a.fillStyle="white",a.fillRect(0,0,i.width,i.height)),a.drawImage(e,0,0,i.width,i.height),i}function q_(){return void 0!==q_.cachedResult||(q_.cachedResult=["iPad Simulator","iPhone Simulator","iPod Simulator","iPad","iPhone","iPod"].includes(navigator.platform)||navigator.userAgent.includes("Mac")&&"undefined"!=typeof document&&"ontouchend"in document),q_.cachedResult}function H_(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return new Promise(function(n,r){let i,a;var o=function(){try{return a=V_(i,t.fileType||e.type),n([i,a])}catch(e){return r(e)}},s=function(t){try{var n=function(e){try{throw e}catch(e){return r(e)}};try{let t;return L_(e).then(function(e){try{return t=e,U_(t).then(function(e){try{return i=e,function(){try{return o()}catch(e){return r(e)}}()}catch(e){return n(e)}},n)}catch(e){return n(e)}},n)}catch(e){n(e)}}catch(e){return r(e)}};try{if(q_()||[A_.DESKTOP_SAFARI,A_.MOBILE_SAFARI].includes(B_()))throw new Error("Skip createImageBitmap on IOS and Safari");return createImageBitmap(e).then(function(e){try{return i=e,o()}catch(e){return s()}},s)}catch(e){s()}})}function W_(e,t,n,r){let i=arguments.length>4&&void 0!==arguments[4]?arguments[4]:1;return new Promise(function(a,o){let s;if("image/png"===t){let l,u,d;return l=e.getContext("2d"),({data:u}=l.getImageData(0,0,e.width,e.height)),d=I_.encode([u.buffer],e.width,e.height,4096*i),s=new Blob([d],{type:t}),s.name=n,s.lastModified=r,c.call(this)}{if("image/bmp"===t)return new Promise(t=>C_.toBlob(e,t)).then(function(e){try{return s=e,s.name=n,s.lastModified=r,h.call(this)}catch(e){return o(e)}}.bind(this),o);{if("function"==typeof OffscreenCanvas&&e instanceof OffscreenCanvas)return e.convertToBlob({type:t,quality:i}).then(function(e){try{return s=e,s.name=n,s.lastModified=r,f.call(this)}catch(e){return o(e)}}.bind(this),o);{let p;return p=e.toDataURL(t,i),M_(p,n,r).then(function(e){try{return s=e,f.call(this)}catch(e){return o(e)}}.bind(this),o)}function f(){return h.call(this)}}function h(){return c.call(this)}}function c(){return a(s)}})}function G_(e){e.width=0,e.height=0}function K_(){return new Promise(function(e,t){let n,r,i,a,o;return void 0!==K_.cachedResult?e(K_.cachedResult):(n="data:image/jpeg;base64,/9j/4QAiRXhpZgAATU0AKgAAAAgAAQESAAMAAAABAAYAAAAAAAD/2wCEAAEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAf/AABEIAAEAAgMBEQACEQEDEQH/xABKAAEAAAAAAAAAAAAAAAAAAAALEAEAAAAAAAAAAAAAAAAAAAAAAQEAAAAAAAAAAAAAAAAAAAAAEQEAAAAAAAAAAAAAAAAAAAAA/9oADAMBAAIRAxEAPwA/8H//2Q==",M_("data:image/jpeg;base64,/9j/4QAiRXhpZgAATU0AKgAAAAgAAQESAAMAAAABAAYAAAAAAAD/2wCEAAEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAf/AABEIAAEAAgMBEQACEQEDEQH/xABKAAEAAAAAAAAAAAAAAAAAAAALEAEAAAAAAAAAAAAAAAAAAAAAAQEAAAAAAAAAAAAAAAAAAAAAEQEAAAAAAAAAAAAAAAAAAAAA/9oADAMBAAIRAxEAPwA/8H//2Q==","test.jpg",Date.now()).then(function(n){try{return r=n,H_(r).then(function(n){try{return i=n[1],W_(i,r.type,r.name,r.lastModified).then(function(n){try{return a=n,G_(i),H_(a).then(function(n){try{return o=n[0],K_.cachedResult=1===o.width&&2===o.height,e(K_.cachedResult)}catch(e){return t(e)}},t)}catch(e){return t(e)}},t)}catch(e){return t(e)}},t)}catch(e){return t(e)}},t))})}function Q_(e){return new Promise((t,n)=>{const r=new z_;r.onload=e=>{const n=new DataView(e.target.result);if(65496!=n.getUint16(0,!1))return t(-2);const r=n.byteLength;let i=2;for(;i<r;){if(n.getUint16(i+2,!1)<=8)return t(-1);const e=n.getUint16(i,!1);if(i+=2,65505==e){if(1165519206!=n.getUint32(i+=2,!1))return t(-1);const e=18761==n.getUint16(i+=6,!1);i+=n.getUint32(i+4,e);const r=n.getUint16(i,e);i+=2;for(let a=0;a<r;a++)if(274==n.getUint16(i+12*a,e))return t(n.getUint16(i+12*a+8,e))}else{if(65280!=(65280&e))break;i+=n.getUint16(i,!1)}}return t(-1)},r.onerror=e=>n(e),r.readAsArrayBuffer(e)})}function X_(e,t){const{width:n}=e,{height:r}=e,{maxWidthOrHeight:i}=t;let a,o=e;return isFinite(i)&&(n>i||r>i)&&([o,a]=j_(n,r),n>r?(o.width=i,o.height=r/n*i):(o.width=n/r*i,o.height=i),a.drawImage(e,0,0,o.width,o.height),G_(e)),o}function Y_(e,t){const{width:n}=e,{height:r}=e,[i,a]=j_(n,r);switch(t>4&&t<9?(i.width=r,i.height=n):(i.width=n,i.height=r),t){case 2:a.transform(-1,0,0,1,n,0);break;case 3:a.transform(-1,0,0,-1,n,r);break;case 4:a.transform(1,0,0,-1,0,r);break;case 5:a.transform(0,1,1,0,0,0);break;case 6:a.transform(0,1,-1,0,r,0);break;case 7:a.transform(0,-1,-1,0,r,n);break;case 8:a.transform(0,-1,1,0,0,n)}return a.drawImage(e,0,0,n,r),G_(e),i}function J_(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;return new Promise(function(r,i){let a,o,s,c,l,u,d,h,f,p,m,g,y,v,w,b,_,x,E,S;function k(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:5;if(t.signal&&t.signal.aborted)throw t.signal.reason;a+=e,t.onProgress(Math.min(a,100))}function T(e){if(t.signal&&t.signal.aborted)throw t.signal.reason;a=Math.min(Math.max(e,a),100),t.onProgress(a)}return a=n,o=t.maxIteration||10,s=1024*t.maxSizeMB*1024,k(),H_(e,t).then(function(n){try{return[,c]=n,k(),l=X_(c,t),k(),new Promise(function(n,r){var i;if(!(i=t.exifOrientation))return Q_(e).then(function(e){try{return i=e,a.call(this)}catch(e){return r(e)}}.bind(this),r);function a(){return n(i)}return a.call(this)}).then(function(n){try{return u=n,k(),K_().then(function(n){try{return d=n?l:Y_(l,u),k(),h=t.initialQuality||1,f=t.fileType||e.type,W_(d,f,e.name,e.lastModified,h).then(function(n){try{{if(p=n,k(),m=p.size>s,g=p.size>e.size,!m&&!g)return T(100),r(p);var a;function I(){if(o--&&(w>s||w>y)){let t,n;return t=S?.95*E.width:E.width,n=S?.95*E.height:E.height,[_,x]=j_(t,n),x.drawImage(E,0,0,t,n),h*="image/png"===f?.85:.95,W_(_,f,e.name,e.lastModified,h).then(function(e){try{return b=e,G_(E),E=_,w=b.size,T(Math.min(99,Math.floor((v-w)/(v-s)*100))),I}catch(e){return i(e)}},i)}return[1]}return y=e.size,v=p.size,w=v,E=d,S=!t.alwaysKeepResolution&&m,(a=function(e){for(;e;){if(e.then)return void e.then(a,i);try{if(e.pop){if(e.length)return e.pop()?C.call(this):e;e=I}else e=e.call(this)}catch(e){return i(e)}}}.bind(this))(I);function C(){return G_(E),G_(_),G_(l),G_(d),G_(c),T(100),r(b)}}}catch(u){return i(u)}}.bind(this),i)}catch(e){return i(e)}}.bind(this),i)}catch(e){return i(e)}}.bind(this),i)}catch(e){return i(e)}}.bind(this),i)})}let $_;function Z_(e,t){return new Promise((n,r)=>{$_||($_=function(e){const t=[];return"function"==typeof e?t.push("(".concat(e,")()")):t.push(e),URL.createObjectURL(new Blob(t))}("\nlet scriptImported = false\nself.addEventListener('message', async (e) => {\n  const { file, id, imageCompressionLibUrl, options } = e.data\n  options.onProgress = (progress) => self.postMessage({ progress, id })\n  try {\n    if (!scriptImported) {\n      // console.log('[worker] importScripts', imageCompressionLibUrl)\n      self.importScripts(imageCompressionLibUrl)\n      scriptImported = true\n    }\n    // console.log('[worker] self', self)\n    const compressedFile = await imageCompression(file, options)\n    self.postMessage({ file: compressedFile, id })\n  } catch (e) {\n    // console.error('[worker] error', e)\n    self.postMessage({ error: e.message + '\\n' + e.stack, id })\n  }\n})\n"));const i=new Worker($_);i.addEventListener("message",function(e){if(t.signal&&t.signal.aborted)i.terminate();else if(void 0===e.data.progress){if(e.data.error)return r(new Error(e.data.error)),void i.terminate();n(e.data.file),i.terminate()}else t.onProgress(e.data.progress)}),i.addEventListener("error",r),t.signal&&t.signal.addEventListener("abort",()=>{r(t.signal.reason),i.terminate()}),i.postMessage({file:e,imageCompressionLibUrl:t.libURL,options:l(l({},t),{},{onProgress:void 0,signal:void 0})})})}function ex(e,t){return new Promise(function(n,r){let i,a,o,s,c,u;if(i=l({},t),o=0,({onProgress:s}=i),i.maxSizeMB=i.maxSizeMB||Number.POSITIVE_INFINITY,c="boolean"!=typeof i.useWebWorker||i.useWebWorker,delete i.useWebWorker,i.onProgress=e=>{o=e,"function"==typeof s&&s(o)},!(e instanceof Blob||e instanceof D_))return r(new Error("The file given is not an instance of Blob or File"));if(!/^image/.test(e.type))return r(new Error("The file given is not an image"));if(u="undefined"!=typeof WorkerGlobalScope&&self instanceof WorkerGlobalScope,!c||"function"!=typeof Worker||u)return J_(e,i).then(function(e){try{return a=e,f.call(this)}catch(e){return r(e)}}.bind(this),r);var d=function(){try{return f.call(this)}catch(e){return r(e)}}.bind(this),h=function(t){try{return J_(e,i).then(function(e){try{return a=e,d()}catch(e){return r(e)}},r)}catch(e){return r(e)}};try{return i.libURL=i.libURL||"https://cdn.jsdelivr.net/npm/browser-image-compression@2.0.2/dist/browser-image-compression.js",Z_(e,i).then(function(e){try{return a=e,d()}catch(e){return h()}},h)}catch(e){h()}function f(){try{a.name=e.name,a.lastModified=e.lastModified}catch(e){}try{i.preserveExif&&"image/jpeg"===e.type&&(!i.fileType||i.fileType&&i.fileType===e.type)&&(a=x_(e,a))}catch(e){}return n(a)}})}ex.getDataUrlFromFile=L_,ex.getFilefromDataUrl=M_,ex.loadImage=U_,ex.drawImageInCanvas=V_,ex.drawFileInCanvas=H_,ex.canvasToFile=W_,ex.getExifOrientation=Q_,ex.handleMaxWidthOrHeight=X_,ex.followExifOrientation=Y_,ex.cleanupCanvasMemory=G_,ex.isAutoOrientationInBrowser=K_,ex.approximateBelowMaximumCanvasSizeOfBrowser=F_,ex.copyExifWithoutOrientation=x_,ex.getBrowserName=B_,ex.version="2.0.2";Cf("firebase","10.14.1","app");function tx(e,t){var n={};for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&t.indexOf(r)<0&&(n[r]=e[r]);if(null!=e&&"function"===typeof Object.getOwnPropertySymbols){var i=0;for(r=Object.getOwnPropertySymbols(e);i<r.length;i++)t.indexOf(r[i])<0&&Object.prototype.propertyIsEnumerable.call(e,r[i])&&(n[r[i]]=e[r[i]])}return n}Object.create;Object.create;"function"===typeof SuppressedError&&SuppressedError;function nx(){return{"dependent-sdk-initialized-before-auth":"Another Firebase SDK was initialized and is trying to use Auth before Auth is initialized. Please be sure to call `initializeAuth` or `getAuth` before starting any other Firebase SDK."}}const rx=nx,ix=new eh("auth","Firebase",{"dependent-sdk-initialized-before-auth":"Another Firebase SDK was initialized and is trying to use Auth before Auth is initialized. Please be sure to call `initializeAuth` or `getAuth` before starting any other Firebase SDK."}),ax=new bh("@firebase/auth");function ox(e){if(ax.logLevel<=mh.ERROR){for(var t=arguments.length,n=new Array(t>1?t-1:0),r=1;r<t;r++)n[r-1]=arguments[r];ax.error("Auth (".concat(kf,"): ").concat(e),...n)}}function sx(e){for(var t=arguments.length,n=new Array(t>1?t-1:0),r=1;r<t;r++)n[r-1]=arguments[r];throw dx(e,...n)}function cx(e){for(var t=arguments.length,n=new Array(t>1?t-1:0),r=1;r<t;r++)n[r-1]=arguments[r];return dx(e,...n)}function lx(e,t,n){const r=Object.assign(Object.assign({},rx()),{[t]:n});return new eh("auth","Firebase",r).create(t,{appName:e.name})}function ux(e){return lx(e,"operation-not-supported-in-this-environment","Operations that alter the current user are not supported in conjunction with FirebaseServerApp")}function dx(e){for(var t=arguments.length,n=new Array(t>1?t-1:0),r=1;r<t;r++)n[r-1]=arguments[r];if("string"!==typeof e){const t=n[0],r=[...n.slice(1)];return r[0]&&(r[0].appName=e.name),e._errorFactory.create(t,...r)}return ix.create(e,...n)}function hx(e,t){if(!e){for(var n=arguments.length,r=new Array(n>2?n-2:0),i=2;i<n;i++)r[i-2]=arguments[i];throw dx(t,...r)}}function fx(e){const t="INTERNAL ASSERTION FAILED: "+e;throw ox(t),new Error(t)}function px(e,t){e||fx(t)}function mx(){var e;return"undefined"!==typeof self&&(null===(e=self.location)||void 0===e?void 0:e.href)||""}function gx(){return"http:"===yx()||"https:"===yx()}function yx(){var e;return"undefined"!==typeof self&&(null===(e=self.location)||void 0===e?void 0:e.protocol)||null}function vx(){return!("undefined"!==typeof navigator&&navigator&&"onLine"in navigator&&"boolean"===typeof navigator.onLine&&(gx()||function(){const e="object"===typeof chrome?chrome.runtime:"object"===typeof browser?browser.runtime:void 0;return"object"===typeof e&&void 0!==e.id}()||"connection"in navigator))||navigator.onLine}class wx{constructor(e,t){this.shortDelay=e,this.longDelay=t,px(t>e,"Short delay should be less than long delay!"),this.isMobile="undefined"!==typeof window&&!!(window.cordova||window.phonegap||window.PhoneGap)&&/ios|iphone|ipod|ipad|android|blackberry|iemobile/i.test(Yd())||"object"===typeof navigator&&"ReactNative"===navigator.product}get(){return vx()?this.isMobile?this.longDelay:this.shortDelay:Math.min(5e3,this.shortDelay)}}function bx(e,t){px(e.emulator,"Emulator should always be set here");const{url:n}=e.emulator;return t?"".concat(n).concat(t.startsWith("/")?t.slice(1):t):n}class _x{static initialize(e,t,n){this.fetchImpl=e,t&&(this.headersImpl=t),n&&(this.responseImpl=n)}static fetch(){return this.fetchImpl?this.fetchImpl:"undefined"!==typeof self&&"fetch"in self?self.fetch:"undefined"!==typeof globalThis&&globalThis.fetch?globalThis.fetch:"undefined"!==typeof fetch?fetch:void fx("Could not find fetch implementation, make sure you call FetchProvider.initialize() with an appropriate polyfill")}static headers(){return this.headersImpl?this.headersImpl:"undefined"!==typeof self&&"Headers"in self?self.Headers:"undefined"!==typeof globalThis&&globalThis.Headers?globalThis.Headers:"undefined"!==typeof Headers?Headers:void fx("Could not find Headers implementation, make sure you call FetchProvider.initialize() with an appropriate polyfill")}static response(){return this.responseImpl?this.responseImpl:"undefined"!==typeof self&&"Response"in self?self.Response:"undefined"!==typeof globalThis&&globalThis.Response?globalThis.Response:"undefined"!==typeof Response?Response:void fx("Could not find Response implementation, make sure you call FetchProvider.initialize() with an appropriate polyfill")}}const xx={CREDENTIAL_MISMATCH:"custom-token-mismatch",MISSING_CUSTOM_TOKEN:"internal-error",INVALID_IDENTIFIER:"invalid-email",MISSING_CONTINUE_URI:"internal-error",INVALID_PASSWORD:"wrong-password",MISSING_PASSWORD:"missing-password",INVALID_LOGIN_CREDENTIALS:"invalid-credential",EMAIL_EXISTS:"email-already-in-use",PASSWORD_LOGIN_DISABLED:"operation-not-allowed",INVALID_IDP_RESPONSE:"invalid-credential",INVALID_PENDING_TOKEN:"invalid-credential",FEDERATED_USER_ID_ALREADY_LINKED:"credential-already-in-use",MISSING_REQ_TYPE:"internal-error",EMAIL_NOT_FOUND:"user-not-found",RESET_PASSWORD_EXCEED_LIMIT:"too-many-requests",EXPIRED_OOB_CODE:"expired-action-code",INVALID_OOB_CODE:"invalid-action-code",MISSING_OOB_CODE:"internal-error",CREDENTIAL_TOO_OLD_LOGIN_AGAIN:"requires-recent-login",INVALID_ID_TOKEN:"invalid-user-token",TOKEN_EXPIRED:"user-token-expired",USER_NOT_FOUND:"user-token-expired",TOO_MANY_ATTEMPTS_TRY_LATER:"too-many-requests",PASSWORD_DOES_NOT_MEET_REQUIREMENTS:"password-does-not-meet-requirements",INVALID_CODE:"invalid-verification-code",INVALID_SESSION_INFO:"invalid-verification-id",INVALID_TEMPORARY_PROOF:"invalid-credential",MISSING_SESSION_INFO:"missing-verification-id",SESSION_EXPIRED:"code-expired",MISSING_ANDROID_PACKAGE_NAME:"missing-android-pkg-name",UNAUTHORIZED_DOMAIN:"unauthorized-continue-uri",INVALID_OAUTH_CLIENT_ID:"invalid-oauth-client-id",ADMIN_ONLY_OPERATION:"admin-restricted-operation",INVALID_MFA_PENDING_CREDENTIAL:"invalid-multi-factor-session",MFA_ENROLLMENT_NOT_FOUND:"multi-factor-info-not-found",MISSING_MFA_ENROLLMENT_ID:"missing-multi-factor-info",MISSING_MFA_PENDING_CREDENTIAL:"missing-multi-factor-session",SECOND_FACTOR_EXISTS:"second-factor-already-in-use",SECOND_FACTOR_LIMIT_EXCEEDED:"maximum-second-factor-count-exceeded",BLOCKING_FUNCTION_ERROR_RESPONSE:"internal-error",RECAPTCHA_NOT_ENABLED:"recaptcha-not-enabled",MISSING_RECAPTCHA_TOKEN:"missing-recaptcha-token",INVALID_RECAPTCHA_TOKEN:"invalid-recaptcha-token",INVALID_RECAPTCHA_ACTION:"invalid-recaptcha-action",MISSING_CLIENT_TYPE:"missing-client-type",MISSING_RECAPTCHA_VERSION:"missing-recaptcha-version",INVALID_RECAPTCHA_VERSION:"invalid-recaptcha-version",INVALID_REQ_TYPE:"invalid-req-type"},Ex=new wx(3e4,6e4);function Sx(e,t){return e.tenantId&&!t.tenantId?Object.assign(Object.assign({},t),{tenantId:e.tenantId}):t}async function kx(e,t,n,r){return Tx(e,arguments.length>4&&void 0!==arguments[4]?arguments[4]:{},async()=>{let i={},a={};r&&("GET"===t?a=r:i={body:JSON.stringify(r)});const o=ih(Object.assign({key:e.config.apiKey},a)).slice(1),s=await e._getAdditionalHeaders();s["Content-Type"]="application/json",e.languageCode&&(s["X-Firebase-Locale"]=e.languageCode);const c=Object.assign({method:t,headers:s},i);return"undefined"!==typeof navigator&&"Cloudflare-Workers"===navigator.userAgent||(c.referrerPolicy="no-referrer"),_x.fetch()(Cx(e,e.config.apiHost,n,o),c)})}async function Tx(e,t,n){e._canInitEmulator=!1;const r=Object.assign(Object.assign({},xx),t);try{const t=new Ox(e),i=await Promise.race([n(),t.promise]);t.clearNetworkTimeout();const a=await i.json();if("needConfirmation"in a)throw Nx(e,"account-exists-with-different-credential",a);if(i.ok&&!("errorMessage"in a))return a;{const t=i.ok?a.errorMessage:a.error.message,[n,o]=t.split(" : ");if("FEDERATED_USER_ID_ALREADY_LINKED"===n)throw Nx(e,"credential-already-in-use",a);if("EMAIL_EXISTS"===n)throw Nx(e,"email-already-in-use",a);if("USER_DISABLED"===n)throw Nx(e,"user-disabled",a);const s=r[n]||n.toLowerCase().replace(/[_\s]+/g,"-");if(o)throw lx(e,s,o);sx(e,s)}}catch(S_){if(S_ instanceof Zd)throw S_;sx(e,"network-request-failed",{message:String(S_)})}}async function Ix(e,t,n,r){let i=arguments.length>4&&void 0!==arguments[4]?arguments[4]:{};const a=await kx(e,t,n,r,i);return"mfaPendingCredential"in a&&sx(e,"multi-factor-auth-required",{_serverResponse:a}),a}function Cx(e,t,n,r){const i="".concat(t).concat(n,"?").concat(r);return e.config.emulator?bx(e.config,i):"".concat(e.config.apiScheme,"://").concat(i)}function Ax(e){switch(e){case"ENFORCE":return"ENFORCE";case"AUDIT":return"AUDIT";case"OFF":return"OFF";default:return"ENFORCEMENT_STATE_UNSPECIFIED"}}class Ox{constructor(e){this.auth=e,this.timer=null,this.promise=new Promise((e,t)=>{this.timer=setTimeout(()=>t(cx(this.auth,"network-request-failed")),Ex.get())})}clearNetworkTimeout(){clearTimeout(this.timer)}}function Nx(e,t,n){const r={appName:e.name};n.email&&(r.email=n.email),n.phoneNumber&&(r.phoneNumber=n.phoneNumber);const i=cx(e,t,r);return i.customData._tokenResponse=n,i}function Rx(e){return void 0!==e&&void 0!==e.enterprise}class Px{constructor(e){if(this.siteKey="",this.recaptchaEnforcementState=[],void 0===e.recaptchaKey)throw new Error("recaptchaKey undefined");this.siteKey=e.recaptchaKey.split("/")[3],this.recaptchaEnforcementState=e.recaptchaEnforcementState}getProviderEnforcementState(e){if(!this.recaptchaEnforcementState||0===this.recaptchaEnforcementState.length)return null;for(const t of this.recaptchaEnforcementState)if(t.provider&&t.provider===e)return Ax(t.enforcementState);return null}isProviderEnabled(e){return"ENFORCE"===this.getProviderEnforcementState(e)||"AUDIT"===this.getProviderEnforcementState(e)}}async function Dx(e,t){return kx(e,"GET","/v2/recaptchaConfig",Sx(e,t))}async function zx(e,t){return kx(e,"POST","/v1/accounts:lookup",t)}function Mx(e){if(e)try{const t=new Date(Number(e));if(!isNaN(t.getTime()))return t.toUTCString()}catch(S_){}}function Lx(e){return 1e3*Number(e)}function Ux(e){const[t,n,r]=e.split(".");if(void 0===t||void 0===n||void 0===r)return ox("JWT malformed, contained fewer than 3 sections"),null;try{const e=jd(n);return e?JSON.parse(e):(ox("Failed to decode base64 JWT payload"),null)}catch(S_){return ox("Caught error parsing JWT payload as JSON",null===S_||void 0===S_?void 0:S_.toString()),null}}function Bx(e){const t=Ux(e);return hx(t,"internal-error"),hx("undefined"!==typeof t.exp,"internal-error"),hx("undefined"!==typeof t.iat,"internal-error"),Number(t.exp)-Number(t.iat)}async function Fx(e,t){if(arguments.length>2&&void 0!==arguments[2]&&arguments[2])return t;try{return await t}catch(S_){throw S_ instanceof Zd&&function(e){let{code:t}=e;return t==="auth/".concat("user-disabled")||t==="auth/".concat("user-token-expired")}(S_)&&e.auth.currentUser===e&&await e.auth.signOut(),S_}}class jx{constructor(e){this.user=e,this.isRunning=!1,this.timerId=null,this.errorBackoff=3e4}_start(){this.isRunning||(this.isRunning=!0,this.schedule())}_stop(){this.isRunning&&(this.isRunning=!1,null!==this.timerId&&clearTimeout(this.timerId))}getInterval(e){var t;if(e){const e=this.errorBackoff;return this.errorBackoff=Math.min(2*this.errorBackoff,96e4),e}{this.errorBackoff=3e4;const e=(null!==(t=this.user.stsTokenManager.expirationTime)&&void 0!==t?t:0)-Date.now()-3e5;return Math.max(0,e)}}schedule(){let e=arguments.length>0&&void 0!==arguments[0]&&arguments[0];if(!this.isRunning)return;const t=this.getInterval(e);this.timerId=setTimeout(async()=>{await this.iteration()},t)}async iteration(){try{await this.user.getIdToken(!0)}catch(S_){return void((null===S_||void 0===S_?void 0:S_.code)==="auth/".concat("network-request-failed")&&this.schedule(!0))}this.schedule()}}class Vx{constructor(e,t){this.createdAt=e,this.lastLoginAt=t,this._initializeTime()}_initializeTime(){this.lastSignInTime=Mx(this.lastLoginAt),this.creationTime=Mx(this.createdAt)}_copy(e){this.createdAt=e.createdAt,this.lastLoginAt=e.lastLoginAt,this._initializeTime()}toJSON(){return{createdAt:this.createdAt,lastLoginAt:this.lastLoginAt}}}async function qx(e){var t;const n=e.auth,r=await e.getIdToken(),i=await Fx(e,zx(n,{idToken:r}));hx(null===i||void 0===i?void 0:i.users.length,n,"internal-error");const a=i.users[0];e._notifyReloadListener(a);const o=(null===(t=a.providerUserInfo)||void 0===t?void 0:t.length)?Hx(a.providerUserInfo):[],s=function(e,t){const n=e.filter(e=>!t.some(t=>t.providerId===e.providerId));return[...n,...t]}(e.providerData,o),c=e.isAnonymous,l=!(e.email&&a.passwordHash)&&!(null===s||void 0===s?void 0:s.length),u=!!c&&l,d={uid:a.localId,displayName:a.displayName||null,photoURL:a.photoUrl||null,email:a.email||null,emailVerified:a.emailVerified||!1,phoneNumber:a.phoneNumber||null,tenantId:a.tenantId||null,providerData:s,metadata:new Vx(a.createdAt,a.lastLoginAt),isAnonymous:u};Object.assign(e,d)}function Hx(e){return e.map(e=>{var{providerId:t}=e,n=tx(e,["providerId"]);return{providerId:t,uid:n.rawId||"",displayName:n.displayName||null,email:n.email||null,phoneNumber:n.phoneNumber||null,photoURL:n.photoUrl||null}})}class Wx{constructor(){this.refreshToken=null,this.accessToken=null,this.expirationTime=null}get isExpired(){return!this.expirationTime||Date.now()>this.expirationTime-3e4}updateFromServerResponse(e){hx(e.idToken,"internal-error"),hx("undefined"!==typeof e.idToken,"internal-error"),hx("undefined"!==typeof e.refreshToken,"internal-error");const t="expiresIn"in e&&"undefined"!==typeof e.expiresIn?Number(e.expiresIn):Bx(e.idToken);this.updateTokensAndExpiration(e.idToken,e.refreshToken,t)}updateFromIdToken(e){hx(0!==e.length,"internal-error");const t=Bx(e);this.updateTokensAndExpiration(e,null,t)}async getToken(e){return arguments.length>1&&void 0!==arguments[1]&&arguments[1]||!this.accessToken||this.isExpired?(hx(this.refreshToken,e,"user-token-expired"),this.refreshToken?(await this.refresh(e,this.refreshToken),this.accessToken):null):this.accessToken}clearRefreshToken(){this.refreshToken=null}async refresh(e,t){const{accessToken:n,refreshToken:r,expiresIn:i}=await async function(e,t){const n=await Tx(e,{},async()=>{const n=ih({grant_type:"refresh_token",refresh_token:t}).slice(1),{tokenApiHost:r,apiKey:i}=e.config,a=Cx(e,r,"/v1/token","key=".concat(i)),o=await e._getAdditionalHeaders();return o["Content-Type"]="application/x-www-form-urlencoded",_x.fetch()(a,{method:"POST",headers:o,body:n})});return{accessToken:n.access_token,expiresIn:n.expires_in,refreshToken:n.refresh_token}}(e,t);this.updateTokensAndExpiration(n,r,Number(i))}updateTokensAndExpiration(e,t,n){this.refreshToken=t||null,this.accessToken=e||null,this.expirationTime=Date.now()+1e3*n}static fromJSON(e,t){const{refreshToken:n,accessToken:r,expirationTime:i}=t,a=new Wx;return n&&(hx("string"===typeof n,"internal-error",{appName:e}),a.refreshToken=n),r&&(hx("string"===typeof r,"internal-error",{appName:e}),a.accessToken=r),i&&(hx("number"===typeof i,"internal-error",{appName:e}),a.expirationTime=i),a}toJSON(){return{refreshToken:this.refreshToken,accessToken:this.accessToken,expirationTime:this.expirationTime}}_assign(e){this.accessToken=e.accessToken,this.refreshToken=e.refreshToken,this.expirationTime=e.expirationTime}_clone(){return Object.assign(new Wx,this.toJSON())}_performRefresh(){return fx("not implemented")}}function Gx(e,t){hx("string"===typeof e||"undefined"===typeof e,"internal-error",{appName:t})}class Kx{constructor(e){var{uid:t,auth:n,stsTokenManager:r}=e,i=tx(e,["uid","auth","stsTokenManager"]);this.providerId="firebase",this.proactiveRefresh=new jx(this),this.reloadUserInfo=null,this.reloadListener=null,this.uid=t,this.auth=n,this.stsTokenManager=r,this.accessToken=r.accessToken,this.displayName=i.displayName||null,this.email=i.email||null,this.emailVerified=i.emailVerified||!1,this.phoneNumber=i.phoneNumber||null,this.photoURL=i.photoURL||null,this.isAnonymous=i.isAnonymous||!1,this.tenantId=i.tenantId||null,this.providerData=i.providerData?[...i.providerData]:[],this.metadata=new Vx(i.createdAt||void 0,i.lastLoginAt||void 0)}async getIdToken(e){const t=await Fx(this,this.stsTokenManager.getToken(this.auth,e));return hx(t,this.auth,"internal-error"),this.accessToken!==t&&(this.accessToken=t,await this.auth._persistUserIfCurrent(this),this.auth._notifyListenersIfCurrent(this)),t}getIdTokenResult(e){return async function(e){let t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];const n=lh(e),r=await n.getIdToken(t),i=Ux(r);hx(i&&i.exp&&i.auth_time&&i.iat,n.auth,"internal-error");const a="object"===typeof i.firebase?i.firebase:void 0,o=null===a||void 0===a?void 0:a.sign_in_provider;return{claims:i,token:r,authTime:Mx(Lx(i.auth_time)),issuedAtTime:Mx(Lx(i.iat)),expirationTime:Mx(Lx(i.exp)),signInProvider:o||null,signInSecondFactor:(null===a||void 0===a?void 0:a.sign_in_second_factor)||null}}(this,e)}reload(){return async function(e){const t=lh(e);await qx(t),await t.auth._persistUserIfCurrent(t),t.auth._notifyListenersIfCurrent(t)}(this)}_assign(e){this!==e&&(hx(this.uid===e.uid,this.auth,"internal-error"),this.displayName=e.displayName,this.photoURL=e.photoURL,this.email=e.email,this.emailVerified=e.emailVerified,this.phoneNumber=e.phoneNumber,this.isAnonymous=e.isAnonymous,this.tenantId=e.tenantId,this.providerData=e.providerData.map(e=>Object.assign({},e)),this.metadata._copy(e.metadata),this.stsTokenManager._assign(e.stsTokenManager))}_clone(e){const t=new Kx(Object.assign(Object.assign({},this),{auth:e,stsTokenManager:this.stsTokenManager._clone()}));return t.metadata._copy(this.metadata),t}_onReload(e){hx(!this.reloadListener,this.auth,"internal-error"),this.reloadListener=e,this.reloadUserInfo&&(this._notifyReloadListener(this.reloadUserInfo),this.reloadUserInfo=null)}_notifyReloadListener(e){this.reloadListener?this.reloadListener(e):this.reloadUserInfo=e}_startProactiveRefresh(){this.proactiveRefresh._start()}_stopProactiveRefresh(){this.proactiveRefresh._stop()}async _updateTokensIfNecessary(e){let t=arguments.length>1&&void 0!==arguments[1]&&arguments[1],n=!1;e.idToken&&e.idToken!==this.stsTokenManager.accessToken&&(this.stsTokenManager.updateFromServerResponse(e),n=!0),t&&await qx(this),await this.auth._persistUserIfCurrent(this),n&&this.auth._notifyListenersIfCurrent(this)}async delete(){if(xf(this.auth.app))return Promise.reject(ux(this.auth));const e=await this.getIdToken();return await Fx(this,async function(e,t){return kx(e,"POST","/v1/accounts:delete",t)}(this.auth,{idToken:e})),this.stsTokenManager.clearRefreshToken(),this.auth.signOut()}toJSON(){return Object.assign(Object.assign({uid:this.uid,email:this.email||void 0,emailVerified:this.emailVerified,displayName:this.displayName||void 0,isAnonymous:this.isAnonymous,photoURL:this.photoURL||void 0,phoneNumber:this.phoneNumber||void 0,tenantId:this.tenantId||void 0,providerData:this.providerData.map(e=>Object.assign({},e)),stsTokenManager:this.stsTokenManager.toJSON(),_redirectEventId:this._redirectEventId},this.metadata.toJSON()),{apiKey:this.auth.config.apiKey,appName:this.auth.name})}get refreshToken(){return this.stsTokenManager.refreshToken||""}static _fromJSON(e,t){var n,r,i,a,o,s,c,l;const u=null!==(n=t.displayName)&&void 0!==n?n:void 0,d=null!==(r=t.email)&&void 0!==r?r:void 0,h=null!==(i=t.phoneNumber)&&void 0!==i?i:void 0,f=null!==(a=t.photoURL)&&void 0!==a?a:void 0,p=null!==(o=t.tenantId)&&void 0!==o?o:void 0,m=null!==(s=t._redirectEventId)&&void 0!==s?s:void 0,g=null!==(c=t.createdAt)&&void 0!==c?c:void 0,y=null!==(l=t.lastLoginAt)&&void 0!==l?l:void 0,{uid:v,emailVerified:w,isAnonymous:b,providerData:_,stsTokenManager:x}=t;hx(v&&x,e,"internal-error");const E=Wx.fromJSON(this.name,x);hx("string"===typeof v,e,"internal-error"),Gx(u,e.name),Gx(d,e.name),hx("boolean"===typeof w,e,"internal-error"),hx("boolean"===typeof b,e,"internal-error"),Gx(h,e.name),Gx(f,e.name),Gx(p,e.name),Gx(m,e.name),Gx(g,e.name),Gx(y,e.name);const S=new Kx({uid:v,auth:e,email:d,emailVerified:w,displayName:u,isAnonymous:b,photoURL:f,phoneNumber:h,tenantId:p,stsTokenManager:E,createdAt:g,lastLoginAt:y});return _&&Array.isArray(_)&&(S.providerData=_.map(e=>Object.assign({},e))),m&&(S._redirectEventId=m),S}static async _fromIdTokenResponse(e,t){let n=arguments.length>2&&void 0!==arguments[2]&&arguments[2];const r=new Wx;r.updateFromServerResponse(t);const i=new Kx({uid:t.localId,auth:e,stsTokenManager:r,isAnonymous:n});return await qx(i),i}static async _fromGetAccountInfoResponse(e,t,n){const r=t.users[0];hx(void 0!==r.localId,"internal-error");const i=void 0!==r.providerUserInfo?Hx(r.providerUserInfo):[],a=!(r.email&&r.passwordHash)&&!(null===i||void 0===i?void 0:i.length),o=new Wx;o.updateFromIdToken(n);const s=new Kx({uid:r.localId,auth:e,stsTokenManager:o,isAnonymous:a}),c={uid:r.localId,displayName:r.displayName||null,photoURL:r.photoUrl||null,email:r.email||null,emailVerified:r.emailVerified||!1,phoneNumber:r.phoneNumber||null,tenantId:r.tenantId||null,providerData:i,metadata:new Vx(r.createdAt,r.lastLoginAt),isAnonymous:!(r.email&&r.passwordHash)&&!(null===i||void 0===i?void 0:i.length)};return Object.assign(s,c),s}}const Qx=new Map;function Xx(e){px(e instanceof Function,"Expected a class definition");let t=Qx.get(e);return t?(px(t instanceof e,"Instance stored in cache mismatched with class"),t):(t=new e,Qx.set(e,t),t)}class Yx{constructor(){this.type="NONE",this.storage={}}async _isAvailable(){return!0}async _set(e,t){this.storage[e]=t}async _get(e){const t=this.storage[e];return void 0===t?null:t}async _remove(e){delete this.storage[e]}_addListener(e,t){}_removeListener(e,t){}}Yx.type="NONE";const Jx=Yx;function $x(e,t,n){return"firebase".concat(":",e,":").concat(t,":").concat(n)}class Zx{constructor(e,t,n){this.persistence=e,this.auth=t,this.userKey=n;const{config:r,name:i}=this.auth;this.fullUserKey=$x(this.userKey,r.apiKey,i),this.fullPersistenceKey=$x("persistence",r.apiKey,i),this.boundEventHandler=t._onStorageEvent.bind(t),this.persistence._addListener(this.fullUserKey,this.boundEventHandler)}setCurrentUser(e){return this.persistence._set(this.fullUserKey,e.toJSON())}async getCurrentUser(){const e=await this.persistence._get(this.fullUserKey);return e?Kx._fromJSON(this.auth,e):null}removeCurrentUser(){return this.persistence._remove(this.fullUserKey)}savePersistenceForRedirect(){return this.persistence._set(this.fullPersistenceKey,this.persistence.type)}async setPersistence(e){if(this.persistence===e)return;const t=await this.getCurrentUser();return await this.removeCurrentUser(),this.persistence=e,t?this.setCurrentUser(t):void 0}delete(){this.persistence._removeListener(this.fullUserKey,this.boundEventHandler)}static async create(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"authUser";if(!t.length)return new Zx(Xx(Jx),e,n);const r=(await Promise.all(t.map(async e=>{if(await e._isAvailable())return e}))).filter(e=>e);let i=r[0]||Xx(Jx);const a=$x(n,e.config.apiKey,e.name);let o=null;for(const c of t)try{const t=await c._get(a);if(t){const n=Kx._fromJSON(e,t);c!==i&&(o=n),i=c;break}}catch(we){}const s=r.filter(e=>e._shouldAllowMigration);return i._shouldAllowMigration&&s.length?(i=s[0],o&&await i._set(a,o.toJSON()),await Promise.all(t.map(async e=>{if(e!==i)try{await e._remove(a)}catch(we){}})),new Zx(i,e,n)):new Zx(i,e,n)}}function eE(e){const t=e.toLowerCase();if(t.includes("opera/")||t.includes("opr/")||t.includes("opios/"))return"Opera";if(iE(t))return"IEMobile";if(t.includes("msie")||t.includes("trident/"))return"IE";if(t.includes("edge/"))return"Edge";if(tE(t))return"Firefox";if(t.includes("silk/"))return"Silk";if(oE(t))return"Blackberry";if(sE(t))return"Webos";if(nE(t))return"Safari";if((t.includes("chrome/")||rE(t))&&!t.includes("edge/"))return"Chrome";if(aE(t))return"Android";{const t=/([a-zA-Z\d\.]+)\/[a-zA-Z\d\.]*$/,n=e.match(t);if(2===(null===n||void 0===n?void 0:n.length))return n[1]}return"Other"}function tE(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:Yd();return/firefox\//i.test(e)}function nE(){const e=(arguments.length>0&&void 0!==arguments[0]?arguments[0]:Yd()).toLowerCase();return e.includes("safari/")&&!e.includes("chrome/")&&!e.includes("crios/")&&!e.includes("android")}function rE(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:Yd();return/crios\//i.test(e)}function iE(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:Yd();return/iemobile/i.test(e)}function aE(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:Yd();return/android/i.test(e)}function oE(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:Yd();return/blackberry/i.test(e)}function sE(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:Yd();return/webos/i.test(e)}function cE(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:Yd();return/iphone|ipad|ipod/i.test(e)||/macintosh/i.test(e)&&/mobile/i.test(e)}function lE(){return function(){const e=Yd();return e.indexOf("MSIE ")>=0||e.indexOf("Trident/")>=0}()&&10===document.documentMode}function uE(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:Yd();return cE(e)||aE(e)||sE(e)||oE(e)||/windows phone/i.test(e)||iE(e)}function dE(e){let t,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[];switch(e){case"Browser":t=eE(Yd());break;case"Worker":t="".concat(eE(Yd()),"-").concat(e);break;default:t=e}const r=n.length?n.join(","):"FirebaseCore-web";return"".concat(t,"/","JsCore","/").concat(kf,"/").concat(r)}class hE{constructor(e){this.auth=e,this.queue=[]}pushCallback(e,t){const n=t=>new Promise((n,r)=>{try{n(e(t))}catch(S_){r(S_)}});n.onAbort=t,this.queue.push(n);const r=this.queue.length-1;return()=>{this.queue[r]=()=>Promise.resolve()}}async runMiddleware(e){if(this.auth.currentUser===e)return;const t=[];try{for(const n of this.queue)await n(e),n.onAbort&&t.push(n.onAbort)}catch(S_){t.reverse();for(const r of t)try{r()}catch(n){}throw this.auth._errorFactory.create("login-blocked",{originalMessage:null===S_||void 0===S_?void 0:S_.message})}}}class fE{constructor(e){var t,n,r,i;const a=e.customStrengthOptions;this.customStrengthOptions={},this.customStrengthOptions.minPasswordLength=null!==(t=a.minPasswordLength)&&void 0!==t?t:6,a.maxPasswordLength&&(this.customStrengthOptions.maxPasswordLength=a.maxPasswordLength),void 0!==a.containsLowercaseCharacter&&(this.customStrengthOptions.containsLowercaseLetter=a.containsLowercaseCharacter),void 0!==a.containsUppercaseCharacter&&(this.customStrengthOptions.containsUppercaseLetter=a.containsUppercaseCharacter),void 0!==a.containsNumericCharacter&&(this.customStrengthOptions.containsNumericCharacter=a.containsNumericCharacter),void 0!==a.containsNonAlphanumericCharacter&&(this.customStrengthOptions.containsNonAlphanumericCharacter=a.containsNonAlphanumericCharacter),this.enforcementState=e.enforcementState,"ENFORCEMENT_STATE_UNSPECIFIED"===this.enforcementState&&(this.enforcementState="OFF"),this.allowedNonAlphanumericCharacters=null!==(r=null===(n=e.allowedNonAlphanumericCharacters)||void 0===n?void 0:n.join(""))&&void 0!==r?r:"",this.forceUpgradeOnSignin=null!==(i=e.forceUpgradeOnSignin)&&void 0!==i&&i,this.schemaVersion=e.schemaVersion}validatePassword(e){var t,n,r,i,a,o;const s={isValid:!0,passwordPolicy:this};return this.validatePasswordLengthOptions(e,s),this.validatePasswordCharacterOptions(e,s),s.isValid&&(s.isValid=null===(t=s.meetsMinPasswordLength)||void 0===t||t),s.isValid&&(s.isValid=null===(n=s.meetsMaxPasswordLength)||void 0===n||n),s.isValid&&(s.isValid=null===(r=s.containsLowercaseLetter)||void 0===r||r),s.isValid&&(s.isValid=null===(i=s.containsUppercaseLetter)||void 0===i||i),s.isValid&&(s.isValid=null===(a=s.containsNumericCharacter)||void 0===a||a),s.isValid&&(s.isValid=null===(o=s.containsNonAlphanumericCharacter)||void 0===o||o),s}validatePasswordLengthOptions(e,t){const n=this.customStrengthOptions.minPasswordLength,r=this.customStrengthOptions.maxPasswordLength;n&&(t.meetsMinPasswordLength=e.length>=n),r&&(t.meetsMaxPasswordLength=e.length<=r)}validatePasswordCharacterOptions(e,t){let n;this.updatePasswordCharacterOptionsStatuses(t,!1,!1,!1,!1);for(let r=0;r<e.length;r++)n=e.charAt(r),this.updatePasswordCharacterOptionsStatuses(t,n>="a"&&n<="z",n>="A"&&n<="Z",n>="0"&&n<="9",this.allowedNonAlphanumericCharacters.includes(n))}updatePasswordCharacterOptionsStatuses(e,t,n,r,i){this.customStrengthOptions.containsLowercaseLetter&&(e.containsLowercaseLetter||(e.containsLowercaseLetter=t)),this.customStrengthOptions.containsUppercaseLetter&&(e.containsUppercaseLetter||(e.containsUppercaseLetter=n)),this.customStrengthOptions.containsNumericCharacter&&(e.containsNumericCharacter||(e.containsNumericCharacter=r)),this.customStrengthOptions.containsNonAlphanumericCharacter&&(e.containsNonAlphanumericCharacter||(e.containsNonAlphanumericCharacter=i))}}class pE{constructor(e,t,n,r){this.app=e,this.heartbeatServiceProvider=t,this.appCheckServiceProvider=n,this.config=r,this.currentUser=null,this.emulatorConfig=null,this.operations=Promise.resolve(),this.authStateSubscription=new gE(this),this.idTokenSubscription=new gE(this),this.beforeStateQueue=new hE(this),this.redirectUser=null,this.isProactiveRefreshEnabled=!1,this.EXPECTED_PASSWORD_POLICY_SCHEMA_VERSION=1,this._canInitEmulator=!0,this._isInitialized=!1,this._deleted=!1,this._initializationPromise=null,this._popupRedirectResolver=null,this._errorFactory=ix,this._agentRecaptchaConfig=null,this._tenantRecaptchaConfigs={},this._projectPasswordPolicy=null,this._tenantPasswordPolicies={},this.lastNotifiedUid=void 0,this.languageCode=null,this.tenantId=null,this.settings={appVerificationDisabledForTesting:!1},this.frameworks=[],this.name=e.name,this.clientVersion=r.sdkClientVersion}_initializeWithPersistence(e,t){return t&&(this._popupRedirectResolver=Xx(t)),this._initializationPromise=this.queue(async()=>{var n,r;if(!this._deleted&&(this.persistenceManager=await Zx.create(this,e),!this._deleted)){if(null===(n=this._popupRedirectResolver)||void 0===n?void 0:n._shouldInitProactively)try{await this._popupRedirectResolver._initialize(this)}catch(S_){}await this.initializeCurrentUser(t),this.lastNotifiedUid=(null===(r=this.currentUser)||void 0===r?void 0:r.uid)||null,this._deleted||(this._isInitialized=!0)}}),this._initializationPromise}async _onStorageEvent(){if(this._deleted)return;const e=await this.assertedPersistence.getCurrentUser();return this.currentUser||e?this.currentUser&&e&&this.currentUser.uid===e.uid?(this._currentUser._assign(e),void await this.currentUser.getIdToken()):void await this._updateCurrentUser(e,!0):void 0}async initializeCurrentUserFromIdToken(e){try{const t=await zx(this,{idToken:e}),n=await Kx._fromGetAccountInfoResponse(this,t,e);await this.directlySetCurrentUser(n)}catch(t){console.warn("FirebaseServerApp could not login user with provided authIdToken: ",t),await this.directlySetCurrentUser(null)}}async initializeCurrentUser(e){var t;if(xf(this.app)){const e=this.app.settings.authIdToken;return e?new Promise(t=>{setTimeout(()=>this.initializeCurrentUserFromIdToken(e).then(t,t))}):this.directlySetCurrentUser(null)}const n=await this.assertedPersistence.getCurrentUser();let r=n,i=!1;if(e&&this.config.authDomain){await this.getOrInitRedirectPersistenceManager();const n=null===(t=this.redirectUser)||void 0===t?void 0:t._redirectEventId,a=null===r||void 0===r?void 0:r._redirectEventId,o=await this.tryRedirectSignIn(e);n&&n!==a||!(null===o||void 0===o?void 0:o.user)||(r=o.user,i=!0)}if(!r)return this.directlySetCurrentUser(null);if(!r._redirectEventId){if(i)try{await this.beforeStateQueue.runMiddleware(r)}catch(S_){r=n,this._popupRedirectResolver._overrideRedirectResult(this,()=>Promise.reject(S_))}return r?this.reloadAndSetCurrentUserOrClear(r):this.directlySetCurrentUser(null)}return hx(this._popupRedirectResolver,this,"argument-error"),await this.getOrInitRedirectPersistenceManager(),this.redirectUser&&this.redirectUser._redirectEventId===r._redirectEventId?this.directlySetCurrentUser(r):this.reloadAndSetCurrentUserOrClear(r)}async tryRedirectSignIn(e){let t=null;try{t=await this._popupRedirectResolver._completeRedirectFn(this,e,!0)}catch(S_){await this._setRedirectUser(null)}return t}async reloadAndSetCurrentUserOrClear(e){try{await qx(e)}catch(S_){if((null===S_||void 0===S_?void 0:S_.code)!=="auth/".concat("network-request-failed"))return this.directlySetCurrentUser(null)}return this.directlySetCurrentUser(e)}useDeviceLanguage(){this.languageCode=function(){if("undefined"===typeof navigator)return null;const e=navigator;return e.languages&&e.languages[0]||e.language||null}()}async _delete(){this._deleted=!0}async updateCurrentUser(e){if(xf(this.app))return Promise.reject(ux(this));const t=e?lh(e):null;return t&&hx(t.auth.config.apiKey===this.config.apiKey,this,"invalid-user-token"),this._updateCurrentUser(t&&t._clone(this))}async _updateCurrentUser(e){let t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(!this._deleted)return e&&hx(this.tenantId===e.tenantId,this,"tenant-id-mismatch"),t||await this.beforeStateQueue.runMiddleware(e),this.queue(async()=>{await this.directlySetCurrentUser(e),this.notifyAuthListeners()})}async signOut(){return xf(this.app)?Promise.reject(ux(this)):(await this.beforeStateQueue.runMiddleware(null),(this.redirectPersistenceManager||this._popupRedirectResolver)&&await this._setRedirectUser(null),this._updateCurrentUser(null,!0))}setPersistence(e){return xf(this.app)?Promise.reject(ux(this)):this.queue(async()=>{await this.assertedPersistence.setPersistence(Xx(e))})}_getRecaptchaConfig(){return null==this.tenantId?this._agentRecaptchaConfig:this._tenantRecaptchaConfigs[this.tenantId]}async validatePassword(e){this._getPasswordPolicyInternal()||await this._updatePasswordPolicy();const t=this._getPasswordPolicyInternal();return t.schemaVersion!==this.EXPECTED_PASSWORD_POLICY_SCHEMA_VERSION?Promise.reject(this._errorFactory.create("unsupported-password-policy-schema-version",{})):t.validatePassword(e)}_getPasswordPolicyInternal(){return null===this.tenantId?this._projectPasswordPolicy:this._tenantPasswordPolicies[this.tenantId]}async _updatePasswordPolicy(){const e=await async function(e){return kx(e,"GET","/v2/passwordPolicy",Sx(e,arguments.length>1&&void 0!==arguments[1]?arguments[1]:{}))}(this),t=new fE(e);null===this.tenantId?this._projectPasswordPolicy=t:this._tenantPasswordPolicies[this.tenantId]=t}_getPersistence(){return this.assertedPersistence.persistence.type}_updateErrorMap(e){this._errorFactory=new eh("auth","Firebase",e())}onAuthStateChanged(e,t,n){return this.registerStateListener(this.authStateSubscription,e,t,n)}beforeAuthStateChanged(e,t){return this.beforeStateQueue.pushCallback(e,t)}onIdTokenChanged(e,t,n){return this.registerStateListener(this.idTokenSubscription,e,t,n)}authStateReady(){return new Promise((e,t)=>{if(this.currentUser)e();else{const n=this.onAuthStateChanged(()=>{n(),e()},t)}})}async revokeAccessToken(e){if(this.currentUser){const t={providerId:"apple.com",tokenType:"ACCESS_TOKEN",token:e,idToken:await this.currentUser.getIdToken()};null!=this.tenantId&&(t.tenantId=this.tenantId),await async function(e,t){return kx(e,"POST","/v2/accounts:revokeToken",Sx(e,t))}(this,t)}}toJSON(){var e;return{apiKey:this.config.apiKey,authDomain:this.config.authDomain,appName:this.name,currentUser:null===(e=this._currentUser)||void 0===e?void 0:e.toJSON()}}async _setRedirectUser(e,t){const n=await this.getOrInitRedirectPersistenceManager(t);return null===e?n.removeCurrentUser():n.setCurrentUser(e)}async getOrInitRedirectPersistenceManager(e){if(!this.redirectPersistenceManager){const t=e&&Xx(e)||this._popupRedirectResolver;hx(t,this,"argument-error"),this.redirectPersistenceManager=await Zx.create(this,[Xx(t._redirectPersistence)],"redirectUser"),this.redirectUser=await this.redirectPersistenceManager.getCurrentUser()}return this.redirectPersistenceManager}async _redirectUserForId(e){var t,n;return this._isInitialized&&await this.queue(async()=>{}),(null===(t=this._currentUser)||void 0===t?void 0:t._redirectEventId)===e?this._currentUser:(null===(n=this.redirectUser)||void 0===n?void 0:n._redirectEventId)===e?this.redirectUser:null}async _persistUserIfCurrent(e){if(e===this.currentUser)return this.queue(async()=>this.directlySetCurrentUser(e))}_notifyListenersIfCurrent(e){e===this.currentUser&&this.notifyAuthListeners()}_key(){return"".concat(this.config.authDomain,":").concat(this.config.apiKey,":").concat(this.name)}_startProactiveRefresh(){this.isProactiveRefreshEnabled=!0,this.currentUser&&this._currentUser._startProactiveRefresh()}_stopProactiveRefresh(){this.isProactiveRefreshEnabled=!1,this.currentUser&&this._currentUser._stopProactiveRefresh()}get _currentUser(){return this.currentUser}notifyAuthListeners(){var e,t;if(!this._isInitialized)return;this.idTokenSubscription.next(this.currentUser);const n=null!==(t=null===(e=this.currentUser)||void 0===e?void 0:e.uid)&&void 0!==t?t:null;this.lastNotifiedUid!==n&&(this.lastNotifiedUid=n,this.authStateSubscription.next(this.currentUser))}registerStateListener(e,t,n,r){if(this._deleted)return()=>{};const i="function"===typeof t?t:t.next.bind(t);let a=!1;const o=this._isInitialized?Promise.resolve():this._initializationPromise;if(hx(o,this,"internal-error"),o.then(()=>{a||i(this.currentUser)}),"function"===typeof t){const i=e.addObserver(t,n,r);return()=>{a=!0,i()}}{const n=e.addObserver(t);return()=>{a=!0,n()}}}async directlySetCurrentUser(e){this.currentUser&&this.currentUser!==e&&this._currentUser._stopProactiveRefresh(),e&&this.isProactiveRefreshEnabled&&e._startProactiveRefresh(),this.currentUser=e,e?await this.assertedPersistence.setCurrentUser(e):await this.assertedPersistence.removeCurrentUser()}queue(e){return this.operations=this.operations.then(e,e),this.operations}get assertedPersistence(){return hx(this.persistenceManager,this,"internal-error"),this.persistenceManager}_logFramework(e){e&&!this.frameworks.includes(e)&&(this.frameworks.push(e),this.frameworks.sort(),this.clientVersion=dE(this.config.clientPlatform,this._getFrameworks()))}_getFrameworks(){return this.frameworks}async _getAdditionalHeaders(){var e;const t={"X-Client-Version":this.clientVersion};this.app.options.appId&&(t["X-Firebase-gmpid"]=this.app.options.appId);const n=await(null===(e=this.heartbeatServiceProvider.getImmediate({optional:!0}))||void 0===e?void 0:e.getHeartbeatsHeader());n&&(t["X-Firebase-Client"]=n);const r=await this._getAppCheckToken();return r&&(t["X-Firebase-AppCheck"]=r),t}async _getAppCheckToken(){var e;const t=await(null===(e=this.appCheckServiceProvider.getImmediate({optional:!0}))||void 0===e?void 0:e.getToken());return(null===t||void 0===t?void 0:t.error)&&function(e){if(ax.logLevel<=mh.WARN){for(var t=arguments.length,n=new Array(t>1?t-1:0),r=1;r<t;r++)n[r-1]=arguments[r];ax.warn("Auth (".concat(kf,"): ").concat(e),...n)}}("Error while retrieving App Check token: ".concat(t.error)),null===t||void 0===t?void 0:t.token}}function mE(e){return lh(e)}class gE{constructor(e){this.auth=e,this.observer=null,this.addObserver=function(e,t){const n=new sh(e,t);return n.subscribe.bind(n)}(e=>this.observer=e)}get next(){return hx(this.observer,this.auth,"internal-error"),this.observer.next.bind(this.observer)}}let yE={async loadJS(){throw new Error("Unable to load external scripts")},recaptchaV2Script:"",recaptchaEnterpriseScript:"",gapiScript:""};function vE(e){return yE.loadJS(e)}function wE(e){return"__".concat(e).concat(Math.floor(1e6*Math.random()))}class bE{constructor(e){this.type="recaptcha-enterprise",this.auth=mE(e)}async verify(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"verify",t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];function n(t,n,r){const i=window.grecaptcha;Rx(i)?i.enterprise.ready(()=>{i.enterprise.execute(t,{action:e}).then(e=>{n(e)}).catch(()=>{n("NO_RECAPTCHA")})}):r(Error("No reCAPTCHA enterprise script loaded."))}return new Promise((e,r)=>{(async function(e){if(!t){if(null==e.tenantId&&null!=e._agentRecaptchaConfig)return e._agentRecaptchaConfig.siteKey;if(null!=e.tenantId&&void 0!==e._tenantRecaptchaConfigs[e.tenantId])return e._tenantRecaptchaConfigs[e.tenantId].siteKey}return new Promise(async(t,n)=>{Dx(e,{clientType:"CLIENT_TYPE_WEB",version:"RECAPTCHA_ENTERPRISE"}).then(r=>{if(void 0!==r.recaptchaKey){const n=new Px(r);return null==e.tenantId?e._agentRecaptchaConfig=n:e._tenantRecaptchaConfigs[e.tenantId]=n,t(n.siteKey)}n(new Error("recaptcha Enterprise site key undefined"))}).catch(e=>{n(e)})})})(this.auth).then(i=>{if(!t&&Rx(window.grecaptcha))n(i,e,r);else{if("undefined"===typeof window)return void r(new Error("RecaptchaVerifier is only supported in browser"));let t=yE.recaptchaEnterpriseScript;0!==t.length&&(t+=i),vE(t).then(()=>{n(i,e,r)}).catch(e=>{r(e)})}}).catch(e=>{r(e)})})}}async function _E(e,t,n){let r=arguments.length>3&&void 0!==arguments[3]&&arguments[3];const i=new bE(e);let a;try{a=await i.verify(n)}catch(s){a=await i.verify(n,!0)}const o=Object.assign({},t);return r?Object.assign(o,{captchaResp:a}):Object.assign(o,{captchaResponse:a}),Object.assign(o,{clientType:"CLIENT_TYPE_WEB"}),Object.assign(o,{recaptchaVersion:"RECAPTCHA_ENTERPRISE"}),o}async function xE(e,t,n,r){var i;if(null===(i=e._getRecaptchaConfig())||void 0===i?void 0:i.isProviderEnabled("EMAIL_PASSWORD_PROVIDER")){const i=await _E(e,t,n,"getOobCode"===n);return r(e,i)}return r(e,t).catch(async i=>{if(i.code==="auth/".concat("missing-recaptcha-token")){console.log("".concat(n," is protected by reCAPTCHA Enterprise for this project. Automatically triggering the reCAPTCHA flow and restarting the flow."));const i=await _E(e,t,n,"getOobCode"===n);return r(e,i)}return Promise.reject(i)})}function EE(e,t,n){const r=mE(e);hx(r._canInitEmulator,r,"emulator-config-failed"),hx(/^https?:\/\//.test(t),r,"invalid-emulator-scheme");const i=!!(null===n||void 0===n?void 0:n.disableWarnings),a=SE(t),{host:o,port:s}=function(e){const t=SE(e),n=/(\/\/)?([^?#/]+)/.exec(e.substr(t.length));if(!n)return{host:"",port:null};const r=n[2].split("@").pop()||"",i=/^(\[[^\]]+\])(:|$)/.exec(r);if(i){const e=i[1];return{host:e,port:kE(r.substr(e.length+1))}}{const[e,t]=r.split(":");return{host:e,port:kE(t)}}}(t),c=null===s?"":":".concat(s);r.config.emulator={url:"".concat(a,"//").concat(o).concat(c,"/")},r.settings.appVerificationDisabledForTesting=!0,r.emulatorConfig=Object.freeze({host:o,port:s,protocol:a.replace(":",""),options:Object.freeze({disableWarnings:i})}),i||function(){function e(){const e=document.createElement("p"),t=e.style;e.innerText="Running in emulator mode. Do not use with production credentials.",t.position="fixed",t.width="100%",t.backgroundColor="#ffffff",t.border=".1em solid #000000",t.color="#b50000",t.bottom="0px",t.left="0px",t.margin="0px",t.zIndex="10000",t.textAlign="center",e.classList.add("firebase-emulator-warning"),document.body.appendChild(e)}"undefined"!==typeof console&&"function"===typeof console.info&&console.info("WARNING: You are using the Auth Emulator, which is intended for local testing only.  Do not use with production credentials.");"undefined"!==typeof window&&"undefined"!==typeof document&&("loading"===document.readyState?window.addEventListener("DOMContentLoaded",e):e())}()}function SE(e){const t=e.indexOf(":");return t<0?"":e.substr(0,t+1)}function kE(e){if(!e)return null;const t=Number(e);return isNaN(t)?null:t}class TE{constructor(e,t){this.providerId=e,this.signInMethod=t}toJSON(){return fx("not implemented")}_getIdTokenResponse(e){return fx("not implemented")}_linkToIdToken(e,t){return fx("not implemented")}_getReauthenticationResolver(e){return fx("not implemented")}}async function IE(e,t){return kx(e,"POST","/v1/accounts:signUp",t)}async function CE(e,t){return Ix(e,"POST","/v1/accounts:signInWithPassword",Sx(e,t))}class AE extends TE{constructor(e,t,n){let r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null;super("password",n),this._email=e,this._password=t,this._tenantId=r}static _fromEmailAndPassword(e,t){return new AE(e,t,"password")}static _fromEmailAndCode(e,t){return new AE(e,t,"emailLink",arguments.length>2&&void 0!==arguments[2]?arguments[2]:null)}toJSON(){return{email:this._email,password:this._password,signInMethod:this.signInMethod,tenantId:this._tenantId}}static fromJSON(e){const t="string"===typeof e?JSON.parse(e):e;if((null===t||void 0===t?void 0:t.email)&&(null===t||void 0===t?void 0:t.password)){if("password"===t.signInMethod)return this._fromEmailAndPassword(t.email,t.password);if("emailLink"===t.signInMethod)return this._fromEmailAndCode(t.email,t.password,t.tenantId)}return null}async _getIdTokenResponse(e){switch(this.signInMethod){case"password":return xE(e,{returnSecureToken:!0,email:this._email,password:this._password,clientType:"CLIENT_TYPE_WEB"},"signInWithPassword",CE);case"emailLink":return async function(e,t){return Ix(e,"POST","/v1/accounts:signInWithEmailLink",Sx(e,t))}(e,{email:this._email,oobCode:this._password});default:sx(e,"internal-error")}}async _linkToIdToken(e,t){switch(this.signInMethod){case"password":return xE(e,{idToken:t,returnSecureToken:!0,email:this._email,password:this._password,clientType:"CLIENT_TYPE_WEB"},"signUpPassword",IE);case"emailLink":return async function(e,t){return Ix(e,"POST","/v1/accounts:signInWithEmailLink",Sx(e,t))}(e,{idToken:t,email:this._email,oobCode:this._password});default:sx(e,"internal-error")}}_getReauthenticationResolver(e){return this._getIdTokenResponse(e)}}async function OE(e,t){return Ix(e,"POST","/v1/accounts:signInWithIdp",Sx(e,t))}class NE extends TE{constructor(){super(...arguments),this.pendingToken=null}static _fromParams(e){const t=new NE(e.providerId,e.signInMethod);return e.idToken||e.accessToken?(e.idToken&&(t.idToken=e.idToken),e.accessToken&&(t.accessToken=e.accessToken),e.nonce&&!e.pendingToken&&(t.nonce=e.nonce),e.pendingToken&&(t.pendingToken=e.pendingToken)):e.oauthToken&&e.oauthTokenSecret?(t.accessToken=e.oauthToken,t.secret=e.oauthTokenSecret):sx("argument-error"),t}toJSON(){return{idToken:this.idToken,accessToken:this.accessToken,secret:this.secret,nonce:this.nonce,pendingToken:this.pendingToken,providerId:this.providerId,signInMethod:this.signInMethod}}static fromJSON(e){const t="string"===typeof e?JSON.parse(e):e,{providerId:n,signInMethod:r}=t,i=tx(t,["providerId","signInMethod"]);if(!n||!r)return null;const a=new NE(n,r);return a.idToken=i.idToken||void 0,a.accessToken=i.accessToken||void 0,a.secret=i.secret,a.nonce=i.nonce,a.pendingToken=i.pendingToken||null,a}_getIdTokenResponse(e){return OE(e,this.buildRequest())}_linkToIdToken(e,t){const n=this.buildRequest();return n.idToken=t,OE(e,n)}_getReauthenticationResolver(e){const t=this.buildRequest();return t.autoCreate=!1,OE(e,t)}buildRequest(){const e={requestUri:"http://localhost",returnSecureToken:!0};if(this.pendingToken)e.pendingToken=this.pendingToken;else{const t={};this.idToken&&(t.id_token=this.idToken),this.accessToken&&(t.access_token=this.accessToken),this.secret&&(t.oauth_token_secret=this.secret),t.providerId=this.providerId,this.nonce&&!this.pendingToken&&(t.nonce=this.nonce),e.postBody=ih(t)}return e}}const RE={USER_NOT_FOUND:"user-not-found"};class PE extends TE{constructor(e){super("phone","phone"),this.params=e}static _fromVerification(e,t){return new PE({verificationId:e,verificationCode:t})}static _fromTokenResponse(e,t){return new PE({phoneNumber:e,temporaryProof:t})}_getIdTokenResponse(e){return async function(e,t){return Ix(e,"POST","/v1/accounts:signInWithPhoneNumber",Sx(e,t))}(e,this._makeVerificationRequest())}_linkToIdToken(e,t){return async function(e,t){const n=await Ix(e,"POST","/v1/accounts:signInWithPhoneNumber",Sx(e,t));if(n.temporaryProof)throw Nx(e,"account-exists-with-different-credential",n);return n}(e,Object.assign({idToken:t},this._makeVerificationRequest()))}_getReauthenticationResolver(e){return async function(e,t){return Ix(e,"POST","/v1/accounts:signInWithPhoneNumber",Sx(e,Object.assign(Object.assign({},t),{operation:"REAUTH"})),RE)}(e,this._makeVerificationRequest())}_makeVerificationRequest(){const{temporaryProof:e,phoneNumber:t,verificationId:n,verificationCode:r}=this.params;return e&&t?{temporaryProof:e,phoneNumber:t}:{sessionInfo:n,code:r}}toJSON(){const e={providerId:this.providerId};return this.params.phoneNumber&&(e.phoneNumber=this.params.phoneNumber),this.params.temporaryProof&&(e.temporaryProof=this.params.temporaryProof),this.params.verificationCode&&(e.verificationCode=this.params.verificationCode),this.params.verificationId&&(e.verificationId=this.params.verificationId),e}static fromJSON(e){"string"===typeof e&&(e=JSON.parse(e));const{verificationId:t,verificationCode:n,phoneNumber:r,temporaryProof:i}=e;return n||t||r||i?new PE({verificationId:t,verificationCode:n,phoneNumber:r,temporaryProof:i}):null}}class DE{constructor(e){var t,n,r,i,a,o;const s=ah(oh(e)),c=null!==(t=s.apiKey)&&void 0!==t?t:null,l=null!==(n=s.oobCode)&&void 0!==n?n:null,u=function(e){switch(e){case"recoverEmail":return"RECOVER_EMAIL";case"resetPassword":return"PASSWORD_RESET";case"signIn":return"EMAIL_SIGNIN";case"verifyEmail":return"VERIFY_EMAIL";case"verifyAndChangeEmail":return"VERIFY_AND_CHANGE_EMAIL";case"revertSecondFactorAddition":return"REVERT_SECOND_FACTOR_ADDITION";default:return null}}(null!==(r=s.mode)&&void 0!==r?r:null);hx(c&&l&&u,"argument-error"),this.apiKey=c,this.operation=u,this.code=l,this.continueUrl=null!==(i=s.continueUrl)&&void 0!==i?i:null,this.languageCode=null!==(a=s.languageCode)&&void 0!==a?a:null,this.tenantId=null!==(o=s.tenantId)&&void 0!==o?o:null}static parseLink(e){const t=function(e){const t=ah(oh(e)).link,n=t?ah(oh(t)).deep_link_id:null,r=ah(oh(e)).deep_link_id;return(r?ah(oh(r)).link:null)||r||n||t||e}(e);try{return new DE(t)}catch(we){return null}}}class zE{constructor(){this.providerId=zE.PROVIDER_ID}static credential(e,t){return AE._fromEmailAndPassword(e,t)}static credentialWithLink(e,t){const n=DE.parseLink(t);return hx(n,"argument-error"),AE._fromEmailAndCode(e,n.code,n.tenantId)}}zE.PROVIDER_ID="password",zE.EMAIL_PASSWORD_SIGN_IN_METHOD="password",zE.EMAIL_LINK_SIGN_IN_METHOD="emailLink";class ME{constructor(e){this.providerId=e,this.defaultLanguageCode=null,this.customParameters={}}setDefaultLanguage(e){this.defaultLanguageCode=e}setCustomParameters(e){return this.customParameters=e,this}getCustomParameters(){return this.customParameters}}class LE extends ME{constructor(){super(...arguments),this.scopes=[]}addScope(e){return this.scopes.includes(e)||this.scopes.push(e),this}getScopes(){return[...this.scopes]}}class UE extends LE{constructor(){super("facebook.com")}static credential(e){return NE._fromParams({providerId:UE.PROVIDER_ID,signInMethod:UE.FACEBOOK_SIGN_IN_METHOD,accessToken:e})}static credentialFromResult(e){return UE.credentialFromTaggedObject(e)}static credentialFromError(e){return UE.credentialFromTaggedObject(e.customData||{})}static credentialFromTaggedObject(e){let{_tokenResponse:t}=e;if(!t||!("oauthAccessToken"in t))return null;if(!t.oauthAccessToken)return null;try{return UE.credential(t.oauthAccessToken)}catch(we){return null}}}UE.FACEBOOK_SIGN_IN_METHOD="facebook.com",UE.PROVIDER_ID="facebook.com";class BE extends LE{constructor(){super("google.com"),this.addScope("profile")}static credential(e,t){return NE._fromParams({providerId:BE.PROVIDER_ID,signInMethod:BE.GOOGLE_SIGN_IN_METHOD,idToken:e,accessToken:t})}static credentialFromResult(e){return BE.credentialFromTaggedObject(e)}static credentialFromError(e){return BE.credentialFromTaggedObject(e.customData||{})}static credentialFromTaggedObject(e){let{_tokenResponse:t}=e;if(!t)return null;const{oauthIdToken:n,oauthAccessToken:r}=t;if(!n&&!r)return null;try{return BE.credential(n,r)}catch(we){return null}}}BE.GOOGLE_SIGN_IN_METHOD="google.com",BE.PROVIDER_ID="google.com";class FE extends LE{constructor(){super("github.com")}static credential(e){return NE._fromParams({providerId:FE.PROVIDER_ID,signInMethod:FE.GITHUB_SIGN_IN_METHOD,accessToken:e})}static credentialFromResult(e){return FE.credentialFromTaggedObject(e)}static credentialFromError(e){return FE.credentialFromTaggedObject(e.customData||{})}static credentialFromTaggedObject(e){let{_tokenResponse:t}=e;if(!t||!("oauthAccessToken"in t))return null;if(!t.oauthAccessToken)return null;try{return FE.credential(t.oauthAccessToken)}catch(we){return null}}}FE.GITHUB_SIGN_IN_METHOD="github.com",FE.PROVIDER_ID="github.com";class jE extends LE{constructor(){super("twitter.com")}static credential(e,t){return NE._fromParams({providerId:jE.PROVIDER_ID,signInMethod:jE.TWITTER_SIGN_IN_METHOD,oauthToken:e,oauthTokenSecret:t})}static credentialFromResult(e){return jE.credentialFromTaggedObject(e)}static credentialFromError(e){return jE.credentialFromTaggedObject(e.customData||{})}static credentialFromTaggedObject(e){let{_tokenResponse:t}=e;if(!t)return null;const{oauthAccessToken:n,oauthTokenSecret:r}=t;if(!n||!r)return null;try{return jE.credential(n,r)}catch(we){return null}}}async function VE(e,t){return Ix(e,"POST","/v1/accounts:signUp",Sx(e,t))}jE.TWITTER_SIGN_IN_METHOD="twitter.com",jE.PROVIDER_ID="twitter.com";class qE{constructor(e){this.user=e.user,this.providerId=e.providerId,this._tokenResponse=e._tokenResponse,this.operationType=e.operationType}static async _fromIdTokenResponse(e,t,n){let r=arguments.length>3&&void 0!==arguments[3]&&arguments[3];const i=await Kx._fromIdTokenResponse(e,n,r),a=HE(n);return new qE({user:i,providerId:a,_tokenResponse:n,operationType:t})}static async _forOperation(e,t,n){await e._updateTokensIfNecessary(n,!0);const r=HE(n);return new qE({user:e,providerId:r,_tokenResponse:n,operationType:t})}}function HE(e){return e.providerId?e.providerId:"phoneNumber"in e?"phone":null}class WE extends Zd{constructor(e,t,n,r){var i;super(t.code,t.message),this.operationType=n,this.user=r,Object.setPrototypeOf(this,WE.prototype),this.customData={appName:e.name,tenantId:null!==(i=e.tenantId)&&void 0!==i?i:void 0,_serverResponse:t.customData._serverResponse,operationType:n}}static _fromErrorAndOperation(e,t,n,r){return new WE(e,t,n,r)}}function GE(e,t,n,r){return("reauthenticate"===t?n._getReauthenticationResolver(e):n._getIdTokenResponse(e)).catch(n=>{if(n.code==="auth/".concat("multi-factor-auth-required"))throw WE._fromErrorAndOperation(e,n,t,r);throw n})}async function KE(e,t){let n=arguments.length>2&&void 0!==arguments[2]&&arguments[2];const r=await Fx(e,t._linkToIdToken(e.auth,await e.getIdToken()),n);return qE._forOperation(e,"link",r)}async function QE(e,t){let n=arguments.length>2&&void 0!==arguments[2]&&arguments[2];const{auth:r}=e;if(xf(r.app))return Promise.reject(ux(r));const i="reauthenticate";try{const a=await Fx(e,GE(r,i,t,e),n);hx(a.idToken,r,"internal-error");const o=Ux(a.idToken);hx(o,r,"internal-error");const{sub:s}=o;return hx(e.uid===s,r,"user-mismatch"),qE._forOperation(e,i,a)}catch(S_){throw(null===S_||void 0===S_?void 0:S_.code)==="auth/".concat("user-not-found")&&sx(r,"user-mismatch"),S_}}async function XE(e,t){let n=arguments.length>2&&void 0!==arguments[2]&&arguments[2];if(xf(e.app))return Promise.reject(ux(e));const r="signIn",i=await GE(e,r,t),a=await qE._fromIdTokenResponse(e,r,i);return n||await e._updateCurrentUser(a.user),a}new WeakMap;const YE="__sak";class JE{constructor(e,t){this.storageRetriever=e,this.type=t}_isAvailable(){try{return this.storage?(this.storage.setItem(YE,"1"),this.storage.removeItem(YE),Promise.resolve(!0)):Promise.resolve(!1)}catch(we){return Promise.resolve(!1)}}_set(e,t){return this.storage.setItem(e,JSON.stringify(t)),Promise.resolve()}_get(e){const t=this.storage.getItem(e);return Promise.resolve(t?JSON.parse(t):null)}_remove(e){return this.storage.removeItem(e),Promise.resolve()}get storage(){return this.storageRetriever()}}class $E extends JE{constructor(){super(()=>window.localStorage,"LOCAL"),this.boundEventHandler=(e,t)=>this.onStorageEvent(e,t),this.listeners={},this.localCache={},this.pollTimer=null,this.fallbackToPolling=uE(),this._shouldAllowMigration=!0}forAllChangedKeys(e){for(const t of Object.keys(this.listeners)){const n=this.storage.getItem(t),r=this.localCache[t];n!==r&&e(t,r,n)}}onStorageEvent(e){let t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(!e.key)return void this.forAllChangedKeys((e,t,n)=>{this.notifyListeners(e,n)});const n=e.key;t?this.detachListener():this.stopPolling();const r=()=>{const e=this.storage.getItem(n);(t||this.localCache[n]!==e)&&this.notifyListeners(n,e)},i=this.storage.getItem(n);lE()&&i!==e.newValue&&e.newValue!==e.oldValue?setTimeout(r,10):r()}notifyListeners(e,t){this.localCache[e]=t;const n=this.listeners[e];if(n)for(const r of Array.from(n))r(t?JSON.parse(t):t)}startPolling(){this.stopPolling(),this.pollTimer=setInterval(()=>{this.forAllChangedKeys((e,t,n)=>{this.onStorageEvent(new StorageEvent("storage",{key:e,oldValue:t,newValue:n}),!0)})},1e3)}stopPolling(){this.pollTimer&&(clearInterval(this.pollTimer),this.pollTimer=null)}attachListener(){window.addEventListener("storage",this.boundEventHandler)}detachListener(){window.removeEventListener("storage",this.boundEventHandler)}_addListener(e,t){0===Object.keys(this.listeners).length&&(this.fallbackToPolling?this.startPolling():this.attachListener()),this.listeners[e]||(this.listeners[e]=new Set,this.localCache[e]=this.storage.getItem(e)),this.listeners[e].add(t)}_removeListener(e,t){this.listeners[e]&&(this.listeners[e].delete(t),0===this.listeners[e].size&&delete this.listeners[e]),0===Object.keys(this.listeners).length&&(this.detachListener(),this.stopPolling())}async _set(e,t){await super._set(e,t),this.localCache[e]=JSON.stringify(t)}async _get(e){const t=await super._get(e);return this.localCache[e]=JSON.stringify(t),t}async _remove(e){await super._remove(e),delete this.localCache[e]}}$E.type="LOCAL";const ZE=$E;class eS extends JE{constructor(){super(()=>window.sessionStorage,"SESSION")}_addListener(e,t){}_removeListener(e,t){}}eS.type="SESSION";const tS=eS;class nS{constructor(e){this.eventTarget=e,this.handlersMap={},this.boundEventHandler=this.handleEvent.bind(this)}static _getInstance(e){const t=this.receivers.find(t=>t.isListeningto(e));if(t)return t;const n=new nS(e);return this.receivers.push(n),n}isListeningto(e){return this.eventTarget===e}async handleEvent(e){const t=e,{eventId:n,eventType:r,data:i}=t.data,a=this.handlersMap[r];if(!(null===a||void 0===a?void 0:a.size))return;t.ports[0].postMessage({status:"ack",eventId:n,eventType:r});const o=Array.from(a).map(async e=>e(t.origin,i)),s=await function(e){return Promise.all(e.map(async e=>{try{return{fulfilled:!0,value:await e}}catch(t){return{fulfilled:!1,reason:t}}}))}(o);t.ports[0].postMessage({status:"done",eventId:n,eventType:r,response:s})}_subscribe(e,t){0===Object.keys(this.handlersMap).length&&this.eventTarget.addEventListener("message",this.boundEventHandler),this.handlersMap[e]||(this.handlersMap[e]=new Set),this.handlersMap[e].add(t)}_unsubscribe(e,t){this.handlersMap[e]&&t&&this.handlersMap[e].delete(t),t&&0!==this.handlersMap[e].size||delete this.handlersMap[e],0===Object.keys(this.handlersMap).length&&this.eventTarget.removeEventListener("message",this.boundEventHandler)}}function rS(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"",t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:10,n="";for(let r=0;r<t;r++)n+=Math.floor(10*Math.random());return e+n}nS.receivers=[];class iS{constructor(e){this.target=e,this.handlers=new Set}removeMessageHandler(e){e.messageChannel&&(e.messageChannel.port1.removeEventListener("message",e.onMessage),e.messageChannel.port1.close()),this.handlers.delete(e)}async _send(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:50;const r="undefined"!==typeof MessageChannel?new MessageChannel:null;if(!r)throw new Error("connection_unavailable");let i,a;return new Promise((o,s)=>{const c=rS("",20);r.port1.start();const l=setTimeout(()=>{s(new Error("unsupported_event"))},n);a={messageChannel:r,onMessage(e){const t=e;if(t.data.eventId===c)switch(t.data.status){case"ack":clearTimeout(l),i=setTimeout(()=>{s(new Error("timeout"))},3e3);break;case"done":clearTimeout(i),o(t.data.response);break;default:clearTimeout(l),clearTimeout(i),s(new Error("invalid_response"))}}},this.handlers.add(a),r.port1.addEventListener("message",a.onMessage),this.target.postMessage({eventType:e,eventId:c,data:t},[r.port2])}).finally(()=>{a&&this.removeMessageHandler(a)})}}function aS(){return window}function oS(){return"undefined"!==typeof aS().WorkerGlobalScope&&"function"===typeof aS().importScripts}const sS="firebaseLocalStorageDb",cS="firebaseLocalStorage",lS="fbase_key";class uS{constructor(e){this.request=e}toPromise(){return new Promise((e,t)=>{this.request.addEventListener("success",()=>{e(this.request.result)}),this.request.addEventListener("error",()=>{t(this.request.error)})})}}function dS(e,t){return e.transaction([cS],t?"readwrite":"readonly").objectStore(cS)}function hS(){const e=indexedDB.open(sS,1);return new Promise((t,n)=>{e.addEventListener("error",()=>{n(e.error)}),e.addEventListener("upgradeneeded",()=>{const t=e.result;try{t.createObjectStore(cS,{keyPath:lS})}catch(S_){n(S_)}}),e.addEventListener("success",async()=>{const n=e.result;n.objectStoreNames.contains(cS)?t(n):(n.close(),await function(){const e=indexedDB.deleteDatabase(sS);return new uS(e).toPromise()}(),t(await hS()))})})}async function fS(e,t,n){const r=dS(e,!0).put({[lS]:t,value:n});return new uS(r).toPromise()}function pS(e,t){const n=dS(e,!0).delete(t);return new uS(n).toPromise()}class mS{constructor(){this.type="LOCAL",this._shouldAllowMigration=!0,this.listeners={},this.localCache={},this.pollTimer=null,this.pendingWrites=0,this.receiver=null,this.sender=null,this.serviceWorkerReceiverAvailable=!1,this.activeServiceWorker=null,this._workerInitializationPromise=this.initializeServiceWorkerMessaging().then(()=>{},()=>{})}async _openDb(){return this.db||(this.db=await hS()),this.db}async _withRetries(e){let t=0;for(;;)try{const t=await this._openDb();return await e(t)}catch(S_){if(t++>3)throw S_;this.db&&(this.db.close(),this.db=void 0)}}async initializeServiceWorkerMessaging(){return oS()?this.initializeReceiver():this.initializeSender()}async initializeReceiver(){this.receiver=nS._getInstance(oS()?self:null),this.receiver._subscribe("keyChanged",async(e,t)=>({keyProcessed:(await this._poll()).includes(t.key)})),this.receiver._subscribe("ping",async(e,t)=>["keyChanged"])}async initializeSender(){var e,t;if(this.activeServiceWorker=await async function(){if(!(null===navigator||void 0===navigator?void 0:navigator.serviceWorker))return null;try{return(await navigator.serviceWorker.ready).active}catch(e){return null}}(),!this.activeServiceWorker)return;this.sender=new iS(this.activeServiceWorker);const n=await this.sender._send("ping",{},800);n&&(null===(e=n[0])||void 0===e?void 0:e.fulfilled)&&(null===(t=n[0])||void 0===t?void 0:t.value.includes("keyChanged"))&&(this.serviceWorkerReceiverAvailable=!0)}async notifyServiceWorker(e){if(this.sender&&this.activeServiceWorker&&function(){var e;return(null===(e=null===navigator||void 0===navigator?void 0:navigator.serviceWorker)||void 0===e?void 0:e.controller)||null}()===this.activeServiceWorker)try{await this.sender._send("keyChanged",{key:e},this.serviceWorkerReceiverAvailable?800:50)}catch(we){}}async _isAvailable(){try{if(!indexedDB)return!1;const e=await hS();return await fS(e,YE,"1"),await pS(e,YE),!0}catch(we){}return!1}async _withPendingWrite(e){this.pendingWrites++;try{await e()}finally{this.pendingWrites--}}async _set(e,t){return this._withPendingWrite(async()=>(await this._withRetries(n=>fS(n,e,t)),this.localCache[e]=t,this.notifyServiceWorker(e)))}async _get(e){const t=await this._withRetries(t=>async function(e,t){const n=dS(e,!1).get(t),r=await new uS(n).toPromise();return void 0===r?null:r.value}(t,e));return this.localCache[e]=t,t}async _remove(e){return this._withPendingWrite(async()=>(await this._withRetries(t=>pS(t,e)),delete this.localCache[e],this.notifyServiceWorker(e)))}async _poll(){const e=await this._withRetries(e=>{const t=dS(e,!1).getAll();return new uS(t).toPromise()});if(!e)return[];if(0!==this.pendingWrites)return[];const t=[],n=new Set;if(0!==e.length)for(const{fbase_key:r,value:i}of e)n.add(r),JSON.stringify(this.localCache[r])!==JSON.stringify(i)&&(this.notifyListeners(r,i),t.push(r));for(const r of Object.keys(this.localCache))this.localCache[r]&&!n.has(r)&&(this.notifyListeners(r,null),t.push(r));return t}notifyListeners(e,t){this.localCache[e]=t;const n=this.listeners[e];if(n)for(const r of Array.from(n))r(t)}startPolling(){this.stopPolling(),this.pollTimer=setInterval(async()=>this._poll(),800)}stopPolling(){this.pollTimer&&(clearInterval(this.pollTimer),this.pollTimer=null)}_addListener(e,t){0===Object.keys(this.listeners).length&&this.startPolling(),this.listeners[e]||(this.listeners[e]=new Set,this._get(e)),this.listeners[e].add(t)}_removeListener(e,t){this.listeners[e]&&(this.listeners[e].delete(t),0===this.listeners[e].size&&delete this.listeners[e]),0===Object.keys(this.listeners).length&&this.stopPolling()}}mS.type="LOCAL";const gS=mS;wE("rcb"),new wx(3e4,6e4);const yS="recaptcha";async function vS(e,t,n){var r;const i=await n.verify();try{let a;if(hx("string"===typeof i,e,"argument-error"),hx(n.type===yS,e,"argument-error"),a="string"===typeof t?{phoneNumber:t}:t,"session"in a){const t=a.session;if("phoneNumber"in a){hx("enroll"===t.type,e,"internal-error");const n=await function(e,t){return kx(e,"POST","/v2/accounts/mfaEnrollment:start",Sx(e,t))}(e,{idToken:t.credential,phoneEnrollmentInfo:{phoneNumber:a.phoneNumber,recaptchaToken:i}});return n.phoneSessionInfo.sessionInfo}{hx("signin"===t.type,e,"internal-error");const n=(null===(r=a.multiFactorHint)||void 0===r?void 0:r.uid)||a.multiFactorUid;hx(n,e,"missing-multi-factor-info");const o=await function(e,t){return kx(e,"POST","/v2/accounts/mfaSignIn:start",Sx(e,t))}(e,{mfaPendingCredential:t.credential,mfaEnrollmentId:n,phoneSignInInfo:{recaptchaToken:i}});return o.phoneResponseInfo.sessionInfo}}{const{sessionInfo:t}=await async function(e,t){return kx(e,"POST","/v1/accounts:sendVerificationCode",Sx(e,t))}(e,{phoneNumber:a.phoneNumber,recaptchaToken:i});return t}}finally{n._reset()}}class wS{constructor(e){this.providerId=wS.PROVIDER_ID,this.auth=mE(e)}verifyPhoneNumber(e,t){return vS(this.auth,e,lh(t))}static credential(e,t){return PE._fromVerification(e,t)}static credentialFromResult(e){const t=e;return wS.credentialFromTaggedObject(t)}static credentialFromError(e){return wS.credentialFromTaggedObject(e.customData||{})}static credentialFromTaggedObject(e){let{_tokenResponse:t}=e;if(!t)return null;const{phoneNumber:n,temporaryProof:r}=t;return n&&r?PE._fromTokenResponse(n,r):null}}function bS(e,t){return t?Xx(t):(hx(e._popupRedirectResolver,e,"argument-error"),e._popupRedirectResolver)}wS.PROVIDER_ID="phone",wS.PHONE_SIGN_IN_METHOD="phone";class _S extends TE{constructor(e){super("custom","custom"),this.params=e}_getIdTokenResponse(e){return OE(e,this._buildIdpRequest())}_linkToIdToken(e,t){return OE(e,this._buildIdpRequest(t))}_getReauthenticationResolver(e){return OE(e,this._buildIdpRequest())}_buildIdpRequest(e){const t={requestUri:this.params.requestUri,sessionId:this.params.sessionId,postBody:this.params.postBody,tenantId:this.params.tenantId,pendingToken:this.params.pendingToken,returnSecureToken:!0,returnIdpCredential:!0};return e&&(t.idToken=e),t}}function xS(e){return XE(e.auth,new _S(e),e.bypassAuthState)}function ES(e){const{auth:t,user:n}=e;return hx(n,t,"internal-error"),QE(n,new _S(e),e.bypassAuthState)}async function SS(e){const{auth:t,user:n}=e;return hx(n,t,"internal-error"),KE(n,new _S(e),e.bypassAuthState)}class kS{constructor(e,t,n,r){let i=arguments.length>4&&void 0!==arguments[4]&&arguments[4];this.auth=e,this.resolver=n,this.user=r,this.bypassAuthState=i,this.pendingPromise=null,this.eventManager=null,this.filter=Array.isArray(t)?t:[t]}execute(){return new Promise(async(e,t)=>{this.pendingPromise={resolve:e,reject:t};try{this.eventManager=await this.resolver._initialize(this.auth),await this.onExecution(),this.eventManager.registerConsumer(this)}catch(S_){this.reject(S_)}})}async onAuthEvent(e){const{urlResponse:t,sessionId:n,postBody:r,tenantId:i,error:a,type:o}=e;if(a)return void this.reject(a);const s={auth:this.auth,requestUri:t,sessionId:n,tenantId:i||void 0,postBody:r||void 0,user:this.user,bypassAuthState:this.bypassAuthState};try{this.resolve(await this.getIdpTask(o)(s))}catch(S_){this.reject(S_)}}onError(e){this.reject(e)}getIdpTask(e){switch(e){case"signInViaPopup":case"signInViaRedirect":return xS;case"linkViaPopup":case"linkViaRedirect":return SS;case"reauthViaPopup":case"reauthViaRedirect":return ES;default:sx(this.auth,"internal-error")}}resolve(e){px(this.pendingPromise,"Pending promise was never set"),this.pendingPromise.resolve(e),this.unregisterAndCleanUp()}reject(e){px(this.pendingPromise,"Pending promise was never set"),this.pendingPromise.reject(e),this.unregisterAndCleanUp()}unregisterAndCleanUp(){this.eventManager&&this.eventManager.unregisterConsumer(this),this.pendingPromise=null,this.cleanUp()}}const TS=new wx(2e3,1e4);class IS extends kS{constructor(e,t,n,r,i){super(e,t,r,i),this.provider=n,this.authWindow=null,this.pollId=null,IS.currentPopupAction&&IS.currentPopupAction.cancel(),IS.currentPopupAction=this}async executeNotNull(){const e=await this.execute();return hx(e,this.auth,"internal-error"),e}async onExecution(){px(1===this.filter.length,"Popup operations only handle one event");const e=rS();this.authWindow=await this.resolver._openPopup(this.auth,this.provider,this.filter[0],e),this.authWindow.associatedEvent=e,this.resolver._originValidation(this.auth).catch(e=>{this.reject(e)}),this.resolver._isIframeWebStorageSupported(this.auth,e=>{e||this.reject(cx(this.auth,"web-storage-unsupported"))}),this.pollUserCancellation()}get eventId(){var e;return(null===(e=this.authWindow)||void 0===e?void 0:e.associatedEvent)||null}cancel(){this.reject(cx(this.auth,"cancelled-popup-request"))}cleanUp(){this.authWindow&&this.authWindow.close(),this.pollId&&window.clearTimeout(this.pollId),this.authWindow=null,this.pollId=null,IS.currentPopupAction=null}pollUserCancellation(){const e=()=>{var t,n;(null===(n=null===(t=this.authWindow)||void 0===t?void 0:t.window)||void 0===n?void 0:n.closed)?this.pollId=window.setTimeout(()=>{this.pollId=null,this.reject(cx(this.auth,"popup-closed-by-user"))},8e3):this.pollId=window.setTimeout(e,TS.get())};e()}}IS.currentPopupAction=null;const CS=new Map;class AS extends kS{constructor(e,t){super(e,["signInViaRedirect","linkViaRedirect","reauthViaRedirect","unknown"],t,void 0,arguments.length>2&&void 0!==arguments[2]&&arguments[2]),this.eventId=null}async execute(){let e=CS.get(this.auth._key());if(!e){try{const t=await async function(e,t){const n=RS(t),r=NS(e);if(!await r._isAvailable())return!1;const i="true"===await r._get(n);return await r._remove(n),i}(this.resolver,this.auth),n=t?await super.execute():null;e=()=>Promise.resolve(n)}catch(S_){e=()=>Promise.reject(S_)}CS.set(this.auth._key(),e)}return this.bypassAuthState||CS.set(this.auth._key(),()=>Promise.resolve(null)),e()}async onAuthEvent(e){if("signInViaRedirect"===e.type)return super.onAuthEvent(e);if("unknown"!==e.type){if(e.eventId){const t=await this.auth._redirectUserForId(e.eventId);if(t)return this.user=t,super.onAuthEvent(e);this.resolve(null)}}else this.resolve(null)}async onExecution(){}cleanUp(){}}function OS(e,t){CS.set(e._key(),t)}function NS(e){return Xx(e._redirectPersistence)}function RS(e){return $x("pendingRedirect",e.config.apiKey,e.name)}async function PS(e,t){let n=arguments.length>2&&void 0!==arguments[2]&&arguments[2];if(xf(e.app))return Promise.reject(ux(e));const r=mE(e),i=bS(r,t),a=new AS(r,i,n),o=await a.execute();return o&&!n&&(delete o.user._redirectEventId,await r._persistUserIfCurrent(o.user),await r._setRedirectUser(null,t)),o}class DS{constructor(e){this.auth=e,this.cachedEventUids=new Set,this.consumers=new Set,this.queuedRedirectEvent=null,this.hasHandledPotentialRedirect=!1,this.lastProcessedEventTime=Date.now()}registerConsumer(e){this.consumers.add(e),this.queuedRedirectEvent&&this.isEventForConsumer(this.queuedRedirectEvent,e)&&(this.sendToConsumer(this.queuedRedirectEvent,e),this.saveEventToCache(this.queuedRedirectEvent),this.queuedRedirectEvent=null)}unregisterConsumer(e){this.consumers.delete(e)}onEvent(e){if(this.hasEventBeenHandled(e))return!1;let t=!1;return this.consumers.forEach(n=>{this.isEventForConsumer(e,n)&&(t=!0,this.sendToConsumer(e,n),this.saveEventToCache(e))}),this.hasHandledPotentialRedirect||!function(e){switch(e.type){case"signInViaRedirect":case"linkViaRedirect":case"reauthViaRedirect":return!0;case"unknown":return MS(e);default:return!1}}(e)||(this.hasHandledPotentialRedirect=!0,t||(this.queuedRedirectEvent=e,t=!0)),t}sendToConsumer(e,t){var n;if(e.error&&!MS(e)){const r=(null===(n=e.error.code)||void 0===n?void 0:n.split("auth/")[1])||"internal-error";t.onError(cx(this.auth,r))}else t.onAuthEvent(e)}isEventForConsumer(e,t){const n=null===t.eventId||!!e.eventId&&e.eventId===t.eventId;return t.filter.includes(e.type)&&n}hasEventBeenHandled(e){return Date.now()-this.lastProcessedEventTime>=6e5&&this.cachedEventUids.clear(),this.cachedEventUids.has(zS(e))}saveEventToCache(e){this.cachedEventUids.add(zS(e)),this.lastProcessedEventTime=Date.now()}}function zS(e){return[e.type,e.eventId,e.sessionId,e.tenantId].filter(e=>e).join("-")}function MS(e){let{type:t,error:n}=e;return"unknown"===t&&(null===n||void 0===n?void 0:n.code)==="auth/".concat("no-auth-event")}const LS=/^\d{1,3}\.\d{1,3}\.\d{1,3}\.\d{1,3}$/,US=/^https?/;async function BS(e){if(e.config.emulator)return;const{authorizedDomains:t}=await async function(e){return kx(e,"GET","/v1/projects",arguments.length>1&&void 0!==arguments[1]?arguments[1]:{})}(e);for(const n of t)try{if(FS(n))return}catch(we){}sx(e,"unauthorized-domain")}function FS(e){const t=mx(),{protocol:n,hostname:r}=new URL(t);if(e.startsWith("chrome-extension://")){const i=new URL(e);return""===i.hostname&&""===r?"chrome-extension:"===n&&e.replace("chrome-extension://","")===t.replace("chrome-extension://",""):"chrome-extension:"===n&&i.hostname===r}if(!US.test(n))return!1;if(LS.test(e))return r===e;const i=e.replace(/\./g,"\\.");return new RegExp("^(.+\\."+i+"|"+i+")$","i").test(r)}const jS=new wx(3e4,6e4);function VS(){const e=aS().___jsl;if(null===e||void 0===e?void 0:e.H)for(const t of Object.keys(e.H))if(e.H[t].r=e.H[t].r||[],e.H[t].L=e.H[t].L||[],e.H[t].r=[...e.H[t].L],e.CP)for(let n=0;n<e.CP.length;n++)e.CP[n]=null}function qS(e){return new Promise((t,n)=>{var r,i,a;function o(){VS(),gapi.load("gapi.iframes",{callback:()=>{t(gapi.iframes.getContext())},ontimeout:()=>{VS(),n(cx(e,"network-request-failed"))},timeout:jS.get()})}if(null===(i=null===(r=aS().gapi)||void 0===r?void 0:r.iframes)||void 0===i?void 0:i.Iframe)t(gapi.iframes.getContext());else{if(!(null===(a=aS().gapi)||void 0===a?void 0:a.load)){const t=wE("iframefcb");return aS()[t]=()=>{gapi.load?o():n(cx(e,"network-request-failed"))},vE("".concat(yE.gapiScript,"?onload=").concat(t)).catch(e=>n(e))}o()}}).catch(e=>{throw HS=null,e})}let HS=null;const WS=new wx(5e3,15e3),GS={style:{position:"absolute",top:"-100px",width:"1px",height:"1px"},"aria-hidden":"true",tabindex:"-1"},KS=new Map([["identitytoolkit.googleapis.com","p"],["staging-identitytoolkit.sandbox.googleapis.com","s"],["test-identitytoolkit.sandbox.googleapis.com","t"]]);function QS(e){const t=e.config;hx(t.authDomain,e,"auth-domain-config-required");const n=t.emulator?bx(t,"emulator/auth/iframe"):"https://".concat(e.config.authDomain,"/").concat("__/auth/iframe"),r={apiKey:t.apiKey,appName:e.name,v:kf},i=KS.get(e.config.apiHost);i&&(r.eid=i);const a=e._getFrameworks();return a.length&&(r.fw=a.join(",")),"".concat(n,"?").concat(ih(r).slice(1))}async function XS(e){const t=await function(e){return HS=HS||qS(e),HS}(e),n=aS().gapi;return hx(n,e,"internal-error"),t.open({where:document.body,url:QS(e),messageHandlersFilter:n.iframes.CROSS_ORIGIN_IFRAMES_FILTER,attributes:GS,dontclear:!0},t=>new Promise(async(n,r)=>{await t.restyle({setHideOnLeave:!1});const i=cx(e,"network-request-failed"),a=aS().setTimeout(()=>{r(i)},WS.get());function o(){aS().clearTimeout(a),n(t)}t.ping(o).then(o,()=>{r(i)})}))}const YS={location:"yes",resizable:"yes",statusbar:"yes",toolbar:"no"};class JS{constructor(e){this.window=e,this.associatedEvent=null}close(){if(this.window)try{this.window.close()}catch(S_){}}}function $S(e,t,n){let r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:500,i=arguments.length>4&&void 0!==arguments[4]?arguments[4]:600;const a=Math.max((window.screen.availHeight-i)/2,0).toString(),o=Math.max((window.screen.availWidth-r)/2,0).toString();let s="";const c=Object.assign(Object.assign({},YS),{width:r.toString(),height:i.toString(),top:a,left:o}),l=Yd().toLowerCase();n&&(s=rE(l)?"_blank":n),tE(l)&&(t=t||"http://localhost",c.scrollbars="yes");const u=Object.entries(c).reduce((e,t)=>{let[n,r]=t;return"".concat(e).concat(n,"=").concat(r,",")},"");if(function(){var e;return cE(arguments.length>0&&void 0!==arguments[0]?arguments[0]:Yd())&&!!(null===(e=window.navigator)||void 0===e?void 0:e.standalone)}(l)&&"_self"!==s)return function(e,t){const n=document.createElement("a");n.href=e,n.target=t;const r=document.createEvent("MouseEvent");r.initMouseEvent("click",!0,!0,window,1,0,0,0,0,!1,!1,!1,!1,1,null),n.dispatchEvent(r)}(t||"",s),new JS(null);const d=window.open(t||"",s,u);hx(d,e,"popup-blocked");try{d.focus()}catch(S_){}return new JS(d)}const ZS="__/auth/handler",ek="emulator/auth/handler",tk=encodeURIComponent("fac");async function nk(e,t,n,r,i,a){hx(e.config.authDomain,e,"auth-domain-config-required"),hx(e.config.apiKey,e,"invalid-api-key");const o={apiKey:e.config.apiKey,appName:e.name,authType:n,redirectUrl:r,v:kf,eventId:i};if(t instanceof ME){t.setDefaultLanguage(e.languageCode),o.providerId=t.providerId||"",function(e){for(const t in e)if(Object.prototype.hasOwnProperty.call(e,t))return!1;return!0}(t.getCustomParameters())||(o.customParameters=JSON.stringify(t.getCustomParameters()));for(const[e,t]of Object.entries(a||{}))o[e]=t}if(t instanceof LE){const e=t.getScopes().filter(e=>""!==e);e.length>0&&(o.scopes=e.join(","))}e.tenantId&&(o.tid=e.tenantId);const s=o;for(const u of Object.keys(s))void 0===s[u]&&delete s[u];const c=await e._getAppCheckToken(),l=c?"#".concat(tk,"=").concat(encodeURIComponent(c)):"";return"".concat(function(e){let{config:t}=e;if(!t.emulator)return"https://".concat(t.authDomain,"/").concat(ZS);return bx(t,ek)}(e),"?").concat(ih(s).slice(1)).concat(l)}const rk="webStorageSupport";const ik=class{constructor(){this.eventManagers={},this.iframes={},this.originValidationPromises={},this._redirectPersistence=tS,this._completeRedirectFn=PS,this._overrideRedirectResult=OS}async _openPopup(e,t,n,r){var i;px(null===(i=this.eventManagers[e._key()])||void 0===i?void 0:i.manager,"_initialize() not called before _openPopup()");return $S(e,await nk(e,t,n,mx(),r),rS())}async _openRedirect(e,t,n,r){await this._originValidation(e);return function(e){aS().location.href=e}(await nk(e,t,n,mx(),r)),new Promise(()=>{})}_initialize(e){const t=e._key();if(this.eventManagers[t]){const{manager:e,promise:n}=this.eventManagers[t];return e?Promise.resolve(e):(px(n,"If manager is not set, promise should be"),n)}const n=this.initAndGetManager(e);return this.eventManagers[t]={promise:n},n.catch(()=>{delete this.eventManagers[t]}),n}async initAndGetManager(e){const t=await XS(e),n=new DS(e);return t.register("authEvent",t=>{hx(null===t||void 0===t?void 0:t.authEvent,e,"invalid-auth-event");return{status:n.onEvent(t.authEvent)?"ACK":"ERROR"}},gapi.iframes.CROSS_ORIGIN_IFRAMES_FILTER),this.eventManagers[e._key()]={manager:n},this.iframes[e._key()]=t,n}_isIframeWebStorageSupported(e,t){this.iframes[e._key()].send(rk,{type:rk},n=>{var r;const i=null===(r=null===n||void 0===n?void 0:n[0])||void 0===r?void 0:r[rk];void 0!==i&&t(!!i),sx(e,"internal-error")},gapi.iframes.CROSS_ORIGIN_IFRAMES_FILTER)}_originValidation(e){const t=e._key();return this.originValidationPromises[t]||(this.originValidationPromises[t]=BS(e)),this.originValidationPromises[t]}get _shouldInitProactively(){return uE()||nE()||cE()}};var ak="@firebase/auth",ok="1.7.9";class sk{constructor(e){this.auth=e,this.internalListeners=new Map}getUid(){var e;return this.assertAuthConfigured(),(null===(e=this.auth.currentUser)||void 0===e?void 0:e.uid)||null}async getToken(e){if(this.assertAuthConfigured(),await this.auth._initializationPromise,!this.auth.currentUser)return null;return{accessToken:await this.auth.currentUser.getIdToken(e)}}addAuthTokenListener(e){if(this.assertAuthConfigured(),this.internalListeners.has(e))return;const t=this.auth.onIdTokenChanged(t=>{e((null===t||void 0===t?void 0:t.stsTokenManager.accessToken)||null)});this.internalListeners.set(e,t),this.updateProactiveRefresh()}removeAuthTokenListener(e){this.assertAuthConfigured();const t=this.internalListeners.get(e);t&&(this.internalListeners.delete(e),t(),this.updateProactiveRefresh())}assertAuthConfigured(){hx(this.auth._initializationPromise,"dependent-sdk-initialized-before-auth")}updateProactiveRefresh(){this.internalListeners.size>0?this.auth._startProactiveRefresh():this.auth._stopProactiveRefresh()}}const ck=Kd("authIdTokenMaxAge")||300;let lk=null;var uk,dk;uk={loadJS:e=>new Promise((t,n)=>{const r=document.createElement("script");r.setAttribute("src",e),r.onload=t,r.onerror=e=>{const t=cx("internal-error");t.customData=e,n(t)},r.type="text/javascript",r.charset="UTF-8",function(){var e,t;return null!==(t=null===(e=document.getElementsByTagName("head"))||void 0===e?void 0:e[0])&&void 0!==t?t:document}().appendChild(r)}),gapiScript:"https://apis.google.com/js/api.js",recaptchaV2Script:"https://www.google.com/recaptcha/api.js",recaptchaEnterpriseScript:"https://www.google.com/recaptcha/enterprise.js?render="},yE=uk,dk="Browser",bf(new uh("auth",(e,t)=>{let{options:n}=t;const r=e.getProvider("app").getImmediate(),i=e.getProvider("heartbeat"),a=e.getProvider("app-check-internal"),{apiKey:o,authDomain:s}=r.options;hx(o&&!o.includes(":"),"invalid-api-key",{appName:r.name});const c={apiKey:o,authDomain:s,clientPlatform:dk,apiHost:"identitytoolkit.googleapis.com",tokenApiHost:"securetoken.googleapis.com",apiScheme:"https",sdkClientVersion:dE(dk)},l=new pE(r,i,a,c);return function(e,t){const n=(null===t||void 0===t?void 0:t.persistence)||[],r=(Array.isArray(n)?n:[n]).map(Xx);(null===t||void 0===t?void 0:t.errorMap)&&e._updateErrorMap(t.errorMap),e._initializeWithPersistence(r,null===t||void 0===t?void 0:t.popupRedirectResolver)}(l,n),l},"PUBLIC").setInstantiationMode("EXPLICIT").setInstanceCreatedCallback((e,t,n)=>{e.getProvider("auth-internal").initialize()})),bf(new uh("auth-internal",e=>(e=>new sk(e))(mE(e.getProvider("auth").getImmediate())),"PRIVATE").setInstantiationMode("EXPLICIT")),Cf(ak,ok,function(e){switch(e){case"Node":return"node";case"ReactNative":return"rn";case"Worker":return"webworker";case"Cordova":return"cordova";case"WebExtension":return"web-extension";default:return}}(dk)),Cf(ak,ok,"esm2017");const hk=Tf({apiKey:"AIzaSyD0JXHO4DzfHocbMb7DzxFkMnllIEjt2n0",authDomain:"reef-health-monitor-c7263.firebaseapp.com",projectId:"reef-health-monitor-c7263",storageBucket:"reef-health-monitor-c7263.firebasestorage.app",messagingSenderId:"930786260606",appId:"1:930786260606:web:e0f0a3323cb8d2bd724a2f"}),fk=function(e,t){const n="string"==typeof e?e:t||"(default)",r=_f("object"==typeof e?e:If(),"firestore").getImmediate({identifier:n});if(!r._initialized){const e=Wd("firestore");e&&function(e,t,n){let r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{};var i;const a=(e=Tw(e,Cw))._getSettings(),o="".concat(t,":").concat(n);if("firestore.googleapis.com"!==a.host&&a.host!==o&&ap("Host has been set in both settings() and connectFirestoreEmulator(), emulator host will be used."),e._setSettings(Object.assign(Object.assign({},a),{host:o,ssl:!1})),r.mockUserToken){let t,n;if("string"==typeof r.mockUserToken)t=r.mockUserToken,n=Zf.MOCK_USER;else{t=Xd(r.mockUserToken,null===(i=e._app)||void 0===i?void 0:i.options.projectId);const a=r.mockUserToken.sub||r.mockUserToken.user_id;if(!a)throw new dp(up.INVALID_ARGUMENT,"mockUserToken must contain 'sub' or 'user_id' field!");n=new Zf(a)}e._authCredentials=new mp(new fp(t,n))}}(r,...e)}return r}(hk),pk=function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:If(),t=arguments.length>1?arguments[1]:void 0;e=lh(e);const n=_f(e,b_).getImmediate({identifier:t}),r=Wd("storage");return r&&function(e,t,n){let r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{};!function(e,t,n){let r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{};e.host="".concat(t,":").concat(n),e._protocol="http";const{mockUserToken:i}=r;i&&(e._overrideAuthToken="string"===typeof i?i:Xd(i,e.app.options.projectId))}(e,t,n,r)}(n,...r),n}(hk),mk=function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:If();const t=_f(e,"auth");if(t.isInitialized())return t.getImmediate();const n=function(e,t){const n=_f(e,"auth");if(n.isInitialized()){const e=n.getImmediate();if(nh(n.getOptions(),null!==t&&void 0!==t?t:{}))return e;sx(e,"already-initialized")}return n.initialize({options:t})}(e,{popupRedirectResolver:ik,persistence:[gS,ZE,tS]}),r=Kd("authTokenSyncURL");if(r&&"boolean"===typeof isSecureContext&&isSecureContext){const e=new URL(r,location.origin);if(location.origin===e.origin){const t=(i=e.toString(),async e=>{const t=e&&await e.getIdTokenResult(),n=t&&((new Date).getTime()-Date.parse(t.issuedAtTime))/1e3;if(n&&n>ck)return;const r=null===t||void 0===t?void 0:t.token;lk!==r&&(lk=r,await fetch(i,{method:r?"POST":"DELETE",headers:r?{Authorization:"Bearer ".concat(r)}:{}}))});!function(e,t,n){lh(e).beforeAuthStateChanged(t,n)}(n,t,()=>t(n.currentUser)),function(e,t,n,r){lh(e).onIdTokenChanged(t,n,r)}(n,e=>t(e))}}var i;const a=Hd("auth");return a&&EE(n,"http://".concat(a)),n}(hk);(async function(e){var t;if(xf(e.app))return Promise.reject(ux(e));const n=mE(e);if(await n._initializationPromise,null===(t=n.currentUser)||void 0===t?void 0:t.isAnonymous)return new qE({user:n.currentUser,providerId:null,operationType:"signIn"});const r=await VE(n,{returnSecureToken:!0}),i=await qE._fromIdTokenResponse(n,"signIn",r,!0);return await n._updateCurrentUser(i.user),i})(mk).catch(e=>{console.warn("Anonymous auth failed:",e)});const gk={GPS:"gps",DIVE_SITE:"dive_site",CUSTOM_SITE:"custom_site",GENERAL:"general"},yk=[{id:"coki_beach",name:"Coki Beach",island:"St. Thomas"},{id:"cow_and_calf",name:"Cow and Calf Rocks",island:"St. Thomas"},{id:"wreck_alley",name:"Wreck Alley",island:"St. Thomas"},{id:"french_cap",name:"French Cap",island:"St. Thomas"},{id:"hull_bay",name:"Hull Bay",island:"St. Thomas"},{id:"frederiksted_pier",name:"Frederiksted Pier",island:"St. Croix"},{id:"salt_river",name:"Salt River Canyon",island:"St. Croix"},{id:"cane_bay",name:"Cane Bay Wall",island:"St. Croix"},{id:"trunk_bay",name:"Trunk Bay",island:"St. John"},{id:"haulover_bay",name:"Haulover Bay",island:"St. John"}],vk=[{id:"st_thomas_north",name:"St. Thomas - North Shore"},{id:"st_thomas_south",name:"St. Thomas - South Shore"},{id:"st_thomas_east",name:"St. Thomas - East End"},{id:"st_thomas_west",name:"St. Thomas - West End"},{id:"st_croix_north",name:"St. Croix - North Shore"},{id:"st_croix_south",name:"St. Croix - South Shore"},{id:"st_john_north",name:"St. John - North Shore"},{id:"st_john_south",name:"St. John - South Shore"},{id:"water_island",name:"Water Island"}];async function wk(e){try{var t,n;const{imageFile:a,prediction:o,confidence:s,locationType:c,locationData:u,notes:d="",isSensitive:h=!1,waterTemp:f,depth:p}=e,m=await async function(e){const t={maxSizeMB:1,maxWidthOrHeight:1920,useWebWorker:!0,fileType:"image/jpeg"};try{return await ex(e,t)}catch(n){return console.error("Image compression failed:",n),e}}(a),g="".concat(Date.now(),"_").concat(Math.random().toString(36).substr(2,9)),y=(r=pk,i="coral-images/".concat(g,".jpg"),m_(r=lh(r),i)),v={contentType:"image/jpeg",customMetadata:{userId:(null===(t=mk.currentUser)||void 0===t?void 0:t.uid)||"anonymous",prediction:o,timestamp:(new Date).toISOString()}};await function(e,t,n){return d_(e=lh(e),t,n)}(y,m,v);const w=await function(e){return h_(e=lh(e))}(y);let b={type:c};switch(c){case gk.GPS:b=l(l({},b),{},{coordinates:u.coordinates,accuracy:u.accuracy,siteName:u.siteName||null});break;case gk.DIVE_SITE:b=l(l({},b),{},{siteId:u.siteId,siteName:u.siteName,island:u.island});break;case gk.CUSTOM_SITE:b=l(l({},b),{},{customSiteName:u.customSiteName,island:u.island||null,coordinates:u.coordinates||null,description:u.description||null});break;case gk.GENERAL:b=l(l({},b),{},{areaId:u.areaId,areaName:u.areaName})}const _=l(l(l({userId:(null===(n=mk.currentUser)||void 0===n?void 0:n.uid)||"anonymous",timestamp:kp.now(),prediction:o,confidence:s,imageUrl:w,imageId:g,location:b,isSensitive:h},f&&{waterTemp:f}),p&&{depth:p}),{},{notes:d,deviceInfo:{userAgent:navigator.userAgent,platform:navigator.platform,isIOS:/iPhone|iPad|iPod/.test(navigator.userAgent)}}),x=await ib(function(e,t){for(var n=arguments.length,r=new Array(n>2?n-2:0),i=2;i<n;i++)r[i-2]=arguments[i];if(e=lh(e),xw("collection","path",t),e instanceof Cw){const n=Cp.fromString(t,...r);return Sw(n),new Nw(e,null,n)}{if(!(e instanceof Ow||e instanceof Nw))throw new dp(up.INVALID_ARGUMENT,"Expected first argument to collection() to be a CollectionReference, a DocumentReference or FirebaseFirestore");const n=e._path.child(Cp.fromString(t,...r));return Sw(n),new Nw(e.firestore,null,n)}}(fk,"observations"),_);return console.log("\u2705 Observation saved to cloud:",x.id),{success:!0,id:x.id,imageUrl:w}}catch(a){return console.error("\u274c Failed to save observation:",a),{success:!1,error:a.message,queuedForRetry:!1}}var r,i}var bk=n(579);function _k(e){let{locationType:t,setLocationType:n,selectedSite:r,setSelectedSite:i,selectedArea:a,setSelectedArea:o,customSiteName:s,setCustomSiteName:c,customSiteIsland:l,setCustomSiteIsland:u,customSiteDescription:d,setCustomSiteDescription:h,useGPS:f,setUseGPS:p,isSensitive:m,setIsSensitive:g,notes:y,setNotes:v,onSave:w,onCancel:b,saving:_}=e;return(0,bk.jsx)("div",{className:"location-modal",children:(0,bk.jsxs)("div",{className:"location-modal-content",children:[(0,bk.jsx)("h3",{children:"\ud83d\udccd Where was this scan taken?"}),(0,bk.jsxs)("div",{className:"location-type-selector",children:[(0,bk.jsxs)("button",{className:t===gk.GPS?"active":"",onClick:()=>n(gk.GPS),children:[(0,bk.jsx)(Pd,{size:20}),"GPS"]}),(0,bk.jsxs)("button",{className:t===gk.DIVE_SITE?"active":"",onClick:()=>n(gk.DIVE_SITE),children:[(0,bk.jsx)(Dd,{size:20}),"Dive Site"]}),(0,bk.jsxs)("button",{className:t===gk.CUSTOM_SITE?"active":"",onClick:()=>n(gk.CUSTOM_SITE),children:[(0,bk.jsx)(Dd,{size:20}),"New Site"]}),(0,bk.jsxs)("button",{className:t===gk.GENERAL?"active":"",onClick:()=>n(gk.GENERAL),children:[(0,bk.jsx)(zd,{size:20}),"General"]})]}),t===gk.GPS&&(0,bk.jsxs)("div",{className:"location-option",children:[(0,bk.jsx)("p",{children:"Share exact GPS coordinates"}),(0,bk.jsxs)("label",{children:[(0,bk.jsx)("input",{type:"checkbox",checked:f,onChange:e=>p(e.target.checked)}),"Use my current location"]})]}),t===gk.DIVE_SITE&&(0,bk.jsxs)("div",{className:"location-option",children:[(0,bk.jsx)("p",{children:"Select a known dive site"}),(0,bk.jsxs)("select",{value:r||"",onChange:e=>i(e.target.value),className:"site-selector",children:[(0,bk.jsx)("option",{value:"",children:"-- Select Dive Site --"}),yk.map(e=>(0,bk.jsxs)("option",{value:e.id,children:[e.name," (",e.island,")"]},e.id))]})]}),t===gk.CUSTOM_SITE&&(0,bk.jsxs)("div",{className:"location-option",children:[(0,bk.jsx)("p",{children:"Create a new dive site"}),(0,bk.jsx)("input",{type:"text",placeholder:"Site name (e.g., 'Secret Garden')",value:s,onChange:e=>c(e.target.value),className:"custom-site-input"}),(0,bk.jsxs)("select",{value:l,onChange:e=>u(e.target.value),className:"island-selector",children:[(0,bk.jsx)("option",{value:"St. Thomas",children:"St. Thomas"}),(0,bk.jsx)("option",{value:"St. Croix",children:"St. Croix"}),(0,bk.jsx)("option",{value:"St. John",children:"St. John"}),(0,bk.jsx)("option",{value:"Water Island",children:"Water Island"})]}),(0,bk.jsx)("textarea",{placeholder:"Optional: Describe this site...",value:d,onChange:e=>h(e.target.value),className:"custom-site-description",rows:2}),(0,bk.jsxs)("label",{className:"custom-site-gps",children:[(0,bk.jsx)("input",{type:"checkbox",checked:f,onChange:e=>p(e.target.checked)}),"\ud83d\udccd Also save GPS coordinates"]}),(0,bk.jsx)("div",{className:"info-box",children:"\ud83d\udca1 This site will be added to the community database!"})]}),t===gk.GENERAL&&(0,bk.jsxs)("div",{className:"location-option",children:[(0,bk.jsx)("p",{children:"Select a general area"}),(0,bk.jsxs)("select",{value:a||"",onChange:e=>o(e.target.value),className:"area-selector",children:[(0,bk.jsx)("option",{value:"",children:"-- Select Area --"}),vk.map(e=>(0,bk.jsx)("option",{value:e.id,children:e.name},e.id))]})]}),(0,bk.jsx)("div",{className:"sensitive-toggle",children:(0,bk.jsxs)("label",{children:[(0,bk.jsx)(Md,{size:16}),(0,bk.jsx)("input",{type:"checkbox",checked:m,onChange:e=>g(e.target.checked)}),"Sensitive location (rare species)"]})}),(0,bk.jsx)("textarea",{placeholder:"Add notes (depth, conditions, etc.)",value:y,onChange:e=>v(e.target.value),className:"notes-input",rows:3}),(0,bk.jsxs)("div",{className:"modal-actions",children:[(0,bk.jsx)("button",{onClick:b,disabled:_,className:"cancel-btn",children:"Cancel"}),(0,bk.jsx)("button",{onClick:w,disabled:_,className:"save-btn",children:_?"Saving...":"Save to Cloud"})]})]})})}const xk=["Bleached Coral","Healthy Coral"];const Ek=function(){const[e,t]=(0,r.useState)(null),[n,i]=(0,r.useState)(!0),[a,o]=(0,r.useState)(!1),[s,c]=(0,r.useState)(null),[u,d]=(0,r.useState)([]),[h,w]=(0,r.useState)(!1),[b,_]=(0,r.useState)(null),x=(0,r.useRef)(null),E=(0,r.useRef)(null),S=(0,r.useRef)(null),[k,T]=(0,r.useState)(!1),[I,C]=(0,r.useState)(!1),[A,O]=(0,r.useState)(gk.DIVE_SITE),[N,R]=(0,r.useState)(null),[P,D]=(0,r.useState)(null),[z,M]=(0,r.useState)(""),[L,U]=(0,r.useState)("St. Thomas"),[B,F]=(0,r.useState)(""),[j,V]=(0,r.useState)(!0),[H,W]=(0,r.useState)(!1),[G,K]=(0,r.useState)(""),[Q,X]=(0,r.useState)(!1),[Y,$]=(0,r.useState)(null),[Z,ee]=(0,r.useState)(!1);(0,r.useEffect)(()=>{ne(),re(),te()},[]);const te=()=>{localStorage.getItem("reefMonitorWelcomeSeen")||ee(!0)},ne=async()=>{try{i(!0),_(null);const e=await J.create("/coral_model.onnx",{executionProviders:["wasm"]});t(e),i(!1)}catch(e){console.error("Error loading model:",e),_("Failed to load AI model. Please refresh the page."),i(!1)}},re=()=>{const e=localStorage.getItem("reefMonitorHistory");e&&d(JSON.parse(e))},ie=function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;const n=[l(l({},e),{},{timestamp:(new Date).toISOString(),id:Date.now(),cloudId:t,synced:!!t}),...u].slice(0,50);d(n),localStorage.setItem("reefMonitorHistory",JSON.stringify(n))},ae=async(t,r)=>{if(!e)return n?void setTimeout(()=>ae(t,r),500):void _("Model failed to load. Please refresh the page.");o(!0),_(null),$(r);try{const n=new Image;n.crossOrigin="anonymous",await new Promise((e,r)=>{n.onload=e,n.onerror=r,n.src=t});const r=await(i=n,new Promise(e=>{const t=document.createElement("canvas");t.width=224,t.height=224;const n=t.getContext("2d");n.drawImage(i,0,0,224,224);const r=n.getImageData(0,0,224,224).data,a=new Float32Array(150528);for(let i=0;i<r.length;i+=4){const e=i/4;a[3*e]=r[i]/255,a[3*e+1]=r[i+1]/255,a[3*e+2]=r[i+2]/255}e(a)})),a=new q("float32",r,[1,224,224,3]),s=e.inputNames[0],l={[s]:a},u=await e.run(l),d=u[Object.keys(u)[0]].data[0],h=1-d,f=d>.5,p={prediction:f?xk[1]:xk[0],confidence:(100*(f?d:h)).toFixed(1),allPredictions:[{label:xk[0],confidence:(100*h).toFixed(1)},{label:xk[1],confidence:(100*d).toFixed(1)}],imageUrl:t};c(p),o(!1),C(!0)}catch(a){console.error("Analysis error:",a),_("Failed to analyze image. Please try again."),o(!1)}var i},oe=e=>{const t=e.target.files[0];if(t){const e=new FileReader;e.onload=e=>{ae(e.target.result,t)},e.onerror=()=>{_("Failed to read image file.")},e.readAsDataURL(t)}},se=()=>new Promise(e=>{navigator.geolocation?navigator.geolocation.getCurrentPosition(t=>e({lat:t.coords.latitude,lng:t.coords.longitude,accuracy:t.coords.accuracy}),()=>e(null),{timeout:5e3}):e(null)}),ce=()=>{var e;if(null!==(e=S.current)&&void 0!==e&&e.srcObject){S.current.srcObject.getTracks().forEach(e=>e.stop())}T(!1)},le=e=>e.includes("Healthy")?"var(--coral-healthy)":e.includes("Bleached")?"var(--coral-warn)":e.includes("Dead")?"var(--coral-danger)":"var(--coral-disease)";return(0,bk.jsxs)("div",{className:"App",children:[(0,bk.jsxs)("header",{className:"header",children:[(0,bk.jsx)("h1",{children:"\ud83e\udeb8 Reef Monitor"}),(0,bk.jsx)("button",{className:"history-btn",onClick:()=>w(!h),children:(0,bk.jsx)(f,{size:24})})]}),n&&!b&&(0,bk.jsxs)("div",{className:"loading-screen",children:[(0,bk.jsx)(p,{className:"spinner",size:64}),(0,bk.jsx)("h2",{children:"Loading AI Model..."}),(0,bk.jsx)("p",{children:"Downloading coral health classifier (~77MB)"}),(0,bk.jsx)("p",{className:"loading-tip",children:"This only happens once!"})]}),I&&(0,bk.jsx)(_k,{locationType:A,setLocationType:O,selectedSite:N,setSelectedSite:R,selectedArea:P,setSelectedArea:D,customSiteName:z,setCustomSiteName:M,customSiteIsland:L,setCustomSiteIsland:U,customSiteDescription:B,setCustomSiteDescription:F,useGPS:j,setUseGPS:V,isSensitive:H,setIsSensitive:W,notes:G,setNotes:K,onSave:async()=>{try{X(!0);let e={};switch(A){case gk.GPS:if(j){const t=await se();if(!t)return alert("Could not get GPS location. Please try another option."),void X(!1);e={coordinates:{lat:t.lat,lng:t.lng},accuracy:t.accuracy}}break;case gk.DIVE_SITE:if(!N)return alert("Please select a dive site"),void X(!1);const t=yk.find(e=>e.name===N);t&&(e={siteName:t.name,island:t.island,coordinates:t.coordinates});break;case gk.CUSTOM_SITE:if(!z.trim())return alert("Please enter a site name"),void X(!1);if(e={siteName:z,island:L,description:B},j){const t=await se();t&&(e.coordinates={lat:t.lat,lng:t.lng},e.accuracy=t.accuracy)}break;case gk.GENERAL_AREA:if(!P)return alert("Please select an area"),void X(!1);const n=vk.find(e=>e.name===P);n&&(e={generalArea:n.name,approximateCoordinates:n.approximateCenter})}const t={prediction:s.prediction,confidence:parseFloat(s.confidence),allPredictions:s.allPredictions,timestamp:(new Date).toISOString(),locationType:A,location:e,isSensitive:H,notes:G.trim()},n=await wk(t);ie(s,n),C(!1),$(null),K(""),M(""),F(""),R(null),D(null),alert("Observation saved successfully! \ud83e\udeb8")}catch(e){console.error("Error saving observation:",e),alert("Failed to save to cloud, but saved locally. Check your connection."),ie(s,null),C(!1)}finally{X(!1)}},onCancel:()=>{C(!1),$(null)},saving:Q}),Z&&(0,bk.jsx)("div",{className:"welcome-overlay",children:(0,bk.jsxs)("div",{className:"welcome-modal",children:[(0,bk.jsxs)("div",{className:"welcome-header",children:[(0,bk.jsx)("h1",{children:"\ud83e\udeb8 Reef Monitor"}),(0,bk.jsx)("p",{className:"welcome-subtitle",children:"AI-Powered Coral Health Analysis"})]}),(0,bk.jsxs)("div",{className:"welcome-content",children:[(0,bk.jsxs)("p",{className:"welcome-developer",children:["Developed by ",(0,bk.jsx)("strong",{children:"Daniel Basick"})]}),(0,bk.jsx)("p",{className:"welcome-description",children:"An AI-powered tool for documenting coral health in the USVI. Built to support marine researchers, dive operators, and citizen scientists in tracking reef conditions over time."}),(0,bk.jsxs)("div",{className:"welcome-features",children:[(0,bk.jsxs)("div",{className:"welcome-feature",children:[(0,bk.jsx)("span",{className:"feature-icon",children:"\ud83e\udeb8"}),(0,bk.jsx)("span",{children:"Every scan helps build a community database"})]}),(0,bk.jsxs)("div",{className:"welcome-feature",children:[(0,bk.jsx)("span",{className:"feature-icon",children:"\ud83c\udf0a"}),(0,bk.jsx)("span",{children:"Your observations contribute to conservation efforts"})]})]}),(0,bk.jsxs)("p",{className:"welcome-contact",children:["Questions? ",(0,bk.jsx)("a",{href:"mailto:DaBasick@yahoo.com",children:"DaBasick@yahoo.com"})]})]}),(0,bk.jsx)("button",{className:"welcome-btn",onClick:()=>{localStorage.setItem("reefMonitorWelcomeSeen","true"),ee(!1)},children:"Get Started"})]})}),k&&(0,bk.jsxs)("div",{className:"camera-container",children:[(0,bk.jsx)("video",{ref:S,autoPlay:!0,playsInline:!0,className:"camera-preview"}),(0,bk.jsxs)("div",{className:"camera-controls",children:[(0,bk.jsx)("button",{className:"btn-secondary",onClick:ce,children:"Cancel"}),(0,bk.jsx)("button",{className:"btn-capture",onClick:()=>{const e=document.createElement("canvas");e.width=S.current.videoWidth,e.height=S.current.videoHeight;e.getContext("2d").drawImage(S.current,0,0),e.toBlob(e=>{const t=new File([e],"coral-".concat(Date.now(),".jpg"),{type:"image/jpeg"}),n=URL.createObjectURL(e);ce(),ae(n,t)},"image/jpeg",.95)},children:(0,bk.jsx)("div",{className:"capture-ring",children:(0,bk.jsx)("div",{className:"capture-dot"})})})]})]}),!k&&!h&&(0,bk.jsxs)("main",{className:"main",children:[!s&&!n&&(0,bk.jsxs)("div",{className:"action-section",children:[(0,bk.jsxs)("button",{className:"action-btn primary",onClick:()=>{var e;return null===(e=E.current)||void 0===e?void 0:e.click()},children:[(0,bk.jsx)(m,{size:32}),(0,bk.jsx)("span",{children:"Take Photo"})]}),(0,bk.jsxs)("button",{className:"action-btn secondary",onClick:()=>{var e;return null===(e=x.current)||void 0===e?void 0:e.click()},children:[(0,bk.jsx)(g,{size:32}),(0,bk.jsx)("span",{children:"Upload Image"})]}),(0,bk.jsx)("input",{ref:x,type:"file",accept:"image/*",onChange:oe,style:{display:"none"}}),(0,bk.jsx)("input",{ref:E,type:"file",accept:"image/*",capture:"environment",onChange:oe,style:{display:"none"}})]}),a&&(0,bk.jsxs)("div",{className:"analyzing",children:[(0,bk.jsx)(p,{className:"spinner",size:48}),(0,bk.jsx)("h2",{children:"Analyzing Coral Health..."}),(0,bk.jsx)("p",{children:"AI processing in progress"})]}),b&&!s&&!a&&(0,bk.jsxs)("div",{className:"error-banner",children:[(0,bk.jsx)(y,{size:20}),(0,bk.jsx)("span",{children:b})]}),s&&!a&&!I&&(0,bk.jsxs)("div",{className:"results",children:[(0,bk.jsx)("div",{className:"result-image",children:(0,bk.jsx)("img",{src:s.imageUrl,alt:"Analyzed coral"})}),(0,bk.jsxs)("div",{className:"result-card",children:[(0,bk.jsxs)("div",{className:"result-header",children:[(0,bk.jsx)("span",{className:"result-icon",children:(ue=s.prediction,ue.includes("Healthy")?"\ud83e\udeb8":ue.includes("Bleached")?"\u26a0\ufe0f":ue.includes("Dead")?"\ud83d\udc80":"\ud83e\udda0")}),(0,bk.jsxs)("div",{children:[(0,bk.jsx)("h2",{children:s.prediction}),(0,bk.jsxs)("p",{className:"confidence",children:[s.confidence,"% confidence"]})]})]}),(0,bk.jsx)("div",{className:"confidence-bar",children:(0,bk.jsx)("div",{className:"confidence-fill",style:{width:"".concat(s.confidence,"%"),backgroundColor:le(s.prediction)}})}),(0,bk.jsxs)("div",{className:"all-predictions",children:[(0,bk.jsx)("h3",{children:"Detailed Analysis"}),s.allPredictions.map((e,t)=>(0,bk.jsxs)("div",{className:"prediction-row",children:[(0,bk.jsx)("span",{className:"pred-label",children:e.label}),(0,bk.jsx)("div",{className:"pred-bar-container",children:(0,bk.jsx)("div",{className:"pred-bar",style:{width:"".concat(e.confidence,"%")}})}),(0,bk.jsxs)("span",{className:"pred-value",children:[e.confidence,"%"]})]},t))]}),(0,bk.jsxs)("button",{className:"btn-new-scan",onClick:()=>{c(null),_(null),$(null)},children:["New Scan",(0,bk.jsx)(v,{size:20})]})]})]}),!s&&!a&&!n&&(0,bk.jsxs)("div",{className:"info-card",children:[(0,bk.jsx)("h3",{children:"How It Works"}),(0,bk.jsxs)("ol",{children:[(0,bk.jsx)("li",{children:"Take or upload a photo of coral"}),(0,bk.jsx)("li",{children:"AI analyzes the health condition"}),(0,bk.jsx)("li",{children:"Add location details for the database"}),(0,bk.jsx)("li",{children:"Contribute to global reef health monitoring"})]})]})]}),h&&(0,bk.jsxs)("div",{className:"history-view",children:[(0,bk.jsxs)("div",{className:"history-header",children:[(0,bk.jsx)("h2",{children:"Scan History"}),(0,bk.jsx)("button",{onClick:()=>w(!1),children:"Close"})]}),0===u.length?(0,bk.jsxs)("div",{className:"empty-history",children:[(0,bk.jsx)(f,{size:64}),(0,bk.jsx)("p",{children:"No scans yet"})]}):(0,bk.jsx)("div",{className:"history-list",children:u.map(e=>(0,bk.jsxs)("div",{className:"history-item",children:[(0,bk.jsx)("img",{src:e.imageUrl,alt:"Historical scan"}),(0,bk.jsxs)("div",{className:"history-info",children:[(0,bk.jsx)("h4",{children:e.prediction}),(0,bk.jsxs)("p",{children:[e.confidence,"% confident"]}),(0,bk.jsx)("span",{className:"history-date",children:new Date(e.timestamp).toLocaleDateString()}),e.synced&&(0,bk.jsx)("span",{className:"cloud-badge",children:"\u2601\ufe0f"})]}),(0,bk.jsx)("div",{className:"history-indicator",style:{backgroundColor:le(e.prediction)}})]},e.id))})]}),(0,bk.jsxs)("footer",{className:"footer",children:[(0,bk.jsxs)("p",{children:["Developed by Daniel Basick \u2022 ",(0,bk.jsx)("a",{href:"mailto:DaBasick@yahoo.com",children:"DaBasick@yahoo.com"})]}),(0,bk.jsx)("p",{children:"Powered by AI \u2022 Built for Conservation"})]})]});var ue};i.render((0,bk.jsx)(r.StrictMode,{children:(0,bk.jsx)(Ek,{})}),document.getElementById("root"))})();
//# sourceMappingURL=main.dfb80cdb.js.map