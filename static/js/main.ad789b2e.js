/*! For license information please see main.ad789b2e.js.LICENSE.txt */
(()=>{var e={24:e=>{"use strict";e.exports="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABkAAAApCAYAAADAk4LOAAAFgUlEQVR4Aa1XA5BjWRTN2oW17d3YaZtr2962HUzbDNpjszW24mRt28p47v7zq/bXZtrp/lWnXr337j3nPCe85NcypgSFdugCpW5YoDAMRaIMqRi6aKq5E3YqDQO3qAwjVWrD8Ncq/RBpykd8oZUb/kaJutow8r1aP9II0WmLKLIsJyv1w/kqw9Ch2MYdB++12Onxee/QMwvf4/Dk/Lfp/i4nxTXtOoQ4pW5Aj7wpici1A9erdAN2OH64x8OSP9j3Ft3b7aWkTg/Fm91siTra0f9on5sQr9INejH6CUUUpavjFNq1B+Oadhxmnfa8RfEmN8VNAsQhPqF55xHkMzz3jSmChWU6f7/XZKNH+9+hBLOHYozuKQPxyMPUKkrX/K0uWnfFaJGS1QPRtZsOPtr3NsW0uyh6NNCOkU3Yz+bXbT3I8G3xE5EXLXtCXbbqwCO9zPQYPRTZ5vIDXD7U+w7rFDEoUUf7ibHIR4y6bLVPXrz8JVZEql13trxwue/uDivd3fkWRbS6/IA2bID4uk0UpF1N8qLlbBlXs4Ee7HLTfV1j54APvODnSfOWBqtKVvjgLKzF5YdEk5ewRkGlK0i33Eofffc7HT56jD7/6U+qH3Cx7SBLNntH5YIPvODnyfIXZYRVDPqgHtLs5ABHD3YzLuespb7t79FY34DjMwrVrcTuwlT55YMPvOBnRrJ4VXTdNnYug5ucHLBjEpt30701A3Ts+HEa73u6dT3FNWwflY86eMHPk+Yu+i6pzUpRrW7SNDg5JHR4KapmM5Wv2E8Tfcb1HoqqHMHU+uWDD7zg54mz5/2BSnizi9T1Dg4QQXLToGNCkb6tb1NU+QAlGr1++eADrzhn/u8Q2YZhQVlZ5+CAOtqfbhmaUCS1ezNFVm2imDbPmPng5wmz+gwh+oHDce0eUtQ6OGDIyR0uUhUsoO3vfDmmgOezH0mZN59x7MBi++WDL1g/eEiU3avlidO671bkLfwbw5XV2P8Pzo0ydy4t2/0eu33xYSOMOD8hTf4CrBtGMSoXfPLchX+J0ruSePw3LZeK0juPJbYzrhkH0io7B3k164hiGvawhOKMLkrQLyVpZg8rHFW7E2uHOL888IBPlNZ1FPzstSJM694fWr6RwpvcJK60+0HCILTBzZLFNdtAzJaohze60T8qBzyh5ZuOg5e7uwQppofEmf2++DYvmySqGBuKaicF1blQjhuHdvCIMvp8whTTfZzI7RldpwtSzL+F1+wkdZ2TBOW2gIF88PBTzD/gpeREAMEbxnJcaJHNHrpzji0gQCS6hdkEeYt9DF/2qPcEC8RM28Hwmr3sdNyht00byAut2k3gufWNtgtOEOFGUwcXWNDbdNbpgBGxEvKkOQsxivJx33iow0Vw5S6SVTrpVq11ysA2Rp7gTfPfktc6zhtXBBC+adRLshf6sG2RfHPZ5EAc4sVZ83yCN00Fk/4kggu40ZTvIEm5g24qtU4KjBrx/BTTH8ifVASAG7gKrnWxJDcU7x8X6Ecczhm3o6YicvsLXWfh3Ch1W0k8x0nXF+0fFxgt4phz8QvypiwCCFKMqXCnqXExjq10beH+UUA7+nG6mdG/Pu0f3LgFcGrl2s0kNNjpmoJ9o4B29CMO8dMT4Q5ox8uitF6fqsrJOr8qnwNbRzv6hSnG5wP+64C7h9lp30hKNtKdWjtdkbuPA19nJ7Tz3zR/ibgARbhb4AlhavcBebmTHcFl2fvYEnW0ox9xMxKBS8btJ+KiEbq9zA4RthQXDhPa0T9TEe69gWupwc6uBUphquXgf+/FrIjweHQS4/pduMe5ERUMHUd9xv8ZR98CxkS4F2n3EUrUZ10EYNw7BWm9x1GiPssi3GgiGRDKWRYZfXlON+dfNbM+GgIwYdwAAAAASUVORK5CYII="},43:(e,t,n)=>{"use strict";e.exports=n(202)},71:e=>{"use strict";e.exports="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACkAAAApCAQAAAACach9AAACMUlEQVR4Ae3ShY7jQBAE0Aoz/f9/HTMzhg1zrdKUrJbdx+Kd2nD8VNudfsL/Th///dyQN2TH6f3y/BGpC379rV+S+qqetBOxImNQXL8JCAr2V4iMQXHGNJxeCfZXhSRBcQMfvkOWUdtfzlLgAENmZDcmo2TVmt8OSM2eXxBp3DjHSMFutqS7SbmemzBiR+xpKCNUIRkdkkYxhAkyGoBvyQFEJEefwSmmvBfJuJ6aKqKWnAkvGZOaZXTUgFqYULWNSHUckZuR1HIIimUExutRxwzOLROIG4vKmCKQt364mIlhSyzAf1m9lHZHJZrlAOMMztRRiKimp/rpdJDc9Awry5xTZCte7FHtuS8wJgeYGrex28xNTd086Dik7vUMscQOa8y4DoGtCCSkAKlNwpgNtphjrC6MIHUkR6YWxxs6Sc5xqn222mmCRFzIt8lEdKx+ikCtg91qS2WpwVfBelJCiQJwvzixfI9cxZQWgiSJelKnwBElKYtDOb2MFbhmUigbReQBV0Cg4+qMXSxXSyGUn4UbF8l+7qdSGnTC0XLCmahIgUHLhLOhpVCtw4CzYXvLQWQbJNmxoCsOKAxSgBJno75avolkRw8iIAFcsdc02e9iyCd8tHwmeSSoKTowIgvscSGZUOA7PuCN5b2BX9mQM7S0wYhMNU74zgsPBj3HU7wguAfnxxjFQGBE6pwN+GjME9zHY7zGp8wVxMShYX9NXvEWD3HbwJf4giO4CFIQxXScH1/TM+04kkBiAAAAAElFTkSuQmCC"},98:(e,t,n)=>{"use strict";e.exports=n.p+"static/media/ort-wasm-simd-threaded.jsep.9b38a8c18d5f4d131491.wasm"},153:(e,t,n)=>{"use strict";var i=n(43),r=Symbol.for("react.element"),o=Symbol.for("react.fragment"),a=Object.prototype.hasOwnProperty,s=i.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED.ReactCurrentOwner,c={key:!0,ref:!0,__self:!0,__source:!0};function l(e,t,n){var i,o={},l=null,u=null;for(i in void 0!==n&&(l=""+n),void 0!==t.key&&(l=""+t.key),void 0!==t.ref&&(u=t.ref),t)a.call(t,i)&&!c.hasOwnProperty(i)&&(o[i]=t[i]);if(e&&e.defaultProps)for(i in t=e.defaultProps)void 0===o[i]&&(o[i]=t[i]);return{$$typeof:r,type:e,key:l,ref:u,props:o,_owner:s.current}}t.Fragment=o,t.jsx=l,t.jsxs=l},202:(e,t)=>{"use strict";var n=Symbol.for("react.element"),i=Symbol.for("react.portal"),r=Symbol.for("react.fragment"),o=Symbol.for("react.strict_mode"),a=Symbol.for("react.profiler"),s=Symbol.for("react.provider"),c=Symbol.for("react.context"),l=Symbol.for("react.forward_ref"),u=Symbol.for("react.suspense"),d=Symbol.for("react.memo"),h=Symbol.for("react.lazy"),f=Symbol.iterator;var p={isMounted:function(){return!1},enqueueForceUpdate:function(){},enqueueReplaceState:function(){},enqueueSetState:function(){}},m=Object.assign,g={};function y(e,t,n){this.props=e,this.context=t,this.refs=g,this.updater=n||p}function v(){}function _(e,t,n){this.props=e,this.context=t,this.refs=g,this.updater=n||p}y.prototype.isReactComponent={},y.prototype.setState=function(e,t){if("object"!==typeof e&&"function"!==typeof e&&null!=e)throw Error("setState(...): takes an object of state variables to update or a function which returns an object of state variables.");this.updater.enqueueSetState(this,e,t,"setState")},y.prototype.forceUpdate=function(e){this.updater.enqueueForceUpdate(this,e,"forceUpdate")},v.prototype=y.prototype;var w=_.prototype=new v;w.constructor=_,m(w,y.prototype),w.isPureReactComponent=!0;var b=Array.isArray,x=Object.prototype.hasOwnProperty,S={current:null},E={key:!0,ref:!0,__self:!0,__source:!0};function T(e,t,i){var r,o={},a=null,s=null;if(null!=t)for(r in void 0!==t.ref&&(s=t.ref),void 0!==t.key&&(a=""+t.key),t)x.call(t,r)&&!E.hasOwnProperty(r)&&(o[r]=t[r]);var c=arguments.length-2;if(1===c)o.children=i;else if(1<c){for(var l=Array(c),u=0;u<c;u++)l[u]=arguments[u+2];o.children=l}if(e&&e.defaultProps)for(r in c=e.defaultProps)void 0===o[r]&&(o[r]=c[r]);return{$$typeof:n,type:e,key:a,ref:s,props:o,_owner:S.current}}function k(e){return"object"===typeof e&&null!==e&&e.$$typeof===n}var C=/\/+/g;function I(e,t){return"object"===typeof e&&null!==e&&null!=e.key?function(e){var t={"=":"=0",":":"=2"};return"$"+e.replace(/[=:]/g,function(e){return t[e]})}(""+e.key):t.toString(36)}function A(e,t,r,o,a){var s=typeof e;"undefined"!==s&&"boolean"!==s||(e=null);var c=!1;if(null===e)c=!0;else switch(s){case"string":case"number":c=!0;break;case"object":switch(e.$$typeof){case n:case i:c=!0}}if(c)return a=a(c=e),e=""===o?"."+I(c,0):o,b(a)?(r="",null!=e&&(r=e.replace(C,"$&/")+"/"),A(a,t,r,"",function(e){return e})):null!=a&&(k(a)&&(a=function(e,t){return{$$typeof:n,type:e.type,key:t,ref:e.ref,props:e.props,_owner:e._owner}}(a,r+(!a.key||c&&c.key===a.key?"":(""+a.key).replace(C,"$&/")+"/")+e)),t.push(a)),1;if(c=0,o=""===o?".":o+":",b(e))for(var l=0;l<e.length;l++){var u=o+I(s=e[l],l);c+=A(s,t,r,u,a)}else if(u=function(e){return null===e||"object"!==typeof e?null:"function"===typeof(e=f&&e[f]||e["@@iterator"])?e:null}(e),"function"===typeof u)for(e=u.call(e),l=0;!(s=e.next()).done;)c+=A(s=s.value,t,r,u=o+I(s,l++),a);else if("object"===s)throw t=String(e),Error("Objects are not valid as a React child (found: "+("[object Object]"===t?"object with keys {"+Object.keys(e).join(", ")+"}":t)+"). If you meant to render a collection of children, use an array instead.");return c}function N(e,t,n){if(null==e)return e;var i=[],r=0;return A(e,i,"","",function(e){return t.call(n,e,r++)}),i}function O(e){if(-1===e._status){var t=e._result;(t=t()).then(function(t){0!==e._status&&-1!==e._status||(e._status=1,e._result=t)},function(t){0!==e._status&&-1!==e._status||(e._status=2,e._result=t)}),-1===e._status&&(e._status=0,e._result=t)}if(1===e._status)return e._result.default;throw e._result}var P={current:null},R={transition:null},L={ReactCurrentDispatcher:P,ReactCurrentBatchConfig:R,ReactCurrentOwner:S};function z(){throw Error("act(...) is not supported in production builds of React.")}t.Children={map:N,forEach:function(e,t,n){N(e,function(){t.apply(this,arguments)},n)},count:function(e){var t=0;return N(e,function(){t++}),t},toArray:function(e){return N(e,function(e){return e})||[]},only:function(e){if(!k(e))throw Error("React.Children.only expected to receive a single React element child.");return e}},t.Component=y,t.Fragment=r,t.Profiler=a,t.PureComponent=_,t.StrictMode=o,t.Suspense=u,t.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=L,t.act=z,t.cloneElement=function(e,t,i){if(null===e||void 0===e)throw Error("React.cloneElement(...): The argument must be a React element, but you passed "+e+".");var r=m({},e.props),o=e.key,a=e.ref,s=e._owner;if(null!=t){if(void 0!==t.ref&&(a=t.ref,s=S.current),void 0!==t.key&&(o=""+t.key),e.type&&e.type.defaultProps)var c=e.type.defaultProps;for(l in t)x.call(t,l)&&!E.hasOwnProperty(l)&&(r[l]=void 0===t[l]&&void 0!==c?c[l]:t[l])}var l=arguments.length-2;if(1===l)r.children=i;else if(1<l){c=Array(l);for(var u=0;u<l;u++)c[u]=arguments[u+2];r.children=c}return{$$typeof:n,type:e.type,key:o,ref:a,props:r,_owner:s}},t.createContext=function(e){return(e={$$typeof:c,_currentValue:e,_currentValue2:e,_threadCount:0,Provider:null,Consumer:null,_defaultValue:null,_globalName:null}).Provider={$$typeof:s,_context:e},e.Consumer=e},t.createElement=T,t.createFactory=function(e){var t=T.bind(null,e);return t.type=e,t},t.createRef=function(){return{current:null}},t.forwardRef=function(e){return{$$typeof:l,render:e}},t.isValidElement=k,t.lazy=function(e){return{$$typeof:h,_payload:{_status:-1,_result:e},_init:O}},t.memo=function(e,t){return{$$typeof:d,type:e,compare:void 0===t?null:t}},t.startTransition=function(e){var t=R.transition;R.transition={};try{e()}finally{R.transition=t}},t.unstable_act=z,t.useCallback=function(e,t){return P.current.useCallback(e,t)},t.useContext=function(e){return P.current.useContext(e)},t.useDebugValue=function(){},t.useDeferredValue=function(e){return P.current.useDeferredValue(e)},t.useEffect=function(e,t){return P.current.useEffect(e,t)},t.useId=function(){return P.current.useId()},t.useImperativeHandle=function(e,t,n){return P.current.useImperativeHandle(e,t,n)},t.useInsertionEffect=function(e,t){return P.current.useInsertionEffect(e,t)},t.useLayoutEffect=function(e,t){return P.current.useLayoutEffect(e,t)},t.useMemo=function(e,t){return P.current.useMemo(e,t)},t.useReducer=function(e,t,n){return P.current.useReducer(e,t,n)},t.useRef=function(e){return P.current.useRef(e)},t.useState=function(e){return P.current.useState(e)},t.useSyncExternalStore=function(e,t,n){return P.current.useSyncExternalStore(e,t,n)},t.useTransition=function(){return P.current.useTransition()},t.version="18.3.1"},228:function(e,t){!function(e){"use strict";var t="1.9.4";function n(e){var t,n,i,r;for(n=1,i=arguments.length;n<i;n++)for(t in r=arguments[n])e[t]=r[t];return e}var i=Object.create||function(){function e(){}return function(t){return e.prototype=t,new e}}();function r(e,t){var n=Array.prototype.slice;if(e.bind)return e.bind.apply(e,n.call(arguments,1));var i=n.call(arguments,2);return function(){return e.apply(t,i.length?i.concat(n.call(arguments)):arguments)}}var o=0;function a(e){return"_leaflet_id"in e||(e._leaflet_id=++o),e._leaflet_id}function s(e,t,n){var i,r,o,a;return a=function(){i=!1,r&&(o.apply(n,r),r=!1)},o=function(){i?r=arguments:(e.apply(n,arguments),setTimeout(a,t),i=!0)},o}function c(e,t,n){var i=t[1],r=t[0],o=i-r;return e===i&&n?e:((e-r)%o+o)%o+r}function l(){return!1}function u(e,t){if(!1===t)return e;var n=Math.pow(10,void 0===t?6:t);return Math.round(e*n)/n}function d(e){return e.trim?e.trim():e.replace(/^\s+|\s+$/g,"")}function h(e){return d(e).split(/\s+/)}function f(e,t){for(var n in Object.prototype.hasOwnProperty.call(e,"options")||(e.options=e.options?i(e.options):{}),t)e.options[n]=t[n];return e.options}function p(e,t,n){var i=[];for(var r in e)i.push(encodeURIComponent(n?r.toUpperCase():r)+"="+encodeURIComponent(e[r]));return(t&&-1!==t.indexOf("?")?"&":"?")+i.join("&")}var m=/\{ *([\w_ -]+) *\}/g;function g(e,t){return e.replace(m,function(e,n){var i=t[n];if(void 0===i)throw new Error("No value provided for variable "+e);return"function"===typeof i&&(i=i(t)),i})}var y=Array.isArray||function(e){return"[object Array]"===Object.prototype.toString.call(e)};function v(e,t){for(var n=0;n<e.length;n++)if(e[n]===t)return n;return-1}var _="data:image/gif;base64,R0lGODlhAQABAAD/ACwAAAAAAQABAAACADs=";function w(e){return window["webkit"+e]||window["moz"+e]||window["ms"+e]}var b=0;function x(e){var t=+new Date,n=Math.max(0,16-(t-b));return b=t+n,window.setTimeout(e,n)}var S=window.requestAnimationFrame||w("RequestAnimationFrame")||x,E=window.cancelAnimationFrame||w("CancelAnimationFrame")||w("CancelRequestAnimationFrame")||function(e){window.clearTimeout(e)};function T(e,t,n){if(!n||S!==x)return S.call(window,r(e,t));e.call(t)}function k(e){e&&E.call(window,e)}var C={__proto__:null,extend:n,create:i,bind:r,get lastId(){return o},stamp:a,throttle:s,wrapNum:c,falseFn:l,formatNum:u,trim:d,splitWords:h,setOptions:f,getParamString:p,template:g,isArray:y,indexOf:v,emptyImageUrl:_,requestFn:S,cancelFn:E,requestAnimFrame:T,cancelAnimFrame:k};function I(){}function A(e){if("undefined"!==typeof L&&L&&L.Mixin){e=y(e)?e:[e];for(var t=0;t<e.length;t++)e[t]===L.Mixin.Events&&console.warn("Deprecated include of L.Mixin.Events: this property will be removed in future releases, please inherit from L.Evented instead.",(new Error).stack)}}I.extend=function(e){var t=function(){f(this),this.initialize&&this.initialize.apply(this,arguments),this.callInitHooks()},r=t.__super__=this.prototype,o=i(r);for(var a in o.constructor=t,t.prototype=o,this)Object.prototype.hasOwnProperty.call(this,a)&&"prototype"!==a&&"__super__"!==a&&(t[a]=this[a]);return e.statics&&n(t,e.statics),e.includes&&(A(e.includes),n.apply(null,[o].concat(e.includes))),n(o,e),delete o.statics,delete o.includes,o.options&&(o.options=r.options?i(r.options):{},n(o.options,e.options)),o._initHooks=[],o.callInitHooks=function(){if(!this._initHooksCalled){r.callInitHooks&&r.callInitHooks.call(this),this._initHooksCalled=!0;for(var e=0,t=o._initHooks.length;e<t;e++)o._initHooks[e].call(this)}},t},I.include=function(e){var t=this.prototype.options;return n(this.prototype,e),e.options&&(this.prototype.options=t,this.mergeOptions(e.options)),this},I.mergeOptions=function(e){return n(this.prototype.options,e),this},I.addInitHook=function(e){var t=Array.prototype.slice.call(arguments,1),n="function"===typeof e?e:function(){this[e].apply(this,t)};return this.prototype._initHooks=this.prototype._initHooks||[],this.prototype._initHooks.push(n),this};var N={on:function(e,t,n){if("object"===typeof e)for(var i in e)this._on(i,e[i],t);else for(var r=0,o=(e=h(e)).length;r<o;r++)this._on(e[r],t,n);return this},off:function(e,t,n){if(arguments.length)if("object"===typeof e)for(var i in e)this._off(i,e[i],t);else{e=h(e);for(var r=1===arguments.length,o=0,a=e.length;o<a;o++)r?this._off(e[o]):this._off(e[o],t,n)}else delete this._events;return this},_on:function(e,t,n,i){if("function"===typeof t){if(!1===this._listens(e,t,n)){n===this&&(n=void 0);var r={fn:t,ctx:n};i&&(r.once=!0),this._events=this._events||{},this._events[e]=this._events[e]||[],this._events[e].push(r)}}else console.warn("wrong listener type: "+typeof t)},_off:function(e,t,n){var i,r,o;if(this._events&&(i=this._events[e]))if(1!==arguments.length)if("function"===typeof t){var a=this._listens(e,t,n);if(!1!==a){var s=i[a];this._firingCount&&(s.fn=l,this._events[e]=i=i.slice()),i.splice(a,1)}}else console.warn("wrong listener type: "+typeof t);else{if(this._firingCount)for(r=0,o=i.length;r<o;r++)i[r].fn=l;delete this._events[e]}},fire:function(e,t,i){if(!this.listens(e,i))return this;var r=n({},t,{type:e,target:this,sourceTarget:t&&t.sourceTarget||this});if(this._events){var o=this._events[e];if(o){this._firingCount=this._firingCount+1||1;for(var a=0,s=o.length;a<s;a++){var c=o[a],l=c.fn;c.once&&this.off(e,l,c.ctx),l.call(c.ctx||this,r)}this._firingCount--}}return i&&this._propagateEvent(r),this},listens:function(e,t,n,i){"string"!==typeof e&&console.warn('"string" type argument expected');var r=t;"function"!==typeof t&&(i=!!t,r=void 0,n=void 0);var o=this._events&&this._events[e];if(o&&o.length&&!1!==this._listens(e,r,n))return!0;if(i)for(var a in this._eventParents)if(this._eventParents[a].listens(e,t,n,i))return!0;return!1},_listens:function(e,t,n){if(!this._events)return!1;var i=this._events[e]||[];if(!t)return!!i.length;n===this&&(n=void 0);for(var r=0,o=i.length;r<o;r++)if(i[r].fn===t&&i[r].ctx===n)return r;return!1},once:function(e,t,n){if("object"===typeof e)for(var i in e)this._on(i,e[i],t,!0);else for(var r=0,o=(e=h(e)).length;r<o;r++)this._on(e[r],t,n,!0);return this},addEventParent:function(e){return this._eventParents=this._eventParents||{},this._eventParents[a(e)]=e,this},removeEventParent:function(e){return this._eventParents&&delete this._eventParents[a(e)],this},_propagateEvent:function(e){for(var t in this._eventParents)this._eventParents[t].fire(e.type,n({layer:e.target,propagatedFrom:e.target},e),!0)}};N.addEventListener=N.on,N.removeEventListener=N.clearAllEventListeners=N.off,N.addOneTimeEventListener=N.once,N.fireEvent=N.fire,N.hasEventListeners=N.listens;var O=I.extend(N);function P(e,t,n){this.x=n?Math.round(e):e,this.y=n?Math.round(t):t}var R=Math.trunc||function(e){return e>0?Math.floor(e):Math.ceil(e)};function z(e,t,n){return e instanceof P?e:y(e)?new P(e[0],e[1]):void 0===e||null===e?e:"object"===typeof e&&"x"in e&&"y"in e?new P(e.x,e.y):new P(e,t,n)}function M(e,t){if(e)for(var n=t?[e,t]:e,i=0,r=n.length;i<r;i++)this.extend(n[i])}function D(e,t){return!e||e instanceof M?e:new M(e,t)}function B(e,t){if(e)for(var n=t?[e,t]:e,i=0,r=n.length;i<r;i++)this.extend(n[i])}function U(e,t){return e instanceof B?e:new B(e,t)}function F(e,t,n){if(isNaN(e)||isNaN(t))throw new Error("Invalid LatLng object: ("+e+", "+t+")");this.lat=+e,this.lng=+t,void 0!==n&&(this.alt=+n)}function j(e,t,n){return e instanceof F?e:y(e)&&"object"!==typeof e[0]?3===e.length?new F(e[0],e[1],e[2]):2===e.length?new F(e[0],e[1]):null:void 0===e||null===e?e:"object"===typeof e&&"lat"in e?new F(e.lat,"lng"in e?e.lng:e.lon,e.alt):void 0===t?null:new F(e,t,n)}P.prototype={clone:function(){return new P(this.x,this.y)},add:function(e){return this.clone()._add(z(e))},_add:function(e){return this.x+=e.x,this.y+=e.y,this},subtract:function(e){return this.clone()._subtract(z(e))},_subtract:function(e){return this.x-=e.x,this.y-=e.y,this},divideBy:function(e){return this.clone()._divideBy(e)},_divideBy:function(e){return this.x/=e,this.y/=e,this},multiplyBy:function(e){return this.clone()._multiplyBy(e)},_multiplyBy:function(e){return this.x*=e,this.y*=e,this},scaleBy:function(e){return new P(this.x*e.x,this.y*e.y)},unscaleBy:function(e){return new P(this.x/e.x,this.y/e.y)},round:function(){return this.clone()._round()},_round:function(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this},floor:function(){return this.clone()._floor()},_floor:function(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this},ceil:function(){return this.clone()._ceil()},_ceil:function(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this},trunc:function(){return this.clone()._trunc()},_trunc:function(){return this.x=R(this.x),this.y=R(this.y),this},distanceTo:function(e){var t=(e=z(e)).x-this.x,n=e.y-this.y;return Math.sqrt(t*t+n*n)},equals:function(e){return(e=z(e)).x===this.x&&e.y===this.y},contains:function(e){return e=z(e),Math.abs(e.x)<=Math.abs(this.x)&&Math.abs(e.y)<=Math.abs(this.y)},toString:function(){return"Point("+u(this.x)+", "+u(this.y)+")"}},M.prototype={extend:function(e){var t,n;if(!e)return this;if(e instanceof P||"number"===typeof e[0]||"x"in e)t=n=z(e);else if(t=(e=D(e)).min,n=e.max,!t||!n)return this;return this.min||this.max?(this.min.x=Math.min(t.x,this.min.x),this.max.x=Math.max(n.x,this.max.x),this.min.y=Math.min(t.y,this.min.y),this.max.y=Math.max(n.y,this.max.y)):(this.min=t.clone(),this.max=n.clone()),this},getCenter:function(e){return z((this.min.x+this.max.x)/2,(this.min.y+this.max.y)/2,e)},getBottomLeft:function(){return z(this.min.x,this.max.y)},getTopRight:function(){return z(this.max.x,this.min.y)},getTopLeft:function(){return this.min},getBottomRight:function(){return this.max},getSize:function(){return this.max.subtract(this.min)},contains:function(e){var t,n;return(e="number"===typeof e[0]||e instanceof P?z(e):D(e))instanceof M?(t=e.min,n=e.max):t=n=e,t.x>=this.min.x&&n.x<=this.max.x&&t.y>=this.min.y&&n.y<=this.max.y},intersects:function(e){e=D(e);var t=this.min,n=this.max,i=e.min,r=e.max,o=r.x>=t.x&&i.x<=n.x,a=r.y>=t.y&&i.y<=n.y;return o&&a},overlaps:function(e){e=D(e);var t=this.min,n=this.max,i=e.min,r=e.max,o=r.x>t.x&&i.x<n.x,a=r.y>t.y&&i.y<n.y;return o&&a},isValid:function(){return!(!this.min||!this.max)},pad:function(e){var t=this.min,n=this.max,i=Math.abs(t.x-n.x)*e,r=Math.abs(t.y-n.y)*e;return D(z(t.x-i,t.y-r),z(n.x+i,n.y+r))},equals:function(e){return!!e&&(e=D(e),this.min.equals(e.getTopLeft())&&this.max.equals(e.getBottomRight()))}},B.prototype={extend:function(e){var t,n,i=this._southWest,r=this._northEast;if(e instanceof F)t=e,n=e;else{if(!(e instanceof B))return e?this.extend(j(e)||U(e)):this;if(t=e._southWest,n=e._northEast,!t||!n)return this}return i||r?(i.lat=Math.min(t.lat,i.lat),i.lng=Math.min(t.lng,i.lng),r.lat=Math.max(n.lat,r.lat),r.lng=Math.max(n.lng,r.lng)):(this._southWest=new F(t.lat,t.lng),this._northEast=new F(n.lat,n.lng)),this},pad:function(e){var t=this._southWest,n=this._northEast,i=Math.abs(t.lat-n.lat)*e,r=Math.abs(t.lng-n.lng)*e;return new B(new F(t.lat-i,t.lng-r),new F(n.lat+i,n.lng+r))},getCenter:function(){return new F((this._southWest.lat+this._northEast.lat)/2,(this._southWest.lng+this._northEast.lng)/2)},getSouthWest:function(){return this._southWest},getNorthEast:function(){return this._northEast},getNorthWest:function(){return new F(this.getNorth(),this.getWest())},getSouthEast:function(){return new F(this.getSouth(),this.getEast())},getWest:function(){return this._southWest.lng},getSouth:function(){return this._southWest.lat},getEast:function(){return this._northEast.lng},getNorth:function(){return this._northEast.lat},contains:function(e){e="number"===typeof e[0]||e instanceof F||"lat"in e?j(e):U(e);var t,n,i=this._southWest,r=this._northEast;return e instanceof B?(t=e.getSouthWest(),n=e.getNorthEast()):t=n=e,t.lat>=i.lat&&n.lat<=r.lat&&t.lng>=i.lng&&n.lng<=r.lng},intersects:function(e){e=U(e);var t=this._southWest,n=this._northEast,i=e.getSouthWest(),r=e.getNorthEast(),o=r.lat>=t.lat&&i.lat<=n.lat,a=r.lng>=t.lng&&i.lng<=n.lng;return o&&a},overlaps:function(e){e=U(e);var t=this._southWest,n=this._northEast,i=e.getSouthWest(),r=e.getNorthEast(),o=r.lat>t.lat&&i.lat<n.lat,a=r.lng>t.lng&&i.lng<n.lng;return o&&a},toBBoxString:function(){return[this.getWest(),this.getSouth(),this.getEast(),this.getNorth()].join(",")},equals:function(e,t){return!!e&&(e=U(e),this._southWest.equals(e.getSouthWest(),t)&&this._northEast.equals(e.getNorthEast(),t))},isValid:function(){return!(!this._southWest||!this._northEast)}},F.prototype={equals:function(e,t){return!!e&&(e=j(e),Math.max(Math.abs(this.lat-e.lat),Math.abs(this.lng-e.lng))<=(void 0===t?1e-9:t))},toString:function(e){return"LatLng("+u(this.lat,e)+", "+u(this.lng,e)+")"},distanceTo:function(e){return q.distance(this,j(e))},wrap:function(){return q.wrapLatLng(this)},toBounds:function(e){var t=180*e/40075017,n=t/Math.cos(Math.PI/180*this.lat);return U([this.lat-t,this.lng-n],[this.lat+t,this.lng+n])},clone:function(){return new F(this.lat,this.lng,this.alt)}};var V={latLngToPoint:function(e,t){var n=this.projection.project(e),i=this.scale(t);return this.transformation._transform(n,i)},pointToLatLng:function(e,t){var n=this.scale(t),i=this.transformation.untransform(e,n);return this.projection.unproject(i)},project:function(e){return this.projection.project(e)},unproject:function(e){return this.projection.unproject(e)},scale:function(e){return 256*Math.pow(2,e)},zoom:function(e){return Math.log(e/256)/Math.LN2},getProjectedBounds:function(e){if(this.infinite)return null;var t=this.projection.bounds,n=this.scale(e);return new M(this.transformation.transform(t.min,n),this.transformation.transform(t.max,n))},infinite:!1,wrapLatLng:function(e){var t=this.wrapLng?c(e.lng,this.wrapLng,!0):e.lng;return new F(this.wrapLat?c(e.lat,this.wrapLat,!0):e.lat,t,e.alt)},wrapLatLngBounds:function(e){var t=e.getCenter(),n=this.wrapLatLng(t),i=t.lat-n.lat,r=t.lng-n.lng;if(0===i&&0===r)return e;var o=e.getSouthWest(),a=e.getNorthEast();return new B(new F(o.lat-i,o.lng-r),new F(a.lat-i,a.lng-r))}},q=n({},V,{wrapLng:[-180,180],R:6371e3,distance:function(e,t){var n=Math.PI/180,i=e.lat*n,r=t.lat*n,o=Math.sin((t.lat-e.lat)*n/2),a=Math.sin((t.lng-e.lng)*n/2),s=o*o+Math.cos(i)*Math.cos(r)*a*a,c=2*Math.atan2(Math.sqrt(s),Math.sqrt(1-s));return this.R*c}}),H=6378137,W={R:H,MAX_LATITUDE:85.0511287798,project:function(e){var t=Math.PI/180,n=this.MAX_LATITUDE,i=Math.max(Math.min(n,e.lat),-n),r=Math.sin(i*t);return new P(this.R*e.lng*t,this.R*Math.log((1+r)/(1-r))/2)},unproject:function(e){var t=180/Math.PI;return new F((2*Math.atan(Math.exp(e.y/this.R))-Math.PI/2)*t,e.x*t/this.R)},bounds:function(){var e=H*Math.PI;return new M([-e,-e],[e,e])}()};function G(e,t,n,i){if(y(e))return this._a=e[0],this._b=e[1],this._c=e[2],void(this._d=e[3]);this._a=e,this._b=t,this._c=n,this._d=i}function K(e,t,n,i){return new G(e,t,n,i)}G.prototype={transform:function(e,t){return this._transform(e.clone(),t)},_transform:function(e,t){return t=t||1,e.x=t*(this._a*e.x+this._b),e.y=t*(this._c*e.y+this._d),e},untransform:function(e,t){return t=t||1,new P((e.x/t-this._b)/this._a,(e.y/t-this._d)/this._c)}};var Z=n({},q,{code:"EPSG:3857",projection:W,transformation:function(){var e=.5/(Math.PI*W.R);return K(e,.5,-e,.5)}()}),Q=n({},Z,{code:"EPSG:900913"});function X(e){return document.createElementNS("http://www.w3.org/2000/svg",e)}function Y(e,t){var n,i,r,o,a,s,c="";for(n=0,r=e.length;n<r;n++){for(i=0,o=(a=e[n]).length;i<o;i++)c+=(i?"L":"M")+(s=a[i]).x+" "+s.y;c+=t?Me.svg?"z":"x":""}return c||"M0 0"}var J=document.documentElement.style,$="ActiveXObject"in window,ee=$&&!document.addEventListener,te="msLaunchUri"in navigator&&!("documentMode"in document),ne=ze("webkit"),ie=ze("android"),re=ze("android 2")||ze("android 3"),oe=parseInt(/WebKit\/([0-9]+)|$/.exec(navigator.userAgent)[1],10),ae=ie&&ze("Google")&&oe<537&&!("AudioNode"in window),se=!!window.opera,ce=!te&&ze("chrome"),le=ze("gecko")&&!ne&&!se&&!$,ue=!ce&&ze("safari"),de=ze("phantom"),he="OTransition"in J,fe=0===navigator.platform.indexOf("Win"),pe=$&&"transition"in J,me="WebKitCSSMatrix"in window&&"m11"in new window.WebKitCSSMatrix&&!re,ge="MozPerspective"in J,ye=!window.L_DISABLE_3D&&(pe||me||ge)&&!he&&!de,ve="undefined"!==typeof orientation||ze("mobile"),_e=ve&&ne,we=ve&&me,be=!window.PointerEvent&&window.MSPointerEvent,xe=!(!window.PointerEvent&&!be),Se="ontouchstart"in window||!!window.TouchEvent,Ee=!window.L_NO_TOUCH&&(Se||xe),Te=ve&&se,ke=ve&&le,Ce=(window.devicePixelRatio||window.screen.deviceXDPI/window.screen.logicalXDPI)>1,Ie=function(){var e=!1;try{var t=Object.defineProperty({},"passive",{get:function(){e=!0}});window.addEventListener("testPassiveEventSupport",l,t),window.removeEventListener("testPassiveEventSupport",l,t)}catch(n){}return e}(),Ae=!!document.createElement("canvas").getContext,Ne=!(!document.createElementNS||!X("svg").createSVGRect),Oe=!!Ne&&function(){var e=document.createElement("div");return e.innerHTML="<svg/>","http://www.w3.org/2000/svg"===(e.firstChild&&e.firstChild.namespaceURI)}(),Pe=!Ne&&function(){try{var e=document.createElement("div");e.innerHTML='<v:shape adj="1"/>';var t=e.firstChild;return t.style.behavior="url(#default#VML)",t&&"object"===typeof t.adj}catch(n){return!1}}(),Re=0===navigator.platform.indexOf("Mac"),Le=0===navigator.platform.indexOf("Linux");function ze(e){return navigator.userAgent.toLowerCase().indexOf(e)>=0}var Me={ie:$,ielt9:ee,edge:te,webkit:ne,android:ie,android23:re,androidStock:ae,opera:se,chrome:ce,gecko:le,safari:ue,phantom:de,opera12:he,win:fe,ie3d:pe,webkit3d:me,gecko3d:ge,any3d:ye,mobile:ve,mobileWebkit:_e,mobileWebkit3d:we,msPointer:be,pointer:xe,touch:Ee,touchNative:Se,mobileOpera:Te,mobileGecko:ke,retina:Ce,passiveEvents:Ie,canvas:Ae,svg:Ne,vml:Pe,inlineSvg:Oe,mac:Re,linux:Le},De=Me.msPointer?"MSPointerDown":"pointerdown",Be=Me.msPointer?"MSPointerMove":"pointermove",Ue=Me.msPointer?"MSPointerUp":"pointerup",Fe=Me.msPointer?"MSPointerCancel":"pointercancel",je={touchstart:De,touchmove:Be,touchend:Ue,touchcancel:Fe},Ve={touchstart:Je,touchmove:Ye,touchend:Ye,touchcancel:Ye},qe={},He=!1;function We(e,t,n){return"touchstart"===t&&Xe(),Ve[t]?(n=Ve[t].bind(this,n),e.addEventListener(je[t],n,!1),n):(console.warn("wrong event specified:",t),l)}function Ge(e,t,n){je[t]?e.removeEventListener(je[t],n,!1):console.warn("wrong event specified:",t)}function Ke(e){qe[e.pointerId]=e}function Ze(e){qe[e.pointerId]&&(qe[e.pointerId]=e)}function Qe(e){delete qe[e.pointerId]}function Xe(){He||(document.addEventListener(De,Ke,!0),document.addEventListener(Be,Ze,!0),document.addEventListener(Ue,Qe,!0),document.addEventListener(Fe,Qe,!0),He=!0)}function Ye(e,t){if(t.pointerType!==(t.MSPOINTER_TYPE_MOUSE||"mouse")){for(var n in t.touches=[],qe)t.touches.push(qe[n]);t.changedTouches=[t],e(t)}}function Je(e,t){t.MSPOINTER_TYPE_TOUCH&&t.pointerType===t.MSPOINTER_TYPE_TOUCH&&Kt(t),Ye(e,t)}function $e(e){var t,n,i={};for(n in e)t=e[n],i[n]=t&&t.bind?t.bind(e):t;return e=i,i.type="dblclick",i.detail=2,i.isTrusted=!1,i._simulated=!0,i}var et=200;function tt(e,t){e.addEventListener("dblclick",t);var n,i=0;function r(e){if(1===e.detail){if("mouse"!==e.pointerType&&(!e.sourceCapabilities||e.sourceCapabilities.firesTouchEvents)){var r=Qt(e);if(!r.some(function(e){return e instanceof HTMLLabelElement&&e.attributes.for})||r.some(function(e){return e instanceof HTMLInputElement||e instanceof HTMLSelectElement})){var o=Date.now();o-i<=et?2===++n&&t($e(e)):n=1,i=o}}}else n=e.detail}return e.addEventListener("click",r),{dblclick:t,simDblclick:r}}function nt(e,t){e.removeEventListener("dblclick",t.dblclick),e.removeEventListener("click",t.simDblclick)}var it,rt,ot,at,st,ct=Tt(["transform","webkitTransform","OTransform","MozTransform","msTransform"]),lt=Tt(["webkitTransition","transition","OTransition","MozTransition","msTransition"]),ut="webkitTransition"===lt||"OTransition"===lt?lt+"End":"transitionend";function dt(e){return"string"===typeof e?document.getElementById(e):e}function ht(e,t){var n=e.style[t]||e.currentStyle&&e.currentStyle[t];if((!n||"auto"===n)&&document.defaultView){var i=document.defaultView.getComputedStyle(e,null);n=i?i[t]:null}return"auto"===n?null:n}function ft(e,t,n){var i=document.createElement(e);return i.className=t||"",n&&n.appendChild(i),i}function pt(e){var t=e.parentNode;t&&t.removeChild(e)}function mt(e){for(;e.firstChild;)e.removeChild(e.firstChild)}function gt(e){var t=e.parentNode;t&&t.lastChild!==e&&t.appendChild(e)}function yt(e){var t=e.parentNode;t&&t.firstChild!==e&&t.insertBefore(e,t.firstChild)}function vt(e,t){if(void 0!==e.classList)return e.classList.contains(t);var n=xt(e);return n.length>0&&new RegExp("(^|\\s)"+t+"(\\s|$)").test(n)}function _t(e,t){if(void 0!==e.classList)for(var n=h(t),i=0,r=n.length;i<r;i++)e.classList.add(n[i]);else if(!vt(e,t)){var o=xt(e);bt(e,(o?o+" ":"")+t)}}function wt(e,t){void 0!==e.classList?e.classList.remove(t):bt(e,d((" "+xt(e)+" ").replace(" "+t+" "," ")))}function bt(e,t){void 0===e.className.baseVal?e.className=t:e.className.baseVal=t}function xt(e){return e.correspondingElement&&(e=e.correspondingElement),void 0===e.className.baseVal?e.className:e.className.baseVal}function St(e,t){"opacity"in e.style?e.style.opacity=t:"filter"in e.style&&Et(e,t)}function Et(e,t){var n=!1,i="DXImageTransform.Microsoft.Alpha";try{n=e.filters.item(i)}catch(r){if(1===t)return}t=Math.round(100*t),n?(n.Enabled=100!==t,n.Opacity=t):e.style.filter+=" progid:"+i+"(opacity="+t+")"}function Tt(e){for(var t=document.documentElement.style,n=0;n<e.length;n++)if(e[n]in t)return e[n];return!1}function kt(e,t,n){var i=t||new P(0,0);e.style[ct]=(Me.ie3d?"translate("+i.x+"px,"+i.y+"px)":"translate3d("+i.x+"px,"+i.y+"px,0)")+(n?" scale("+n+")":"")}function Ct(e,t){e._leaflet_pos=t,Me.any3d?kt(e,t):(e.style.left=t.x+"px",e.style.top=t.y+"px")}function It(e){return e._leaflet_pos||new P(0,0)}if("onselectstart"in document)it=function(){Dt(window,"selectstart",Kt)},rt=function(){Ut(window,"selectstart",Kt)};else{var At=Tt(["userSelect","WebkitUserSelect","OUserSelect","MozUserSelect","msUserSelect"]);it=function(){if(At){var e=document.documentElement.style;ot=e[At],e[At]="none"}},rt=function(){At&&(document.documentElement.style[At]=ot,ot=void 0)}}function Nt(){Dt(window,"dragstart",Kt)}function Ot(){Ut(window,"dragstart",Kt)}function Pt(e){for(;-1===e.tabIndex;)e=e.parentNode;e.style&&(Rt(),at=e,st=e.style.outlineStyle,e.style.outlineStyle="none",Dt(window,"keydown",Rt))}function Rt(){at&&(at.style.outlineStyle=st,at=void 0,st=void 0,Ut(window,"keydown",Rt))}function Lt(e){do{e=e.parentNode}while((!e.offsetWidth||!e.offsetHeight)&&e!==document.body);return e}function zt(e){var t=e.getBoundingClientRect();return{x:t.width/e.offsetWidth||1,y:t.height/e.offsetHeight||1,boundingClientRect:t}}var Mt={__proto__:null,TRANSFORM:ct,TRANSITION:lt,TRANSITION_END:ut,get:dt,getStyle:ht,create:ft,remove:pt,empty:mt,toFront:gt,toBack:yt,hasClass:vt,addClass:_t,removeClass:wt,setClass:bt,getClass:xt,setOpacity:St,testProp:Tt,setTransform:kt,setPosition:Ct,getPosition:It,get disableTextSelection(){return it},get enableTextSelection(){return rt},disableImageDrag:Nt,enableImageDrag:Ot,preventOutline:Pt,restoreOutline:Rt,getSizedParentNode:Lt,getScale:zt};function Dt(e,t,n,i){if(t&&"object"===typeof t)for(var r in t)Vt(e,r,t[r],n);else for(var o=0,a=(t=h(t)).length;o<a;o++)Vt(e,t[o],n,i);return this}var Bt="_leaflet_events";function Ut(e,t,n,i){if(1===arguments.length)Ft(e),delete e[Bt];else if(t&&"object"===typeof t)for(var r in t)qt(e,r,t[r],n);else if(t=h(t),2===arguments.length)Ft(e,function(e){return-1!==v(t,e)});else for(var o=0,a=t.length;o<a;o++)qt(e,t[o],n,i);return this}function Ft(e,t){for(var n in e[Bt]){var i=n.split(/\d/)[0];t&&!t(i)||qt(e,i,null,null,n)}}var jt={mouseenter:"mouseover",mouseleave:"mouseout",wheel:!("onwheel"in window)&&"mousewheel"};function Vt(e,t,n,i){var r=t+a(n)+(i?"_"+a(i):"");if(e[Bt]&&e[Bt][r])return this;var o=function(t){return n.call(i||e,t||window.event)},s=o;!Me.touchNative&&Me.pointer&&0===t.indexOf("touch")?o=We(e,t,o):Me.touch&&"dblclick"===t?o=tt(e,o):"addEventListener"in e?"touchstart"===t||"touchmove"===t||"wheel"===t||"mousewheel"===t?e.addEventListener(jt[t]||t,o,!!Me.passiveEvents&&{passive:!1}):"mouseenter"===t||"mouseleave"===t?(o=function(t){t=t||window.event,$t(e,t)&&s(t)},e.addEventListener(jt[t],o,!1)):e.addEventListener(t,s,!1):e.attachEvent("on"+t,o),e[Bt]=e[Bt]||{},e[Bt][r]=o}function qt(e,t,n,i,r){r=r||t+a(n)+(i?"_"+a(i):"");var o=e[Bt]&&e[Bt][r];if(!o)return this;!Me.touchNative&&Me.pointer&&0===t.indexOf("touch")?Ge(e,t,o):Me.touch&&"dblclick"===t?nt(e,o):"removeEventListener"in e?e.removeEventListener(jt[t]||t,o,!1):e.detachEvent("on"+t,o),e[Bt][r]=null}function Ht(e){return e.stopPropagation?e.stopPropagation():e.originalEvent?e.originalEvent._stopped=!0:e.cancelBubble=!0,this}function Wt(e){return Vt(e,"wheel",Ht),this}function Gt(e){return Dt(e,"mousedown touchstart dblclick contextmenu",Ht),e._leaflet_disable_click=!0,this}function Kt(e){return e.preventDefault?e.preventDefault():e.returnValue=!1,this}function Zt(e){return Kt(e),Ht(e),this}function Qt(e){if(e.composedPath)return e.composedPath();for(var t=[],n=e.target;n;)t.push(n),n=n.parentNode;return t}function Xt(e,t){if(!t)return new P(e.clientX,e.clientY);var n=zt(t),i=n.boundingClientRect;return new P((e.clientX-i.left)/n.x-t.clientLeft,(e.clientY-i.top)/n.y-t.clientTop)}var Yt=Me.linux&&Me.chrome?window.devicePixelRatio:Me.mac?3*window.devicePixelRatio:window.devicePixelRatio>0?2*window.devicePixelRatio:1;function Jt(e){return Me.edge?e.wheelDeltaY/2:e.deltaY&&0===e.deltaMode?-e.deltaY/Yt:e.deltaY&&1===e.deltaMode?20*-e.deltaY:e.deltaY&&2===e.deltaMode?60*-e.deltaY:e.deltaX||e.deltaZ?0:e.wheelDelta?(e.wheelDeltaY||e.wheelDelta)/2:e.detail&&Math.abs(e.detail)<32765?20*-e.detail:e.detail?e.detail/-32765*60:0}function $t(e,t){var n=t.relatedTarget;if(!n)return!0;try{for(;n&&n!==e;)n=n.parentNode}catch(i){return!1}return n!==e}var en={__proto__:null,on:Dt,off:Ut,stopPropagation:Ht,disableScrollPropagation:Wt,disableClickPropagation:Gt,preventDefault:Kt,stop:Zt,getPropagationPath:Qt,getMousePosition:Xt,getWheelDelta:Jt,isExternalTarget:$t,addListener:Dt,removeListener:Ut},tn=O.extend({run:function(e,t,n,i){this.stop(),this._el=e,this._inProgress=!0,this._duration=n||.25,this._easeOutPower=1/Math.max(i||.5,.2),this._startPos=It(e),this._offset=t.subtract(this._startPos),this._startTime=+new Date,this.fire("start"),this._animate()},stop:function(){this._inProgress&&(this._step(!0),this._complete())},_animate:function(){this._animId=T(this._animate,this),this._step()},_step:function(e){var t=+new Date-this._startTime,n=1e3*this._duration;t<n?this._runFrame(this._easeOut(t/n),e):(this._runFrame(1),this._complete())},_runFrame:function(e,t){var n=this._startPos.add(this._offset.multiplyBy(e));t&&n._round(),Ct(this._el,n),this.fire("step")},_complete:function(){k(this._animId),this._inProgress=!1,this.fire("end")},_easeOut:function(e){return 1-Math.pow(1-e,this._easeOutPower)}}),nn=O.extend({options:{crs:Z,center:void 0,zoom:void 0,minZoom:void 0,maxZoom:void 0,layers:[],maxBounds:void 0,renderer:void 0,zoomAnimation:!0,zoomAnimationThreshold:4,fadeAnimation:!0,markerZoomAnimation:!0,transform3DLimit:8388608,zoomSnap:1,zoomDelta:1,trackResize:!0},initialize:function(e,t){t=f(this,t),this._handlers=[],this._layers={},this._zoomBoundLayers={},this._sizeChanged=!0,this._initContainer(e),this._initLayout(),this._onResize=r(this._onResize,this),this._initEvents(),t.maxBounds&&this.setMaxBounds(t.maxBounds),void 0!==t.zoom&&(this._zoom=this._limitZoom(t.zoom)),t.center&&void 0!==t.zoom&&this.setView(j(t.center),t.zoom,{reset:!0}),this.callInitHooks(),this._zoomAnimated=lt&&Me.any3d&&!Me.mobileOpera&&this.options.zoomAnimation,this._zoomAnimated&&(this._createAnimProxy(),Dt(this._proxy,ut,this._catchTransitionEnd,this)),this._addLayers(this.options.layers)},setView:function(e,t,i){return t=void 0===t?this._zoom:this._limitZoom(t),e=this._limitCenter(j(e),t,this.options.maxBounds),i=i||{},this._stop(),this._loaded&&!i.reset&&!0!==i&&(void 0!==i.animate&&(i.zoom=n({animate:i.animate},i.zoom),i.pan=n({animate:i.animate,duration:i.duration},i.pan)),this._zoom!==t?this._tryAnimatedZoom&&this._tryAnimatedZoom(e,t,i.zoom):this._tryAnimatedPan(e,i.pan))?(clearTimeout(this._sizeTimer),this):(this._resetView(e,t,i.pan&&i.pan.noMoveStart),this)},setZoom:function(e,t){return this._loaded?this.setView(this.getCenter(),e,{zoom:t}):(this._zoom=e,this)},zoomIn:function(e,t){return e=e||(Me.any3d?this.options.zoomDelta:1),this.setZoom(this._zoom+e,t)},zoomOut:function(e,t){return e=e||(Me.any3d?this.options.zoomDelta:1),this.setZoom(this._zoom-e,t)},setZoomAround:function(e,t,n){var i=this.getZoomScale(t),r=this.getSize().divideBy(2),o=(e instanceof P?e:this.latLngToContainerPoint(e)).subtract(r).multiplyBy(1-1/i),a=this.containerPointToLatLng(r.add(o));return this.setView(a,t,{zoom:n})},_getBoundsCenterZoom:function(e,t){t=t||{},e=e.getBounds?e.getBounds():U(e);var n=z(t.paddingTopLeft||t.padding||[0,0]),i=z(t.paddingBottomRight||t.padding||[0,0]),r=this.getBoundsZoom(e,!1,n.add(i));if((r="number"===typeof t.maxZoom?Math.min(t.maxZoom,r):r)===1/0)return{center:e.getCenter(),zoom:r};var o=i.subtract(n).divideBy(2),a=this.project(e.getSouthWest(),r),s=this.project(e.getNorthEast(),r);return{center:this.unproject(a.add(s).divideBy(2).add(o),r),zoom:r}},fitBounds:function(e,t){if(!(e=U(e)).isValid())throw new Error("Bounds are not valid.");var n=this._getBoundsCenterZoom(e,t);return this.setView(n.center,n.zoom,t)},fitWorld:function(e){return this.fitBounds([[-90,-180],[90,180]],e)},panTo:function(e,t){return this.setView(e,this._zoom,{pan:t})},panBy:function(e,t){if(t=t||{},!(e=z(e).round()).x&&!e.y)return this.fire("moveend");if(!0!==t.animate&&!this.getSize().contains(e))return this._resetView(this.unproject(this.project(this.getCenter()).add(e)),this.getZoom()),this;if(this._panAnim||(this._panAnim=new tn,this._panAnim.on({step:this._onPanTransitionStep,end:this._onPanTransitionEnd},this)),t.noMoveStart||this.fire("movestart"),!1!==t.animate){_t(this._mapPane,"leaflet-pan-anim");var n=this._getMapPanePos().subtract(e).round();this._panAnim.run(this._mapPane,n,t.duration||.25,t.easeLinearity)}else this._rawPanBy(e),this.fire("move").fire("moveend");return this},flyTo:function(e,t,n){if(!1===(n=n||{}).animate||!Me.any3d)return this.setView(e,t,n);this._stop();var i=this.project(this.getCenter()),r=this.project(e),o=this.getSize(),a=this._zoom;e=j(e),t=void 0===t?a:t;var s=Math.max(o.x,o.y),c=s*this.getZoomScale(a,t),l=r.distanceTo(i)||1,u=1.42,d=u*u;function h(e){var t=(c*c-s*s+(e?-1:1)*d*d*l*l)/(2*(e?c:s)*d*l),n=Math.sqrt(t*t+1)-t;return n<1e-9?-18:Math.log(n)}function f(e){return(Math.exp(e)-Math.exp(-e))/2}function p(e){return(Math.exp(e)+Math.exp(-e))/2}function m(e){return f(e)/p(e)}var g=h(0);function y(e){return s*(p(g)/p(g+u*e))}function v(e){return s*(p(g)*m(g+u*e)-f(g))/d}function _(e){return 1-Math.pow(1-e,1.5)}var w=Date.now(),b=(h(1)-g)/u,x=n.duration?1e3*n.duration:1e3*b*.8;function S(){var n=(Date.now()-w)/x,o=_(n)*b;n<=1?(this._flyToFrame=T(S,this),this._move(this.unproject(i.add(r.subtract(i).multiplyBy(v(o)/l)),a),this.getScaleZoom(s/y(o),a),{flyTo:!0})):this._move(e,t)._moveEnd(!0)}return this._moveStart(!0,n.noMoveStart),S.call(this),this},flyToBounds:function(e,t){var n=this._getBoundsCenterZoom(e,t);return this.flyTo(n.center,n.zoom,t)},setMaxBounds:function(e){return e=U(e),this.listens("moveend",this._panInsideMaxBounds)&&this.off("moveend",this._panInsideMaxBounds),e.isValid()?(this.options.maxBounds=e,this._loaded&&this._panInsideMaxBounds(),this.on("moveend",this._panInsideMaxBounds)):(this.options.maxBounds=null,this)},setMinZoom:function(e){var t=this.options.minZoom;return this.options.minZoom=e,this._loaded&&t!==e&&(this.fire("zoomlevelschange"),this.getZoom()<this.options.minZoom)?this.setZoom(e):this},setMaxZoom:function(e){var t=this.options.maxZoom;return this.options.maxZoom=e,this._loaded&&t!==e&&(this.fire("zoomlevelschange"),this.getZoom()>this.options.maxZoom)?this.setZoom(e):this},panInsideBounds:function(e,t){this._enforcingBounds=!0;var n=this.getCenter(),i=this._limitCenter(n,this._zoom,U(e));return n.equals(i)||this.panTo(i,t),this._enforcingBounds=!1,this},panInside:function(e,t){var n=z((t=t||{}).paddingTopLeft||t.padding||[0,0]),i=z(t.paddingBottomRight||t.padding||[0,0]),r=this.project(this.getCenter()),o=this.project(e),a=this.getPixelBounds(),s=D([a.min.add(n),a.max.subtract(i)]),c=s.getSize();if(!s.contains(o)){this._enforcingBounds=!0;var l=o.subtract(s.getCenter()),u=s.extend(o).getSize().subtract(c);r.x+=l.x<0?-u.x:u.x,r.y+=l.y<0?-u.y:u.y,this.panTo(this.unproject(r),t),this._enforcingBounds=!1}return this},invalidateSize:function(e){if(!this._loaded)return this;e=n({animate:!1,pan:!0},!0===e?{animate:!0}:e);var t=this.getSize();this._sizeChanged=!0,this._lastCenter=null;var i=this.getSize(),o=t.divideBy(2).round(),a=i.divideBy(2).round(),s=o.subtract(a);return s.x||s.y?(e.animate&&e.pan?this.panBy(s):(e.pan&&this._rawPanBy(s),this.fire("move"),e.debounceMoveend?(clearTimeout(this._sizeTimer),this._sizeTimer=setTimeout(r(this.fire,this,"moveend"),200)):this.fire("moveend")),this.fire("resize",{oldSize:t,newSize:i})):this},stop:function(){return this.setZoom(this._limitZoom(this._zoom)),this.options.zoomSnap||this.fire("viewreset"),this._stop()},locate:function(e){if(e=this._locateOptions=n({timeout:1e4,watch:!1},e),!("geolocation"in navigator))return this._handleGeolocationError({code:0,message:"Geolocation not supported."}),this;var t=r(this._handleGeolocationResponse,this),i=r(this._handleGeolocationError,this);return e.watch?this._locationWatchId=navigator.geolocation.watchPosition(t,i,e):navigator.geolocation.getCurrentPosition(t,i,e),this},stopLocate:function(){return navigator.geolocation&&navigator.geolocation.clearWatch&&navigator.geolocation.clearWatch(this._locationWatchId),this._locateOptions&&(this._locateOptions.setView=!1),this},_handleGeolocationError:function(e){if(this._container._leaflet_id){var t=e.code,n=e.message||(1===t?"permission denied":2===t?"position unavailable":"timeout");this._locateOptions.setView&&!this._loaded&&this.fitWorld(),this.fire("locationerror",{code:t,message:"Geolocation error: "+n+"."})}},_handleGeolocationResponse:function(e){if(this._container._leaflet_id){var t=new F(e.coords.latitude,e.coords.longitude),n=t.toBounds(2*e.coords.accuracy),i=this._locateOptions;if(i.setView){var r=this.getBoundsZoom(n);this.setView(t,i.maxZoom?Math.min(r,i.maxZoom):r)}var o={latlng:t,bounds:n,timestamp:e.timestamp};for(var a in e.coords)"number"===typeof e.coords[a]&&(o[a]=e.coords[a]);this.fire("locationfound",o)}},addHandler:function(e,t){if(!t)return this;var n=this[e]=new t(this);return this._handlers.push(n),this.options[e]&&n.enable(),this},remove:function(){if(this._initEvents(!0),this.options.maxBounds&&this.off("moveend",this._panInsideMaxBounds),this._containerId!==this._container._leaflet_id)throw new Error("Map container is being reused by another instance");try{delete this._container._leaflet_id,delete this._containerId}catch(t){this._container._leaflet_id=void 0,this._containerId=void 0}var e;for(e in void 0!==this._locationWatchId&&this.stopLocate(),this._stop(),pt(this._mapPane),this._clearControlPos&&this._clearControlPos(),this._resizeRequest&&(k(this._resizeRequest),this._resizeRequest=null),this._clearHandlers(),this._loaded&&this.fire("unload"),this._layers)this._layers[e].remove();for(e in this._panes)pt(this._panes[e]);return this._layers=[],this._panes=[],delete this._mapPane,delete this._renderer,this},createPane:function(e,t){var n=ft("div","leaflet-pane"+(e?" leaflet-"+e.replace("Pane","")+"-pane":""),t||this._mapPane);return e&&(this._panes[e]=n),n},getCenter:function(){return this._checkIfLoaded(),this._lastCenter&&!this._moved()?this._lastCenter.clone():this.layerPointToLatLng(this._getCenterLayerPoint())},getZoom:function(){return this._zoom},getBounds:function(){var e=this.getPixelBounds();return new B(this.unproject(e.getBottomLeft()),this.unproject(e.getTopRight()))},getMinZoom:function(){return void 0===this.options.minZoom?this._layersMinZoom||0:this.options.minZoom},getMaxZoom:function(){return void 0===this.options.maxZoom?void 0===this._layersMaxZoom?1/0:this._layersMaxZoom:this.options.maxZoom},getBoundsZoom:function(e,t,n){e=U(e),n=z(n||[0,0]);var i=this.getZoom()||0,r=this.getMinZoom(),o=this.getMaxZoom(),a=e.getNorthWest(),s=e.getSouthEast(),c=this.getSize().subtract(n),l=D(this.project(s,i),this.project(a,i)).getSize(),u=Me.any3d?this.options.zoomSnap:1,d=c.x/l.x,h=c.y/l.y,f=t?Math.max(d,h):Math.min(d,h);return i=this.getScaleZoom(f,i),u&&(i=Math.round(i/(u/100))*(u/100),i=t?Math.ceil(i/u)*u:Math.floor(i/u)*u),Math.max(r,Math.min(o,i))},getSize:function(){return this._size&&!this._sizeChanged||(this._size=new P(this._container.clientWidth||0,this._container.clientHeight||0),this._sizeChanged=!1),this._size.clone()},getPixelBounds:function(e,t){var n=this._getTopLeftPoint(e,t);return new M(n,n.add(this.getSize()))},getPixelOrigin:function(){return this._checkIfLoaded(),this._pixelOrigin},getPixelWorldBounds:function(e){return this.options.crs.getProjectedBounds(void 0===e?this.getZoom():e)},getPane:function(e){return"string"===typeof e?this._panes[e]:e},getPanes:function(){return this._panes},getContainer:function(){return this._container},getZoomScale:function(e,t){var n=this.options.crs;return t=void 0===t?this._zoom:t,n.scale(e)/n.scale(t)},getScaleZoom:function(e,t){var n=this.options.crs;t=void 0===t?this._zoom:t;var i=n.zoom(e*n.scale(t));return isNaN(i)?1/0:i},project:function(e,t){return t=void 0===t?this._zoom:t,this.options.crs.latLngToPoint(j(e),t)},unproject:function(e,t){return t=void 0===t?this._zoom:t,this.options.crs.pointToLatLng(z(e),t)},layerPointToLatLng:function(e){var t=z(e).add(this.getPixelOrigin());return this.unproject(t)},latLngToLayerPoint:function(e){return this.project(j(e))._round()._subtract(this.getPixelOrigin())},wrapLatLng:function(e){return this.options.crs.wrapLatLng(j(e))},wrapLatLngBounds:function(e){return this.options.crs.wrapLatLngBounds(U(e))},distance:function(e,t){return this.options.crs.distance(j(e),j(t))},containerPointToLayerPoint:function(e){return z(e).subtract(this._getMapPanePos())},layerPointToContainerPoint:function(e){return z(e).add(this._getMapPanePos())},containerPointToLatLng:function(e){var t=this.containerPointToLayerPoint(z(e));return this.layerPointToLatLng(t)},latLngToContainerPoint:function(e){return this.layerPointToContainerPoint(this.latLngToLayerPoint(j(e)))},mouseEventToContainerPoint:function(e){return Xt(e,this._container)},mouseEventToLayerPoint:function(e){return this.containerPointToLayerPoint(this.mouseEventToContainerPoint(e))},mouseEventToLatLng:function(e){return this.layerPointToLatLng(this.mouseEventToLayerPoint(e))},_initContainer:function(e){var t=this._container=dt(e);if(!t)throw new Error("Map container not found.");if(t._leaflet_id)throw new Error("Map container is already initialized.");Dt(t,"scroll",this._onScroll,this),this._containerId=a(t)},_initLayout:function(){var e=this._container;this._fadeAnimated=this.options.fadeAnimation&&Me.any3d,_t(e,"leaflet-container"+(Me.touch?" leaflet-touch":"")+(Me.retina?" leaflet-retina":"")+(Me.ielt9?" leaflet-oldie":"")+(Me.safari?" leaflet-safari":"")+(this._fadeAnimated?" leaflet-fade-anim":""));var t=ht(e,"position");"absolute"!==t&&"relative"!==t&&"fixed"!==t&&"sticky"!==t&&(e.style.position="relative"),this._initPanes(),this._initControlPos&&this._initControlPos()},_initPanes:function(){var e=this._panes={};this._paneRenderers={},this._mapPane=this.createPane("mapPane",this._container),Ct(this._mapPane,new P(0,0)),this.createPane("tilePane"),this.createPane("overlayPane"),this.createPane("shadowPane"),this.createPane("markerPane"),this.createPane("tooltipPane"),this.createPane("popupPane"),this.options.markerZoomAnimation||(_t(e.markerPane,"leaflet-zoom-hide"),_t(e.shadowPane,"leaflet-zoom-hide"))},_resetView:function(e,t,n){Ct(this._mapPane,new P(0,0));var i=!this._loaded;this._loaded=!0,t=this._limitZoom(t),this.fire("viewprereset");var r=this._zoom!==t;this._moveStart(r,n)._move(e,t)._moveEnd(r),this.fire("viewreset"),i&&this.fire("load")},_moveStart:function(e,t){return e&&this.fire("zoomstart"),t||this.fire("movestart"),this},_move:function(e,t,n,i){void 0===t&&(t=this._zoom);var r=this._zoom!==t;return this._zoom=t,this._lastCenter=e,this._pixelOrigin=this._getNewPixelOrigin(e),i?n&&n.pinch&&this.fire("zoom",n):((r||n&&n.pinch)&&this.fire("zoom",n),this.fire("move",n)),this},_moveEnd:function(e){return e&&this.fire("zoomend"),this.fire("moveend")},_stop:function(){return k(this._flyToFrame),this._panAnim&&this._panAnim.stop(),this},_rawPanBy:function(e){Ct(this._mapPane,this._getMapPanePos().subtract(e))},_getZoomSpan:function(){return this.getMaxZoom()-this.getMinZoom()},_panInsideMaxBounds:function(){this._enforcingBounds||this.panInsideBounds(this.options.maxBounds)},_checkIfLoaded:function(){if(!this._loaded)throw new Error("Set map center and zoom first.")},_initEvents:function(e){this._targets={},this._targets[a(this._container)]=this;var t=e?Ut:Dt;t(this._container,"click dblclick mousedown mouseup mouseover mouseout mousemove contextmenu keypress keydown keyup",this._handleDOMEvent,this),this.options.trackResize&&t(window,"resize",this._onResize,this),Me.any3d&&this.options.transform3DLimit&&(e?this.off:this.on).call(this,"moveend",this._onMoveEnd)},_onResize:function(){k(this._resizeRequest),this._resizeRequest=T(function(){this.invalidateSize({debounceMoveend:!0})},this)},_onScroll:function(){this._container.scrollTop=0,this._container.scrollLeft=0},_onMoveEnd:function(){var e=this._getMapPanePos();Math.max(Math.abs(e.x),Math.abs(e.y))>=this.options.transform3DLimit&&this._resetView(this.getCenter(),this.getZoom())},_findEventTargets:function(e,t){for(var n,i=[],r="mouseout"===t||"mouseover"===t,o=e.target||e.srcElement,s=!1;o;){if((n=this._targets[a(o)])&&("click"===t||"preclick"===t)&&this._draggableMoved(n)){s=!0;break}if(n&&n.listens(t,!0)){if(r&&!$t(o,e))break;if(i.push(n),r)break}if(o===this._container)break;o=o.parentNode}return i.length||s||r||!this.listens(t,!0)||(i=[this]),i},_isClickDisabled:function(e){for(;e&&e!==this._container;){if(e._leaflet_disable_click)return!0;e=e.parentNode}},_handleDOMEvent:function(e){var t=e.target||e.srcElement;if(!(!this._loaded||t._leaflet_disable_events||"click"===e.type&&this._isClickDisabled(t))){var n=e.type;"mousedown"===n&&Pt(t),this._fireDOMEvent(e,n)}},_mouseEvents:["click","dblclick","mouseover","mouseout","contextmenu"],_fireDOMEvent:function(e,t,i){if("click"===e.type){var r=n({},e);r.type="preclick",this._fireDOMEvent(r,r.type,i)}var o=this._findEventTargets(e,t);if(i){for(var a=[],s=0;s<i.length;s++)i[s].listens(t,!0)&&a.push(i[s]);o=a.concat(o)}if(o.length){"contextmenu"===t&&Kt(e);var c=o[0],l={originalEvent:e};if("keypress"!==e.type&&"keydown"!==e.type&&"keyup"!==e.type){var u=c.getLatLng&&(!c._radius||c._radius<=10);l.containerPoint=u?this.latLngToContainerPoint(c.getLatLng()):this.mouseEventToContainerPoint(e),l.layerPoint=this.containerPointToLayerPoint(l.containerPoint),l.latlng=u?c.getLatLng():this.layerPointToLatLng(l.layerPoint)}for(s=0;s<o.length;s++)if(o[s].fire(t,l,!0),l.originalEvent._stopped||!1===o[s].options.bubblingMouseEvents&&-1!==v(this._mouseEvents,t))return}},_draggableMoved:function(e){return(e=e.dragging&&e.dragging.enabled()?e:this).dragging&&e.dragging.moved()||this.boxZoom&&this.boxZoom.moved()},_clearHandlers:function(){for(var e=0,t=this._handlers.length;e<t;e++)this._handlers[e].disable()},whenReady:function(e,t){return this._loaded?e.call(t||this,{target:this}):this.on("load",e,t),this},_getMapPanePos:function(){return It(this._mapPane)||new P(0,0)},_moved:function(){var e=this._getMapPanePos();return e&&!e.equals([0,0])},_getTopLeftPoint:function(e,t){return(e&&void 0!==t?this._getNewPixelOrigin(e,t):this.getPixelOrigin()).subtract(this._getMapPanePos())},_getNewPixelOrigin:function(e,t){var n=this.getSize()._divideBy(2);return this.project(e,t)._subtract(n)._add(this._getMapPanePos())._round()},_latLngToNewLayerPoint:function(e,t,n){var i=this._getNewPixelOrigin(n,t);return this.project(e,t)._subtract(i)},_latLngBoundsToNewLayerBounds:function(e,t,n){var i=this._getNewPixelOrigin(n,t);return D([this.project(e.getSouthWest(),t)._subtract(i),this.project(e.getNorthWest(),t)._subtract(i),this.project(e.getSouthEast(),t)._subtract(i),this.project(e.getNorthEast(),t)._subtract(i)])},_getCenterLayerPoint:function(){return this.containerPointToLayerPoint(this.getSize()._divideBy(2))},_getCenterOffset:function(e){return this.latLngToLayerPoint(e).subtract(this._getCenterLayerPoint())},_limitCenter:function(e,t,n){if(!n)return e;var i=this.project(e,t),r=this.getSize().divideBy(2),o=new M(i.subtract(r),i.add(r)),a=this._getBoundsOffset(o,n,t);return Math.abs(a.x)<=1&&Math.abs(a.y)<=1?e:this.unproject(i.add(a),t)},_limitOffset:function(e,t){if(!t)return e;var n=this.getPixelBounds(),i=new M(n.min.add(e),n.max.add(e));return e.add(this._getBoundsOffset(i,t))},_getBoundsOffset:function(e,t,n){var i=D(this.project(t.getNorthEast(),n),this.project(t.getSouthWest(),n)),r=i.min.subtract(e.min),o=i.max.subtract(e.max);return new P(this._rebound(r.x,-o.x),this._rebound(r.y,-o.y))},_rebound:function(e,t){return e+t>0?Math.round(e-t)/2:Math.max(0,Math.ceil(e))-Math.max(0,Math.floor(t))},_limitZoom:function(e){var t=this.getMinZoom(),n=this.getMaxZoom(),i=Me.any3d?this.options.zoomSnap:1;return i&&(e=Math.round(e/i)*i),Math.max(t,Math.min(n,e))},_onPanTransitionStep:function(){this.fire("move")},_onPanTransitionEnd:function(){wt(this._mapPane,"leaflet-pan-anim"),this.fire("moveend")},_tryAnimatedPan:function(e,t){var n=this._getCenterOffset(e)._trunc();return!(!0!==(t&&t.animate)&&!this.getSize().contains(n))&&(this.panBy(n,t),!0)},_createAnimProxy:function(){var e=this._proxy=ft("div","leaflet-proxy leaflet-zoom-animated");this._panes.mapPane.appendChild(e),this.on("zoomanim",function(e){var t=ct,n=this._proxy.style[t];kt(this._proxy,this.project(e.center,e.zoom),this.getZoomScale(e.zoom,1)),n===this._proxy.style[t]&&this._animatingZoom&&this._onZoomTransitionEnd()},this),this.on("load moveend",this._animMoveEnd,this),this._on("unload",this._destroyAnimProxy,this)},_destroyAnimProxy:function(){pt(this._proxy),this.off("load moveend",this._animMoveEnd,this),delete this._proxy},_animMoveEnd:function(){var e=this.getCenter(),t=this.getZoom();kt(this._proxy,this.project(e,t),this.getZoomScale(t,1))},_catchTransitionEnd:function(e){this._animatingZoom&&e.propertyName.indexOf("transform")>=0&&this._onZoomTransitionEnd()},_nothingToAnimate:function(){return!this._container.getElementsByClassName("leaflet-zoom-animated").length},_tryAnimatedZoom:function(e,t,n){if(this._animatingZoom)return!0;if(n=n||{},!this._zoomAnimated||!1===n.animate||this._nothingToAnimate()||Math.abs(t-this._zoom)>this.options.zoomAnimationThreshold)return!1;var i=this.getZoomScale(t),r=this._getCenterOffset(e)._divideBy(1-1/i);return!(!0!==n.animate&&!this.getSize().contains(r))&&(T(function(){this._moveStart(!0,n.noMoveStart||!1)._animateZoom(e,t,!0)},this),!0)},_animateZoom:function(e,t,n,i){this._mapPane&&(n&&(this._animatingZoom=!0,this._animateToCenter=e,this._animateToZoom=t,_t(this._mapPane,"leaflet-zoom-anim")),this.fire("zoomanim",{center:e,zoom:t,noUpdate:i}),this._tempFireZoomEvent||(this._tempFireZoomEvent=this._zoom!==this._animateToZoom),this._move(this._animateToCenter,this._animateToZoom,void 0,!0),setTimeout(r(this._onZoomTransitionEnd,this),250))},_onZoomTransitionEnd:function(){this._animatingZoom&&(this._mapPane&&wt(this._mapPane,"leaflet-zoom-anim"),this._animatingZoom=!1,this._move(this._animateToCenter,this._animateToZoom,void 0,!0),this._tempFireZoomEvent&&this.fire("zoom"),delete this._tempFireZoomEvent,this.fire("move"),this._moveEnd(!0))}});function rn(e,t){return new nn(e,t)}var on=I.extend({options:{position:"topright"},initialize:function(e){f(this,e)},getPosition:function(){return this.options.position},setPosition:function(e){var t=this._map;return t&&t.removeControl(this),this.options.position=e,t&&t.addControl(this),this},getContainer:function(){return this._container},addTo:function(e){this.remove(),this._map=e;var t=this._container=this.onAdd(e),n=this.getPosition(),i=e._controlCorners[n];return _t(t,"leaflet-control"),-1!==n.indexOf("bottom")?i.insertBefore(t,i.firstChild):i.appendChild(t),this._map.on("unload",this.remove,this),this},remove:function(){return this._map?(pt(this._container),this.onRemove&&this.onRemove(this._map),this._map.off("unload",this.remove,this),this._map=null,this):this},_refocusOnMap:function(e){this._map&&e&&e.screenX>0&&e.screenY>0&&this._map.getContainer().focus()}}),an=function(e){return new on(e)};nn.include({addControl:function(e){return e.addTo(this),this},removeControl:function(e){return e.remove(),this},_initControlPos:function(){var e=this._controlCorners={},t="leaflet-",n=this._controlContainer=ft("div",t+"control-container",this._container);function i(i,r){var o=t+i+" "+t+r;e[i+r]=ft("div",o,n)}i("top","left"),i("top","right"),i("bottom","left"),i("bottom","right")},_clearControlPos:function(){for(var e in this._controlCorners)pt(this._controlCorners[e]);pt(this._controlContainer),delete this._controlCorners,delete this._controlContainer}});var sn=on.extend({options:{collapsed:!0,position:"topright",autoZIndex:!0,hideSingleBase:!1,sortLayers:!1,sortFunction:function(e,t,n,i){return n<i?-1:i<n?1:0}},initialize:function(e,t,n){for(var i in f(this,n),this._layerControlInputs=[],this._layers=[],this._lastZIndex=0,this._handlingClick=!1,this._preventClick=!1,e)this._addLayer(e[i],i);for(i in t)this._addLayer(t[i],i,!0)},onAdd:function(e){this._initLayout(),this._update(),this._map=e,e.on("zoomend",this._checkDisabledLayers,this);for(var t=0;t<this._layers.length;t++)this._layers[t].layer.on("add remove",this._onLayerChange,this);return this._container},addTo:function(e){return on.prototype.addTo.call(this,e),this._expandIfNotCollapsed()},onRemove:function(){this._map.off("zoomend",this._checkDisabledLayers,this);for(var e=0;e<this._layers.length;e++)this._layers[e].layer.off("add remove",this._onLayerChange,this)},addBaseLayer:function(e,t){return this._addLayer(e,t),this._map?this._update():this},addOverlay:function(e,t){return this._addLayer(e,t,!0),this._map?this._update():this},removeLayer:function(e){e.off("add remove",this._onLayerChange,this);var t=this._getLayer(a(e));return t&&this._layers.splice(this._layers.indexOf(t),1),this._map?this._update():this},expand:function(){_t(this._container,"leaflet-control-layers-expanded"),this._section.style.height=null;var e=this._map.getSize().y-(this._container.offsetTop+50);return e<this._section.clientHeight?(_t(this._section,"leaflet-control-layers-scrollbar"),this._section.style.height=e+"px"):wt(this._section,"leaflet-control-layers-scrollbar"),this._checkDisabledLayers(),this},collapse:function(){return wt(this._container,"leaflet-control-layers-expanded"),this},_initLayout:function(){var e="leaflet-control-layers",t=this._container=ft("div",e),n=this.options.collapsed;t.setAttribute("aria-haspopup",!0),Gt(t),Wt(t);var i=this._section=ft("section",e+"-list");n&&(this._map.on("click",this.collapse,this),Dt(t,{mouseenter:this._expandSafely,mouseleave:this.collapse},this));var r=this._layersLink=ft("a",e+"-toggle",t);r.href="#",r.title="Layers",r.setAttribute("role","button"),Dt(r,{keydown:function(e){13===e.keyCode&&this._expandSafely()},click:function(e){Kt(e),this._expandSafely()}},this),n||this.expand(),this._baseLayersList=ft("div",e+"-base",i),this._separator=ft("div",e+"-separator",i),this._overlaysList=ft("div",e+"-overlays",i),t.appendChild(i)},_getLayer:function(e){for(var t=0;t<this._layers.length;t++)if(this._layers[t]&&a(this._layers[t].layer)===e)return this._layers[t]},_addLayer:function(e,t,n){this._map&&e.on("add remove",this._onLayerChange,this),this._layers.push({layer:e,name:t,overlay:n}),this.options.sortLayers&&this._layers.sort(r(function(e,t){return this.options.sortFunction(e.layer,t.layer,e.name,t.name)},this)),this.options.autoZIndex&&e.setZIndex&&(this._lastZIndex++,e.setZIndex(this._lastZIndex)),this._expandIfNotCollapsed()},_update:function(){if(!this._container)return this;mt(this._baseLayersList),mt(this._overlaysList),this._layerControlInputs=[];var e,t,n,i,r=0;for(n=0;n<this._layers.length;n++)i=this._layers[n],this._addItem(i),t=t||i.overlay,e=e||!i.overlay,r+=i.overlay?0:1;return this.options.hideSingleBase&&(e=e&&r>1,this._baseLayersList.style.display=e?"":"none"),this._separator.style.display=t&&e?"":"none",this},_onLayerChange:function(e){this._handlingClick||this._update();var t=this._getLayer(a(e.target)),n=t.overlay?"add"===e.type?"overlayadd":"overlayremove":"add"===e.type?"baselayerchange":null;n&&this._map.fire(n,t)},_createRadioElement:function(e,t){var n='<input type="radio" class="leaflet-control-layers-selector" name="'+e+'"'+(t?' checked="checked"':"")+"/>",i=document.createElement("div");return i.innerHTML=n,i.firstChild},_addItem:function(e){var t,n=document.createElement("label"),i=this._map.hasLayer(e.layer);e.overlay?((t=document.createElement("input")).type="checkbox",t.className="leaflet-control-layers-selector",t.defaultChecked=i):t=this._createRadioElement("leaflet-base-layers_"+a(this),i),this._layerControlInputs.push(t),t.layerId=a(e.layer),Dt(t,"click",this._onInputClick,this);var r=document.createElement("span");r.innerHTML=" "+e.name;var o=document.createElement("span");return n.appendChild(o),o.appendChild(t),o.appendChild(r),(e.overlay?this._overlaysList:this._baseLayersList).appendChild(n),this._checkDisabledLayers(),n},_onInputClick:function(){if(!this._preventClick){var e,t,n=this._layerControlInputs,i=[],r=[];this._handlingClick=!0;for(var o=n.length-1;o>=0;o--)e=n[o],t=this._getLayer(e.layerId).layer,e.checked?i.push(t):e.checked||r.push(t);for(o=0;o<r.length;o++)this._map.hasLayer(r[o])&&this._map.removeLayer(r[o]);for(o=0;o<i.length;o++)this._map.hasLayer(i[o])||this._map.addLayer(i[o]);this._handlingClick=!1,this._refocusOnMap()}},_checkDisabledLayers:function(){for(var e,t,n=this._layerControlInputs,i=this._map.getZoom(),r=n.length-1;r>=0;r--)e=n[r],t=this._getLayer(e.layerId).layer,e.disabled=void 0!==t.options.minZoom&&i<t.options.minZoom||void 0!==t.options.maxZoom&&i>t.options.maxZoom},_expandIfNotCollapsed:function(){return this._map&&!this.options.collapsed&&this.expand(),this},_expandSafely:function(){var e=this._section;this._preventClick=!0,Dt(e,"click",Kt),this.expand();var t=this;setTimeout(function(){Ut(e,"click",Kt),t._preventClick=!1})}}),cn=function(e,t,n){return new sn(e,t,n)},ln=on.extend({options:{position:"topleft",zoomInText:'<span aria-hidden="true">+</span>',zoomInTitle:"Zoom in",zoomOutText:'<span aria-hidden="true">&#x2212;</span>',zoomOutTitle:"Zoom out"},onAdd:function(e){var t="leaflet-control-zoom",n=ft("div",t+" leaflet-bar"),i=this.options;return this._zoomInButton=this._createButton(i.zoomInText,i.zoomInTitle,t+"-in",n,this._zoomIn),this._zoomOutButton=this._createButton(i.zoomOutText,i.zoomOutTitle,t+"-out",n,this._zoomOut),this._updateDisabled(),e.on("zoomend zoomlevelschange",this._updateDisabled,this),n},onRemove:function(e){e.off("zoomend zoomlevelschange",this._updateDisabled,this)},disable:function(){return this._disabled=!0,this._updateDisabled(),this},enable:function(){return this._disabled=!1,this._updateDisabled(),this},_zoomIn:function(e){!this._disabled&&this._map._zoom<this._map.getMaxZoom()&&this._map.zoomIn(this._map.options.zoomDelta*(e.shiftKey?3:1))},_zoomOut:function(e){!this._disabled&&this._map._zoom>this._map.getMinZoom()&&this._map.zoomOut(this._map.options.zoomDelta*(e.shiftKey?3:1))},_createButton:function(e,t,n,i,r){var o=ft("a",n,i);return o.innerHTML=e,o.href="#",o.title=t,o.setAttribute("role","button"),o.setAttribute("aria-label",t),Gt(o),Dt(o,"click",Zt),Dt(o,"click",r,this),Dt(o,"click",this._refocusOnMap,this),o},_updateDisabled:function(){var e=this._map,t="leaflet-disabled";wt(this._zoomInButton,t),wt(this._zoomOutButton,t),this._zoomInButton.setAttribute("aria-disabled","false"),this._zoomOutButton.setAttribute("aria-disabled","false"),(this._disabled||e._zoom===e.getMinZoom())&&(_t(this._zoomOutButton,t),this._zoomOutButton.setAttribute("aria-disabled","true")),(this._disabled||e._zoom===e.getMaxZoom())&&(_t(this._zoomInButton,t),this._zoomInButton.setAttribute("aria-disabled","true"))}});nn.mergeOptions({zoomControl:!0}),nn.addInitHook(function(){this.options.zoomControl&&(this.zoomControl=new ln,this.addControl(this.zoomControl))});var un=function(e){return new ln(e)},dn=on.extend({options:{position:"bottomleft",maxWidth:100,metric:!0,imperial:!0},onAdd:function(e){var t="leaflet-control-scale",n=ft("div",t),i=this.options;return this._addScales(i,t+"-line",n),e.on(i.updateWhenIdle?"moveend":"move",this._update,this),e.whenReady(this._update,this),n},onRemove:function(e){e.off(this.options.updateWhenIdle?"moveend":"move",this._update,this)},_addScales:function(e,t,n){e.metric&&(this._mScale=ft("div",t,n)),e.imperial&&(this._iScale=ft("div",t,n))},_update:function(){var e=this._map,t=e.getSize().y/2,n=e.distance(e.containerPointToLatLng([0,t]),e.containerPointToLatLng([this.options.maxWidth,t]));this._updateScales(n)},_updateScales:function(e){this.options.metric&&e&&this._updateMetric(e),this.options.imperial&&e&&this._updateImperial(e)},_updateMetric:function(e){var t=this._getRoundNum(e),n=t<1e3?t+" m":t/1e3+" km";this._updateScale(this._mScale,n,t/e)},_updateImperial:function(e){var t,n,i,r=3.2808399*e;r>5280?(t=r/5280,n=this._getRoundNum(t),this._updateScale(this._iScale,n+" mi",n/t)):(i=this._getRoundNum(r),this._updateScale(this._iScale,i+" ft",i/r))},_updateScale:function(e,t,n){e.style.width=Math.round(this.options.maxWidth*n)+"px",e.innerHTML=t},_getRoundNum:function(e){var t=Math.pow(10,(Math.floor(e)+"").length-1),n=e/t;return t*(n=n>=10?10:n>=5?5:n>=3?3:n>=2?2:1)}}),hn=function(e){return new dn(e)},fn='<svg aria-hidden="true" xmlns="http://www.w3.org/2000/svg" width="12" height="8" viewBox="0 0 12 8" class="leaflet-attribution-flag"><path fill="#4C7BE1" d="M0 0h12v4H0z"/><path fill="#FFD500" d="M0 4h12v3H0z"/><path fill="#E0BC00" d="M0 7h12v1H0z"/></svg>',pn=on.extend({options:{position:"bottomright",prefix:'<a href="https://leafletjs.com" title="A JavaScript library for interactive maps">'+(Me.inlineSvg?fn+" ":"")+"Leaflet</a>"},initialize:function(e){f(this,e),this._attributions={}},onAdd:function(e){for(var t in e.attributionControl=this,this._container=ft("div","leaflet-control-attribution"),Gt(this._container),e._layers)e._layers[t].getAttribution&&this.addAttribution(e._layers[t].getAttribution());return this._update(),e.on("layeradd",this._addAttribution,this),this._container},onRemove:function(e){e.off("layeradd",this._addAttribution,this)},_addAttribution:function(e){e.layer.getAttribution&&(this.addAttribution(e.layer.getAttribution()),e.layer.once("remove",function(){this.removeAttribution(e.layer.getAttribution())},this))},setPrefix:function(e){return this.options.prefix=e,this._update(),this},addAttribution:function(e){return e?(this._attributions[e]||(this._attributions[e]=0),this._attributions[e]++,this._update(),this):this},removeAttribution:function(e){return e?(this._attributions[e]&&(this._attributions[e]--,this._update()),this):this},_update:function(){if(this._map){var e=[];for(var t in this._attributions)this._attributions[t]&&e.push(t);var n=[];this.options.prefix&&n.push(this.options.prefix),e.length&&n.push(e.join(", ")),this._container.innerHTML=n.join(' <span aria-hidden="true">|</span> ')}}});nn.mergeOptions({attributionControl:!0}),nn.addInitHook(function(){this.options.attributionControl&&(new pn).addTo(this)});var mn=function(e){return new pn(e)};on.Layers=sn,on.Zoom=ln,on.Scale=dn,on.Attribution=pn,an.layers=cn,an.zoom=un,an.scale=hn,an.attribution=mn;var gn=I.extend({initialize:function(e){this._map=e},enable:function(){return this._enabled||(this._enabled=!0,this.addHooks()),this},disable:function(){return this._enabled?(this._enabled=!1,this.removeHooks(),this):this},enabled:function(){return!!this._enabled}});gn.addTo=function(e,t){return e.addHandler(t,this),this};var yn={Events:N},vn=Me.touch?"touchstart mousedown":"mousedown",_n=O.extend({options:{clickTolerance:3},initialize:function(e,t,n,i){f(this,i),this._element=e,this._dragStartTarget=t||e,this._preventOutline=n},enable:function(){this._enabled||(Dt(this._dragStartTarget,vn,this._onDown,this),this._enabled=!0)},disable:function(){this._enabled&&(_n._dragging===this&&this.finishDrag(!0),Ut(this._dragStartTarget,vn,this._onDown,this),this._enabled=!1,this._moved=!1)},_onDown:function(e){if(this._enabled&&(this._moved=!1,!vt(this._element,"leaflet-zoom-anim")))if(e.touches&&1!==e.touches.length)_n._dragging===this&&this.finishDrag();else if(!(_n._dragging||e.shiftKey||1!==e.which&&1!==e.button&&!e.touches)&&(_n._dragging=this,this._preventOutline&&Pt(this._element),Nt(),it(),!this._moving)){this.fire("down");var t=e.touches?e.touches[0]:e,n=Lt(this._element);this._startPoint=new P(t.clientX,t.clientY),this._startPos=It(this._element),this._parentScale=zt(n);var i="mousedown"===e.type;Dt(document,i?"mousemove":"touchmove",this._onMove,this),Dt(document,i?"mouseup":"touchend touchcancel",this._onUp,this)}},_onMove:function(e){if(this._enabled)if(e.touches&&e.touches.length>1)this._moved=!0;else{var t=e.touches&&1===e.touches.length?e.touches[0]:e,n=new P(t.clientX,t.clientY)._subtract(this._startPoint);(n.x||n.y)&&(Math.abs(n.x)+Math.abs(n.y)<this.options.clickTolerance||(n.x/=this._parentScale.x,n.y/=this._parentScale.y,Kt(e),this._moved||(this.fire("dragstart"),this._moved=!0,_t(document.body,"leaflet-dragging"),this._lastTarget=e.target||e.srcElement,window.SVGElementInstance&&this._lastTarget instanceof window.SVGElementInstance&&(this._lastTarget=this._lastTarget.correspondingUseElement),_t(this._lastTarget,"leaflet-drag-target")),this._newPos=this._startPos.add(n),this._moving=!0,this._lastEvent=e,this._updatePosition()))}},_updatePosition:function(){var e={originalEvent:this._lastEvent};this.fire("predrag",e),Ct(this._element,this._newPos),this.fire("drag",e)},_onUp:function(){this._enabled&&this.finishDrag()},finishDrag:function(e){wt(document.body,"leaflet-dragging"),this._lastTarget&&(wt(this._lastTarget,"leaflet-drag-target"),this._lastTarget=null),Ut(document,"mousemove touchmove",this._onMove,this),Ut(document,"mouseup touchend touchcancel",this._onUp,this),Ot(),rt();var t=this._moved&&this._moving;this._moving=!1,_n._dragging=!1,t&&this.fire("dragend",{noInertia:e,distance:this._newPos.distanceTo(this._startPos)})}});function wn(e,t,n){var i,r,o,a,s,c,l,u,d,h=[1,4,2,8];for(r=0,l=e.length;r<l;r++)e[r]._code=Rn(e[r],t);for(a=0;a<4;a++){for(u=h[a],i=[],r=0,o=(l=e.length)-1;r<l;o=r++)s=e[r],c=e[o],s._code&u?c._code&u||((d=Pn(c,s,u,t,n))._code=Rn(d,t),i.push(d)):(c._code&u&&((d=Pn(c,s,u,t,n))._code=Rn(d,t),i.push(d)),i.push(s));e=i}return e}function bn(e,t){var n,i,r,o,a,s,c,l,u;if(!e||0===e.length)throw new Error("latlngs not passed");Mn(e)||(console.warn("latlngs are not flat! Only the first ring will be used"),e=e[0]);var d=j([0,0]),h=U(e);h.getNorthWest().distanceTo(h.getSouthWest())*h.getNorthEast().distanceTo(h.getNorthWest())<1700&&(d=xn(e));var f=e.length,p=[];for(n=0;n<f;n++){var m=j(e[n]);p.push(t.project(j([m.lat-d.lat,m.lng-d.lng])))}for(s=c=l=0,n=0,i=f-1;n<f;i=n++)r=p[n],o=p[i],a=r.y*o.x-o.y*r.x,c+=(r.x+o.x)*a,l+=(r.y+o.y)*a,s+=3*a;u=0===s?p[0]:[c/s,l/s];var g=t.unproject(z(u));return j([g.lat+d.lat,g.lng+d.lng])}function xn(e){for(var t=0,n=0,i=0,r=0;r<e.length;r++){var o=j(e[r]);t+=o.lat,n+=o.lng,i++}return j([t/i,n/i])}var Sn,En={__proto__:null,clipPolygon:wn,polygonCenter:bn,centroid:xn};function Tn(e,t){if(!t||!e.length)return e.slice();var n=t*t;return e=In(e=Nn(e,n),n)}function kn(e,t,n){return Math.sqrt(zn(e,t,n,!0))}function Cn(e,t,n){return zn(e,t,n)}function In(e,t){var n=e.length,i=new(typeof Uint8Array!==void 0+""?Uint8Array:Array)(n);i[0]=i[n-1]=1,An(e,i,t,0,n-1);var r,o=[];for(r=0;r<n;r++)i[r]&&o.push(e[r]);return o}function An(e,t,n,i,r){var o,a,s,c=0;for(a=i+1;a<=r-1;a++)(s=zn(e[a],e[i],e[r],!0))>c&&(o=a,c=s);c>n&&(t[o]=1,An(e,t,n,i,o),An(e,t,n,o,r))}function Nn(e,t){for(var n=[e[0]],i=1,r=0,o=e.length;i<o;i++)Ln(e[i],e[r])>t&&(n.push(e[i]),r=i);return r<o-1&&n.push(e[o-1]),n}function On(e,t,n,i,r){var o,a,s,c=i?Sn:Rn(e,n),l=Rn(t,n);for(Sn=l;;){if(!(c|l))return[e,t];if(c&l)return!1;s=Rn(a=Pn(e,t,o=c||l,n,r),n),o===c?(e=a,c=s):(t=a,l=s)}}function Pn(e,t,n,i,r){var o,a,s=t.x-e.x,c=t.y-e.y,l=i.min,u=i.max;return 8&n?(o=e.x+s*(u.y-e.y)/c,a=u.y):4&n?(o=e.x+s*(l.y-e.y)/c,a=l.y):2&n?(o=u.x,a=e.y+c*(u.x-e.x)/s):1&n&&(o=l.x,a=e.y+c*(l.x-e.x)/s),new P(o,a,r)}function Rn(e,t){var n=0;return e.x<t.min.x?n|=1:e.x>t.max.x&&(n|=2),e.y<t.min.y?n|=4:e.y>t.max.y&&(n|=8),n}function Ln(e,t){var n=t.x-e.x,i=t.y-e.y;return n*n+i*i}function zn(e,t,n,i){var r,o=t.x,a=t.y,s=n.x-o,c=n.y-a,l=s*s+c*c;return l>0&&((r=((e.x-o)*s+(e.y-a)*c)/l)>1?(o=n.x,a=n.y):r>0&&(o+=s*r,a+=c*r)),s=e.x-o,c=e.y-a,i?s*s+c*c:new P(o,a)}function Mn(e){return!y(e[0])||"object"!==typeof e[0][0]&&"undefined"!==typeof e[0][0]}function Dn(e){return console.warn("Deprecated use of _flat, please use L.LineUtil.isFlat instead."),Mn(e)}function Bn(e,t){var n,i,r,o,a,s,c,l;if(!e||0===e.length)throw new Error("latlngs not passed");Mn(e)||(console.warn("latlngs are not flat! Only the first ring will be used"),e=e[0]);var u=j([0,0]),d=U(e);d.getNorthWest().distanceTo(d.getSouthWest())*d.getNorthEast().distanceTo(d.getNorthWest())<1700&&(u=xn(e));var h=e.length,f=[];for(n=0;n<h;n++){var p=j(e[n]);f.push(t.project(j([p.lat-u.lat,p.lng-u.lng])))}for(n=0,i=0;n<h-1;n++)i+=f[n].distanceTo(f[n+1])/2;if(0===i)l=f[0];else for(n=0,o=0;n<h-1;n++)if(a=f[n],s=f[n+1],(o+=r=a.distanceTo(s))>i){c=(o-i)/r,l=[s.x-c*(s.x-a.x),s.y-c*(s.y-a.y)];break}var m=t.unproject(z(l));return j([m.lat+u.lat,m.lng+u.lng])}var Un={__proto__:null,simplify:Tn,pointToSegmentDistance:kn,closestPointOnSegment:Cn,clipSegment:On,_getEdgeIntersection:Pn,_getBitCode:Rn,_sqClosestPointOnSegment:zn,isFlat:Mn,_flat:Dn,polylineCenter:Bn},Fn={project:function(e){return new P(e.lng,e.lat)},unproject:function(e){return new F(e.y,e.x)},bounds:new M([-180,-90],[180,90])},jn={R:6378137,R_MINOR:6356752.314245179,bounds:new M([-20037508.34279,-15496570.73972],[20037508.34279,18764656.23138]),project:function(e){var t=Math.PI/180,n=this.R,i=e.lat*t,r=this.R_MINOR/n,o=Math.sqrt(1-r*r),a=o*Math.sin(i),s=Math.tan(Math.PI/4-i/2)/Math.pow((1-a)/(1+a),o/2);return i=-n*Math.log(Math.max(s,1e-10)),new P(e.lng*t*n,i)},unproject:function(e){for(var t,n=180/Math.PI,i=this.R,r=this.R_MINOR/i,o=Math.sqrt(1-r*r),a=Math.exp(-e.y/i),s=Math.PI/2-2*Math.atan(a),c=0,l=.1;c<15&&Math.abs(l)>1e-7;c++)t=o*Math.sin(s),t=Math.pow((1-t)/(1+t),o/2),s+=l=Math.PI/2-2*Math.atan(a*t)-s;return new F(s*n,e.x*n/i)}},Vn={__proto__:null,LonLat:Fn,Mercator:jn,SphericalMercator:W},qn=n({},q,{code:"EPSG:3395",projection:jn,transformation:function(){var e=.5/(Math.PI*jn.R);return K(e,.5,-e,.5)}()}),Hn=n({},q,{code:"EPSG:4326",projection:Fn,transformation:K(1/180,1,-1/180,.5)}),Wn=n({},V,{projection:Fn,transformation:K(1,0,-1,0),scale:function(e){return Math.pow(2,e)},zoom:function(e){return Math.log(e)/Math.LN2},distance:function(e,t){var n=t.lng-e.lng,i=t.lat-e.lat;return Math.sqrt(n*n+i*i)},infinite:!0});V.Earth=q,V.EPSG3395=qn,V.EPSG3857=Z,V.EPSG900913=Q,V.EPSG4326=Hn,V.Simple=Wn;var Gn=O.extend({options:{pane:"overlayPane",attribution:null,bubblingMouseEvents:!0},addTo:function(e){return e.addLayer(this),this},remove:function(){return this.removeFrom(this._map||this._mapToAdd)},removeFrom:function(e){return e&&e.removeLayer(this),this},getPane:function(e){return this._map.getPane(e?this.options[e]||e:this.options.pane)},addInteractiveTarget:function(e){return this._map._targets[a(e)]=this,this},removeInteractiveTarget:function(e){return delete this._map._targets[a(e)],this},getAttribution:function(){return this.options.attribution},_layerAdd:function(e){var t=e.target;if(t.hasLayer(this)){if(this._map=t,this._zoomAnimated=t._zoomAnimated,this.getEvents){var n=this.getEvents();t.on(n,this),this.once("remove",function(){t.off(n,this)},this)}this.onAdd(t),this.fire("add"),t.fire("layeradd",{layer:this})}}});nn.include({addLayer:function(e){if(!e._layerAdd)throw new Error("The provided object is not a Layer.");var t=a(e);return this._layers[t]||(this._layers[t]=e,e._mapToAdd=this,e.beforeAdd&&e.beforeAdd(this),this.whenReady(e._layerAdd,e)),this},removeLayer:function(e){var t=a(e);return this._layers[t]?(this._loaded&&e.onRemove(this),delete this._layers[t],this._loaded&&(this.fire("layerremove",{layer:e}),e.fire("remove")),e._map=e._mapToAdd=null,this):this},hasLayer:function(e){return a(e)in this._layers},eachLayer:function(e,t){for(var n in this._layers)e.call(t,this._layers[n]);return this},_addLayers:function(e){for(var t=0,n=(e=e?y(e)?e:[e]:[]).length;t<n;t++)this.addLayer(e[t])},_addZoomLimit:function(e){isNaN(e.options.maxZoom)&&isNaN(e.options.minZoom)||(this._zoomBoundLayers[a(e)]=e,this._updateZoomLevels())},_removeZoomLimit:function(e){var t=a(e);this._zoomBoundLayers[t]&&(delete this._zoomBoundLayers[t],this._updateZoomLevels())},_updateZoomLevels:function(){var e=1/0,t=-1/0,n=this._getZoomSpan();for(var i in this._zoomBoundLayers){var r=this._zoomBoundLayers[i].options;e=void 0===r.minZoom?e:Math.min(e,r.minZoom),t=void 0===r.maxZoom?t:Math.max(t,r.maxZoom)}this._layersMaxZoom=t===-1/0?void 0:t,this._layersMinZoom=e===1/0?void 0:e,n!==this._getZoomSpan()&&this.fire("zoomlevelschange"),void 0===this.options.maxZoom&&this._layersMaxZoom&&this.getZoom()>this._layersMaxZoom&&this.setZoom(this._layersMaxZoom),void 0===this.options.minZoom&&this._layersMinZoom&&this.getZoom()<this._layersMinZoom&&this.setZoom(this._layersMinZoom)}});var Kn=Gn.extend({initialize:function(e,t){var n,i;if(f(this,t),this._layers={},e)for(n=0,i=e.length;n<i;n++)this.addLayer(e[n])},addLayer:function(e){var t=this.getLayerId(e);return this._layers[t]=e,this._map&&this._map.addLayer(e),this},removeLayer:function(e){var t=e in this._layers?e:this.getLayerId(e);return this._map&&this._layers[t]&&this._map.removeLayer(this._layers[t]),delete this._layers[t],this},hasLayer:function(e){return("number"===typeof e?e:this.getLayerId(e))in this._layers},clearLayers:function(){return this.eachLayer(this.removeLayer,this)},invoke:function(e){var t,n,i=Array.prototype.slice.call(arguments,1);for(t in this._layers)(n=this._layers[t])[e]&&n[e].apply(n,i);return this},onAdd:function(e){this.eachLayer(e.addLayer,e)},onRemove:function(e){this.eachLayer(e.removeLayer,e)},eachLayer:function(e,t){for(var n in this._layers)e.call(t,this._layers[n]);return this},getLayer:function(e){return this._layers[e]},getLayers:function(){var e=[];return this.eachLayer(e.push,e),e},setZIndex:function(e){return this.invoke("setZIndex",e)},getLayerId:function(e){return a(e)}}),Zn=function(e,t){return new Kn(e,t)},Qn=Kn.extend({addLayer:function(e){return this.hasLayer(e)?this:(e.addEventParent(this),Kn.prototype.addLayer.call(this,e),this.fire("layeradd",{layer:e}))},removeLayer:function(e){return this.hasLayer(e)?(e in this._layers&&(e=this._layers[e]),e.removeEventParent(this),Kn.prototype.removeLayer.call(this,e),this.fire("layerremove",{layer:e})):this},setStyle:function(e){return this.invoke("setStyle",e)},bringToFront:function(){return this.invoke("bringToFront")},bringToBack:function(){return this.invoke("bringToBack")},getBounds:function(){var e=new B;for(var t in this._layers){var n=this._layers[t];e.extend(n.getBounds?n.getBounds():n.getLatLng())}return e}}),Xn=function(e,t){return new Qn(e,t)},Yn=I.extend({options:{popupAnchor:[0,0],tooltipAnchor:[0,0],crossOrigin:!1},initialize:function(e){f(this,e)},createIcon:function(e){return this._createIcon("icon",e)},createShadow:function(e){return this._createIcon("shadow",e)},_createIcon:function(e,t){var n=this._getIconUrl(e);if(!n){if("icon"===e)throw new Error("iconUrl not set in Icon options (see the docs).");return null}var i=this._createImg(n,t&&"IMG"===t.tagName?t:null);return this._setIconStyles(i,e),(this.options.crossOrigin||""===this.options.crossOrigin)&&(i.crossOrigin=!0===this.options.crossOrigin?"":this.options.crossOrigin),i},_setIconStyles:function(e,t){var n=this.options,i=n[t+"Size"];"number"===typeof i&&(i=[i,i]);var r=z(i),o=z("shadow"===t&&n.shadowAnchor||n.iconAnchor||r&&r.divideBy(2,!0));e.className="leaflet-marker-"+t+" "+(n.className||""),o&&(e.style.marginLeft=-o.x+"px",e.style.marginTop=-o.y+"px"),r&&(e.style.width=r.x+"px",e.style.height=r.y+"px")},_createImg:function(e,t){return(t=t||document.createElement("img")).src=e,t},_getIconUrl:function(e){return Me.retina&&this.options[e+"RetinaUrl"]||this.options[e+"Url"]}});function Jn(e){return new Yn(e)}var $n=Yn.extend({options:{iconUrl:"marker-icon.png",iconRetinaUrl:"marker-icon-2x.png",shadowUrl:"marker-shadow.png",iconSize:[25,41],iconAnchor:[12,41],popupAnchor:[1,-34],tooltipAnchor:[16,-28],shadowSize:[41,41]},_getIconUrl:function(e){return"string"!==typeof $n.imagePath&&($n.imagePath=this._detectIconPath()),(this.options.imagePath||$n.imagePath)+Yn.prototype._getIconUrl.call(this,e)},_stripUrl:function(e){var t=function(e,t,n){var i=t.exec(e);return i&&i[n]};return(e=t(e,/^url\((['"])?(.+)\1\)$/,2))&&t(e,/^(.*)marker-icon\.png$/,1)},_detectIconPath:function(){var e=ft("div","leaflet-default-icon-path",document.body),t=ht(e,"background-image")||ht(e,"backgroundImage");if(document.body.removeChild(e),t=this._stripUrl(t))return t;var n=document.querySelector('link[href$="leaflet.css"]');return n?n.href.substring(0,n.href.length-11-1):""}}),ei=gn.extend({initialize:function(e){this._marker=e},addHooks:function(){var e=this._marker._icon;this._draggable||(this._draggable=new _n(e,e,!0)),this._draggable.on({dragstart:this._onDragStart,predrag:this._onPreDrag,drag:this._onDrag,dragend:this._onDragEnd},this).enable(),_t(e,"leaflet-marker-draggable")},removeHooks:function(){this._draggable.off({dragstart:this._onDragStart,predrag:this._onPreDrag,drag:this._onDrag,dragend:this._onDragEnd},this).disable(),this._marker._icon&&wt(this._marker._icon,"leaflet-marker-draggable")},moved:function(){return this._draggable&&this._draggable._moved},_adjustPan:function(e){var t=this._marker,n=t._map,i=this._marker.options.autoPanSpeed,r=this._marker.options.autoPanPadding,o=It(t._icon),a=n.getPixelBounds(),s=n.getPixelOrigin(),c=D(a.min._subtract(s).add(r),a.max._subtract(s).subtract(r));if(!c.contains(o)){var l=z((Math.max(c.max.x,o.x)-c.max.x)/(a.max.x-c.max.x)-(Math.min(c.min.x,o.x)-c.min.x)/(a.min.x-c.min.x),(Math.max(c.max.y,o.y)-c.max.y)/(a.max.y-c.max.y)-(Math.min(c.min.y,o.y)-c.min.y)/(a.min.y-c.min.y)).multiplyBy(i);n.panBy(l,{animate:!1}),this._draggable._newPos._add(l),this._draggable._startPos._add(l),Ct(t._icon,this._draggable._newPos),this._onDrag(e),this._panRequest=T(this._adjustPan.bind(this,e))}},_onDragStart:function(){this._oldLatLng=this._marker.getLatLng(),this._marker.closePopup&&this._marker.closePopup(),this._marker.fire("movestart").fire("dragstart")},_onPreDrag:function(e){this._marker.options.autoPan&&(k(this._panRequest),this._panRequest=T(this._adjustPan.bind(this,e)))},_onDrag:function(e){var t=this._marker,n=t._shadow,i=It(t._icon),r=t._map.layerPointToLatLng(i);n&&Ct(n,i),t._latlng=r,e.latlng=r,e.oldLatLng=this._oldLatLng,t.fire("move",e).fire("drag",e)},_onDragEnd:function(e){k(this._panRequest),delete this._oldLatLng,this._marker.fire("moveend").fire("dragend",e)}}),ti=Gn.extend({options:{icon:new $n,interactive:!0,keyboard:!0,title:"",alt:"Marker",zIndexOffset:0,opacity:1,riseOnHover:!1,riseOffset:250,pane:"markerPane",shadowPane:"shadowPane",bubblingMouseEvents:!1,autoPanOnFocus:!0,draggable:!1,autoPan:!1,autoPanPadding:[50,50],autoPanSpeed:10},initialize:function(e,t){f(this,t),this._latlng=j(e)},onAdd:function(e){this._zoomAnimated=this._zoomAnimated&&e.options.markerZoomAnimation,this._zoomAnimated&&e.on("zoomanim",this._animateZoom,this),this._initIcon(),this.update()},onRemove:function(e){this.dragging&&this.dragging.enabled()&&(this.options.draggable=!0,this.dragging.removeHooks()),delete this.dragging,this._zoomAnimated&&e.off("zoomanim",this._animateZoom,this),this._removeIcon(),this._removeShadow()},getEvents:function(){return{zoom:this.update,viewreset:this.update}},getLatLng:function(){return this._latlng},setLatLng:function(e){var t=this._latlng;return this._latlng=j(e),this.update(),this.fire("move",{oldLatLng:t,latlng:this._latlng})},setZIndexOffset:function(e){return this.options.zIndexOffset=e,this.update()},getIcon:function(){return this.options.icon},setIcon:function(e){return this.options.icon=e,this._map&&(this._initIcon(),this.update()),this._popup&&this.bindPopup(this._popup,this._popup.options),this},getElement:function(){return this._icon},update:function(){if(this._icon&&this._map){var e=this._map.latLngToLayerPoint(this._latlng).round();this._setPos(e)}return this},_initIcon:function(){var e=this.options,t="leaflet-zoom-"+(this._zoomAnimated?"animated":"hide"),n=e.icon.createIcon(this._icon),i=!1;n!==this._icon&&(this._icon&&this._removeIcon(),i=!0,e.title&&(n.title=e.title),"IMG"===n.tagName&&(n.alt=e.alt||"")),_t(n,t),e.keyboard&&(n.tabIndex="0",n.setAttribute("role","button")),this._icon=n,e.riseOnHover&&this.on({mouseover:this._bringToFront,mouseout:this._resetZIndex}),this.options.autoPanOnFocus&&Dt(n,"focus",this._panOnFocus,this);var r=e.icon.createShadow(this._shadow),o=!1;r!==this._shadow&&(this._removeShadow(),o=!0),r&&(_t(r,t),r.alt=""),this._shadow=r,e.opacity<1&&this._updateOpacity(),i&&this.getPane().appendChild(this._icon),this._initInteraction(),r&&o&&this.getPane(e.shadowPane).appendChild(this._shadow)},_removeIcon:function(){this.options.riseOnHover&&this.off({mouseover:this._bringToFront,mouseout:this._resetZIndex}),this.options.autoPanOnFocus&&Ut(this._icon,"focus",this._panOnFocus,this),pt(this._icon),this.removeInteractiveTarget(this._icon),this._icon=null},_removeShadow:function(){this._shadow&&pt(this._shadow),this._shadow=null},_setPos:function(e){this._icon&&Ct(this._icon,e),this._shadow&&Ct(this._shadow,e),this._zIndex=e.y+this.options.zIndexOffset,this._resetZIndex()},_updateZIndex:function(e){this._icon&&(this._icon.style.zIndex=this._zIndex+e)},_animateZoom:function(e){var t=this._map._latLngToNewLayerPoint(this._latlng,e.zoom,e.center).round();this._setPos(t)},_initInteraction:function(){if(this.options.interactive&&(_t(this._icon,"leaflet-interactive"),this.addInteractiveTarget(this._icon),ei)){var e=this.options.draggable;this.dragging&&(e=this.dragging.enabled(),this.dragging.disable()),this.dragging=new ei(this),e&&this.dragging.enable()}},setOpacity:function(e){return this.options.opacity=e,this._map&&this._updateOpacity(),this},_updateOpacity:function(){var e=this.options.opacity;this._icon&&St(this._icon,e),this._shadow&&St(this._shadow,e)},_bringToFront:function(){this._updateZIndex(this.options.riseOffset)},_resetZIndex:function(){this._updateZIndex(0)},_panOnFocus:function(){var e=this._map;if(e){var t=this.options.icon.options,n=t.iconSize?z(t.iconSize):z(0,0),i=t.iconAnchor?z(t.iconAnchor):z(0,0);e.panInside(this._latlng,{paddingTopLeft:i,paddingBottomRight:n.subtract(i)})}},_getPopupAnchor:function(){return this.options.icon.options.popupAnchor},_getTooltipAnchor:function(){return this.options.icon.options.tooltipAnchor}});function ni(e,t){return new ti(e,t)}var ii=Gn.extend({options:{stroke:!0,color:"#3388ff",weight:3,opacity:1,lineCap:"round",lineJoin:"round",dashArray:null,dashOffset:null,fill:!1,fillColor:null,fillOpacity:.2,fillRule:"evenodd",interactive:!0,bubblingMouseEvents:!0},beforeAdd:function(e){this._renderer=e.getRenderer(this)},onAdd:function(){this._renderer._initPath(this),this._reset(),this._renderer._addPath(this)},onRemove:function(){this._renderer._removePath(this)},redraw:function(){return this._map&&this._renderer._updatePath(this),this},setStyle:function(e){return f(this,e),this._renderer&&(this._renderer._updateStyle(this),this.options.stroke&&e&&Object.prototype.hasOwnProperty.call(e,"weight")&&this._updateBounds()),this},bringToFront:function(){return this._renderer&&this._renderer._bringToFront(this),this},bringToBack:function(){return this._renderer&&this._renderer._bringToBack(this),this},getElement:function(){return this._path},_reset:function(){this._project(),this._update()},_clickTolerance:function(){return(this.options.stroke?this.options.weight/2:0)+(this._renderer.options.tolerance||0)}}),ri=ii.extend({options:{fill:!0,radius:10},initialize:function(e,t){f(this,t),this._latlng=j(e),this._radius=this.options.radius},setLatLng:function(e){var t=this._latlng;return this._latlng=j(e),this.redraw(),this.fire("move",{oldLatLng:t,latlng:this._latlng})},getLatLng:function(){return this._latlng},setRadius:function(e){return this.options.radius=this._radius=e,this.redraw()},getRadius:function(){return this._radius},setStyle:function(e){var t=e&&e.radius||this._radius;return ii.prototype.setStyle.call(this,e),this.setRadius(t),this},_project:function(){this._point=this._map.latLngToLayerPoint(this._latlng),this._updateBounds()},_updateBounds:function(){var e=this._radius,t=this._radiusY||e,n=this._clickTolerance(),i=[e+n,t+n];this._pxBounds=new M(this._point.subtract(i),this._point.add(i))},_update:function(){this._map&&this._updatePath()},_updatePath:function(){this._renderer._updateCircle(this)},_empty:function(){return this._radius&&!this._renderer._bounds.intersects(this._pxBounds)},_containsPoint:function(e){return e.distanceTo(this._point)<=this._radius+this._clickTolerance()}});function oi(e,t){return new ri(e,t)}var ai=ri.extend({initialize:function(e,t,i){if("number"===typeof t&&(t=n({},i,{radius:t})),f(this,t),this._latlng=j(e),isNaN(this.options.radius))throw new Error("Circle radius cannot be NaN");this._mRadius=this.options.radius},setRadius:function(e){return this._mRadius=e,this.redraw()},getRadius:function(){return this._mRadius},getBounds:function(){var e=[this._radius,this._radiusY||this._radius];return new B(this._map.layerPointToLatLng(this._point.subtract(e)),this._map.layerPointToLatLng(this._point.add(e)))},setStyle:ii.prototype.setStyle,_project:function(){var e=this._latlng.lng,t=this._latlng.lat,n=this._map,i=n.options.crs;if(i.distance===q.distance){var r=Math.PI/180,o=this._mRadius/q.R/r,a=n.project([t+o,e]),s=n.project([t-o,e]),c=a.add(s).divideBy(2),l=n.unproject(c).lat,u=Math.acos((Math.cos(o*r)-Math.sin(t*r)*Math.sin(l*r))/(Math.cos(t*r)*Math.cos(l*r)))/r;(isNaN(u)||0===u)&&(u=o/Math.cos(Math.PI/180*t)),this._point=c.subtract(n.getPixelOrigin()),this._radius=isNaN(u)?0:c.x-n.project([l,e-u]).x,this._radiusY=c.y-a.y}else{var d=i.unproject(i.project(this._latlng).subtract([this._mRadius,0]));this._point=n.latLngToLayerPoint(this._latlng),this._radius=this._point.x-n.latLngToLayerPoint(d).x}this._updateBounds()}});function si(e,t,n){return new ai(e,t,n)}var ci=ii.extend({options:{smoothFactor:1,noClip:!1},initialize:function(e,t){f(this,t),this._setLatLngs(e)},getLatLngs:function(){return this._latlngs},setLatLngs:function(e){return this._setLatLngs(e),this.redraw()},isEmpty:function(){return!this._latlngs.length},closestLayerPoint:function(e){for(var t,n,i=1/0,r=null,o=zn,a=0,s=this._parts.length;a<s;a++)for(var c=this._parts[a],l=1,u=c.length;l<u;l++){var d=o(e,t=c[l-1],n=c[l],!0);d<i&&(i=d,r=o(e,t,n))}return r&&(r.distance=Math.sqrt(i)),r},getCenter:function(){if(!this._map)throw new Error("Must add layer to map before using getCenter()");return Bn(this._defaultShape(),this._map.options.crs)},getBounds:function(){return this._bounds},addLatLng:function(e,t){return t=t||this._defaultShape(),e=j(e),t.push(e),this._bounds.extend(e),this.redraw()},_setLatLngs:function(e){this._bounds=new B,this._latlngs=this._convertLatLngs(e)},_defaultShape:function(){return Mn(this._latlngs)?this._latlngs:this._latlngs[0]},_convertLatLngs:function(e){for(var t=[],n=Mn(e),i=0,r=e.length;i<r;i++)n?(t[i]=j(e[i]),this._bounds.extend(t[i])):t[i]=this._convertLatLngs(e[i]);return t},_project:function(){var e=new M;this._rings=[],this._projectLatlngs(this._latlngs,this._rings,e),this._bounds.isValid()&&e.isValid()&&(this._rawPxBounds=e,this._updateBounds())},_updateBounds:function(){var e=this._clickTolerance(),t=new P(e,e);this._rawPxBounds&&(this._pxBounds=new M([this._rawPxBounds.min.subtract(t),this._rawPxBounds.max.add(t)]))},_projectLatlngs:function(e,t,n){var i,r,o=e[0]instanceof F,a=e.length;if(o){for(r=[],i=0;i<a;i++)r[i]=this._map.latLngToLayerPoint(e[i]),n.extend(r[i]);t.push(r)}else for(i=0;i<a;i++)this._projectLatlngs(e[i],t,n)},_clipPoints:function(){var e=this._renderer._bounds;if(this._parts=[],this._pxBounds&&this._pxBounds.intersects(e))if(this.options.noClip)this._parts=this._rings;else{var t,n,i,r,o,a,s,c=this._parts;for(t=0,i=0,r=this._rings.length;t<r;t++)for(n=0,o=(s=this._rings[t]).length;n<o-1;n++)(a=On(s[n],s[n+1],e,n,!0))&&(c[i]=c[i]||[],c[i].push(a[0]),a[1]===s[n+1]&&n!==o-2||(c[i].push(a[1]),i++))}},_simplifyPoints:function(){for(var e=this._parts,t=this.options.smoothFactor,n=0,i=e.length;n<i;n++)e[n]=Tn(e[n],t)},_update:function(){this._map&&(this._clipPoints(),this._simplifyPoints(),this._updatePath())},_updatePath:function(){this._renderer._updatePoly(this)},_containsPoint:function(e,t){var n,i,r,o,a,s,c=this._clickTolerance();if(!this._pxBounds||!this._pxBounds.contains(e))return!1;for(n=0,o=this._parts.length;n<o;n++)for(i=0,r=(a=(s=this._parts[n]).length)-1;i<a;r=i++)if((t||0!==i)&&kn(e,s[r],s[i])<=c)return!0;return!1}});function li(e,t){return new ci(e,t)}ci._flat=Dn;var ui=ci.extend({options:{fill:!0},isEmpty:function(){return!this._latlngs.length||!this._latlngs[0].length},getCenter:function(){if(!this._map)throw new Error("Must add layer to map before using getCenter()");return bn(this._defaultShape(),this._map.options.crs)},_convertLatLngs:function(e){var t=ci.prototype._convertLatLngs.call(this,e),n=t.length;return n>=2&&t[0]instanceof F&&t[0].equals(t[n-1])&&t.pop(),t},_setLatLngs:function(e){ci.prototype._setLatLngs.call(this,e),Mn(this._latlngs)&&(this._latlngs=[this._latlngs])},_defaultShape:function(){return Mn(this._latlngs[0])?this._latlngs[0]:this._latlngs[0][0]},_clipPoints:function(){var e=this._renderer._bounds,t=this.options.weight,n=new P(t,t);if(e=new M(e.min.subtract(n),e.max.add(n)),this._parts=[],this._pxBounds&&this._pxBounds.intersects(e))if(this.options.noClip)this._parts=this._rings;else for(var i,r=0,o=this._rings.length;r<o;r++)(i=wn(this._rings[r],e,!0)).length&&this._parts.push(i)},_updatePath:function(){this._renderer._updatePoly(this,!0)},_containsPoint:function(e){var t,n,i,r,o,a,s,c,l=!1;if(!this._pxBounds||!this._pxBounds.contains(e))return!1;for(r=0,s=this._parts.length;r<s;r++)for(o=0,a=(c=(t=this._parts[r]).length)-1;o<c;a=o++)n=t[o],i=t[a],n.y>e.y!==i.y>e.y&&e.x<(i.x-n.x)*(e.y-n.y)/(i.y-n.y)+n.x&&(l=!l);return l||ci.prototype._containsPoint.call(this,e,!0)}});function di(e,t){return new ui(e,t)}var hi=Qn.extend({initialize:function(e,t){f(this,t),this._layers={},e&&this.addData(e)},addData:function(e){var t,n,i,r=y(e)?e:e.features;if(r){for(t=0,n=r.length;t<n;t++)((i=r[t]).geometries||i.geometry||i.features||i.coordinates)&&this.addData(i);return this}var o=this.options;if(o.filter&&!o.filter(e))return this;var a=fi(e,o);return a?(a.feature=wi(e),a.defaultOptions=a.options,this.resetStyle(a),o.onEachFeature&&o.onEachFeature(e,a),this.addLayer(a)):this},resetStyle:function(e){return void 0===e?this.eachLayer(this.resetStyle,this):(e.options=n({},e.defaultOptions),this._setLayerStyle(e,this.options.style),this)},setStyle:function(e){return this.eachLayer(function(t){this._setLayerStyle(t,e)},this)},_setLayerStyle:function(e,t){e.setStyle&&("function"===typeof t&&(t=t(e.feature)),e.setStyle(t))}});function fi(e,t){var n,i,r,o,a="Feature"===e.type?e.geometry:e,s=a?a.coordinates:null,c=[],l=t&&t.pointToLayer,u=t&&t.coordsToLatLng||mi;if(!s&&!a)return null;switch(a.type){case"Point":return pi(l,e,n=u(s),t);case"MultiPoint":for(r=0,o=s.length;r<o;r++)n=u(s[r]),c.push(pi(l,e,n,t));return new Qn(c);case"LineString":case"MultiLineString":return i=gi(s,"LineString"===a.type?0:1,u),new ci(i,t);case"Polygon":case"MultiPolygon":return i=gi(s,"Polygon"===a.type?1:2,u),new ui(i,t);case"GeometryCollection":for(r=0,o=a.geometries.length;r<o;r++){var d=fi({geometry:a.geometries[r],type:"Feature",properties:e.properties},t);d&&c.push(d)}return new Qn(c);case"FeatureCollection":for(r=0,o=a.features.length;r<o;r++){var h=fi(a.features[r],t);h&&c.push(h)}return new Qn(c);default:throw new Error("Invalid GeoJSON object.")}}function pi(e,t,n,i){return e?e(t,n):new ti(n,i&&i.markersInheritOptions&&i)}function mi(e){return new F(e[1],e[0],e[2])}function gi(e,t,n){for(var i,r=[],o=0,a=e.length;o<a;o++)i=t?gi(e[o],t-1,n):(n||mi)(e[o]),r.push(i);return r}function yi(e,t){return void 0!==(e=j(e)).alt?[u(e.lng,t),u(e.lat,t),u(e.alt,t)]:[u(e.lng,t),u(e.lat,t)]}function vi(e,t,n,i){for(var r=[],o=0,a=e.length;o<a;o++)r.push(t?vi(e[o],Mn(e[o])?0:t-1,n,i):yi(e[o],i));return!t&&n&&r.length>0&&r.push(r[0].slice()),r}function _i(e,t){return e.feature?n({},e.feature,{geometry:t}):wi(t)}function wi(e){return"Feature"===e.type||"FeatureCollection"===e.type?e:{type:"Feature",properties:{},geometry:e}}var bi={toGeoJSON:function(e){return _i(this,{type:"Point",coordinates:yi(this.getLatLng(),e)})}};function xi(e,t){return new hi(e,t)}ti.include(bi),ai.include(bi),ri.include(bi),ci.include({toGeoJSON:function(e){var t=!Mn(this._latlngs);return _i(this,{type:(t?"Multi":"")+"LineString",coordinates:vi(this._latlngs,t?1:0,!1,e)})}}),ui.include({toGeoJSON:function(e){var t=!Mn(this._latlngs),n=t&&!Mn(this._latlngs[0]),i=vi(this._latlngs,n?2:t?1:0,!0,e);return t||(i=[i]),_i(this,{type:(n?"Multi":"")+"Polygon",coordinates:i})}}),Kn.include({toMultiPoint:function(e){var t=[];return this.eachLayer(function(n){t.push(n.toGeoJSON(e).geometry.coordinates)}),_i(this,{type:"MultiPoint",coordinates:t})},toGeoJSON:function(e){var t=this.feature&&this.feature.geometry&&this.feature.geometry.type;if("MultiPoint"===t)return this.toMultiPoint(e);var n="GeometryCollection"===t,i=[];return this.eachLayer(function(t){if(t.toGeoJSON){var r=t.toGeoJSON(e);if(n)i.push(r.geometry);else{var o=wi(r);"FeatureCollection"===o.type?i.push.apply(i,o.features):i.push(o)}}}),n?_i(this,{geometries:i,type:"GeometryCollection"}):{type:"FeatureCollection",features:i}}});var Si=xi,Ei=Gn.extend({options:{opacity:1,alt:"",interactive:!1,crossOrigin:!1,errorOverlayUrl:"",zIndex:1,className:""},initialize:function(e,t,n){this._url=e,this._bounds=U(t),f(this,n)},onAdd:function(){this._image||(this._initImage(),this.options.opacity<1&&this._updateOpacity()),this.options.interactive&&(_t(this._image,"leaflet-interactive"),this.addInteractiveTarget(this._image)),this.getPane().appendChild(this._image),this._reset()},onRemove:function(){pt(this._image),this.options.interactive&&this.removeInteractiveTarget(this._image)},setOpacity:function(e){return this.options.opacity=e,this._image&&this._updateOpacity(),this},setStyle:function(e){return e.opacity&&this.setOpacity(e.opacity),this},bringToFront:function(){return this._map&&gt(this._image),this},bringToBack:function(){return this._map&&yt(this._image),this},setUrl:function(e){return this._url=e,this._image&&(this._image.src=e),this},setBounds:function(e){return this._bounds=U(e),this._map&&this._reset(),this},getEvents:function(){var e={zoom:this._reset,viewreset:this._reset};return this._zoomAnimated&&(e.zoomanim=this._animateZoom),e},setZIndex:function(e){return this.options.zIndex=e,this._updateZIndex(),this},getBounds:function(){return this._bounds},getElement:function(){return this._image},_initImage:function(){var e="IMG"===this._url.tagName,t=this._image=e?this._url:ft("img");_t(t,"leaflet-image-layer"),this._zoomAnimated&&_t(t,"leaflet-zoom-animated"),this.options.className&&_t(t,this.options.className),t.onselectstart=l,t.onmousemove=l,t.onload=r(this.fire,this,"load"),t.onerror=r(this._overlayOnError,this,"error"),(this.options.crossOrigin||""===this.options.crossOrigin)&&(t.crossOrigin=!0===this.options.crossOrigin?"":this.options.crossOrigin),this.options.zIndex&&this._updateZIndex(),e?this._url=t.src:(t.src=this._url,t.alt=this.options.alt)},_animateZoom:function(e){var t=this._map.getZoomScale(e.zoom),n=this._map._latLngBoundsToNewLayerBounds(this._bounds,e.zoom,e.center).min;kt(this._image,n,t)},_reset:function(){var e=this._image,t=new M(this._map.latLngToLayerPoint(this._bounds.getNorthWest()),this._map.latLngToLayerPoint(this._bounds.getSouthEast())),n=t.getSize();Ct(e,t.min),e.style.width=n.x+"px",e.style.height=n.y+"px"},_updateOpacity:function(){St(this._image,this.options.opacity)},_updateZIndex:function(){this._image&&void 0!==this.options.zIndex&&null!==this.options.zIndex&&(this._image.style.zIndex=this.options.zIndex)},_overlayOnError:function(){this.fire("error");var e=this.options.errorOverlayUrl;e&&this._url!==e&&(this._url=e,this._image.src=e)},getCenter:function(){return this._bounds.getCenter()}}),Ti=function(e,t,n){return new Ei(e,t,n)},ki=Ei.extend({options:{autoplay:!0,loop:!0,keepAspectRatio:!0,muted:!1,playsInline:!0},_initImage:function(){var e="VIDEO"===this._url.tagName,t=this._image=e?this._url:ft("video");if(_t(t,"leaflet-image-layer"),this._zoomAnimated&&_t(t,"leaflet-zoom-animated"),this.options.className&&_t(t,this.options.className),t.onselectstart=l,t.onmousemove=l,t.onloadeddata=r(this.fire,this,"load"),e){for(var n=t.getElementsByTagName("source"),i=[],o=0;o<n.length;o++)i.push(n[o].src);this._url=n.length>0?i:[t.src]}else{y(this._url)||(this._url=[this._url]),!this.options.keepAspectRatio&&Object.prototype.hasOwnProperty.call(t.style,"objectFit")&&(t.style.objectFit="fill"),t.autoplay=!!this.options.autoplay,t.loop=!!this.options.loop,t.muted=!!this.options.muted,t.playsInline=!!this.options.playsInline;for(var a=0;a<this._url.length;a++){var s=ft("source");s.src=this._url[a],t.appendChild(s)}}}});function Ci(e,t,n){return new ki(e,t,n)}var Ii=Ei.extend({_initImage:function(){var e=this._image=this._url;_t(e,"leaflet-image-layer"),this._zoomAnimated&&_t(e,"leaflet-zoom-animated"),this.options.className&&_t(e,this.options.className),e.onselectstart=l,e.onmousemove=l}});function Ai(e,t,n){return new Ii(e,t,n)}var Ni=Gn.extend({options:{interactive:!1,offset:[0,0],className:"",pane:void 0,content:""},initialize:function(e,t){e&&(e instanceof F||y(e))?(this._latlng=j(e),f(this,t)):(f(this,e),this._source=t),this.options.content&&(this._content=this.options.content)},openOn:function(e){return(e=arguments.length?e:this._source._map).hasLayer(this)||e.addLayer(this),this},close:function(){return this._map&&this._map.removeLayer(this),this},toggle:function(e){return this._map?this.close():(arguments.length?this._source=e:e=this._source,this._prepareOpen(),this.openOn(e._map)),this},onAdd:function(e){this._zoomAnimated=e._zoomAnimated,this._container||this._initLayout(),e._fadeAnimated&&St(this._container,0),clearTimeout(this._removeTimeout),this.getPane().appendChild(this._container),this.update(),e._fadeAnimated&&St(this._container,1),this.bringToFront(),this.options.interactive&&(_t(this._container,"leaflet-interactive"),this.addInteractiveTarget(this._container))},onRemove:function(e){e._fadeAnimated?(St(this._container,0),this._removeTimeout=setTimeout(r(pt,void 0,this._container),200)):pt(this._container),this.options.interactive&&(wt(this._container,"leaflet-interactive"),this.removeInteractiveTarget(this._container))},getLatLng:function(){return this._latlng},setLatLng:function(e){return this._latlng=j(e),this._map&&(this._updatePosition(),this._adjustPan()),this},getContent:function(){return this._content},setContent:function(e){return this._content=e,this.update(),this},getElement:function(){return this._container},update:function(){this._map&&(this._container.style.visibility="hidden",this._updateContent(),this._updateLayout(),this._updatePosition(),this._container.style.visibility="",this._adjustPan())},getEvents:function(){var e={zoom:this._updatePosition,viewreset:this._updatePosition};return this._zoomAnimated&&(e.zoomanim=this._animateZoom),e},isOpen:function(){return!!this._map&&this._map.hasLayer(this)},bringToFront:function(){return this._map&&gt(this._container),this},bringToBack:function(){return this._map&&yt(this._container),this},_prepareOpen:function(e){var t=this._source;if(!t._map)return!1;if(t instanceof Qn){t=null;var n=this._source._layers;for(var i in n)if(n[i]._map){t=n[i];break}if(!t)return!1;this._source=t}if(!e)if(t.getCenter)e=t.getCenter();else if(t.getLatLng)e=t.getLatLng();else{if(!t.getBounds)throw new Error("Unable to get source layer LatLng.");e=t.getBounds().getCenter()}return this.setLatLng(e),this._map&&this.update(),!0},_updateContent:function(){if(this._content){var e=this._contentNode,t="function"===typeof this._content?this._content(this._source||this):this._content;if("string"===typeof t)e.innerHTML=t;else{for(;e.hasChildNodes();)e.removeChild(e.firstChild);e.appendChild(t)}this.fire("contentupdate")}},_updatePosition:function(){if(this._map){var e=this._map.latLngToLayerPoint(this._latlng),t=z(this.options.offset),n=this._getAnchor();this._zoomAnimated?Ct(this._container,e.add(n)):t=t.add(e).add(n);var i=this._containerBottom=-t.y,r=this._containerLeft=-Math.round(this._containerWidth/2)+t.x;this._container.style.bottom=i+"px",this._container.style.left=r+"px"}},_getAnchor:function(){return[0,0]}});nn.include({_initOverlay:function(e,t,n,i){var r=t;return r instanceof e||(r=new e(i).setContent(t)),n&&r.setLatLng(n),r}}),Gn.include({_initOverlay:function(e,t,n,i){var r=n;return r instanceof e?(f(r,i),r._source=this):(r=t&&!i?t:new e(i,this)).setContent(n),r}});var Oi=Ni.extend({options:{pane:"popupPane",offset:[0,7],maxWidth:300,minWidth:50,maxHeight:null,autoPan:!0,autoPanPaddingTopLeft:null,autoPanPaddingBottomRight:null,autoPanPadding:[5,5],keepInView:!1,closeButton:!0,autoClose:!0,closeOnEscapeKey:!0,className:""},openOn:function(e){return!(e=arguments.length?e:this._source._map).hasLayer(this)&&e._popup&&e._popup.options.autoClose&&e.removeLayer(e._popup),e._popup=this,Ni.prototype.openOn.call(this,e)},onAdd:function(e){Ni.prototype.onAdd.call(this,e),e.fire("popupopen",{popup:this}),this._source&&(this._source.fire("popupopen",{popup:this},!0),this._source instanceof ii||this._source.on("preclick",Ht))},onRemove:function(e){Ni.prototype.onRemove.call(this,e),e.fire("popupclose",{popup:this}),this._source&&(this._source.fire("popupclose",{popup:this},!0),this._source instanceof ii||this._source.off("preclick",Ht))},getEvents:function(){var e=Ni.prototype.getEvents.call(this);return(void 0!==this.options.closeOnClick?this.options.closeOnClick:this._map.options.closePopupOnClick)&&(e.preclick=this.close),this.options.keepInView&&(e.moveend=this._adjustPan),e},_initLayout:function(){var e="leaflet-popup",t=this._container=ft("div",e+" "+(this.options.className||"")+" leaflet-zoom-animated"),n=this._wrapper=ft("div",e+"-content-wrapper",t);if(this._contentNode=ft("div",e+"-content",n),Gt(t),Wt(this._contentNode),Dt(t,"contextmenu",Ht),this._tipContainer=ft("div",e+"-tip-container",t),this._tip=ft("div",e+"-tip",this._tipContainer),this.options.closeButton){var i=this._closeButton=ft("a",e+"-close-button",t);i.setAttribute("role","button"),i.setAttribute("aria-label","Close popup"),i.href="#close",i.innerHTML='<span aria-hidden="true">&#215;</span>',Dt(i,"click",function(e){Kt(e),this.close()},this)}},_updateLayout:function(){var e=this._contentNode,t=e.style;t.width="",t.whiteSpace="nowrap";var n=e.offsetWidth;n=Math.min(n,this.options.maxWidth),n=Math.max(n,this.options.minWidth),t.width=n+1+"px",t.whiteSpace="",t.height="";var i=e.offsetHeight,r=this.options.maxHeight,o="leaflet-popup-scrolled";r&&i>r?(t.height=r+"px",_t(e,o)):wt(e,o),this._containerWidth=this._container.offsetWidth},_animateZoom:function(e){var t=this._map._latLngToNewLayerPoint(this._latlng,e.zoom,e.center),n=this._getAnchor();Ct(this._container,t.add(n))},_adjustPan:function(){if(this.options.autoPan)if(this._map._panAnim&&this._map._panAnim.stop(),this._autopanning)this._autopanning=!1;else{var e=this._map,t=parseInt(ht(this._container,"marginBottom"),10)||0,n=this._container.offsetHeight+t,i=this._containerWidth,r=new P(this._containerLeft,-n-this._containerBottom);r._add(It(this._container));var o=e.layerPointToContainerPoint(r),a=z(this.options.autoPanPadding),s=z(this.options.autoPanPaddingTopLeft||a),c=z(this.options.autoPanPaddingBottomRight||a),l=e.getSize(),u=0,d=0;o.x+i+c.x>l.x&&(u=o.x+i-l.x+c.x),o.x-u-s.x<0&&(u=o.x-s.x),o.y+n+c.y>l.y&&(d=o.y+n-l.y+c.y),o.y-d-s.y<0&&(d=o.y-s.y),(u||d)&&(this.options.keepInView&&(this._autopanning=!0),e.fire("autopanstart").panBy([u,d]))}},_getAnchor:function(){return z(this._source&&this._source._getPopupAnchor?this._source._getPopupAnchor():[0,0])}}),Pi=function(e,t){return new Oi(e,t)};nn.mergeOptions({closePopupOnClick:!0}),nn.include({openPopup:function(e,t,n){return this._initOverlay(Oi,e,t,n).openOn(this),this},closePopup:function(e){return(e=arguments.length?e:this._popup)&&e.close(),this}}),Gn.include({bindPopup:function(e,t){return this._popup=this._initOverlay(Oi,this._popup,e,t),this._popupHandlersAdded||(this.on({click:this._openPopup,keypress:this._onKeyPress,remove:this.closePopup,move:this._movePopup}),this._popupHandlersAdded=!0),this},unbindPopup:function(){return this._popup&&(this.off({click:this._openPopup,keypress:this._onKeyPress,remove:this.closePopup,move:this._movePopup}),this._popupHandlersAdded=!1,this._popup=null),this},openPopup:function(e){return this._popup&&(this instanceof Qn||(this._popup._source=this),this._popup._prepareOpen(e||this._latlng)&&this._popup.openOn(this._map)),this},closePopup:function(){return this._popup&&this._popup.close(),this},togglePopup:function(){return this._popup&&this._popup.toggle(this),this},isPopupOpen:function(){return!!this._popup&&this._popup.isOpen()},setPopupContent:function(e){return this._popup&&this._popup.setContent(e),this},getPopup:function(){return this._popup},_openPopup:function(e){if(this._popup&&this._map){Zt(e);var t=e.layer||e.target;this._popup._source!==t||t instanceof ii?(this._popup._source=t,this.openPopup(e.latlng)):this._map.hasLayer(this._popup)?this.closePopup():this.openPopup(e.latlng)}},_movePopup:function(e){this._popup.setLatLng(e.latlng)},_onKeyPress:function(e){13===e.originalEvent.keyCode&&this._openPopup(e)}});var Ri=Ni.extend({options:{pane:"tooltipPane",offset:[0,0],direction:"auto",permanent:!1,sticky:!1,opacity:.9},onAdd:function(e){Ni.prototype.onAdd.call(this,e),this.setOpacity(this.options.opacity),e.fire("tooltipopen",{tooltip:this}),this._source&&(this.addEventParent(this._source),this._source.fire("tooltipopen",{tooltip:this},!0))},onRemove:function(e){Ni.prototype.onRemove.call(this,e),e.fire("tooltipclose",{tooltip:this}),this._source&&(this.removeEventParent(this._source),this._source.fire("tooltipclose",{tooltip:this},!0))},getEvents:function(){var e=Ni.prototype.getEvents.call(this);return this.options.permanent||(e.preclick=this.close),e},_initLayout:function(){var e="leaflet-tooltip "+(this.options.className||"")+" leaflet-zoom-"+(this._zoomAnimated?"animated":"hide");this._contentNode=this._container=ft("div",e),this._container.setAttribute("role","tooltip"),this._container.setAttribute("id","leaflet-tooltip-"+a(this))},_updateLayout:function(){},_adjustPan:function(){},_setPosition:function(e){var t,n,i=this._map,r=this._container,o=i.latLngToContainerPoint(i.getCenter()),a=i.layerPointToContainerPoint(e),s=this.options.direction,c=r.offsetWidth,l=r.offsetHeight,u=z(this.options.offset),d=this._getAnchor();"top"===s?(t=c/2,n=l):"bottom"===s?(t=c/2,n=0):"center"===s?(t=c/2,n=l/2):"right"===s?(t=0,n=l/2):"left"===s?(t=c,n=l/2):a.x<o.x?(s="right",t=0,n=l/2):(s="left",t=c+2*(u.x+d.x),n=l/2),e=e.subtract(z(t,n,!0)).add(u).add(d),wt(r,"leaflet-tooltip-right"),wt(r,"leaflet-tooltip-left"),wt(r,"leaflet-tooltip-top"),wt(r,"leaflet-tooltip-bottom"),_t(r,"leaflet-tooltip-"+s),Ct(r,e)},_updatePosition:function(){var e=this._map.latLngToLayerPoint(this._latlng);this._setPosition(e)},setOpacity:function(e){this.options.opacity=e,this._container&&St(this._container,e)},_animateZoom:function(e){var t=this._map._latLngToNewLayerPoint(this._latlng,e.zoom,e.center);this._setPosition(t)},_getAnchor:function(){return z(this._source&&this._source._getTooltipAnchor&&!this.options.sticky?this._source._getTooltipAnchor():[0,0])}}),Li=function(e,t){return new Ri(e,t)};nn.include({openTooltip:function(e,t,n){return this._initOverlay(Ri,e,t,n).openOn(this),this},closeTooltip:function(e){return e.close(),this}}),Gn.include({bindTooltip:function(e,t){return this._tooltip&&this.isTooltipOpen()&&this.unbindTooltip(),this._tooltip=this._initOverlay(Ri,this._tooltip,e,t),this._initTooltipInteractions(),this._tooltip.options.permanent&&this._map&&this._map.hasLayer(this)&&this.openTooltip(),this},unbindTooltip:function(){return this._tooltip&&(this._initTooltipInteractions(!0),this.closeTooltip(),this._tooltip=null),this},_initTooltipInteractions:function(e){if(e||!this._tooltipHandlersAdded){var t=e?"off":"on",n={remove:this.closeTooltip,move:this._moveTooltip};this._tooltip.options.permanent?n.add=this._openTooltip:(n.mouseover=this._openTooltip,n.mouseout=this.closeTooltip,n.click=this._openTooltip,this._map?this._addFocusListeners():n.add=this._addFocusListeners),this._tooltip.options.sticky&&(n.mousemove=this._moveTooltip),this[t](n),this._tooltipHandlersAdded=!e}},openTooltip:function(e){return this._tooltip&&(this instanceof Qn||(this._tooltip._source=this),this._tooltip._prepareOpen(e)&&(this._tooltip.openOn(this._map),this.getElement?this._setAriaDescribedByOnLayer(this):this.eachLayer&&this.eachLayer(this._setAriaDescribedByOnLayer,this))),this},closeTooltip:function(){if(this._tooltip)return this._tooltip.close()},toggleTooltip:function(){return this._tooltip&&this._tooltip.toggle(this),this},isTooltipOpen:function(){return this._tooltip.isOpen()},setTooltipContent:function(e){return this._tooltip&&this._tooltip.setContent(e),this},getTooltip:function(){return this._tooltip},_addFocusListeners:function(){this.getElement?this._addFocusListenersOnLayer(this):this.eachLayer&&this.eachLayer(this._addFocusListenersOnLayer,this)},_addFocusListenersOnLayer:function(e){var t="function"===typeof e.getElement&&e.getElement();t&&(Dt(t,"focus",function(){this._tooltip._source=e,this.openTooltip()},this),Dt(t,"blur",this.closeTooltip,this))},_setAriaDescribedByOnLayer:function(e){var t="function"===typeof e.getElement&&e.getElement();t&&t.setAttribute("aria-describedby",this._tooltip._container.id)},_openTooltip:function(e){if(this._tooltip&&this._map)if(this._map.dragging&&this._map.dragging.moving()&&!this._openOnceFlag){this._openOnceFlag=!0;var t=this;this._map.once("moveend",function(){t._openOnceFlag=!1,t._openTooltip(e)})}else this._tooltip._source=e.layer||e.target,this.openTooltip(this._tooltip.options.sticky?e.latlng:void 0)},_moveTooltip:function(e){var t,n,i=e.latlng;this._tooltip.options.sticky&&e.originalEvent&&(t=this._map.mouseEventToContainerPoint(e.originalEvent),n=this._map.containerPointToLayerPoint(t),i=this._map.layerPointToLatLng(n)),this._tooltip.setLatLng(i)}});var zi=Yn.extend({options:{iconSize:[12,12],html:!1,bgPos:null,className:"leaflet-div-icon"},createIcon:function(e){var t=e&&"DIV"===e.tagName?e:document.createElement("div"),n=this.options;if(n.html instanceof Element?(mt(t),t.appendChild(n.html)):t.innerHTML=!1!==n.html?n.html:"",n.bgPos){var i=z(n.bgPos);t.style.backgroundPosition=-i.x+"px "+-i.y+"px"}return this._setIconStyles(t,"icon"),t},createShadow:function(){return null}});function Mi(e){return new zi(e)}Yn.Default=$n;var Di=Gn.extend({options:{tileSize:256,opacity:1,updateWhenIdle:Me.mobile,updateWhenZooming:!0,updateInterval:200,zIndex:1,bounds:null,minZoom:0,maxZoom:void 0,maxNativeZoom:void 0,minNativeZoom:void 0,noWrap:!1,pane:"tilePane",className:"",keepBuffer:2},initialize:function(e){f(this,e)},onAdd:function(){this._initContainer(),this._levels={},this._tiles={},this._resetView()},beforeAdd:function(e){e._addZoomLimit(this)},onRemove:function(e){this._removeAllTiles(),pt(this._container),e._removeZoomLimit(this),this._container=null,this._tileZoom=void 0},bringToFront:function(){return this._map&&(gt(this._container),this._setAutoZIndex(Math.max)),this},bringToBack:function(){return this._map&&(yt(this._container),this._setAutoZIndex(Math.min)),this},getContainer:function(){return this._container},setOpacity:function(e){return this.options.opacity=e,this._updateOpacity(),this},setZIndex:function(e){return this.options.zIndex=e,this._updateZIndex(),this},isLoading:function(){return this._loading},redraw:function(){if(this._map){this._removeAllTiles();var e=this._clampZoom(this._map.getZoom());e!==this._tileZoom&&(this._tileZoom=e,this._updateLevels()),this._update()}return this},getEvents:function(){var e={viewprereset:this._invalidateAll,viewreset:this._resetView,zoom:this._resetView,moveend:this._onMoveEnd};return this.options.updateWhenIdle||(this._onMove||(this._onMove=s(this._onMoveEnd,this.options.updateInterval,this)),e.move=this._onMove),this._zoomAnimated&&(e.zoomanim=this._animateZoom),e},createTile:function(){return document.createElement("div")},getTileSize:function(){var e=this.options.tileSize;return e instanceof P?e:new P(e,e)},_updateZIndex:function(){this._container&&void 0!==this.options.zIndex&&null!==this.options.zIndex&&(this._container.style.zIndex=this.options.zIndex)},_setAutoZIndex:function(e){for(var t,n=this.getPane().children,i=-e(-1/0,1/0),r=0,o=n.length;r<o;r++)t=n[r].style.zIndex,n[r]!==this._container&&t&&(i=e(i,+t));isFinite(i)&&(this.options.zIndex=i+e(-1,1),this._updateZIndex())},_updateOpacity:function(){if(this._map&&!Me.ielt9){St(this._container,this.options.opacity);var e=+new Date,t=!1,n=!1;for(var i in this._tiles){var r=this._tiles[i];if(r.current&&r.loaded){var o=Math.min(1,(e-r.loaded)/200);St(r.el,o),o<1?t=!0:(r.active?n=!0:this._onOpaqueTile(r),r.active=!0)}}n&&!this._noPrune&&this._pruneTiles(),t&&(k(this._fadeFrame),this._fadeFrame=T(this._updateOpacity,this))}},_onOpaqueTile:l,_initContainer:function(){this._container||(this._container=ft("div","leaflet-layer "+(this.options.className||"")),this._updateZIndex(),this.options.opacity<1&&this._updateOpacity(),this.getPane().appendChild(this._container))},_updateLevels:function(){var e=this._tileZoom,t=this.options.maxZoom;if(void 0!==e){for(var n in this._levels)n=Number(n),this._levels[n].el.children.length||n===e?(this._levels[n].el.style.zIndex=t-Math.abs(e-n),this._onUpdateLevel(n)):(pt(this._levels[n].el),this._removeTilesAtZoom(n),this._onRemoveLevel(n),delete this._levels[n]);var i=this._levels[e],r=this._map;return i||((i=this._levels[e]={}).el=ft("div","leaflet-tile-container leaflet-zoom-animated",this._container),i.el.style.zIndex=t,i.origin=r.project(r.unproject(r.getPixelOrigin()),e).round(),i.zoom=e,this._setZoomTransform(i,r.getCenter(),r.getZoom()),l(i.el.offsetWidth),this._onCreateLevel(i)),this._level=i,i}},_onUpdateLevel:l,_onRemoveLevel:l,_onCreateLevel:l,_pruneTiles:function(){if(this._map){var e,t,n=this._map.getZoom();if(n>this.options.maxZoom||n<this.options.minZoom)this._removeAllTiles();else{for(e in this._tiles)(t=this._tiles[e]).retain=t.current;for(e in this._tiles)if((t=this._tiles[e]).current&&!t.active){var i=t.coords;this._retainParent(i.x,i.y,i.z,i.z-5)||this._retainChildren(i.x,i.y,i.z,i.z+2)}for(e in this._tiles)this._tiles[e].retain||this._removeTile(e)}}},_removeTilesAtZoom:function(e){for(var t in this._tiles)this._tiles[t].coords.z===e&&this._removeTile(t)},_removeAllTiles:function(){for(var e in this._tiles)this._removeTile(e)},_invalidateAll:function(){for(var e in this._levels)pt(this._levels[e].el),this._onRemoveLevel(Number(e)),delete this._levels[e];this._removeAllTiles(),this._tileZoom=void 0},_retainParent:function(e,t,n,i){var r=Math.floor(e/2),o=Math.floor(t/2),a=n-1,s=new P(+r,+o);s.z=+a;var c=this._tileCoordsToKey(s),l=this._tiles[c];return l&&l.active?(l.retain=!0,!0):(l&&l.loaded&&(l.retain=!0),a>i&&this._retainParent(r,o,a,i))},_retainChildren:function(e,t,n,i){for(var r=2*e;r<2*e+2;r++)for(var o=2*t;o<2*t+2;o++){var a=new P(r,o);a.z=n+1;var s=this._tileCoordsToKey(a),c=this._tiles[s];c&&c.active?c.retain=!0:(c&&c.loaded&&(c.retain=!0),n+1<i&&this._retainChildren(r,o,n+1,i))}},_resetView:function(e){var t=e&&(e.pinch||e.flyTo);this._setView(this._map.getCenter(),this._map.getZoom(),t,t)},_animateZoom:function(e){this._setView(e.center,e.zoom,!0,e.noUpdate)},_clampZoom:function(e){var t=this.options;return void 0!==t.minNativeZoom&&e<t.minNativeZoom?t.minNativeZoom:void 0!==t.maxNativeZoom&&t.maxNativeZoom<e?t.maxNativeZoom:e},_setView:function(e,t,n,i){var r=Math.round(t);r=void 0!==this.options.maxZoom&&r>this.options.maxZoom||void 0!==this.options.minZoom&&r<this.options.minZoom?void 0:this._clampZoom(r);var o=this.options.updateWhenZooming&&r!==this._tileZoom;i&&!o||(this._tileZoom=r,this._abortLoading&&this._abortLoading(),this._updateLevels(),this._resetGrid(),void 0!==r&&this._update(e),n||this._pruneTiles(),this._noPrune=!!n),this._setZoomTransforms(e,t)},_setZoomTransforms:function(e,t){for(var n in this._levels)this._setZoomTransform(this._levels[n],e,t)},_setZoomTransform:function(e,t,n){var i=this._map.getZoomScale(n,e.zoom),r=e.origin.multiplyBy(i).subtract(this._map._getNewPixelOrigin(t,n)).round();Me.any3d?kt(e.el,r,i):Ct(e.el,r)},_resetGrid:function(){var e=this._map,t=e.options.crs,n=this._tileSize=this.getTileSize(),i=this._tileZoom,r=this._map.getPixelWorldBounds(this._tileZoom);r&&(this._globalTileRange=this._pxBoundsToTileRange(r)),this._wrapX=t.wrapLng&&!this.options.noWrap&&[Math.floor(e.project([0,t.wrapLng[0]],i).x/n.x),Math.ceil(e.project([0,t.wrapLng[1]],i).x/n.y)],this._wrapY=t.wrapLat&&!this.options.noWrap&&[Math.floor(e.project([t.wrapLat[0],0],i).y/n.x),Math.ceil(e.project([t.wrapLat[1],0],i).y/n.y)]},_onMoveEnd:function(){this._map&&!this._map._animatingZoom&&this._update()},_getTiledPixelBounds:function(e){var t=this._map,n=t._animatingZoom?Math.max(t._animateToZoom,t.getZoom()):t.getZoom(),i=t.getZoomScale(n,this._tileZoom),r=t.project(e,this._tileZoom).floor(),o=t.getSize().divideBy(2*i);return new M(r.subtract(o),r.add(o))},_update:function(e){var t=this._map;if(t){var n=this._clampZoom(t.getZoom());if(void 0===e&&(e=t.getCenter()),void 0!==this._tileZoom){var i=this._getTiledPixelBounds(e),r=this._pxBoundsToTileRange(i),o=r.getCenter(),a=[],s=this.options.keepBuffer,c=new M(r.getBottomLeft().subtract([s,-s]),r.getTopRight().add([s,-s]));if(!(isFinite(r.min.x)&&isFinite(r.min.y)&&isFinite(r.max.x)&&isFinite(r.max.y)))throw new Error("Attempted to load an infinite number of tiles");for(var l in this._tiles){var u=this._tiles[l].coords;u.z===this._tileZoom&&c.contains(new P(u.x,u.y))||(this._tiles[l].current=!1)}if(Math.abs(n-this._tileZoom)>1)this._setView(e,n);else{for(var d=r.min.y;d<=r.max.y;d++)for(var h=r.min.x;h<=r.max.x;h++){var f=new P(h,d);if(f.z=this._tileZoom,this._isValidTile(f)){var p=this._tiles[this._tileCoordsToKey(f)];p?p.current=!0:a.push(f)}}if(a.sort(function(e,t){return e.distanceTo(o)-t.distanceTo(o)}),0!==a.length){this._loading||(this._loading=!0,this.fire("loading"));var m=document.createDocumentFragment();for(h=0;h<a.length;h++)this._addTile(a[h],m);this._level.el.appendChild(m)}}}}},_isValidTile:function(e){var t=this._map.options.crs;if(!t.infinite){var n=this._globalTileRange;if(!t.wrapLng&&(e.x<n.min.x||e.x>n.max.x)||!t.wrapLat&&(e.y<n.min.y||e.y>n.max.y))return!1}if(!this.options.bounds)return!0;var i=this._tileCoordsToBounds(e);return U(this.options.bounds).overlaps(i)},_keyToBounds:function(e){return this._tileCoordsToBounds(this._keyToTileCoords(e))},_tileCoordsToNwSe:function(e){var t=this._map,n=this.getTileSize(),i=e.scaleBy(n),r=i.add(n);return[t.unproject(i,e.z),t.unproject(r,e.z)]},_tileCoordsToBounds:function(e){var t=this._tileCoordsToNwSe(e),n=new B(t[0],t[1]);return this.options.noWrap||(n=this._map.wrapLatLngBounds(n)),n},_tileCoordsToKey:function(e){return e.x+":"+e.y+":"+e.z},_keyToTileCoords:function(e){var t=e.split(":"),n=new P(+t[0],+t[1]);return n.z=+t[2],n},_removeTile:function(e){var t=this._tiles[e];t&&(pt(t.el),delete this._tiles[e],this.fire("tileunload",{tile:t.el,coords:this._keyToTileCoords(e)}))},_initTile:function(e){_t(e,"leaflet-tile");var t=this.getTileSize();e.style.width=t.x+"px",e.style.height=t.y+"px",e.onselectstart=l,e.onmousemove=l,Me.ielt9&&this.options.opacity<1&&St(e,this.options.opacity)},_addTile:function(e,t){var n=this._getTilePos(e),i=this._tileCoordsToKey(e),o=this.createTile(this._wrapCoords(e),r(this._tileReady,this,e));this._initTile(o),this.createTile.length<2&&T(r(this._tileReady,this,e,null,o)),Ct(o,n),this._tiles[i]={el:o,coords:e,current:!0},t.appendChild(o),this.fire("tileloadstart",{tile:o,coords:e})},_tileReady:function(e,t,n){t&&this.fire("tileerror",{error:t,tile:n,coords:e});var i=this._tileCoordsToKey(e);(n=this._tiles[i])&&(n.loaded=+new Date,this._map._fadeAnimated?(St(n.el,0),k(this._fadeFrame),this._fadeFrame=T(this._updateOpacity,this)):(n.active=!0,this._pruneTiles()),t||(_t(n.el,"leaflet-tile-loaded"),this.fire("tileload",{tile:n.el,coords:e})),this._noTilesToLoad()&&(this._loading=!1,this.fire("load"),Me.ielt9||!this._map._fadeAnimated?T(this._pruneTiles,this):setTimeout(r(this._pruneTiles,this),250)))},_getTilePos:function(e){return e.scaleBy(this.getTileSize()).subtract(this._level.origin)},_wrapCoords:function(e){var t=new P(this._wrapX?c(e.x,this._wrapX):e.x,this._wrapY?c(e.y,this._wrapY):e.y);return t.z=e.z,t},_pxBoundsToTileRange:function(e){var t=this.getTileSize();return new M(e.min.unscaleBy(t).floor(),e.max.unscaleBy(t).ceil().subtract([1,1]))},_noTilesToLoad:function(){for(var e in this._tiles)if(!this._tiles[e].loaded)return!1;return!0}});function Bi(e){return new Di(e)}var Ui=Di.extend({options:{minZoom:0,maxZoom:18,subdomains:"abc",errorTileUrl:"",zoomOffset:0,tms:!1,zoomReverse:!1,detectRetina:!1,crossOrigin:!1,referrerPolicy:!1},initialize:function(e,t){this._url=e,(t=f(this,t)).detectRetina&&Me.retina&&t.maxZoom>0?(t.tileSize=Math.floor(t.tileSize/2),t.zoomReverse?(t.zoomOffset--,t.minZoom=Math.min(t.maxZoom,t.minZoom+1)):(t.zoomOffset++,t.maxZoom=Math.max(t.minZoom,t.maxZoom-1)),t.minZoom=Math.max(0,t.minZoom)):t.zoomReverse?t.minZoom=Math.min(t.maxZoom,t.minZoom):t.maxZoom=Math.max(t.minZoom,t.maxZoom),"string"===typeof t.subdomains&&(t.subdomains=t.subdomains.split("")),this.on("tileunload",this._onTileRemove)},setUrl:function(e,t){return this._url===e&&void 0===t&&(t=!0),this._url=e,t||this.redraw(),this},createTile:function(e,t){var n=document.createElement("img");return Dt(n,"load",r(this._tileOnLoad,this,t,n)),Dt(n,"error",r(this._tileOnError,this,t,n)),(this.options.crossOrigin||""===this.options.crossOrigin)&&(n.crossOrigin=!0===this.options.crossOrigin?"":this.options.crossOrigin),"string"===typeof this.options.referrerPolicy&&(n.referrerPolicy=this.options.referrerPolicy),n.alt="",n.src=this.getTileUrl(e),n},getTileUrl:function(e){var t={r:Me.retina?"@2x":"",s:this._getSubdomain(e),x:e.x,y:e.y,z:this._getZoomForUrl()};if(this._map&&!this._map.options.crs.infinite){var i=this._globalTileRange.max.y-e.y;this.options.tms&&(t.y=i),t["-y"]=i}return g(this._url,n(t,this.options))},_tileOnLoad:function(e,t){Me.ielt9?setTimeout(r(e,this,null,t),0):e(null,t)},_tileOnError:function(e,t,n){var i=this.options.errorTileUrl;i&&t.getAttribute("src")!==i&&(t.src=i),e(n,t)},_onTileRemove:function(e){e.tile.onload=null},_getZoomForUrl:function(){var e=this._tileZoom,t=this.options.maxZoom;return this.options.zoomReverse&&(e=t-e),e+this.options.zoomOffset},_getSubdomain:function(e){var t=Math.abs(e.x+e.y)%this.options.subdomains.length;return this.options.subdomains[t]},_abortLoading:function(){var e,t;for(e in this._tiles)if(this._tiles[e].coords.z!==this._tileZoom&&((t=this._tiles[e].el).onload=l,t.onerror=l,!t.complete)){t.src=_;var n=this._tiles[e].coords;pt(t),delete this._tiles[e],this.fire("tileabort",{tile:t,coords:n})}},_removeTile:function(e){var t=this._tiles[e];if(t)return t.el.setAttribute("src",_),Di.prototype._removeTile.call(this,e)},_tileReady:function(e,t,n){if(this._map&&(!n||n.getAttribute("src")!==_))return Di.prototype._tileReady.call(this,e,t,n)}});function Fi(e,t){return new Ui(e,t)}var ji=Ui.extend({defaultWmsParams:{service:"WMS",request:"GetMap",layers:"",styles:"",format:"image/jpeg",transparent:!1,version:"1.1.1"},options:{crs:null,uppercase:!1},initialize:function(e,t){this._url=e;var i=n({},this.defaultWmsParams);for(var r in t)r in this.options||(i[r]=t[r]);var o=(t=f(this,t)).detectRetina&&Me.retina?2:1,a=this.getTileSize();i.width=a.x*o,i.height=a.y*o,this.wmsParams=i},onAdd:function(e){this._crs=this.options.crs||e.options.crs,this._wmsVersion=parseFloat(this.wmsParams.version);var t=this._wmsVersion>=1.3?"crs":"srs";this.wmsParams[t]=this._crs.code,Ui.prototype.onAdd.call(this,e)},getTileUrl:function(e){var t=this._tileCoordsToNwSe(e),n=this._crs,i=D(n.project(t[0]),n.project(t[1])),r=i.min,o=i.max,a=(this._wmsVersion>=1.3&&this._crs===Hn?[r.y,r.x,o.y,o.x]:[r.x,r.y,o.x,o.y]).join(","),s=Ui.prototype.getTileUrl.call(this,e);return s+p(this.wmsParams,s,this.options.uppercase)+(this.options.uppercase?"&BBOX=":"&bbox=")+a},setParams:function(e,t){return n(this.wmsParams,e),t||this.redraw(),this}});function Vi(e,t){return new ji(e,t)}Ui.WMS=ji,Fi.wms=Vi;var qi=Gn.extend({options:{padding:.1},initialize:function(e){f(this,e),a(this),this._layers=this._layers||{}},onAdd:function(){this._container||(this._initContainer(),_t(this._container,"leaflet-zoom-animated")),this.getPane().appendChild(this._container),this._update(),this.on("update",this._updatePaths,this)},onRemove:function(){this.off("update",this._updatePaths,this),this._destroyContainer()},getEvents:function(){var e={viewreset:this._reset,zoom:this._onZoom,moveend:this._update,zoomend:this._onZoomEnd};return this._zoomAnimated&&(e.zoomanim=this._onAnimZoom),e},_onAnimZoom:function(e){this._updateTransform(e.center,e.zoom)},_onZoom:function(){this._updateTransform(this._map.getCenter(),this._map.getZoom())},_updateTransform:function(e,t){var n=this._map.getZoomScale(t,this._zoom),i=this._map.getSize().multiplyBy(.5+this.options.padding),r=this._map.project(this._center,t),o=i.multiplyBy(-n).add(r).subtract(this._map._getNewPixelOrigin(e,t));Me.any3d?kt(this._container,o,n):Ct(this._container,o)},_reset:function(){for(var e in this._update(),this._updateTransform(this._center,this._zoom),this._layers)this._layers[e]._reset()},_onZoomEnd:function(){for(var e in this._layers)this._layers[e]._project()},_updatePaths:function(){for(var e in this._layers)this._layers[e]._update()},_update:function(){var e=this.options.padding,t=this._map.getSize(),n=this._map.containerPointToLayerPoint(t.multiplyBy(-e)).round();this._bounds=new M(n,n.add(t.multiplyBy(1+2*e)).round()),this._center=this._map.getCenter(),this._zoom=this._map.getZoom()}}),Hi=qi.extend({options:{tolerance:0},getEvents:function(){var e=qi.prototype.getEvents.call(this);return e.viewprereset=this._onViewPreReset,e},_onViewPreReset:function(){this._postponeUpdatePaths=!0},onAdd:function(){qi.prototype.onAdd.call(this),this._draw()},_initContainer:function(){var e=this._container=document.createElement("canvas");Dt(e,"mousemove",this._onMouseMove,this),Dt(e,"click dblclick mousedown mouseup contextmenu",this._onClick,this),Dt(e,"mouseout",this._handleMouseOut,this),e._leaflet_disable_events=!0,this._ctx=e.getContext("2d")},_destroyContainer:function(){k(this._redrawRequest),delete this._ctx,pt(this._container),Ut(this._container),delete this._container},_updatePaths:function(){if(!this._postponeUpdatePaths){for(var e in this._redrawBounds=null,this._layers)this._layers[e]._update();this._redraw()}},_update:function(){if(!this._map._animatingZoom||!this._bounds){qi.prototype._update.call(this);var e=this._bounds,t=this._container,n=e.getSize(),i=Me.retina?2:1;Ct(t,e.min),t.width=i*n.x,t.height=i*n.y,t.style.width=n.x+"px",t.style.height=n.y+"px",Me.retina&&this._ctx.scale(2,2),this._ctx.translate(-e.min.x,-e.min.y),this.fire("update")}},_reset:function(){qi.prototype._reset.call(this),this._postponeUpdatePaths&&(this._postponeUpdatePaths=!1,this._updatePaths())},_initPath:function(e){this._updateDashArray(e),this._layers[a(e)]=e;var t=e._order={layer:e,prev:this._drawLast,next:null};this._drawLast&&(this._drawLast.next=t),this._drawLast=t,this._drawFirst=this._drawFirst||this._drawLast},_addPath:function(e){this._requestRedraw(e)},_removePath:function(e){var t=e._order,n=t.next,i=t.prev;n?n.prev=i:this._drawLast=i,i?i.next=n:this._drawFirst=n,delete e._order,delete this._layers[a(e)],this._requestRedraw(e)},_updatePath:function(e){this._extendRedrawBounds(e),e._project(),e._update(),this._requestRedraw(e)},_updateStyle:function(e){this._updateDashArray(e),this._requestRedraw(e)},_updateDashArray:function(e){if("string"===typeof e.options.dashArray){var t,n,i=e.options.dashArray.split(/[, ]+/),r=[];for(n=0;n<i.length;n++){if(t=Number(i[n]),isNaN(t))return;r.push(t)}e.options._dashArray=r}else e.options._dashArray=e.options.dashArray},_requestRedraw:function(e){this._map&&(this._extendRedrawBounds(e),this._redrawRequest=this._redrawRequest||T(this._redraw,this))},_extendRedrawBounds:function(e){if(e._pxBounds){var t=(e.options.weight||0)+1;this._redrawBounds=this._redrawBounds||new M,this._redrawBounds.extend(e._pxBounds.min.subtract([t,t])),this._redrawBounds.extend(e._pxBounds.max.add([t,t]))}},_redraw:function(){this._redrawRequest=null,this._redrawBounds&&(this._redrawBounds.min._floor(),this._redrawBounds.max._ceil()),this._clear(),this._draw(),this._redrawBounds=null},_clear:function(){var e=this._redrawBounds;if(e){var t=e.getSize();this._ctx.clearRect(e.min.x,e.min.y,t.x,t.y)}else this._ctx.save(),this._ctx.setTransform(1,0,0,1,0,0),this._ctx.clearRect(0,0,this._container.width,this._container.height),this._ctx.restore()},_draw:function(){var e,t=this._redrawBounds;if(this._ctx.save(),t){var n=t.getSize();this._ctx.beginPath(),this._ctx.rect(t.min.x,t.min.y,n.x,n.y),this._ctx.clip()}this._drawing=!0;for(var i=this._drawFirst;i;i=i.next)e=i.layer,(!t||e._pxBounds&&e._pxBounds.intersects(t))&&e._updatePath();this._drawing=!1,this._ctx.restore()},_updatePoly:function(e,t){if(this._drawing){var n,i,r,o,a=e._parts,s=a.length,c=this._ctx;if(s){for(c.beginPath(),n=0;n<s;n++){for(i=0,r=a[n].length;i<r;i++)o=a[n][i],c[i?"lineTo":"moveTo"](o.x,o.y);t&&c.closePath()}this._fillStroke(c,e)}}},_updateCircle:function(e){if(this._drawing&&!e._empty()){var t=e._point,n=this._ctx,i=Math.max(Math.round(e._radius),1),r=(Math.max(Math.round(e._radiusY),1)||i)/i;1!==r&&(n.save(),n.scale(1,r)),n.beginPath(),n.arc(t.x,t.y/r,i,0,2*Math.PI,!1),1!==r&&n.restore(),this._fillStroke(n,e)}},_fillStroke:function(e,t){var n=t.options;n.fill&&(e.globalAlpha=n.fillOpacity,e.fillStyle=n.fillColor||n.color,e.fill(n.fillRule||"evenodd")),n.stroke&&0!==n.weight&&(e.setLineDash&&e.setLineDash(t.options&&t.options._dashArray||[]),e.globalAlpha=n.opacity,e.lineWidth=n.weight,e.strokeStyle=n.color,e.lineCap=n.lineCap,e.lineJoin=n.lineJoin,e.stroke())},_onClick:function(e){for(var t,n,i=this._map.mouseEventToLayerPoint(e),r=this._drawFirst;r;r=r.next)(t=r.layer).options.interactive&&t._containsPoint(i)&&("click"!==e.type&&"preclick"!==e.type||!this._map._draggableMoved(t))&&(n=t);this._fireEvent(!!n&&[n],e)},_onMouseMove:function(e){if(this._map&&!this._map.dragging.moving()&&!this._map._animatingZoom){var t=this._map.mouseEventToLayerPoint(e);this._handleMouseHover(e,t)}},_handleMouseOut:function(e){var t=this._hoveredLayer;t&&(wt(this._container,"leaflet-interactive"),this._fireEvent([t],e,"mouseout"),this._hoveredLayer=null,this._mouseHoverThrottled=!1)},_handleMouseHover:function(e,t){if(!this._mouseHoverThrottled){for(var n,i,o=this._drawFirst;o;o=o.next)(n=o.layer).options.interactive&&n._containsPoint(t)&&(i=n);i!==this._hoveredLayer&&(this._handleMouseOut(e),i&&(_t(this._container,"leaflet-interactive"),this._fireEvent([i],e,"mouseover"),this._hoveredLayer=i)),this._fireEvent(!!this._hoveredLayer&&[this._hoveredLayer],e),this._mouseHoverThrottled=!0,setTimeout(r(function(){this._mouseHoverThrottled=!1},this),32)}},_fireEvent:function(e,t,n){this._map._fireDOMEvent(t,n||t.type,e)},_bringToFront:function(e){var t=e._order;if(t){var n=t.next,i=t.prev;n&&(n.prev=i,i?i.next=n:n&&(this._drawFirst=n),t.prev=this._drawLast,this._drawLast.next=t,t.next=null,this._drawLast=t,this._requestRedraw(e))}},_bringToBack:function(e){var t=e._order;if(t){var n=t.next,i=t.prev;i&&(i.next=n,n?n.prev=i:i&&(this._drawLast=i),t.prev=null,t.next=this._drawFirst,this._drawFirst.prev=t,this._drawFirst=t,this._requestRedraw(e))}}});function Wi(e){return Me.canvas?new Hi(e):null}var Gi=function(){try{return document.namespaces.add("lvml","urn:schemas-microsoft-com:vml"),function(e){return document.createElement("<lvml:"+e+' class="lvml">')}}catch(e){}return function(e){return document.createElement("<"+e+' xmlns="urn:schemas-microsoft.com:vml" class="lvml">')}}(),Ki={_initContainer:function(){this._container=ft("div","leaflet-vml-container")},_update:function(){this._map._animatingZoom||(qi.prototype._update.call(this),this.fire("update"))},_initPath:function(e){var t=e._container=Gi("shape");_t(t,"leaflet-vml-shape "+(this.options.className||"")),t.coordsize="1 1",e._path=Gi("path"),t.appendChild(e._path),this._updateStyle(e),this._layers[a(e)]=e},_addPath:function(e){var t=e._container;this._container.appendChild(t),e.options.interactive&&e.addInteractiveTarget(t)},_removePath:function(e){var t=e._container;pt(t),e.removeInteractiveTarget(t),delete this._layers[a(e)]},_updateStyle:function(e){var t=e._stroke,n=e._fill,i=e.options,r=e._container;r.stroked=!!i.stroke,r.filled=!!i.fill,i.stroke?(t||(t=e._stroke=Gi("stroke")),r.appendChild(t),t.weight=i.weight+"px",t.color=i.color,t.opacity=i.opacity,i.dashArray?t.dashStyle=y(i.dashArray)?i.dashArray.join(" "):i.dashArray.replace(/( *, *)/g," "):t.dashStyle="",t.endcap=i.lineCap.replace("butt","flat"),t.joinstyle=i.lineJoin):t&&(r.removeChild(t),e._stroke=null),i.fill?(n||(n=e._fill=Gi("fill")),r.appendChild(n),n.color=i.fillColor||i.color,n.opacity=i.fillOpacity):n&&(r.removeChild(n),e._fill=null)},_updateCircle:function(e){var t=e._point.round(),n=Math.round(e._radius),i=Math.round(e._radiusY||n);this._setPath(e,e._empty()?"M0 0":"AL "+t.x+","+t.y+" "+n+","+i+" 0,23592600")},_setPath:function(e,t){e._path.v=t},_bringToFront:function(e){gt(e._container)},_bringToBack:function(e){yt(e._container)}},Zi=Me.vml?Gi:X,Qi=qi.extend({_initContainer:function(){this._container=Zi("svg"),this._container.setAttribute("pointer-events","none"),this._rootGroup=Zi("g"),this._container.appendChild(this._rootGroup)},_destroyContainer:function(){pt(this._container),Ut(this._container),delete this._container,delete this._rootGroup,delete this._svgSize},_update:function(){if(!this._map._animatingZoom||!this._bounds){qi.prototype._update.call(this);var e=this._bounds,t=e.getSize(),n=this._container;this._svgSize&&this._svgSize.equals(t)||(this._svgSize=t,n.setAttribute("width",t.x),n.setAttribute("height",t.y)),Ct(n,e.min),n.setAttribute("viewBox",[e.min.x,e.min.y,t.x,t.y].join(" ")),this.fire("update")}},_initPath:function(e){var t=e._path=Zi("path");e.options.className&&_t(t,e.options.className),e.options.interactive&&_t(t,"leaflet-interactive"),this._updateStyle(e),this._layers[a(e)]=e},_addPath:function(e){this._rootGroup||this._initContainer(),this._rootGroup.appendChild(e._path),e.addInteractiveTarget(e._path)},_removePath:function(e){pt(e._path),e.removeInteractiveTarget(e._path),delete this._layers[a(e)]},_updatePath:function(e){e._project(),e._update()},_updateStyle:function(e){var t=e._path,n=e.options;t&&(n.stroke?(t.setAttribute("stroke",n.color),t.setAttribute("stroke-opacity",n.opacity),t.setAttribute("stroke-width",n.weight),t.setAttribute("stroke-linecap",n.lineCap),t.setAttribute("stroke-linejoin",n.lineJoin),n.dashArray?t.setAttribute("stroke-dasharray",n.dashArray):t.removeAttribute("stroke-dasharray"),n.dashOffset?t.setAttribute("stroke-dashoffset",n.dashOffset):t.removeAttribute("stroke-dashoffset")):t.setAttribute("stroke","none"),n.fill?(t.setAttribute("fill",n.fillColor||n.color),t.setAttribute("fill-opacity",n.fillOpacity),t.setAttribute("fill-rule",n.fillRule||"evenodd")):t.setAttribute("fill","none"))},_updatePoly:function(e,t){this._setPath(e,Y(e._parts,t))},_updateCircle:function(e){var t=e._point,n=Math.max(Math.round(e._radius),1),i="a"+n+","+(Math.max(Math.round(e._radiusY),1)||n)+" 0 1,0 ",r=e._empty()?"M0 0":"M"+(t.x-n)+","+t.y+i+2*n+",0 "+i+2*-n+",0 ";this._setPath(e,r)},_setPath:function(e,t){e._path.setAttribute("d",t)},_bringToFront:function(e){gt(e._path)},_bringToBack:function(e){yt(e._path)}});function Xi(e){return Me.svg||Me.vml?new Qi(e):null}Me.vml&&Qi.include(Ki),nn.include({getRenderer:function(e){var t=e.options.renderer||this._getPaneRenderer(e.options.pane)||this.options.renderer||this._renderer;return t||(t=this._renderer=this._createRenderer()),this.hasLayer(t)||this.addLayer(t),t},_getPaneRenderer:function(e){if("overlayPane"===e||void 0===e)return!1;var t=this._paneRenderers[e];return void 0===t&&(t=this._createRenderer({pane:e}),this._paneRenderers[e]=t),t},_createRenderer:function(e){return this.options.preferCanvas&&Wi(e)||Xi(e)}});var Yi=ui.extend({initialize:function(e,t){ui.prototype.initialize.call(this,this._boundsToLatLngs(e),t)},setBounds:function(e){return this.setLatLngs(this._boundsToLatLngs(e))},_boundsToLatLngs:function(e){return[(e=U(e)).getSouthWest(),e.getNorthWest(),e.getNorthEast(),e.getSouthEast()]}});function Ji(e,t){return new Yi(e,t)}Qi.create=Zi,Qi.pointsToPath=Y,hi.geometryToLayer=fi,hi.coordsToLatLng=mi,hi.coordsToLatLngs=gi,hi.latLngToCoords=yi,hi.latLngsToCoords=vi,hi.getFeature=_i,hi.asFeature=wi,nn.mergeOptions({boxZoom:!0});var $i=gn.extend({initialize:function(e){this._map=e,this._container=e._container,this._pane=e._panes.overlayPane,this._resetStateTimeout=0,e.on("unload",this._destroy,this)},addHooks:function(){Dt(this._container,"mousedown",this._onMouseDown,this)},removeHooks:function(){Ut(this._container,"mousedown",this._onMouseDown,this)},moved:function(){return this._moved},_destroy:function(){pt(this._pane),delete this._pane},_resetState:function(){this._resetStateTimeout=0,this._moved=!1},_clearDeferredResetState:function(){0!==this._resetStateTimeout&&(clearTimeout(this._resetStateTimeout),this._resetStateTimeout=0)},_onMouseDown:function(e){if(!e.shiftKey||1!==e.which&&1!==e.button)return!1;this._clearDeferredResetState(),this._resetState(),it(),Nt(),this._startPoint=this._map.mouseEventToContainerPoint(e),Dt(document,{contextmenu:Zt,mousemove:this._onMouseMove,mouseup:this._onMouseUp,keydown:this._onKeyDown},this)},_onMouseMove:function(e){this._moved||(this._moved=!0,this._box=ft("div","leaflet-zoom-box",this._container),_t(this._container,"leaflet-crosshair"),this._map.fire("boxzoomstart")),this._point=this._map.mouseEventToContainerPoint(e);var t=new M(this._point,this._startPoint),n=t.getSize();Ct(this._box,t.min),this._box.style.width=n.x+"px",this._box.style.height=n.y+"px"},_finish:function(){this._moved&&(pt(this._box),wt(this._container,"leaflet-crosshair")),rt(),Ot(),Ut(document,{contextmenu:Zt,mousemove:this._onMouseMove,mouseup:this._onMouseUp,keydown:this._onKeyDown},this)},_onMouseUp:function(e){if((1===e.which||1===e.button)&&(this._finish(),this._moved)){this._clearDeferredResetState(),this._resetStateTimeout=setTimeout(r(this._resetState,this),0);var t=new B(this._map.containerPointToLatLng(this._startPoint),this._map.containerPointToLatLng(this._point));this._map.fitBounds(t).fire("boxzoomend",{boxZoomBounds:t})}},_onKeyDown:function(e){27===e.keyCode&&(this._finish(),this._clearDeferredResetState(),this._resetState())}});nn.addInitHook("addHandler","boxZoom",$i),nn.mergeOptions({doubleClickZoom:!0});var er=gn.extend({addHooks:function(){this._map.on("dblclick",this._onDoubleClick,this)},removeHooks:function(){this._map.off("dblclick",this._onDoubleClick,this)},_onDoubleClick:function(e){var t=this._map,n=t.getZoom(),i=t.options.zoomDelta,r=e.originalEvent.shiftKey?n-i:n+i;"center"===t.options.doubleClickZoom?t.setZoom(r):t.setZoomAround(e.containerPoint,r)}});nn.addInitHook("addHandler","doubleClickZoom",er),nn.mergeOptions({dragging:!0,inertia:!0,inertiaDeceleration:3400,inertiaMaxSpeed:1/0,easeLinearity:.2,worldCopyJump:!1,maxBoundsViscosity:0});var tr=gn.extend({addHooks:function(){if(!this._draggable){var e=this._map;this._draggable=new _n(e._mapPane,e._container),this._draggable.on({dragstart:this._onDragStart,drag:this._onDrag,dragend:this._onDragEnd},this),this._draggable.on("predrag",this._onPreDragLimit,this),e.options.worldCopyJump&&(this._draggable.on("predrag",this._onPreDragWrap,this),e.on("zoomend",this._onZoomEnd,this),e.whenReady(this._onZoomEnd,this))}_t(this._map._container,"leaflet-grab leaflet-touch-drag"),this._draggable.enable(),this._positions=[],this._times=[]},removeHooks:function(){wt(this._map._container,"leaflet-grab"),wt(this._map._container,"leaflet-touch-drag"),this._draggable.disable()},moved:function(){return this._draggable&&this._draggable._moved},moving:function(){return this._draggable&&this._draggable._moving},_onDragStart:function(){var e=this._map;if(e._stop(),this._map.options.maxBounds&&this._map.options.maxBoundsViscosity){var t=U(this._map.options.maxBounds);this._offsetLimit=D(this._map.latLngToContainerPoint(t.getNorthWest()).multiplyBy(-1),this._map.latLngToContainerPoint(t.getSouthEast()).multiplyBy(-1).add(this._map.getSize())),this._viscosity=Math.min(1,Math.max(0,this._map.options.maxBoundsViscosity))}else this._offsetLimit=null;e.fire("movestart").fire("dragstart"),e.options.inertia&&(this._positions=[],this._times=[])},_onDrag:function(e){if(this._map.options.inertia){var t=this._lastTime=+new Date,n=this._lastPos=this._draggable._absPos||this._draggable._newPos;this._positions.push(n),this._times.push(t),this._prunePositions(t)}this._map.fire("move",e).fire("drag",e)},_prunePositions:function(e){for(;this._positions.length>1&&e-this._times[0]>50;)this._positions.shift(),this._times.shift()},_onZoomEnd:function(){var e=this._map.getSize().divideBy(2),t=this._map.latLngToLayerPoint([0,0]);this._initialWorldOffset=t.subtract(e).x,this._worldWidth=this._map.getPixelWorldBounds().getSize().x},_viscousLimit:function(e,t){return e-(e-t)*this._viscosity},_onPreDragLimit:function(){if(this._viscosity&&this._offsetLimit){var e=this._draggable._newPos.subtract(this._draggable._startPos),t=this._offsetLimit;e.x<t.min.x&&(e.x=this._viscousLimit(e.x,t.min.x)),e.y<t.min.y&&(e.y=this._viscousLimit(e.y,t.min.y)),e.x>t.max.x&&(e.x=this._viscousLimit(e.x,t.max.x)),e.y>t.max.y&&(e.y=this._viscousLimit(e.y,t.max.y)),this._draggable._newPos=this._draggable._startPos.add(e)}},_onPreDragWrap:function(){var e=this._worldWidth,t=Math.round(e/2),n=this._initialWorldOffset,i=this._draggable._newPos.x,r=(i-t+n)%e+t-n,o=(i+t+n)%e-t-n,a=Math.abs(r+n)<Math.abs(o+n)?r:o;this._draggable._absPos=this._draggable._newPos.clone(),this._draggable._newPos.x=a},_onDragEnd:function(e){var t=this._map,n=t.options,i=!n.inertia||e.noInertia||this._times.length<2;if(t.fire("dragend",e),i)t.fire("moveend");else{this._prunePositions(+new Date);var r=this._lastPos.subtract(this._positions[0]),o=(this._lastTime-this._times[0])/1e3,a=n.easeLinearity,s=r.multiplyBy(a/o),c=s.distanceTo([0,0]),l=Math.min(n.inertiaMaxSpeed,c),u=s.multiplyBy(l/c),d=l/(n.inertiaDeceleration*a),h=u.multiplyBy(-d/2).round();h.x||h.y?(h=t._limitOffset(h,t.options.maxBounds),T(function(){t.panBy(h,{duration:d,easeLinearity:a,noMoveStart:!0,animate:!0})})):t.fire("moveend")}}});nn.addInitHook("addHandler","dragging",tr),nn.mergeOptions({keyboard:!0,keyboardPanDelta:80});var nr=gn.extend({keyCodes:{left:[37],right:[39],down:[40],up:[38],zoomIn:[187,107,61,171],zoomOut:[189,109,54,173]},initialize:function(e){this._map=e,this._setPanDelta(e.options.keyboardPanDelta),this._setZoomDelta(e.options.zoomDelta)},addHooks:function(){var e=this._map._container;e.tabIndex<=0&&(e.tabIndex="0"),Dt(e,{focus:this._onFocus,blur:this._onBlur,mousedown:this._onMouseDown},this),this._map.on({focus:this._addHooks,blur:this._removeHooks},this)},removeHooks:function(){this._removeHooks(),Ut(this._map._container,{focus:this._onFocus,blur:this._onBlur,mousedown:this._onMouseDown},this),this._map.off({focus:this._addHooks,blur:this._removeHooks},this)},_onMouseDown:function(){if(!this._focused){var e=document.body,t=document.documentElement,n=e.scrollTop||t.scrollTop,i=e.scrollLeft||t.scrollLeft;this._map._container.focus(),window.scrollTo(i,n)}},_onFocus:function(){this._focused=!0,this._map.fire("focus")},_onBlur:function(){this._focused=!1,this._map.fire("blur")},_setPanDelta:function(e){var t,n,i=this._panKeys={},r=this.keyCodes;for(t=0,n=r.left.length;t<n;t++)i[r.left[t]]=[-1*e,0];for(t=0,n=r.right.length;t<n;t++)i[r.right[t]]=[e,0];for(t=0,n=r.down.length;t<n;t++)i[r.down[t]]=[0,e];for(t=0,n=r.up.length;t<n;t++)i[r.up[t]]=[0,-1*e]},_setZoomDelta:function(e){var t,n,i=this._zoomKeys={},r=this.keyCodes;for(t=0,n=r.zoomIn.length;t<n;t++)i[r.zoomIn[t]]=e;for(t=0,n=r.zoomOut.length;t<n;t++)i[r.zoomOut[t]]=-e},_addHooks:function(){Dt(document,"keydown",this._onKeyDown,this)},_removeHooks:function(){Ut(document,"keydown",this._onKeyDown,this)},_onKeyDown:function(e){if(!(e.altKey||e.ctrlKey||e.metaKey)){var t,n=e.keyCode,i=this._map;if(n in this._panKeys){if(!i._panAnim||!i._panAnim._inProgress)if(t=this._panKeys[n],e.shiftKey&&(t=z(t).multiplyBy(3)),i.options.maxBounds&&(t=i._limitOffset(z(t),i.options.maxBounds)),i.options.worldCopyJump){var r=i.wrapLatLng(i.unproject(i.project(i.getCenter()).add(t)));i.panTo(r)}else i.panBy(t)}else if(n in this._zoomKeys)i.setZoom(i.getZoom()+(e.shiftKey?3:1)*this._zoomKeys[n]);else{if(27!==n||!i._popup||!i._popup.options.closeOnEscapeKey)return;i.closePopup()}Zt(e)}}});nn.addInitHook("addHandler","keyboard",nr),nn.mergeOptions({scrollWheelZoom:!0,wheelDebounceTime:40,wheelPxPerZoomLevel:60});var ir=gn.extend({addHooks:function(){Dt(this._map._container,"wheel",this._onWheelScroll,this),this._delta=0},removeHooks:function(){Ut(this._map._container,"wheel",this._onWheelScroll,this)},_onWheelScroll:function(e){var t=Jt(e),n=this._map.options.wheelDebounceTime;this._delta+=t,this._lastMousePos=this._map.mouseEventToContainerPoint(e),this._startTime||(this._startTime=+new Date);var i=Math.max(n-(+new Date-this._startTime),0);clearTimeout(this._timer),this._timer=setTimeout(r(this._performZoom,this),i),Zt(e)},_performZoom:function(){var e=this._map,t=e.getZoom(),n=this._map.options.zoomSnap||0;e._stop();var i=this._delta/(4*this._map.options.wheelPxPerZoomLevel),r=4*Math.log(2/(1+Math.exp(-Math.abs(i))))/Math.LN2,o=n?Math.ceil(r/n)*n:r,a=e._limitZoom(t+(this._delta>0?o:-o))-t;this._delta=0,this._startTime=null,a&&("center"===e.options.scrollWheelZoom?e.setZoom(t+a):e.setZoomAround(this._lastMousePos,t+a))}});nn.addInitHook("addHandler","scrollWheelZoom",ir);var rr=600;nn.mergeOptions({tapHold:Me.touchNative&&Me.safari&&Me.mobile,tapTolerance:15});var or=gn.extend({addHooks:function(){Dt(this._map._container,"touchstart",this._onDown,this)},removeHooks:function(){Ut(this._map._container,"touchstart",this._onDown,this)},_onDown:function(e){if(clearTimeout(this._holdTimeout),1===e.touches.length){var t=e.touches[0];this._startPos=this._newPos=new P(t.clientX,t.clientY),this._holdTimeout=setTimeout(r(function(){this._cancel(),this._isTapValid()&&(Dt(document,"touchend",Kt),Dt(document,"touchend touchcancel",this._cancelClickPrevent),this._simulateEvent("contextmenu",t))},this),rr),Dt(document,"touchend touchcancel contextmenu",this._cancel,this),Dt(document,"touchmove",this._onMove,this)}},_cancelClickPrevent:function e(){Ut(document,"touchend",Kt),Ut(document,"touchend touchcancel",e)},_cancel:function(){clearTimeout(this._holdTimeout),Ut(document,"touchend touchcancel contextmenu",this._cancel,this),Ut(document,"touchmove",this._onMove,this)},_onMove:function(e){var t=e.touches[0];this._newPos=new P(t.clientX,t.clientY)},_isTapValid:function(){return this._newPos.distanceTo(this._startPos)<=this._map.options.tapTolerance},_simulateEvent:function(e,t){var n=new MouseEvent(e,{bubbles:!0,cancelable:!0,view:window,screenX:t.screenX,screenY:t.screenY,clientX:t.clientX,clientY:t.clientY});n._simulated=!0,t.target.dispatchEvent(n)}});nn.addInitHook("addHandler","tapHold",or),nn.mergeOptions({touchZoom:Me.touch,bounceAtZoomLimits:!0});var ar=gn.extend({addHooks:function(){_t(this._map._container,"leaflet-touch-zoom"),Dt(this._map._container,"touchstart",this._onTouchStart,this)},removeHooks:function(){wt(this._map._container,"leaflet-touch-zoom"),Ut(this._map._container,"touchstart",this._onTouchStart,this)},_onTouchStart:function(e){var t=this._map;if(e.touches&&2===e.touches.length&&!t._animatingZoom&&!this._zooming){var n=t.mouseEventToContainerPoint(e.touches[0]),i=t.mouseEventToContainerPoint(e.touches[1]);this._centerPoint=t.getSize()._divideBy(2),this._startLatLng=t.containerPointToLatLng(this._centerPoint),"center"!==t.options.touchZoom&&(this._pinchStartLatLng=t.containerPointToLatLng(n.add(i)._divideBy(2))),this._startDist=n.distanceTo(i),this._startZoom=t.getZoom(),this._moved=!1,this._zooming=!0,t._stop(),Dt(document,"touchmove",this._onTouchMove,this),Dt(document,"touchend touchcancel",this._onTouchEnd,this),Kt(e)}},_onTouchMove:function(e){if(e.touches&&2===e.touches.length&&this._zooming){var t=this._map,n=t.mouseEventToContainerPoint(e.touches[0]),i=t.mouseEventToContainerPoint(e.touches[1]),o=n.distanceTo(i)/this._startDist;if(this._zoom=t.getScaleZoom(o,this._startZoom),!t.options.bounceAtZoomLimits&&(this._zoom<t.getMinZoom()&&o<1||this._zoom>t.getMaxZoom()&&o>1)&&(this._zoom=t._limitZoom(this._zoom)),"center"===t.options.touchZoom){if(this._center=this._startLatLng,1===o)return}else{var a=n._add(i)._divideBy(2)._subtract(this._centerPoint);if(1===o&&0===a.x&&0===a.y)return;this._center=t.unproject(t.project(this._pinchStartLatLng,this._zoom).subtract(a),this._zoom)}this._moved||(t._moveStart(!0,!1),this._moved=!0),k(this._animRequest);var s=r(t._move,t,this._center,this._zoom,{pinch:!0,round:!1},void 0);this._animRequest=T(s,this,!0),Kt(e)}},_onTouchEnd:function(){this._moved&&this._zooming?(this._zooming=!1,k(this._animRequest),Ut(document,"touchmove",this._onTouchMove,this),Ut(document,"touchend touchcancel",this._onTouchEnd,this),this._map.options.zoomAnimation?this._map._animateZoom(this._center,this._map._limitZoom(this._zoom),!0,this._map.options.zoomSnap):this._map._resetView(this._center,this._map._limitZoom(this._zoom))):this._zooming=!1}});nn.addInitHook("addHandler","touchZoom",ar),nn.BoxZoom=$i,nn.DoubleClickZoom=er,nn.Drag=tr,nn.Keyboard=nr,nn.ScrollWheelZoom=ir,nn.TapHold=or,nn.TouchZoom=ar,e.Bounds=M,e.Browser=Me,e.CRS=V,e.Canvas=Hi,e.Circle=ai,e.CircleMarker=ri,e.Class=I,e.Control=on,e.DivIcon=zi,e.DivOverlay=Ni,e.DomEvent=en,e.DomUtil=Mt,e.Draggable=_n,e.Evented=O,e.FeatureGroup=Qn,e.GeoJSON=hi,e.GridLayer=Di,e.Handler=gn,e.Icon=Yn,e.ImageOverlay=Ei,e.LatLng=F,e.LatLngBounds=B,e.Layer=Gn,e.LayerGroup=Kn,e.LineUtil=Un,e.Map=nn,e.Marker=ti,e.Mixin=yn,e.Path=ii,e.Point=P,e.PolyUtil=En,e.Polygon=ui,e.Polyline=ci,e.Popup=Oi,e.PosAnimation=tn,e.Projection=Vn,e.Rectangle=Yi,e.Renderer=qi,e.SVG=Qi,e.SVGOverlay=Ii,e.TileLayer=Ui,e.Tooltip=Ri,e.Transformation=G,e.Util=C,e.VideoOverlay=ki,e.bind=r,e.bounds=D,e.canvas=Wi,e.circle=si,e.circleMarker=oi,e.control=an,e.divIcon=Mi,e.extend=n,e.featureGroup=Xn,e.geoJSON=xi,e.geoJson=Si,e.gridLayer=Bi,e.icon=Jn,e.imageOverlay=Ti,e.latLng=j,e.latLngBounds=U,e.layerGroup=Zn,e.map=rn,e.marker=ni,e.point=z,e.polygon=di,e.polyline=li,e.popup=Pi,e.rectangle=Ji,e.setOptions=f,e.stamp=a,e.svg=Xi,e.svgOverlay=Ai,e.tileLayer=Fi,e.tooltip=Li,e.transformation=K,e.version=t,e.videoOverlay=Ci;var sr=window.L;e.noConflict=function(){return window.L=sr,this},window.L=e}(t)},234:(e,t)=>{"use strict";function n(e,t){var n=e.length;e.push(t);e:for(;0<n;){var i=n-1>>>1,r=e[i];if(!(0<o(r,t)))break e;e[i]=t,e[n]=r,n=i}}function i(e){return 0===e.length?null:e[0]}function r(e){if(0===e.length)return null;var t=e[0],n=e.pop();if(n!==t){e[0]=n;e:for(var i=0,r=e.length,a=r>>>1;i<a;){var s=2*(i+1)-1,c=e[s],l=s+1,u=e[l];if(0>o(c,n))l<r&&0>o(u,c)?(e[i]=u,e[l]=n,i=l):(e[i]=c,e[s]=n,i=s);else{if(!(l<r&&0>o(u,n)))break e;e[i]=u,e[l]=n,i=l}}}return t}function o(e,t){var n=e.sortIndex-t.sortIndex;return 0!==n?n:e.id-t.id}if("object"===typeof performance&&"function"===typeof performance.now){var a=performance;t.unstable_now=function(){return a.now()}}else{var s=Date,c=s.now();t.unstable_now=function(){return s.now()-c}}var l=[],u=[],d=1,h=null,f=3,p=!1,m=!1,g=!1,y="function"===typeof setTimeout?setTimeout:null,v="function"===typeof clearTimeout?clearTimeout:null,_="undefined"!==typeof setImmediate?setImmediate:null;function w(e){for(var t=i(u);null!==t;){if(null===t.callback)r(u);else{if(!(t.startTime<=e))break;r(u),t.sortIndex=t.expirationTime,n(l,t)}t=i(u)}}function b(e){if(g=!1,w(e),!m)if(null!==i(l))m=!0,R(x);else{var t=i(u);null!==t&&L(b,t.startTime-e)}}function x(e,n){m=!1,g&&(g=!1,v(k),k=-1),p=!0;var o=f;try{for(w(n),h=i(l);null!==h&&(!(h.expirationTime>n)||e&&!A());){var a=h.callback;if("function"===typeof a){h.callback=null,f=h.priorityLevel;var s=a(h.expirationTime<=n);n=t.unstable_now(),"function"===typeof s?h.callback=s:h===i(l)&&r(l),w(n)}else r(l);h=i(l)}if(null!==h)var c=!0;else{var d=i(u);null!==d&&L(b,d.startTime-n),c=!1}return c}finally{h=null,f=o,p=!1}}"undefined"!==typeof navigator&&void 0!==navigator.scheduling&&void 0!==navigator.scheduling.isInputPending&&navigator.scheduling.isInputPending.bind(navigator.scheduling);var S,E=!1,T=null,k=-1,C=5,I=-1;function A(){return!(t.unstable_now()-I<C)}function N(){if(null!==T){var e=t.unstable_now();I=e;var n=!0;try{n=T(!0,e)}finally{n?S():(E=!1,T=null)}}else E=!1}if("function"===typeof _)S=function(){_(N)};else if("undefined"!==typeof MessageChannel){var O=new MessageChannel,P=O.port2;O.port1.onmessage=N,S=function(){P.postMessage(null)}}else S=function(){y(N,0)};function R(e){T=e,E||(E=!0,S())}function L(e,n){k=y(function(){e(t.unstable_now())},n)}t.unstable_IdlePriority=5,t.unstable_ImmediatePriority=1,t.unstable_LowPriority=4,t.unstable_NormalPriority=3,t.unstable_Profiling=null,t.unstable_UserBlockingPriority=2,t.unstable_cancelCallback=function(e){e.callback=null},t.unstable_continueExecution=function(){m||p||(m=!0,R(x))},t.unstable_forceFrameRate=function(e){0>e||125<e?console.error("forceFrameRate takes a positive int between 0 and 125, forcing frame rates higher than 125 fps is not supported"):C=0<e?Math.floor(1e3/e):5},t.unstable_getCurrentPriorityLevel=function(){return f},t.unstable_getFirstCallbackNode=function(){return i(l)},t.unstable_next=function(e){switch(f){case 1:case 2:case 3:var t=3;break;default:t=f}var n=f;f=t;try{return e()}finally{f=n}},t.unstable_pauseExecution=function(){},t.unstable_requestPaint=function(){},t.unstable_runWithPriority=function(e,t){switch(e){case 1:case 2:case 3:case 4:case 5:break;default:e=3}var n=f;f=e;try{return t()}finally{f=n}},t.unstable_scheduleCallback=function(e,r,o){var a=t.unstable_now();switch("object"===typeof o&&null!==o?o="number"===typeof(o=o.delay)&&0<o?a+o:a:o=a,e){case 1:var s=-1;break;case 2:s=250;break;case 5:s=1073741823;break;case 4:s=1e4;break;default:s=5e3}return e={id:d++,callback:r,priorityLevel:e,startTime:o,expirationTime:s=o+s,sortIndex:-1},o>a?(e.sortIndex=o,n(u,e),null===i(l)&&e===i(u)&&(g?(v(k),k=-1):g=!0,L(b,o-a))):(e.sortIndex=s,n(l,e),m||p||(m=!0,R(x))),e},t.unstable_shouldYield=A,t.unstable_wrapCallback=function(e){var t=f;return function(){var n=f;f=t;try{return e.apply(this,arguments)}finally{f=n}}}},249:e=>{"use strict";e.exports="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAADIAAABSCAMAAAAhFXfZAAAC91BMVEVMaXEzeak2f7I4g7g3g7cua5gzeKg8hJo3grY4g7c3grU0gLI2frE0daAubJc2gbQwd6QzeKk2gLMtd5sxdKIua5g1frA2f7IydaM0e6w2fq41fK01eqo3grgubJgta5cxdKI1f7AydaQydaMxc6EubJgvbJkwcZ4ubZkwcJwubZgubJcydqUydKIxapgubJctbJcubZcubJcvbJYubJcvbZkubJctbJctbZcubJg2f7AubJcrbZcubJcubJcua5g3grY0fq8ubJcubJdEkdEwhsw6i88vhswuhcsuhMtBjMgthMsrg8srgss6is8qgcs8i9A9iMYtg8spgcoogMo7hcMngMonf8olfso4gr8kfck5iM8jfMk4iM8he8k1fro7itAgesk2hs8eecgzfLcofssdeMg0hc4cd8g2hcsxeLQbdsgZdcgxeLImfcszhM0vda4xgckzhM4xg84wf8Yxgs4udKsvfcQucqhUndROmdM1fK0wcZ8vb5w0eqpQm9MzeKhXoNVcpdYydKNWn9VZotVKltJFjsIwcJ1Rms9OlslLmtH///8+kc9epdYzd6dbo9VHkMM2f7FHmNBClM8ydqVcpNY9hro3gLM9hLczealQmcw3fa46f7A8gLMxc6I3eagyc6FIldJMl9JSnNRSntNNl9JPnNJFi75UnM9ZodVKksg8kM45jc09e6ZHltFBk883gbRBh7pDk9EwcaBzn784g7dKkcY2i81Om9M7j85Llc81is09g7Q4grY/j9A0eqxKmdFFltBEjcXf6fFImdBCiLxJl9FGlNFBi78yiMxVndEvbpo6js74+vx+psPP3+o/ks5HkcpGmNCjwdZCkNDM3ehYoNJEls+lxNkxh8xHks0+jdC1zd5Lg6r+/v/H2ufz9/o3jM3t8/edvdM/k89Th61OiLBSjbZklbaTt9BfptdjmL1AicBHj8hGk9FAgK1dkLNTjLRekrdClc/k7fM0icy0y9tgp9c4jc2NtM9Dlc8zicxeXZn3AAAAQ3RSTlMAHDdTb4yPA+LtnEQmC4L2EmHqB7XA0d0sr478x4/Yd5i1zOfyPkf1sLVq4Nh3FvjxopQ2/STNuFzUwFIwxKaejILpIBEV9wAABhVJREFUeF6s1NdyFEcYBeBeoQIhRAkLlRDGrhIgY3BJL8CVeKzuyXFzzjkn5ZxzzuScg3PO8cKzu70JkO0LfxdTU//pM9vTu7Xgf6KqOVTb9X7toRrVEfBf1HTVjZccrT/2by1VV928Yty9ZbVuucdz90frG8DBjl9pVApbOstvmMuvVgaNXSfAAd6pGxpy6yxf5ph43pS/4f3uoaGm2rdu72S9xzOvMymkZFq/ptDrk90mhW7e4zl7HLzhxGWPR20xmSxJ/VqldG5m9XhaVOA1DadsNh3Pu5L2N6QtPO/32JpqQBVVk20oy/Pi2s23WEvyfHbe1thadVQttvm7Llf65gGmXK67XtupyoM7HQhmXdLS8oGWJNeOJ3C5fG5XCEJnkez3/oFdsvgJ4l2ANZwhrJKk/7OSXa+3Vw2WJMlKnGkobouYk6T0TyX30klOUnTD9HJ5qpckL3EW/w4XF3Xd0FGywXUrstrclVsqz5Pd/sXFYyDnPdrLcQODmGOK47IZb4CmibmMn+MYRzFZ5jg33ZL/EJrWcszHmANy3ARBK/IXtciJy8VsitPSdE3uuHxzougojcUdr8/32atnz/ev3f/K5wtpxUTpcaI45zusVDpYtZi+jg0oU9b3x74h7+n9ABvYEZeKaVq0sh0AtLKsFtqNBdeT0MrSzwwlq9+x6xAO4tgOtSzbCjrNQQiNvQUbUEubvzBUeGw26yDCsRHCoLkTHDa7IdOLIThs/gHvChszh2CimE8peRs47cxANI0lYNB5y1DljpOF0IhzBDPOZnDOqYYbeGKECbPzWnXludPphw5c2YBq5zlwXphIbO4VDCZ0gnPfUO1TwZoYwAs2ExPCedAu9DAjfQUjzITQb3jNj0KG2Sgt6BHaQUdYzWz+XmBktOHwanXjaSTcwwziBcuMOtwBmqPrTOxFQR/DRKKPqyur0aiW6cULYsx6tBm0jXpR/AUWR6HRq9WVW6MRhIq5jLyjbaCTDCijyYJNpCajdyobP/eTw0iexBAKkJ3gA5KcQb2zBXsIBckn+xVv8jkZSaEFHE+jFEleAEfayRU0MouNoBmB/L50Ai/HSLIHxcrpCvnhSQAuakKp2C/YbCylJjXRVy/z3+Kv/RrNcCo+WUzlVEhzKffnTQnxeN9fWF88fiNCUdSTsaufaChKWInHeysygfpIqagoakW+vV20J8uyl6TyNKEZWV4oRSPyCkWpgOLSbkCObT8o2r6tlG58HQquf6O0v50tB7JM7F4EORd2dx/K0w/KHsVkLPaoYrwgP/y7krr3SSMA4zj+OBgmjYkxcdIJQyQRKgg2viX9Hddi9UBb29LrKR7CVVEEEXWojUkXNyfTNDE14W9gbHJNuhjDettN3ZvbOvdOqCD3Jp/9l+/wJE+9PkYGjx/fqkys3S2rMozM/o2106rfMUINo6hVqz+eu/hd1c4xTg0TAfy5kV+4UG6+IthHTU9woWmxuKNbTfuCSfovBCxq7EtHqvYL4Sm6F8GVxsSXHMQ07TOi1DKtZxjWaaIyi4CXWjxPccUw8WVbMYY5wxC1mzEyXMJWkllpRloi+Kkoq69sxBTlElF6aAxYUbjXNlhlDZilDnM4U5SlN5biRsRHnbx3mbeWjEh4mEyiuJDl5XcWVmX5GvNkFgLWZM5qwsop4/AWfLhU1cR7k1VVvcYCWRkOI6Xy5gmnphCYIkvzuNYzHzosq2oNk2RtSs8khfUOfHIDgR6ysYBaMpl4uEgk2U/oJTs9AaTSwma7dT69geAE2ZpEjUsn2ieJNHeKfrI3EcAGJ2ZaNgVuC8EBctCLc57P5u5led6IOBkIYkuQMrmmjChs4VkfOerHqSBkPzZlhe06RslZ3zMjk2sscqKwY0RcjKK+LWbzd7KiHhkncs/siFJ+V5eXxD34B8nVuJEpGJNmxN2gH3vSvp7J70tF+D1Ej8qUJD1TkErAND2GZwTFg/LubvmgiBG3SOvdlsqFQrkEzJCL1rstlnVFROixZoDDSuXQFHESwVGlcuQcMb/b42NgjLowh5MTDFE3vNB5qStRIErdCQEh6pLPR92anSUb/wAIhldAaDMpGgAAAABJRU5ErkJggg=="},579:(e,t,n)=>{"use strict";e.exports=n(153)},618:(e,t,n)=>{"use strict";e.exports=n.p+"static/media/ort.bundle.min.efa0ba28dfa2d9c46859.mjs"},730:(e,t,n)=>{"use strict";var i=n(43),r=n(853);function o(e){for(var t="https://reactjs.org/docs/error-decoder.html?invariant="+e,n=1;n<arguments.length;n++)t+="&args[]="+encodeURIComponent(arguments[n]);return"Minified React error #"+e+"; visit "+t+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}var a=new Set,s={};function c(e,t){l(e,t),l(e+"Capture",t)}function l(e,t){for(s[e]=t,e=0;e<t.length;e++)a.add(t[e])}var u=!("undefined"===typeof window||"undefined"===typeof window.document||"undefined"===typeof window.document.createElement),d=Object.prototype.hasOwnProperty,h=/^[:A-Z_a-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD][:A-Z_a-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD\-.0-9\u00B7\u0300-\u036F\u203F-\u2040]*$/,f={},p={};function m(e,t,n,i,r,o,a){this.acceptsBooleans=2===t||3===t||4===t,this.attributeName=i,this.attributeNamespace=r,this.mustUseProperty=n,this.propertyName=e,this.type=t,this.sanitizeURL=o,this.removeEmptyString=a}var g={};"children dangerouslySetInnerHTML defaultValue defaultChecked innerHTML suppressContentEditableWarning suppressHydrationWarning style".split(" ").forEach(function(e){g[e]=new m(e,0,!1,e,null,!1,!1)}),[["acceptCharset","accept-charset"],["className","class"],["htmlFor","for"],["httpEquiv","http-equiv"]].forEach(function(e){var t=e[0];g[t]=new m(t,1,!1,e[1],null,!1,!1)}),["contentEditable","draggable","spellCheck","value"].forEach(function(e){g[e]=new m(e,2,!1,e.toLowerCase(),null,!1,!1)}),["autoReverse","externalResourcesRequired","focusable","preserveAlpha"].forEach(function(e){g[e]=new m(e,2,!1,e,null,!1,!1)}),"allowFullScreen async autoFocus autoPlay controls default defer disabled disablePictureInPicture disableRemotePlayback formNoValidate hidden loop noModule noValidate open playsInline readOnly required reversed scoped seamless itemScope".split(" ").forEach(function(e){g[e]=new m(e,3,!1,e.toLowerCase(),null,!1,!1)}),["checked","multiple","muted","selected"].forEach(function(e){g[e]=new m(e,3,!0,e,null,!1,!1)}),["capture","download"].forEach(function(e){g[e]=new m(e,4,!1,e,null,!1,!1)}),["cols","rows","size","span"].forEach(function(e){g[e]=new m(e,6,!1,e,null,!1,!1)}),["rowSpan","start"].forEach(function(e){g[e]=new m(e,5,!1,e.toLowerCase(),null,!1,!1)});var y=/[\-:]([a-z])/g;function v(e){return e[1].toUpperCase()}function _(e,t,n,i){var r=g.hasOwnProperty(t)?g[t]:null;(null!==r?0!==r.type:i||!(2<t.length)||"o"!==t[0]&&"O"!==t[0]||"n"!==t[1]&&"N"!==t[1])&&(function(e,t,n,i){if(null===t||"undefined"===typeof t||function(e,t,n,i){if(null!==n&&0===n.type)return!1;switch(typeof t){case"function":case"symbol":return!0;case"boolean":return!i&&(null!==n?!n.acceptsBooleans:"data-"!==(e=e.toLowerCase().slice(0,5))&&"aria-"!==e);default:return!1}}(e,t,n,i))return!0;if(i)return!1;if(null!==n)switch(n.type){case 3:return!t;case 4:return!1===t;case 5:return isNaN(t);case 6:return isNaN(t)||1>t}return!1}(t,n,r,i)&&(n=null),i||null===r?function(e){return!!d.call(p,e)||!d.call(f,e)&&(h.test(e)?p[e]=!0:(f[e]=!0,!1))}(t)&&(null===n?e.removeAttribute(t):e.setAttribute(t,""+n)):r.mustUseProperty?e[r.propertyName]=null===n?3!==r.type&&"":n:(t=r.attributeName,i=r.attributeNamespace,null===n?e.removeAttribute(t):(n=3===(r=r.type)||4===r&&!0===n?"":""+n,i?e.setAttributeNS(i,t,n):e.setAttribute(t,n))))}"accent-height alignment-baseline arabic-form baseline-shift cap-height clip-path clip-rule color-interpolation color-interpolation-filters color-profile color-rendering dominant-baseline enable-background fill-opacity fill-rule flood-color flood-opacity font-family font-size font-size-adjust font-stretch font-style font-variant font-weight glyph-name glyph-orientation-horizontal glyph-orientation-vertical horiz-adv-x horiz-origin-x image-rendering letter-spacing lighting-color marker-end marker-mid marker-start overline-position overline-thickness paint-order panose-1 pointer-events rendering-intent shape-rendering stop-color stop-opacity strikethrough-position strikethrough-thickness stroke-dasharray stroke-dashoffset stroke-linecap stroke-linejoin stroke-miterlimit stroke-opacity stroke-width text-anchor text-decoration text-rendering underline-position underline-thickness unicode-bidi unicode-range units-per-em v-alphabetic v-hanging v-ideographic v-mathematical vector-effect vert-adv-y vert-origin-x vert-origin-y word-spacing writing-mode xmlns:xlink x-height".split(" ").forEach(function(e){var t=e.replace(y,v);g[t]=new m(t,1,!1,e,null,!1,!1)}),"xlink:actuate xlink:arcrole xlink:role xlink:show xlink:title xlink:type".split(" ").forEach(function(e){var t=e.replace(y,v);g[t]=new m(t,1,!1,e,"http://www.w3.org/1999/xlink",!1,!1)}),["xml:base","xml:lang","xml:space"].forEach(function(e){var t=e.replace(y,v);g[t]=new m(t,1,!1,e,"http://www.w3.org/XML/1998/namespace",!1,!1)}),["tabIndex","crossOrigin"].forEach(function(e){g[e]=new m(e,1,!1,e.toLowerCase(),null,!1,!1)}),g.xlinkHref=new m("xlinkHref",1,!1,"xlink:href","http://www.w3.org/1999/xlink",!0,!1),["src","href","action","formAction"].forEach(function(e){g[e]=new m(e,1,!1,e.toLowerCase(),null,!0,!0)});var w=i.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED,b=Symbol.for("react.element"),x=Symbol.for("react.portal"),S=Symbol.for("react.fragment"),E=Symbol.for("react.strict_mode"),T=Symbol.for("react.profiler"),k=Symbol.for("react.provider"),C=Symbol.for("react.context"),I=Symbol.for("react.forward_ref"),A=Symbol.for("react.suspense"),N=Symbol.for("react.suspense_list"),O=Symbol.for("react.memo"),P=Symbol.for("react.lazy");Symbol.for("react.scope"),Symbol.for("react.debug_trace_mode");var R=Symbol.for("react.offscreen");Symbol.for("react.legacy_hidden"),Symbol.for("react.cache"),Symbol.for("react.tracing_marker");var L=Symbol.iterator;function z(e){return null===e||"object"!==typeof e?null:"function"===typeof(e=L&&e[L]||e["@@iterator"])?e:null}var M,D=Object.assign;function B(e){if(void 0===M)try{throw Error()}catch(n){var t=n.stack.trim().match(/\n( *(at )?)/);M=t&&t[1]||""}return"\n"+M+e}var U=!1;function F(e,t){if(!e||U)return"";U=!0;var n=Error.prepareStackTrace;Error.prepareStackTrace=void 0;try{if(t)if(t=function(){throw Error()},Object.defineProperty(t.prototype,"props",{set:function(){throw Error()}}),"object"===typeof Reflect&&Reflect.construct){try{Reflect.construct(t,[])}catch(l){var i=l}Reflect.construct(e,[],t)}else{try{t.call()}catch(l){i=l}e.call(t.prototype)}else{try{throw Error()}catch(l){i=l}e()}}catch(l){if(l&&i&&"string"===typeof l.stack){for(var r=l.stack.split("\n"),o=i.stack.split("\n"),a=r.length-1,s=o.length-1;1<=a&&0<=s&&r[a]!==o[s];)s--;for(;1<=a&&0<=s;a--,s--)if(r[a]!==o[s]){if(1!==a||1!==s)do{if(a--,0>--s||r[a]!==o[s]){var c="\n"+r[a].replace(" at new "," at ");return e.displayName&&c.includes("<anonymous>")&&(c=c.replace("<anonymous>",e.displayName)),c}}while(1<=a&&0<=s);break}}}finally{U=!1,Error.prepareStackTrace=n}return(e=e?e.displayName||e.name:"")?B(e):""}function j(e){switch(e.tag){case 5:return B(e.type);case 16:return B("Lazy");case 13:return B("Suspense");case 19:return B("SuspenseList");case 0:case 2:case 15:return e=F(e.type,!1);case 11:return e=F(e.type.render,!1);case 1:return e=F(e.type,!0);default:return""}}function V(e){if(null==e)return null;if("function"===typeof e)return e.displayName||e.name||null;if("string"===typeof e)return e;switch(e){case S:return"Fragment";case x:return"Portal";case T:return"Profiler";case E:return"StrictMode";case A:return"Suspense";case N:return"SuspenseList"}if("object"===typeof e)switch(e.$$typeof){case C:return(e.displayName||"Context")+".Consumer";case k:return(e._context.displayName||"Context")+".Provider";case I:var t=e.render;return(e=e.displayName)||(e=""!==(e=t.displayName||t.name||"")?"ForwardRef("+e+")":"ForwardRef"),e;case O:return null!==(t=e.displayName||null)?t:V(e.type)||"Memo";case P:t=e._payload,e=e._init;try{return V(e(t))}catch(n){}}return null}function q(e){var t=e.type;switch(e.tag){case 24:return"Cache";case 9:return(t.displayName||"Context")+".Consumer";case 10:return(t._context.displayName||"Context")+".Provider";case 18:return"DehydratedFragment";case 11:return e=(e=t.render).displayName||e.name||"",t.displayName||(""!==e?"ForwardRef("+e+")":"ForwardRef");case 7:return"Fragment";case 5:return t;case 4:return"Portal";case 3:return"Root";case 6:return"Text";case 16:return V(t);case 8:return t===E?"StrictMode":"Mode";case 22:return"Offscreen";case 12:return"Profiler";case 21:return"Scope";case 13:return"Suspense";case 19:return"SuspenseList";case 25:return"TracingMarker";case 1:case 0:case 17:case 2:case 14:case 15:if("function"===typeof t)return t.displayName||t.name||null;if("string"===typeof t)return t}return null}function H(e){switch(typeof e){case"boolean":case"number":case"string":case"undefined":case"object":return e;default:return""}}function W(e){var t=e.type;return(e=e.nodeName)&&"input"===e.toLowerCase()&&("checkbox"===t||"radio"===t)}function G(e){e._valueTracker||(e._valueTracker=function(e){var t=W(e)?"checked":"value",n=Object.getOwnPropertyDescriptor(e.constructor.prototype,t),i=""+e[t];if(!e.hasOwnProperty(t)&&"undefined"!==typeof n&&"function"===typeof n.get&&"function"===typeof n.set){var r=n.get,o=n.set;return Object.defineProperty(e,t,{configurable:!0,get:function(){return r.call(this)},set:function(e){i=""+e,o.call(this,e)}}),Object.defineProperty(e,t,{enumerable:n.enumerable}),{getValue:function(){return i},setValue:function(e){i=""+e},stopTracking:function(){e._valueTracker=null,delete e[t]}}}}(e))}function K(e){if(!e)return!1;var t=e._valueTracker;if(!t)return!0;var n=t.getValue(),i="";return e&&(i=W(e)?e.checked?"true":"false":e.value),(e=i)!==n&&(t.setValue(e),!0)}function Z(e){if("undefined"===typeof(e=e||("undefined"!==typeof document?document:void 0)))return null;try{return e.activeElement||e.body}catch(t){return e.body}}function Q(e,t){var n=t.checked;return D({},t,{defaultChecked:void 0,defaultValue:void 0,value:void 0,checked:null!=n?n:e._wrapperState.initialChecked})}function X(e,t){var n=null==t.defaultValue?"":t.defaultValue,i=null!=t.checked?t.checked:t.defaultChecked;n=H(null!=t.value?t.value:n),e._wrapperState={initialChecked:i,initialValue:n,controlled:"checkbox"===t.type||"radio"===t.type?null!=t.checked:null!=t.value}}function Y(e,t){null!=(t=t.checked)&&_(e,"checked",t,!1)}function J(e,t){Y(e,t);var n=H(t.value),i=t.type;if(null!=n)"number"===i?(0===n&&""===e.value||e.value!=n)&&(e.value=""+n):e.value!==""+n&&(e.value=""+n);else if("submit"===i||"reset"===i)return void e.removeAttribute("value");t.hasOwnProperty("value")?ee(e,t.type,n):t.hasOwnProperty("defaultValue")&&ee(e,t.type,H(t.defaultValue)),null==t.checked&&null!=t.defaultChecked&&(e.defaultChecked=!!t.defaultChecked)}function $(e,t,n){if(t.hasOwnProperty("value")||t.hasOwnProperty("defaultValue")){var i=t.type;if(!("submit"!==i&&"reset"!==i||void 0!==t.value&&null!==t.value))return;t=""+e._wrapperState.initialValue,n||t===e.value||(e.value=t),e.defaultValue=t}""!==(n=e.name)&&(e.name=""),e.defaultChecked=!!e._wrapperState.initialChecked,""!==n&&(e.name=n)}function ee(e,t,n){"number"===t&&Z(e.ownerDocument)===e||(null==n?e.defaultValue=""+e._wrapperState.initialValue:e.defaultValue!==""+n&&(e.defaultValue=""+n))}var te=Array.isArray;function ne(e,t,n,i){if(e=e.options,t){t={};for(var r=0;r<n.length;r++)t["$"+n[r]]=!0;for(n=0;n<e.length;n++)r=t.hasOwnProperty("$"+e[n].value),e[n].selected!==r&&(e[n].selected=r),r&&i&&(e[n].defaultSelected=!0)}else{for(n=""+H(n),t=null,r=0;r<e.length;r++){if(e[r].value===n)return e[r].selected=!0,void(i&&(e[r].defaultSelected=!0));null!==t||e[r].disabled||(t=e[r])}null!==t&&(t.selected=!0)}}function ie(e,t){if(null!=t.dangerouslySetInnerHTML)throw Error(o(91));return D({},t,{value:void 0,defaultValue:void 0,children:""+e._wrapperState.initialValue})}function re(e,t){var n=t.value;if(null==n){if(n=t.children,t=t.defaultValue,null!=n){if(null!=t)throw Error(o(92));if(te(n)){if(1<n.length)throw Error(o(93));n=n[0]}t=n}null==t&&(t=""),n=t}e._wrapperState={initialValue:H(n)}}function oe(e,t){var n=H(t.value),i=H(t.defaultValue);null!=n&&((n=""+n)!==e.value&&(e.value=n),null==t.defaultValue&&e.defaultValue!==n&&(e.defaultValue=n)),null!=i&&(e.defaultValue=""+i)}function ae(e){var t=e.textContent;t===e._wrapperState.initialValue&&""!==t&&null!==t&&(e.value=t)}function se(e){switch(e){case"svg":return"http://www.w3.org/2000/svg";case"math":return"http://www.w3.org/1998/Math/MathML";default:return"http://www.w3.org/1999/xhtml"}}function ce(e,t){return null==e||"http://www.w3.org/1999/xhtml"===e?se(t):"http://www.w3.org/2000/svg"===e&&"foreignObject"===t?"http://www.w3.org/1999/xhtml":e}var le,ue,de=(ue=function(e,t){if("http://www.w3.org/2000/svg"!==e.namespaceURI||"innerHTML"in e)e.innerHTML=t;else{for((le=le||document.createElement("div")).innerHTML="<svg>"+t.valueOf().toString()+"</svg>",t=le.firstChild;e.firstChild;)e.removeChild(e.firstChild);for(;t.firstChild;)e.appendChild(t.firstChild)}},"undefined"!==typeof MSApp&&MSApp.execUnsafeLocalFunction?function(e,t,n,i){MSApp.execUnsafeLocalFunction(function(){return ue(e,t)})}:ue);function he(e,t){if(t){var n=e.firstChild;if(n&&n===e.lastChild&&3===n.nodeType)return void(n.nodeValue=t)}e.textContent=t}var fe={animationIterationCount:!0,aspectRatio:!0,borderImageOutset:!0,borderImageSlice:!0,borderImageWidth:!0,boxFlex:!0,boxFlexGroup:!0,boxOrdinalGroup:!0,columnCount:!0,columns:!0,flex:!0,flexGrow:!0,flexPositive:!0,flexShrink:!0,flexNegative:!0,flexOrder:!0,gridArea:!0,gridRow:!0,gridRowEnd:!0,gridRowSpan:!0,gridRowStart:!0,gridColumn:!0,gridColumnEnd:!0,gridColumnSpan:!0,gridColumnStart:!0,fontWeight:!0,lineClamp:!0,lineHeight:!0,opacity:!0,order:!0,orphans:!0,tabSize:!0,widows:!0,zIndex:!0,zoom:!0,fillOpacity:!0,floodOpacity:!0,stopOpacity:!0,strokeDasharray:!0,strokeDashoffset:!0,strokeMiterlimit:!0,strokeOpacity:!0,strokeWidth:!0},pe=["Webkit","ms","Moz","O"];function me(e,t,n){return null==t||"boolean"===typeof t||""===t?"":n||"number"!==typeof t||0===t||fe.hasOwnProperty(e)&&fe[e]?(""+t).trim():t+"px"}function ge(e,t){for(var n in e=e.style,t)if(t.hasOwnProperty(n)){var i=0===n.indexOf("--"),r=me(n,t[n],i);"float"===n&&(n="cssFloat"),i?e.setProperty(n,r):e[n]=r}}Object.keys(fe).forEach(function(e){pe.forEach(function(t){t=t+e.charAt(0).toUpperCase()+e.substring(1),fe[t]=fe[e]})});var ye=D({menuitem:!0},{area:!0,base:!0,br:!0,col:!0,embed:!0,hr:!0,img:!0,input:!0,keygen:!0,link:!0,meta:!0,param:!0,source:!0,track:!0,wbr:!0});function ve(e,t){if(t){if(ye[e]&&(null!=t.children||null!=t.dangerouslySetInnerHTML))throw Error(o(137,e));if(null!=t.dangerouslySetInnerHTML){if(null!=t.children)throw Error(o(60));if("object"!==typeof t.dangerouslySetInnerHTML||!("__html"in t.dangerouslySetInnerHTML))throw Error(o(61))}if(null!=t.style&&"object"!==typeof t.style)throw Error(o(62))}}function _e(e,t){if(-1===e.indexOf("-"))return"string"===typeof t.is;switch(e){case"annotation-xml":case"color-profile":case"font-face":case"font-face-src":case"font-face-uri":case"font-face-format":case"font-face-name":case"missing-glyph":return!1;default:return!0}}var we=null;function be(e){return(e=e.target||e.srcElement||window).correspondingUseElement&&(e=e.correspondingUseElement),3===e.nodeType?e.parentNode:e}var xe=null,Se=null,Ee=null;function Te(e){if(e=_r(e)){if("function"!==typeof xe)throw Error(o(280));var t=e.stateNode;t&&(t=br(t),xe(e.stateNode,e.type,t))}}function ke(e){Se?Ee?Ee.push(e):Ee=[e]:Se=e}function Ce(){if(Se){var e=Se,t=Ee;if(Ee=Se=null,Te(e),t)for(e=0;e<t.length;e++)Te(t[e])}}function Ie(e,t){return e(t)}function Ae(){}var Ne=!1;function Oe(e,t,n){if(Ne)return e(t,n);Ne=!0;try{return Ie(e,t,n)}finally{Ne=!1,(null!==Se||null!==Ee)&&(Ae(),Ce())}}function Pe(e,t){var n=e.stateNode;if(null===n)return null;var i=br(n);if(null===i)return null;n=i[t];e:switch(t){case"onClick":case"onClickCapture":case"onDoubleClick":case"onDoubleClickCapture":case"onMouseDown":case"onMouseDownCapture":case"onMouseMove":case"onMouseMoveCapture":case"onMouseUp":case"onMouseUpCapture":case"onMouseEnter":(i=!i.disabled)||(i=!("button"===(e=e.type)||"input"===e||"select"===e||"textarea"===e)),e=!i;break e;default:e=!1}if(e)return null;if(n&&"function"!==typeof n)throw Error(o(231,t,typeof n));return n}var Re=!1;if(u)try{var Le={};Object.defineProperty(Le,"passive",{get:function(){Re=!0}}),window.addEventListener("test",Le,Le),window.removeEventListener("test",Le,Le)}catch(ue){Re=!1}function ze(e,t,n,i,r,o,a,s,c){var l=Array.prototype.slice.call(arguments,3);try{t.apply(n,l)}catch(u){this.onError(u)}}var Me=!1,De=null,Be=!1,Ue=null,Fe={onError:function(e){Me=!0,De=e}};function je(e,t,n,i,r,o,a,s,c){Me=!1,De=null,ze.apply(Fe,arguments)}function Ve(e){var t=e,n=e;if(e.alternate)for(;t.return;)t=t.return;else{e=t;do{0!==(4098&(t=e).flags)&&(n=t.return),e=t.return}while(e)}return 3===t.tag?n:null}function qe(e){if(13===e.tag){var t=e.memoizedState;if(null===t&&(null!==(e=e.alternate)&&(t=e.memoizedState)),null!==t)return t.dehydrated}return null}function He(e){if(Ve(e)!==e)throw Error(o(188))}function We(e){return null!==(e=function(e){var t=e.alternate;if(!t){if(null===(t=Ve(e)))throw Error(o(188));return t!==e?null:e}for(var n=e,i=t;;){var r=n.return;if(null===r)break;var a=r.alternate;if(null===a){if(null!==(i=r.return)){n=i;continue}break}if(r.child===a.child){for(a=r.child;a;){if(a===n)return He(r),e;if(a===i)return He(r),t;a=a.sibling}throw Error(o(188))}if(n.return!==i.return)n=r,i=a;else{for(var s=!1,c=r.child;c;){if(c===n){s=!0,n=r,i=a;break}if(c===i){s=!0,i=r,n=a;break}c=c.sibling}if(!s){for(c=a.child;c;){if(c===n){s=!0,n=a,i=r;break}if(c===i){s=!0,i=a,n=r;break}c=c.sibling}if(!s)throw Error(o(189))}}if(n.alternate!==i)throw Error(o(190))}if(3!==n.tag)throw Error(o(188));return n.stateNode.current===n?e:t}(e))?Ge(e):null}function Ge(e){if(5===e.tag||6===e.tag)return e;for(e=e.child;null!==e;){var t=Ge(e);if(null!==t)return t;e=e.sibling}return null}var Ke=r.unstable_scheduleCallback,Ze=r.unstable_cancelCallback,Qe=r.unstable_shouldYield,Xe=r.unstable_requestPaint,Ye=r.unstable_now,Je=r.unstable_getCurrentPriorityLevel,$e=r.unstable_ImmediatePriority,et=r.unstable_UserBlockingPriority,tt=r.unstable_NormalPriority,nt=r.unstable_LowPriority,it=r.unstable_IdlePriority,rt=null,ot=null;var at=Math.clz32?Math.clz32:function(e){return e>>>=0,0===e?32:31-(st(e)/ct|0)|0},st=Math.log,ct=Math.LN2;var lt=64,ut=4194304;function dt(e){switch(e&-e){case 1:return 1;case 2:return 2;case 4:return 4;case 8:return 8;case 16:return 16;case 32:return 32;case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return 4194240&e;case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:return 130023424&e;case 134217728:return 134217728;case 268435456:return 268435456;case 536870912:return 536870912;case 1073741824:return 1073741824;default:return e}}function ht(e,t){var n=e.pendingLanes;if(0===n)return 0;var i=0,r=e.suspendedLanes,o=e.pingedLanes,a=268435455&n;if(0!==a){var s=a&~r;0!==s?i=dt(s):0!==(o&=a)&&(i=dt(o))}else 0!==(a=n&~r)?i=dt(a):0!==o&&(i=dt(o));if(0===i)return 0;if(0!==t&&t!==i&&0===(t&r)&&((r=i&-i)>=(o=t&-t)||16===r&&0!==(4194240&o)))return t;if(0!==(4&i)&&(i|=16&n),0!==(t=e.entangledLanes))for(e=e.entanglements,t&=i;0<t;)r=1<<(n=31-at(t)),i|=e[n],t&=~r;return i}function ft(e,t){switch(e){case 1:case 2:case 4:return t+250;case 8:case 16:case 32:case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return t+5e3;default:return-1}}function pt(e){return 0!==(e=-1073741825&e.pendingLanes)?e:1073741824&e?1073741824:0}function mt(){var e=lt;return 0===(4194240&(lt<<=1))&&(lt=64),e}function gt(e){for(var t=[],n=0;31>n;n++)t.push(e);return t}function yt(e,t,n){e.pendingLanes|=t,536870912!==t&&(e.suspendedLanes=0,e.pingedLanes=0),(e=e.eventTimes)[t=31-at(t)]=n}function vt(e,t){var n=e.entangledLanes|=t;for(e=e.entanglements;n;){var i=31-at(n),r=1<<i;r&t|e[i]&t&&(e[i]|=t),n&=~r}}var _t=0;function wt(e){return 1<(e&=-e)?4<e?0!==(268435455&e)?16:536870912:4:1}var bt,xt,St,Et,Tt,kt=!1,Ct=[],It=null,At=null,Nt=null,Ot=new Map,Pt=new Map,Rt=[],Lt="mousedown mouseup touchcancel touchend touchstart auxclick dblclick pointercancel pointerdown pointerup dragend dragstart drop compositionend compositionstart keydown keypress keyup input textInput copy cut paste click change contextmenu reset submit".split(" ");function zt(e,t){switch(e){case"focusin":case"focusout":It=null;break;case"dragenter":case"dragleave":At=null;break;case"mouseover":case"mouseout":Nt=null;break;case"pointerover":case"pointerout":Ot.delete(t.pointerId);break;case"gotpointercapture":case"lostpointercapture":Pt.delete(t.pointerId)}}function Mt(e,t,n,i,r,o){return null===e||e.nativeEvent!==o?(e={blockedOn:t,domEventName:n,eventSystemFlags:i,nativeEvent:o,targetContainers:[r]},null!==t&&(null!==(t=_r(t))&&xt(t)),e):(e.eventSystemFlags|=i,t=e.targetContainers,null!==r&&-1===t.indexOf(r)&&t.push(r),e)}function Dt(e){var t=vr(e.target);if(null!==t){var n=Ve(t);if(null!==n)if(13===(t=n.tag)){if(null!==(t=qe(n)))return e.blockedOn=t,void Tt(e.priority,function(){St(n)})}else if(3===t&&n.stateNode.current.memoizedState.isDehydrated)return void(e.blockedOn=3===n.tag?n.stateNode.containerInfo:null)}e.blockedOn=null}function Bt(e){if(null!==e.blockedOn)return!1;for(var t=e.targetContainers;0<t.length;){var n=Qt(e.domEventName,e.eventSystemFlags,t[0],e.nativeEvent);if(null!==n)return null!==(t=_r(n))&&xt(t),e.blockedOn=n,!1;var i=new(n=e.nativeEvent).constructor(n.type,n);we=i,n.target.dispatchEvent(i),we=null,t.shift()}return!0}function Ut(e,t,n){Bt(e)&&n.delete(t)}function Ft(){kt=!1,null!==It&&Bt(It)&&(It=null),null!==At&&Bt(At)&&(At=null),null!==Nt&&Bt(Nt)&&(Nt=null),Ot.forEach(Ut),Pt.forEach(Ut)}function jt(e,t){e.blockedOn===t&&(e.blockedOn=null,kt||(kt=!0,r.unstable_scheduleCallback(r.unstable_NormalPriority,Ft)))}function Vt(e){function t(t){return jt(t,e)}if(0<Ct.length){jt(Ct[0],e);for(var n=1;n<Ct.length;n++){var i=Ct[n];i.blockedOn===e&&(i.blockedOn=null)}}for(null!==It&&jt(It,e),null!==At&&jt(At,e),null!==Nt&&jt(Nt,e),Ot.forEach(t),Pt.forEach(t),n=0;n<Rt.length;n++)(i=Rt[n]).blockedOn===e&&(i.blockedOn=null);for(;0<Rt.length&&null===(n=Rt[0]).blockedOn;)Dt(n),null===n.blockedOn&&Rt.shift()}var qt=w.ReactCurrentBatchConfig,Ht=!0;function Wt(e,t,n,i){var r=_t,o=qt.transition;qt.transition=null;try{_t=1,Kt(e,t,n,i)}finally{_t=r,qt.transition=o}}function Gt(e,t,n,i){var r=_t,o=qt.transition;qt.transition=null;try{_t=4,Kt(e,t,n,i)}finally{_t=r,qt.transition=o}}function Kt(e,t,n,i){if(Ht){var r=Qt(e,t,n,i);if(null===r)Hi(e,t,i,Zt,n),zt(e,i);else if(function(e,t,n,i,r){switch(t){case"focusin":return It=Mt(It,e,t,n,i,r),!0;case"dragenter":return At=Mt(At,e,t,n,i,r),!0;case"mouseover":return Nt=Mt(Nt,e,t,n,i,r),!0;case"pointerover":var o=r.pointerId;return Ot.set(o,Mt(Ot.get(o)||null,e,t,n,i,r)),!0;case"gotpointercapture":return o=r.pointerId,Pt.set(o,Mt(Pt.get(o)||null,e,t,n,i,r)),!0}return!1}(r,e,t,n,i))i.stopPropagation();else if(zt(e,i),4&t&&-1<Lt.indexOf(e)){for(;null!==r;){var o=_r(r);if(null!==o&&bt(o),null===(o=Qt(e,t,n,i))&&Hi(e,t,i,Zt,n),o===r)break;r=o}null!==r&&i.stopPropagation()}else Hi(e,t,i,null,n)}}var Zt=null;function Qt(e,t,n,i){if(Zt=null,null!==(e=vr(e=be(i))))if(null===(t=Ve(e)))e=null;else if(13===(n=t.tag)){if(null!==(e=qe(t)))return e;e=null}else if(3===n){if(t.stateNode.current.memoizedState.isDehydrated)return 3===t.tag?t.stateNode.containerInfo:null;e=null}else t!==e&&(e=null);return Zt=e,null}function Xt(e){switch(e){case"cancel":case"click":case"close":case"contextmenu":case"copy":case"cut":case"auxclick":case"dblclick":case"dragend":case"dragstart":case"drop":case"focusin":case"focusout":case"input":case"invalid":case"keydown":case"keypress":case"keyup":case"mousedown":case"mouseup":case"paste":case"pause":case"play":case"pointercancel":case"pointerdown":case"pointerup":case"ratechange":case"reset":case"resize":case"seeked":case"submit":case"touchcancel":case"touchend":case"touchstart":case"volumechange":case"change":case"selectionchange":case"textInput":case"compositionstart":case"compositionend":case"compositionupdate":case"beforeblur":case"afterblur":case"beforeinput":case"blur":case"fullscreenchange":case"focus":case"hashchange":case"popstate":case"select":case"selectstart":return 1;case"drag":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"mousemove":case"mouseout":case"mouseover":case"pointermove":case"pointerout":case"pointerover":case"scroll":case"toggle":case"touchmove":case"wheel":case"mouseenter":case"mouseleave":case"pointerenter":case"pointerleave":return 4;case"message":switch(Je()){case $e:return 1;case et:return 4;case tt:case nt:return 16;case it:return 536870912;default:return 16}default:return 16}}var Yt=null,Jt=null,$t=null;function en(){if($t)return $t;var e,t,n=Jt,i=n.length,r="value"in Yt?Yt.value:Yt.textContent,o=r.length;for(e=0;e<i&&n[e]===r[e];e++);var a=i-e;for(t=1;t<=a&&n[i-t]===r[o-t];t++);return $t=r.slice(e,1<t?1-t:void 0)}function tn(e){var t=e.keyCode;return"charCode"in e?0===(e=e.charCode)&&13===t&&(e=13):e=t,10===e&&(e=13),32<=e||13===e?e:0}function nn(){return!0}function rn(){return!1}function on(e){function t(t,n,i,r,o){for(var a in this._reactName=t,this._targetInst=i,this.type=n,this.nativeEvent=r,this.target=o,this.currentTarget=null,e)e.hasOwnProperty(a)&&(t=e[a],this[a]=t?t(r):r[a]);return this.isDefaultPrevented=(null!=r.defaultPrevented?r.defaultPrevented:!1===r.returnValue)?nn:rn,this.isPropagationStopped=rn,this}return D(t.prototype,{preventDefault:function(){this.defaultPrevented=!0;var e=this.nativeEvent;e&&(e.preventDefault?e.preventDefault():"unknown"!==typeof e.returnValue&&(e.returnValue=!1),this.isDefaultPrevented=nn)},stopPropagation:function(){var e=this.nativeEvent;e&&(e.stopPropagation?e.stopPropagation():"unknown"!==typeof e.cancelBubble&&(e.cancelBubble=!0),this.isPropagationStopped=nn)},persist:function(){},isPersistent:nn}),t}var an,sn,cn,ln={eventPhase:0,bubbles:0,cancelable:0,timeStamp:function(e){return e.timeStamp||Date.now()},defaultPrevented:0,isTrusted:0},un=on(ln),dn=D({},ln,{view:0,detail:0}),hn=on(dn),fn=D({},dn,{screenX:0,screenY:0,clientX:0,clientY:0,pageX:0,pageY:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,getModifierState:Tn,button:0,buttons:0,relatedTarget:function(e){return void 0===e.relatedTarget?e.fromElement===e.srcElement?e.toElement:e.fromElement:e.relatedTarget},movementX:function(e){return"movementX"in e?e.movementX:(e!==cn&&(cn&&"mousemove"===e.type?(an=e.screenX-cn.screenX,sn=e.screenY-cn.screenY):sn=an=0,cn=e),an)},movementY:function(e){return"movementY"in e?e.movementY:sn}}),pn=on(fn),mn=on(D({},fn,{dataTransfer:0})),gn=on(D({},dn,{relatedTarget:0})),yn=on(D({},ln,{animationName:0,elapsedTime:0,pseudoElement:0})),vn=D({},ln,{clipboardData:function(e){return"clipboardData"in e?e.clipboardData:window.clipboardData}}),_n=on(vn),wn=on(D({},ln,{data:0})),bn={Esc:"Escape",Spacebar:" ",Left:"ArrowLeft",Up:"ArrowUp",Right:"ArrowRight",Down:"ArrowDown",Del:"Delete",Win:"OS",Menu:"ContextMenu",Apps:"ContextMenu",Scroll:"ScrollLock",MozPrintableKey:"Unidentified"},xn={8:"Backspace",9:"Tab",12:"Clear",13:"Enter",16:"Shift",17:"Control",18:"Alt",19:"Pause",20:"CapsLock",27:"Escape",32:" ",33:"PageUp",34:"PageDown",35:"End",36:"Home",37:"ArrowLeft",38:"ArrowUp",39:"ArrowRight",40:"ArrowDown",45:"Insert",46:"Delete",112:"F1",113:"F2",114:"F3",115:"F4",116:"F5",117:"F6",118:"F7",119:"F8",120:"F9",121:"F10",122:"F11",123:"F12",144:"NumLock",145:"ScrollLock",224:"Meta"},Sn={Alt:"altKey",Control:"ctrlKey",Meta:"metaKey",Shift:"shiftKey"};function En(e){var t=this.nativeEvent;return t.getModifierState?t.getModifierState(e):!!(e=Sn[e])&&!!t[e]}function Tn(){return En}var kn=D({},dn,{key:function(e){if(e.key){var t=bn[e.key]||e.key;if("Unidentified"!==t)return t}return"keypress"===e.type?13===(e=tn(e))?"Enter":String.fromCharCode(e):"keydown"===e.type||"keyup"===e.type?xn[e.keyCode]||"Unidentified":""},code:0,location:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,repeat:0,locale:0,getModifierState:Tn,charCode:function(e){return"keypress"===e.type?tn(e):0},keyCode:function(e){return"keydown"===e.type||"keyup"===e.type?e.keyCode:0},which:function(e){return"keypress"===e.type?tn(e):"keydown"===e.type||"keyup"===e.type?e.keyCode:0}}),Cn=on(kn),In=on(D({},fn,{pointerId:0,width:0,height:0,pressure:0,tangentialPressure:0,tiltX:0,tiltY:0,twist:0,pointerType:0,isPrimary:0})),An=on(D({},dn,{touches:0,targetTouches:0,changedTouches:0,altKey:0,metaKey:0,ctrlKey:0,shiftKey:0,getModifierState:Tn})),Nn=on(D({},ln,{propertyName:0,elapsedTime:0,pseudoElement:0})),On=D({},fn,{deltaX:function(e){return"deltaX"in e?e.deltaX:"wheelDeltaX"in e?-e.wheelDeltaX:0},deltaY:function(e){return"deltaY"in e?e.deltaY:"wheelDeltaY"in e?-e.wheelDeltaY:"wheelDelta"in e?-e.wheelDelta:0},deltaZ:0,deltaMode:0}),Pn=on(On),Rn=[9,13,27,32],Ln=u&&"CompositionEvent"in window,zn=null;u&&"documentMode"in document&&(zn=document.documentMode);var Mn=u&&"TextEvent"in window&&!zn,Dn=u&&(!Ln||zn&&8<zn&&11>=zn),Bn=String.fromCharCode(32),Un=!1;function Fn(e,t){switch(e){case"keyup":return-1!==Rn.indexOf(t.keyCode);case"keydown":return 229!==t.keyCode;case"keypress":case"mousedown":case"focusout":return!0;default:return!1}}function jn(e){return"object"===typeof(e=e.detail)&&"data"in e?e.data:null}var Vn=!1;var qn={color:!0,date:!0,datetime:!0,"datetime-local":!0,email:!0,month:!0,number:!0,password:!0,range:!0,search:!0,tel:!0,text:!0,time:!0,url:!0,week:!0};function Hn(e){var t=e&&e.nodeName&&e.nodeName.toLowerCase();return"input"===t?!!qn[e.type]:"textarea"===t}function Wn(e,t,n,i){ke(i),0<(t=Gi(t,"onChange")).length&&(n=new un("onChange","change",null,n,i),e.push({event:n,listeners:t}))}var Gn=null,Kn=null;function Zn(e){Bi(e,0)}function Qn(e){if(K(wr(e)))return e}function Xn(e,t){if("change"===e)return t}var Yn=!1;if(u){var Jn;if(u){var $n="oninput"in document;if(!$n){var ei=document.createElement("div");ei.setAttribute("oninput","return;"),$n="function"===typeof ei.oninput}Jn=$n}else Jn=!1;Yn=Jn&&(!document.documentMode||9<document.documentMode)}function ti(){Gn&&(Gn.detachEvent("onpropertychange",ni),Kn=Gn=null)}function ni(e){if("value"===e.propertyName&&Qn(Kn)){var t=[];Wn(t,Kn,e,be(e)),Oe(Zn,t)}}function ii(e,t,n){"focusin"===e?(ti(),Kn=n,(Gn=t).attachEvent("onpropertychange",ni)):"focusout"===e&&ti()}function ri(e){if("selectionchange"===e||"keyup"===e||"keydown"===e)return Qn(Kn)}function oi(e,t){if("click"===e)return Qn(t)}function ai(e,t){if("input"===e||"change"===e)return Qn(t)}var si="function"===typeof Object.is?Object.is:function(e,t){return e===t&&(0!==e||1/e===1/t)||e!==e&&t!==t};function ci(e,t){if(si(e,t))return!0;if("object"!==typeof e||null===e||"object"!==typeof t||null===t)return!1;var n=Object.keys(e),i=Object.keys(t);if(n.length!==i.length)return!1;for(i=0;i<n.length;i++){var r=n[i];if(!d.call(t,r)||!si(e[r],t[r]))return!1}return!0}function li(e){for(;e&&e.firstChild;)e=e.firstChild;return e}function ui(e,t){var n,i=li(e);for(e=0;i;){if(3===i.nodeType){if(n=e+i.textContent.length,e<=t&&n>=t)return{node:i,offset:t-e};e=n}e:{for(;i;){if(i.nextSibling){i=i.nextSibling;break e}i=i.parentNode}i=void 0}i=li(i)}}function di(e,t){return!(!e||!t)&&(e===t||(!e||3!==e.nodeType)&&(t&&3===t.nodeType?di(e,t.parentNode):"contains"in e?e.contains(t):!!e.compareDocumentPosition&&!!(16&e.compareDocumentPosition(t))))}function hi(){for(var e=window,t=Z();t instanceof e.HTMLIFrameElement;){try{var n="string"===typeof t.contentWindow.location.href}catch(i){n=!1}if(!n)break;t=Z((e=t.contentWindow).document)}return t}function fi(e){var t=e&&e.nodeName&&e.nodeName.toLowerCase();return t&&("input"===t&&("text"===e.type||"search"===e.type||"tel"===e.type||"url"===e.type||"password"===e.type)||"textarea"===t||"true"===e.contentEditable)}function pi(e){var t=hi(),n=e.focusedElem,i=e.selectionRange;if(t!==n&&n&&n.ownerDocument&&di(n.ownerDocument.documentElement,n)){if(null!==i&&fi(n))if(t=i.start,void 0===(e=i.end)&&(e=t),"selectionStart"in n)n.selectionStart=t,n.selectionEnd=Math.min(e,n.value.length);else if((e=(t=n.ownerDocument||document)&&t.defaultView||window).getSelection){e=e.getSelection();var r=n.textContent.length,o=Math.min(i.start,r);i=void 0===i.end?o:Math.min(i.end,r),!e.extend&&o>i&&(r=i,i=o,o=r),r=ui(n,o);var a=ui(n,i);r&&a&&(1!==e.rangeCount||e.anchorNode!==r.node||e.anchorOffset!==r.offset||e.focusNode!==a.node||e.focusOffset!==a.offset)&&((t=t.createRange()).setStart(r.node,r.offset),e.removeAllRanges(),o>i?(e.addRange(t),e.extend(a.node,a.offset)):(t.setEnd(a.node,a.offset),e.addRange(t)))}for(t=[],e=n;e=e.parentNode;)1===e.nodeType&&t.push({element:e,left:e.scrollLeft,top:e.scrollTop});for("function"===typeof n.focus&&n.focus(),n=0;n<t.length;n++)(e=t[n]).element.scrollLeft=e.left,e.element.scrollTop=e.top}}var mi=u&&"documentMode"in document&&11>=document.documentMode,gi=null,yi=null,vi=null,_i=!1;function wi(e,t,n){var i=n.window===n?n.document:9===n.nodeType?n:n.ownerDocument;_i||null==gi||gi!==Z(i)||("selectionStart"in(i=gi)&&fi(i)?i={start:i.selectionStart,end:i.selectionEnd}:i={anchorNode:(i=(i.ownerDocument&&i.ownerDocument.defaultView||window).getSelection()).anchorNode,anchorOffset:i.anchorOffset,focusNode:i.focusNode,focusOffset:i.focusOffset},vi&&ci(vi,i)||(vi=i,0<(i=Gi(yi,"onSelect")).length&&(t=new un("onSelect","select",null,t,n),e.push({event:t,listeners:i}),t.target=gi)))}function bi(e,t){var n={};return n[e.toLowerCase()]=t.toLowerCase(),n["Webkit"+e]="webkit"+t,n["Moz"+e]="moz"+t,n}var xi={animationend:bi("Animation","AnimationEnd"),animationiteration:bi("Animation","AnimationIteration"),animationstart:bi("Animation","AnimationStart"),transitionend:bi("Transition","TransitionEnd")},Si={},Ei={};function Ti(e){if(Si[e])return Si[e];if(!xi[e])return e;var t,n=xi[e];for(t in n)if(n.hasOwnProperty(t)&&t in Ei)return Si[e]=n[t];return e}u&&(Ei=document.createElement("div").style,"AnimationEvent"in window||(delete xi.animationend.animation,delete xi.animationiteration.animation,delete xi.animationstart.animation),"TransitionEvent"in window||delete xi.transitionend.transition);var ki=Ti("animationend"),Ci=Ti("animationiteration"),Ii=Ti("animationstart"),Ai=Ti("transitionend"),Ni=new Map,Oi="abort auxClick cancel canPlay canPlayThrough click close contextMenu copy cut drag dragEnd dragEnter dragExit dragLeave dragOver dragStart drop durationChange emptied encrypted ended error gotPointerCapture input invalid keyDown keyPress keyUp load loadedData loadedMetadata loadStart lostPointerCapture mouseDown mouseMove mouseOut mouseOver mouseUp paste pause play playing pointerCancel pointerDown pointerMove pointerOut pointerOver pointerUp progress rateChange reset resize seeked seeking stalled submit suspend timeUpdate touchCancel touchEnd touchStart volumeChange scroll toggle touchMove waiting wheel".split(" ");function Pi(e,t){Ni.set(e,t),c(t,[e])}for(var Ri=0;Ri<Oi.length;Ri++){var Li=Oi[Ri];Pi(Li.toLowerCase(),"on"+(Li[0].toUpperCase()+Li.slice(1)))}Pi(ki,"onAnimationEnd"),Pi(Ci,"onAnimationIteration"),Pi(Ii,"onAnimationStart"),Pi("dblclick","onDoubleClick"),Pi("focusin","onFocus"),Pi("focusout","onBlur"),Pi(Ai,"onTransitionEnd"),l("onMouseEnter",["mouseout","mouseover"]),l("onMouseLeave",["mouseout","mouseover"]),l("onPointerEnter",["pointerout","pointerover"]),l("onPointerLeave",["pointerout","pointerover"]),c("onChange","change click focusin focusout input keydown keyup selectionchange".split(" ")),c("onSelect","focusout contextmenu dragend focusin keydown keyup mousedown mouseup selectionchange".split(" ")),c("onBeforeInput",["compositionend","keypress","textInput","paste"]),c("onCompositionEnd","compositionend focusout keydown keypress keyup mousedown".split(" ")),c("onCompositionStart","compositionstart focusout keydown keypress keyup mousedown".split(" ")),c("onCompositionUpdate","compositionupdate focusout keydown keypress keyup mousedown".split(" "));var zi="abort canplay canplaythrough durationchange emptied encrypted ended error loadeddata loadedmetadata loadstart pause play playing progress ratechange resize seeked seeking stalled suspend timeupdate volumechange waiting".split(" "),Mi=new Set("cancel close invalid load scroll toggle".split(" ").concat(zi));function Di(e,t,n){var i=e.type||"unknown-event";e.currentTarget=n,function(e,t,n,i,r,a,s,c,l){if(je.apply(this,arguments),Me){if(!Me)throw Error(o(198));var u=De;Me=!1,De=null,Be||(Be=!0,Ue=u)}}(i,t,void 0,e),e.currentTarget=null}function Bi(e,t){t=0!==(4&t);for(var n=0;n<e.length;n++){var i=e[n],r=i.event;i=i.listeners;e:{var o=void 0;if(t)for(var a=i.length-1;0<=a;a--){var s=i[a],c=s.instance,l=s.currentTarget;if(s=s.listener,c!==o&&r.isPropagationStopped())break e;Di(r,s,l),o=c}else for(a=0;a<i.length;a++){if(c=(s=i[a]).instance,l=s.currentTarget,s=s.listener,c!==o&&r.isPropagationStopped())break e;Di(r,s,l),o=c}}}if(Be)throw e=Ue,Be=!1,Ue=null,e}function Ui(e,t){var n=t[mr];void 0===n&&(n=t[mr]=new Set);var i=e+"__bubble";n.has(i)||(qi(t,e,2,!1),n.add(i))}function Fi(e,t,n){var i=0;t&&(i|=4),qi(n,e,i,t)}var ji="_reactListening"+Math.random().toString(36).slice(2);function Vi(e){if(!e[ji]){e[ji]=!0,a.forEach(function(t){"selectionchange"!==t&&(Mi.has(t)||Fi(t,!1,e),Fi(t,!0,e))});var t=9===e.nodeType?e:e.ownerDocument;null===t||t[ji]||(t[ji]=!0,Fi("selectionchange",!1,t))}}function qi(e,t,n,i){switch(Xt(t)){case 1:var r=Wt;break;case 4:r=Gt;break;default:r=Kt}n=r.bind(null,t,n,e),r=void 0,!Re||"touchstart"!==t&&"touchmove"!==t&&"wheel"!==t||(r=!0),i?void 0!==r?e.addEventListener(t,n,{capture:!0,passive:r}):e.addEventListener(t,n,!0):void 0!==r?e.addEventListener(t,n,{passive:r}):e.addEventListener(t,n,!1)}function Hi(e,t,n,i,r){var o=i;if(0===(1&t)&&0===(2&t)&&null!==i)e:for(;;){if(null===i)return;var a=i.tag;if(3===a||4===a){var s=i.stateNode.containerInfo;if(s===r||8===s.nodeType&&s.parentNode===r)break;if(4===a)for(a=i.return;null!==a;){var c=a.tag;if((3===c||4===c)&&((c=a.stateNode.containerInfo)===r||8===c.nodeType&&c.parentNode===r))return;a=a.return}for(;null!==s;){if(null===(a=vr(s)))return;if(5===(c=a.tag)||6===c){i=o=a;continue e}s=s.parentNode}}i=i.return}Oe(function(){var i=o,r=be(n),a=[];e:{var s=Ni.get(e);if(void 0!==s){var c=un,l=e;switch(e){case"keypress":if(0===tn(n))break e;case"keydown":case"keyup":c=Cn;break;case"focusin":l="focus",c=gn;break;case"focusout":l="blur",c=gn;break;case"beforeblur":case"afterblur":c=gn;break;case"click":if(2===n.button)break e;case"auxclick":case"dblclick":case"mousedown":case"mousemove":case"mouseup":case"mouseout":case"mouseover":case"contextmenu":c=pn;break;case"drag":case"dragend":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"dragstart":case"drop":c=mn;break;case"touchcancel":case"touchend":case"touchmove":case"touchstart":c=An;break;case ki:case Ci:case Ii:c=yn;break;case Ai:c=Nn;break;case"scroll":c=hn;break;case"wheel":c=Pn;break;case"copy":case"cut":case"paste":c=_n;break;case"gotpointercapture":case"lostpointercapture":case"pointercancel":case"pointerdown":case"pointermove":case"pointerout":case"pointerover":case"pointerup":c=In}var u=0!==(4&t),d=!u&&"scroll"===e,h=u?null!==s?s+"Capture":null:s;u=[];for(var f,p=i;null!==p;){var m=(f=p).stateNode;if(5===f.tag&&null!==m&&(f=m,null!==h&&(null!=(m=Pe(p,h))&&u.push(Wi(p,m,f)))),d)break;p=p.return}0<u.length&&(s=new c(s,l,null,n,r),a.push({event:s,listeners:u}))}}if(0===(7&t)){if(c="mouseout"===e||"pointerout"===e,(!(s="mouseover"===e||"pointerover"===e)||n===we||!(l=n.relatedTarget||n.fromElement)||!vr(l)&&!l[pr])&&(c||s)&&(s=r.window===r?r:(s=r.ownerDocument)?s.defaultView||s.parentWindow:window,c?(c=i,null!==(l=(l=n.relatedTarget||n.toElement)?vr(l):null)&&(l!==(d=Ve(l))||5!==l.tag&&6!==l.tag)&&(l=null)):(c=null,l=i),c!==l)){if(u=pn,m="onMouseLeave",h="onMouseEnter",p="mouse","pointerout"!==e&&"pointerover"!==e||(u=In,m="onPointerLeave",h="onPointerEnter",p="pointer"),d=null==c?s:wr(c),f=null==l?s:wr(l),(s=new u(m,p+"leave",c,n,r)).target=d,s.relatedTarget=f,m=null,vr(r)===i&&((u=new u(h,p+"enter",l,n,r)).target=f,u.relatedTarget=d,m=u),d=m,c&&l)e:{for(h=l,p=0,f=u=c;f;f=Ki(f))p++;for(f=0,m=h;m;m=Ki(m))f++;for(;0<p-f;)u=Ki(u),p--;for(;0<f-p;)h=Ki(h),f--;for(;p--;){if(u===h||null!==h&&u===h.alternate)break e;u=Ki(u),h=Ki(h)}u=null}else u=null;null!==c&&Zi(a,s,c,u,!1),null!==l&&null!==d&&Zi(a,d,l,u,!0)}if("select"===(c=(s=i?wr(i):window).nodeName&&s.nodeName.toLowerCase())||"input"===c&&"file"===s.type)var g=Xn;else if(Hn(s))if(Yn)g=ai;else{g=ri;var y=ii}else(c=s.nodeName)&&"input"===c.toLowerCase()&&("checkbox"===s.type||"radio"===s.type)&&(g=oi);switch(g&&(g=g(e,i))?Wn(a,g,n,r):(y&&y(e,s,i),"focusout"===e&&(y=s._wrapperState)&&y.controlled&&"number"===s.type&&ee(s,"number",s.value)),y=i?wr(i):window,e){case"focusin":(Hn(y)||"true"===y.contentEditable)&&(gi=y,yi=i,vi=null);break;case"focusout":vi=yi=gi=null;break;case"mousedown":_i=!0;break;case"contextmenu":case"mouseup":case"dragend":_i=!1,wi(a,n,r);break;case"selectionchange":if(mi)break;case"keydown":case"keyup":wi(a,n,r)}var v;if(Ln)e:{switch(e){case"compositionstart":var _="onCompositionStart";break e;case"compositionend":_="onCompositionEnd";break e;case"compositionupdate":_="onCompositionUpdate";break e}_=void 0}else Vn?Fn(e,n)&&(_="onCompositionEnd"):"keydown"===e&&229===n.keyCode&&(_="onCompositionStart");_&&(Dn&&"ko"!==n.locale&&(Vn||"onCompositionStart"!==_?"onCompositionEnd"===_&&Vn&&(v=en()):(Jt="value"in(Yt=r)?Yt.value:Yt.textContent,Vn=!0)),0<(y=Gi(i,_)).length&&(_=new wn(_,e,null,n,r),a.push({event:_,listeners:y}),v?_.data=v:null!==(v=jn(n))&&(_.data=v))),(v=Mn?function(e,t){switch(e){case"compositionend":return jn(t);case"keypress":return 32!==t.which?null:(Un=!0,Bn);case"textInput":return(e=t.data)===Bn&&Un?null:e;default:return null}}(e,n):function(e,t){if(Vn)return"compositionend"===e||!Ln&&Fn(e,t)?(e=en(),$t=Jt=Yt=null,Vn=!1,e):null;switch(e){case"paste":default:return null;case"keypress":if(!(t.ctrlKey||t.altKey||t.metaKey)||t.ctrlKey&&t.altKey){if(t.char&&1<t.char.length)return t.char;if(t.which)return String.fromCharCode(t.which)}return null;case"compositionend":return Dn&&"ko"!==t.locale?null:t.data}}(e,n))&&(0<(i=Gi(i,"onBeforeInput")).length&&(r=new wn("onBeforeInput","beforeinput",null,n,r),a.push({event:r,listeners:i}),r.data=v))}Bi(a,t)})}function Wi(e,t,n){return{instance:e,listener:t,currentTarget:n}}function Gi(e,t){for(var n=t+"Capture",i=[];null!==e;){var r=e,o=r.stateNode;5===r.tag&&null!==o&&(r=o,null!=(o=Pe(e,n))&&i.unshift(Wi(e,o,r)),null!=(o=Pe(e,t))&&i.push(Wi(e,o,r))),e=e.return}return i}function Ki(e){if(null===e)return null;do{e=e.return}while(e&&5!==e.tag);return e||null}function Zi(e,t,n,i,r){for(var o=t._reactName,a=[];null!==n&&n!==i;){var s=n,c=s.alternate,l=s.stateNode;if(null!==c&&c===i)break;5===s.tag&&null!==l&&(s=l,r?null!=(c=Pe(n,o))&&a.unshift(Wi(n,c,s)):r||null!=(c=Pe(n,o))&&a.push(Wi(n,c,s))),n=n.return}0!==a.length&&e.push({event:t,listeners:a})}var Qi=/\r\n?/g,Xi=/\u0000|\uFFFD/g;function Yi(e){return("string"===typeof e?e:""+e).replace(Qi,"\n").replace(Xi,"")}function Ji(e,t,n){if(t=Yi(t),Yi(e)!==t&&n)throw Error(o(425))}function $i(){}var er=null,tr=null;function nr(e,t){return"textarea"===e||"noscript"===e||"string"===typeof t.children||"number"===typeof t.children||"object"===typeof t.dangerouslySetInnerHTML&&null!==t.dangerouslySetInnerHTML&&null!=t.dangerouslySetInnerHTML.__html}var ir="function"===typeof setTimeout?setTimeout:void 0,rr="function"===typeof clearTimeout?clearTimeout:void 0,or="function"===typeof Promise?Promise:void 0,ar="function"===typeof queueMicrotask?queueMicrotask:"undefined"!==typeof or?function(e){return or.resolve(null).then(e).catch(sr)}:ir;function sr(e){setTimeout(function(){throw e})}function cr(e,t){var n=t,i=0;do{var r=n.nextSibling;if(e.removeChild(n),r&&8===r.nodeType)if("/$"===(n=r.data)){if(0===i)return e.removeChild(r),void Vt(t);i--}else"$"!==n&&"$?"!==n&&"$!"!==n||i++;n=r}while(n);Vt(t)}function lr(e){for(;null!=e;e=e.nextSibling){var t=e.nodeType;if(1===t||3===t)break;if(8===t){if("$"===(t=e.data)||"$!"===t||"$?"===t)break;if("/$"===t)return null}}return e}function ur(e){e=e.previousSibling;for(var t=0;e;){if(8===e.nodeType){var n=e.data;if("$"===n||"$!"===n||"$?"===n){if(0===t)return e;t--}else"/$"===n&&t++}e=e.previousSibling}return null}var dr=Math.random().toString(36).slice(2),hr="__reactFiber$"+dr,fr="__reactProps$"+dr,pr="__reactContainer$"+dr,mr="__reactEvents$"+dr,gr="__reactListeners$"+dr,yr="__reactHandles$"+dr;function vr(e){var t=e[hr];if(t)return t;for(var n=e.parentNode;n;){if(t=n[pr]||n[hr]){if(n=t.alternate,null!==t.child||null!==n&&null!==n.child)for(e=ur(e);null!==e;){if(n=e[hr])return n;e=ur(e)}return t}n=(e=n).parentNode}return null}function _r(e){return!(e=e[hr]||e[pr])||5!==e.tag&&6!==e.tag&&13!==e.tag&&3!==e.tag?null:e}function wr(e){if(5===e.tag||6===e.tag)return e.stateNode;throw Error(o(33))}function br(e){return e[fr]||null}var xr=[],Sr=-1;function Er(e){return{current:e}}function Tr(e){0>Sr||(e.current=xr[Sr],xr[Sr]=null,Sr--)}function kr(e,t){Sr++,xr[Sr]=e.current,e.current=t}var Cr={},Ir=Er(Cr),Ar=Er(!1),Nr=Cr;function Or(e,t){var n=e.type.contextTypes;if(!n)return Cr;var i=e.stateNode;if(i&&i.__reactInternalMemoizedUnmaskedChildContext===t)return i.__reactInternalMemoizedMaskedChildContext;var r,o={};for(r in n)o[r]=t[r];return i&&((e=e.stateNode).__reactInternalMemoizedUnmaskedChildContext=t,e.__reactInternalMemoizedMaskedChildContext=o),o}function Pr(e){return null!==(e=e.childContextTypes)&&void 0!==e}function Rr(){Tr(Ar),Tr(Ir)}function Lr(e,t,n){if(Ir.current!==Cr)throw Error(o(168));kr(Ir,t),kr(Ar,n)}function zr(e,t,n){var i=e.stateNode;if(t=t.childContextTypes,"function"!==typeof i.getChildContext)return n;for(var r in i=i.getChildContext())if(!(r in t))throw Error(o(108,q(e)||"Unknown",r));return D({},n,i)}function Mr(e){return e=(e=e.stateNode)&&e.__reactInternalMemoizedMergedChildContext||Cr,Nr=Ir.current,kr(Ir,e),kr(Ar,Ar.current),!0}function Dr(e,t,n){var i=e.stateNode;if(!i)throw Error(o(169));n?(e=zr(e,t,Nr),i.__reactInternalMemoizedMergedChildContext=e,Tr(Ar),Tr(Ir),kr(Ir,e)):Tr(Ar),kr(Ar,n)}var Br=null,Ur=!1,Fr=!1;function jr(e){null===Br?Br=[e]:Br.push(e)}function Vr(){if(!Fr&&null!==Br){Fr=!0;var e=0,t=_t;try{var n=Br;for(_t=1;e<n.length;e++){var i=n[e];do{i=i(!0)}while(null!==i)}Br=null,Ur=!1}catch(r){throw null!==Br&&(Br=Br.slice(e+1)),Ke($e,Vr),r}finally{_t=t,Fr=!1}}return null}var qr=[],Hr=0,Wr=null,Gr=0,Kr=[],Zr=0,Qr=null,Xr=1,Yr="";function Jr(e,t){qr[Hr++]=Gr,qr[Hr++]=Wr,Wr=e,Gr=t}function $r(e,t,n){Kr[Zr++]=Xr,Kr[Zr++]=Yr,Kr[Zr++]=Qr,Qr=e;var i=Xr;e=Yr;var r=32-at(i)-1;i&=~(1<<r),n+=1;var o=32-at(t)+r;if(30<o){var a=r-r%5;o=(i&(1<<a)-1).toString(32),i>>=a,r-=a,Xr=1<<32-at(t)+r|n<<r|i,Yr=o+e}else Xr=1<<o|n<<r|i,Yr=e}function eo(e){null!==e.return&&(Jr(e,1),$r(e,1,0))}function to(e){for(;e===Wr;)Wr=qr[--Hr],qr[Hr]=null,Gr=qr[--Hr],qr[Hr]=null;for(;e===Qr;)Qr=Kr[--Zr],Kr[Zr]=null,Yr=Kr[--Zr],Kr[Zr]=null,Xr=Kr[--Zr],Kr[Zr]=null}var no=null,io=null,ro=!1,oo=null;function ao(e,t){var n=Ol(5,null,null,0);n.elementType="DELETED",n.stateNode=t,n.return=e,null===(t=e.deletions)?(e.deletions=[n],e.flags|=16):t.push(n)}function so(e,t){switch(e.tag){case 5:var n=e.type;return null!==(t=1!==t.nodeType||n.toLowerCase()!==t.nodeName.toLowerCase()?null:t)&&(e.stateNode=t,no=e,io=lr(t.firstChild),!0);case 6:return null!==(t=""===e.pendingProps||3!==t.nodeType?null:t)&&(e.stateNode=t,no=e,io=null,!0);case 13:return null!==(t=8!==t.nodeType?null:t)&&(n=null!==Qr?{id:Xr,overflow:Yr}:null,e.memoizedState={dehydrated:t,treeContext:n,retryLane:1073741824},(n=Ol(18,null,null,0)).stateNode=t,n.return=e,e.child=n,no=e,io=null,!0);default:return!1}}function co(e){return 0!==(1&e.mode)&&0===(128&e.flags)}function lo(e){if(ro){var t=io;if(t){var n=t;if(!so(e,t)){if(co(e))throw Error(o(418));t=lr(n.nextSibling);var i=no;t&&so(e,t)?ao(i,n):(e.flags=-4097&e.flags|2,ro=!1,no=e)}}else{if(co(e))throw Error(o(418));e.flags=-4097&e.flags|2,ro=!1,no=e}}}function uo(e){for(e=e.return;null!==e&&5!==e.tag&&3!==e.tag&&13!==e.tag;)e=e.return;no=e}function ho(e){if(e!==no)return!1;if(!ro)return uo(e),ro=!0,!1;var t;if((t=3!==e.tag)&&!(t=5!==e.tag)&&(t="head"!==(t=e.type)&&"body"!==t&&!nr(e.type,e.memoizedProps)),t&&(t=io)){if(co(e))throw fo(),Error(o(418));for(;t;)ao(e,t),t=lr(t.nextSibling)}if(uo(e),13===e.tag){if(!(e=null!==(e=e.memoizedState)?e.dehydrated:null))throw Error(o(317));e:{for(e=e.nextSibling,t=0;e;){if(8===e.nodeType){var n=e.data;if("/$"===n){if(0===t){io=lr(e.nextSibling);break e}t--}else"$"!==n&&"$!"!==n&&"$?"!==n||t++}e=e.nextSibling}io=null}}else io=no?lr(e.stateNode.nextSibling):null;return!0}function fo(){for(var e=io;e;)e=lr(e.nextSibling)}function po(){io=no=null,ro=!1}function mo(e){null===oo?oo=[e]:oo.push(e)}var go=w.ReactCurrentBatchConfig;function yo(e,t,n){if(null!==(e=n.ref)&&"function"!==typeof e&&"object"!==typeof e){if(n._owner){if(n=n._owner){if(1!==n.tag)throw Error(o(309));var i=n.stateNode}if(!i)throw Error(o(147,e));var r=i,a=""+e;return null!==t&&null!==t.ref&&"function"===typeof t.ref&&t.ref._stringRef===a?t.ref:(t=function(e){var t=r.refs;null===e?delete t[a]:t[a]=e},t._stringRef=a,t)}if("string"!==typeof e)throw Error(o(284));if(!n._owner)throw Error(o(290,e))}return e}function vo(e,t){throw e=Object.prototype.toString.call(t),Error(o(31,"[object Object]"===e?"object with keys {"+Object.keys(t).join(", ")+"}":e))}function _o(e){return(0,e._init)(e._payload)}function wo(e){function t(t,n){if(e){var i=t.deletions;null===i?(t.deletions=[n],t.flags|=16):i.push(n)}}function n(n,i){if(!e)return null;for(;null!==i;)t(n,i),i=i.sibling;return null}function i(e,t){for(e=new Map;null!==t;)null!==t.key?e.set(t.key,t):e.set(t.index,t),t=t.sibling;return e}function r(e,t){return(e=Rl(e,t)).index=0,e.sibling=null,e}function a(t,n,i){return t.index=i,e?null!==(i=t.alternate)?(i=i.index)<n?(t.flags|=2,n):i:(t.flags|=2,n):(t.flags|=1048576,n)}function s(t){return e&&null===t.alternate&&(t.flags|=2),t}function c(e,t,n,i){return null===t||6!==t.tag?((t=Dl(n,e.mode,i)).return=e,t):((t=r(t,n)).return=e,t)}function l(e,t,n,i){var o=n.type;return o===S?d(e,t,n.props.children,i,n.key):null!==t&&(t.elementType===o||"object"===typeof o&&null!==o&&o.$$typeof===P&&_o(o)===t.type)?((i=r(t,n.props)).ref=yo(e,t,n),i.return=e,i):((i=Ll(n.type,n.key,n.props,null,e.mode,i)).ref=yo(e,t,n),i.return=e,i)}function u(e,t,n,i){return null===t||4!==t.tag||t.stateNode.containerInfo!==n.containerInfo||t.stateNode.implementation!==n.implementation?((t=Bl(n,e.mode,i)).return=e,t):((t=r(t,n.children||[])).return=e,t)}function d(e,t,n,i,o){return null===t||7!==t.tag?((t=zl(n,e.mode,i,o)).return=e,t):((t=r(t,n)).return=e,t)}function h(e,t,n){if("string"===typeof t&&""!==t||"number"===typeof t)return(t=Dl(""+t,e.mode,n)).return=e,t;if("object"===typeof t&&null!==t){switch(t.$$typeof){case b:return(n=Ll(t.type,t.key,t.props,null,e.mode,n)).ref=yo(e,null,t),n.return=e,n;case x:return(t=Bl(t,e.mode,n)).return=e,t;case P:return h(e,(0,t._init)(t._payload),n)}if(te(t)||z(t))return(t=zl(t,e.mode,n,null)).return=e,t;vo(e,t)}return null}function f(e,t,n,i){var r=null!==t?t.key:null;if("string"===typeof n&&""!==n||"number"===typeof n)return null!==r?null:c(e,t,""+n,i);if("object"===typeof n&&null!==n){switch(n.$$typeof){case b:return n.key===r?l(e,t,n,i):null;case x:return n.key===r?u(e,t,n,i):null;case P:return f(e,t,(r=n._init)(n._payload),i)}if(te(n)||z(n))return null!==r?null:d(e,t,n,i,null);vo(e,n)}return null}function p(e,t,n,i,r){if("string"===typeof i&&""!==i||"number"===typeof i)return c(t,e=e.get(n)||null,""+i,r);if("object"===typeof i&&null!==i){switch(i.$$typeof){case b:return l(t,e=e.get(null===i.key?n:i.key)||null,i,r);case x:return u(t,e=e.get(null===i.key?n:i.key)||null,i,r);case P:return p(e,t,n,(0,i._init)(i._payload),r)}if(te(i)||z(i))return d(t,e=e.get(n)||null,i,r,null);vo(t,i)}return null}function m(r,o,s,c){for(var l=null,u=null,d=o,m=o=0,g=null;null!==d&&m<s.length;m++){d.index>m?(g=d,d=null):g=d.sibling;var y=f(r,d,s[m],c);if(null===y){null===d&&(d=g);break}e&&d&&null===y.alternate&&t(r,d),o=a(y,o,m),null===u?l=y:u.sibling=y,u=y,d=g}if(m===s.length)return n(r,d),ro&&Jr(r,m),l;if(null===d){for(;m<s.length;m++)null!==(d=h(r,s[m],c))&&(o=a(d,o,m),null===u?l=d:u.sibling=d,u=d);return ro&&Jr(r,m),l}for(d=i(r,d);m<s.length;m++)null!==(g=p(d,r,m,s[m],c))&&(e&&null!==g.alternate&&d.delete(null===g.key?m:g.key),o=a(g,o,m),null===u?l=g:u.sibling=g,u=g);return e&&d.forEach(function(e){return t(r,e)}),ro&&Jr(r,m),l}function g(r,s,c,l){var u=z(c);if("function"!==typeof u)throw Error(o(150));if(null==(c=u.call(c)))throw Error(o(151));for(var d=u=null,m=s,g=s=0,y=null,v=c.next();null!==m&&!v.done;g++,v=c.next()){m.index>g?(y=m,m=null):y=m.sibling;var _=f(r,m,v.value,l);if(null===_){null===m&&(m=y);break}e&&m&&null===_.alternate&&t(r,m),s=a(_,s,g),null===d?u=_:d.sibling=_,d=_,m=y}if(v.done)return n(r,m),ro&&Jr(r,g),u;if(null===m){for(;!v.done;g++,v=c.next())null!==(v=h(r,v.value,l))&&(s=a(v,s,g),null===d?u=v:d.sibling=v,d=v);return ro&&Jr(r,g),u}for(m=i(r,m);!v.done;g++,v=c.next())null!==(v=p(m,r,g,v.value,l))&&(e&&null!==v.alternate&&m.delete(null===v.key?g:v.key),s=a(v,s,g),null===d?u=v:d.sibling=v,d=v);return e&&m.forEach(function(e){return t(r,e)}),ro&&Jr(r,g),u}return function e(i,o,a,c){if("object"===typeof a&&null!==a&&a.type===S&&null===a.key&&(a=a.props.children),"object"===typeof a&&null!==a){switch(a.$$typeof){case b:e:{for(var l=a.key,u=o;null!==u;){if(u.key===l){if((l=a.type)===S){if(7===u.tag){n(i,u.sibling),(o=r(u,a.props.children)).return=i,i=o;break e}}else if(u.elementType===l||"object"===typeof l&&null!==l&&l.$$typeof===P&&_o(l)===u.type){n(i,u.sibling),(o=r(u,a.props)).ref=yo(i,u,a),o.return=i,i=o;break e}n(i,u);break}t(i,u),u=u.sibling}a.type===S?((o=zl(a.props.children,i.mode,c,a.key)).return=i,i=o):((c=Ll(a.type,a.key,a.props,null,i.mode,c)).ref=yo(i,o,a),c.return=i,i=c)}return s(i);case x:e:{for(u=a.key;null!==o;){if(o.key===u){if(4===o.tag&&o.stateNode.containerInfo===a.containerInfo&&o.stateNode.implementation===a.implementation){n(i,o.sibling),(o=r(o,a.children||[])).return=i,i=o;break e}n(i,o);break}t(i,o),o=o.sibling}(o=Bl(a,i.mode,c)).return=i,i=o}return s(i);case P:return e(i,o,(u=a._init)(a._payload),c)}if(te(a))return m(i,o,a,c);if(z(a))return g(i,o,a,c);vo(i,a)}return"string"===typeof a&&""!==a||"number"===typeof a?(a=""+a,null!==o&&6===o.tag?(n(i,o.sibling),(o=r(o,a)).return=i,i=o):(n(i,o),(o=Dl(a,i.mode,c)).return=i,i=o),s(i)):n(i,o)}}var bo=wo(!0),xo=wo(!1),So=Er(null),Eo=null,To=null,ko=null;function Co(){ko=To=Eo=null}function Io(e){var t=So.current;Tr(So),e._currentValue=t}function Ao(e,t,n){for(;null!==e;){var i=e.alternate;if((e.childLanes&t)!==t?(e.childLanes|=t,null!==i&&(i.childLanes|=t)):null!==i&&(i.childLanes&t)!==t&&(i.childLanes|=t),e===n)break;e=e.return}}function No(e,t){Eo=e,ko=To=null,null!==(e=e.dependencies)&&null!==e.firstContext&&(0!==(e.lanes&t)&&(_s=!0),e.firstContext=null)}function Oo(e){var t=e._currentValue;if(ko!==e)if(e={context:e,memoizedValue:t,next:null},null===To){if(null===Eo)throw Error(o(308));To=e,Eo.dependencies={lanes:0,firstContext:e}}else To=To.next=e;return t}var Po=null;function Ro(e){null===Po?Po=[e]:Po.push(e)}function Lo(e,t,n,i){var r=t.interleaved;return null===r?(n.next=n,Ro(t)):(n.next=r.next,r.next=n),t.interleaved=n,zo(e,i)}function zo(e,t){e.lanes|=t;var n=e.alternate;for(null!==n&&(n.lanes|=t),n=e,e=e.return;null!==e;)e.childLanes|=t,null!==(n=e.alternate)&&(n.childLanes|=t),n=e,e=e.return;return 3===n.tag?n.stateNode:null}var Mo=!1;function Do(e){e.updateQueue={baseState:e.memoizedState,firstBaseUpdate:null,lastBaseUpdate:null,shared:{pending:null,interleaved:null,lanes:0},effects:null}}function Bo(e,t){e=e.updateQueue,t.updateQueue===e&&(t.updateQueue={baseState:e.baseState,firstBaseUpdate:e.firstBaseUpdate,lastBaseUpdate:e.lastBaseUpdate,shared:e.shared,effects:e.effects})}function Uo(e,t){return{eventTime:e,lane:t,tag:0,payload:null,callback:null,next:null}}function Fo(e,t,n){var i=e.updateQueue;if(null===i)return null;if(i=i.shared,0!==(2&Ic)){var r=i.pending;return null===r?t.next=t:(t.next=r.next,r.next=t),i.pending=t,zo(e,n)}return null===(r=i.interleaved)?(t.next=t,Ro(i)):(t.next=r.next,r.next=t),i.interleaved=t,zo(e,n)}function jo(e,t,n){if(null!==(t=t.updateQueue)&&(t=t.shared,0!==(4194240&n))){var i=t.lanes;n|=i&=e.pendingLanes,t.lanes=n,vt(e,n)}}function Vo(e,t){var n=e.updateQueue,i=e.alternate;if(null!==i&&n===(i=i.updateQueue)){var r=null,o=null;if(null!==(n=n.firstBaseUpdate)){do{var a={eventTime:n.eventTime,lane:n.lane,tag:n.tag,payload:n.payload,callback:n.callback,next:null};null===o?r=o=a:o=o.next=a,n=n.next}while(null!==n);null===o?r=o=t:o=o.next=t}else r=o=t;return n={baseState:i.baseState,firstBaseUpdate:r,lastBaseUpdate:o,shared:i.shared,effects:i.effects},void(e.updateQueue=n)}null===(e=n.lastBaseUpdate)?n.firstBaseUpdate=t:e.next=t,n.lastBaseUpdate=t}function qo(e,t,n,i){var r=e.updateQueue;Mo=!1;var o=r.firstBaseUpdate,a=r.lastBaseUpdate,s=r.shared.pending;if(null!==s){r.shared.pending=null;var c=s,l=c.next;c.next=null,null===a?o=l:a.next=l,a=c;var u=e.alternate;null!==u&&((s=(u=u.updateQueue).lastBaseUpdate)!==a&&(null===s?u.firstBaseUpdate=l:s.next=l,u.lastBaseUpdate=c))}if(null!==o){var d=r.baseState;for(a=0,u=l=c=null,s=o;;){var h=s.lane,f=s.eventTime;if((i&h)===h){null!==u&&(u=u.next={eventTime:f,lane:0,tag:s.tag,payload:s.payload,callback:s.callback,next:null});e:{var p=e,m=s;switch(h=t,f=n,m.tag){case 1:if("function"===typeof(p=m.payload)){d=p.call(f,d,h);break e}d=p;break e;case 3:p.flags=-65537&p.flags|128;case 0:if(null===(h="function"===typeof(p=m.payload)?p.call(f,d,h):p)||void 0===h)break e;d=D({},d,h);break e;case 2:Mo=!0}}null!==s.callback&&0!==s.lane&&(e.flags|=64,null===(h=r.effects)?r.effects=[s]:h.push(s))}else f={eventTime:f,lane:h,tag:s.tag,payload:s.payload,callback:s.callback,next:null},null===u?(l=u=f,c=d):u=u.next=f,a|=h;if(null===(s=s.next)){if(null===(s=r.shared.pending))break;s=(h=s).next,h.next=null,r.lastBaseUpdate=h,r.shared.pending=null}}if(null===u&&(c=d),r.baseState=c,r.firstBaseUpdate=l,r.lastBaseUpdate=u,null!==(t=r.shared.interleaved)){r=t;do{a|=r.lane,r=r.next}while(r!==t)}else null===o&&(r.shared.lanes=0);Mc|=a,e.lanes=a,e.memoizedState=d}}function Ho(e,t,n){if(e=t.effects,t.effects=null,null!==e)for(t=0;t<e.length;t++){var i=e[t],r=i.callback;if(null!==r){if(i.callback=null,i=n,"function"!==typeof r)throw Error(o(191,r));r.call(i)}}}var Wo={},Go=Er(Wo),Ko=Er(Wo),Zo=Er(Wo);function Qo(e){if(e===Wo)throw Error(o(174));return e}function Xo(e,t){switch(kr(Zo,t),kr(Ko,e),kr(Go,Wo),e=t.nodeType){case 9:case 11:t=(t=t.documentElement)?t.namespaceURI:ce(null,"");break;default:t=ce(t=(e=8===e?t.parentNode:t).namespaceURI||null,e=e.tagName)}Tr(Go),kr(Go,t)}function Yo(){Tr(Go),Tr(Ko),Tr(Zo)}function Jo(e){Qo(Zo.current);var t=Qo(Go.current),n=ce(t,e.type);t!==n&&(kr(Ko,e),kr(Go,n))}function $o(e){Ko.current===e&&(Tr(Go),Tr(Ko))}var ea=Er(0);function ta(e){for(var t=e;null!==t;){if(13===t.tag){var n=t.memoizedState;if(null!==n&&(null===(n=n.dehydrated)||"$?"===n.data||"$!"===n.data))return t}else if(19===t.tag&&void 0!==t.memoizedProps.revealOrder){if(0!==(128&t.flags))return t}else if(null!==t.child){t.child.return=t,t=t.child;continue}if(t===e)break;for(;null===t.sibling;){if(null===t.return||t.return===e)return null;t=t.return}t.sibling.return=t.return,t=t.sibling}return null}var na=[];function ia(){for(var e=0;e<na.length;e++)na[e]._workInProgressVersionPrimary=null;na.length=0}var ra=w.ReactCurrentDispatcher,oa=w.ReactCurrentBatchConfig,aa=0,sa=null,ca=null,la=null,ua=!1,da=!1,ha=0,fa=0;function pa(){throw Error(o(321))}function ma(e,t){if(null===t)return!1;for(var n=0;n<t.length&&n<e.length;n++)if(!si(e[n],t[n]))return!1;return!0}function ga(e,t,n,i,r,a){if(aa=a,sa=t,t.memoizedState=null,t.updateQueue=null,t.lanes=0,ra.current=null===e||null===e.memoizedState?$a:es,e=n(i,r),da){a=0;do{if(da=!1,ha=0,25<=a)throw Error(o(301));a+=1,la=ca=null,t.updateQueue=null,ra.current=ts,e=n(i,r)}while(da)}if(ra.current=Ja,t=null!==ca&&null!==ca.next,aa=0,la=ca=sa=null,ua=!1,t)throw Error(o(300));return e}function ya(){var e=0!==ha;return ha=0,e}function va(){var e={memoizedState:null,baseState:null,baseQueue:null,queue:null,next:null};return null===la?sa.memoizedState=la=e:la=la.next=e,la}function _a(){if(null===ca){var e=sa.alternate;e=null!==e?e.memoizedState:null}else e=ca.next;var t=null===la?sa.memoizedState:la.next;if(null!==t)la=t,ca=e;else{if(null===e)throw Error(o(310));e={memoizedState:(ca=e).memoizedState,baseState:ca.baseState,baseQueue:ca.baseQueue,queue:ca.queue,next:null},null===la?sa.memoizedState=la=e:la=la.next=e}return la}function wa(e,t){return"function"===typeof t?t(e):t}function ba(e){var t=_a(),n=t.queue;if(null===n)throw Error(o(311));n.lastRenderedReducer=e;var i=ca,r=i.baseQueue,a=n.pending;if(null!==a){if(null!==r){var s=r.next;r.next=a.next,a.next=s}i.baseQueue=r=a,n.pending=null}if(null!==r){a=r.next,i=i.baseState;var c=s=null,l=null,u=a;do{var d=u.lane;if((aa&d)===d)null!==l&&(l=l.next={lane:0,action:u.action,hasEagerState:u.hasEagerState,eagerState:u.eagerState,next:null}),i=u.hasEagerState?u.eagerState:e(i,u.action);else{var h={lane:d,action:u.action,hasEagerState:u.hasEagerState,eagerState:u.eagerState,next:null};null===l?(c=l=h,s=i):l=l.next=h,sa.lanes|=d,Mc|=d}u=u.next}while(null!==u&&u!==a);null===l?s=i:l.next=c,si(i,t.memoizedState)||(_s=!0),t.memoizedState=i,t.baseState=s,t.baseQueue=l,n.lastRenderedState=i}if(null!==(e=n.interleaved)){r=e;do{a=r.lane,sa.lanes|=a,Mc|=a,r=r.next}while(r!==e)}else null===r&&(n.lanes=0);return[t.memoizedState,n.dispatch]}function xa(e){var t=_a(),n=t.queue;if(null===n)throw Error(o(311));n.lastRenderedReducer=e;var i=n.dispatch,r=n.pending,a=t.memoizedState;if(null!==r){n.pending=null;var s=r=r.next;do{a=e(a,s.action),s=s.next}while(s!==r);si(a,t.memoizedState)||(_s=!0),t.memoizedState=a,null===t.baseQueue&&(t.baseState=a),n.lastRenderedState=a}return[a,i]}function Sa(){}function Ea(e,t){var n=sa,i=_a(),r=t(),a=!si(i.memoizedState,r);if(a&&(i.memoizedState=r,_s=!0),i=i.queue,Ma(Ca.bind(null,n,i,e),[e]),i.getSnapshot!==t||a||null!==la&&1&la.memoizedState.tag){if(n.flags|=2048,Oa(9,ka.bind(null,n,i,r,t),void 0,null),null===Ac)throw Error(o(349));0!==(30&aa)||Ta(n,t,r)}return r}function Ta(e,t,n){e.flags|=16384,e={getSnapshot:t,value:n},null===(t=sa.updateQueue)?(t={lastEffect:null,stores:null},sa.updateQueue=t,t.stores=[e]):null===(n=t.stores)?t.stores=[e]:n.push(e)}function ka(e,t,n,i){t.value=n,t.getSnapshot=i,Ia(t)&&Aa(e)}function Ca(e,t,n){return n(function(){Ia(t)&&Aa(e)})}function Ia(e){var t=e.getSnapshot;e=e.value;try{var n=t();return!si(e,n)}catch(i){return!0}}function Aa(e){var t=zo(e,1);null!==t&&nl(t,e,1,-1)}function Na(e){var t=va();return"function"===typeof e&&(e=e()),t.memoizedState=t.baseState=e,e={pending:null,interleaved:null,lanes:0,dispatch:null,lastRenderedReducer:wa,lastRenderedState:e},t.queue=e,e=e.dispatch=Za.bind(null,sa,e),[t.memoizedState,e]}function Oa(e,t,n,i){return e={tag:e,create:t,destroy:n,deps:i,next:null},null===(t=sa.updateQueue)?(t={lastEffect:null,stores:null},sa.updateQueue=t,t.lastEffect=e.next=e):null===(n=t.lastEffect)?t.lastEffect=e.next=e:(i=n.next,n.next=e,e.next=i,t.lastEffect=e),e}function Pa(){return _a().memoizedState}function Ra(e,t,n,i){var r=va();sa.flags|=e,r.memoizedState=Oa(1|t,n,void 0,void 0===i?null:i)}function La(e,t,n,i){var r=_a();i=void 0===i?null:i;var o=void 0;if(null!==ca){var a=ca.memoizedState;if(o=a.destroy,null!==i&&ma(i,a.deps))return void(r.memoizedState=Oa(t,n,o,i))}sa.flags|=e,r.memoizedState=Oa(1|t,n,o,i)}function za(e,t){return Ra(8390656,8,e,t)}function Ma(e,t){return La(2048,8,e,t)}function Da(e,t){return La(4,2,e,t)}function Ba(e,t){return La(4,4,e,t)}function Ua(e,t){return"function"===typeof t?(e=e(),t(e),function(){t(null)}):null!==t&&void 0!==t?(e=e(),t.current=e,function(){t.current=null}):void 0}function Fa(e,t,n){return n=null!==n&&void 0!==n?n.concat([e]):null,La(4,4,Ua.bind(null,t,e),n)}function ja(){}function Va(e,t){var n=_a();t=void 0===t?null:t;var i=n.memoizedState;return null!==i&&null!==t&&ma(t,i[1])?i[0]:(n.memoizedState=[e,t],e)}function qa(e,t){var n=_a();t=void 0===t?null:t;var i=n.memoizedState;return null!==i&&null!==t&&ma(t,i[1])?i[0]:(e=e(),n.memoizedState=[e,t],e)}function Ha(e,t,n){return 0===(21&aa)?(e.baseState&&(e.baseState=!1,_s=!0),e.memoizedState=n):(si(n,t)||(n=mt(),sa.lanes|=n,Mc|=n,e.baseState=!0),t)}function Wa(e,t){var n=_t;_t=0!==n&&4>n?n:4,e(!0);var i=oa.transition;oa.transition={};try{e(!1),t()}finally{_t=n,oa.transition=i}}function Ga(){return _a().memoizedState}function Ka(e,t,n){var i=tl(e);if(n={lane:i,action:n,hasEagerState:!1,eagerState:null,next:null},Qa(e))Xa(t,n);else if(null!==(n=Lo(e,t,n,i))){nl(n,e,i,el()),Ya(n,t,i)}}function Za(e,t,n){var i=tl(e),r={lane:i,action:n,hasEagerState:!1,eagerState:null,next:null};if(Qa(e))Xa(t,r);else{var o=e.alternate;if(0===e.lanes&&(null===o||0===o.lanes)&&null!==(o=t.lastRenderedReducer))try{var a=t.lastRenderedState,s=o(a,n);if(r.hasEagerState=!0,r.eagerState=s,si(s,a)){var c=t.interleaved;return null===c?(r.next=r,Ro(t)):(r.next=c.next,c.next=r),void(t.interleaved=r)}}catch(l){}null!==(n=Lo(e,t,r,i))&&(nl(n,e,i,r=el()),Ya(n,t,i))}}function Qa(e){var t=e.alternate;return e===sa||null!==t&&t===sa}function Xa(e,t){da=ua=!0;var n=e.pending;null===n?t.next=t:(t.next=n.next,n.next=t),e.pending=t}function Ya(e,t,n){if(0!==(4194240&n)){var i=t.lanes;n|=i&=e.pendingLanes,t.lanes=n,vt(e,n)}}var Ja={readContext:Oo,useCallback:pa,useContext:pa,useEffect:pa,useImperativeHandle:pa,useInsertionEffect:pa,useLayoutEffect:pa,useMemo:pa,useReducer:pa,useRef:pa,useState:pa,useDebugValue:pa,useDeferredValue:pa,useTransition:pa,useMutableSource:pa,useSyncExternalStore:pa,useId:pa,unstable_isNewReconciler:!1},$a={readContext:Oo,useCallback:function(e,t){return va().memoizedState=[e,void 0===t?null:t],e},useContext:Oo,useEffect:za,useImperativeHandle:function(e,t,n){return n=null!==n&&void 0!==n?n.concat([e]):null,Ra(4194308,4,Ua.bind(null,t,e),n)},useLayoutEffect:function(e,t){return Ra(4194308,4,e,t)},useInsertionEffect:function(e,t){return Ra(4,2,e,t)},useMemo:function(e,t){var n=va();return t=void 0===t?null:t,e=e(),n.memoizedState=[e,t],e},useReducer:function(e,t,n){var i=va();return t=void 0!==n?n(t):t,i.memoizedState=i.baseState=t,e={pending:null,interleaved:null,lanes:0,dispatch:null,lastRenderedReducer:e,lastRenderedState:t},i.queue=e,e=e.dispatch=Ka.bind(null,sa,e),[i.memoizedState,e]},useRef:function(e){return e={current:e},va().memoizedState=e},useState:Na,useDebugValue:ja,useDeferredValue:function(e){return va().memoizedState=e},useTransition:function(){var e=Na(!1),t=e[0];return e=Wa.bind(null,e[1]),va().memoizedState=e,[t,e]},useMutableSource:function(){},useSyncExternalStore:function(e,t,n){var i=sa,r=va();if(ro){if(void 0===n)throw Error(o(407));n=n()}else{if(n=t(),null===Ac)throw Error(o(349));0!==(30&aa)||Ta(i,t,n)}r.memoizedState=n;var a={value:n,getSnapshot:t};return r.queue=a,za(Ca.bind(null,i,a,e),[e]),i.flags|=2048,Oa(9,ka.bind(null,i,a,n,t),void 0,null),n},useId:function(){var e=va(),t=Ac.identifierPrefix;if(ro){var n=Yr;t=":"+t+"R"+(n=(Xr&~(1<<32-at(Xr)-1)).toString(32)+n),0<(n=ha++)&&(t+="H"+n.toString(32)),t+=":"}else t=":"+t+"r"+(n=fa++).toString(32)+":";return e.memoizedState=t},unstable_isNewReconciler:!1},es={readContext:Oo,useCallback:Va,useContext:Oo,useEffect:Ma,useImperativeHandle:Fa,useInsertionEffect:Da,useLayoutEffect:Ba,useMemo:qa,useReducer:ba,useRef:Pa,useState:function(){return ba(wa)},useDebugValue:ja,useDeferredValue:function(e){return Ha(_a(),ca.memoizedState,e)},useTransition:function(){return[ba(wa)[0],_a().memoizedState]},useMutableSource:Sa,useSyncExternalStore:Ea,useId:Ga,unstable_isNewReconciler:!1},ts={readContext:Oo,useCallback:Va,useContext:Oo,useEffect:Ma,useImperativeHandle:Fa,useInsertionEffect:Da,useLayoutEffect:Ba,useMemo:qa,useReducer:xa,useRef:Pa,useState:function(){return xa(wa)},useDebugValue:ja,useDeferredValue:function(e){var t=_a();return null===ca?t.memoizedState=e:Ha(t,ca.memoizedState,e)},useTransition:function(){return[xa(wa)[0],_a().memoizedState]},useMutableSource:Sa,useSyncExternalStore:Ea,useId:Ga,unstable_isNewReconciler:!1};function ns(e,t){if(e&&e.defaultProps){for(var n in t=D({},t),e=e.defaultProps)void 0===t[n]&&(t[n]=e[n]);return t}return t}function is(e,t,n,i){n=null===(n=n(i,t=e.memoizedState))||void 0===n?t:D({},t,n),e.memoizedState=n,0===e.lanes&&(e.updateQueue.baseState=n)}var rs={isMounted:function(e){return!!(e=e._reactInternals)&&Ve(e)===e},enqueueSetState:function(e,t,n){e=e._reactInternals;var i=el(),r=tl(e),o=Uo(i,r);o.payload=t,void 0!==n&&null!==n&&(o.callback=n),null!==(t=Fo(e,o,r))&&(nl(t,e,r,i),jo(t,e,r))},enqueueReplaceState:function(e,t,n){e=e._reactInternals;var i=el(),r=tl(e),o=Uo(i,r);o.tag=1,o.payload=t,void 0!==n&&null!==n&&(o.callback=n),null!==(t=Fo(e,o,r))&&(nl(t,e,r,i),jo(t,e,r))},enqueueForceUpdate:function(e,t){e=e._reactInternals;var n=el(),i=tl(e),r=Uo(n,i);r.tag=2,void 0!==t&&null!==t&&(r.callback=t),null!==(t=Fo(e,r,i))&&(nl(t,e,i,n),jo(t,e,i))}};function os(e,t,n,i,r,o,a){return"function"===typeof(e=e.stateNode).shouldComponentUpdate?e.shouldComponentUpdate(i,o,a):!t.prototype||!t.prototype.isPureReactComponent||(!ci(n,i)||!ci(r,o))}function as(e,t,n){var i=!1,r=Cr,o=t.contextType;return"object"===typeof o&&null!==o?o=Oo(o):(r=Pr(t)?Nr:Ir.current,o=(i=null!==(i=t.contextTypes)&&void 0!==i)?Or(e,r):Cr),t=new t(n,o),e.memoizedState=null!==t.state&&void 0!==t.state?t.state:null,t.updater=rs,e.stateNode=t,t._reactInternals=e,i&&((e=e.stateNode).__reactInternalMemoizedUnmaskedChildContext=r,e.__reactInternalMemoizedMaskedChildContext=o),t}function ss(e,t,n,i){e=t.state,"function"===typeof t.componentWillReceiveProps&&t.componentWillReceiveProps(n,i),"function"===typeof t.UNSAFE_componentWillReceiveProps&&t.UNSAFE_componentWillReceiveProps(n,i),t.state!==e&&rs.enqueueReplaceState(t,t.state,null)}function cs(e,t,n,i){var r=e.stateNode;r.props=n,r.state=e.memoizedState,r.refs={},Do(e);var o=t.contextType;"object"===typeof o&&null!==o?r.context=Oo(o):(o=Pr(t)?Nr:Ir.current,r.context=Or(e,o)),r.state=e.memoizedState,"function"===typeof(o=t.getDerivedStateFromProps)&&(is(e,t,o,n),r.state=e.memoizedState),"function"===typeof t.getDerivedStateFromProps||"function"===typeof r.getSnapshotBeforeUpdate||"function"!==typeof r.UNSAFE_componentWillMount&&"function"!==typeof r.componentWillMount||(t=r.state,"function"===typeof r.componentWillMount&&r.componentWillMount(),"function"===typeof r.UNSAFE_componentWillMount&&r.UNSAFE_componentWillMount(),t!==r.state&&rs.enqueueReplaceState(r,r.state,null),qo(e,n,r,i),r.state=e.memoizedState),"function"===typeof r.componentDidMount&&(e.flags|=4194308)}function ls(e,t){try{var n="",i=t;do{n+=j(i),i=i.return}while(i);var r=n}catch(o){r="\nError generating stack: "+o.message+"\n"+o.stack}return{value:e,source:t,stack:r,digest:null}}function us(e,t,n){return{value:e,source:null,stack:null!=n?n:null,digest:null!=t?t:null}}function ds(e,t){try{console.error(t.value)}catch(n){setTimeout(function(){throw n})}}var hs="function"===typeof WeakMap?WeakMap:Map;function fs(e,t,n){(n=Uo(-1,n)).tag=3,n.payload={element:null};var i=t.value;return n.callback=function(){Hc||(Hc=!0,Wc=i),ds(0,t)},n}function ps(e,t,n){(n=Uo(-1,n)).tag=3;var i=e.type.getDerivedStateFromError;if("function"===typeof i){var r=t.value;n.payload=function(){return i(r)},n.callback=function(){ds(0,t)}}var o=e.stateNode;return null!==o&&"function"===typeof o.componentDidCatch&&(n.callback=function(){ds(0,t),"function"!==typeof i&&(null===Gc?Gc=new Set([this]):Gc.add(this));var e=t.stack;this.componentDidCatch(t.value,{componentStack:null!==e?e:""})}),n}function ms(e,t,n){var i=e.pingCache;if(null===i){i=e.pingCache=new hs;var r=new Set;i.set(t,r)}else void 0===(r=i.get(t))&&(r=new Set,i.set(t,r));r.has(n)||(r.add(n),e=Tl.bind(null,e,t,n),t.then(e,e))}function gs(e){do{var t;if((t=13===e.tag)&&(t=null===(t=e.memoizedState)||null!==t.dehydrated),t)return e;e=e.return}while(null!==e);return null}function ys(e,t,n,i,r){return 0===(1&e.mode)?(e===t?e.flags|=65536:(e.flags|=128,n.flags|=131072,n.flags&=-52805,1===n.tag&&(null===n.alternate?n.tag=17:((t=Uo(-1,1)).tag=2,Fo(n,t,1))),n.lanes|=1),e):(e.flags|=65536,e.lanes=r,e)}var vs=w.ReactCurrentOwner,_s=!1;function ws(e,t,n,i){t.child=null===e?xo(t,null,n,i):bo(t,e.child,n,i)}function bs(e,t,n,i,r){n=n.render;var o=t.ref;return No(t,r),i=ga(e,t,n,i,o,r),n=ya(),null===e||_s?(ro&&n&&eo(t),t.flags|=1,ws(e,t,i,r),t.child):(t.updateQueue=e.updateQueue,t.flags&=-2053,e.lanes&=~r,Hs(e,t,r))}function xs(e,t,n,i,r){if(null===e){var o=n.type;return"function"!==typeof o||Pl(o)||void 0!==o.defaultProps||null!==n.compare||void 0!==n.defaultProps?((e=Ll(n.type,null,i,t,t.mode,r)).ref=t.ref,e.return=t,t.child=e):(t.tag=15,t.type=o,Ss(e,t,o,i,r))}if(o=e.child,0===(e.lanes&r)){var a=o.memoizedProps;if((n=null!==(n=n.compare)?n:ci)(a,i)&&e.ref===t.ref)return Hs(e,t,r)}return t.flags|=1,(e=Rl(o,i)).ref=t.ref,e.return=t,t.child=e}function Ss(e,t,n,i,r){if(null!==e){var o=e.memoizedProps;if(ci(o,i)&&e.ref===t.ref){if(_s=!1,t.pendingProps=i=o,0===(e.lanes&r))return t.lanes=e.lanes,Hs(e,t,r);0!==(131072&e.flags)&&(_s=!0)}}return ks(e,t,n,i,r)}function Es(e,t,n){var i=t.pendingProps,r=i.children,o=null!==e?e.memoizedState:null;if("hidden"===i.mode)if(0===(1&t.mode))t.memoizedState={baseLanes:0,cachePool:null,transitions:null},kr(Rc,Pc),Pc|=n;else{if(0===(1073741824&n))return e=null!==o?o.baseLanes|n:n,t.lanes=t.childLanes=1073741824,t.memoizedState={baseLanes:e,cachePool:null,transitions:null},t.updateQueue=null,kr(Rc,Pc),Pc|=e,null;t.memoizedState={baseLanes:0,cachePool:null,transitions:null},i=null!==o?o.baseLanes:n,kr(Rc,Pc),Pc|=i}else null!==o?(i=o.baseLanes|n,t.memoizedState=null):i=n,kr(Rc,Pc),Pc|=i;return ws(e,t,r,n),t.child}function Ts(e,t){var n=t.ref;(null===e&&null!==n||null!==e&&e.ref!==n)&&(t.flags|=512,t.flags|=2097152)}function ks(e,t,n,i,r){var o=Pr(n)?Nr:Ir.current;return o=Or(t,o),No(t,r),n=ga(e,t,n,i,o,r),i=ya(),null===e||_s?(ro&&i&&eo(t),t.flags|=1,ws(e,t,n,r),t.child):(t.updateQueue=e.updateQueue,t.flags&=-2053,e.lanes&=~r,Hs(e,t,r))}function Cs(e,t,n,i,r){if(Pr(n)){var o=!0;Mr(t)}else o=!1;if(No(t,r),null===t.stateNode)qs(e,t),as(t,n,i),cs(t,n,i,r),i=!0;else if(null===e){var a=t.stateNode,s=t.memoizedProps;a.props=s;var c=a.context,l=n.contextType;"object"===typeof l&&null!==l?l=Oo(l):l=Or(t,l=Pr(n)?Nr:Ir.current);var u=n.getDerivedStateFromProps,d="function"===typeof u||"function"===typeof a.getSnapshotBeforeUpdate;d||"function"!==typeof a.UNSAFE_componentWillReceiveProps&&"function"!==typeof a.componentWillReceiveProps||(s!==i||c!==l)&&ss(t,a,i,l),Mo=!1;var h=t.memoizedState;a.state=h,qo(t,i,a,r),c=t.memoizedState,s!==i||h!==c||Ar.current||Mo?("function"===typeof u&&(is(t,n,u,i),c=t.memoizedState),(s=Mo||os(t,n,s,i,h,c,l))?(d||"function"!==typeof a.UNSAFE_componentWillMount&&"function"!==typeof a.componentWillMount||("function"===typeof a.componentWillMount&&a.componentWillMount(),"function"===typeof a.UNSAFE_componentWillMount&&a.UNSAFE_componentWillMount()),"function"===typeof a.componentDidMount&&(t.flags|=4194308)):("function"===typeof a.componentDidMount&&(t.flags|=4194308),t.memoizedProps=i,t.memoizedState=c),a.props=i,a.state=c,a.context=l,i=s):("function"===typeof a.componentDidMount&&(t.flags|=4194308),i=!1)}else{a=t.stateNode,Bo(e,t),s=t.memoizedProps,l=t.type===t.elementType?s:ns(t.type,s),a.props=l,d=t.pendingProps,h=a.context,"object"===typeof(c=n.contextType)&&null!==c?c=Oo(c):c=Or(t,c=Pr(n)?Nr:Ir.current);var f=n.getDerivedStateFromProps;(u="function"===typeof f||"function"===typeof a.getSnapshotBeforeUpdate)||"function"!==typeof a.UNSAFE_componentWillReceiveProps&&"function"!==typeof a.componentWillReceiveProps||(s!==d||h!==c)&&ss(t,a,i,c),Mo=!1,h=t.memoizedState,a.state=h,qo(t,i,a,r);var p=t.memoizedState;s!==d||h!==p||Ar.current||Mo?("function"===typeof f&&(is(t,n,f,i),p=t.memoizedState),(l=Mo||os(t,n,l,i,h,p,c)||!1)?(u||"function"!==typeof a.UNSAFE_componentWillUpdate&&"function"!==typeof a.componentWillUpdate||("function"===typeof a.componentWillUpdate&&a.componentWillUpdate(i,p,c),"function"===typeof a.UNSAFE_componentWillUpdate&&a.UNSAFE_componentWillUpdate(i,p,c)),"function"===typeof a.componentDidUpdate&&(t.flags|=4),"function"===typeof a.getSnapshotBeforeUpdate&&(t.flags|=1024)):("function"!==typeof a.componentDidUpdate||s===e.memoizedProps&&h===e.memoizedState||(t.flags|=4),"function"!==typeof a.getSnapshotBeforeUpdate||s===e.memoizedProps&&h===e.memoizedState||(t.flags|=1024),t.memoizedProps=i,t.memoizedState=p),a.props=i,a.state=p,a.context=c,i=l):("function"!==typeof a.componentDidUpdate||s===e.memoizedProps&&h===e.memoizedState||(t.flags|=4),"function"!==typeof a.getSnapshotBeforeUpdate||s===e.memoizedProps&&h===e.memoizedState||(t.flags|=1024),i=!1)}return Is(e,t,n,i,o,r)}function Is(e,t,n,i,r,o){Ts(e,t);var a=0!==(128&t.flags);if(!i&&!a)return r&&Dr(t,n,!1),Hs(e,t,o);i=t.stateNode,vs.current=t;var s=a&&"function"!==typeof n.getDerivedStateFromError?null:i.render();return t.flags|=1,null!==e&&a?(t.child=bo(t,e.child,null,o),t.child=bo(t,null,s,o)):ws(e,t,s,o),t.memoizedState=i.state,r&&Dr(t,n,!0),t.child}function As(e){var t=e.stateNode;t.pendingContext?Lr(0,t.pendingContext,t.pendingContext!==t.context):t.context&&Lr(0,t.context,!1),Xo(e,t.containerInfo)}function Ns(e,t,n,i,r){return po(),mo(r),t.flags|=256,ws(e,t,n,i),t.child}var Os,Ps,Rs,Ls,zs={dehydrated:null,treeContext:null,retryLane:0};function Ms(e){return{baseLanes:e,cachePool:null,transitions:null}}function Ds(e,t,n){var i,r=t.pendingProps,a=ea.current,s=!1,c=0!==(128&t.flags);if((i=c)||(i=(null===e||null!==e.memoizedState)&&0!==(2&a)),i?(s=!0,t.flags&=-129):null!==e&&null===e.memoizedState||(a|=1),kr(ea,1&a),null===e)return lo(t),null!==(e=t.memoizedState)&&null!==(e=e.dehydrated)?(0===(1&t.mode)?t.lanes=1:"$!"===e.data?t.lanes=8:t.lanes=1073741824,null):(c=r.children,e=r.fallback,s?(r=t.mode,s=t.child,c={mode:"hidden",children:c},0===(1&r)&&null!==s?(s.childLanes=0,s.pendingProps=c):s=Ml(c,r,0,null),e=zl(e,r,n,null),s.return=t,e.return=t,s.sibling=e,t.child=s,t.child.memoizedState=Ms(n),t.memoizedState=zs,e):Bs(t,c));if(null!==(a=e.memoizedState)&&null!==(i=a.dehydrated))return function(e,t,n,i,r,a,s){if(n)return 256&t.flags?(t.flags&=-257,Us(e,t,s,i=us(Error(o(422))))):null!==t.memoizedState?(t.child=e.child,t.flags|=128,null):(a=i.fallback,r=t.mode,i=Ml({mode:"visible",children:i.children},r,0,null),(a=zl(a,r,s,null)).flags|=2,i.return=t,a.return=t,i.sibling=a,t.child=i,0!==(1&t.mode)&&bo(t,e.child,null,s),t.child.memoizedState=Ms(s),t.memoizedState=zs,a);if(0===(1&t.mode))return Us(e,t,s,null);if("$!"===r.data){if(i=r.nextSibling&&r.nextSibling.dataset)var c=i.dgst;return i=c,Us(e,t,s,i=us(a=Error(o(419)),i,void 0))}if(c=0!==(s&e.childLanes),_s||c){if(null!==(i=Ac)){switch(s&-s){case 4:r=2;break;case 16:r=8;break;case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:r=32;break;case 536870912:r=268435456;break;default:r=0}0!==(r=0!==(r&(i.suspendedLanes|s))?0:r)&&r!==a.retryLane&&(a.retryLane=r,zo(e,r),nl(i,e,r,-1))}return ml(),Us(e,t,s,i=us(Error(o(421))))}return"$?"===r.data?(t.flags|=128,t.child=e.child,t=Cl.bind(null,e),r._reactRetry=t,null):(e=a.treeContext,io=lr(r.nextSibling),no=t,ro=!0,oo=null,null!==e&&(Kr[Zr++]=Xr,Kr[Zr++]=Yr,Kr[Zr++]=Qr,Xr=e.id,Yr=e.overflow,Qr=t),t=Bs(t,i.children),t.flags|=4096,t)}(e,t,c,r,i,a,n);if(s){s=r.fallback,c=t.mode,i=(a=e.child).sibling;var l={mode:"hidden",children:r.children};return 0===(1&c)&&t.child!==a?((r=t.child).childLanes=0,r.pendingProps=l,t.deletions=null):(r=Rl(a,l)).subtreeFlags=14680064&a.subtreeFlags,null!==i?s=Rl(i,s):(s=zl(s,c,n,null)).flags|=2,s.return=t,r.return=t,r.sibling=s,t.child=r,r=s,s=t.child,c=null===(c=e.child.memoizedState)?Ms(n):{baseLanes:c.baseLanes|n,cachePool:null,transitions:c.transitions},s.memoizedState=c,s.childLanes=e.childLanes&~n,t.memoizedState=zs,r}return e=(s=e.child).sibling,r=Rl(s,{mode:"visible",children:r.children}),0===(1&t.mode)&&(r.lanes=n),r.return=t,r.sibling=null,null!==e&&(null===(n=t.deletions)?(t.deletions=[e],t.flags|=16):n.push(e)),t.child=r,t.memoizedState=null,r}function Bs(e,t){return(t=Ml({mode:"visible",children:t},e.mode,0,null)).return=e,e.child=t}function Us(e,t,n,i){return null!==i&&mo(i),bo(t,e.child,null,n),(e=Bs(t,t.pendingProps.children)).flags|=2,t.memoizedState=null,e}function Fs(e,t,n){e.lanes|=t;var i=e.alternate;null!==i&&(i.lanes|=t),Ao(e.return,t,n)}function js(e,t,n,i,r){var o=e.memoizedState;null===o?e.memoizedState={isBackwards:t,rendering:null,renderingStartTime:0,last:i,tail:n,tailMode:r}:(o.isBackwards=t,o.rendering=null,o.renderingStartTime=0,o.last=i,o.tail=n,o.tailMode=r)}function Vs(e,t,n){var i=t.pendingProps,r=i.revealOrder,o=i.tail;if(ws(e,t,i.children,n),0!==(2&(i=ea.current)))i=1&i|2,t.flags|=128;else{if(null!==e&&0!==(128&e.flags))e:for(e=t.child;null!==e;){if(13===e.tag)null!==e.memoizedState&&Fs(e,n,t);else if(19===e.tag)Fs(e,n,t);else if(null!==e.child){e.child.return=e,e=e.child;continue}if(e===t)break e;for(;null===e.sibling;){if(null===e.return||e.return===t)break e;e=e.return}e.sibling.return=e.return,e=e.sibling}i&=1}if(kr(ea,i),0===(1&t.mode))t.memoizedState=null;else switch(r){case"forwards":for(n=t.child,r=null;null!==n;)null!==(e=n.alternate)&&null===ta(e)&&(r=n),n=n.sibling;null===(n=r)?(r=t.child,t.child=null):(r=n.sibling,n.sibling=null),js(t,!1,r,n,o);break;case"backwards":for(n=null,r=t.child,t.child=null;null!==r;){if(null!==(e=r.alternate)&&null===ta(e)){t.child=r;break}e=r.sibling,r.sibling=n,n=r,r=e}js(t,!0,n,null,o);break;case"together":js(t,!1,null,null,void 0);break;default:t.memoizedState=null}return t.child}function qs(e,t){0===(1&t.mode)&&null!==e&&(e.alternate=null,t.alternate=null,t.flags|=2)}function Hs(e,t,n){if(null!==e&&(t.dependencies=e.dependencies),Mc|=t.lanes,0===(n&t.childLanes))return null;if(null!==e&&t.child!==e.child)throw Error(o(153));if(null!==t.child){for(n=Rl(e=t.child,e.pendingProps),t.child=n,n.return=t;null!==e.sibling;)e=e.sibling,(n=n.sibling=Rl(e,e.pendingProps)).return=t;n.sibling=null}return t.child}function Ws(e,t){if(!ro)switch(e.tailMode){case"hidden":t=e.tail;for(var n=null;null!==t;)null!==t.alternate&&(n=t),t=t.sibling;null===n?e.tail=null:n.sibling=null;break;case"collapsed":n=e.tail;for(var i=null;null!==n;)null!==n.alternate&&(i=n),n=n.sibling;null===i?t||null===e.tail?e.tail=null:e.tail.sibling=null:i.sibling=null}}function Gs(e){var t=null!==e.alternate&&e.alternate.child===e.child,n=0,i=0;if(t)for(var r=e.child;null!==r;)n|=r.lanes|r.childLanes,i|=14680064&r.subtreeFlags,i|=14680064&r.flags,r.return=e,r=r.sibling;else for(r=e.child;null!==r;)n|=r.lanes|r.childLanes,i|=r.subtreeFlags,i|=r.flags,r.return=e,r=r.sibling;return e.subtreeFlags|=i,e.childLanes=n,t}function Ks(e,t,n){var i=t.pendingProps;switch(to(t),t.tag){case 2:case 16:case 15:case 0:case 11:case 7:case 8:case 12:case 9:case 14:return Gs(t),null;case 1:case 17:return Pr(t.type)&&Rr(),Gs(t),null;case 3:return i=t.stateNode,Yo(),Tr(Ar),Tr(Ir),ia(),i.pendingContext&&(i.context=i.pendingContext,i.pendingContext=null),null!==e&&null!==e.child||(ho(t)?t.flags|=4:null===e||e.memoizedState.isDehydrated&&0===(256&t.flags)||(t.flags|=1024,null!==oo&&(al(oo),oo=null))),Ps(e,t),Gs(t),null;case 5:$o(t);var r=Qo(Zo.current);if(n=t.type,null!==e&&null!=t.stateNode)Rs(e,t,n,i,r),e.ref!==t.ref&&(t.flags|=512,t.flags|=2097152);else{if(!i){if(null===t.stateNode)throw Error(o(166));return Gs(t),null}if(e=Qo(Go.current),ho(t)){i=t.stateNode,n=t.type;var a=t.memoizedProps;switch(i[hr]=t,i[fr]=a,e=0!==(1&t.mode),n){case"dialog":Ui("cancel",i),Ui("close",i);break;case"iframe":case"object":case"embed":Ui("load",i);break;case"video":case"audio":for(r=0;r<zi.length;r++)Ui(zi[r],i);break;case"source":Ui("error",i);break;case"img":case"image":case"link":Ui("error",i),Ui("load",i);break;case"details":Ui("toggle",i);break;case"input":X(i,a),Ui("invalid",i);break;case"select":i._wrapperState={wasMultiple:!!a.multiple},Ui("invalid",i);break;case"textarea":re(i,a),Ui("invalid",i)}for(var c in ve(n,a),r=null,a)if(a.hasOwnProperty(c)){var l=a[c];"children"===c?"string"===typeof l?i.textContent!==l&&(!0!==a.suppressHydrationWarning&&Ji(i.textContent,l,e),r=["children",l]):"number"===typeof l&&i.textContent!==""+l&&(!0!==a.suppressHydrationWarning&&Ji(i.textContent,l,e),r=["children",""+l]):s.hasOwnProperty(c)&&null!=l&&"onScroll"===c&&Ui("scroll",i)}switch(n){case"input":G(i),$(i,a,!0);break;case"textarea":G(i),ae(i);break;case"select":case"option":break;default:"function"===typeof a.onClick&&(i.onclick=$i)}i=r,t.updateQueue=i,null!==i&&(t.flags|=4)}else{c=9===r.nodeType?r:r.ownerDocument,"http://www.w3.org/1999/xhtml"===e&&(e=se(n)),"http://www.w3.org/1999/xhtml"===e?"script"===n?((e=c.createElement("div")).innerHTML="<script><\/script>",e=e.removeChild(e.firstChild)):"string"===typeof i.is?e=c.createElement(n,{is:i.is}):(e=c.createElement(n),"select"===n&&(c=e,i.multiple?c.multiple=!0:i.size&&(c.size=i.size))):e=c.createElementNS(e,n),e[hr]=t,e[fr]=i,Os(e,t,!1,!1),t.stateNode=e;e:{switch(c=_e(n,i),n){case"dialog":Ui("cancel",e),Ui("close",e),r=i;break;case"iframe":case"object":case"embed":Ui("load",e),r=i;break;case"video":case"audio":for(r=0;r<zi.length;r++)Ui(zi[r],e);r=i;break;case"source":Ui("error",e),r=i;break;case"img":case"image":case"link":Ui("error",e),Ui("load",e),r=i;break;case"details":Ui("toggle",e),r=i;break;case"input":X(e,i),r=Q(e,i),Ui("invalid",e);break;case"option":default:r=i;break;case"select":e._wrapperState={wasMultiple:!!i.multiple},r=D({},i,{value:void 0}),Ui("invalid",e);break;case"textarea":re(e,i),r=ie(e,i),Ui("invalid",e)}for(a in ve(n,r),l=r)if(l.hasOwnProperty(a)){var u=l[a];"style"===a?ge(e,u):"dangerouslySetInnerHTML"===a?null!=(u=u?u.__html:void 0)&&de(e,u):"children"===a?"string"===typeof u?("textarea"!==n||""!==u)&&he(e,u):"number"===typeof u&&he(e,""+u):"suppressContentEditableWarning"!==a&&"suppressHydrationWarning"!==a&&"autoFocus"!==a&&(s.hasOwnProperty(a)?null!=u&&"onScroll"===a&&Ui("scroll",e):null!=u&&_(e,a,u,c))}switch(n){case"input":G(e),$(e,i,!1);break;case"textarea":G(e),ae(e);break;case"option":null!=i.value&&e.setAttribute("value",""+H(i.value));break;case"select":e.multiple=!!i.multiple,null!=(a=i.value)?ne(e,!!i.multiple,a,!1):null!=i.defaultValue&&ne(e,!!i.multiple,i.defaultValue,!0);break;default:"function"===typeof r.onClick&&(e.onclick=$i)}switch(n){case"button":case"input":case"select":case"textarea":i=!!i.autoFocus;break e;case"img":i=!0;break e;default:i=!1}}i&&(t.flags|=4)}null!==t.ref&&(t.flags|=512,t.flags|=2097152)}return Gs(t),null;case 6:if(e&&null!=t.stateNode)Ls(e,t,e.memoizedProps,i);else{if("string"!==typeof i&&null===t.stateNode)throw Error(o(166));if(n=Qo(Zo.current),Qo(Go.current),ho(t)){if(i=t.stateNode,n=t.memoizedProps,i[hr]=t,(a=i.nodeValue!==n)&&null!==(e=no))switch(e.tag){case 3:Ji(i.nodeValue,n,0!==(1&e.mode));break;case 5:!0!==e.memoizedProps.suppressHydrationWarning&&Ji(i.nodeValue,n,0!==(1&e.mode))}a&&(t.flags|=4)}else(i=(9===n.nodeType?n:n.ownerDocument).createTextNode(i))[hr]=t,t.stateNode=i}return Gs(t),null;case 13:if(Tr(ea),i=t.memoizedState,null===e||null!==e.memoizedState&&null!==e.memoizedState.dehydrated){if(ro&&null!==io&&0!==(1&t.mode)&&0===(128&t.flags))fo(),po(),t.flags|=98560,a=!1;else if(a=ho(t),null!==i&&null!==i.dehydrated){if(null===e){if(!a)throw Error(o(318));if(!(a=null!==(a=t.memoizedState)?a.dehydrated:null))throw Error(o(317));a[hr]=t}else po(),0===(128&t.flags)&&(t.memoizedState=null),t.flags|=4;Gs(t),a=!1}else null!==oo&&(al(oo),oo=null),a=!0;if(!a)return 65536&t.flags?t:null}return 0!==(128&t.flags)?(t.lanes=n,t):((i=null!==i)!==(null!==e&&null!==e.memoizedState)&&i&&(t.child.flags|=8192,0!==(1&t.mode)&&(null===e||0!==(1&ea.current)?0===Lc&&(Lc=3):ml())),null!==t.updateQueue&&(t.flags|=4),Gs(t),null);case 4:return Yo(),Ps(e,t),null===e&&Vi(t.stateNode.containerInfo),Gs(t),null;case 10:return Io(t.type._context),Gs(t),null;case 19:if(Tr(ea),null===(a=t.memoizedState))return Gs(t),null;if(i=0!==(128&t.flags),null===(c=a.rendering))if(i)Ws(a,!1);else{if(0!==Lc||null!==e&&0!==(128&e.flags))for(e=t.child;null!==e;){if(null!==(c=ta(e))){for(t.flags|=128,Ws(a,!1),null!==(i=c.updateQueue)&&(t.updateQueue=i,t.flags|=4),t.subtreeFlags=0,i=n,n=t.child;null!==n;)e=i,(a=n).flags&=14680066,null===(c=a.alternate)?(a.childLanes=0,a.lanes=e,a.child=null,a.subtreeFlags=0,a.memoizedProps=null,a.memoizedState=null,a.updateQueue=null,a.dependencies=null,a.stateNode=null):(a.childLanes=c.childLanes,a.lanes=c.lanes,a.child=c.child,a.subtreeFlags=0,a.deletions=null,a.memoizedProps=c.memoizedProps,a.memoizedState=c.memoizedState,a.updateQueue=c.updateQueue,a.type=c.type,e=c.dependencies,a.dependencies=null===e?null:{lanes:e.lanes,firstContext:e.firstContext}),n=n.sibling;return kr(ea,1&ea.current|2),t.child}e=e.sibling}null!==a.tail&&Ye()>Vc&&(t.flags|=128,i=!0,Ws(a,!1),t.lanes=4194304)}else{if(!i)if(null!==(e=ta(c))){if(t.flags|=128,i=!0,null!==(n=e.updateQueue)&&(t.updateQueue=n,t.flags|=4),Ws(a,!0),null===a.tail&&"hidden"===a.tailMode&&!c.alternate&&!ro)return Gs(t),null}else 2*Ye()-a.renderingStartTime>Vc&&1073741824!==n&&(t.flags|=128,i=!0,Ws(a,!1),t.lanes=4194304);a.isBackwards?(c.sibling=t.child,t.child=c):(null!==(n=a.last)?n.sibling=c:t.child=c,a.last=c)}return null!==a.tail?(t=a.tail,a.rendering=t,a.tail=t.sibling,a.renderingStartTime=Ye(),t.sibling=null,n=ea.current,kr(ea,i?1&n|2:1&n),t):(Gs(t),null);case 22:case 23:return dl(),i=null!==t.memoizedState,null!==e&&null!==e.memoizedState!==i&&(t.flags|=8192),i&&0!==(1&t.mode)?0!==(1073741824&Pc)&&(Gs(t),6&t.subtreeFlags&&(t.flags|=8192)):Gs(t),null;case 24:case 25:return null}throw Error(o(156,t.tag))}function Zs(e,t){switch(to(t),t.tag){case 1:return Pr(t.type)&&Rr(),65536&(e=t.flags)?(t.flags=-65537&e|128,t):null;case 3:return Yo(),Tr(Ar),Tr(Ir),ia(),0!==(65536&(e=t.flags))&&0===(128&e)?(t.flags=-65537&e|128,t):null;case 5:return $o(t),null;case 13:if(Tr(ea),null!==(e=t.memoizedState)&&null!==e.dehydrated){if(null===t.alternate)throw Error(o(340));po()}return 65536&(e=t.flags)?(t.flags=-65537&e|128,t):null;case 19:return Tr(ea),null;case 4:return Yo(),null;case 10:return Io(t.type._context),null;case 22:case 23:return dl(),null;default:return null}}Os=function(e,t){for(var n=t.child;null!==n;){if(5===n.tag||6===n.tag)e.appendChild(n.stateNode);else if(4!==n.tag&&null!==n.child){n.child.return=n,n=n.child;continue}if(n===t)break;for(;null===n.sibling;){if(null===n.return||n.return===t)return;n=n.return}n.sibling.return=n.return,n=n.sibling}},Ps=function(){},Rs=function(e,t,n,i){var r=e.memoizedProps;if(r!==i){e=t.stateNode,Qo(Go.current);var o,a=null;switch(n){case"input":r=Q(e,r),i=Q(e,i),a=[];break;case"select":r=D({},r,{value:void 0}),i=D({},i,{value:void 0}),a=[];break;case"textarea":r=ie(e,r),i=ie(e,i),a=[];break;default:"function"!==typeof r.onClick&&"function"===typeof i.onClick&&(e.onclick=$i)}for(u in ve(n,i),n=null,r)if(!i.hasOwnProperty(u)&&r.hasOwnProperty(u)&&null!=r[u])if("style"===u){var c=r[u];for(o in c)c.hasOwnProperty(o)&&(n||(n={}),n[o]="")}else"dangerouslySetInnerHTML"!==u&&"children"!==u&&"suppressContentEditableWarning"!==u&&"suppressHydrationWarning"!==u&&"autoFocus"!==u&&(s.hasOwnProperty(u)?a||(a=[]):(a=a||[]).push(u,null));for(u in i){var l=i[u];if(c=null!=r?r[u]:void 0,i.hasOwnProperty(u)&&l!==c&&(null!=l||null!=c))if("style"===u)if(c){for(o in c)!c.hasOwnProperty(o)||l&&l.hasOwnProperty(o)||(n||(n={}),n[o]="");for(o in l)l.hasOwnProperty(o)&&c[o]!==l[o]&&(n||(n={}),n[o]=l[o])}else n||(a||(a=[]),a.push(u,n)),n=l;else"dangerouslySetInnerHTML"===u?(l=l?l.__html:void 0,c=c?c.__html:void 0,null!=l&&c!==l&&(a=a||[]).push(u,l)):"children"===u?"string"!==typeof l&&"number"!==typeof l||(a=a||[]).push(u,""+l):"suppressContentEditableWarning"!==u&&"suppressHydrationWarning"!==u&&(s.hasOwnProperty(u)?(null!=l&&"onScroll"===u&&Ui("scroll",e),a||c===l||(a=[])):(a=a||[]).push(u,l))}n&&(a=a||[]).push("style",n);var u=a;(t.updateQueue=u)&&(t.flags|=4)}},Ls=function(e,t,n,i){n!==i&&(t.flags|=4)};var Qs=!1,Xs=!1,Ys="function"===typeof WeakSet?WeakSet:Set,Js=null;function $s(e,t){var n=e.ref;if(null!==n)if("function"===typeof n)try{n(null)}catch(i){El(e,t,i)}else n.current=null}function ec(e,t,n){try{n()}catch(i){El(e,t,i)}}var tc=!1;function nc(e,t,n){var i=t.updateQueue;if(null!==(i=null!==i?i.lastEffect:null)){var r=i=i.next;do{if((r.tag&e)===e){var o=r.destroy;r.destroy=void 0,void 0!==o&&ec(t,n,o)}r=r.next}while(r!==i)}}function ic(e,t){if(null!==(t=null!==(t=t.updateQueue)?t.lastEffect:null)){var n=t=t.next;do{if((n.tag&e)===e){var i=n.create;n.destroy=i()}n=n.next}while(n!==t)}}function rc(e){var t=e.ref;if(null!==t){var n=e.stateNode;e.tag,e=n,"function"===typeof t?t(e):t.current=e}}function oc(e){var t=e.alternate;null!==t&&(e.alternate=null,oc(t)),e.child=null,e.deletions=null,e.sibling=null,5===e.tag&&(null!==(t=e.stateNode)&&(delete t[hr],delete t[fr],delete t[mr],delete t[gr],delete t[yr])),e.stateNode=null,e.return=null,e.dependencies=null,e.memoizedProps=null,e.memoizedState=null,e.pendingProps=null,e.stateNode=null,e.updateQueue=null}function ac(e){return 5===e.tag||3===e.tag||4===e.tag}function sc(e){e:for(;;){for(;null===e.sibling;){if(null===e.return||ac(e.return))return null;e=e.return}for(e.sibling.return=e.return,e=e.sibling;5!==e.tag&&6!==e.tag&&18!==e.tag;){if(2&e.flags)continue e;if(null===e.child||4===e.tag)continue e;e.child.return=e,e=e.child}if(!(2&e.flags))return e.stateNode}}function cc(e,t,n){var i=e.tag;if(5===i||6===i)e=e.stateNode,t?8===n.nodeType?n.parentNode.insertBefore(e,t):n.insertBefore(e,t):(8===n.nodeType?(t=n.parentNode).insertBefore(e,n):(t=n).appendChild(e),null!==(n=n._reactRootContainer)&&void 0!==n||null!==t.onclick||(t.onclick=$i));else if(4!==i&&null!==(e=e.child))for(cc(e,t,n),e=e.sibling;null!==e;)cc(e,t,n),e=e.sibling}function lc(e,t,n){var i=e.tag;if(5===i||6===i)e=e.stateNode,t?n.insertBefore(e,t):n.appendChild(e);else if(4!==i&&null!==(e=e.child))for(lc(e,t,n),e=e.sibling;null!==e;)lc(e,t,n),e=e.sibling}var uc=null,dc=!1;function hc(e,t,n){for(n=n.child;null!==n;)fc(e,t,n),n=n.sibling}function fc(e,t,n){if(ot&&"function"===typeof ot.onCommitFiberUnmount)try{ot.onCommitFiberUnmount(rt,n)}catch(s){}switch(n.tag){case 5:Xs||$s(n,t);case 6:var i=uc,r=dc;uc=null,hc(e,t,n),dc=r,null!==(uc=i)&&(dc?(e=uc,n=n.stateNode,8===e.nodeType?e.parentNode.removeChild(n):e.removeChild(n)):uc.removeChild(n.stateNode));break;case 18:null!==uc&&(dc?(e=uc,n=n.stateNode,8===e.nodeType?cr(e.parentNode,n):1===e.nodeType&&cr(e,n),Vt(e)):cr(uc,n.stateNode));break;case 4:i=uc,r=dc,uc=n.stateNode.containerInfo,dc=!0,hc(e,t,n),uc=i,dc=r;break;case 0:case 11:case 14:case 15:if(!Xs&&(null!==(i=n.updateQueue)&&null!==(i=i.lastEffect))){r=i=i.next;do{var o=r,a=o.destroy;o=o.tag,void 0!==a&&(0!==(2&o)||0!==(4&o))&&ec(n,t,a),r=r.next}while(r!==i)}hc(e,t,n);break;case 1:if(!Xs&&($s(n,t),"function"===typeof(i=n.stateNode).componentWillUnmount))try{i.props=n.memoizedProps,i.state=n.memoizedState,i.componentWillUnmount()}catch(s){El(n,t,s)}hc(e,t,n);break;case 21:hc(e,t,n);break;case 22:1&n.mode?(Xs=(i=Xs)||null!==n.memoizedState,hc(e,t,n),Xs=i):hc(e,t,n);break;default:hc(e,t,n)}}function pc(e){var t=e.updateQueue;if(null!==t){e.updateQueue=null;var n=e.stateNode;null===n&&(n=e.stateNode=new Ys),t.forEach(function(t){var i=Il.bind(null,e,t);n.has(t)||(n.add(t),t.then(i,i))})}}function mc(e,t){var n=t.deletions;if(null!==n)for(var i=0;i<n.length;i++){var r=n[i];try{var a=e,s=t,c=s;e:for(;null!==c;){switch(c.tag){case 5:uc=c.stateNode,dc=!1;break e;case 3:case 4:uc=c.stateNode.containerInfo,dc=!0;break e}c=c.return}if(null===uc)throw Error(o(160));fc(a,s,r),uc=null,dc=!1;var l=r.alternate;null!==l&&(l.return=null),r.return=null}catch(u){El(r,t,u)}}if(12854&t.subtreeFlags)for(t=t.child;null!==t;)gc(t,e),t=t.sibling}function gc(e,t){var n=e.alternate,i=e.flags;switch(e.tag){case 0:case 11:case 14:case 15:if(mc(t,e),yc(e),4&i){try{nc(3,e,e.return),ic(3,e)}catch(g){El(e,e.return,g)}try{nc(5,e,e.return)}catch(g){El(e,e.return,g)}}break;case 1:mc(t,e),yc(e),512&i&&null!==n&&$s(n,n.return);break;case 5:if(mc(t,e),yc(e),512&i&&null!==n&&$s(n,n.return),32&e.flags){var r=e.stateNode;try{he(r,"")}catch(g){El(e,e.return,g)}}if(4&i&&null!=(r=e.stateNode)){var a=e.memoizedProps,s=null!==n?n.memoizedProps:a,c=e.type,l=e.updateQueue;if(e.updateQueue=null,null!==l)try{"input"===c&&"radio"===a.type&&null!=a.name&&Y(r,a),_e(c,s);var u=_e(c,a);for(s=0;s<l.length;s+=2){var d=l[s],h=l[s+1];"style"===d?ge(r,h):"dangerouslySetInnerHTML"===d?de(r,h):"children"===d?he(r,h):_(r,d,h,u)}switch(c){case"input":J(r,a);break;case"textarea":oe(r,a);break;case"select":var f=r._wrapperState.wasMultiple;r._wrapperState.wasMultiple=!!a.multiple;var p=a.value;null!=p?ne(r,!!a.multiple,p,!1):f!==!!a.multiple&&(null!=a.defaultValue?ne(r,!!a.multiple,a.defaultValue,!0):ne(r,!!a.multiple,a.multiple?[]:"",!1))}r[fr]=a}catch(g){El(e,e.return,g)}}break;case 6:if(mc(t,e),yc(e),4&i){if(null===e.stateNode)throw Error(o(162));r=e.stateNode,a=e.memoizedProps;try{r.nodeValue=a}catch(g){El(e,e.return,g)}}break;case 3:if(mc(t,e),yc(e),4&i&&null!==n&&n.memoizedState.isDehydrated)try{Vt(t.containerInfo)}catch(g){El(e,e.return,g)}break;case 4:default:mc(t,e),yc(e);break;case 13:mc(t,e),yc(e),8192&(r=e.child).flags&&(a=null!==r.memoizedState,r.stateNode.isHidden=a,!a||null!==r.alternate&&null!==r.alternate.memoizedState||(jc=Ye())),4&i&&pc(e);break;case 22:if(d=null!==n&&null!==n.memoizedState,1&e.mode?(Xs=(u=Xs)||d,mc(t,e),Xs=u):mc(t,e),yc(e),8192&i){if(u=null!==e.memoizedState,(e.stateNode.isHidden=u)&&!d&&0!==(1&e.mode))for(Js=e,d=e.child;null!==d;){for(h=Js=d;null!==Js;){switch(p=(f=Js).child,f.tag){case 0:case 11:case 14:case 15:nc(4,f,f.return);break;case 1:$s(f,f.return);var m=f.stateNode;if("function"===typeof m.componentWillUnmount){i=f,n=f.return;try{t=i,m.props=t.memoizedProps,m.state=t.memoizedState,m.componentWillUnmount()}catch(g){El(i,n,g)}}break;case 5:$s(f,f.return);break;case 22:if(null!==f.memoizedState){bc(h);continue}}null!==p?(p.return=f,Js=p):bc(h)}d=d.sibling}e:for(d=null,h=e;;){if(5===h.tag){if(null===d){d=h;try{r=h.stateNode,u?"function"===typeof(a=r.style).setProperty?a.setProperty("display","none","important"):a.display="none":(c=h.stateNode,s=void 0!==(l=h.memoizedProps.style)&&null!==l&&l.hasOwnProperty("display")?l.display:null,c.style.display=me("display",s))}catch(g){El(e,e.return,g)}}}else if(6===h.tag){if(null===d)try{h.stateNode.nodeValue=u?"":h.memoizedProps}catch(g){El(e,e.return,g)}}else if((22!==h.tag&&23!==h.tag||null===h.memoizedState||h===e)&&null!==h.child){h.child.return=h,h=h.child;continue}if(h===e)break e;for(;null===h.sibling;){if(null===h.return||h.return===e)break e;d===h&&(d=null),h=h.return}d===h&&(d=null),h.sibling.return=h.return,h=h.sibling}}break;case 19:mc(t,e),yc(e),4&i&&pc(e);case 21:}}function yc(e){var t=e.flags;if(2&t){try{e:{for(var n=e.return;null!==n;){if(ac(n)){var i=n;break e}n=n.return}throw Error(o(160))}switch(i.tag){case 5:var r=i.stateNode;32&i.flags&&(he(r,""),i.flags&=-33),lc(e,sc(e),r);break;case 3:case 4:var a=i.stateNode.containerInfo;cc(e,sc(e),a);break;default:throw Error(o(161))}}catch(s){El(e,e.return,s)}e.flags&=-3}4096&t&&(e.flags&=-4097)}function vc(e,t,n){Js=e,_c(e,t,n)}function _c(e,t,n){for(var i=0!==(1&e.mode);null!==Js;){var r=Js,o=r.child;if(22===r.tag&&i){var a=null!==r.memoizedState||Qs;if(!a){var s=r.alternate,c=null!==s&&null!==s.memoizedState||Xs;s=Qs;var l=Xs;if(Qs=a,(Xs=c)&&!l)for(Js=r;null!==Js;)c=(a=Js).child,22===a.tag&&null!==a.memoizedState?xc(r):null!==c?(c.return=a,Js=c):xc(r);for(;null!==o;)Js=o,_c(o,t,n),o=o.sibling;Js=r,Qs=s,Xs=l}wc(e)}else 0!==(8772&r.subtreeFlags)&&null!==o?(o.return=r,Js=o):wc(e)}}function wc(e){for(;null!==Js;){var t=Js;if(0!==(8772&t.flags)){var n=t.alternate;try{if(0!==(8772&t.flags))switch(t.tag){case 0:case 11:case 15:Xs||ic(5,t);break;case 1:var i=t.stateNode;if(4&t.flags&&!Xs)if(null===n)i.componentDidMount();else{var r=t.elementType===t.type?n.memoizedProps:ns(t.type,n.memoizedProps);i.componentDidUpdate(r,n.memoizedState,i.__reactInternalSnapshotBeforeUpdate)}var a=t.updateQueue;null!==a&&Ho(t,a,i);break;case 3:var s=t.updateQueue;if(null!==s){if(n=null,null!==t.child)switch(t.child.tag){case 5:case 1:n=t.child.stateNode}Ho(t,s,n)}break;case 5:var c=t.stateNode;if(null===n&&4&t.flags){n=c;var l=t.memoizedProps;switch(t.type){case"button":case"input":case"select":case"textarea":l.autoFocus&&n.focus();break;case"img":l.src&&(n.src=l.src)}}break;case 6:case 4:case 12:case 19:case 17:case 21:case 22:case 23:case 25:break;case 13:if(null===t.memoizedState){var u=t.alternate;if(null!==u){var d=u.memoizedState;if(null!==d){var h=d.dehydrated;null!==h&&Vt(h)}}}break;default:throw Error(o(163))}Xs||512&t.flags&&rc(t)}catch(f){El(t,t.return,f)}}if(t===e){Js=null;break}if(null!==(n=t.sibling)){n.return=t.return,Js=n;break}Js=t.return}}function bc(e){for(;null!==Js;){var t=Js;if(t===e){Js=null;break}var n=t.sibling;if(null!==n){n.return=t.return,Js=n;break}Js=t.return}}function xc(e){for(;null!==Js;){var t=Js;try{switch(t.tag){case 0:case 11:case 15:var n=t.return;try{ic(4,t)}catch(c){El(t,n,c)}break;case 1:var i=t.stateNode;if("function"===typeof i.componentDidMount){var r=t.return;try{i.componentDidMount()}catch(c){El(t,r,c)}}var o=t.return;try{rc(t)}catch(c){El(t,o,c)}break;case 5:var a=t.return;try{rc(t)}catch(c){El(t,a,c)}}}catch(c){El(t,t.return,c)}if(t===e){Js=null;break}var s=t.sibling;if(null!==s){s.return=t.return,Js=s;break}Js=t.return}}var Sc,Ec=Math.ceil,Tc=w.ReactCurrentDispatcher,kc=w.ReactCurrentOwner,Cc=w.ReactCurrentBatchConfig,Ic=0,Ac=null,Nc=null,Oc=0,Pc=0,Rc=Er(0),Lc=0,zc=null,Mc=0,Dc=0,Bc=0,Uc=null,Fc=null,jc=0,Vc=1/0,qc=null,Hc=!1,Wc=null,Gc=null,Kc=!1,Zc=null,Qc=0,Xc=0,Yc=null,Jc=-1,$c=0;function el(){return 0!==(6&Ic)?Ye():-1!==Jc?Jc:Jc=Ye()}function tl(e){return 0===(1&e.mode)?1:0!==(2&Ic)&&0!==Oc?Oc&-Oc:null!==go.transition?(0===$c&&($c=mt()),$c):0!==(e=_t)?e:e=void 0===(e=window.event)?16:Xt(e.type)}function nl(e,t,n,i){if(50<Xc)throw Xc=0,Yc=null,Error(o(185));yt(e,n,i),0!==(2&Ic)&&e===Ac||(e===Ac&&(0===(2&Ic)&&(Dc|=n),4===Lc&&sl(e,Oc)),il(e,i),1===n&&0===Ic&&0===(1&t.mode)&&(Vc=Ye()+500,Ur&&Vr()))}function il(e,t){var n=e.callbackNode;!function(e,t){for(var n=e.suspendedLanes,i=e.pingedLanes,r=e.expirationTimes,o=e.pendingLanes;0<o;){var a=31-at(o),s=1<<a,c=r[a];-1===c?0!==(s&n)&&0===(s&i)||(r[a]=ft(s,t)):c<=t&&(e.expiredLanes|=s),o&=~s}}(e,t);var i=ht(e,e===Ac?Oc:0);if(0===i)null!==n&&Ze(n),e.callbackNode=null,e.callbackPriority=0;else if(t=i&-i,e.callbackPriority!==t){if(null!=n&&Ze(n),1===t)0===e.tag?function(e){Ur=!0,jr(e)}(cl.bind(null,e)):jr(cl.bind(null,e)),ar(function(){0===(6&Ic)&&Vr()}),n=null;else{switch(wt(i)){case 1:n=$e;break;case 4:n=et;break;case 16:default:n=tt;break;case 536870912:n=it}n=Al(n,rl.bind(null,e))}e.callbackPriority=t,e.callbackNode=n}}function rl(e,t){if(Jc=-1,$c=0,0!==(6&Ic))throw Error(o(327));var n=e.callbackNode;if(xl()&&e.callbackNode!==n)return null;var i=ht(e,e===Ac?Oc:0);if(0===i)return null;if(0!==(30&i)||0!==(i&e.expiredLanes)||t)t=gl(e,i);else{t=i;var r=Ic;Ic|=2;var a=pl();for(Ac===e&&Oc===t||(qc=null,Vc=Ye()+500,hl(e,t));;)try{vl();break}catch(c){fl(e,c)}Co(),Tc.current=a,Ic=r,null!==Nc?t=0:(Ac=null,Oc=0,t=Lc)}if(0!==t){if(2===t&&(0!==(r=pt(e))&&(i=r,t=ol(e,r))),1===t)throw n=zc,hl(e,0),sl(e,i),il(e,Ye()),n;if(6===t)sl(e,i);else{if(r=e.current.alternate,0===(30&i)&&!function(e){for(var t=e;;){if(16384&t.flags){var n=t.updateQueue;if(null!==n&&null!==(n=n.stores))for(var i=0;i<n.length;i++){var r=n[i],o=r.getSnapshot;r=r.value;try{if(!si(o(),r))return!1}catch(s){return!1}}}if(n=t.child,16384&t.subtreeFlags&&null!==n)n.return=t,t=n;else{if(t===e)break;for(;null===t.sibling;){if(null===t.return||t.return===e)return!0;t=t.return}t.sibling.return=t.return,t=t.sibling}}return!0}(r)&&(2===(t=gl(e,i))&&(0!==(a=pt(e))&&(i=a,t=ol(e,a))),1===t))throw n=zc,hl(e,0),sl(e,i),il(e,Ye()),n;switch(e.finishedWork=r,e.finishedLanes=i,t){case 0:case 1:throw Error(o(345));case 2:case 5:bl(e,Fc,qc);break;case 3:if(sl(e,i),(130023424&i)===i&&10<(t=jc+500-Ye())){if(0!==ht(e,0))break;if(((r=e.suspendedLanes)&i)!==i){el(),e.pingedLanes|=e.suspendedLanes&r;break}e.timeoutHandle=ir(bl.bind(null,e,Fc,qc),t);break}bl(e,Fc,qc);break;case 4:if(sl(e,i),(4194240&i)===i)break;for(t=e.eventTimes,r=-1;0<i;){var s=31-at(i);a=1<<s,(s=t[s])>r&&(r=s),i&=~a}if(i=r,10<(i=(120>(i=Ye()-i)?120:480>i?480:1080>i?1080:1920>i?1920:3e3>i?3e3:4320>i?4320:1960*Ec(i/1960))-i)){e.timeoutHandle=ir(bl.bind(null,e,Fc,qc),i);break}bl(e,Fc,qc);break;default:throw Error(o(329))}}}return il(e,Ye()),e.callbackNode===n?rl.bind(null,e):null}function ol(e,t){var n=Uc;return e.current.memoizedState.isDehydrated&&(hl(e,t).flags|=256),2!==(e=gl(e,t))&&(t=Fc,Fc=n,null!==t&&al(t)),e}function al(e){null===Fc?Fc=e:Fc.push.apply(Fc,e)}function sl(e,t){for(t&=~Bc,t&=~Dc,e.suspendedLanes|=t,e.pingedLanes&=~t,e=e.expirationTimes;0<t;){var n=31-at(t),i=1<<n;e[n]=-1,t&=~i}}function cl(e){if(0!==(6&Ic))throw Error(o(327));xl();var t=ht(e,0);if(0===(1&t))return il(e,Ye()),null;var n=gl(e,t);if(0!==e.tag&&2===n){var i=pt(e);0!==i&&(t=i,n=ol(e,i))}if(1===n)throw n=zc,hl(e,0),sl(e,t),il(e,Ye()),n;if(6===n)throw Error(o(345));return e.finishedWork=e.current.alternate,e.finishedLanes=t,bl(e,Fc,qc),il(e,Ye()),null}function ll(e,t){var n=Ic;Ic|=1;try{return e(t)}finally{0===(Ic=n)&&(Vc=Ye()+500,Ur&&Vr())}}function ul(e){null!==Zc&&0===Zc.tag&&0===(6&Ic)&&xl();var t=Ic;Ic|=1;var n=Cc.transition,i=_t;try{if(Cc.transition=null,_t=1,e)return e()}finally{_t=i,Cc.transition=n,0===(6&(Ic=t))&&Vr()}}function dl(){Pc=Rc.current,Tr(Rc)}function hl(e,t){e.finishedWork=null,e.finishedLanes=0;var n=e.timeoutHandle;if(-1!==n&&(e.timeoutHandle=-1,rr(n)),null!==Nc)for(n=Nc.return;null!==n;){var i=n;switch(to(i),i.tag){case 1:null!==(i=i.type.childContextTypes)&&void 0!==i&&Rr();break;case 3:Yo(),Tr(Ar),Tr(Ir),ia();break;case 5:$o(i);break;case 4:Yo();break;case 13:case 19:Tr(ea);break;case 10:Io(i.type._context);break;case 22:case 23:dl()}n=n.return}if(Ac=e,Nc=e=Rl(e.current,null),Oc=Pc=t,Lc=0,zc=null,Bc=Dc=Mc=0,Fc=Uc=null,null!==Po){for(t=0;t<Po.length;t++)if(null!==(i=(n=Po[t]).interleaved)){n.interleaved=null;var r=i.next,o=n.pending;if(null!==o){var a=o.next;o.next=r,i.next=a}n.pending=i}Po=null}return e}function fl(e,t){for(;;){var n=Nc;try{if(Co(),ra.current=Ja,ua){for(var i=sa.memoizedState;null!==i;){var r=i.queue;null!==r&&(r.pending=null),i=i.next}ua=!1}if(aa=0,la=ca=sa=null,da=!1,ha=0,kc.current=null,null===n||null===n.return){Lc=1,zc=t,Nc=null;break}e:{var a=e,s=n.return,c=n,l=t;if(t=Oc,c.flags|=32768,null!==l&&"object"===typeof l&&"function"===typeof l.then){var u=l,d=c,h=d.tag;if(0===(1&d.mode)&&(0===h||11===h||15===h)){var f=d.alternate;f?(d.updateQueue=f.updateQueue,d.memoizedState=f.memoizedState,d.lanes=f.lanes):(d.updateQueue=null,d.memoizedState=null)}var p=gs(s);if(null!==p){p.flags&=-257,ys(p,s,c,0,t),1&p.mode&&ms(a,u,t),l=u;var m=(t=p).updateQueue;if(null===m){var g=new Set;g.add(l),t.updateQueue=g}else m.add(l);break e}if(0===(1&t)){ms(a,u,t),ml();break e}l=Error(o(426))}else if(ro&&1&c.mode){var y=gs(s);if(null!==y){0===(65536&y.flags)&&(y.flags|=256),ys(y,s,c,0,t),mo(ls(l,c));break e}}a=l=ls(l,c),4!==Lc&&(Lc=2),null===Uc?Uc=[a]:Uc.push(a),a=s;do{switch(a.tag){case 3:a.flags|=65536,t&=-t,a.lanes|=t,Vo(a,fs(0,l,t));break e;case 1:c=l;var v=a.type,_=a.stateNode;if(0===(128&a.flags)&&("function"===typeof v.getDerivedStateFromError||null!==_&&"function"===typeof _.componentDidCatch&&(null===Gc||!Gc.has(_)))){a.flags|=65536,t&=-t,a.lanes|=t,Vo(a,ps(a,c,t));break e}}a=a.return}while(null!==a)}wl(n)}catch(w){t=w,Nc===n&&null!==n&&(Nc=n=n.return);continue}break}}function pl(){var e=Tc.current;return Tc.current=Ja,null===e?Ja:e}function ml(){0!==Lc&&3!==Lc&&2!==Lc||(Lc=4),null===Ac||0===(268435455&Mc)&&0===(268435455&Dc)||sl(Ac,Oc)}function gl(e,t){var n=Ic;Ic|=2;var i=pl();for(Ac===e&&Oc===t||(qc=null,hl(e,t));;)try{yl();break}catch(r){fl(e,r)}if(Co(),Ic=n,Tc.current=i,null!==Nc)throw Error(o(261));return Ac=null,Oc=0,Lc}function yl(){for(;null!==Nc;)_l(Nc)}function vl(){for(;null!==Nc&&!Qe();)_l(Nc)}function _l(e){var t=Sc(e.alternate,e,Pc);e.memoizedProps=e.pendingProps,null===t?wl(e):Nc=t,kc.current=null}function wl(e){var t=e;do{var n=t.alternate;if(e=t.return,0===(32768&t.flags)){if(null!==(n=Ks(n,t,Pc)))return void(Nc=n)}else{if(null!==(n=Zs(n,t)))return n.flags&=32767,void(Nc=n);if(null===e)return Lc=6,void(Nc=null);e.flags|=32768,e.subtreeFlags=0,e.deletions=null}if(null!==(t=t.sibling))return void(Nc=t);Nc=t=e}while(null!==t);0===Lc&&(Lc=5)}function bl(e,t,n){var i=_t,r=Cc.transition;try{Cc.transition=null,_t=1,function(e,t,n,i){do{xl()}while(null!==Zc);if(0!==(6&Ic))throw Error(o(327));n=e.finishedWork;var r=e.finishedLanes;if(null===n)return null;if(e.finishedWork=null,e.finishedLanes=0,n===e.current)throw Error(o(177));e.callbackNode=null,e.callbackPriority=0;var a=n.lanes|n.childLanes;if(function(e,t){var n=e.pendingLanes&~t;e.pendingLanes=t,e.suspendedLanes=0,e.pingedLanes=0,e.expiredLanes&=t,e.mutableReadLanes&=t,e.entangledLanes&=t,t=e.entanglements;var i=e.eventTimes;for(e=e.expirationTimes;0<n;){var r=31-at(n),o=1<<r;t[r]=0,i[r]=-1,e[r]=-1,n&=~o}}(e,a),e===Ac&&(Nc=Ac=null,Oc=0),0===(2064&n.subtreeFlags)&&0===(2064&n.flags)||Kc||(Kc=!0,Al(tt,function(){return xl(),null})),a=0!==(15990&n.flags),0!==(15990&n.subtreeFlags)||a){a=Cc.transition,Cc.transition=null;var s=_t;_t=1;var c=Ic;Ic|=4,kc.current=null,function(e,t){if(er=Ht,fi(e=hi())){if("selectionStart"in e)var n={start:e.selectionStart,end:e.selectionEnd};else e:{var i=(n=(n=e.ownerDocument)&&n.defaultView||window).getSelection&&n.getSelection();if(i&&0!==i.rangeCount){n=i.anchorNode;var r=i.anchorOffset,a=i.focusNode;i=i.focusOffset;try{n.nodeType,a.nodeType}catch(b){n=null;break e}var s=0,c=-1,l=-1,u=0,d=0,h=e,f=null;t:for(;;){for(var p;h!==n||0!==r&&3!==h.nodeType||(c=s+r),h!==a||0!==i&&3!==h.nodeType||(l=s+i),3===h.nodeType&&(s+=h.nodeValue.length),null!==(p=h.firstChild);)f=h,h=p;for(;;){if(h===e)break t;if(f===n&&++u===r&&(c=s),f===a&&++d===i&&(l=s),null!==(p=h.nextSibling))break;f=(h=f).parentNode}h=p}n=-1===c||-1===l?null:{start:c,end:l}}else n=null}n=n||{start:0,end:0}}else n=null;for(tr={focusedElem:e,selectionRange:n},Ht=!1,Js=t;null!==Js;)if(e=(t=Js).child,0!==(1028&t.subtreeFlags)&&null!==e)e.return=t,Js=e;else for(;null!==Js;){t=Js;try{var m=t.alternate;if(0!==(1024&t.flags))switch(t.tag){case 0:case 11:case 15:case 5:case 6:case 4:case 17:break;case 1:if(null!==m){var g=m.memoizedProps,y=m.memoizedState,v=t.stateNode,_=v.getSnapshotBeforeUpdate(t.elementType===t.type?g:ns(t.type,g),y);v.__reactInternalSnapshotBeforeUpdate=_}break;case 3:var w=t.stateNode.containerInfo;1===w.nodeType?w.textContent="":9===w.nodeType&&w.documentElement&&w.removeChild(w.documentElement);break;default:throw Error(o(163))}}catch(b){El(t,t.return,b)}if(null!==(e=t.sibling)){e.return=t.return,Js=e;break}Js=t.return}m=tc,tc=!1}(e,n),gc(n,e),pi(tr),Ht=!!er,tr=er=null,e.current=n,vc(n,e,r),Xe(),Ic=c,_t=s,Cc.transition=a}else e.current=n;if(Kc&&(Kc=!1,Zc=e,Qc=r),a=e.pendingLanes,0===a&&(Gc=null),function(e){if(ot&&"function"===typeof ot.onCommitFiberRoot)try{ot.onCommitFiberRoot(rt,e,void 0,128===(128&e.current.flags))}catch(t){}}(n.stateNode),il(e,Ye()),null!==t)for(i=e.onRecoverableError,n=0;n<t.length;n++)r=t[n],i(r.value,{componentStack:r.stack,digest:r.digest});if(Hc)throw Hc=!1,e=Wc,Wc=null,e;0!==(1&Qc)&&0!==e.tag&&xl(),a=e.pendingLanes,0!==(1&a)?e===Yc?Xc++:(Xc=0,Yc=e):Xc=0,Vr()}(e,t,n,i)}finally{Cc.transition=r,_t=i}return null}function xl(){if(null!==Zc){var e=wt(Qc),t=Cc.transition,n=_t;try{if(Cc.transition=null,_t=16>e?16:e,null===Zc)var i=!1;else{if(e=Zc,Zc=null,Qc=0,0!==(6&Ic))throw Error(o(331));var r=Ic;for(Ic|=4,Js=e.current;null!==Js;){var a=Js,s=a.child;if(0!==(16&Js.flags)){var c=a.deletions;if(null!==c){for(var l=0;l<c.length;l++){var u=c[l];for(Js=u;null!==Js;){var d=Js;switch(d.tag){case 0:case 11:case 15:nc(8,d,a)}var h=d.child;if(null!==h)h.return=d,Js=h;else for(;null!==Js;){var f=(d=Js).sibling,p=d.return;if(oc(d),d===u){Js=null;break}if(null!==f){f.return=p,Js=f;break}Js=p}}}var m=a.alternate;if(null!==m){var g=m.child;if(null!==g){m.child=null;do{var y=g.sibling;g.sibling=null,g=y}while(null!==g)}}Js=a}}if(0!==(2064&a.subtreeFlags)&&null!==s)s.return=a,Js=s;else e:for(;null!==Js;){if(0!==(2048&(a=Js).flags))switch(a.tag){case 0:case 11:case 15:nc(9,a,a.return)}var v=a.sibling;if(null!==v){v.return=a.return,Js=v;break e}Js=a.return}}var _=e.current;for(Js=_;null!==Js;){var w=(s=Js).child;if(0!==(2064&s.subtreeFlags)&&null!==w)w.return=s,Js=w;else e:for(s=_;null!==Js;){if(0!==(2048&(c=Js).flags))try{switch(c.tag){case 0:case 11:case 15:ic(9,c)}}catch(x){El(c,c.return,x)}if(c===s){Js=null;break e}var b=c.sibling;if(null!==b){b.return=c.return,Js=b;break e}Js=c.return}}if(Ic=r,Vr(),ot&&"function"===typeof ot.onPostCommitFiberRoot)try{ot.onPostCommitFiberRoot(rt,e)}catch(x){}i=!0}return i}finally{_t=n,Cc.transition=t}}return!1}function Sl(e,t,n){e=Fo(e,t=fs(0,t=ls(n,t),1),1),t=el(),null!==e&&(yt(e,1,t),il(e,t))}function El(e,t,n){if(3===e.tag)Sl(e,e,n);else for(;null!==t;){if(3===t.tag){Sl(t,e,n);break}if(1===t.tag){var i=t.stateNode;if("function"===typeof t.type.getDerivedStateFromError||"function"===typeof i.componentDidCatch&&(null===Gc||!Gc.has(i))){t=Fo(t,e=ps(t,e=ls(n,e),1),1),e=el(),null!==t&&(yt(t,1,e),il(t,e));break}}t=t.return}}function Tl(e,t,n){var i=e.pingCache;null!==i&&i.delete(t),t=el(),e.pingedLanes|=e.suspendedLanes&n,Ac===e&&(Oc&n)===n&&(4===Lc||3===Lc&&(130023424&Oc)===Oc&&500>Ye()-jc?hl(e,0):Bc|=n),il(e,t)}function kl(e,t){0===t&&(0===(1&e.mode)?t=1:(t=ut,0===(130023424&(ut<<=1))&&(ut=4194304)));var n=el();null!==(e=zo(e,t))&&(yt(e,t,n),il(e,n))}function Cl(e){var t=e.memoizedState,n=0;null!==t&&(n=t.retryLane),kl(e,n)}function Il(e,t){var n=0;switch(e.tag){case 13:var i=e.stateNode,r=e.memoizedState;null!==r&&(n=r.retryLane);break;case 19:i=e.stateNode;break;default:throw Error(o(314))}null!==i&&i.delete(t),kl(e,n)}function Al(e,t){return Ke(e,t)}function Nl(e,t,n,i){this.tag=e,this.key=n,this.sibling=this.child=this.return=this.stateNode=this.type=this.elementType=null,this.index=0,this.ref=null,this.pendingProps=t,this.dependencies=this.memoizedState=this.updateQueue=this.memoizedProps=null,this.mode=i,this.subtreeFlags=this.flags=0,this.deletions=null,this.childLanes=this.lanes=0,this.alternate=null}function Ol(e,t,n,i){return new Nl(e,t,n,i)}function Pl(e){return!(!(e=e.prototype)||!e.isReactComponent)}function Rl(e,t){var n=e.alternate;return null===n?((n=Ol(e.tag,t,e.key,e.mode)).elementType=e.elementType,n.type=e.type,n.stateNode=e.stateNode,n.alternate=e,e.alternate=n):(n.pendingProps=t,n.type=e.type,n.flags=0,n.subtreeFlags=0,n.deletions=null),n.flags=14680064&e.flags,n.childLanes=e.childLanes,n.lanes=e.lanes,n.child=e.child,n.memoizedProps=e.memoizedProps,n.memoizedState=e.memoizedState,n.updateQueue=e.updateQueue,t=e.dependencies,n.dependencies=null===t?null:{lanes:t.lanes,firstContext:t.firstContext},n.sibling=e.sibling,n.index=e.index,n.ref=e.ref,n}function Ll(e,t,n,i,r,a){var s=2;if(i=e,"function"===typeof e)Pl(e)&&(s=1);else if("string"===typeof e)s=5;else e:switch(e){case S:return zl(n.children,r,a,t);case E:s=8,r|=8;break;case T:return(e=Ol(12,n,t,2|r)).elementType=T,e.lanes=a,e;case A:return(e=Ol(13,n,t,r)).elementType=A,e.lanes=a,e;case N:return(e=Ol(19,n,t,r)).elementType=N,e.lanes=a,e;case R:return Ml(n,r,a,t);default:if("object"===typeof e&&null!==e)switch(e.$$typeof){case k:s=10;break e;case C:s=9;break e;case I:s=11;break e;case O:s=14;break e;case P:s=16,i=null;break e}throw Error(o(130,null==e?e:typeof e,""))}return(t=Ol(s,n,t,r)).elementType=e,t.type=i,t.lanes=a,t}function zl(e,t,n,i){return(e=Ol(7,e,i,t)).lanes=n,e}function Ml(e,t,n,i){return(e=Ol(22,e,i,t)).elementType=R,e.lanes=n,e.stateNode={isHidden:!1},e}function Dl(e,t,n){return(e=Ol(6,e,null,t)).lanes=n,e}function Bl(e,t,n){return(t=Ol(4,null!==e.children?e.children:[],e.key,t)).lanes=n,t.stateNode={containerInfo:e.containerInfo,pendingChildren:null,implementation:e.implementation},t}function Ul(e,t,n,i,r){this.tag=t,this.containerInfo=e,this.finishedWork=this.pingCache=this.current=this.pendingChildren=null,this.timeoutHandle=-1,this.callbackNode=this.pendingContext=this.context=null,this.callbackPriority=0,this.eventTimes=gt(0),this.expirationTimes=gt(-1),this.entangledLanes=this.finishedLanes=this.mutableReadLanes=this.expiredLanes=this.pingedLanes=this.suspendedLanes=this.pendingLanes=0,this.entanglements=gt(0),this.identifierPrefix=i,this.onRecoverableError=r,this.mutableSourceEagerHydrationData=null}function Fl(e,t,n,i,r,o,a,s,c){return e=new Ul(e,t,n,s,c),1===t?(t=1,!0===o&&(t|=8)):t=0,o=Ol(3,null,null,t),e.current=o,o.stateNode=e,o.memoizedState={element:i,isDehydrated:n,cache:null,transitions:null,pendingSuspenseBoundaries:null},Do(o),e}function jl(e){if(!e)return Cr;e:{if(Ve(e=e._reactInternals)!==e||1!==e.tag)throw Error(o(170));var t=e;do{switch(t.tag){case 3:t=t.stateNode.context;break e;case 1:if(Pr(t.type)){t=t.stateNode.__reactInternalMemoizedMergedChildContext;break e}}t=t.return}while(null!==t);throw Error(o(171))}if(1===e.tag){var n=e.type;if(Pr(n))return zr(e,n,t)}return t}function Vl(e,t,n,i,r,o,a,s,c){return(e=Fl(n,i,!0,e,0,o,0,s,c)).context=jl(null),n=e.current,(o=Uo(i=el(),r=tl(n))).callback=void 0!==t&&null!==t?t:null,Fo(n,o,r),e.current.lanes=r,yt(e,r,i),il(e,i),e}function ql(e,t,n,i){var r=t.current,o=el(),a=tl(r);return n=jl(n),null===t.context?t.context=n:t.pendingContext=n,(t=Uo(o,a)).payload={element:e},null!==(i=void 0===i?null:i)&&(t.callback=i),null!==(e=Fo(r,t,a))&&(nl(e,r,a,o),jo(e,r,a)),a}function Hl(e){return(e=e.current).child?(e.child.tag,e.child.stateNode):null}function Wl(e,t){if(null!==(e=e.memoizedState)&&null!==e.dehydrated){var n=e.retryLane;e.retryLane=0!==n&&n<t?n:t}}function Gl(e,t){Wl(e,t),(e=e.alternate)&&Wl(e,t)}Sc=function(e,t,n){if(null!==e)if(e.memoizedProps!==t.pendingProps||Ar.current)_s=!0;else{if(0===(e.lanes&n)&&0===(128&t.flags))return _s=!1,function(e,t,n){switch(t.tag){case 3:As(t),po();break;case 5:Jo(t);break;case 1:Pr(t.type)&&Mr(t);break;case 4:Xo(t,t.stateNode.containerInfo);break;case 10:var i=t.type._context,r=t.memoizedProps.value;kr(So,i._currentValue),i._currentValue=r;break;case 13:if(null!==(i=t.memoizedState))return null!==i.dehydrated?(kr(ea,1&ea.current),t.flags|=128,null):0!==(n&t.child.childLanes)?Ds(e,t,n):(kr(ea,1&ea.current),null!==(e=Hs(e,t,n))?e.sibling:null);kr(ea,1&ea.current);break;case 19:if(i=0!==(n&t.childLanes),0!==(128&e.flags)){if(i)return Vs(e,t,n);t.flags|=128}if(null!==(r=t.memoizedState)&&(r.rendering=null,r.tail=null,r.lastEffect=null),kr(ea,ea.current),i)break;return null;case 22:case 23:return t.lanes=0,Es(e,t,n)}return Hs(e,t,n)}(e,t,n);_s=0!==(131072&e.flags)}else _s=!1,ro&&0!==(1048576&t.flags)&&$r(t,Gr,t.index);switch(t.lanes=0,t.tag){case 2:var i=t.type;qs(e,t),e=t.pendingProps;var r=Or(t,Ir.current);No(t,n),r=ga(null,t,i,e,r,n);var a=ya();return t.flags|=1,"object"===typeof r&&null!==r&&"function"===typeof r.render&&void 0===r.$$typeof?(t.tag=1,t.memoizedState=null,t.updateQueue=null,Pr(i)?(a=!0,Mr(t)):a=!1,t.memoizedState=null!==r.state&&void 0!==r.state?r.state:null,Do(t),r.updater=rs,t.stateNode=r,r._reactInternals=t,cs(t,i,e,n),t=Is(null,t,i,!0,a,n)):(t.tag=0,ro&&a&&eo(t),ws(null,t,r,n),t=t.child),t;case 16:i=t.elementType;e:{switch(qs(e,t),e=t.pendingProps,i=(r=i._init)(i._payload),t.type=i,r=t.tag=function(e){if("function"===typeof e)return Pl(e)?1:0;if(void 0!==e&&null!==e){if((e=e.$$typeof)===I)return 11;if(e===O)return 14}return 2}(i),e=ns(i,e),r){case 0:t=ks(null,t,i,e,n);break e;case 1:t=Cs(null,t,i,e,n);break e;case 11:t=bs(null,t,i,e,n);break e;case 14:t=xs(null,t,i,ns(i.type,e),n);break e}throw Error(o(306,i,""))}return t;case 0:return i=t.type,r=t.pendingProps,ks(e,t,i,r=t.elementType===i?r:ns(i,r),n);case 1:return i=t.type,r=t.pendingProps,Cs(e,t,i,r=t.elementType===i?r:ns(i,r),n);case 3:e:{if(As(t),null===e)throw Error(o(387));i=t.pendingProps,r=(a=t.memoizedState).element,Bo(e,t),qo(t,i,null,n);var s=t.memoizedState;if(i=s.element,a.isDehydrated){if(a={element:i,isDehydrated:!1,cache:s.cache,pendingSuspenseBoundaries:s.pendingSuspenseBoundaries,transitions:s.transitions},t.updateQueue.baseState=a,t.memoizedState=a,256&t.flags){t=Ns(e,t,i,n,r=ls(Error(o(423)),t));break e}if(i!==r){t=Ns(e,t,i,n,r=ls(Error(o(424)),t));break e}for(io=lr(t.stateNode.containerInfo.firstChild),no=t,ro=!0,oo=null,n=xo(t,null,i,n),t.child=n;n;)n.flags=-3&n.flags|4096,n=n.sibling}else{if(po(),i===r){t=Hs(e,t,n);break e}ws(e,t,i,n)}t=t.child}return t;case 5:return Jo(t),null===e&&lo(t),i=t.type,r=t.pendingProps,a=null!==e?e.memoizedProps:null,s=r.children,nr(i,r)?s=null:null!==a&&nr(i,a)&&(t.flags|=32),Ts(e,t),ws(e,t,s,n),t.child;case 6:return null===e&&lo(t),null;case 13:return Ds(e,t,n);case 4:return Xo(t,t.stateNode.containerInfo),i=t.pendingProps,null===e?t.child=bo(t,null,i,n):ws(e,t,i,n),t.child;case 11:return i=t.type,r=t.pendingProps,bs(e,t,i,r=t.elementType===i?r:ns(i,r),n);case 7:return ws(e,t,t.pendingProps,n),t.child;case 8:case 12:return ws(e,t,t.pendingProps.children,n),t.child;case 10:e:{if(i=t.type._context,r=t.pendingProps,a=t.memoizedProps,s=r.value,kr(So,i._currentValue),i._currentValue=s,null!==a)if(si(a.value,s)){if(a.children===r.children&&!Ar.current){t=Hs(e,t,n);break e}}else for(null!==(a=t.child)&&(a.return=t);null!==a;){var c=a.dependencies;if(null!==c){s=a.child;for(var l=c.firstContext;null!==l;){if(l.context===i){if(1===a.tag){(l=Uo(-1,n&-n)).tag=2;var u=a.updateQueue;if(null!==u){var d=(u=u.shared).pending;null===d?l.next=l:(l.next=d.next,d.next=l),u.pending=l}}a.lanes|=n,null!==(l=a.alternate)&&(l.lanes|=n),Ao(a.return,n,t),c.lanes|=n;break}l=l.next}}else if(10===a.tag)s=a.type===t.type?null:a.child;else if(18===a.tag){if(null===(s=a.return))throw Error(o(341));s.lanes|=n,null!==(c=s.alternate)&&(c.lanes|=n),Ao(s,n,t),s=a.sibling}else s=a.child;if(null!==s)s.return=a;else for(s=a;null!==s;){if(s===t){s=null;break}if(null!==(a=s.sibling)){a.return=s.return,s=a;break}s=s.return}a=s}ws(e,t,r.children,n),t=t.child}return t;case 9:return r=t.type,i=t.pendingProps.children,No(t,n),i=i(r=Oo(r)),t.flags|=1,ws(e,t,i,n),t.child;case 14:return r=ns(i=t.type,t.pendingProps),xs(e,t,i,r=ns(i.type,r),n);case 15:return Ss(e,t,t.type,t.pendingProps,n);case 17:return i=t.type,r=t.pendingProps,r=t.elementType===i?r:ns(i,r),qs(e,t),t.tag=1,Pr(i)?(e=!0,Mr(t)):e=!1,No(t,n),as(t,i,r),cs(t,i,r,n),Is(null,t,i,!0,e,n);case 19:return Vs(e,t,n);case 22:return Es(e,t,n)}throw Error(o(156,t.tag))};var Kl="function"===typeof reportError?reportError:function(e){console.error(e)};function Zl(e){this._internalRoot=e}function Ql(e){this._internalRoot=e}function Xl(e){return!(!e||1!==e.nodeType&&9!==e.nodeType&&11!==e.nodeType)}function Yl(e){return!(!e||1!==e.nodeType&&9!==e.nodeType&&11!==e.nodeType&&(8!==e.nodeType||" react-mount-point-unstable "!==e.nodeValue))}function Jl(){}function $l(e,t,n,i,r){var o=n._reactRootContainer;if(o){var a=o;if("function"===typeof r){var s=r;r=function(){var e=Hl(a);s.call(e)}}ql(t,a,e,r)}else a=function(e,t,n,i,r){if(r){if("function"===typeof i){var o=i;i=function(){var e=Hl(a);o.call(e)}}var a=Vl(t,i,e,0,null,!1,0,"",Jl);return e._reactRootContainer=a,e[pr]=a.current,Vi(8===e.nodeType?e.parentNode:e),ul(),a}for(;r=e.lastChild;)e.removeChild(r);if("function"===typeof i){var s=i;i=function(){var e=Hl(c);s.call(e)}}var c=Fl(e,0,!1,null,0,!1,0,"",Jl);return e._reactRootContainer=c,e[pr]=c.current,Vi(8===e.nodeType?e.parentNode:e),ul(function(){ql(t,c,n,i)}),c}(n,t,e,r,i);return Hl(a)}Ql.prototype.render=Zl.prototype.render=function(e){var t=this._internalRoot;if(null===t)throw Error(o(409));ql(e,t,null,null)},Ql.prototype.unmount=Zl.prototype.unmount=function(){var e=this._internalRoot;if(null!==e){this._internalRoot=null;var t=e.containerInfo;ul(function(){ql(null,e,null,null)}),t[pr]=null}},Ql.prototype.unstable_scheduleHydration=function(e){if(e){var t=Et();e={blockedOn:null,target:e,priority:t};for(var n=0;n<Rt.length&&0!==t&&t<Rt[n].priority;n++);Rt.splice(n,0,e),0===n&&Dt(e)}},bt=function(e){switch(e.tag){case 3:var t=e.stateNode;if(t.current.memoizedState.isDehydrated){var n=dt(t.pendingLanes);0!==n&&(vt(t,1|n),il(t,Ye()),0===(6&Ic)&&(Vc=Ye()+500,Vr()))}break;case 13:ul(function(){var t=zo(e,1);if(null!==t){var n=el();nl(t,e,1,n)}}),Gl(e,1)}},xt=function(e){if(13===e.tag){var t=zo(e,134217728);if(null!==t)nl(t,e,134217728,el());Gl(e,134217728)}},St=function(e){if(13===e.tag){var t=tl(e),n=zo(e,t);if(null!==n)nl(n,e,t,el());Gl(e,t)}},Et=function(){return _t},Tt=function(e,t){var n=_t;try{return _t=e,t()}finally{_t=n}},xe=function(e,t,n){switch(t){case"input":if(J(e,n),t=n.name,"radio"===n.type&&null!=t){for(n=e;n.parentNode;)n=n.parentNode;for(n=n.querySelectorAll("input[name="+JSON.stringify(""+t)+'][type="radio"]'),t=0;t<n.length;t++){var i=n[t];if(i!==e&&i.form===e.form){var r=br(i);if(!r)throw Error(o(90));K(i),J(i,r)}}}break;case"textarea":oe(e,n);break;case"select":null!=(t=n.value)&&ne(e,!!n.multiple,t,!1)}},Ie=ll,Ae=ul;var eu={usingClientEntryPoint:!1,Events:[_r,wr,br,ke,Ce,ll]},tu={findFiberByHostInstance:vr,bundleType:0,version:"18.3.1",rendererPackageName:"react-dom"},nu={bundleType:tu.bundleType,version:tu.version,rendererPackageName:tu.rendererPackageName,rendererConfig:tu.rendererConfig,overrideHookState:null,overrideHookStateDeletePath:null,overrideHookStateRenamePath:null,overrideProps:null,overridePropsDeletePath:null,overridePropsRenamePath:null,setErrorHandler:null,setSuspenseHandler:null,scheduleUpdate:null,currentDispatcherRef:w.ReactCurrentDispatcher,findHostInstanceByFiber:function(e){return null===(e=We(e))?null:e.stateNode},findFiberByHostInstance:tu.findFiberByHostInstance||function(){return null},findHostInstancesForRefresh:null,scheduleRefresh:null,scheduleRoot:null,setRefreshHandler:null,getCurrentFiber:null,reconcilerVersion:"18.3.1-next-f1338f8080-20240426"};if("undefined"!==typeof __REACT_DEVTOOLS_GLOBAL_HOOK__){var iu=__REACT_DEVTOOLS_GLOBAL_HOOK__;if(!iu.isDisabled&&iu.supportsFiber)try{rt=iu.inject(nu),ot=iu}catch(ue){}}t.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=eu,t.createPortal=function(e,t){var n=2<arguments.length&&void 0!==arguments[2]?arguments[2]:null;if(!Xl(t))throw Error(o(200));return function(e,t,n){var i=3<arguments.length&&void 0!==arguments[3]?arguments[3]:null;return{$$typeof:x,key:null==i?null:""+i,children:e,containerInfo:t,implementation:n}}(e,t,null,n)},t.createRoot=function(e,t){if(!Xl(e))throw Error(o(299));var n=!1,i="",r=Kl;return null!==t&&void 0!==t&&(!0===t.unstable_strictMode&&(n=!0),void 0!==t.identifierPrefix&&(i=t.identifierPrefix),void 0!==t.onRecoverableError&&(r=t.onRecoverableError)),t=Fl(e,1,!1,null,0,n,0,i,r),e[pr]=t.current,Vi(8===e.nodeType?e.parentNode:e),new Zl(t)},t.findDOMNode=function(e){if(null==e)return null;if(1===e.nodeType)return e;var t=e._reactInternals;if(void 0===t){if("function"===typeof e.render)throw Error(o(188));throw e=Object.keys(e).join(","),Error(o(268,e))}return e=null===(e=We(t))?null:e.stateNode},t.flushSync=function(e){return ul(e)},t.hydrate=function(e,t,n){if(!Yl(t))throw Error(o(200));return $l(null,e,t,!0,n)},t.hydrateRoot=function(e,t,n){if(!Xl(e))throw Error(o(405));var i=null!=n&&n.hydratedSources||null,r=!1,a="",s=Kl;if(null!==n&&void 0!==n&&(!0===n.unstable_strictMode&&(r=!0),void 0!==n.identifierPrefix&&(a=n.identifierPrefix),void 0!==n.onRecoverableError&&(s=n.onRecoverableError)),t=Vl(t,null,e,1,null!=n?n:null,r,0,a,s),e[pr]=t.current,Vi(e),i)for(e=0;e<i.length;e++)r=(r=(n=i[e])._getVersion)(n._source),null==t.mutableSourceEagerHydrationData?t.mutableSourceEagerHydrationData=[n,r]:t.mutableSourceEagerHydrationData.push(n,r);return new Ql(t)},t.render=function(e,t,n){if(!Yl(t))throw Error(o(200));return $l(null,e,t,!1,n)},t.unmountComponentAtNode=function(e){if(!Yl(e))throw Error(o(40));return!!e._reactRootContainer&&(ul(function(){$l(null,null,e,!1,function(){e._reactRootContainer=null,e[pr]=null})}),!0)},t.unstable_batchedUpdates=ll,t.unstable_renderSubtreeIntoContainer=function(e,t,n,i){if(!Yl(n))throw Error(o(200));if(null==e||void 0===e._reactInternals)throw Error(o(38));return $l(e,t,n,!1,i)},t.version="18.3.1-next-f1338f8080-20240426"},853:(e,t,n)=>{"use strict";e.exports=n(234)},950:(e,t,n)=>{"use strict";!function e(){if("undefined"!==typeof __REACT_DEVTOOLS_GLOBAL_HOOK__&&"function"===typeof __REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE)try{__REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE(e)}catch(t){console.error(t)}}(),e.exports=n(730)}},t={};function n(i){var r=t[i];if(void 0!==r)return r.exports;var o=t[i]={exports:{}};return e[i].call(o.exports,o,o.exports,n),o.exports}n.m=e,n.n=e=>{var t=e&&e.__esModule?()=>e.default:()=>e;return n.d(t,{a:t}),t},n.d=(e,t)=>{for(var i in t)n.o(t,i)&&!n.o(e,i)&&Object.defineProperty(e,i,{enumerable:!0,get:t[i]})},n.g=function(){if("object"===typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(e){if("object"===typeof window)return window}}(),n.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),n.p="/reef-monitor-app/",n.b="undefined"!==typeof document&&document.baseURI||self.location.href,(()=>{"use strict";var e=n(43),t=n(950);function i(e){return i="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},i(e)}function r(e){var t=function(e,t){if("object"!=i(e)||!e)return e;var n=e[Symbol.toPrimitive];if(void 0!==n){var r=n.call(e,t||"default");if("object"!=i(r))return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"==i(t)?t:t+""}function o(e,t,n){return(t=r(t))in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function a(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);t&&(i=i.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),n.push.apply(n,i)}return n}function s(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?a(Object(n),!0).forEach(function(t){o(e,t,n[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):a(Object(n)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))})}return e}function c(e,t){if(null==e)return{};var n,i,r=function(e,t){if(null==e)return{};var n={};for(var i in e)if({}.hasOwnProperty.call(e,i)){if(-1!==t.indexOf(i))continue;n[i]=e[i]}return n}(e,t);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);for(i=0;i<o.length;i++)n=o[i],-1===t.indexOf(n)&&{}.propertyIsEnumerable.call(e,n)&&(r[n]=e[n])}return r}var l={xmlns:"http://www.w3.org/2000/svg",width:24,height:24,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:2,strokeLinecap:"round",strokeLinejoin:"round"};const u=["color","size","strokeWidth","absoluteStrokeWidth","children"];var d=(t,n)=>{const i=(0,e.forwardRef)((i,r)=>{let{color:o="currentColor",size:a=24,strokeWidth:d=2,absoluteStrokeWidth:h,children:f}=i,p=c(i,u);return(0,e.createElement)("svg",s(s({ref:r},l),{},{width:a,height:a,stroke:o,strokeWidth:h?24*Number(d)/Number(a):d,className:"lucide lucide-".concat((m=t,m.replace(/([a-z0-9])([A-Z])/g,"$1-$2").toLowerCase()))},p),[...n.map(t=>{let[n,i]=t;return(0,e.createElement)(n,i)}),...(Array.isArray(f)?f:[f])||[]]);var m});return i.displayName="".concat(t),i};const h=d("History",[["path",{d:"M3 12a9 9 0 1 0 9-9 9.75 9.75 0 0 0-6.74 2.74L3 8",key:"1357e3"}],["path",{d:"M3 3v5h5",key:"1xhq8a"}],["path",{d:"M12 7v5l4 2",key:"1fdv2h"}]]),f=d("Map",[["polygon",{points:"3 6 9 3 15 6 21 3 21 18 15 21 9 18 3 21",key:"ok2ie8"}],["line",{x1:"9",x2:"9",y1:"3",y2:"18",key:"w34qz5"}],["line",{x1:"15",x2:"15",y1:"6",y2:"21",key:"volv9a"}]]),p=d("Loader",[["line",{x1:"12",x2:"12",y1:"2",y2:"6",key:"gza1u7"}],["line",{x1:"12",x2:"12",y1:"18",y2:"22",key:"1qhbu9"}],["line",{x1:"4.93",x2:"7.76",y1:"4.93",y2:"7.76",key:"xae44r"}],["line",{x1:"16.24",x2:"19.07",y1:"16.24",y2:"19.07",key:"bxnmvf"}],["line",{x1:"2",x2:"6",y1:"12",y2:"12",key:"89khin"}],["line",{x1:"18",x2:"22",y1:"12",y2:"12",key:"pb8tfm"}],["line",{x1:"4.93",x2:"7.76",y1:"19.07",y2:"16.24",key:"1uxjnu"}],["line",{x1:"16.24",x2:"19.07",y1:"7.76",y2:"4.93",key:"6duxfx"}]]),m=d("Camera",[["path",{d:"M14.5 4h-5L7 7H4a2 2 0 0 0-2 2v9a2 2 0 0 0 2 2h16a2 2 0 0 0 2-2V9a2 2 0 0 0-2-2h-3l-2.5-3z",key:"1tc9qg"}],["circle",{cx:"12",cy:"13",r:"3",key:"1vg3eu"}]]),g=d("Upload",[["path",{d:"M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4",key:"ih7n3h"}],["polyline",{points:"17 8 12 3 7 8",key:"t8dd8p"}],["line",{x1:"12",x2:"12",y1:"3",y2:"15",key:"widbto"}]]),y=d("Info",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"M12 16v-4",key:"1dtifu"}],["path",{d:"M12 8h.01",key:"e9boi3"}]]),v=d("ChevronRight",[["path",{d:"m9 18 6-6-6-6",key:"mthhwq"}]]),_=d("Trash2",[["path",{d:"M3 6h18",key:"d0wm0j"}],["path",{d:"M19 6v14c0 1-1 2-2 2H7c-1 0-2-1-2-2V6",key:"4alrt4"}],["path",{d:"M8 6V4c0-1 1-2 2-2h4c1 0 2 1 2 2v2",key:"v07s0e"}],["line",{x1:"10",x2:"10",y1:"11",y2:"17",key:"1uufr5"}],["line",{x1:"14",x2:"14",y1:"11",y2:"17",key:"xtxkd"}]]);var w,b,x,S,E,T,k,C,I,A,N,O,P,R,L,z,M,D,B,U,F,j,V,q,H,W,G,K,Z,Q,X,Y,J,$=Object.defineProperty,ee=Object.getOwnPropertyDescriptor,te=Object.getOwnPropertyNames,ne=Object.prototype.hasOwnProperty,ie=(e=>typeof require<"u"?require:typeof Proxy<"u"?new Proxy(e,{get:(e,t)=>(typeof require<"u"?require:e)[t]}):e)(function(e){if(typeof require<"u")return require.apply(this,arguments);throw Error('Dynamic require of "'+e+'" is not supported')}),re=(e,t)=>()=>(e&&(t=e(e=0)),t),oe=(e,t)=>{for(var n in t)$(e,n,{get:t[n],enumerable:!0})},ae=e=>((e,t,n,i)=>{if(t&&"object"==typeof t||"function"==typeof t)for(let r of te(t))!ne.call(e,r)&&r!==n&&$(e,r,{get:()=>t[r],enumerable:!(i=ee(t,r))||i.enumerable});return e})($({},"__esModule",{value:!0}),e),se=re(()=>{w=new Map,b=[],x=(e,t,n)=>{if(t&&"function"==typeof t.init&&"function"==typeof t.createInferenceSessionHandler){let i=w.get(e);if(void 0===i)w.set(e,{backend:t,priority:n});else{if(i.priority>n)return;if(i.priority===n&&i.backend!==t)throw new Error('cannot register backend "'.concat(e,'" using priority ').concat(n))}if(n>=0){let t=b.indexOf(e);-1!==t&&b.splice(t,1);for(let i=0;i<b.length;i++)if(w.get(b[i]).priority<=n)return void b.splice(i,0,e);b.push(e)}return}throw new TypeError("not a valid backend")},S=async e=>{let t=w.get(e);if(!t)return"backend not found.";if(t.initialized)return t.backend;if(t.aborted)return t.error;{let n=!!t.initPromise;try{return n||(t.initPromise=t.backend.init(e)),await t.initPromise,t.initialized=!0,t.backend}catch(Ak){return n||(t.error="".concat(Ak),t.aborted=!0),t.error}finally{delete t.initPromise}}},E=async e=>{let t,n=e.executionProviders||[],i=n.map(e=>"string"==typeof e?e:e.name),r=0===i.length?b:i,o=[],a=new Set;for(let c of r){let e=await S(c);"string"==typeof e?o.push({name:c,err:e}):(t||(t=e),t===e&&a.add(c))}if(!t)throw new Error("no available backend found. ERR: ".concat(o.map(e=>"[".concat(e.name,"] ").concat(e.err)).join(", ")));for(let{name:c,err:l}of o)i.includes(c)&&console.warn('removing requested execution provider "'.concat(c,'" from session options because it is not available: ').concat(l));let s=n.filter(e=>a.has("string"==typeof e?e:e.name));return[t,new Proxy(e,{get:(e,t)=>"executionProviders"===t?s:Reflect.get(e,t)})]}}),ce=re(()=>{se()}),le=re(()=>{T="1.23.2"}),ue=re(()=>{le(),k="warning",C={wasm:{},webgl:{},webgpu:{},versions:{common:T},set logLevel(e){if(void 0!==e){if("string"!=typeof e||-1===["verbose","info","warning","error","fatal"].indexOf(e))throw new Error("Unsupported logging level: ".concat(e));k=e}},get logLevel(){return k}},Object.defineProperty(C,"logLevel",{enumerable:!0})}),de=re(()=>{ue(),I=C}),he=re(()=>{A=(e,t)=>{let n=typeof document<"u"?document.createElement("canvas"):new OffscreenCanvas(1,1);n.width=e.dims[3],n.height=e.dims[2];let i=n.getContext("2d");if(null!=i){let r,o;void 0!==(null===t||void 0===t?void 0:t.tensorLayout)&&"NHWC"===t.tensorLayout?(r=e.dims[2],o=e.dims[3]):(r=e.dims[3],o=e.dims[2]);let a,s,c=void 0!==(null===t||void 0===t?void 0:t.format)?t.format:"RGB",l=null===t||void 0===t?void 0:t.norm;void 0===l||void 0===l.mean?a=[255,255,255,255]:"number"==typeof l.mean?a=[l.mean,l.mean,l.mean,l.mean]:(a=[l.mean[0],l.mean[1],l.mean[2],0],void 0!==l.mean[3]&&(a[3]=l.mean[3])),void 0===l||void 0===l.bias?s=[0,0,0,0]:"number"==typeof l.bias?s=[l.bias,l.bias,l.bias,l.bias]:(s=[l.bias[0],l.bias[1],l.bias[2],0],void 0!==l.bias[3]&&(s[3]=l.bias[3]));let u=o*r,d=0,h=u,f=2*u,p=-1;"RGBA"===c?(d=0,h=u,f=2*u,p=3*u):"RGB"===c?(d=0,h=u,f=2*u):"RBG"===c&&(d=0,f=u,h=2*u);for(let t=0;t<o;t++)for(let n=0;n<r;n++){let r=(e.data[d++]-s[0])*a[0],o=(e.data[h++]-s[1])*a[1],c=(e.data[f++]-s[2])*a[2],l=-1===p?255:(e.data[p++]-s[3])*a[3];i.fillStyle="rgba("+r+","+o+","+c+","+l+")",i.fillRect(n,t,1,1)}if("toDataURL"in n)return n.toDataURL();throw new Error("toDataURL is not supported")}throw new Error("Can not access image data")},N=(e,t)=>{let n,i=typeof document<"u"?document.createElement("canvas").getContext("2d"):new OffscreenCanvas(1,1).getContext("2d");if(null==i)throw new Error("Can not access image data");{let r,o,a;void 0!==(null===t||void 0===t?void 0:t.tensorLayout)&&"NHWC"===t.tensorLayout?(r=e.dims[2],o=e.dims[1],a=e.dims[3]):(r=e.dims[3],o=e.dims[2],a=e.dims[1]);let s,c,l=void 0!==t&&void 0!==t.format?t.format:"RGB",u=null===t||void 0===t?void 0:t.norm;void 0===u||void 0===u.mean?s=[255,255,255,255]:"number"==typeof u.mean?s=[u.mean,u.mean,u.mean,u.mean]:(s=[u.mean[0],u.mean[1],u.mean[2],255],void 0!==u.mean[3]&&(s[3]=u.mean[3])),void 0===u||void 0===u.bias?c=[0,0,0,0]:"number"==typeof u.bias?c=[u.bias,u.bias,u.bias,u.bias]:(c=[u.bias[0],u.bias[1],u.bias[2],0],void 0!==u.bias[3]&&(c[3]=u.bias[3]));let d=o*r;if(void 0!==t&&(void 0!==t.format&&4===a&&"RGBA"!==t.format||3===a&&"RGB"!==t.format&&"BGR"!==t.format))throw new Error("Tensor format doesn't match input tensor dims");let h=4,f=0,p=1,m=2,g=3,y=0,v=d,_=2*d,w=-1;"RGBA"===l?(y=0,v=d,_=2*d,w=3*d):"RGB"===l?(y=0,v=d,_=2*d):"RBG"===l&&(y=0,_=d,v=2*d),n=i.createImageData(r,o);for(let t=0;t<o*r;f+=h,p+=h,m+=h,g+=h,t++)n.data[f]=(e.data[y++]-c[0])*s[0],n.data[p]=(e.data[v++]-c[1])*s[1],n.data[m]=(e.data[_++]-c[2])*s[2],n.data[g]=-1===w?255:(e.data[w++]-c[3])*s[3]}return n}}),fe=re(()=>{ge(),O=(e,t)=>{var n,i,r;if(void 0===e)throw new Error("Image buffer must be defined");if(void 0===t.height||void 0===t.width)throw new Error("Image height and width must be defined");if("NHWC"===t.tensorLayout)throw new Error("NHWC Tensor layout is not supported yet");let o,a,{height:s,width:c}=t,l=null!==(n=t.norm)&&void 0!==n?n:{mean:255,bias:0};o="number"==typeof l.mean?[l.mean,l.mean,l.mean,l.mean]:[l.mean[0],l.mean[1],l.mean[2],null!==(i=l.mean[3])&&void 0!==i?i:255],a="number"==typeof l.bias?[l.bias,l.bias,l.bias,l.bias]:[l.bias[0],l.bias[1],l.bias[2],null!==(r=l.bias[3])&&void 0!==r?r:0];let u=void 0!==t.format?t.format:"RGBA",d=void 0!==t.tensorFormat&&void 0!==t.tensorFormat?t.tensorFormat:"RGB",h=s*c,f="RGBA"===d?new Float32Array(4*h):new Float32Array(3*h),p=4,m=0,g=1,y=2,v=3,_=0,w=h,b=2*h,x=-1;"RGB"===u&&(p=3,m=0,g=1,y=2,v=-1),"RGBA"===d?x=3*h:"RBG"===d?(_=0,b=h,w=2*h):"BGR"===d&&(b=0,w=h,_=2*h);for(let S=0;S<h;S++,m+=p,y+=p,g+=p,v+=p)f[_++]=(e[m]+a[0])/o[0],f[w++]=(e[g]+a[1])/o[1],f[b++]=(e[y]+a[2])/o[2],-1!==x&&-1!==v&&(f[x++]=(e[v]+a[3])/o[3]);return new q("float32",f,"RGBA"===d?[1,4,s,c]:[1,3,s,c])},P=async(e,t)=>{let n,i=typeof HTMLImageElement<"u"&&e instanceof HTMLImageElement,r=typeof ImageData<"u"&&e instanceof ImageData,o=typeof ImageBitmap<"u"&&e instanceof ImageBitmap,a="string"==typeof e,s=null!==t&&void 0!==t?t:{},c=()=>{if(typeof document<"u")return document.createElement("canvas");if(typeof OffscreenCanvas<"u")return new OffscreenCanvas(1,1);throw new Error("Canvas is not supported")},l=e=>typeof HTMLCanvasElement<"u"&&e instanceof HTMLCanvasElement||e instanceof OffscreenCanvas?e.getContext("2d"):null;if(i){let i=c();i.width=e.width,i.height=e.height;let r=l(i);if(null==r)throw new Error("Can not access image data");{let i=e.height,o=e.width;if(void 0!==t&&void 0!==t.resizedHeight&&void 0!==t.resizedWidth&&(i=t.resizedHeight,o=t.resizedWidth),void 0!==t){if(s=t,void 0!==t.tensorFormat)throw new Error("Image input config format must be RGBA for HTMLImageElement");s.tensorFormat="RGBA",s.height=i,s.width=o}else s.tensorFormat="RGBA",s.height=i,s.width=o;r.drawImage(e,0,0),n=r.getImageData(0,0,o,i).data}}else{if(!r){if(o){if(void 0===t)throw new Error("Please provide image config with format for Imagebitmap");let i=c();i.width=e.width,i.height=e.height;let r=l(i);if(null!=r){let t=e.height,i=e.width;return r.drawImage(e,0,0,i,t),n=r.getImageData(0,0,i,t).data,s.height=t,s.width=i,O(n,s)}throw new Error("Can not access image data")}if(a)return new Promise((t,n)=>{let i=c(),r=l(i);if(!e||!r)return n();let o=new Image;o.crossOrigin="Anonymous",o.src=e,o.onload=()=>{i.width=o.width,i.height=o.height,r.drawImage(o,0,0,i.width,i.height);let e=r.getImageData(0,0,i.width,i.height);s.height=i.height,s.width=i.width,t(O(e.data,s))}});throw new Error("Input data provided is not supported - aborted tensor creation")}{let i,r;if(void 0!==t&&void 0!==t.resizedWidth&&void 0!==t.resizedHeight?(i=t.resizedHeight,r=t.resizedWidth):(i=e.height,r=e.width),void 0!==t&&(s=t),s.format="RGBA",s.height=i,s.width=r,void 0!==t){let t=c();t.width=r,t.height=i;let o=l(t);if(null==o)throw new Error("Can not access image data");o.putImageData(e,0,0),n=o.getImageData(0,0,r,i).data}else n=e.data}}if(void 0!==n)return O(n,s);throw new Error("Input data provided is not supported - aborted tensor creation")},R=(e,t)=>{let{width:n,height:i,download:r,dispose:o}=t;return new q({location:"texture",type:"float32",texture:e,dims:[1,i,n,4],download:r,dispose:o})},L=(e,t)=>{let{dataType:n,dims:i,download:r,dispose:o}=t;return new q({location:"gpu-buffer",type:null!==n&&void 0!==n?n:"float32",gpuBuffer:e,dims:i,download:r,dispose:o})},z=(e,t)=>{let{dataType:n,dims:i,download:r,dispose:o}=t;return new q({location:"ml-tensor",type:null!==n&&void 0!==n?n:"float32",mlTensor:e,dims:i,download:r,dispose:o})},M=(e,t,n)=>new q({location:"cpu-pinned",type:e,data:t,dims:null!==n&&void 0!==n?n:[t.length]})}),pe=re(()=>{D=new Map([["float32",Float32Array],["uint8",Uint8Array],["int8",Int8Array],["uint16",Uint16Array],["int16",Int16Array],["int32",Int32Array],["bool",Uint8Array],["float64",Float64Array],["uint32",Uint32Array],["int4",Uint8Array],["uint4",Uint8Array]]),B=new Map([[Float32Array,"float32"],[Uint8Array,"uint8"],[Int8Array,"int8"],[Uint16Array,"uint16"],[Int16Array,"int16"],[Int32Array,"int32"],[Float64Array,"float64"],[Uint32Array,"uint32"]]),U=!1,F=()=>{if(!U){U=!0;let e=typeof BigInt64Array<"u"&&BigInt64Array.from,t=typeof BigUint64Array<"u"&&BigUint64Array.from,n=globalThis.Float16Array,i=typeof n<"u"&&n.from;e&&(D.set("int64",BigInt64Array),B.set(BigInt64Array,"int64")),t&&(D.set("uint64",BigUint64Array),B.set(BigUint64Array,"uint64")),i?(D.set("float16",n),B.set(n,"float16")):D.set("float16",Uint16Array)}}}),me=re(()=>{ge(),j=e=>{let t=1;for(let n=0;n<e.length;n++){let i=e[n];if("number"!=typeof i||!Number.isSafeInteger(i))throw new TypeError("dims[".concat(n,"] must be an integer, got: ").concat(i));if(i<0)throw new RangeError("dims[".concat(n,"] must be a non-negative integer, got: ").concat(i));t*=i}return t},V=(e,t)=>{switch(e.location){case"cpu":return new q(e.type,e.data,t);case"cpu-pinned":return new q({location:"cpu-pinned",data:e.data,type:e.type,dims:t});case"texture":return new q({location:"texture",texture:e.texture,type:e.type,dims:t});case"gpu-buffer":return new q({location:"gpu-buffer",gpuBuffer:e.gpuBuffer,type:e.type,dims:t});case"ml-tensor":return new q({location:"ml-tensor",mlTensor:e.mlTensor,type:e.type,dims:t});default:throw new Error("tensorReshape: tensor location ".concat(e.location," is not supported"))}}}),ge=re(()=>{he(),fe(),pe(),me(),q=class{constructor(e,t,n){let i,r;if(F(),"object"==typeof e&&"location"in e)switch(this.dataLocation=e.location,i=e.type,r=e.dims,e.location){case"cpu-pinned":{let t=D.get(i);if(!t)throw new TypeError('unsupported type "'.concat(i,'" to create tensor from pinned buffer'));if(!(e.data instanceof t))throw new TypeError("buffer should be of type ".concat(t.name));this.cpuData=e.data;break}case"texture":if("float32"!==i)throw new TypeError('unsupported type "'.concat(i,'" to create tensor from texture'));this.gpuTextureData=e.texture,this.downloader=e.download,this.disposer=e.dispose;break;case"gpu-buffer":if("float32"!==i&&"float16"!==i&&"int32"!==i&&"int64"!==i&&"uint32"!==i&&"uint8"!==i&&"bool"!==i&&"uint4"!==i&&"int4"!==i)throw new TypeError('unsupported type "'.concat(i,'" to create tensor from gpu buffer'));this.gpuBufferData=e.gpuBuffer,this.downloader=e.download,this.disposer=e.dispose;break;case"ml-tensor":if("float32"!==i&&"float16"!==i&&"int32"!==i&&"int64"!==i&&"uint32"!==i&&"uint64"!==i&&"int8"!==i&&"uint8"!==i&&"bool"!==i&&"uint4"!==i&&"int4"!==i)throw new TypeError('unsupported type "'.concat(i,'" to create tensor from MLTensor'));this.mlTensorData=e.mlTensor,this.downloader=e.download,this.disposer=e.dispose;break;default:throw new Error("Tensor constructor: unsupported location '".concat(this.dataLocation,"'"))}else{let o,a;if("string"==typeof e)if(i=e,a=n,"string"===e){if(!Array.isArray(t))throw new TypeError("A string tensor's data must be a string array.");o=t}else{let n=D.get(e);if(void 0===n)throw new TypeError("Unsupported tensor type: ".concat(e,"."));if(Array.isArray(t)){if("float16"===e&&n===Uint16Array||"uint4"===e||"int4"===e)throw new TypeError("Creating a ".concat(e," tensor from number array is not supported. Please use ").concat(n.name," as data."));o="uint64"===e||"int64"===e?n.from(t,BigInt):n.from(t)}else if(t instanceof n)o=t;else if(t instanceof Uint8ClampedArray){if("uint8"!==e)throw new TypeError("A Uint8ClampedArray tensor's data must be type of uint8");o=Uint8Array.from(t)}else{if(!("float16"===e&&t instanceof Uint16Array&&n!==Uint16Array))throw new TypeError("A ".concat(i," tensor's data must be type of ").concat(n));o=new globalThis.Float16Array(t.buffer,t.byteOffset,t.length)}}else if(a=t,Array.isArray(e)){if(0===e.length)throw new TypeError("Tensor type cannot be inferred from an empty array.");let t=typeof e[0];if("string"===t)i="string",o=e;else{if("boolean"!==t)throw new TypeError("Invalid element type of data array: ".concat(t,"."));i="bool",o=Uint8Array.from(e)}}else if(e instanceof Uint8ClampedArray)i="uint8",o=Uint8Array.from(e);else{let t=B.get(e.constructor);if(void 0===t)throw new TypeError("Unsupported type for tensor data: ".concat(e.constructor,"."));i=t,o=e}if(void 0===a)a=[o.length];else if(!Array.isArray(a))throw new TypeError("A tensor's dims must be a number array");r=a,this.cpuData=o,this.dataLocation="cpu"}let o=j(r);if(this.cpuData&&o!==this.cpuData.length&&("uint4"!==i&&"int4"!==i||Math.ceil(o/2)!==this.cpuData.length))throw new Error("Tensor's size(".concat(o,") does not match data length(").concat(this.cpuData.length,")."));this.type=i,this.dims=r,this.size=o}static async fromImage(e,t){return P(e,t)}static fromTexture(e,t){return R(e,t)}static fromGpuBuffer(e,t){return L(e,t)}static fromMLTensor(e,t){return z(e,t)}static fromPinnedBuffer(e,t,n){return M(e,t,n)}toDataURL(e){return A(this,e)}toImageData(e){return N(this,e)}get data(){if(this.ensureValid(),!this.cpuData)throw new Error("The data is not on CPU. Use `getData()` to download GPU data to CPU, or use `texture` or `gpuBuffer` property to access the GPU data directly.");return this.cpuData}get location(){return this.dataLocation}get texture(){if(this.ensureValid(),!this.gpuTextureData)throw new Error("The data is not stored as a WebGL texture.");return this.gpuTextureData}get gpuBuffer(){if(this.ensureValid(),!this.gpuBufferData)throw new Error("The data is not stored as a WebGPU buffer.");return this.gpuBufferData}get mlTensor(){if(this.ensureValid(),!this.mlTensorData)throw new Error("The data is not stored as a WebNN MLTensor.");return this.mlTensorData}async getData(e){switch(this.ensureValid(),this.dataLocation){case"cpu":case"cpu-pinned":return this.data;case"texture":case"gpu-buffer":case"ml-tensor":if(!this.downloader)throw new Error("The current tensor is not created with a specified data downloader.");if(this.isDownloading)throw new Error("The current tensor is being downloaded.");try{this.isDownloading=!0;let t=await this.downloader();return this.downloader=void 0,this.dataLocation="cpu",this.cpuData=t,e&&this.disposer&&(this.disposer(),this.disposer=void 0),t}finally{this.isDownloading=!1}default:throw new Error("cannot get data from location: ".concat(this.dataLocation))}}dispose(){if(this.isDownloading)throw new Error("The current tensor is being downloaded.");this.disposer&&(this.disposer(),this.disposer=void 0),this.cpuData=void 0,this.gpuTextureData=void 0,this.gpuBufferData=void 0,this.mlTensorData=void 0,this.downloader=void 0,this.isDownloading=void 0,this.dataLocation="none"}ensureValid(){if("none"===this.dataLocation)throw new Error("The tensor is disposed.")}reshape(e){if(this.ensureValid(),this.downloader||this.disposer)throw new Error("Cannot reshape a tensor that owns GPU resource.");return V(this,e)}}}),ye=re(()=>{ge(),H=q}),ve=re(()=>{ue(),W=(e,t)=>{(typeof C.trace>"u"?!C.wasm.trace:!C.trace)||console.timeStamp("".concat(e,"::ORT::").concat(t))},G=(e,t)=>{var n;let i=(null===(n=(new Error).stack)||void 0===n?void 0:n.split(/\r\n|\r|\n/g))||[],r=!1;for(let o=0;o<i.length;o++){if(r&&!i[o].includes("TRACE_FUNC")){let n="FUNC_".concat(e,"::").concat(i[o].trim().split(" ")[1]);return t&&(n+="::".concat(t)),void W("CPU",n)}i[o].includes("TRACE_FUNC")&&(r=!0)}},K=e=>{(typeof C.trace>"u"?!C.wasm.trace:!C.trace)||G("BEGIN",e)},Z=e=>{(typeof C.trace>"u"?!C.wasm.trace:!C.trace)||G("END",e)},Q=e=>{(typeof C.trace>"u"?!C.wasm.trace:!C.trace)||console.time("ORT::".concat(e))},X=e=>{(typeof C.trace>"u"?!C.wasm.trace:!C.trace)||console.timeEnd("ORT::".concat(e))}}),_e=re(()=>{se(),ye(),ve(),Y=class e{constructor(e){this.handler=e}async run(e,t,n){K(),Q("InferenceSession.run");let i={},r={};if("object"!=typeof e||null===e||e instanceof H||Array.isArray(e))throw new TypeError("'feeds' must be an object that use input names as keys and OnnxValue as corresponding values.");let o=!0;if("object"==typeof t){if(null===t)throw new TypeError("Unexpected argument[1]: cannot be null.");if(t instanceof H)throw new TypeError("'fetches' cannot be a Tensor");if(Array.isArray(t)){if(0===t.length)throw new TypeError("'fetches' cannot be an empty array.");o=!1;for(let e of t){if("string"!=typeof e)throw new TypeError("'fetches' must be a string array or an object.");if(-1===this.outputNames.indexOf(e))throw new RangeError("'fetches' contains invalid output name: ".concat(e,"."));i[e]=null}if("object"==typeof n&&null!==n)r=n;else if(typeof n<"u")throw new TypeError("'options' must be an object.")}else{let e=!1,a=Object.getOwnPropertyNames(t);for(let n of this.outputNames)if(-1!==a.indexOf(n)){let r=t[n];(null===r||r instanceof H)&&(e=!0,o=!1,i[n]=r)}if(e){if("object"==typeof n&&null!==n)r=n;else if(typeof n<"u")throw new TypeError("'options' must be an object.")}else r=t}}else if(typeof t<"u")throw new TypeError("Unexpected argument[1]: must be 'fetches' or 'options'.");for(let c of this.inputNames)if(typeof e[c]>"u")throw new Error("input '".concat(c,"' is missing in 'feeds'."));if(o)for(let c of this.outputNames)i[c]=null;let a=await this.handler.run(e,i,r),s={};for(let c in a)if(Object.hasOwnProperty.call(a,c)){let e=a[c];s[c]=e instanceof H?e:new H(e.type,e.data,e.dims)}return X("InferenceSession.run"),Z(),s}async release(){return this.handler.dispose()}static async create(t,n,i,r){K(),Q("InferenceSession.create");let o,a={};if("string"==typeof t){if(o=t,"object"==typeof n&&null!==n)a=n;else if(typeof n<"u")throw new TypeError("'options' must be an object.")}else if(t instanceof Uint8Array){if(o=t,"object"==typeof n&&null!==n)a=n;else if(typeof n<"u")throw new TypeError("'options' must be an object.")}else{if(!(t instanceof ArrayBuffer||typeof SharedArrayBuffer<"u"&&t instanceof SharedArrayBuffer))throw new TypeError("Unexpected argument[0]: must be 'path' or 'buffer'.");{let e=t,s=0,c=t.byteLength;if("object"==typeof n&&null!==n)a=n;else if("number"==typeof n){if(s=n,!Number.isSafeInteger(s))throw new RangeError("'byteOffset' must be an integer.");if(s<0||s>=e.byteLength)throw new RangeError("'byteOffset' is out of range [0, ".concat(e.byteLength,")."));if(c=t.byteLength-s,"number"==typeof i){if(c=i,!Number.isSafeInteger(c))throw new RangeError("'byteLength' must be an integer.");if(c<=0||s+c>e.byteLength)throw new RangeError("'byteLength' is out of range (0, ".concat(e.byteLength-s,"]."));if("object"==typeof r&&null!==r)a=r;else if(typeof r<"u")throw new TypeError("'options' must be an object.")}else if(typeof i<"u")throw new TypeError("'byteLength' must be a number.")}else if(typeof n<"u")throw new TypeError("'options' must be an object.");o=new Uint8Array(e,s,c)}}let[s,c]=await E(a),l=await s.createInferenceSessionHandler(o,c);return X("InferenceSession.create"),Z(),new e(l)}startProfiling(){this.handler.startProfiling()}endProfiling(){this.handler.endProfiling()}get inputNames(){return this.handler.inputNames}get outputNames(){return this.handler.outputNames}get inputMetadata(){return this.handler.inputMetadata}get outputMetadata(){return this.handler.outputMetadata}}}),we=re(()=>{_e(),J=Y}),be=re(()=>{}),xe=re(()=>{}),Se=re(()=>{}),Ee=re(()=>{}),Te={};oe(Te,{InferenceSession:()=>J,TRACE:()=>W,TRACE_EVENT_BEGIN:()=>Q,TRACE_EVENT_END:()=>X,TRACE_FUNC_BEGIN:()=>K,TRACE_FUNC_END:()=>Z,Tensor:()=>H,env:()=>I,registerBackend:()=>x});var ke=re(()=>{ce(),de(),we(),ye(),be(),xe(),ve(),Se(),Ee()}),Ce=re(()=>{}),Ie={};oe(Ie,{default:()=>Oe});var Ae,Ne,Oe,Pe=re(()=>{var e;kd(),wl(),_l(),Ae="ort-wasm-proxy-worker",(Ne=(null===(e=globalThis.self)||void 0===e?void 0:e.name)===Ae)&&(self.onmessage=e=>{let{type:t,in:n}=e.data;try{switch(t){case"init-wasm":it(n.wasm).then(()=>{Gu(n).then(()=>{postMessage({type:t})},e=>{postMessage({type:t,err:e})})},e=>{postMessage({type:t,err:e})});break;case"init-ep":{let{epName:e,env:i}=n;Ku(i,e).then(()=>{postMessage({type:t})},e=>{postMessage({type:t,err:e})});break}case"copy-from":{let{buffer:e}=n,i=Yu(e);postMessage({type:t,out:i});break}case"create":{let{model:e,options:i}=n;Ju(e,i).then(e=>{postMessage({type:t,out:e})},e=>{postMessage({type:t,err:e})});break}case"release":$u(n),postMessage({type:t});break;case"run":{let{sessionId:e,inputIndices:i,inputs:r,outputIndices:o,options:a}=n;td(e,i,r,o,new Array(o.length).fill(null),a).then(e=>{e.some(e=>"cpu"!==e[3])?postMessage({type:t,err:"Proxy does not support non-cpu tensor location."}):postMessage({type:t,out:e},id([...r,...e]))},e=>{postMessage({type:t,err:e})});break}case"end-profiling":nd(n),postMessage({type:t})}}catch(Ak){postMessage({type:t,err:Ak})}}),Oe=Ne?null:e=>new Worker(null!==e&&void 0!==e?e:Ue,{type:"module",name:Ae})}),Re={};oe(Re,{default:()=>ze});var Le,ze,Me,De,Be,Ue,Fe,je,Ve,qe,He,We,Ge,Ke,Ze,Qe,Xe,Ye,Je,$e,et,tt,nt,it,rt,ot,at,st,ct,lt,ut,dt,ht,ft,pt,mt,gt,yt,vt,_t,wt,bt,xt,St,Et,Tt,kt,Ct,It,At,Nt,Ot,Pt,Rt,Lt,zt,Mt,Dt,Bt,Ut,Ft,jt,Vt,qt,Ht,Wt,Gt,Kt,Zt,Qt,Xt,Yt,Jt,$t,en,tn,nn,rn,on,an,sn,cn,ln,un,dn,hn,fn,pn,mn,gn,yn,vn,_n,wn,bn,xn,Sn,En,Tn,kn,Cn,In,An,Nn,On,Pn,Rn,Ln,zn,Mn,Dn,Bn,Un,Fn,jn,Vn,qn,Hn,Wn,Gn,Kn,Zn,Qn,Xn,Yn,Jn,$n,ei,ti,ni,ii,ri,oi,ai,si,ci,li,ui,di,hi,fi,pi,mi,gi,yi,vi,_i,wi,bi,xi,Si,Ei,Ti,ki,Ci,Ii,Ai,Ni,Oi,Pi,Ri,Li,zi,Mi,Di,Bi,Ui,Fi,ji,Vi,qi,Hi,Wi,Gi,Ki,Zi,Qi,Xi,Yi,Ji,$i,er,tr,nr,ir,rr,or,ar,sr,cr,lr,ur,dr,hr,fr,pr,mr,gr,yr,vr,_r,wr,br,xr,Sr,Er,Tr,kr,Cr,Ir,Ar,Nr,Or,Pr,Rr,Lr,zr,Mr,Dr,Br,Ur,Fr,jr,Vr,qr,Hr,Wr,Gr,Kr,Zr,Qr,Xr,Yr,Jr,$r,eo,to,no,io,ro,oo,ao,so,co,lo,uo,ho,fo,po,mo,go,yo,vo,_o,wo,bo,xo,So,Eo,To,ko,Co,Io,Ao,No,Oo,Po,Ro,Lo,zo,Mo,Do,Bo,Uo,Fo,jo,Vo,qo,Ho,Wo,Go,Ko,Zo,Qo,Xo,Yo,Jo,$o,ea,ta,na,ia,ra,oa,aa,sa,ca,la,ua,da,ha,fa,pa,ma,ga,ya,va,_a,wa,ba,xa,Sa,Ea,Ta,ka,Ca,Ia,Aa,Na,Oa,Pa,Ra,La,za,Ma,Da,Ba,Ua,Fa,ja,Va,qa,Ha,Wa,Ga,Ka,Za,Qa,Xa,Ya,Ja,$a,es,ts,ns,is,rs,os,as,ss,cs,ls,us,ds,hs,fs,ps,ms,gs,ys,vs,_s,ws,bs,xs,Ss,Es,Ts,ks,Cs,Is,As,Ns,Os,Ps,Rs,Ls,zs,Ms,Ds,Bs,Us,Fs,js,Vs,qs,Hs,Ws,Gs,Ks,Zs,Qs,Xs,Ys,Js,$s,ec,tc,nc,ic,rc,oc,ac,sc,cc,lc,uc,dc,hc,fc,pc,mc,gc,yc,vc,_c,wc,bc,xc,Sc,Ec,Tc,kc,Cc,Ic,Ac,Nc,Oc,Pc,Rc,Lc,zc,Mc,Dc,Bc,Uc,Fc,jc,Vc,qc,Hc,Wc,Gc,Kc,Zc,Qc,Xc,Yc,Jc,$c,el,tl,nl,il,rl,ol,al,sl,cl,ll,ul,dl,hl,fl,pl,ml,gl,yl,vl=re(()=>{var e;Le=async function(){var e,t;var i,r,a=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},s=new Promise((e,t)=>{i=e,r=t}),c="object"==typeof window,l=typeof WorkerGlobalScope<"u",u=l&&(null===(e=self.name)||void 0===e?void 0:e.startsWith("em-pthread"));a.mountExternalData=(e,t)=>{e.startsWith("./")&&(e=e.substring(2)),(a.Fb||(a.Fb=new Map)).set(e,t)},a.unmountExternalData=()=>{delete a.Fb};var d=null!==(t=globalThis.SharedArrayBuffer)&&void 0!==t?t:new WebAssembly.Memory({initial:0,maximum:0,qc:!0}).buffer.constructor;let h=e=>async function(){try{var t;if(a.Gb)throw Error("Session already started");let n=a.Gb={ec:arguments.length<=0?void 0:arguments[0],errors:[]},i=await e(...arguments);if(a.Gb!==n)throw Error("Session mismatch");null===(t=a.Kb)||void 0===t||t.flush();let r=n.errors;if(0<r.length){let e=await Promise.all(r);if(e=e.filter(e=>e),0<e.length)throw Error(e.join("\n"))}return i}finally{a.Gb=null}};a.jsepInit=(e,t)=>{if("webgpu"===e){[a.Kb,a.Vb,a.Zb,a.Lb,a.Yb,a.Ab,a.$b,a.bc,a.Wb,a.Xb,a.ac]=t;let e=a.Kb;a.jsepRegisterBuffer=(t,n,i,r)=>e.registerBuffer(t,n,i,r),a.jsepGetBuffer=t=>e.getBuffer(t),a.jsepCreateDownloader=(t,n,i)=>e.createDownloader(t,n,i),a.jsepOnCreateSession=t=>{e.onCreateSession(t)},a.jsepOnReleaseSession=t=>{e.onReleaseSession(t)},a.jsepOnRunStart=t=>e.onRunStart(t),a.cc=(t,n)=>{e.upload(t,n)}}else if("webnn"===e){let e=t[0];[a.oc,a.Ob,a.webnnEnsureTensor,a.Pb,a.webnnDownloadTensor,a.nc,a.webnnEnableTraceEvent]=t.slice(1),a.webnnReleaseTensorId=a.Ob,a.webnnUploadTensor=a.Pb,a.webnnRegisterMLContext=a.nc,a.webnnOnRunStart=t=>e.onRunStart(t),a.webnnOnRunEnd=e.onRunEnd.bind(e),a.webnnOnReleaseSession=t=>{e.onReleaseSession(t)},a.webnnCreateMLTensorDownloader=(t,n)=>e.createMLTensorDownloader(t,n),a.webnnRegisterMLTensor=(t,n,i,r)=>e.registerMLTensor(t,n,i,r),a.webnnCreateMLContext=t=>e.createMLContext(t),a.webnnRegisterMLConstant=(t,n,i,r,o,s)=>e.registerMLConstant(t,n,i,r,o,a.Fb,s),a.webnnRegisterGraphInput=e.registerGraphInput.bind(e),a.webnnIsGraphInput=e.isGraphInput.bind(e),a.webnnRegisterGraphOutput=e.registerGraphOutput.bind(e),a.webnnIsGraphOutput=e.isGraphOutput.bind(e),a.webnnCreateTemporaryTensor=e.createTemporaryTensor.bind(e),a.webnnIsGraphInputOutputTypeSupported=e.isGraphInputOutputTypeSupported.bind(e)}};let f=()=>{let e=(e,t,n)=>function(){for(var i,r,o=arguments.length,a=new Array(o),s=0;s<o;s++)a[s]=arguments[s];let c=Ut,l=null===(i=t)||void 0===i?void 0:i();a=e(...a);let u=null===(r=t)||void 0===r?void 0:r();return l!==u&&(e=u,n(l),t=n=null),Ut!=c?new Promise((e,t)=>{Wt={resolve:e,reject:t}}):a};(()=>{for(let t of["_OrtAppendExecutionProvider","_OrtCreateSession","_OrtRun","_OrtRunWithBinding","_OrtBindInput"])a[t]=e(a[t],()=>a[t],e=>a[t]=e)})(),void 0!==h&&(a._OrtRun=h(a._OrtRun),a._OrtRunWithBinding=h(a._OrtRunWithBinding)),f=void 0};a.asyncInit=()=>{var e;null===(e=f)||void 0===e||e()};var p,m,g=(e,t)=>{throw t},y="";if(c||l){try{y=new URL(".","file:///c:/reef-monitor/node_modules/onnxruntime-web/dist/ort.bundle.min.mjs").href}catch(Pi){}l&&(m=e=>{var t=new XMLHttpRequest;return t.open("GET",e,!1),t.responseType="arraybuffer",t.send(null),new Uint8Array(t.response)}),p=async e=>{if(B(e))return new Promise((t,n)=>{var i=new XMLHttpRequest;i.open("GET",e,!0),i.responseType="arraybuffer",i.onload=()=>{200==i.status||0==i.status&&i.response?t(i.response):n(i.status)},i.onerror=n,i.send(null)});var t=await fetch(e,{credentials:"same-origin"});if(t.ok)return t.arrayBuffer();throw Error(t.status+" : "+t.url)}}var v,_,w,b,x,S,E,T,k,C,I,A,N,O,P,R=console.log.bind(console),L=console.error.bind(console),z=R,M=L,D=!1,B=e=>e.startsWith("file://");function U(){return _.buffer!=x.buffer&&Z(),x}function F(){return _.buffer!=x.buffer&&Z(),S}function j(){return _.buffer!=x.buffer&&Z(),E}function V(){return _.buffer!=x.buffer&&Z(),T}function q(){return _.buffer!=x.buffer&&Z(),k}function H(){return _.buffer!=x.buffer&&Z(),C}function W(){return _.buffer!=x.buffer&&Z(),I}function G(){return _.buffer!=x.buffer&&Z(),O}if(u){let e=function(t){try{var n=t.data,i=n.Db;if("load"===i){let t=[];self.onmessage=e=>t.push(e),self.startWorker=()=>{postMessage({Db:"loaded"});for(let n of t)e(n);self.onmessage=e};for(let e of n.Sb)a[e]&&!a[e].proxy||(a[e]=function(){for(var t=arguments.length,n=new Array(t),i=0;i<t;i++)n[i]=arguments[i];postMessage({Db:"callHandler",Rb:e,args:n})},"print"==e&&(z=a[e]),"printErr"==e&&(M=a[e]));_=n.kc,Z(),P(n.lc)}else if("run"===i){_e(n.Bb),gi(n.Bb,0,0,1,0,0),ge(),Tt(n.Bb),K||(hi(),K=!0);try{we(n.hc,n.Jb)}catch(r){if("unwind"!=r)throw r}}else"setimmediate"!==n.target&&("checkMailbox"===i?K&&kt():i&&(M("worker: received unknown command ".concat(i)),M(n)))}catch(r){throw yi(),r}};var K=!1;self.onunhandledrejection=e=>{throw e.reason||e},self.onmessage=e}function Z(){var e=_.buffer;a.HEAP8=x=new Int8Array(e),E=new Int16Array(e),a.HEAPU8=S=new Uint8Array(e),T=new Uint16Array(e),a.HEAP32=k=new Int32Array(e),a.HEAPU32=C=new Uint32Array(e),I=new Float32Array(e),O=new Float64Array(e),A=new BigInt64Array(e),N=new BigUint64Array(e)}function Q(){u?startWorker(a):ui.Da()}var X,Y=0,J=null;function $(){if(0==--Y&&J){var e=J;J=null,e()}}function ee(e){throw M(e="Aborted("+e+")"),D=!0,e=new WebAssembly.RuntimeError(e+". Build with -sASSERTIONS for more info."),r(e),e}function te(){return{a:{L:li,Aa:ci,b:xe,$:Ee,A:Ie,pa:Ae,X:Ne,Z:Oe,qa:Pe,na:Re,ga:Le,ma:ze,J:Me,Y:De,V:Be,oa:Ue,W:Fe,va:Ve,E:Xe,Q:Je,O:at,D:ct,v:lt,s:ut,P:ft,z:bt,R:xt,ja:St,T:Ct,aa:At,M:Nt,F:Ot,ia:Tt,sa:Pt,r:zt,Ca:Mt,w:Zt,o:Xt,m:$t,c:tt,Ba:en,n:nn,j:an,u:sn,p:cn,f:ln,t:un,l:dn,e:hn,k:fn,h:pn,g:mn,d:gn,da:yn,ea:bn,fa:xn,ba:Sn,ca:En,N:Cn,xa:In,ua:On,i:Ln,C:zn,G:Mn,ta:An,x:Dn,ra:Bn,U:Un,q:kn,y:Fn,K:jn,S:Vn,za:Gn,ya:Kn,ka:Yn,la:Jn,_:ue,B:$n,I:ei,ha:ti,H:ii,a:_,wa:ce}}}class ne{constructor(e){o(this,"name","ExitStatus"),this.message="Program terminated with exit(".concat(e,")"),this.status=e}}var ie=e=>{e.terminate(),e.onmessage=()=>{}},re=[],oe=e=>{0==de.length&&(ve(),ye(de[0]));var t=de.pop();if(!t)return 6;he.push(t),pe[e.Bb]=t,t.Bb=e.Bb;var n={Db:"run",hc:e.fc,Jb:e.Jb,Bb:e.Bb};return t.postMessage(n,e.Nb),0},ae=0,se=function(e,t){for(var n=2*(arguments.length<=2?0:arguments.length-2),i=ki(),r=Ti(8*n),o=r>>>3,a=0;a<(arguments.length<=2?0:arguments.length-2);a++){var s=a+2<2||arguments.length<=a+2?void 0:arguments[a+2];"bigint"==typeof s?(A[o+2*a]=1n,A[o+2*a+1]=s):(A[o+2*a]=0n,G()[o+2*a+1>>>0]=s)}return e=vi(e,0,n,r,t),Ei(i),e};function ce(e){if(u)return se(0,1,e);if(b=e,!(0<ae)){for(var t of he)ie(t);for(t of de)ie(t);de=[],he=[],pe={},D=!0}g(0,new ne(e))}function le(e){if(u)return se(1,0,e);ue(e)}var ue=e=>{if(b=e,u)throw le(e),"unwind";ce(e)},de=[],he=[],fe=[],pe={},me=e=>{var t=e.Bb;delete pe[t],de.push(e),he.splice(he.indexOf(e),1),e.Bb=0,_i(t)};function ge(){fe.forEach(e=>e())}var ye=e=>new Promise(t=>{e.onmessage=n=>{var i=(n=n.data).Db;if(n.Hb&&n.Hb!=fi()){var r=pe[n.Hb];r?r.postMessage(n,n.Nb):M('Internal error! Worker sent a message "'.concat(i,'" to target pthread ').concat(n.Hb,", but that thread no longer exists!"))}else"checkMailbox"===i?kt():"spawnThread"===i?oe(n):"cleanupThread"===i?me(pe[n.ic]):"loaded"===i?(e.loaded=!0,t(e)):"setimmediate"===n.target?e.postMessage(n):"callHandler"===i?a[n.Rb](...n.args):i&&M("worker sent an unknown command ".concat(i))},e.onerror=e=>{throw M("worker sent an error! ".concat(e.filename,":").concat(e.lineno,": ").concat(e.message)),e};var n,i=[];for(n of[])a.propertyIsEnumerable(n)&&i.push(n);e.postMessage({Db:"load",Sb:i,kc:_,lc:w})});function ve(){var e=new Worker(new URL(n(618),n.b),{type:"module",workerData:"em-pthread",name:"em-pthread"});de.push(e)}var _e=e=>{Z();var t=H()[e+52>>>2>>>0];e=H()[e+56>>>2>>>0],Si(t,t-e),Ei(t)},we=(e,t)=>{ae=0,e=Ci(e,t),0<ae?b=e:wi(e)};class be{constructor(e){this.Ib=e-24}}function xe(e,t,n){var i=new be(e>>>=0);throw t>>>=0,n>>>=0,H()[i.Ib+16>>>2>>>0]=0,H()[i.Ib+4>>>2>>>0]=t,H()[i.Ib+8>>>2>>>0]=n,e}function Se(e,t,n,i){return u?se(2,1,e,t,n,i):Ee(e,t,n,i)}function Ee(e,t,n,i){if(e>>>=0,n>>>=0,i>>>=0,void 0===d)return 6;var r=[];return u&&0===r.length?Se(e,t>>>=0,n,i):(e={fc:n,Bb:e,Jb:i,Nb:r},u?(e.Db="spawnThread",postMessage(e,r),0):oe(e))}var Te=typeof TextDecoder<"u"?new TextDecoder:void 0,ke=function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:NaN;var i=(t>>>=0)+n;for(n=t;e[n]&&!(n>=i);)++n;if(16<n-t&&e.buffer&&Te)return Te.decode(e.buffer instanceof ArrayBuffer?e.subarray(t,n):e.slice(t,n));for(i="";t<n;){var r=e[t++];if(128&r){var o=63&e[t++];if(192==(224&r))i+=String.fromCharCode((31&r)<<6|o);else{var a=63&e[t++];65536>(r=224==(240&r)?(15&r)<<12|o<<6|a:(7&r)<<18|o<<12|a<<6|63&e[t++])?i+=String.fromCharCode(r):(r-=65536,i+=String.fromCharCode(55296|r>>10,56320|1023&r))}}else i+=String.fromCharCode(r)}return i},Ce=(e,t)=>(e>>>=0)?ke(F(),e,t):"";function Ie(e,t,n){return u?se(3,1,e,t,n):0}function Ae(e,t){if(u)return se(4,1,e,t)}function Ne(e,t){if(u)return se(5,1,e,t)}function Oe(e,t,n){if(u)return se(6,1,e,t,n)}function Pe(e,t,n){return u?se(7,1,e,t,n):0}function Re(e,t){if(u)return se(8,1,e,t)}function Le(e,t,n){if(u)return se(9,1,e,t,n)}function ze(e,t,n,i){if(u)return se(10,1,e,t,n,i)}function Me(e,t,n,i){if(u)return se(11,1,e,t,n,i)}function De(e,t,n,i){if(u)return se(12,1,e,t,n,i)}function Be(e){if(u)return se(13,1,e)}function Ue(e,t){if(u)return se(14,1,e,t)}function Fe(e,t,n){if(u)return se(15,1,e,t,n)}var je,Ve=()=>ee(""),qe=e=>{for(var t="";F()[e>>>0];)t+=je[F()[e++>>>0]];return t},He={},We={},Ge={},Ke=a.BindingError=class extends Error{constructor(e){super(e),this.name="BindingError"}};function Ze(e,t){return function(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};var i=t.name;if(!e)throw new Ke('type "'.concat(i,'" must have a positive integer typeid pointer'));if(We.hasOwnProperty(e)){if(n.Tb)return;throw new Ke("Cannot register type '".concat(i,"' twice"))}We[e]=t,delete Ge[e],He.hasOwnProperty(e)&&(t=He[e],delete He[e],t.forEach(e=>e()))}(e,t,arguments.length>2&&void 0!==arguments[2]?arguments[2]:{})}var Qe=(e,t,n)=>{switch(t){case 1:return n?e=>U()[e>>>0]:e=>F()[e>>>0];case 2:return n?e=>j()[e>>>1>>>0]:e=>V()[e>>>1>>>0];case 4:return n?e=>q()[e>>>2>>>0]:e=>H()[e>>>2>>>0];case 8:return n?e=>A[e>>>3]:e=>N[e>>>3];default:throw new TypeError("invalid integer width (".concat(t,"): ").concat(e))}};function Xe(e,t,n){n>>>=0,Ze(e>>>=0,{name:t=qe(t>>>0),fromWireType:e=>e,toWireType:function(e,t){if("bigint"!=typeof t&&"number"!=typeof t)throw t=null===t?"null":"object"==(e=typeof t)||"array"===e||"function"===e?t.toString():""+t,new TypeError('Cannot convert "'.concat(t,'" to ').concat(this.name));return"number"==typeof t&&(t=BigInt(t)),t},Cb:Ye,readValueFromPointer:Qe(t,n,-1==t.indexOf("u")),Eb:null})}var Ye=8;function Je(e,t,n,i){Ze(e>>>=0,{name:t=qe(t>>>0),fromWireType:function(e){return!!e},toWireType:function(e,t){return t?n:i},Cb:Ye,readValueFromPointer:function(e){return this.fromWireType(F()[e>>>0])},Eb:null})}var $e=[],et=[];function tt(e){9<(e>>>=0)&&0==--et[e+1]&&(et[e]=void 0,$e.push(e))}var nt=e=>{if(!e)throw new Ke("Cannot use deleted val. handle = ".concat(e));return et[e]},it=e=>{switch(e){case void 0:return 2;case null:return 4;case!0:return 6;case!1:return 8;default:let t=$e.pop()||et.length;return et[t]=e,et[t+1]=1,t}};function rt(e){return this.fromWireType(H()[e>>>2>>>0])}var ot={name:"emscripten::val",fromWireType:e=>{var t=nt(e);return tt(e),t},toWireType:(e,t)=>it(t),Cb:Ye,readValueFromPointer:rt,Eb:null};function at(e){return Ze(e>>>0,ot)}var st=(e,t)=>{switch(t){case 4:return function(e){return this.fromWireType(W()[e>>>2>>>0])};case 8:return function(e){return this.fromWireType(G()[e>>>3>>>0])};default:throw new TypeError("invalid float width (".concat(t,"): ").concat(e))}};function ct(e,t,n){n>>>=0,Ze(e>>>=0,{name:t=qe(t>>>0),fromWireType:e=>e,toWireType:(e,t)=>t,Cb:Ye,readValueFromPointer:st(t,n),Eb:null})}function lt(e,t,n,i,r){if(e>>>=0,n>>>=0,t=qe(t>>>0),-1===r&&(r=4294967295),r=e=>e,0===i){var o=32-8*n;r=e=>e<<o>>>o}var a=t.includes("unsigned")?function(e,t){return t>>>0}:function(e,t){return t};Ze(e,{name:t,fromWireType:r,toWireType:a,Cb:Ye,readValueFromPointer:Qe(t,n,0!==i),Eb:null})}function ut(e,t,n){function i(e){var t=H()[e>>>2>>>0];return e=H()[e+4>>>2>>>0],new r(U().buffer,e,t)}var r=[Int8Array,Uint8Array,Int16Array,Uint16Array,Int32Array,Uint32Array,Float32Array,Float64Array,BigInt64Array,BigUint64Array][t];Ze(e>>>=0,{name:n=qe(n>>>0),fromWireType:i,Cb:Ye,readValueFromPointer:i},{Tb:!0})}var dt=(e,t,n)=>{var i=F();if(t>>>=0,0<n){var r=t;n=t+n-1;for(var o=0;o<e.length;++o){var a=e.charCodeAt(o);if(55296<=a&&57343>=a&&(a=65536+((1023&a)<<10)|1023&e.charCodeAt(++o)),127>=a){if(t>=n)break;i[t++>>>0]=a}else{if(2047>=a){if(t+1>=n)break;i[t++>>>0]=192|a>>6}else{if(65535>=a){if(t+2>=n)break;i[t++>>>0]=224|a>>12}else{if(t+3>=n)break;i[t++>>>0]=240|a>>18,i[t++>>>0]=128|a>>12&63}i[t++>>>0]=128|a>>6&63}i[t++>>>0]=128|63&a}}i[t>>>0]=0,e=t-r}else e=0;return e},ht=e=>{for(var t=0,n=0;n<e.length;++n){var i=e.charCodeAt(n);127>=i?t++:2047>=i?t+=2:55296<=i&&57343>=i?(t+=4,++n):t+=3}return t};function ft(e,t){Ze(e>>>=0,{name:t=qe(t>>>0),fromWireType:function(e){for(var t,n=H()[e>>>2>>>0],i=e+4,r=i,o=0;o<=n;++o){var a=i+o;o!=n&&0!=F()[a>>>0]||(r=Ce(r,a-r),void 0===t?t=r:(t+="\0",t+=r),r=a+1)}return pi(e),t},toWireType:function(e,t){t instanceof ArrayBuffer&&(t=new Uint8Array(t));var n="string"==typeof t;if(!(n||ArrayBuffer.isView(t)&&1==t.BYTES_PER_ELEMENT))throw new Ke("Cannot pass non-string to std::string");var i=n?ht(t):t.length,r=mi(4+i+1),o=r+4;return H()[r>>>2>>>0]=i,n?dt(t,o,i+1):F().set(t,o>>>0),null!==e&&e.push(pi,r),r},Cb:Ye,readValueFromPointer:rt,Eb(e){pi(e)}})}var pt=typeof TextDecoder<"u"?new TextDecoder("utf-16le"):void 0,mt=(e,t)=>{for(var n=e>>1,i=n+t/2;!(n>=i)&&V()[n>>>0];)++n;if(32<(n<<=1)-e&&pt)return pt.decode(F().slice(e,n));for(n="",i=0;!(i>=t/2);++i){var r=j()[e+2*i>>>1>>>0];if(0==r)break;n+=String.fromCharCode(r)}return n},gt=(e,t,n)=>{if(null!==n&&void 0!==n||(n=2147483647),2>n)return 0;var i=t;n=(n-=2)<2*e.length?n/2:e.length;for(var r=0;r<n;++r){var o=e.charCodeAt(r);j()[t>>>1>>>0]=o,t+=2}return j()[t>>>1>>>0]=0,t-i},yt=e=>2*e.length,vt=(e,t)=>{for(var n=0,i="";!(n>=t/4);){var r=q()[e+4*n>>>2>>>0];if(0==r)break;++n,65536<=r?(r-=65536,i+=String.fromCharCode(55296|r>>10,56320|1023&r)):i+=String.fromCharCode(r)}return i},_t=(e,t,n)=>{if(null!==n&&void 0!==n||(n=2147483647),4>n)return 0;var i=t>>>=0;n=i+n-4;for(var r=0;r<e.length;++r){var o=e.charCodeAt(r);if(55296<=o&&57343>=o&&(o=65536+((1023&o)<<10)|1023&e.charCodeAt(++r)),q()[t>>>2>>>0]=o,(t+=4)+4>n)break}return q()[t>>>2>>>0]=0,t-i},wt=e=>{for(var t=0,n=0;n<e.length;++n){var i=e.charCodeAt(n);55296<=i&&57343>=i&&++n,t+=4}return t};function bt(e,t,n){if(e>>>=0,t>>>=0,n=qe(n>>>=0),2===t)var i=mt,r=gt,o=yt,a=e=>V()[e>>>1>>>0];else 4===t&&(i=vt,r=_t,o=wt,a=e=>H()[e>>>2>>>0]);Ze(e,{name:n,fromWireType:e=>{for(var n,r=H()[e>>>2>>>0],o=e+4,s=0;s<=r;++s){var c=e+4+s*t;s!=r&&0!=a(c)||(o=i(o,c-o),void 0===n?n=o:(n+="\0",n+=o),o=c+t)}return pi(e),n},toWireType:(e,i)=>{if("string"!=typeof i)throw new Ke("Cannot pass non-string to C++ string type ".concat(n));var a=o(i),s=mi(4+a+t);return H()[s>>>2>>>0]=a/t,r(i,s+4,a+t),null!==e&&e.push(pi,s),s},Cb:Ye,readValueFromPointer:rt,Eb(e){pi(e)}})}function xt(e,t){Ze(e>>>=0,{Ub:!0,name:t=qe(t>>>0),Cb:0,fromWireType:()=>{},toWireType:()=>{}})}function St(e){gi(e>>>0,!l,1,!c,131072,!1),ge()}var Et=e=>{if(!D)try{if(e(),!(0<ae))try{u?wi(b):ue(b)}catch(t){t instanceof ne||"unwind"==t||g(0,t)}}catch(t){t instanceof ne||"unwind"==t||g(0,t)}};function Tt(e){e>>>=0,"function"==typeof Atomics.jc&&(Atomics.jc(q(),e>>>2,e).value.then(kt),e+=128,Atomics.store(q(),e>>>2,1))}var kt=()=>{var e=fi();e&&(Tt(e),Et(xi))};function Ct(e,t){(e>>>=0)==t>>>0?setTimeout(kt):u?postMessage({Hb:e,Db:"checkMailbox"}):(e=pe[e])&&e.postMessage({Db:"checkMailbox"})}var It=[];function At(e,t,n,i,r){for(t>>>=0,i/=2,It.length=i,n=r>>>0>>>3,r=0;r<i;r++)It[r]=A[n+2*r]?A[n+2*r+1]:G()[n+2*r+1>>>0];return(t?si[t]:ai[e])(...It)}var Nt=()=>{ae=0};function Ot(e){e>>>=0,u?postMessage({Db:"cleanupThread",ic:e}):me(pe[e])}function Pt(e){}var Rt=(e,t)=>{var n=We[e];if(void 0===n)throw e=di(e),n=qe(e),pi(e),new Ke("".concat(t," has unknown type ").concat(n));return n},Lt=(e,t,n)=>{var i=[];return e=e.toWireType(i,n),i.length&&(H()[t>>>2>>>0]=it(i)),e};function zt(e,t,n){return t>>>=0,n>>>=0,e=nt(e>>>0),t=Rt(t,"emval::as"),Lt(t,n,e)}function Mt(e,t){return t>>>=0,e=nt(e>>>0),(t=Rt(t,"emval::as")).toWireType(null,e)}var Dt=e=>{try{e()}catch(t){ee(t)}},Bt=0,Ut=null,Ft=0,jt=[],Vt={},qt={},Ht=0,Wt=null,Gt=[];function Kt(e){return function(){if(!D){if(0===Bt){var t=!1,n=!1;(t=>{e().then(t)})(function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;if(!D&&(Ft=e,t=!0,n)){Bt=2,Dt(()=>Ni(Ut)),typeof MainLoop<"u"&&MainLoop.Qb&&MainLoop.resume(),e=!1;try{var i=function(){var e=q()[Ut+8>>>2>>>0];return e=ui[qt[e]],--ae,e()}()}catch(a){i=a,e=!0}var r=!1;if(!Ut){var o=Wt;o&&(Wt=null,(e?o.reject:o.resolve)(i),r=!0)}if(e&&!r)throw i}}),n=!0,t||(Bt=1,Ut=function(){var e=mi(65548),t=e+12;H()[e>>>2>>>0]=t,H()[e+4>>>2>>>0]=t+65536,t=jt[0];var n=Vt[t];return void 0===n&&(n=Ht++,Vt[t]=n,qt[n]=t),t=n,q()[e+8>>>2>>>0]=t,e}(),typeof MainLoop<"u"&&MainLoop.Qb&&MainLoop.pause(),Dt(()=>Ii(Ut)))}else 2===Bt?(Bt=0,Dt(Oi),pi(Ut),Ut=null,Gt.forEach(Et)):ee("invalid state: ".concat(Bt));return Ft}}()}function Zt(e){return e>>>=0,Kt(async()=>{var t=await nt(e);return it(t)})}var Qt=[];function Xt(e,t,n,i){return n>>>=0,i>>>=0,(e=Qt[e>>>0])(null,t=nt(t>>>0),n,i)}var Yt={},Jt=e=>{var t=Yt[e];return void 0===t?qe(e):t};function $t(e,t,n,i,r){return n>>>=0,i>>>=0,r>>>=0,(e=Qt[e>>>0])(t=nt(t>>>0),t[n=Jt(n)],i,r)}function en(e,t){return t>>>=0,(e=nt(e>>>0))==nt(t)}var tn=()=>"object"==typeof globalThis?globalThis:Function("return this")();function nn(e){return 0==(e>>>=0)?it(tn()):(e=Jt(e),it(tn()[e]))}var rn=e=>{var t=Qt.length;return Qt.push(e),t},on=(e,t)=>{for(var n=Array(e),i=0;i<e;++i)n[i]=Rt(H()[t+4*i>>>2>>>0],"parameter ".concat(i));return n};function an(e,t,n){var i=(t=on(e,t>>>0)).shift();e--;var r="return function (obj, func, destructorsRef, args) {\n",o=0,a=[];0===n&&a.push("obj");for(var s=["retType"],c=[i],l=0;l<e;++l)a.push("arg".concat(l)),s.push("argType".concat(l)),c.push(t[l]),r+="  var arg".concat(l," = argType").concat(l,".readValueFromPointer(args").concat(o?"+"+o:"",");\n"),o+=t[l].Cb;return r+="  var rv = ".concat(1===n?"new func":"func.call","(").concat(a.join(", "),");\n"),i.Ub||(s.push("emval_returnValue"),c.push(Lt),r+="  return emval_returnValue(retType, destructorsRef, rv);\n"),e=new Function(...s,r+"};\n")(...c),n="methodCaller<(".concat(t.map(e=>e.name).join(", "),") => ").concat(i.name,">"),rn(Object.defineProperty(e,"name",{value:n}))}function sn(e){return e=Jt(e>>>0),it(a[e])}function cn(e,t){return t>>>=0,e=nt(e>>>0),t=nt(t),it(e[t])}function ln(e){9<(e>>>=0)&&(et[e+1]+=1)}function un(){return it([])}function dn(e){e=nt(e>>>0);for(var t=Array(e.length),n=0;n<e.length;n++)t[n]=e[n];return it(t)}function hn(e){return it(Jt(e>>>0))}function fn(){return it({})}function pn(e){for(var t=nt(e>>>=0);t.length;){var n=t.pop();t.pop()(n)}tt(e)}function mn(e,t,n){t>>>=0,n>>>=0,e=nt(e>>>0),t=nt(t),n=nt(n),e[t]=n}function gn(e,t){return t>>>=0,e=(e=Rt(e>>>0,"_emval_take_value")).readValueFromPointer(t),it(e)}function yn(e,t){e=-9007199254740992>e||9007199254740992<e?NaN:Number(e),t>>>=0,e=new Date(1e3*e),q()[t>>>2>>>0]=e.getUTCSeconds(),q()[t+4>>>2>>>0]=e.getUTCMinutes(),q()[t+8>>>2>>>0]=e.getUTCHours(),q()[t+12>>>2>>>0]=e.getUTCDate(),q()[t+16>>>2>>>0]=e.getUTCMonth(),q()[t+20>>>2>>>0]=e.getUTCFullYear()-1900,q()[t+24>>>2>>>0]=e.getUTCDay(),e=(e.getTime()-Date.UTC(e.getUTCFullYear(),0,1,0,0,0,0))/864e5|0,q()[t+28>>>2>>>0]=e}var vn=e=>e%4==0&&(e%100!=0||e%400==0),_n=[0,31,60,91,121,152,182,213,244,274,305,335],wn=[0,31,59,90,120,151,181,212,243,273,304,334];function bn(e,t){e=-9007199254740992>e||9007199254740992<e?NaN:Number(e),t>>>=0,e=new Date(1e3*e),q()[t>>>2>>>0]=e.getSeconds(),q()[t+4>>>2>>>0]=e.getMinutes(),q()[t+8>>>2>>>0]=e.getHours(),q()[t+12>>>2>>>0]=e.getDate(),q()[t+16>>>2>>>0]=e.getMonth(),q()[t+20>>>2>>>0]=e.getFullYear()-1900,q()[t+24>>>2>>>0]=e.getDay();var n=(vn(e.getFullYear())?_n:wn)[e.getMonth()]+e.getDate()-1|0;q()[t+28>>>2>>>0]=n,q()[t+36>>>2>>>0]=-60*e.getTimezoneOffset(),n=new Date(e.getFullYear(),6,1).getTimezoneOffset();var i=new Date(e.getFullYear(),0,1).getTimezoneOffset();e=0|(n!=i&&e.getTimezoneOffset()==Math.min(i,n)),q()[t+32>>>2>>>0]=e}function xn(e){e>>>=0;var t=new Date(q()[e+20>>>2>>>0]+1900,q()[e+16>>>2>>>0],q()[e+12>>>2>>>0],q()[e+8>>>2>>>0],q()[e+4>>>2>>>0],q()[e>>>2>>>0],0),n=q()[e+32>>>2>>>0],i=t.getTimezoneOffset(),r=new Date(t.getFullYear(),6,1).getTimezoneOffset(),o=new Date(t.getFullYear(),0,1).getTimezoneOffset(),a=Math.min(o,r);return 0>n?q()[e+32>>>2>>>0]=+(r!=o&&a==i):0<n!=(a==i)&&(r=Math.max(o,r),t.setTime(t.getTime()+6e4*((0<n?a:r)-i))),q()[e+24>>>2>>>0]=t.getDay(),n=(vn(t.getFullYear())?_n:wn)[t.getMonth()]+t.getDate()-1|0,q()[e+28>>>2>>>0]=n,q()[e>>>2>>>0]=t.getSeconds(),q()[e+4>>>2>>>0]=t.getMinutes(),q()[e+8>>>2>>>0]=t.getHours(),q()[e+12>>>2>>>0]=t.getDate(),q()[e+16>>>2>>>0]=t.getMonth(),q()[e+20>>>2>>>0]=t.getYear(),e=t.getTime(),BigInt(isNaN(e)?-1:e/1e3)}function Sn(e,t,n,i,r,o,a){return u?se(16,1,e,t,n,i,r,o,a):-52}function En(e,t,n,i,r,o){if(u)return se(17,1,e,t,n,i,r,o)}var Tn={},kn=()=>performance.timeOrigin+performance.now();function Cn(e,t){if(u)return se(18,1,e,t);if(Tn[e]&&(clearTimeout(Tn[e].id),delete Tn[e]),!t)return 0;var n=setTimeout(()=>{delete Tn[e],Et(()=>bi(e,performance.timeOrigin+performance.now()))},t);return Tn[e]={id:n,rc:t},0}function In(e,t,n,i){e>>>=0,t>>>=0,n>>>=0,i>>>=0;var r=(new Date).getFullYear(),o=new Date(r,0,1).getTimezoneOffset();r=new Date(r,6,1).getTimezoneOffset();var a=Math.max(o,r);H()[e>>>2>>>0]=60*a,q()[t>>>2>>>0]=+(o!=r),e=(t=e=>{var t=Math.abs(e);return"UTC".concat(0<=e?"-":"+").concat(String(Math.floor(t/60)).padStart(2,"0")).concat(String(t%60).padStart(2,"0"))})(o),t=t(r),r<o?(dt(e,n,17),dt(t,i,17)):(dt(e,i,17),dt(t,n,17))}var An=()=>Date.now(),Nn=1;function On(e,t,n){if(!(0<=e&&3>=e))return 28;if(0===e)e=Date.now();else{if(!Nn)return 52;e=performance.timeOrigin+performance.now()}return A[n>>>0>>>3]=BigInt(Math.round(1e6*e)),0}var Pn=[],Rn=(e,t)=>{Pn.length=0;for(var n;n=F()[e++>>>0];){var i=105!=n;t+=(i&=112!=n)&&t%8?4:0,Pn.push(112==n?H()[t>>>2>>>0]:106==n?A[t>>>3]:105==n?q()[t>>>2>>>0]:G()[t>>>3>>>0]),t+=i?8:4}return Pn};function Ln(e,t,n){return e>>>=0,t=Rn(t>>>0,n>>>0),si[e](...t)}function zn(e,t,n){return e>>>=0,t=Rn(t>>>0,n>>>0),si[e](...t)}var Mn=()=>{};function Dn(e,t){return M(Ce(e>>>0,t>>>0))}var Bn=()=>{throw ae+=1,"unwind"};function Un(){return 4294901760}var Fn=()=>navigator.hardwareConcurrency;function jn(){return ee("Cannot use emscripten_pc_get_function without -sUSE_OFFSET_CONVERTER"),0}function Vn(e){e>>>=0;var t=F().length;if(e<=t||4294901760<e)return!1;for(var n=1;4>=n;n*=2){var i=t*(1+.2/n);i=Math.min(i,e+100663296);e:{i=(Math.min(4294901760,65536*Math.ceil(Math.max(e,i)/65536))-_.buffer.byteLength+65535)/65536|0;try{_.grow(i),Z();var r=1;break e}catch(o){}r=void 0}if(r)return!0}return!1}var qn=()=>(ee("Cannot use convertFrameToPC (needed by __builtin_return_address) without -sUSE_OFFSET_CONVERTER"),0),Hn={},Wn=e=>{e.forEach(e=>{var t=qn();t&&(Hn[t]=e)})};function Gn(){var e=Error().stack.toString().split("\n");return"Error"==e[0]&&e.shift(),Wn(e),Hn.Mb=qn(),Hn.dc=e,Hn.Mb}function Kn(e,t,n){if(e>>>=0,t>>>=0,Hn.Mb==e)var i=Hn.dc;else"Error"==(i=Error().stack.toString().split("\n"))[0]&&i.shift(),Wn(i);for(var r=3;i[r]&&qn()!=e;)++r;for(e=0;e<n&&i[e+r];++e)q()[t+4*e>>>2>>>0]=qn();return e}var Zn,Qn={},Xn=()=>{if(!Zn){var e,t={USER:"web_user",LOGNAME:"web_user",PATH:"/",PWD:"/",HOME:"/home/web_user",LANG:("object"==typeof navigator&&navigator.languages&&navigator.languages[0]||"C").replace("-","_")+".UTF-8",_:"./this.program"};for(e in Qn)void 0===Qn[e]?delete t[e]:t[e]=Qn[e];var n=[];for(e in t)n.push("".concat(e,"=").concat(t[e]));Zn=n}return Zn};function Yn(e,t){if(u)return se(19,1,e,t);e>>>=0,t>>>=0;var n,i=0,r=0;for(n of Xn()){var o=t+i;H()[e+r>>>2>>>0]=o,i+=dt(n,o,1/0)+1,r+=4}return 0}function Jn(e,t){if(u)return se(20,1,e,t);e>>>=0,t>>>=0;var n=Xn();for(var i of(H()[e>>>2>>>0]=n.length,e=0,n))e+=ht(i)+1;return H()[t>>>2>>>0]=e,0}function $n(e){return u?se(21,1,e):52}function ei(e,t,n,i){return u?se(22,1,e,t,n,i):52}function ti(e,t,n,i){return u?se(23,1,e,t,n,i):70}var ni=[null,[],[]];function ii(e,t,n,i){if(u)return se(24,1,e,t,n,i);t>>>=0,n>>>=0,i>>>=0;for(var r=0,o=0;o<n;o++){var a=H()[t>>>2>>>0],s=H()[t+4>>>2>>>0];t+=8;for(var c=0;c<s;c++){var l=e,d=F()[a+c>>>0],h=ni[l];0===d||10===d?((1===l?z:M)(ke(h)),h.length=0):h.push(d)}r+=s}return H()[i>>>2>>>0]=r,0}u||function(){for(var e=a.numThreads-1;e--;)ve();re.push(()=>{Y++,function(e){u?e():Promise.all(de.map(ye)).then(e)}(()=>$())})}();for(var ri=Array(256),oi=0;256>oi;++oi)ri[oi]=String.fromCharCode(oi);je=ri,et.push(0,1,void 0,1,null,1,!0,1,!1,1),a.count_emval_handles=()=>et.length/2-5-$e.length,u||(_=new WebAssembly.Memory({initial:256,maximum:65536,shared:!0}),Z()),a.wasmBinary&&(v=a.wasmBinary),a.stackSave=()=>ki(),a.stackRestore=e=>Ei(e),a.stackAlloc=e=>Ti(e),a.setValue=function(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"i8";switch(n.endsWith("*")&&(n="*"),n){case"i1":case"i8":U()[e>>>0]=t;break;case"i16":j()[e>>>1>>>0]=t;break;case"i32":q()[e>>>2>>>0]=t;break;case"i64":A[e>>>3]=BigInt(t);break;case"float":W()[e>>>2>>>0]=t;break;case"double":G()[e>>>3>>>0]=t;break;case"*":H()[e>>>2>>>0]=t;break;default:ee("invalid type for setValue: ".concat(n))}},a.getValue=function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"i8";switch(t.endsWith("*")&&(t="*"),t){case"i1":case"i8":return U()[e>>>0];case"i16":return j()[e>>>1>>>0];case"i32":return q()[e>>>2>>>0];case"i64":return A[e>>>3];case"float":return W()[e>>>2>>>0];case"double":return G()[e>>>3>>>0];case"*":return H()[e>>>2>>>0];default:ee("invalid type for getValue: ".concat(t))}},a.UTF8ToString=Ce,a.stringToUTF8=dt,a.lengthBytesUTF8=ht;var ai=[ce,le,Se,Ie,Ae,Ne,Oe,Pe,Re,Le,ze,Me,De,Be,Ue,Fe,Sn,En,Cn,Yn,Jn,$n,ei,ti,ii],si={893836:(e,t,n,i,r)=>{if(void 0===a||!a.Fb)return 1;if((e=Ce(Number(e>>>0))).startsWith("./")&&(e=e.substring(2)),!(e=a.Fb.get(e)))return 2;if(t=Number(t>>>0),n=Number(n>>>0),i=Number(i>>>0),t+n>e.byteLength)return 3;try{let o=e.subarray(t,t+n);switch(r){case 0:F().set(o,i>>>0);break;case 1:a.mc?a.mc(i,o):a.cc(i,o);break;default:return 4}return 0}catch(o){return 4}},894660:(e,t,n)=>{a.Pb(e,F().subarray(t>>>0,t+n>>>0))},894724:()=>a.oc(),894766:e=>{a.Ob(e)},894803:()=>{a.Wb()},894834:()=>{a.Xb()},894863:()=>{a.ac()},894888:e=>a.Vb(e),894921:e=>a.Zb(e),894953:(e,t,n)=>{a.Lb(Number(e),Number(t),Number(n),!0)},895016:(e,t,n)=>{a.Lb(Number(e),Number(t),Number(n))},895073:()=>typeof wasmOffsetConverter<"u",895130:e=>{a.Ab("Abs",e,void 0)},895181:e=>{a.Ab("Neg",e,void 0)},895232:e=>{a.Ab("Floor",e,void 0)},895285:e=>{a.Ab("Ceil",e,void 0)},895337:e=>{a.Ab("Reciprocal",e,void 0)},895395:e=>{a.Ab("Sqrt",e,void 0)},895447:e=>{a.Ab("Exp",e,void 0)},895498:e=>{a.Ab("Erf",e,void 0)},895549:e=>{a.Ab("Sigmoid",e,void 0)},895604:(e,t,n)=>{a.Ab("HardSigmoid",e,{alpha:t,beta:n})},895683:e=>{a.Ab("Log",e,void 0)},895734:e=>{a.Ab("Sin",e,void 0)},895785:e=>{a.Ab("Cos",e,void 0)},895836:e=>{a.Ab("Tan",e,void 0)},895887:e=>{a.Ab("Asin",e,void 0)},895939:e=>{a.Ab("Acos",e,void 0)},895991:e=>{a.Ab("Atan",e,void 0)},896043:e=>{a.Ab("Sinh",e,void 0)},896095:e=>{a.Ab("Cosh",e,void 0)},896147:e=>{a.Ab("Asinh",e,void 0)},896200:e=>{a.Ab("Acosh",e,void 0)},896253:e=>{a.Ab("Atanh",e,void 0)},896306:e=>{a.Ab("Tanh",e,void 0)},896358:e=>{a.Ab("Not",e,void 0)},896409:(e,t,n)=>{a.Ab("Clip",e,{min:t,max:n})},896478:e=>{a.Ab("Clip",e,void 0)},896530:(e,t)=>{a.Ab("Elu",e,{alpha:t})},896588:e=>{a.Ab("Gelu",e,void 0)},896640:e=>{a.Ab("Relu",e,void 0)},896692:(e,t)=>{a.Ab("LeakyRelu",e,{alpha:t})},896756:(e,t)=>{a.Ab("ThresholdedRelu",e,{alpha:t})},896826:(e,t)=>{a.Ab("Cast",e,{to:t})},896884:e=>{a.Ab("Add",e,void 0)},896935:e=>{a.Ab("Sub",e,void 0)},896986:e=>{a.Ab("Mul",e,void 0)},897037:e=>{a.Ab("Div",e,void 0)},897088:e=>{a.Ab("Pow",e,void 0)},897139:e=>{a.Ab("Equal",e,void 0)},897192:e=>{a.Ab("Greater",e,void 0)},897247:e=>{a.Ab("GreaterOrEqual",e,void 0)},897309:e=>{a.Ab("Less",e,void 0)},897361:e=>{a.Ab("LessOrEqual",e,void 0)},897420:(e,t,n,i,r)=>{a.Ab("ReduceMean",e,{keepDims:!!t,noopWithEmptyAxes:!!n,axes:i?Array.from(q().subarray(Number(i)>>>0,Number(r)>>>0)):[]})},897595:(e,t,n,i,r)=>{a.Ab("ReduceMax",e,{keepDims:!!t,noopWithEmptyAxes:!!n,axes:i?Array.from(q().subarray(Number(i)>>>0,Number(r)>>>0)):[]})},897769:(e,t,n,i,r)=>{a.Ab("ReduceMin",e,{keepDims:!!t,noopWithEmptyAxes:!!n,axes:i?Array.from(q().subarray(Number(i)>>>0,Number(r)>>>0)):[]})},897943:(e,t,n,i,r)=>{a.Ab("ReduceProd",e,{keepDims:!!t,noopWithEmptyAxes:!!n,axes:i?Array.from(q().subarray(Number(i)>>>0,Number(r)>>>0)):[]})},898118:(e,t,n,i,r)=>{a.Ab("ReduceSum",e,{keepDims:!!t,noopWithEmptyAxes:!!n,axes:i?Array.from(q().subarray(Number(i)>>>0,Number(r)>>>0)):[]})},898292:(e,t,n,i,r)=>{a.Ab("ReduceL1",e,{keepDims:!!t,noopWithEmptyAxes:!!n,axes:i?Array.from(q().subarray(Number(i)>>>0,Number(r)>>>0)):[]})},898465:(e,t,n,i,r)=>{a.Ab("ReduceL2",e,{keepDims:!!t,noopWithEmptyAxes:!!n,axes:i?Array.from(q().subarray(Number(i)>>>0,Number(r)>>>0)):[]})},898638:(e,t,n,i,r)=>{a.Ab("ReduceLogSum",e,{keepDims:!!t,noopWithEmptyAxes:!!n,axes:i?Array.from(q().subarray(Number(i)>>>0,Number(r)>>>0)):[]})},898815:(e,t,n,i,r)=>{a.Ab("ReduceSumSquare",e,{keepDims:!!t,noopWithEmptyAxes:!!n,axes:i?Array.from(q().subarray(Number(i)>>>0,Number(r)>>>0)):[]})},898995:(e,t,n,i,r)=>{a.Ab("ReduceLogSumExp",e,{keepDims:!!t,noopWithEmptyAxes:!!n,axes:i?Array.from(q().subarray(Number(i)>>>0,Number(r)>>>0)):[]})},899175:e=>{a.Ab("Where",e,void 0)},899228:(e,t,n)=>{a.Ab("Transpose",e,{perm:t?Array.from(q().subarray(Number(t)>>>0,Number(n)>>>0)):[]})},899352:(e,t,n,i)=>{a.Ab("DepthToSpace",e,{blocksize:t,mode:Ce(n),format:i?"NHWC":"NCHW"})},899485:(e,t,n,i)=>{a.Ab("DepthToSpace",e,{blocksize:t,mode:Ce(n),format:i?"NHWC":"NCHW"})},899618:(e,t,n,i,r,o,s,c,l,u,d,h,f,p,m)=>{a.Ab("ConvTranspose",e,{format:l?"NHWC":"NCHW",autoPad:t,dilations:[n],group:i,kernelShape:[r],pads:[o,s],strides:[c],wIsConst:()=>!!U()[u>>>0],outputPadding:d?Array.from(q().subarray(Number(d)>>>0,Number(h)>>>0)):[],outputShape:f?Array.from(q().subarray(Number(f)>>>0,Number(p)>>>0)):[],activation:Ce(m)})},900051:(e,t,n,i,r,o,s,c,l,u,d,h,f,p)=>{a.Ab("ConvTranspose",e,{format:c?"NHWC":"NCHW",autoPad:t,dilations:Array.from(q().subarray(Number(n)>>>0,2+(Number(n)>>>0)>>>0)),group:i,kernelShape:Array.from(q().subarray(Number(r)>>>0,2+(Number(r)>>>0)>>>0)),pads:Array.from(q().subarray(Number(o)>>>0,4+(Number(o)>>>0)>>>0)),strides:Array.from(q().subarray(Number(s)>>>0,2+(Number(s)>>>0)>>>0)),wIsConst:()=>!!U()[l>>>0],outputPadding:u?Array.from(q().subarray(Number(u)>>>0,Number(d)>>>0)):[],outputShape:h?Array.from(q().subarray(Number(h)>>>0,Number(f)>>>0)):[],activation:Ce(p)})},900712:(e,t,n,i,r,o,s,c,l,u,d,h,f,p,m)=>{a.Ab("ConvTranspose",e,{format:l?"NHWC":"NCHW",autoPad:t,dilations:[n],group:i,kernelShape:[r],pads:[o,s],strides:[c],wIsConst:()=>!!U()[u>>>0],outputPadding:d?Array.from(q().subarray(Number(d)>>>0,Number(h)>>>0)):[],outputShape:f?Array.from(q().subarray(Number(f)>>>0,Number(p)>>>0)):[],activation:Ce(m)})},901145:(e,t,n,i,r,o,s,c,l,u,d,h,f,p)=>{a.Ab("ConvTranspose",e,{format:c?"NHWC":"NCHW",autoPad:t,dilations:Array.from(q().subarray(Number(n)>>>0,2+(Number(n)>>>0)>>>0)),group:i,kernelShape:Array.from(q().subarray(Number(r)>>>0,2+(Number(r)>>>0)>>>0)),pads:Array.from(q().subarray(Number(o)>>>0,4+(Number(o)>>>0)>>>0)),strides:Array.from(q().subarray(Number(s)>>>0,2+(Number(s)>>>0)>>>0)),wIsConst:()=>!!U()[l>>>0],outputPadding:u?Array.from(q().subarray(Number(u)>>>0,Number(d)>>>0)):[],outputShape:h?Array.from(q().subarray(Number(h)>>>0,Number(f)>>>0)):[],activation:Ce(p)})},901806:(e,t)=>{a.Ab("GlobalAveragePool",e,{format:t?"NHWC":"NCHW"})},901897:(e,t,n,i,r,o,s,c,l,u,d,h,f,p)=>{a.Ab("AveragePool",e,{format:p?"NHWC":"NCHW",auto_pad:t,ceil_mode:n,count_include_pad:i,storage_order:r,dilations:o?Array.from(q().subarray(Number(o)>>>0,Number(s)>>>0)):[],kernel_shape:c?Array.from(q().subarray(Number(c)>>>0,Number(l)>>>0)):[],pads:u?Array.from(q().subarray(Number(u)>>>0,Number(d)>>>0)):[],strides:h?Array.from(q().subarray(Number(h)>>>0,Number(f)>>>0)):[]})},902376:(e,t)=>{a.Ab("GlobalAveragePool",e,{format:t?"NHWC":"NCHW"})},902467:(e,t,n,i,r,o,s,c,l,u,d,h,f,p)=>{a.Ab("AveragePool",e,{format:p?"NHWC":"NCHW",auto_pad:t,ceil_mode:n,count_include_pad:i,storage_order:r,dilations:o?Array.from(q().subarray(Number(o)>>>0,Number(s)>>>0)):[],kernel_shape:c?Array.from(q().subarray(Number(c)>>>0,Number(l)>>>0)):[],pads:u?Array.from(q().subarray(Number(u)>>>0,Number(d)>>>0)):[],strides:h?Array.from(q().subarray(Number(h)>>>0,Number(f)>>>0)):[]})},902946:(e,t)=>{a.Ab("GlobalMaxPool",e,{format:t?"NHWC":"NCHW"})},903033:(e,t,n,i,r,o,s,c,l,u,d,h,f,p)=>{a.Ab("MaxPool",e,{format:p?"NHWC":"NCHW",auto_pad:t,ceil_mode:n,count_include_pad:i,storage_order:r,dilations:o?Array.from(q().subarray(Number(o)>>>0,Number(s)>>>0)):[],kernel_shape:c?Array.from(q().subarray(Number(c)>>>0,Number(l)>>>0)):[],pads:u?Array.from(q().subarray(Number(u)>>>0,Number(d)>>>0)):[],strides:h?Array.from(q().subarray(Number(h)>>>0,Number(f)>>>0)):[]})},903508:(e,t)=>{a.Ab("GlobalMaxPool",e,{format:t?"NHWC":"NCHW"})},903595:(e,t,n,i,r,o,s,c,l,u,d,h,f,p)=>{a.Ab("MaxPool",e,{format:p?"NHWC":"NCHW",auto_pad:t,ceil_mode:n,count_include_pad:i,storage_order:r,dilations:o?Array.from(q().subarray(Number(o)>>>0,Number(s)>>>0)):[],kernel_shape:c?Array.from(q().subarray(Number(c)>>>0,Number(l)>>>0)):[],pads:u?Array.from(q().subarray(Number(u)>>>0,Number(d)>>>0)):[],strides:h?Array.from(q().subarray(Number(h)>>>0,Number(f)>>>0)):[]})},904070:(e,t,n,i,r)=>{a.Ab("Gemm",e,{alpha:t,beta:n,transA:i,transB:r})},904174:e=>{a.Ab("MatMul",e,void 0)},904228:(e,t,n,i)=>{a.Ab("ArgMax",e,{keepDims:!!t,selectLastIndex:!!n,axis:i})},904336:(e,t,n,i)=>{a.Ab("ArgMin",e,{keepDims:!!t,selectLastIndex:!!n,axis:i})},904444:(e,t)=>{a.Ab("Softmax",e,{axis:t})},904507:(e,t)=>{a.Ab("Concat",e,{axis:t})},904567:(e,t,n,i,r)=>{a.Ab("Split",e,{axis:t,numOutputs:n,splitSizes:i?Array.from(q().subarray(Number(i)>>>0,Number(r)>>>0)):[]})},904723:e=>{a.Ab("Expand",e,void 0)},904777:(e,t)=>{a.Ab("Gather",e,{axis:Number(t)})},904848:(e,t)=>{a.Ab("GatherElements",e,{axis:Number(t)})},904927:(e,t)=>{a.Ab("GatherND",e,{batch_dims:Number(t)})},905006:(e,t,n,i,r,o,s,c,l,u,d)=>{a.Ab("Resize",e,{antialias:t,axes:n?Array.from(q().subarray(Number(n)>>>0,Number(i)>>>0)):[],coordinateTransformMode:Ce(r),cubicCoeffA:o,excludeOutside:s,extrapolationValue:c,keepAspectRatioPolicy:Ce(l),mode:Ce(u),nearestMode:Ce(d)})},905368:(e,t,n,i,r,o,s)=>{a.Ab("Slice",e,{starts:t?Array.from(q().subarray(Number(t)>>>0,Number(n)>>>0)):[],ends:i?Array.from(q().subarray(Number(i)>>>0,Number(r)>>>0)):[],axes:o?Array.from(q().subarray(Number(o)>>>0,Number(s)>>>0)):[]})},905632:e=>{a.Ab("Tile",e,void 0)},905684:(e,t,n)=>{a.Ab("InstanceNormalization",e,{epsilon:t,format:n?"NHWC":"NCHW"})},905798:(e,t,n)=>{a.Ab("InstanceNormalization",e,{epsilon:t,format:n?"NHWC":"NCHW"})},905912:e=>{a.Ab("Range",e,void 0)},905965:(e,t)=>{a.Ab("Einsum",e,{equation:Ce(t)})},906046:(e,t,n,i,r)=>{a.Ab("Pad",e,{mode:t,value:n,pads:i?Array.from(q().subarray(Number(i)>>>0,Number(r)>>>0)):[]})},906189:(e,t,n,i,r,o)=>{a.Ab("BatchNormalization",e,{epsilon:t,momentum:n,spatial:!!r,trainingMode:!!i,format:o?"NHWC":"NCHW"})},906358:(e,t,n,i,r,o)=>{a.Ab("BatchNormalization",e,{epsilon:t,momentum:n,spatial:!!r,trainingMode:!!i,format:o?"NHWC":"NCHW"})},906527:(e,t,n)=>{a.Ab("CumSum",e,{exclusive:Number(t),reverse:Number(n)})},906624:(e,t,n)=>{a.Ab("DequantizeLinear",e,{axis:t,blockSize:n})},906714:(e,t,n,i,r)=>{a.Ab("GridSample",e,{align_corners:t,mode:Ce(n),padding_mode:Ce(i),format:r?"NHWC":"NCHW"})},906884:(e,t,n,i,r)=>{a.Ab("GridSample",e,{align_corners:t,mode:Ce(n),padding_mode:Ce(i),format:r?"NHWC":"NCHW"})},907054:(e,t)=>{a.Ab("ScatterND",e,{reduction:Ce(t)})},907139:(e,t,n,i,r,o,s,c,l)=>{a.Ab("Attention",e,{numHeads:t,isUnidirectional:n,maskFilterValue:i,scale:r,doRotary:o,qkvHiddenSizes:s?Array.from(q().subarray(Number(c)>>>0,Number(c)+s>>>0)):[],pastPresentShareBuffer:!!l})},907411:e=>{a.Ab("BiasAdd",e,void 0)},907466:e=>{a.Ab("BiasSplitGelu",e,void 0)},907527:e=>{a.Ab("FastGelu",e,void 0)},907583:(e,t,n,i,r,o,s,c,l,u,d,h,f,p,m,g)=>{a.Ab("Conv",e,{format:h?"NHWC":"NCHW",auto_pad:t,dilations:n?Array.from(q().subarray(Number(n)>>>0,Number(i)>>>0)):[],group:r,kernel_shape:o?Array.from(q().subarray(Number(o)>>>0,Number(s)>>>0)):[],pads:c?Array.from(q().subarray(Number(c)>>>0,Number(l)>>>0)):[],strides:u?Array.from(q().subarray(Number(u)>>>0,Number(d)>>>0)):[],w_is_const:()=>!!U()[Number(f)>>>0],activation:Ce(p),activation_params:m?Array.from(W().subarray(Number(m)>>>0,Number(g)>>>0)):[]})},908167:e=>{a.Ab("Gelu",e,void 0)},908219:(e,t,n,i,r,o,s,c,l)=>{a.Ab("GroupQueryAttention",e,{numHeads:t,kvNumHeads:n,scale:i,softcap:r,doRotary:o,rotaryInterleaved:s,smoothSoftmax:c,localWindowSize:l})},908436:(e,t,n,i)=>{a.Ab("LayerNormalization",e,{axis:t,epsilon:n,simplified:!!i})},908547:(e,t,n,i)=>{a.Ab("LayerNormalization",e,{axis:t,epsilon:n,simplified:!!i})},908658:(e,t,n,i,r,o)=>{a.Ab("MatMulNBits",e,{k:t,n:n,accuracyLevel:i,bits:r,blockSize:o})},908785:(e,t,n,i,r,o)=>{a.Ab("MultiHeadAttention",e,{numHeads:t,isUnidirectional:n,maskFilterValue:i,scale:r,doRotary:o})},908944:(e,t)=>{a.Ab("QuickGelu",e,{alpha:t})},909008:(e,t,n,i,r)=>{a.Ab("RotaryEmbedding",e,{interleaved:!!t,numHeads:n,rotaryEmbeddingDim:i,scale:r})},909147:(e,t,n)=>{a.Ab("SkipLayerNormalization",e,{epsilon:t,simplified:!!n})},909249:(e,t,n)=>{a.Ab("SkipLayerNormalization",e,{epsilon:t,simplified:!!n})},909351:(e,t,n,i)=>{a.Ab("GatherBlockQuantized",e,{gatherAxis:t,quantizeAxis:n,blockSize:i})},909472:e=>{a.$b(e)},909506:(e,t)=>a.bc(Number(e),Number(t),a.Gb.ec,a.Gb.errors)};function ci(e,t,n){return Kt(async()=>{await a.Yb(Number(e),Number(t),Number(n))})}function li(){return typeof wasmOffsetConverter<"u"}var ui=await async function(){function e(e,t){return ui=e.exports,ui=function(){var e=ui,t={};for(let[n,i]of Object.entries(e))t[n]="function"==typeof i?function(){jt.push(n);try{return i(...arguments)}finally{D||(jt.pop(),Ut&&1===Bt&&0===jt.length&&(Bt=0,ae+=1,Dt(Ai),typeof Fibers<"u"&&Fibers.sc()))}}:i;return t}(),ui=function(){var e=ui,t=e=>t=>e(t)>>>0,n=e=>()=>e()>>>0;return(e=Object.assign({},e)).Ea=t(e.Ea),e.gb=n(e.gb),e.ib=t(e.ib),e.tb=t(e.tb),e.ub=n(e.ub),e.__cxa_get_exception_ptr=t(e.__cxa_get_exception_ptr),e}(),fe.push(ui.jb),w=t,$(),ui}Y++;var t=te();if(a.instantiateWasm)return new Promise(n=>{a.instantiateWasm(t,(t,i)=>{n(e(t,i))})});if(u)return new Promise(t=>{P=n=>{var i=new WebAssembly.Instance(n,te());t(e(i,n))}});null!==X&&void 0!==X||(X=a.locateFile?a.locateFile?a.locateFile("ort-wasm-simd-threaded.jsep.wasm",y):y+"ort-wasm-simd-threaded.jsep.wasm":new URL(n(98),n.b).href);try{var i=await async function(e){var t=X;if(!v&&"function"==typeof WebAssembly.instantiateStreaming&&!B(t))try{var n=fetch(t,{credentials:"same-origin"});return await WebAssembly.instantiateStreaming(n,e)}catch(i){M("wasm streaming compile failed: ".concat(i)),M("falling back to ArrayBuffer instantiation")}return async function(e,t){try{var n=await async function(e){if(!v)try{var t=await p(e);return new Uint8Array(t)}catch(n){}if(e==X&&v)e=new Uint8Array(v);else{if(!m)throw"both async and sync fetching of the wasm failed";e=m(e)}return e}(e);return await WebAssembly.instantiate(n,t)}catch(i){M("failed to asynchronously prepare wasm: ".concat(i)),ee(i)}}(t,e)}(t);return e(i.instance,i.module)}catch(o){return r(o),Promise.reject(o)}}(),di=e=>(di=ui.Ea)(e),hi=()=>(hi=ui.Fa)();a._OrtInit=(e,t)=>(a._OrtInit=ui.Ga)(e,t),a._OrtGetLastError=(e,t)=>(a._OrtGetLastError=ui.Ha)(e,t),a._OrtCreateSessionOptions=(e,t,n,i,r,o,s,c,l,u)=>(a._OrtCreateSessionOptions=ui.Ia)(e,t,n,i,r,o,s,c,l,u),a._OrtAppendExecutionProvider=(e,t,n,i,r)=>(a._OrtAppendExecutionProvider=ui.Ja)(e,t,n,i,r),a._OrtAddFreeDimensionOverride=(e,t,n)=>(a._OrtAddFreeDimensionOverride=ui.Ka)(e,t,n),a._OrtAddSessionConfigEntry=(e,t,n)=>(a._OrtAddSessionConfigEntry=ui.La)(e,t,n),a._OrtReleaseSessionOptions=e=>(a._OrtReleaseSessionOptions=ui.Ma)(e),a._OrtCreateSession=(e,t,n)=>(a._OrtCreateSession=ui.Na)(e,t,n),a._OrtReleaseSession=e=>(a._OrtReleaseSession=ui.Oa)(e),a._OrtGetInputOutputCount=(e,t,n)=>(a._OrtGetInputOutputCount=ui.Pa)(e,t,n),a._OrtGetInputOutputMetadata=(e,t,n,i)=>(a._OrtGetInputOutputMetadata=ui.Qa)(e,t,n,i),a._OrtFree=e=>(a._OrtFree=ui.Ra)(e),a._OrtCreateTensor=(e,t,n,i,r,o)=>(a._OrtCreateTensor=ui.Sa)(e,t,n,i,r,o),a._OrtGetTensorData=(e,t,n,i,r)=>(a._OrtGetTensorData=ui.Ta)(e,t,n,i,r),a._OrtReleaseTensor=e=>(a._OrtReleaseTensor=ui.Ua)(e),a._OrtCreateRunOptions=(e,t,n,i)=>(a._OrtCreateRunOptions=ui.Va)(e,t,n,i),a._OrtAddRunConfigEntry=(e,t,n)=>(a._OrtAddRunConfigEntry=ui.Wa)(e,t,n),a._OrtReleaseRunOptions=e=>(a._OrtReleaseRunOptions=ui.Xa)(e),a._OrtCreateBinding=e=>(a._OrtCreateBinding=ui.Ya)(e),a._OrtBindInput=(e,t,n)=>(a._OrtBindInput=ui.Za)(e,t,n),a._OrtBindOutput=(e,t,n,i)=>(a._OrtBindOutput=ui._a)(e,t,n,i),a._OrtClearBoundOutputs=e=>(a._OrtClearBoundOutputs=ui.$a)(e),a._OrtReleaseBinding=e=>(a._OrtReleaseBinding=ui.ab)(e),a._OrtRunWithBinding=(e,t,n,i,r)=>(a._OrtRunWithBinding=ui.bb)(e,t,n,i,r),a._OrtRun=(e,t,n,i,r,o,s,c)=>(a._OrtRun=ui.cb)(e,t,n,i,r,o,s,c),a._OrtEndProfiling=e=>(a._OrtEndProfiling=ui.db)(e),a._JsepOutput=(e,t,n)=>(a._JsepOutput=ui.eb)(e,t,n),a._JsepGetNodeName=e=>(a._JsepGetNodeName=ui.fb)(e);var fi=()=>(fi=ui.gb)(),pi=a._free=e=>(pi=a._free=ui.hb)(e),mi=a._malloc=e=>(mi=a._malloc=ui.ib)(e),gi=(e,t,n,i,r,o)=>(gi=ui.kb)(e,t,n,i,r,o),yi=()=>(yi=ui.lb)(),vi=(e,t,n,i,r)=>(vi=ui.mb)(e,t,n,i,r),_i=e=>(_i=ui.nb)(e),wi=e=>(wi=ui.ob)(e),bi=(e,t)=>(bi=ui.pb)(e,t),xi=()=>(xi=ui.qb)(),Si=(e,t)=>(Si=ui.rb)(e,t),Ei=e=>(Ei=ui.sb)(e),Ti=e=>(Ti=ui.tb)(e),ki=()=>(ki=ui.ub)(),Ci=a.dynCall_ii=(e,t)=>(Ci=a.dynCall_ii=ui.vb)(e,t);a.dynCall_vii=(e,t,n)=>(a.dynCall_vii=ui.dynCall_vii)(e,t,n),a.dynCall_iiiii=(e,t,n,i,r)=>(a.dynCall_iiiii=ui.dynCall_iiiii)(e,t,n,i,r),a.dynCall_iii=(e,t,n)=>(a.dynCall_iii=ui.dynCall_iii)(e,t,n),a.dynCall_iiiiii=(e,t,n,i,r,o)=>(a.dynCall_iiiiii=ui.dynCall_iiiiii)(e,t,n,i,r,o),a.dynCall_iiiiiiii=(e,t,n,i,r,o,s,c)=>(a.dynCall_iiiiiiii=ui.dynCall_iiiiiiii)(e,t,n,i,r,o,s,c),a.dynCall_iiiiiii=(e,t,n,i,r,o,s)=>(a.dynCall_iiiiiii=ui.dynCall_iiiiiii)(e,t,n,i,r,o,s),a.dynCall_vi=(e,t)=>(a.dynCall_vi=ui.dynCall_vi)(e,t),a.dynCall_iiii=(e,t,n,i)=>(a.dynCall_iiii=ui.dynCall_iiii)(e,t,n,i),a.dynCall_i=e=>(a.dynCall_i=ui.dynCall_i)(e),a.dynCall_viiiiiiii=(e,t,n,i,r,o,s,c,l)=>(a.dynCall_viiiiiiii=ui.dynCall_viiiiiiii)(e,t,n,i,r,o,s,c,l),a.dynCall_viii=(e,t,n,i)=>(a.dynCall_viii=ui.dynCall_viii)(e,t,n,i),a.dynCall_viijj=(e,t,n,i,r)=>(a.dynCall_viijj=ui.dynCall_viijj)(e,t,n,i,r),a.dynCall_viiiiii=(e,t,n,i,r,o,s)=>(a.dynCall_viiiiii=ui.dynCall_viiiiii)(e,t,n,i,r,o,s),a.dynCall_viiii=(e,t,n,i,r)=>(a.dynCall_viiii=ui.dynCall_viiii)(e,t,n,i,r),a.dynCall_viiiii=(e,t,n,i,r,o)=>(a.dynCall_viiiii=ui.dynCall_viiiii)(e,t,n,i,r,o),a.dynCall_vfiii=(e,t,n,i,r)=>(a.dynCall_vfiii=ui.dynCall_vfiii)(e,t,n,i,r),a.dynCall_viiiiff=(e,t,n,i,r,o,s)=>(a.dynCall_viiiiff=ui.dynCall_viiiiff)(e,t,n,i,r,o,s),a.dynCall_viiiiiff=(e,t,n,i,r,o,s,c)=>(a.dynCall_viiiiiff=ui.dynCall_viiiiiff)(e,t,n,i,r,o,s,c),a.dynCall_ffff=(e,t,n,i)=>(a.dynCall_ffff=ui.dynCall_ffff)(e,t,n,i),a.dynCall_viiff=(e,t,n,i,r)=>(a.dynCall_viiff=ui.dynCall_viiff)(e,t,n,i,r),a.dynCall_fffffff=(e,t,n,i,r,o,s)=>(a.dynCall_fffffff=ui.dynCall_fffffff)(e,t,n,i,r,o,s),a.dynCall_jjjjjjj=(e,t,n,i,r,o,s)=>(a.dynCall_jjjjjjj=ui.dynCall_jjjjjjj)(e,t,n,i,r,o,s),a.dynCall_jjjjjj=(e,t,n,i,r,o)=>(a.dynCall_jjjjjj=ui.dynCall_jjjjjj)(e,t,n,i,r,o),a.dynCall_iijjii=(e,t,n,i,r,o)=>(a.dynCall_iijjii=ui.dynCall_iijjii)(e,t,n,i,r,o),a.dynCall_viiiiiiiiiiiii=(e,t,n,i,r,o,s,c,l,u,d,h,f,p)=>(a.dynCall_viiiiiiiiiiiii=ui.dynCall_viiiiiiiiiiiii)(e,t,n,i,r,o,s,c,l,u,d,h,f,p),a.dynCall_viiiiiiiiii=(e,t,n,i,r,o,s,c,l,u,d)=>(a.dynCall_viiiiiiiiii=ui.dynCall_viiiiiiiiii)(e,t,n,i,r,o,s,c,l,u,d),a.dynCall_viiiiiiiiiii=(e,t,n,i,r,o,s,c,l,u,d,h)=>(a.dynCall_viiiiiiiiiii=ui.dynCall_viiiiiiiiiii)(e,t,n,i,r,o,s,c,l,u,d,h),a.dynCall_viiiiiiiiiiii=(e,t,n,i,r,o,s,c,l,u,d,h,f)=>(a.dynCall_viiiiiiiiiiii=ui.dynCall_viiiiiiiiiiii)(e,t,n,i,r,o,s,c,l,u,d,h,f),a.dynCall_viiiiiiiiiiiiiiiiii=(e,t,n,i,r,o,s,c,l,u,d,h,f,p,m,g,y,v,_)=>(a.dynCall_viiiiiiiiiiiiiiiiii=ui.dynCall_viiiiiiiiiiiiiiiiii)(e,t,n,i,r,o,s,c,l,u,d,h,f,p,m,g,y,v,_),a.dynCall_viiiiiiiii=(e,t,n,i,r,o,s,c,l,u)=>(a.dynCall_viiiiiiiii=ui.dynCall_viiiiiiiii)(e,t,n,i,r,o,s,c,l,u),a.dynCall_viiiiiiiiiiiiiiiiiii=(e,t,n,i,r,o,s,c,l,u,d,h,f,p,m,g,y,v,_,w)=>(a.dynCall_viiiiiiiiiiiiiiiiiii=ui.dynCall_viiiiiiiiiiiiiiiiiii)(e,t,n,i,r,o,s,c,l,u,d,h,f,p,m,g,y,v,_,w),a.dynCall_viiiiiii=(e,t,n,i,r,o,s,c)=>(a.dynCall_viiiiiii=ui.dynCall_viiiiiii)(e,t,n,i,r,o,s,c),a.dynCall_viiiiiiiiiiiiiii=(e,t,n,i,r,o,s,c,l,u,d,h,f,p,m,g)=>(a.dynCall_viiiiiiiiiiiiiii=ui.dynCall_viiiiiiiiiiiiiii)(e,t,n,i,r,o,s,c,l,u,d,h,f,p,m,g),a.dynCall_jiji=(e,t,n,i)=>(a.dynCall_jiji=ui.dynCall_jiji)(e,t,n,i),a.dynCall_v=e=>(a.dynCall_v=ui.dynCall_v)(e),a.dynCall_iidiiii=(e,t,n,i,r,o,s)=>(a.dynCall_iidiiii=ui.dynCall_iidiiii)(e,t,n,i,r,o,s),a.dynCall_iiiiiiiii=(e,t,n,i,r,o,s,c,l)=>(a.dynCall_iiiiiiiii=ui.dynCall_iiiiiiiii)(e,t,n,i,r,o,s,c,l),a.dynCall_iiij=(e,t,n,i)=>(a.dynCall_iiij=ui.dynCall_iiij)(e,t,n,i),a.dynCall_iiiiiiiiii=(e,t,n,i,r,o,s,c,l,u)=>(a.dynCall_iiiiiiiiii=ui.dynCall_iiiiiiiiii)(e,t,n,i,r,o,s,c,l,u),a.dynCall_iiiiiiiiiiiii=(e,t,n,i,r,o,s,c,l,u,d,h,f)=>(a.dynCall_iiiiiiiiiiiii=ui.dynCall_iiiiiiiiiiiii)(e,t,n,i,r,o,s,c,l,u,d,h,f),a.dynCall_iiiiiiiiiii=(e,t,n,i,r,o,s,c,l,u,d)=>(a.dynCall_iiiiiiiiiii=ui.dynCall_iiiiiiiiiii)(e,t,n,i,r,o,s,c,l,u,d),a.dynCall_ji=(e,t)=>(a.dynCall_ji=ui.dynCall_ji)(e,t),a.dynCall_iijii=(e,t,n,i,r)=>(a.dynCall_iijii=ui.dynCall_iijii)(e,t,n,i,r),a.dynCall_vij=(e,t,n)=>(a.dynCall_vij=ui.dynCall_vij)(e,t,n),a.dynCall_viiijii=(e,t,n,i,r,o,s)=>(a.dynCall_viiijii=ui.dynCall_viiijii)(e,t,n,i,r,o,s),a.dynCall_viijiiiiiiiiiiiiii=(e,t,n,i,r,o,s,c,l,u,d,h,f,p,m,g,y,v)=>(a.dynCall_viijiiiiiiiiiiiiii=ui.dynCall_viijiiiiiiiiiiiiii)(e,t,n,i,r,o,s,c,l,u,d,h,f,p,m,g,y,v),a.dynCall_viiiji=(e,t,n,i,r,o)=>(a.dynCall_viiiji=ui.dynCall_viiiji)(e,t,n,i,r,o),a.dynCall_fiii=(e,t,n,i)=>(a.dynCall_fiii=ui.dynCall_fiii)(e,t,n,i),a.dynCall_viijii=(e,t,n,i,r,o)=>(a.dynCall_viijii=ui.dynCall_viijii)(e,t,n,i,r,o),a.dynCall_viij=(e,t,n,i)=>(a.dynCall_viij=ui.dynCall_viij)(e,t,n,i),a.dynCall_jiij=(e,t,n,i)=>(a.dynCall_jiij=ui.dynCall_jiij)(e,t,n,i),a.dynCall_fi=(e,t)=>(a.dynCall_fi=ui.dynCall_fi)(e,t),a.dynCall_fii=(e,t,n)=>(a.dynCall_fii=ui.dynCall_fii)(e,t,n),a.dynCall_jii=(e,t,n)=>(a.dynCall_jii=ui.dynCall_jii)(e,t,n),a.dynCall_dii=(e,t,n)=>(a.dynCall_dii=ui.dynCall_dii)(e,t,n),a.dynCall_fiiii=(e,t,n,i,r)=>(a.dynCall_fiiii=ui.dynCall_fiiii)(e,t,n,i,r),a.dynCall_fif=(e,t,n)=>(a.dynCall_fif=ui.dynCall_fif)(e,t,n),a.dynCall_jfi=(e,t,n)=>(a.dynCall_jfi=ui.dynCall_jfi)(e,t,n),a.dynCall_viiiiiiiiiiiiii=(e,t,n,i,r,o,s,c,l,u,d,h,f,p,m)=>(a.dynCall_viiiiiiiiiiiiii=ui.dynCall_viiiiiiiiiiiiii)(e,t,n,i,r,o,s,c,l,u,d,h,f,p,m),a.dynCall_viiiiiiiiiiiiiiiiiiii=(e,t,n,i,r,o,s,c,l,u,d,h,f,p,m,g,y,v,_,w,b)=>(a.dynCall_viiiiiiiiiiiiiiiiiiii=ui.dynCall_viiiiiiiiiiiiiiiiiiii)(e,t,n,i,r,o,s,c,l,u,d,h,f,p,m,g,y,v,_,w,b),a.dynCall_viiiiiiiiiiiiiiii=(e,t,n,i,r,o,s,c,l,u,d,h,f,p,m,g,y)=>(a.dynCall_viiiiiiiiiiiiiiii=ui.dynCall_viiiiiiiiiiiiiiii)(e,t,n,i,r,o,s,c,l,u,d,h,f,p,m,g,y),a.dynCall_iif=(e,t,n)=>(a.dynCall_iif=ui.dynCall_iif)(e,t,n),a.dynCall_jiiii=(e,t,n,i,r)=>(a.dynCall_jiiii=ui.dynCall_jiiii)(e,t,n,i,r),a.dynCall_jiii=(e,t,n,i)=>(a.dynCall_jiii=ui.dynCall_jiii)(e,t,n,i),a.dynCall_viif=(e,t,n,i)=>(a.dynCall_viif=ui.dynCall_viif)(e,t,n,i),a.dynCall_viiij=(e,t,n,i,r)=>(a.dynCall_viiij=ui.dynCall_viiij)(e,t,n,i,r),a.dynCall_viiiijii=(e,t,n,i,r,o,s,c)=>(a.dynCall_viiiijii=ui.dynCall_viiiijii)(e,t,n,i,r,o,s,c),a.dynCall_iiiiij=(e,t,n,i,r,o)=>(a.dynCall_iiiiij=ui.dynCall_iiiiij)(e,t,n,i,r,o),a.dynCall_iiiiid=(e,t,n,i,r,o)=>(a.dynCall_iiiiid=ui.dynCall_iiiiid)(e,t,n,i,r,o),a.dynCall_iiiiijj=(e,t,n,i,r,o,s)=>(a.dynCall_iiiiijj=ui.dynCall_iiiiijj)(e,t,n,i,r,o,s),a.dynCall_iiiiiijj=(e,t,n,i,r,o,s,c)=>(a.dynCall_iiiiiijj=ui.dynCall_iiiiiijj)(e,t,n,i,r,o,s,c);var Ii=e=>(Ii=ui.wb)(e),Ai=()=>(Ai=ui.xb)(),Ni=e=>(Ni=ui.yb)(e),Oi=()=>(Oi=ui.zb)();return function e(){if(0<Y)J=e;else if(u)i(a),Q();else{for(;0<re.length;)re.shift()(a);0<Y?J=e:(a.calledRun=!0,D||(Q(),i(a)))}}(),a.PTR_SIZE=4,s},ze=Le,(null===(e=globalThis.self)||void 0===e||null===(e=e.name)||void 0===e?void 0:e.startsWith("em-pthread"))&&Le()}),_l=re(()=>{Ce(),Me=typeof location>"u"?void 0:location.origin,De=!0,Be=()=>{if(De){let e=URL;return new URL(new e(n(618),n.b).href,Me).href}return"file:///c:/reef-monitor/node_modules/onnxruntime-web/dist/ort.bundle.min.mjs"},Ue=Be(),Fe=()=>{if(Ue&&!Ue.startsWith("blob:"))return Ue.substring(0,Ue.lastIndexOf("/")+1)},je=(e,t)=>{try{let n=null!==t&&void 0!==t?t:Ue;return(n?new URL(e,n):new URL(e)).origin===Me}catch(n){return!1}},Ve=(e,t)=>{let n=null!==t&&void 0!==t?t:Ue;try{return(n?new URL(e,n):new URL(e)).href}catch(i){return}},qe=(e,t)=>"".concat(null!==t&&void 0!==t?t:"./").concat(e),He=async e=>{let t=await(await fetch(e,{credentials:"same-origin"})).blob();return URL.createObjectURL(t)},We=async e=>(await import(e)).default,Ge=(Pe(),ae(Ie)).default,Ke=async()=>{if(!Ue)throw new Error("Failed to load proxy worker: cannot determine the script source URL.");if(je(Ue))return[void 0,Ge()];let e=await He(Ue);return[e,Ge(e)]},Ze=(vl(),ae(Re)).default,Qe=async(e,t,n,i)=>{let r=Ze&&!(e||t);if(r)if(Ue)r=je(Ue);else{if(!i||n)throw new Error("cannot determine the script source URL.");r=!0}if(r)return[void 0,Ze];{let i="ort-wasm-simd-threaded.jsep.mjs",r=null!==e&&void 0!==e?e:Ve(i,t),o=n&&r&&!je(r,t),a=o?await He(r):null!==r&&void 0!==r?r:qe(i,t);return[o?a:void 0,await We(a)]}}}),wl=re(()=>{_l(),Ye=!1,Je=!1,$e=!1,et=()=>{if(typeof SharedArrayBuffer>"u")return!1;try{return typeof MessageChannel<"u"&&(new MessageChannel).port1.postMessage(new SharedArrayBuffer(1)),WebAssembly.validate(new Uint8Array([0,97,115,109,1,0,0,0,1,4,1,96,0,0,3,2,1,0,5,4,1,3,1,1,10,11,1,9,0,65,0,254,16,2,0,26,11]))}catch(e){return!1}},tt=()=>{try{return WebAssembly.validate(new Uint8Array([0,97,115,109,1,0,0,0,1,4,1,96,0,0,3,2,1,0,10,30,1,28,0,65,0,253,15,253,12,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,253,186,1,26,11]))}catch(e){return!1}},nt=()=>{try{return WebAssembly.validate(new Uint8Array([0,97,115,109,1,0,0,0,1,5,1,96,0,1,123,3,2,1,0,10,19,1,17,0,65,1,253,15,65,2,253,15,65,3,253,15,253,147,2,11]))}catch(e){return!1}},it=async e=>{var t,n;if(Ye)return Promise.resolve();if(Je)throw new Error("multiple calls to 'initializeWebAssembly()' detected.");if($e)throw new Error("previous call to 'initializeWebAssembly()' failed.");Je=!0;let i=e.initTimeout,r=e.numThreads;if(!1!==e.simd)if("relaxed"===e.simd){if(!nt())throw new Error("Relaxed WebAssembly SIMD is not supported in the current environment.")}else if(!tt())throw new Error("WebAssembly SIMD is not supported in the current environment.");let o=et();r>1&&!o&&(typeof self<"u"&&!self.crossOriginIsolated&&console.warn("env.wasm.numThreads is set to "+r+", but this will not work unless you enable crossOriginIsolated mode. See https://web.dev/cross-origin-isolation-guide/ for more info."),console.warn("WebAssembly multi-threading is not supported in the current environment. Falling back to single-threading."),e.numThreads=r=1);let a=e.wasmPaths,s="string"==typeof a?a:void 0,c=null===a||void 0===a?void 0:a.mjs,l=null!==(t=null===c||void 0===c?void 0:c.href)&&void 0!==t?t:c,u=null===a||void 0===a?void 0:a.wasm,d=null!==(n=null===u||void 0===u?void 0:u.href)&&void 0!==n?n:u,h=e.wasmBinary,[f,p]=await Qe(l,s,r>1,!!h||!!d),m=!1,g=[];if(i>0&&g.push(new Promise(e=>{setTimeout(()=>{m=!0,e()},i)})),g.push(new Promise((e,t)=>{let n={numThreads:r};if(h)n.wasmBinary=h;else if(d||s)n.locateFile=e=>null!==d&&void 0!==d?d:s+e;else if(l&&0!==l.indexOf("blob:"))n.locateFile=e=>new URL(e,l).href;else if(f){let e=Fe();e&&(n.locateFile=t=>e+t)}p(n).then(t=>{Je=!1,Ye=!0,Xe=t,e(),f&&URL.revokeObjectURL(f)},e=>{Je=!1,$e=!0,t(e)})})),await Promise.race(g),m)throw new Error("WebAssembly backend initializing failed due to timeout: ".concat(i,"ms"))},rt=()=>{if(Ye&&Xe)return Xe;throw new Error("WebAssembly is not initialized yet.")}}),bl=re(()=>{wl(),ot=(e,t)=>{let n=rt(),i=n.lengthBytesUTF8(e)+1,r=n._malloc(i);return n.stringToUTF8(e,r,i),t.push(r),r},at=(e,t,n,i)=>{if("object"==typeof e&&null!==e){if(n.has(e))throw new Error("Circular reference in options");n.add(e)}Object.entries(e).forEach(e=>{let[r,o]=e,a=t?t+r:r;if("object"==typeof o)at(o,a+".",n,i);else if("string"==typeof o||"number"==typeof o)i(a,o.toString());else{if("boolean"!=typeof o)throw new Error("Can't handle extra config type: ".concat(typeof o));i(a,o?"1":"0")}})},st=e=>{let t=rt(),n=t.stackSave();try{let n=t.PTR_SIZE,i=t.stackAlloc(2*n);t._OrtGetLastError(i,i+n);let r=Number(t.getValue(i,4===n?"i32":"i64")),o=t.getValue(i+n,"*"),a=o?t.UTF8ToString(o):"";throw new Error("".concat(e," ERROR_CODE: ").concat(r,", ERROR_MESSAGE: ").concat(a))}finally{t.stackRestore(n)}}}),xl=re(()=>{wl(),bl(),ct=e=>{let t=rt(),n=0,i=[],r=e||{};try{if(void 0===(null===e||void 0===e?void 0:e.logSeverityLevel))r.logSeverityLevel=2;else if("number"!=typeof e.logSeverityLevel||!Number.isInteger(e.logSeverityLevel)||e.logSeverityLevel<0||e.logSeverityLevel>4)throw new Error("log severity level is not valid: ".concat(e.logSeverityLevel));if(void 0===(null===e||void 0===e?void 0:e.logVerbosityLevel))r.logVerbosityLevel=0;else if("number"!=typeof e.logVerbosityLevel||!Number.isInteger(e.logVerbosityLevel))throw new Error("log verbosity level is not valid: ".concat(e.logVerbosityLevel));void 0===(null===e||void 0===e?void 0:e.terminate)&&(r.terminate=!1);let o=0;return void 0!==(null===e||void 0===e?void 0:e.tag)&&(o=ot(e.tag,i)),n=t._OrtCreateRunOptions(r.logSeverityLevel,r.logVerbosityLevel,!!r.terminate,o),0===n&&st("Can't create run options."),void 0!==(null===e||void 0===e?void 0:e.extra)&&at(e.extra,"",new WeakSet,(e,r)=>{let o=ot(e,i),a=ot(r,i);0!==t._OrtAddRunConfigEntry(n,o,a)&&st("Can't set a run config entry: ".concat(e," - ").concat(r,"."))}),[n,i]}catch(Pk){throw 0!==n&&t._OrtReleaseRunOptions(n),i.forEach(e=>t._free(e)),Pk}}}),Sl=re(()=>{wl(),bl(),lt=e=>{switch(e){case"disabled":return 0;case"basic":return 1;case"extended":return 2;case"layout":return 3;case"all":return 99;default:throw new Error("unsupported graph optimization level: ".concat(e))}},ut=e=>{switch(e){case"sequential":return 0;case"parallel":return 1;default:throw new Error("unsupported execution mode: ".concat(e))}},dt=e=>{e.extra||(e.extra={}),e.extra.session||(e.extra.session={});let t=e.extra.session;t.use_ort_model_bytes_directly||(t.use_ort_model_bytes_directly="1"),e.executionProviders&&e.executionProviders.some(e=>"webgpu"===("string"==typeof e?e:e.name))&&(e.enableMemPattern=!1)},ht=(e,t,n,i)=>{let r=ot(t,i),o=ot(n,i);0!==rt()._OrtAddSessionConfigEntry(e,r,o)&&st("Can't set a session config entry: ".concat(t," - ").concat(n,"."))},ft=async(e,t,n)=>{for(let i of t){let t="string"==typeof i?i:i.name,r=[];switch(t){case"webnn":if(t="WEBNN","string"!=typeof i){let t=null===i||void 0===i?void 0:i.deviceType;t&&ht(e,"deviceType",t,n)}break;case"webgpu":if(t="JS","string"!=typeof i){let t=i;if(null!==t&&void 0!==t&&t.preferredLayout){if("NCHW"!==t.preferredLayout&&"NHWC"!==t.preferredLayout)throw new Error("preferredLayout must be either 'NCHW' or 'NHWC': ".concat(t.preferredLayout));ht(e,"preferredLayout",t.preferredLayout,n)}}break;case"wasm":case"cpu":continue;default:throw new Error("not supported execution provider: ".concat(t))}let o=ot(t,n),a=r.length,s=0,c=0;if(a>0){s=rt()._malloc(a*rt().PTR_SIZE),n.push(s),c=rt()._malloc(a*rt().PTR_SIZE),n.push(c);for(let e=0;e<a;e++)rt().setValue(s+e*rt().PTR_SIZE,r[e][0],"*"),rt().setValue(c+e*rt().PTR_SIZE,r[e][1],"*")}0!==await rt()._OrtAppendExecutionProvider(e,o,s,c,a)&&st("Can't append execution provider: ".concat(t,"."))}},pt=async e=>{let t=rt(),n=0,i=[],r=e||{};dt(r);try{var o,a,s,c;let e=lt(null!==(o=r.graphOptimizationLevel)&&void 0!==o?o:"all"),l=ut(null!==(a=r.executionMode)&&void 0!==a?a:"sequential"),u="string"==typeof r.logId?ot(r.logId,i):0,d=null!==(s=r.logSeverityLevel)&&void 0!==s?s:2;if(!Number.isInteger(d)||d<0||d>4)throw new Error("log severity level is not valid: ".concat(d));let h=null!==(c=r.logVerbosityLevel)&&void 0!==c?c:0;if(!Number.isInteger(h)||h<0||h>4)throw new Error("log verbosity level is not valid: ".concat(h));let f="string"==typeof r.optimizedModelFilePath?ot(r.optimizedModelFilePath,i):0;if(n=t._OrtCreateSessionOptions(e,!!r.enableCpuMemArena,!!r.enableMemPattern,l,!!r.enableProfiling,0,u,d,h,f),0===n&&st("Can't create session options."),r.executionProviders&&await ft(n,r.executionProviders,i),void 0!==r.enableGraphCapture){if("boolean"!=typeof r.enableGraphCapture)throw new Error("enableGraphCapture must be a boolean value: ".concat(r.enableGraphCapture));ht(n,"enableGraphCapture",r.enableGraphCapture.toString(),i)}if(r.freeDimensionOverrides)for(let[o,a]of Object.entries(r.freeDimensionOverrides)){if("string"!=typeof o)throw new Error("free dimension override name must be a string: ".concat(o));if("number"!=typeof a||!Number.isInteger(a)||a<0)throw new Error("free dimension override value must be a non-negative integer: ".concat(a));let e=ot(o,i);0!==t._OrtAddFreeDimensionOverride(n,e,a)&&st("Can't set a free dimension override: ".concat(o," - ").concat(a,"."))}return void 0!==r.extra&&at(r.extra,"",new WeakSet,(e,t)=>{ht(n,e,t,i)}),[n,i]}catch(Pk){throw 0!==n&&0!==t._OrtReleaseSessionOptions(n)&&st("Can't release session options."),i.forEach(e=>t._free(e)),Pk}}}),El=re(()=>{mt=e=>{switch(e){case"int8":return 3;case"uint8":return 2;case"bool":return 9;case"int16":return 5;case"uint16":return 4;case"int32":return 6;case"uint32":return 12;case"float16":return 10;case"float32":return 1;case"float64":return 11;case"string":return 8;case"int64":return 7;case"uint64":return 13;case"int4":return 22;case"uint4":return 21;default:throw new Error("unsupported data type: ".concat(e))}},gt=e=>{switch(e){case 3:return"int8";case 2:return"uint8";case 9:return"bool";case 5:return"int16";case 4:return"uint16";case 6:return"int32";case 12:return"uint32";case 10:return"float16";case 1:return"float32";case 11:return"float64";case 8:return"string";case 7:return"int64";case 13:return"uint64";case 22:return"int4";case 21:return"uint4";default:throw new Error("unsupported data type: ".concat(e))}},yt=(e,t)=>{let n=[-1,4,1,1,2,2,4,8,-1,1,2,8,4,8,-1,-1,-1,-1,-1,-1,-1,.5,.5][e],i="number"==typeof t?t:t.reduce((e,t)=>e*t,1);return n>0?Math.ceil(i*n):void 0},vt=e=>{switch(e){case"float16":return typeof Float16Array<"u"&&Float16Array.from?Float16Array:Uint16Array;case"float32":return Float32Array;case"uint8":case"bool":return Uint8Array;case"int8":return Int8Array;case"uint16":return Uint16Array;case"int16":return Int16Array;case"int32":return Int32Array;case"float64":return Float64Array;case"uint32":return Uint32Array;case"int64":return BigInt64Array;case"uint64":return BigUint64Array;default:throw new Error("unsupported type: ".concat(e))}},_t=e=>{switch(e){case"verbose":return 0;case"info":return 1;case"warning":return 2;case"error":return 3;case"fatal":return 4;default:throw new Error("unsupported logging level: ".concat(e))}},wt=e=>"float32"===e||"float16"===e||"int32"===e||"int64"===e||"uint32"===e||"uint8"===e||"bool"===e||"uint4"===e||"int4"===e,bt=e=>"float32"===e||"float16"===e||"int32"===e||"int64"===e||"uint32"===e||"uint64"===e||"int8"===e||"uint8"===e||"bool"===e||"uint4"===e||"int4"===e,xt=e=>{switch(e){case"none":return 0;case"cpu":return 1;case"cpu-pinned":return 2;case"texture":return 3;case"gpu-buffer":return 4;case"ml-tensor":return 5;default:throw new Error("unsupported data location: ".concat(e))}}}),Tl=re(()=>{Ce(),St=async e=>{if("string"==typeof e){let n=await fetch(e);if(!n.ok)throw new Error("failed to load external data file: ".concat(e));let i=n.headers.get("Content-Length"),r=i?parseInt(i,10):0;if(r<1073741824)return new Uint8Array(await n.arrayBuffer());{if(!n.body)throw new Error("failed to load external data file: ".concat(e,", no response body."));let i,o=n.body.getReader();try{i=new ArrayBuffer(r)}catch(t){if(!(t instanceof RangeError))throw t;{let e=Math.ceil(r/65536);i=new WebAssembly.Memory({initial:e,maximum:e}).buffer}}let a=0;for(;;){let{done:e,value:t}=await o.read();if(e)break;let n=t.byteLength;new Uint8Array(i,a,n).set(t),a+=n}return new Uint8Array(i,0,r)}}return e instanceof Blob?new Uint8Array(await e.arrayBuffer()):e instanceof Uint8Array?e:new Uint8Array(e)}}),kl=re(()=>{El(),Et=["V","I","W","E","F"],Tt=(e,t)=>{console.log("[".concat(Et[e],",").concat((new Date).toISOString(),"]").concat(t))},It=(e,t)=>{kt=e,Ct=t},At=(e,t)=>{let n=_t(e);n>=_t(kt)&&Tt(n,"function"==typeof t?t():t)},Nt=function(){Ct&&At(...arguments)}}),Cl=re(()=>{Ot=class{static calcMatMulShape(e,t){return e[1]!==t[0]?void 0:[e[0],t[1]]}},Pt=class{static calcShape(e,t){let n=arguments.length>2&&void 0!==arguments[2]&&arguments[2],i=e.length,r=t.length;if(0===i)return t;if(0===r)return e;let o=Math.max(e.length,t.length),a=new Array(o);if(n){if(i<2||r<2)return;let n=Ot.calcMatMulShape([e[i-2],e[i-1]],[t[r-2],t[r-1]]);if(void 0===n)return;[a[o-2],a[o-1]]=n}for(let s=n?3:1;s<=o;s++){let n=i-s<0?1:e[i-s],c=r-s<0?1:t[r-s];if(n!==c&&n>1&&c>1)return;let l=Math.max(n,c);if(n&&c)a[o-s]=Math.max(n,c);else{if(l>1)return;a[o-s]=0}}return a}static isValidBroadcast(e,t){let n=e.length,i=t.length;if(n>i)return!1;for(let r=1;r<=n;r++)if(1!==e[n-r]&&e[n-r]!==t[i-r])return!1;return!0}},Rt=class e{static size(t){return e.getSizeFromDimensionRange(t,0,t.length)}static convertShape(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:4,n=e.length;if(0===n)return[];let i=new Array(n),r=n-1;for(;r>=0;){if(e[r]%t===0){i[r]=e[r]/t;break}if(t%e[r]!==0)throw new Error("cannot convert shape");i[r]=1,t/=e[r],r--}for(r--;r>=0;r--)i[r]=e[r];return i}static sizeFromDimension(t,n){if(n<0||n>t.length)throw new Error("invalid dimension of ".concat(n," for sizeFromDimension as Tensor has ").concat(t.length," dimensions."));return e.getSizeFromDimensionRange(t,n,t.length)}static sizeToDimension(t,n){if(n<0||n>t.length)throw new Error("invalid dimension of ".concat(n," for sizeToDimension as Tensor has ").concat(t.length," dimensions."));return e.getSizeFromDimensionRange(t,0,n)}static getSizeFromDimensionRange(e,t,n){let i=1;for(let r=t;r<n;r++){if(e[r]<0)throw new Error("cannot get valid size from specified dimension range. Most likely the range contains negative values in them.");i*=Number(e[r])}return i}static computeStrides(e){let t=e.length;if(0===t)return[];if(1===t)return[1];let n=new Array(t);n[t-1]=1,n[t-2]=e[t-1];for(let i=t-3;i>=0;--i)n[i]=n[i+1]*e[i+1];return n}static normalizeAxis(e,t){if(e<-t&&e>=t)throw new Error("unsupported axis for this operation.");return e<0?e+t:e}static normalizeAxes(e,t){return e.map(n=>this.normalizeAxis(n,null!==t&&void 0!==t?t:e.length))}static sortBasedOnPerm(e,t){return t?t.map(t=>e[t]):e.slice().reverse()}static padShape(e,t){let n=e.length;return e.map((e,i)=>e+t[i]+t[i+n])}static areEqual(e,t){return e.length===t.length&&e.every((e,n)=>e===t[n])}},Lt=class e{static adjustPoolAttributes(e,t,n,i,r,o){if(!e&&n.length!==t.length-2)throw new Error("length of specified kernel shapes should be 2 less than length of input dimensions");if(e)for(let a=0;a<t.length-2;a++)a>=n.length?n.push(t[a+2]):n[a]=t[a+2];for(let a=0;a<n.length;a++)if(a<i.length){if(i[a]<0)throw new Error("strides should be greater than or equal to 1")}else i.push(1);for(let a=0;a<n.length;a++)if(a<r.length){if(r[a]<0)throw new Error("dilations should be greater than or equal to 1")}else r.push(1);for(let a=0;a<2*n.length;a++)if(a<o.length){if(o[a]<0)throw new Error("pad should be greater than or equal to 1")}else o.push(0);for(let a=0;a<n.length;a++){if(n[a]<=0)throw new Error("kernel shapes need to be greater than 0");if(o[a]>=n[a]||o[a+n.length]>=n[a])throw new Error("pads should be smaller than kernel")}}static adjustPadsBasedOnAutoPad(t,n,i,r,o,a,s){if(s){if(o.length!==2*(t.length-2))throw new Error("length of pads should be twice the length of data dimensions");if(n.length!==t.length-2)throw new Error("length of strides should be the length of data dimensions");if(r.length!==t.length-2)throw new Error("length of kernel shapes should be the length of data dimensions");for(let c=0;c<t.length-2;c++)e.adjustPadAndReturnShape(t[c+(a?1:2)],n[c],i[c],r[c],o,c,c+t.length-2,s)}}static computePoolOutputShape(t,n,i,r,o,a,s){if(n.length<=0)throw new Error("input shape must be of size greater than 0");let c=[n[0],n[1]];return e.computeShapeHelper(t,n,c,i,r,o,a,s),c}static computeConvOutputShape(t,n,i,r,o,a,s){if(t.length<=0||n.length<=0)throw new Error("invalid input tensor dims or invalid filter tensor dims");let c=[t[0],n[0]];return e.computeShapeHelper(!1,t,c,i,r,o,a,s),c}static computeShapeHelper(t,n,i,r,o,a,s,c){if(t)for(let e=0;e<n.length-2;e++)i.push(1);else for(let l=0;l<n.length-2;l++)i.push(e.adjustPadAndReturnShape(n[l+2],r[l],o[l],a[l],s,l,l+n.length-2,c))}static adjustPadAndReturnShape(e,t,n,i,r,o,a,s){let c=n*(i-1)+1;if(!s||"NOTSET"===s)return Math.floor((e+r[o]+r[a]-c)/t+1);switch(s){case"VALID":return r[o]=0,r[a]=0,Math.floor((e-c)/t+1);case"SAME_LOWER":case"SAME_UPPER":if(1!==n)throw new Error("Dilation not supported for SAME_UPPER or SAME_LOWER");{let n=((e+t-1)/t-1)*t+i-e;return r[o]=Math.floor("SAME_LOWER"===s?(n+1)/2:n/2),r[a]=n-r[o],Math.floor((e+n-i)/t+1)}default:throw new Error("Unsupported AutoPad type")}}},zt=class{static getShapeOfGemmResult(e,t,n,i,r){if(2!==e.length||2!==n.length)throw new Error("shape need to be of size 2");let o,a,s;t?(o=e[1],a=e[0]):(o=e[0],a=e[1]);let c=-1;if(i?(s=n[0],c=1):(s=n[1],c=0),n[c]!==a)throw new Error("dimension mismatch");if(o<=0||s<=0||a<=0)throw new Error("invalid shape specified");if(r&&!Pt.isValidBroadcast(r,[o,s]))throw new Error("gemm: invalid bias shape for broadcast");return[o,s,a]}},Mt=-34028234663852886e22,Dt=34028234663852886e22}),Il=re(()=>{El(),Bt=(e,t)=>new(vt(t))(e)}),Al=re(()=>{El(),kl(),Ut=new Map([["float32",32],["float16",16],["int32",32],["uint32",32],["int64",64],["uint64",64],["int8",8],["uint8",8],["int4",4],["uint4",4]]),Ft=(e,t)=>{if("int32"===t)return e;let n=Ut.get(t);if(!n)throw new Error("WebNN backend does not support data type: ".concat(t));let i=n/8;if(e.byteLength%i!==0)throw new Error("Invalid Uint8Array length - must be a multiple of ".concat(i,"."));let r=e.byteLength/i,o=new(vt(t))(e.buffer,e.byteOffset,r);switch(t){case"int64":case"uint64":{let e=new Int32Array(r);for(let t=0;t<r;t++){let n=o[t];if(n>2147483647n||n<-2147483648n)throw new Error("Can not convert int64 data to int32 - value out of range.");e[t]=Number(n)}return new Uint8Array(e.buffer)}case"int8":case"uint8":case"uint32":{if("uint32"===t&&o.some(e=>e>2147483647))throw new Error("Can not convert uint32 data to int32 - value out of range.");let e=Int32Array.from(o,Number);return new Uint8Array(e.buffer)}default:throw new Error("Unsupported data conversion from ".concat(t," to 'int32'"))}},jt=(e,t)=>{if("int32"===t)return e;if(e.byteLength%4!==0)throw new Error("Invalid Uint8Array length - must be a multiple of 4 (int32).");let n=e.byteLength/4,i=new Int32Array(e.buffer,e.byteOffset,n);switch(t){case"int64":{let e=BigInt64Array.from(i,BigInt);return new Uint8Array(e.buffer)}case"uint64":{if(i.some(e=>e<0))throw new Error("Can not convert int32 data to uin64 - negative value found.");let e=BigUint64Array.from(i,BigInt);return new Uint8Array(e.buffer)}case"int8":{if(i.some(e=>e<-128||e>127))throw new Error("Can not convert int32 data to int8 - value out of range.");let e=Int8Array.from(i,Number);return new Uint8Array(e.buffer)}case"uint8":if(i.some(e=>e<0||e>255))throw new Error("Can not convert int32 data to uint8 - value out of range.");return Uint8Array.from(i,Number);case"uint32":{if(i.some(e=>e<0))throw new Error("Can not convert int32 data to uint32 - negative value found.");let e=Uint32Array.from(i,Number);return new Uint8Array(e.buffer)}default:throw new Error("Unsupported data conversion from 'int32' to ".concat(t))}},Vt=1,qt=()=>Vt++,Ht=new Map([["int8","int32"],["uint8","int32"],["uint32","int32"],["int64","int32"]]),Wt=(e,t)=>{let n=Ut.get(e);if(!n)throw new Error("WebNN backend does not support data type: ".concat(e));return t.length>0?Math.ceil(t.reduce((e,t)=>e*t)*n/8):0},Gt=class{constructor(e){this.isDataConverted=!1;let{sessionId:t,context:n,tensor:i,dataType:r,shape:o,fallbackDataType:a}=e;this.sessionId=t,this.mlContext=n,this.mlTensor=i,this.dataType=r,this.tensorShape=o,this.fallbackDataType=a}get tensor(){return this.mlTensor}get type(){return this.dataType}get fallbackType(){return this.fallbackDataType}get shape(){return this.tensorShape}get byteLength(){return Wt(this.dataType,this.tensorShape)}destroy(){Nt("verbose",()=>"[WebNN] TensorWrapper.destroy"),this.mlTensor.destroy()}write(e){this.mlContext.writeTensor(this.mlTensor,e)}async read(e){if(this.fallbackDataType){let t=await this.mlContext.readTensor(this.mlTensor),n=jt(new Uint8Array(t),this.dataType);return e?void(e instanceof ArrayBuffer?new Uint8Array(e):new Uint8Array(e.buffer,e.byteOffset,e.byteLength)).set(n):n.buffer}return e?this.mlContext.readTensor(this.mlTensor,e):this.mlContext.readTensor(this.mlTensor)}canReuseTensor(e,t,n){return this.mlContext===e&&this.dataType===t&&this.tensorShape.length===n.length&&this.tensorShape.every((e,t)=>e===n[t])}setIsDataConverted(e){this.isDataConverted=e}},Kt=class{constructor(e,t){this.tensorManager=e,this.wrapper=t}get tensorWrapper(){return this.wrapper}releaseTensor(){this.tensorWrapper&&(this.tensorManager.releaseTensor(this.tensorWrapper),this.wrapper=void 0)}async ensureTensor(e,t,n,i){let r,o=this.tensorManager.getMLContext(e);if(!o.opSupportLimits().input.dataTypes.includes(t)){if(r=Ht.get(t),!r||!o.opSupportLimits().input.dataTypes.includes(r))throw new Error("WebNN backend does not support data type: ".concat(t));Nt("verbose",()=>"[WebNN] TensorIdTracker.ensureTensor: fallback dataType from ".concat(t," to ").concat(r))}if(this.wrapper){if(this.wrapper.canReuseTensor(o,t,n))return this.wrapper.tensor;if(i){if(this.wrapper.byteLength!==Wt(t,n))throw new Error("Unable to copy data to tensor with different size.");this.activeUpload=new Uint8Array(await this.wrapper.read())}this.tensorManager.releaseTensor(this.wrapper)}let a=typeof MLTensorUsage>"u"?void 0:MLTensorUsage.READ|MLTensorUsage.WRITE;return this.wrapper=await this.tensorManager.getCachedTensor(e,t,n,a,!0,!0,r),i&&this.activeUpload&&(this.wrapper.write(this.activeUpload),this.activeUpload=void 0),this.wrapper.tensor}upload(e){let t=e;if(this.wrapper){if(this.wrapper.fallbackType){if("int32"!==this.wrapper.fallbackType)throw new Error("Unsupported fallback data type: ".concat(this.wrapper.fallbackType));t=Ft(e,this.wrapper.type),this.wrapper.setIsDataConverted(!0)}if(e.byteLength===this.wrapper.byteLength)return void this.wrapper.write(t);Nt("verbose",()=>"Data size does not match tensor size. Releasing tensor."),this.releaseTensor()}this.activeUpload?this.activeUpload.set(t):this.activeUpload=new Uint8Array(t)}async download(e){if(this.activeUpload){var t,n;let i=null!==(t=this.wrapper)&&void 0!==t&&t.isDataConverted?jt(this.activeUpload,null===(n=this.wrapper)||void 0===n?void 0:n.type):this.activeUpload;return e?void(e instanceof ArrayBuffer?new Uint8Array(e).set(i):new Uint8Array(e.buffer,e.byteOffset,e.byteLength).set(i)):i.buffer}if(!this.wrapper)throw new Error("Tensor has not been created.");return e?this.wrapper.read(e):this.wrapper.read()}},Zt=class{constructor(e){this.backend=e,this.tensorTrackersById=new Map,this.freeTensors=[],this.externalTensors=new Set}getMLContext(e){let t=this.backend.getMLContext(e);if(!t)throw new Error("MLContext not found for session.");return t}reserveTensorId(){let e=qt();return this.tensorTrackersById.set(e,new Kt(this)),e}releaseTensorId(e){let t=this.tensorTrackersById.get(e);t&&(this.tensorTrackersById.delete(e),t.tensorWrapper&&this.releaseTensor(t.tensorWrapper))}async ensureTensor(e,t,n,i,r){Nt("verbose",()=>"[WebNN] TensorManager.ensureTensor {tensorId: ".concat(t,", dataType: ").concat(n,", shape: ").concat(i,", copyOld: ").concat(r,"}"));let o=this.tensorTrackersById.get(t);if(!o)throw new Error("Tensor not found.");return o.ensureTensor(e,n,i,r)}upload(e,t){let n=this.tensorTrackersById.get(e);if(!n)throw new Error("Tensor not found.");n.upload(t)}async download(e,t){Nt("verbose",()=>"[WebNN] TensorManager.download {tensorId: ".concat(e,", dstBuffer: ").concat(null===t||void 0===t?void 0:t.byteLength,"}"));let n=this.tensorTrackersById.get(e);if(!n)throw new Error("Tensor not found.");return n.download(t)}releaseTensorsForSession(e){for(let t of this.freeTensors)t.sessionId===e&&t.destroy();this.freeTensors=this.freeTensors.filter(t=>t.sessionId!==e)}registerTensor(e,t,n,i){let r=this.getMLContext(e),o=qt(),a=new Gt({sessionId:e,context:r,tensor:t,dataType:n,shape:i});return this.tensorTrackersById.set(o,new Kt(this,a)),this.externalTensors.add(a),o}async getCachedTensor(e,t,n,i,r,o,a){let s=this.getMLContext(e);for(let[l,u]of this.freeTensors.entries())if(u.canReuseTensor(s,t,n)){Nt("verbose",()=>"[WebNN] Reusing tensor {dataType: ".concat(t,", ").concat(a?"fallbackDataType: ".concat(a,","):""," shape: ").concat(n));let i=this.freeTensors.splice(l,1)[0];return i.sessionId=e,i}Nt("verbose",()=>"[WebNN] MLContext.createTensor {dataType: ".concat(t,", ").concat(a?"fallbackDataType: ".concat(a,","):""," shape: ").concat(n,"}"));let c=await s.createTensor({dataType:null!==a&&void 0!==a?a:t,shape:n,dimensions:n,usage:i,writable:r,readable:o});return new Gt({sessionId:e,context:s,tensor:c,dataType:t,shape:n,fallbackDataType:a})}releaseTensor(e){this.externalTensors.has(e)&&this.externalTensors.delete(e),this.freeTensors.push(e)}},Qt=function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];return new Zt(...t)}}),Nl=re(()=>{El(),wl(),Il(),Al(),kl(),Xt=new Map([[1,"float32"],[10,"float16"],[6,"int32"],[12,"uint32"],[7,"int64"],[13,"uint64"],[22,"int4"],[21,"uint4"],[3,"int8"],[2,"uint8"],[9,"uint8"]]),Yt=(e,t)=>{if(e===t)return!0;if(void 0===e||void 0===t)return!1;let n=Object.keys(e).sort(),i=Object.keys(t).sort();return n.length===i.length&&n.every((n,r)=>n===i[r]&&e[n]===t[n])},Jt=class{constructor(e){this.tensorManager=Qt(this),this.mlContextBySessionId=new Map,this.sessionIdsByMLContext=new Map,this.mlContextCache=[],this.sessionGraphInputs=new Map,this.sessionGraphOutputs=new Map,this.temporaryGraphInputs=[],this.temporaryGraphOutputs=[],this.temporarySessionTensorIds=new Map,It(e.logLevel,!!e.debug)}get currentSessionId(){if(void 0===this.activeSessionId)throw new Error("No active session");return this.activeSessionId}onRunStart(e){Nt("verbose",()=>"[WebNN] onRunStart {sessionId: ".concat(e,"}")),this.activeSessionId=e}onRunEnd(e){Nt("verbose",()=>"[WebNN] onRunEnd {sessionId: ".concat(e,"}"));let t=this.temporarySessionTensorIds.get(e);if(t){for(let e of t)Nt("verbose",()=>"[WebNN] releasing temporary tensor {tensorId: ".concat(e,"}")),this.tensorManager.releaseTensorId(e);this.temporarySessionTensorIds.delete(e),this.activeSessionId=void 0}}async createMLContext(e){if(e instanceof GPUDevice){let t=this.mlContextCache.findIndex(t=>t.gpuDevice===e);if(-1!==t)return this.mlContextCache[t].mlContext;{let t=await navigator.ml.createContext(e);return this.mlContextCache.push({gpuDevice:e,mlContext:t}),t}}if(void 0===e){let e=this.mlContextCache.findIndex(e=>void 0===e.options&&void 0===e.gpuDevice);if(-1!==e)return this.mlContextCache[e].mlContext;{let e=await navigator.ml.createContext();return this.mlContextCache.push({mlContext:e}),e}}let t=this.mlContextCache.findIndex(t=>Yt(t.options,e));if(-1!==t)return this.mlContextCache[t].mlContext;{let t=await navigator.ml.createContext(e);return this.mlContextCache.push({options:e,mlContext:t}),t}}registerMLContext(e,t){this.mlContextBySessionId.set(e,t);let n=this.sessionIdsByMLContext.get(t);n||(n=new Set,this.sessionIdsByMLContext.set(t,n)),n.add(e),this.temporaryGraphInputs.length>0&&(this.sessionGraphInputs.set(e,this.temporaryGraphInputs),this.temporaryGraphInputs=[]),this.temporaryGraphOutputs.length>0&&(this.sessionGraphOutputs.set(e,this.temporaryGraphOutputs),this.temporaryGraphOutputs=[])}onReleaseSession(e){this.sessionGraphInputs.delete(e),this.sessionGraphOutputs.delete(e);let t=this.mlContextBySessionId.get(e);if(!t)return;this.tensorManager.releaseTensorsForSession(e),this.mlContextBySessionId.delete(e);let n=this.sessionIdsByMLContext.get(t);if(n.delete(e),0===n.size){this.sessionIdsByMLContext.delete(t);let e=this.mlContextCache.findIndex(e=>e.mlContext===t);-1!==e&&this.mlContextCache.splice(e,1)}}getMLContext(e){return this.mlContextBySessionId.get(e)}reserveTensorId(){return this.tensorManager.reserveTensorId()}releaseTensorId(e){Nt("verbose",()=>"[WebNN] releaseTensorId {tensorId: ".concat(e,"}")),this.tensorManager.releaseTensorId(e)}async ensureTensor(e,t,n,i,r){let o=Xt.get(n);if(!o)throw new Error("Unsupported ONNX data type: ".concat(n));return this.tensorManager.ensureTensor(null!==e&&void 0!==e?e:this.currentSessionId,t,o,i,r)}async createTemporaryTensor(e,t,n){Nt("verbose",()=>"[WebNN] createTemporaryTensor {onnxDataType: ".concat(t,", shape: ").concat(n,"}"));let i=Xt.get(t);if(!i)throw new Error("Unsupported ONNX data type: ".concat(t));let r=this.tensorManager.reserveTensorId();await this.tensorManager.ensureTensor(e,r,i,n,!1);let o=this.temporarySessionTensorIds.get(e);return o?o.push(r):this.temporarySessionTensorIds.set(e,[r]),r}uploadTensor(e,t){if(!rt().shouldTransferToMLTensor)throw new Error("Trying to upload to a MLTensor while shouldTransferToMLTensor is false");Nt("verbose",()=>"[WebNN] uploadTensor {tensorId: ".concat(e,", data: ").concat(t.byteLength,"}")),this.tensorManager.upload(e,t)}async downloadTensor(e,t){return this.tensorManager.download(e,t)}createMLTensorDownloader(e,t){return async()=>{let n=await this.tensorManager.download(e);return Bt(n,t)}}registerMLTensor(e,t,n,i){let r=Xt.get(n);if(!r)throw new Error("Unsupported ONNX data type: ".concat(n));let o=this.tensorManager.registerTensor(e,t,r,i);return Nt("verbose",()=>"[WebNN] registerMLTensor {tensor: ".concat(t,", dataType: ").concat(r,", dimensions: ").concat(i,"} -> {tensorId: ").concat(o,"}")),o}registerMLConstant(e,t,n,i,r,o){let a=arguments.length>6&&void 0!==arguments[6]&&arguments[6];if(!o)throw new Error("External mounted files are not available.");let s=e;e.startsWith("./")&&(s=e.substring(2));let c=o.get(s);if(!c)throw new Error("File with name ".concat(s," not found in preloaded files."));if(t+n>c.byteLength)throw new Error("Out of bounds: data offset and length exceed the external file data size.");let l,u=c.slice(t,t+n).buffer;switch(r.dataType){case"float32":l=new Float32Array(u);break;case"float16":l=typeof Float16Array<"u"&&Float16Array.from?new Float16Array(u):new Uint16Array(u);break;case"int32":l=new Int32Array(u);break;case"uint32":l=new Uint32Array(u);break;case"int64":if(a){let e=Ft(new Uint8Array(u),"int64");l=new Int32Array(e.buffer),r.dataType="int32"}else l=new BigInt64Array(u);break;case"uint64":l=new BigUint64Array(u);break;case"int8":l=new Int8Array(u);break;case"int4":case"uint4":case"uint8":l=new Uint8Array(u);break;default:throw new Error("Unsupported data type: ".concat(r.dataType," in creating WebNN Constant from external data."))}return Nt("verbose",()=>"[WebNN] registerMLConstant {dataType: ".concat(r.dataType,", shape: ").concat(r.shape,"}} ").concat(a?"(Note: it was int64 data type and registered to int32 as workaround)":"")),i.constant(r,l)}registerGraphInput(e){this.temporaryGraphInputs.push(e)}registerGraphOutput(e){this.temporaryGraphOutputs.push(e)}isGraphInput(e,t){let n=this.sessionGraphInputs.get(e);return!!n&&n.includes(t)}isGraphOutput(e,t){let n=this.sessionGraphOutputs.get(e);return!!n&&n.includes(t)}isGraphInputOutputTypeSupported(e,t){let n=!(arguments.length>2&&void 0!==arguments[2])||arguments[2],i=this.mlContextBySessionId.get(e),r=Xt.get(mt(t));return!(typeof r>"u")&&(n?!(null===i||void 0===i||!i.opSupportLimits().input.dataTypes.includes(r)):!(null===i||void 0===i||!i.opSupportLimits().output.dataTypes.includes(r)))}flush(){}}}),Ol=re(()=>{}),Pl=re(()=>{kl(),Ol(),$t=new Map([[64,250],[128,200],[256,200],[512,200],[2048,230],[4096,200],[8192,50],[16384,50],[32768,50],[65536,50],[131072,50],[262144,50],[524288,50],[1048576,50],[2097152,30],[4194304,20],[8388608,10],[12582912,10],[16777216,10],[26214400,15],[33554432,22],[44236800,2],[58982400,6],[67108864,6],[134217728,6],[167772160,6]]),en=[],tn=e=>16*Math.ceil(Number(e)/16),nn=e=>{for(let t=0;t<en.length;t++){let n=en[t];if(e<=n)return n}return 16*Math.ceil(e/16)},rn=1,on=()=>rn++,an=async(e,t,n,i)=>{let r=tn(n),o=e.device.createBuffer({size:r,usage:GPUBufferUsage.COPY_DST|GPUBufferUsage.MAP_READ});try{let a=e.getCommandEncoder();e.endComputePass(),a.copyBufferToBuffer(t,0,o,0,r),e.flush(),await o.mapAsync(GPUMapMode.READ);let s=o.getMappedRange();if(i){let e=i();return e.set(new Uint8Array(s,0,n)),e}return new Uint8Array(s.slice(0,n))}finally{o.destroy()}},sn=class{constructor(e){this.backend=e,this.storageCache=new Map,this.freeBuffers=new Map,this.freeUniformBuffers=new Map,this.buffersPending=[],this.capturedPendingBuffers=new Map;for(let[t]of $t)en.push(t),this.freeBuffers.set(t,[]),this.freeUniformBuffers.set(t,[]);this.sessionCount=0}upload(e,t){let n=t.buffer,i=t.byteOffset,r=t.byteLength,o=tn(r),a=this.storageCache.get(e);if(!a)throw new Error("gpu data for uploading does not exist");if(Number(a.originalSize)!==r)throw new Error("inconsistent data size. gpu data size=".concat(a.originalSize,", data size=").concat(r));let s=this.backend.device.createBuffer({mappedAtCreation:!0,size:o,usage:GPUBufferUsage.MAP_WRITE|GPUBufferUsage.COPY_SRC}),c=s.getMappedRange();new Uint8Array(c).set(new Uint8Array(n,i,r)),s.unmap();let l=this.backend.device.createCommandEncoder();l.copyBufferToBuffer(s,0,a.gpuData.buffer,0,o),this.backend.device.queue.submit([l.finish()]),s.destroy(),Nt("verbose",()=>"[WebGPU] GpuDataManager.upload(id=".concat(e,")"))}memcpy(e,t){let n=this.storageCache.get(e);if(!n)throw new Error("source gpu data for memcpy does not exist");let i=this.storageCache.get(t);if(!i)throw new Error("destination gpu data for memcpy does not exist");if(n.originalSize!==i.originalSize)throw new Error("inconsistent source and destination gpu data size");let r=tn(n.originalSize),o=this.backend.getCommandEncoder();this.backend.endComputePass(),o.copyBufferToBuffer(n.gpuData.buffer,0,i.gpuData.buffer,0,r)}registerExternalBuffer(e,t,n){let i;if(n){if(i=n[0],e===n[1])return Nt("verbose",()=>"[WebGPU] GpuDataManager.registerExternalBuffer(size=".concat(t,") => id=").concat(i,", buffer is the same, skip.")),i;if(this.backend.capturedCommandList.has(this.backend.currentSessionId))throw new Error("Registering a different external buffer under graph capture mode is not supported yet.\n             Please use the previous external buffer!")}else i=on();return this.storageCache.set(i,{gpuData:{id:i,type:0,buffer:e},originalSize:t}),Nt("verbose",()=>"[WebGPU] GpuDataManager.registerExternalBuffer(size=".concat(t,") => id=").concat(i,", registered.")),i}unregisterExternalBuffer(e){void 0!==e&&(this.storageCache.delete(e),Nt("verbose",()=>"[WebGPU] GpuDataManager.unregisterExternalBuffer() => id=".concat(e)))}create(e){let t,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:GPUBufferUsage.STORAGE|GPUBufferUsage.COPY_SRC|GPUBufferUsage.COPY_DST,i=nn(e),r=(n&GPUBufferUsage.STORAGE)===GPUBufferUsage.STORAGE,o=(n&GPUBufferUsage.UNIFORM)===GPUBufferUsage.UNIFORM;if(r||o){let e=(r?this.freeBuffers:this.freeUniformBuffers).get(i);t=e&&e.length>0?e.pop():this.backend.device.createBuffer({size:i,usage:n})}else t=this.backend.device.createBuffer({size:i,usage:n});let a={id:on(),type:0,buffer:t};return this.storageCache.set(a.id,{gpuData:a,originalSize:Number(e)}),Nt("verbose",()=>"[WebGPU] GpuDataManager.create(size=".concat(e,") => id=").concat(a.id)),a}get(e){var t;return null===(t=this.storageCache.get(e))||void 0===t?void 0:t.gpuData}release(e){let t="bigint"==typeof e?Number(e):e,n=this.storageCache.get(t);if(!n){if(0===this.storageCache.size)return 0;throw new Error("releasing data does not exist")}return Nt("verbose",()=>"[WebGPU] GpuDataManager.release(id=".concat(t,"), gpuDataId=").concat(n.gpuData.id)),this.storageCache.delete(t),this.buffersPending.push(n.gpuData.buffer),n.originalSize}async download(e,t){let n=this.storageCache.get(Number(e));if(!n)throw new Error("data does not exist");await an(this.backend,n.gpuData.buffer,n.originalSize,t)}refreshPendingBuffers(){if(0!==this.buffersPending.length)if("default"===this.backend.sessionStatus){for(let e of this.buffersPending){let t=$t.get(e.size);if((e.usage&GPUBufferUsage.STORAGE)===GPUBufferUsage.STORAGE){let n=this.freeBuffers.get(e.size)||[];void 0===t||n.length>=t?e.destroy():n.push(e)}else if((e.usage&GPUBufferUsage.UNIFORM)===GPUBufferUsage.UNIFORM){let n=this.freeUniformBuffers.get(e.size)||[];void 0===t||n.length>=t?e.destroy():n.push(e)}else e.destroy()}this.buffersPending=[]}else{let e=this.capturedPendingBuffers.get(this.backend.currentSessionId);e||(e=[],this.capturedPendingBuffers.set(this.backend.currentSessionId,e));for(let t of this.buffersPending)e.push(t);this.buffersPending=[]}}dispose(){this.freeBuffers.forEach(e=>{e.forEach(e=>{e.destroy()})}),this.freeUniformBuffers.forEach(e=>{e.forEach(e=>{e.destroy()})}),this.storageCache.forEach(e=>{e.gpuData.buffer.destroy()}),this.capturedPendingBuffers.forEach(e=>{e.forEach(e=>{e.destroy()})}),this.storageCache=new Map,this.freeBuffers=new Map,this.freeUniformBuffers=new Map,this.capturedPendingBuffers=new Map}onCreateSession(){this.sessionCount+=1}onReleaseSession(e){let t=this.capturedPendingBuffers.get(e);t&&(t.forEach(e=>{e.destroy()}),this.capturedPendingBuffers.delete(e)),this.sessionCount-=1,0===this.sessionCount&&(Nt("warning",()=>"[WebGPU] Clearing webgpu buffer cache"),this.storageCache.forEach(e=>{e.gpuData.buffer.destroy()}),this.storageCache=new Map)}},cn=function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];return new sn(...t)}}),Rl=re(()=>{ln=class{constructor(e){Object.assign(this,e)}get cacheKey(){return this.key||(this.key=Object.getOwnPropertyNames(this).sort().map(e=>"".concat(this[e])).join(";")),this.key}},un=e=>new ln(e)}),Ll=re(()=>{El(),Cl(),dn=64,hn=(e,t)=>{if(3===t)throw new Error("vec3 has same alignment as vec4, use vec4 instead");switch(Number(e)){case 10:return t>1?"vec".concat(t,"<f16>"):"f16";case 1:return t>1?"vec".concat(t,"<f32>"):"f32";case 6:return t>1?"vec".concat(t,"<i32>"):"i32";case 12:return t>1?"vec".concat(t,"<u32>"):"u32";case 7:if(t>1)throw new Error("currently not supported vecX of uint64 yet");return["vec2<u32>","i32"];case 13:if(t>1)throw new Error("currently not supported vecX of uint64 yet");return["vec2<u32>","u32"];case 9:if(4!==t)throw new Error("bool must be vec4");return["u32","vec4<bool>"];case 22:return"i32";case 21:return"u32";default:throw new Error("Unknown data type: ".concat(e))}},fn=function(e){let t=hn(e,arguments.length>1&&void 0!==arguments[1]?arguments[1]:1);return"string"==typeof t?t:t[0]},pn=function(e){let t=hn(e,arguments.length>1&&void 0!==arguments[1]?arguments[1]:1);return"string"==typeof t?t:t[1]},mn=function(){let e=[];for(var t=arguments.length,n=new Array(t),i=0;i<t;i++)n[i]=arguments[i];return n.forEach(t=>{0!==t.length&&e.push({type:12,data:t},{type:12,data:Rt.computeStrides(t)})}),e},gn=e=>e%4===0?4:e%2===0?2:1,yn=function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"f32",t=arguments.length>1?arguments[1]:void 0,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"0";return t&&1!==t?"vec".concat(t,"<").concat(e,">(").concat(n,")"):"".concat(e,"(").concat(n,")")},vn=(e,t,n)=>"f32"===e?n:1===t?"f32(".concat(n,")"):"vec".concat(t,"<f32>(").concat(n,")"),_n=(e,t)=>4===t?"(".concat(e,".x + ").concat(e,".y + ").concat(e,".z + ").concat(e,".w)"):2===t?"(".concat(e,".x + ").concat(e,".y)"):3===t?"(".concat(e,".x + ").concat(e,".y + ").concat(e,".z)"):e,wn=(e,t,n,i)=>e.startsWith("uniforms.")&&n>4?"string"==typeof t?"f16"===i?"".concat(e,"[(").concat(t,") / 8][(").concat(t,") % 8 / 4][(").concat(t,") % 8 % 4]"):"".concat(e,"[(").concat(t,") / 4][(").concat(t,") % 4]"):"f16"===i?"".concat(e,"[").concat(Math.floor(t/8),"][").concat(Math.floor(t%8/4),"][").concat(t%8%4,"]"):"".concat(e,"[").concat(Math.floor(t/4),"][").concat(t%4,"]"):n>1?"".concat(e,"[").concat(t,"]"):e,bn=(e,t,n,i,r)=>{let o="number"==typeof n,a=o?n:n.length,s=[...new Array(a).keys()],c=a<2?"u32":a<=4?"vec".concat(a,"<u32>"):"array<u32, ".concat(a,">"),l=hn(t,r),u="string"==typeof l?l:l[1],d="string"==typeof l?l:l[0],h={indices:c,value:u,storage:d,tensor:t},f=e=>"string"==typeof e?e:"".concat(e,"u"),p={offsetToIndices:!1,indicesToOffset:!1,broadcastedIndicesToOffset:!1,set:!1,setByIndices:!1,get:!1,getByIndices:!1},m=o?"uniforms.":"",g="".concat(m).concat(e,"_shape"),y="".concat(m).concat(e,"_strides"),v="";for(let O=0;O<a-1;O++)v+="\n    let dim".concat(O," = current / ").concat(wn(y,O,a),";\n    let rest").concat(O," = current % ").concat(wn(y,O,a),";\n    indices[").concat(O,"] = dim").concat(O,";\n    current = rest").concat(O,";\n    ");v+="indices[".concat(a-1,"] = current;");let _=a<2?"":"\n  fn o2i_".concat(e,"(offset: u32) -> ").concat(h.indices," {\n    var indices: ").concat(h.indices,";\n    var current = offset;\n    ").concat(v,"\n    return indices;\n  }"),w=[];if(a>=2)for(let O=a-1;O>=0;O--)w.push("".concat(wn(y,O,a)," * (indices[").concat(O,"])"));let b=a<2?"":"\n  fn i2o_".concat(e,"(indices: ").concat(h.indices,") -> u32 {\n    return ").concat(w.join("+"),";\n  }"),x=function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];return 0===a?"0u":"".concat(h.indices,"(").concat(t.map(f).join(","),")")},S=(e,t)=>"".concat(a<2?e:wn(e,t,a)),E={},T=(t,n)=>(()=>{if(h.storage===h.value)return"".concat(e,"[").concat(t,"]=").concat(n,";");if("vec2<u32>"===h.storage&&"i32"===h.value)return"".concat(e,"[").concat(t,"]=vec2<u32>(u32(").concat(n,"), select(0u, 0xFFFFFFFFu, ").concat(n," < 0));");if("vec2<u32>"===h.storage&&"u32"===h.value)return"".concat(e,"[").concat(t,"]=vec2<u32>(u32(").concat(n,"), 0u);");if("u32"===h.storage&&"vec4<bool>"===h.value)return"".concat(e,"[").concat(t,"]=dot(vec4<u32>(0x1, 0x100, 0x10000, 0x1000000), vec4<u32>(").concat(n,"));");throw new Error("not supported combination of storage type ".concat(h.storage," and value type ").concat(h.value," yet"))})(),k=t=>(()=>{if(h.storage===h.value)return"".concat(e,"[").concat(t,"]");if("vec2<u32>"===h.storage&&"i32"===h.value)return"i32(".concat(e,"[").concat(t,"].x)");if("vec2<u32>"===h.storage&&"u32"===h.value)return"u32(".concat(e,"[").concat(t,"].x)");if("u32"===h.storage&&"vec4<bool>"===h.value)return"vec4<bool>(bool(".concat(e,"[").concat(t,"] & 0xFFu), bool(").concat(e,"[").concat(t,"] & 0xFF00u), bool(").concat(e,"[").concat(t,"] & 0xFF0000u), bool(").concat(e,"[").concat(t,"] & 0xFF000000u))");throw new Error("not supported combination of storage type ".concat(h.storage," and value type ").concat(h.value," yet"))})(),C=a<2?"":"\n  fn get_".concat(e,"ByIndices(indices: ").concat(h.indices,") -> ").concat(u," {\n    return ").concat(k("i2o_".concat(e,"(indices)")),";\n  }"),I=a<2?"":(()=>{let t=s.map(e=>"d".concat(e,": u32")).join(", "),n=s.map(e=>"d".concat(e)).join(", ");return"\n  fn get_".concat(e,"(").concat(t,") -> ").concat(u," {\n    return get_").concat(e,"ByIndices(").concat(x(n),");\n  }")})(),A=a<2?"":"\n  fn set_".concat(e,"ByIndices(indices: ").concat(h.indices,", value: ").concat(u,") {\n    ").concat(T("i2o_".concat(e,"(indices)"),"value"),"\n  }"),N=a<2?"":(()=>{let t=s.map(e=>"d".concat(e,": u32")).join(", "),n=s.map(e=>"d".concat(e)).join(", ");return"\n  fn set_".concat(e,"(").concat(t,", value: ").concat(u,") {\n    set_").concat(e,"ByIndices(").concat(x(n),", value);\n  }")})();return{impl:()=>{let e=[],t=!1;return p.offsetToIndices&&(e.push(_),t=!0),p.indicesToOffset&&(e.push(b),t=!0),p.broadcastedIndicesToOffset&&(Object.values(E).forEach(t=>e.push(t)),t=!0),p.set&&(e.push(N),t=!0),p.setByIndices&&(e.push(A),t=!0),p.get&&(e.push(I),t=!0),p.getByIndices&&(e.push(C),t=!0),!o&&t&&e.unshift("const ".concat(g," = ").concat(h.indices,"(").concat(n.join(","),");"),"const ".concat(y," = ").concat(h.indices,"(").concat(Rt.computeStrides(n).join(","),");")),e.join("\n")},type:h,offsetToIndices:t=>(p.offsetToIndices=!0,a<2?t:"o2i_".concat(e,"(").concat(t,")")),indicesToOffset:t=>(p.indicesToOffset=!0,a<2?t:"i2o_".concat(e,"(").concat(t,")")),broadcastedIndicesToOffset:(t,n)=>{p.broadcastedIndicesToOffset=!0;let i="".concat(n.name,"broadcastedIndicesTo").concat(e,"Offset");if(i in E)return"".concat(i,"(").concat(t,")");let r=[];for(let e=a-1;e>=0;e--){let t=n.indicesGet("outputIndices",e+n.rank-a);r.push("".concat(S(y,e)," * (").concat(t," % ").concat(S(g,e),")"))}return E[i]="fn ".concat(i,"(outputIndices: ").concat(n.type.indices,") -> u32 {\n             return ").concat(r.length>0?r.join("+"):"0u",";\n           }"),"".concat(i,"(").concat(t,")")},indices:x,indicesGet:S,indicesSet:(e,t,n)=>a<2?"".concat(e,"=").concat(n,";"):"".concat(wn(e,t,a),"=").concat(n,";"),set:function(){for(var t=arguments.length,n=new Array(t),i=0;i<t;i++)n[i]=arguments[i];if(n.length!==a+1)throw new Error("indices length must be ".concat(a));let r=n[a];if("string"!=typeof r)throw new Error("value must be string");let o=n.slice(0,a).map(f).join(",");return 0===a?T("0u",r):1===a?T(o[0],r):(p.set=!0,p.setByIndices=!0,p.indicesToOffset=!0,"set_".concat(e,"(").concat(o,", ").concat(r,")"))},setByOffset:T,setByIndices:(t,n)=>a<2?T(t,n):(p.setByIndices=!0,p.indicesToOffset=!0,"set_".concat(e,"ByIndices(").concat(t,", ").concat(n,");")),get:function(){for(var t=arguments.length,n=new Array(t),i=0;i<t;i++)n[i]=arguments[i];if(n.length!==a)throw new Error("indices length must be ".concat(a));let r=n.map(f).join(",");return 0===a?k("0u"):1===a?k(r[0]):(p.get=!0,p.getByIndices=!0,p.indicesToOffset=!0,"get_".concat(e,"(").concat(r,")"))},getByOffset:k,getByIndices:t=>a<2?k(t):(p.getByIndices=!0,p.indicesToOffset=!0,"get_".concat(e,"ByIndices(").concat(t,")")),usage:i,name:e,strides:y,shape:g,rank:a}},xn=function(e,t,n){return bn(e,t,n,"input",arguments.length>3&&void 0!==arguments[3]?arguments[3]:1)},Sn=function(e,t,n){return bn(e,t,n,"output",arguments.length>3&&void 0!==arguments[3]?arguments[3]:1)},En=(e,t,n)=>bn(e,t,n,"atomicOutput",1),Tn=function(e,t,n){return bn(e,t,n,"internal",arguments.length>3&&void 0!==arguments[3]?arguments[3]:1)},kn=class{constructor(e,t){this.normalizedDispatchGroup=e,this.limits=t,this.internalVariables=[],this.variables=[],this.uniforms=[],this.variableIndex=0}guardAgainstOutOfBoundsWorkgroupSizes(e){return"if (global_idx >= ".concat("number"==typeof e?"".concat(e,"u"):e,") { return; }")}mainStart(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:dn,t="number"==typeof e?e:e[0],n="number"==typeof e?1:e[1],i="number"==typeof e?1:e[2];if(t>this.limits.maxComputeWorkgroupSizeX||n>this.limits.maxComputeWorkgroupSizeY||i>this.limits.maxComputeWorkgroupSizeZ)throw new Error("workgroup size [".concat(t,", ").concat(n,", ").concat(i,"] exceeds the maximum workgroup size [").concat(this.limits.maxComputeWorkgroupSizeX,", ").concat(this.limits.maxComputeWorkgroupSizeY,", ").concat(this.limits.maxComputeWorkgroupSizeZ,"]."));if(t*n*i>this.limits.maxComputeInvocationsPerWorkgroup)throw new Error("workgroup size [".concat(t,", ").concat(n,", ").concat(i,"] exceeds the maximum workgroup invocations ").concat(this.limits.maxComputeInvocationsPerWorkgroup,"."));let r=1===this.normalizedDispatchGroup[1]&&1===this.normalizedDispatchGroup[2],o=r?"@builtin(global_invocation_id) global_id : vec3<u32>,\n    @builtin(workgroup_id) workgroup_id : vec3<u32>,\n    @builtin(local_invocation_index) local_idx : u32,\n    @builtin(local_invocation_id) local_id : vec3<u32>":"@builtin(global_invocation_id) global_id : vec3<u32>,\n                                             @builtin(local_invocation_id) local_id : vec3<u32>,\n    @builtin(local_invocation_index) local_idx : u32,\n    @builtin(workgroup_id) workgroup_id : vec3<u32>,\n    @builtin(num_workgroups) num_workgroups : vec3<u32>",a=r?"let global_idx = global_id.x;\n         let workgroup_index = workgroup_id.x;":"let workgroup_index = workgroup_id.z * num_workgroups[0] * num_workgroups[1] +\n             workgroup_id.y * num_workgroups[0] + workgroup_id.x;\n         let global_idx = workgroup_index * ".concat(t*n*i,"u + local_idx;");return"@compute @workgroup_size(".concat(t,", ").concat(n,", ").concat(i,")\n  fn main(").concat(o,") {\n    ").concat(a,"\n  ")}appendVariableUniforms(e){0!==e.rank&&(e.shape.startsWith("uniforms.")&&this.uniforms.push({name:e.shape.replace("uniforms.",""),type:"u32",length:e.rank}),e.strides.startsWith("uniforms.")&&this.uniforms.push({name:e.strides.replace("uniforms.",""),type:"u32",length:e.rank}))}declareVariable(e,t){if("internal"===e.usage)throw new Error("cannot use internal variable with declareVariable(). use registerInternalVariables() instead.");this.variables.push(e),this.appendVariableUniforms(e);let n="input"===e.usage?"read":"read_write",i="atomicOutput"===e.usage?"atomic<i32>":e.type.storage;return"@group(0) @binding(".concat(t,") var<storage, ").concat(n,"> ").concat(e.name,": array<").concat(i,">;")}declareVariables(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];return t.map(e=>this.declareVariable(e,this.variableIndex++)).join("\n")}registerInternalVariable(e){if("internal"!==e.usage)throw new Error("cannot use input or output variable with registerInternalVariable(). use declareVariables() instead.");this.internalVariables.push(e),this.appendVariableUniforms(e)}registerInternalVariables(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];return t.forEach(e=>this.registerInternalVariable(e)),this}registerUniform(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1;return this.uniforms.push({name:e,type:t,length:n}),this}registerUniforms(e){return this.uniforms=this.uniforms.concat(e),this}uniformDeclaration(){if(0===this.uniforms.length)return"";let e=[];for(let{name:t,type:n,length:i}of this.uniforms)if(i&&i>4)"f16"===n?e.push("@align(16) ".concat(t,":array<mat2x4<").concat(n,">, ").concat(Math.ceil(i/8),">")):e.push("".concat(t,":array<vec4<").concat(n,">, ").concat(Math.ceil(i/4),">"));else{let r=null==i||1===i?n:"vec".concat(i,"<").concat(n,">");e.push("".concat(t,":").concat(r))}return"\n      struct Uniforms { ".concat(e.join(", ")," };\n      @group(0) @binding(").concat(this.variableIndex,") var<uniform> uniforms: Uniforms;")}get additionalImplementations(){return this.uniformDeclaration()+this.variables.map(e=>e.impl()).join("\n")+this.internalVariables.map(e=>e.impl()).join("\n")}get variablesInfo(){if(0===this.uniforms.length)return;let e=e=>[12,10,1,6][["u32","f16","f32","i32"].indexOf(e)];return this.uniforms.map(t=>{var n;return[e(t.type),null!==(n=t.length)&&void 0!==n?n:1]})}},Cn=(e,t)=>new kn(e,t)}),zl=re(()=>{El(),Cl(),Rl(),Ll(),In=(e,t)=>{if(!e||1!==e.length)throw new Error("Transpose requires 1 input.");if(0!==t.length&&t.length!==e[0].dims.length)throw new Error("perm size ".concat(t.length," does not match input rank ").concat(e[0].dims.length))},An=(e,t)=>0!==t.length?t:[...new Array(e).keys()].reverse(),Nn=(e,t)=>Rt.sortBasedOnPerm(e,An(e.length,t)),On=(e,t,n,i)=>{let r="fn perm(i: ".concat(i.type.indices,") -> ").concat(n.type.indices," {\n    var a: ").concat(n.type.indices,";");for(let o=0;o<t;++o)r+="a[".concat(e[o],"]=i[").concat(o,"];");return r+"return a;}"},Pn=(e,t)=>{let n=[],i=[];for(let r=0;r<e.length;++r)1!==e[r]&&n.push(e[r]),1!==e[t[r]]&&i.push(t[r]);return{newShape:n,newPerm:i}},Rn=(e,t)=>{let n=0;for(let i=0;i<e.length;++i)if(1!==t[e[i]]){if(e[i]<n)return!1;n=e[i]}return!0},Ln=(e,t)=>{let n,i=e.dataType,r=e.dims.length,o=An(r,t),a=Nn(e.dims,o),s=e.dims,c=a;if(r<2||Rn(o,e.dims))return n=e=>{let t=xn("input",i,s,4),n=Sn("output",i,c,4);return"\n  ".concat(e.registerUniform("output_size","u32").declareVariables(t,n),"\n  ").concat(e.mainStart(),"\n    ").concat(e.guardAgainstOutOfBoundsWorkgroupSizes("uniforms.output_size"),"\n    output[global_idx] = input[global_idx];\n  }")},{name:"TransposeCopy",shaderCache:{inputDependencies:["type"]},getRunData:()=>{let t=Rt.size(a);return{outputs:[{dims:a,dataType:e.dataType}],dispatchGroup:{x:Math.ceil(t/64/4)},programUniforms:[{type:12,data:Math.ceil(t/4)}]}},getShaderSource:n};let{newShape:l,newPerm:u}=Pn(e.dims,o),d=Rt.areEqual(u,[2,3,1]),h=Rt.areEqual(u,[3,1,2]);if(2===l.length||d||h){s=d?[l[0],l[1]*l[2]]:h?[l[0]*l[1],l[2]]:l,c=[s[1],s[0]];let t=16;return n=e=>{let n=xn("a",i,s.length),r=Sn("output",i,c.length);return"\n  ".concat(e.registerUniform("output_size","u32").declareVariables(n,r),"\n  var<workgroup> tile : array<array<").concat(r.type.value,", ").concat(t+1,">, ").concat(t,">;\n  ").concat(e.mainStart([t,t,1]),"\n    let stride = (uniforms.output_shape[1] - 1) / ").concat(t," + 1;\n    let workgroup_id_x = workgroup_index % stride;\n    let workgroup_id_y = workgroup_index / stride;\n    let input_col = workgroup_id_y * ").concat(t,"u + local_id.x;\n    let input_row = workgroup_id_x * ").concat(t,"u + local_id.y;\n    if (input_row < uniforms.a_shape[0] && input_col < uniforms.a_shape[1]) {\n      tile[local_id.y][local_id.x] = ").concat(n.getByIndices("".concat(n.type.indices,"(input_row, input_col)")),";\n    }\n    workgroupBarrier();\n\n    let output_col = workgroup_id_x * ").concat(t,"u + local_id.x;\n    let output_row = workgroup_id_y * ").concat(t,"u + local_id.y;\n    if (output_row < uniforms.output_shape[0] && output_col < uniforms.output_shape[1]) {\n      ").concat(r.setByIndices("".concat(r.type.indices,"(output_row, output_col)"),"tile[local_id.x][local_id.y]"),"\n    }\n  }")},{name:"TransposeShared",shaderCache:{inputDependencies:["type"]},getRunData:()=>{let n=Rt.size(a);return{outputs:[{dims:a,dataType:e.dataType}],dispatchGroup:{x:Math.ceil(c[1]/t),y:Math.ceil(c[0]/t)},programUniforms:[{type:12,data:n},...mn(s,c)]}},getShaderSource:n}}return n=e=>{let t=xn("a",i,s.length),n=Sn("output",i,c.length);return"\n  ".concat(e.registerUniform("output_size","u32").declareVariables(t,n),"\n\n  ").concat(On(o,r,t,n),"\n\n  ").concat(e.mainStart(),"\n    ").concat(e.guardAgainstOutOfBoundsWorkgroupSizes("uniforms.output_size"),"\n\n    let indices = ").concat(n.offsetToIndices("global_idx"),";\n    let aIndices = perm(indices);\n\n    ").concat(n.setByOffset("global_idx",t.getByIndices("aIndices")),"\n  }")},{name:"Transpose",shaderCache:{hint:"".concat(t),inputDependencies:["rank"]},getRunData:()=>{let t=Rt.size(a);return{outputs:[{dims:a,dataType:e.dataType}],dispatchGroup:{x:Math.ceil(t/64)},programUniforms:[{type:12,data:t},...mn(s,c)]}},getShaderSource:n}},zn=(e,t)=>{In(e.inputs,t.perm),e.compute(Ln(e.inputs[0],t.perm))},Mn=e=>un({perm:e.perm})}),Ml=re(()=>{El(),Cl(),Ll(),Dl(),zl(),Dn={max:"select(bestValue, candidate, candidate > bestValue)",min:"select(bestValue, candidate, candidate < bestValue)",mean:"bestValue + candidate",sum:"bestValue + candidate",prod:"bestValue * candidate",sumSquare:"bestValue + candidate * candidate",logSumExp:"bestValue + exp(candidate)",l1:"bestValue + abs(candidate)",l2:"bestValue + candidate * candidate",logSum:"bestValue + candidate"},Bn={max:"select(bestValue, candidate, candidate > bestValue)",min:"select(bestValue, candidate, candidate < bestValue)",mean:"bestValue + candidate",sum:"bestValue + candidate",prod:"bestValue * candidate",sumSquare:"bestValue + candidate",logSumExp:"bestValue + candidate",l1:"bestValue + candidate",l2:"bestValue + candidate",logSum:"bestValue + candidate"},Un={max:"_A[offset]",min:"_A[offset]",mean:"0",sum:"0",prod:"1",sumSquare:"0",logSumExp:"0",l1:"0",l2:"0",logSum:"0"},Fn={max:"bestValue",min:"bestValue",sum:"bestValue",prod:"bestValue",sumSquare:"bestValue",logSumExp:"log(bestValue)",l1:"bestValue",l2:"sqrt(bestValue)",logSum:"log(bestValue)"},jn=(e,t)=>{let n=[];for(let i=t-e;i<t;++i)n.push(i);return n},Vn=(e,t)=>{let n=[],i=e.length;for(let o=0;o<i;o++)-1===t.indexOf(o)&&n.push(e[o]);let r=t.map(t=>e[t]);return[n,r]},qn=(e,t)=>{let n=e.length+t.length,i=[],r=0;for(let o=0;o<n;o++)-1===t.indexOf(o)?i.push(e[r++]):i.push(1);return i},Hn=(e,t)=>{for(let n=0;n<e.length;++n)if(e[e.length-n-1]!==t-1-n)return!1;return!0},Wn=(e,t)=>{let n=[];if(!Hn(e,t)){for(let i=0;i<t;++i)-1===e.indexOf(i)&&n.push(i);e.forEach(e=>n.push(e))}return n},Gn=(e,t,n,i,r,o,a)=>{let s=n[0].dims,c=Rt.size(o),l=Rt.size(a),u=xn("_A",n[0].dataType,s),d=Sn("output",r,o),h=64;1===c&&(h=256);let f="\n          var<workgroup> aBestValues : array<f32, ".concat(h,">;\n       ");return{name:e,shaderCache:{hint:"".concat(t,";").concat(h),inputDependencies:["type"]},getShaderSource:e=>"\n        ".concat(e.registerUniform("reduceSize","u32").declareVariables(u,d),"\n        ").concat(f,"\n        fn DIV_CEIL(a : u32, b : u32) -> u32 {\n          return ((a - 1u) / b + 1u);\n         }\n         ").concat(e.mainStart(h),"\n\n          let outputIndex = global_idx / ").concat(h,";\n          let offset = outputIndex * uniforms.reduceSize;\n\n          var bestValue = f32(").concat(Un[i],");\n          let Length = uniforms.reduceSize;\n          for (var k = local_idx; k < Length; k = k + ").concat(h,") {\n           let candidate = f32(").concat(u.getByOffset("offset + k"),");\n           bestValue = ").concat(Dn[i],";\n          }\n          aBestValues[local_idx] = bestValue;\n          workgroupBarrier();\n\n         var reduceSize = min(Length, ").concat(h,"u);\n         for (var currentSize = reduceSize / 2u; reduceSize > 1u;\n             currentSize = reduceSize / 2u) {\n           let interval = DIV_CEIL(reduceSize, 2u);\n           if (local_idx < currentSize) {\n            let candidate = aBestValues[local_idx + interval];\n            bestValue = ").concat(Bn[i],";\n            aBestValues[local_idx] = bestValue;\n           }\n           reduceSize = interval;\n           workgroupBarrier();\n         }\n\n         if (local_idx == 0u) {\n          ").concat(d.setByOffset("outputIndex","".concat("mean"===i?"".concat(d.type.storage,"(bestValue / f32(uniforms.reduceSize))"):"".concat(d.type.storage,"(").concat(Fn[i],")"))),";\n         }\n        }"),getRunData:()=>({outputs:[{dims:o,dataType:r}],dispatchGroup:{x:c},programUniforms:[{type:12,data:l}]})}},Kn=(e,t,n,i)=>{let r=1===e.inputs.length?n:si(e.inputs,n),o=r.axes;0===o.length&&!r.noopWithEmptyAxes&&(o=e.inputs[0].dims.map((e,t)=>t));let a=Rt.normalizeAxes(o,e.inputs[0].dims.length),s=a,c=e.inputs[0],l=Wn(s,e.inputs[0].dims.length);l.length>0&&(c=e.compute(Ln(e.inputs[0],l),{inputs:[0],outputs:[-1]})[0],s=jn(s.length,c.dims.length));let[u,d]=Vn(c.dims,s),h=u;r.keepDims&&(h=qn(u,a)),e.compute(Gn(t,r.cacheKey,[c],i,e.inputs[0].dataType,h,d),{inputs:[c]})},Zn=(e,t)=>{Kn(e,"ReduceMeanShared",t,"mean")},Qn=(e,t)=>{Kn(e,"ReduceL1Shared",t,"l1")},Xn=(e,t)=>{Kn(e,"ReduceL2Shared",t,"l2")},Yn=(e,t)=>{Kn(e,"ReduceLogSumExpShared",t,"logSumExp")},Jn=(e,t)=>{Kn(e,"ReduceMaxShared",t,"max")},$n=(e,t)=>{Kn(e,"ReduceMinShared",t,"min")},ei=(e,t)=>{Kn(e,"ReduceProdShared",t,"prod")},ti=(e,t)=>{Kn(e,"ReduceSumShared",t,"sum")},ni=(e,t)=>{Kn(e,"ReduceSumSquareShared",t,"sumSquare")},ii=(e,t)=>{Kn(e,"ReduceLogSumShared",t,"logSum")}}),Dl=re(()=>{El(),Cl(),Rl(),Ll(),Ml(),ri=e=>{if(!e||0===e.length||e.length>2)throw new Error("Reduce op requires 1 or 2 inputs.");if(2===e.length&&1!==e[1].dims.length)throw new Error("Invalid axes input dims.")},oi=e=>["","","var value = ".concat(e.getByIndices("input_indices"),";"),""],ai=function(e,t,n,i,r,o){let a=arguments.length>6&&void 0!==arguments[6]&&arguments[6],s=arguments.length>7&&void 0!==arguments[7]&&arguments[7],c=[],l=n[0].dims,u=l.length,d=Rt.normalizeAxes(r,u),h=!s&&0===d.length;l.forEach((e,t)=>{h||d.indexOf(t)>=0?a&&c.push(1):c.push(e)});let f=c.length,p=Rt.size(c);return{name:e,shaderCache:t,getShaderSource:e=>{let t=[],r=xn("_A",n[0].dataType,u),s=Sn("output",o,f),c=i(r,s,d),p=c[2];for(let n=0,i=0;n<u;n++)h||d.indexOf(n)>=0?(a&&i++,p="for(var j".concat(n,": u32 = 0; j").concat(n," < ").concat(l[n],"; j").concat(n,"++) {\n                  ").concat(c[2].includes("last_index")?"let last_index = j".concat(n,";"):"","\n                  ").concat(r.indicesSet("input_indices",n,"j".concat(n)),"\n                  ").concat(p,"\n                }")):(t.push("".concat(r.indicesSet("input_indices",n,s.indicesGet("output_indices",i)),";")),i++);return"\n\n        ".concat(e.registerUniform("output_size","u32").declareVariables(r,s),"\n\n        ").concat(e.mainStart(),"\n          ").concat(e.guardAgainstOutOfBoundsWorkgroupSizes("uniforms.output_size"),"\n          var input_indices: ").concat(r.type.indices,";\n          let output_indices = ").concat(s.offsetToIndices("global_idx"),";\n\n          ").concat(t.join("\n"),"\n          ").concat(c[0],"       // init ops for reduce max/min\n          ").concat(c[1],"\n          ").concat(p,"\n          ").concat(c[3],"\n          ").concat(4===c.length?s.setByOffset("global_idx","value"):c.slice(4).join("\n"),"\n        }")},getRunData:()=>({outputs:[{dims:c,dataType:o}],dispatchGroup:{x:Math.ceil(p/64)},programUniforms:[{type:12,data:p},...mn(l,c)]})}},si=(e,t)=>{let n=[];return e[1].dims[0]>0&&e[1].getBigInt64Array().forEach(e=>n.push(Number(e))),un({axes:n,keepDims:t.keepDims,noopWithEmptyAxes:t.noopWithEmptyAxes})},ci=(e,t,n,i)=>{let r=e.inputs,o=1===r.length?n:si(r,n);e.compute(ai(t,{hint:o.cacheKey,inputDependencies:["rank"]},[r[0]],o.noopWithEmptyAxes&&0===o.axes.length?oi:i,o.axes,r[0].dataType,o.keepDims,o.noopWithEmptyAxes),{inputs:[0]})},li=(e,t)=>{ri(e.inputs),ci(e,"ReduceLogSum",t,(e,t)=>["var value = ".concat(t.type.storage,"(0);"),"","value += ".concat(e.getByIndices("input_indices"),";"),"value = log(value);"])},ui=(e,t)=>{ri(e.inputs),ci(e,"ReduceL1",t,(e,t)=>["var value = ".concat(t.type.storage,"(0);"),"","value += abs(".concat(e.getByIndices("input_indices"),");"),""])},di=(e,t)=>{ri(e.inputs),ci(e,"ReduceL2",t,(e,t)=>["var t = ".concat(t.type.value,"(0); var value = ").concat(t.type.value,"(0);"),"","t = ".concat(e.getByIndices("input_indices"),"; value += (t * t);"),"value = sqrt(value);"])},hi=(e,t)=>{ri(e.inputs),ci(e,"ReduceLogSumExp",t,(e,t)=>["var value = ".concat(t.type.storage,"(0);"),"","value += exp(".concat(e.getByIndices("input_indices"),");"),"value = log(value);"])},fi=(e,t)=>{ri(e.inputs),ci(e,"ReduceMax",t,(e,t,n)=>{let i=[];for(let r=0;r<e.rank;r++)(n.indexOf(r)>=0||0===n.length)&&i.push(e.indicesSet("input_indices",r,0));return["".concat(i.join("\n")),"var value = ".concat(e.getByIndices("input_indices"),";"),"value = max(value, ".concat(e.getByIndices("input_indices"),");"),""]})},pi=(e,t)=>{ri(e.inputs),ci(e,"ReduceMean",t,(t,n,i)=>{let r=1;for(let o=0;o<t.rank;o++)(i.indexOf(o)>=0||0===i.length)&&(r*=e.inputs[0].dims[o]);return["var sum = f32(0);","","sum += f32(".concat(t.getByIndices("input_indices"),");"),"let value = ".concat(n.type.value,"(sum / ").concat(r,");")]})},mi=(e,t)=>{ri(e.inputs),ci(e,"ReduceMin",t,(e,t,n)=>{let i=[];for(let r=0;r<e.rank;r++)(n.indexOf(r)>=0||0===n.length)&&i.push("input_indices[".concat(r,"] = 0;"));return["".concat(i.join("\n")),"var value = ".concat(e.getByIndices("input_indices"),";"),"value = min(value, ".concat(e.getByIndices("input_indices"),");"),""]})},gi=(e,t)=>{ri(e.inputs),ci(e,"ReduceProd",t,(e,t)=>["var value = ".concat(t.type.storage,"(1);"),"","value *= ".concat(e.getByIndices("input_indices"),";"),""])},yi=(e,t)=>{ri(e.inputs),ci(e,"ReduceSum",t,(e,t)=>["var value = ".concat(t.type.storage,"(0);"),"","value += ".concat(e.getByIndices("input_indices"),";"),""])},vi=(e,t)=>{ri(e.inputs),ci(e,"ReduceSumSquare",t,(e,t)=>["var t = ".concat(t.type.value,"(0); var value = ").concat(t.type.value,"(0);"),"","t = ".concat(e.getByIndices("input_indices"),"; value += t * t;"),""])},_i=(e,t,n)=>{if(0===t.length)return n;let i=1,r=1;for(let o=0;o<t.length;o++)-1===t.indexOf(o)?i*=e[o]:r*=e[o];return r<32&&i>1024},wi=(e,t)=>{_i(e.inputs[0].dims,t.axes,t.noopWithEmptyAxes)?pi(e,t):Zn(e,t)},bi=(e,t)=>{_i(e.inputs[0].dims,t.axes,t.noopWithEmptyAxes)?ui(e,t):Qn(e,t)},xi=(e,t)=>{_i(e.inputs[0].dims,t.axes,t.noopWithEmptyAxes)?di(e,t):Xn(e,t)},Si=(e,t)=>{_i(e.inputs[0].dims,t.axes,t.noopWithEmptyAxes)?hi(e,t):Yn(e,t)},Ei=(e,t)=>{_i(e.inputs[0].dims,t.axes,t.noopWithEmptyAxes)?fi(e,t):Jn(e,t)},Ti=(e,t)=>{_i(e.inputs[0].dims,t.axes,t.noopWithEmptyAxes)?mi(e,t):$n(e,t)},ki=(e,t)=>{_i(e.inputs[0].dims,t.axes,t.noopWithEmptyAxes)?gi(e,t):ei(e,t)},Ci=(e,t)=>{_i(e.inputs[0].dims,t.axes,t.noopWithEmptyAxes)?yi(e,t):ti(e,t)},Ii=(e,t)=>{_i(e.inputs[0].dims,t.axes,t.noopWithEmptyAxes)?vi(e,t):ni(e,t)},Ai=(e,t)=>{_i(e.inputs[0].dims,t.axes,t.noopWithEmptyAxes)?li(e,t):ii(e,t)}}),Bl=re(()=>{El(),Rl(),Dl(),Ni=e=>{if(!e||0===e.length||e.length>2)throw new Error("ArgMinMaxOp op requires 1 or 2 inputs.");if(1!==e[0].dataType)throw new Error("Invalid input type.")},Oi=(e,t)=>{Ni(e.inputs);e.compute(ai("ArgMin",{hint:t.cacheKey,inputDependencies:["rank"]},[e.inputs[0]],(e,n,i)=>{let r=[];for(let t=0;t<e.rank;t++)(i.indexOf(t)>=0||0===i.length)&&r.push("input_indices[".concat(t,"] = 0;"));return["".concat(r.join("\n")),"var value = ".concat(e.getByIndices("input_indices"),";\nvar best_index : i32 = 0;"),"if (".concat(e.getByIndices("input_indices")," ").concat(t.selectLastIndex>0?"<=":"<"," value) {\n         value = ").concat(e.getByIndices("input_indices"),";\n         best_index = i32(last_index);\n       }"),"",n.setByOffset("global_idx","best_index")]},[t.axis],7,t.keepDims),{inputs:[0]})},Pi=(e,t)=>{Ni(e.inputs);e.compute(ai("argMax",{hint:t.cacheKey,inputDependencies:["rank"]},[e.inputs[0]],(e,n,i)=>{let r=[];for(let t=0;t<e.rank;t++)(i.indexOf(t)>=0||0===i.length)&&r.push("input_indices[".concat(t,"] = 0;"));return["".concat(r.join("\n")),"var value = ".concat(e.getByIndices("input_indices"),";\nvar best_index : i32 = 0;"),"if (".concat(e.getByIndices("input_indices")," ").concat(t.selectLastIndex>0?">=":">"," value) {\n         value = ").concat(e.getByIndices("input_indices"),";\n         best_index = i32(last_index);\n       }"),"",n.setByOffset("global_idx","best_index")]},[t.axis],7,t.keepDims),{inputs:[0]})},Ri=e=>un(e)}),Ul=re(()=>{El(),Cl(),Ol(),Ll(),Li=(e,t)=>{let n=e[0],i=e[1],r=e[2],o=e[3],a=e[4],s=e[5];if(a&&s)throw new Error("Attention cannot have both past and attention_bias");if(3!==n.dims.length)throw new Error('Input "input" must have 3 dimensions');let c=n.dims[0],l=n.dims[1],u=n.dims[2];if(1!==r.dims.length)throw new Error('Input "bias" is expected to have 1 dimensions');if(2!==i.dims.length)throw new Error('Input "weights" is expected to have 2 dimensions');if(i.dims[0]!==u)throw new Error("Input 1 dimension 0 should have same length as dimension 2 of input 0");if(r.dims[0]!==i.dims[1])throw new Error('Input "bias" dimension 0 should have same length as dimension 1 of input "weights"');let d=r.dims[0]/3,h=d,f=h;if(t.qkvHiddenSizes.length>0){if(3!==t.qkvHiddenSizes.length)throw new Error("qkv_hidden_sizes attribute should have 3 elements");for(let e of t.qkvHiddenSizes)if(e%t.numHeads!==0)throw new Error("qkv_hidden_sizes should be divisible by num_heads");d=t.qkvHiddenSizes[0],h=t.qkvHiddenSizes[1],f=t.qkvHiddenSizes[2]}let p=l;if(d!==h)throw new Error("qkv_hidden_sizes first element should be same as the second");if(r.dims[0]!==d+h+f)throw new Error('Input "bias" dimension 0 should have same length as sum of Q/K/V hidden sizes');let m=0;if(a){if(h!==f)throw new Error('Input "past" expect k_hidden_size == v_hidden_size');if(5!==a.dims.length)throw new Error('Input "past" must have 5 dimensions');if(2!==a.dims[0])throw new Error('Input "past" first dimension must be 2');if(a.dims[1]!==c)throw new Error('Input "past" second dimension must be batch_size');if(a.dims[2]!==t.numHeads)throw new Error('Input "past" third dimension must be num_heads');if(a.dims[4]!==h/t.numHeads)throw new Error('Input "past" fifth dimension must be k_hidden_size / num_heads');t.pastPresentShareBuffer||(m=a.dims[3])}let g=p+m;if(o)throw new Error("Mask not supported");if(a)throw new Error("past is not supported");if(s){if(4!==s.dims.length)throw new Error('Input "attention_bias" must have 4 dimensions');if(s.dims[0]!==c||s.dims[1]!==t.numHeads||s.dims[2]!==l||s.dims[3]!==g)throw new Error('Expect "attention_bias" shape (batch_size, num_heads, sequence_length, total_sequence_length)')}return{batchSize:c,sequenceLength:l,pastSequenceLength:m,kvSequenceLength:p,totalSequenceLength:g,maxSequenceLength:-1,inputHiddenSize:u,hiddenSize:d,vHiddenSize:f,headSize:Math.floor(d/t.numHeads),vHeadSize:Math.floor(f/t.numHeads),numHeads:t.numHeads,isUnidirectional:!1,pastPresentShareBuffer:!1,maskFilterValue:t.maskFilterValue,maskType:0,scale:t.scale,broadcastResPosBias:!1,passPastInKv:!1,qkvFormat:1}},zi=(e,t,n)=>t&&e?"\n      let total_sequence_length_input = u32(".concat(t.getByOffset("0"),");\n      let present_sequence_length = max(total_sequence_length_input, uniforms.past_sequence_length);\n      let is_subsequent_prompt: bool = sequence_length > 1 && sequence_length != total_sequence_length_input;\n      let is_first_prompt: bool = is_subsequent_prompt == false && sequence_length == total_sequence_length_input;\n      total_sequence_length = u32(").concat(null===e||void 0===e?void 0:e.getByOffset("batchIdx"),") + 1;\n      var past_sequence_length: u32 = 0;\n      if (is_first_prompt == false) {\n        past_sequence_length = total_sequence_length - sequence_length;\n      }\n       "):"\n    ".concat(n?"let past_sequence_length = uniforms.past_sequence_length":"",";\n    let present_sequence_length = total_sequence_length;\n    "),Mi=(e,t,n,i,r,o,a,s)=>{let c=gn(a?1:o),l=64,u=o/c;u<l&&(l=32);let d=Math.ceil(o/c/l),h=[{type:12,data:t},{type:12,data:n},{type:12,data:i},{type:12,data:r},{type:12,data:u},{type:12,data:d}],f=fn(e.dataType,c),p=pn(1,c),m=["type"];a&&m.push("type"),s&&m.push("type");return{name:"AttentionProbsSoftmax",shaderCache:{hint:"".concat(l,";").concat(f,";").concat(c),inputDependencies:m},getShaderSource:t=>{let n=Sn("x",e.dataType,e.dims,c),i=[n],r=a?xn("seq_lens",a.dataType,a.dims):void 0;r&&i.push(r);let o=s?xn("total_sequence_length_input",s.dataType,s.dims):void 0;o&&i.push(o);let u=pn(e.dataType);return"\n  var<workgroup> thread_max: array<f32, ".concat(l,">;\n  var<workgroup> thread_sum: array<f32, ").concat(l,">;\n  ").concat(t.registerUniforms([{name:"batch_size",type:"u32"},{name:"num_heads",type:"u32"},{name:"past_sequence_length",type:"u32"},{name:"sequence_length",type:"u32"},{name:"total_sequence_length",type:"u32"},{name:"elements_per_thread",type:"u32"}]).declareVariables(...i),"\n  ").concat(t.mainStart([l,1,1]),"\n    let batchIdx = workgroup_id.z / uniforms.num_heads;\n    let headIdx = workgroup_id.z % uniforms.num_heads;\n    let sequence_length = uniforms.sequence_length;\n    var total_sequence_length = uniforms.total_sequence_length;\n    ").concat(zi(r,o,!1),"\n    let local_offset = local_idx * uniforms.elements_per_thread;\n    let offset = (global_idx / ").concat(l,") * uniforms.total_sequence_length + local_offset;\n    let seq_causal_length = ").concat(a?"u32(past_sequence_length + workgroup_id.y + 1)":"total_sequence_length",";\n    var thread_max_vector = ").concat(p,"(-3.402823e+38f);\n    for (var i: u32 = 0; i < uniforms.elements_per_thread && i + local_offset < seq_causal_length; i++) {\n      thread_max_vector = max(").concat(p,"(x[offset + i]), thread_max_vector);\n    }\n    thread_max[local_idx] = ").concat((()=>{switch(c){case 1:return"thread_max_vector";case 2:return"max(thread_max_vector.x, thread_max_vector.y)";case 4:return"max(max(thread_max_vector.x, thread_max_vector.y), max(thread_max_vector.z, thread_max_vector.w))";default:throw new Error("Unsupported components: ".concat(c))}})(),";\n    workgroupBarrier();\n\n    var max_value =  f32(-3.402823e+38f);\n    for (var i = 0u; i < ").concat(l,"; i++) {\n      max_value = max(thread_max[i], max_value);\n    }\n\n    var sum_vector = ").concat(p,"(0);\n    for (var i: u32 = 0; i < uniforms.elements_per_thread && i + local_offset < seq_causal_length; i++) {\n      sum_vector += exp(").concat(p,"(x[offset + i]) - max_value);\n    }\n    thread_sum[local_idx] = ").concat((()=>{switch(c){case 1:return"sum_vector";case 2:return"sum_vector.x + sum_vector.y";case 4:return"sum_vector.x + sum_vector.y + sum_vector.z + sum_vector.w";default:throw new Error("Unsupported components: ".concat(c))}})(),";\n    workgroupBarrier();\n\n    var sum: f32 = 0;\n    for (var i = 0u; i < ").concat(l,"; i++) {\n      sum += thread_sum[i];\n    }\n\n    if (sum == 0) {\n      for (var i: u32 = 0; i < uniforms.elements_per_thread && i + local_offset < seq_causal_length; i++) {\n        x[offset + i] = ").concat(n.type.value,"(").concat(u,"(1.0) / ").concat(u,"(seq_causal_length));\n      }\n    } else {\n      for (var i: u32 = 0; i < uniforms.elements_per_thread && i + local_offset < seq_causal_length; i++) {\n        var f32input = ").concat(p,"(x[offset + i]);\n        x[offset + i] = ").concat(n.type.value,"(exp(f32input - max_value) / sum);\n      }\n    }\n      ").concat(a?"\n        for (var total_seq_id: u32 = seq_causal_length; total_seq_id + local_offset < uniforms.total_sequence_length; total_seq_id++) {\n          x[offset + total_seq_id] = ".concat(n.type.value,"(").concat(u,"(0));\n        }"):"",";\n  }")},getRunData:()=>({outputs:[],dispatchGroup:{x:1,y:r,z:t*n},programUniforms:h})}},Di=(e,t,n,i,r,o,a,s,c)=>{let l=a+o.kvSequenceLength,u=[o.batchSize,o.numHeads,o.sequenceLength,l],d=e>1&&i,h=o.kvNumHeads?o.kvNumHeads:o.numHeads,f=d?[o.batchSize,h,l,o.headSize]:void 0,p=o.nReps?o.nReps:1,m=0===o.scale?1/Math.sqrt(o.headSize):o.scale,g=gn(o.headSize),y=o.headSize/g,v=12,_={x:Math.ceil(l/v),y:Math.ceil(o.sequenceLength/v),z:o.batchSize*o.numHeads},w=[{type:12,data:o.sequenceLength},{type:12,data:y},{type:12,data:l},{type:12,data:o.numHeads},{type:12,data:o.headSize},{type:1,data:m},{type:12,data:a},{type:12,data:o.kvSequenceLength},{type:12,data:p}],b=d&&i&&Rt.size(i.dims)>0,x=["type","type"];b&&x.push("type"),r&&x.push("type"),s&&x.push("type"),c&&x.push("type");let S=[{dims:u,dataType:t.dataType,gpuDataType:0}];d&&S.push({dims:f,dataType:t.dataType,gpuDataType:0});return{name:"AttentionProbs",shaderCache:{hint:"".concat(g,";").concat(void 0!==r,";").concat(void 0!==i,";").concat(e),inputDependencies:x},getRunData:()=>({outputs:S,dispatchGroup:_,programUniforms:w}),getShaderSource:e=>{let o=xn("q",t.dataType,t.dims,g),a=[o,xn("key",n.dataType,n.dims,g)];if(b){let e=xn("past_key",i.dataType,i.dims,g);a.push(e)}r&&a.push(xn("attention_bias",r.dataType,r.dims));let l=s?xn("seq_lens",s.dataType,s.dims):void 0;l&&a.push(l);let h=c?xn("total_sequence_length_input",c.dataType,c.dims):void 0;h&&a.push(h);let m=Sn("output",t.dataType,u),y=[m];d&&y.push(Sn("present_key",t.dataType,f,g));let _=pn(1,g);return"\n  const TILE_SIZE = ".concat(v,"u;\n\n  var<workgroup> tileQ: array<").concat(o.type.storage,", ").concat(144,">;\n  var<workgroup> tileK: array<").concat(o.type.storage,", ").concat(144,">;\n  ").concat(e.registerUniforms([{name:"M",type:"u32"},{name:"K",type:"u32"},{name:"N",type:"u32"},{name:"num_heads",type:"u32"},{name:"head_size",type:"u32"},{name:"alpha",type:"f32"},{name:"past_sequence_length",type:"u32"},{name:"kv_sequence_length",type:"u32"},{name:"n_reps",type:"u32"}]).declareVariables(...a,...y),"\n  ").concat(e.mainStart([v,v,1]),"\n    // x holds the N and y holds the M\n    let headIdx = workgroup_id.z % uniforms.num_heads;\n    let kvHeadIdx = ").concat(1===p?"headIdx":"headIdx / uniforms.n_reps",";\n    let kv_num_heads = ").concat(1===p?"uniforms.num_heads":"uniforms.num_heads / uniforms.n_reps",";\n    let batchIdx = workgroup_id.z / uniforms.num_heads;\n    let m = workgroup_id.y * TILE_SIZE;\n    let n = workgroup_id.x * TILE_SIZE;\n    let sequence_length = uniforms.M;\n    var total_sequence_length = uniforms.N;\n    ").concat(zi(l,h,!0),"\n    let absKvHeadIdx = batchIdx * kv_num_heads + kvHeadIdx;\n    let qOffset = workgroup_id.z * uniforms.M * uniforms.K + m * uniforms.K;\n    ").concat(b&&d?"let pastKeyOffset = absKvHeadIdx * uniforms.past_sequence_length * uniforms.K;":"",";\n    let kOffset = absKvHeadIdx * uniforms.kv_sequence_length * uniforms.K;\n    ").concat(d?"let presentKeyOffset = absKvHeadIdx * uniforms.N * uniforms.K;":"","\n    var value = ").concat(_,"(0);\n    for (var w: u32 = 0u; w < uniforms.K; w += TILE_SIZE) {\n      if (global_id.y < uniforms.M && w + local_id.x < uniforms.K) {\n        tileQ[TILE_SIZE * local_id.y + local_id.x] = q[qOffset + local_id.y * uniforms.K + w + local_id.x];\n      }\n      if (n + local_id.y < uniforms.N && w + local_id.x < uniforms.K) {\n        var idx = TILE_SIZE * local_id.y + local_id.x;\n      ").concat(b&&d?"\n              if (n + local_id.y < past_sequence_length) {\n                tileK[idx] = past_key[pastKeyOffset + (n + local_id.y) * uniforms.K + w + local_id.x];\n              } else if (n + local_id.y - past_sequence_length < uniforms.kv_sequence_length) {\n                tileK[idx] = key[kOffset + (n + local_id.y - past_sequence_length) * uniforms.K + w + local_id.x];\n              }":"\n          if (n + local_id.y < uniforms.kv_sequence_length) {\n            tileK[idx] = key[kOffset + (n + local_id.y) * uniforms.K + w + local_id.x];\n          }","\n      ").concat(d?"if (n + local_id.y < present_sequence_length) {\n        present_key[presentKeyOffset + (n + local_id.y) * uniforms.K + w + local_id.x] = tileK[idx];\n      }":"","\n      }\n      workgroupBarrier();\n\n      for (var k: u32 = 0u; k < TILE_SIZE && w+k < uniforms.K; k++) {\n          value += ").concat(_,"(tileQ[TILE_SIZE * local_id.y + k] * tileK[TILE_SIZE * local_id.x + k]);\n      }\n\n      workgroupBarrier();\n    }\n\n    if (global_id.y < uniforms.M && global_id.x < total_sequence_length) {\n      let headOffset = workgroup_id.z * uniforms.M * uniforms.N;\n      let outputIdx = headOffset + global_id.y * uniforms.N + global_id.x;\n      var sum: f32 = ").concat((()=>{switch(g){case 1:return"value";case 2:return"value.x + value.y";case 4:return"value.x + value.y + value.z + value.w";default:throw new Error("Unsupported components: ".concat(g))}})(),";\n        output[outputIdx] = ").concat(m.type.value," (sum * uniforms.alpha) + ").concat(r?"attention_bias[outputIdx]":"0.0",";\n    }\n  }")}}},Bi=function(e,t,n,i,r,o){let a=arguments.length>6&&void 0!==arguments[6]?arguments[6]:void 0,s=arguments.length>7&&void 0!==arguments[7]?arguments[7]:void 0,c=o+r.kvSequenceLength,l=r.nReps?r.nReps:1,u=r.vHiddenSize*l,d=e>1&&i,h=r.kvNumHeads?r.kvNumHeads:r.numHeads,f=d?[r.batchSize,h,c,r.headSize]:void 0,p=[r.batchSize,r.sequenceLength,u],m=12,g={x:Math.ceil(r.vHeadSize/m),y:Math.ceil(r.sequenceLength/m),z:r.batchSize*r.numHeads},y=[{type:12,data:r.sequenceLength},{type:12,data:c},{type:12,data:r.vHeadSize},{type:12,data:r.numHeads},{type:12,data:r.headSize},{type:12,data:u},{type:12,data:o},{type:12,data:r.kvSequenceLength},{type:12,data:l}],v=d&&i&&Rt.size(i.dims)>0,_=["type","type"];v&&_.push("type"),a&&_.push("type"),s&&_.push("type");let w=[{dims:p,dataType:t.dataType,gpuDataType:0}];d&&w.push({dims:f,dataType:t.dataType,gpuDataType:0});return{name:"AttentionScore",shaderCache:{hint:"".concat(void 0!==i,";").concat(e),inputDependencies:_},getRunData:()=>({outputs:w,dispatchGroup:g,programUniforms:y}),getShaderSource:e=>{let r=xn("probs",t.dataType,t.dims),o=[r,xn("v",n.dataType,n.dims)];v&&o.push(xn("past_value",i.dataType,i.dims));let c=a?xn("seq_lens",a.dataType,a.dims):void 0;a&&o.push(c);let u=s?xn("total_sequence_length_input",s.dataType,s.dims):void 0;s&&o.push(u);let h=[Sn("output",t.dataType,p)];d&&h.push(Sn("present_value",t.dataType,f));return"\n  const TILE_SIZE = ".concat(m,"u;\n  var<workgroup> tileQ: array<").concat(r.type.value,", ").concat(144,">;\n  var<workgroup> tileV: array<").concat(r.type.value,", ").concat(144,">;\n  ").concat(e.registerUniforms([{name:"M",type:"u32"},{name:"K",type:"u32"},{name:"N",type:"u32"},{name:"num_heads",type:"u32"},{name:"head_size",type:"u32"},{name:"v_hidden_size",type:"u32"},{name:"past_sequence_length",type:"u32"},{name:"kv_sequence_length",type:"u32"},{name:"n_reps",type:"u32"}]).declareVariables(...o,...h),"\n  ").concat(e.mainStart([m,m,1]),"\n   let headIdx = workgroup_id.z % uniforms.num_heads;\n   let batchIdx = workgroup_id.z / uniforms.num_heads;\n   let kvHeadIdx = ").concat(1===l?"headIdx":"headIdx / uniforms.n_reps",";\n   let kv_num_heads = ").concat(1===l?"uniforms.num_heads":"uniforms.num_heads / uniforms.n_reps",";\n   let m = global_id.y;\n   let n = global_id.x;\n   let sequence_length = uniforms.M;\n   var total_sequence_length = uniforms.K;\n   ").concat(zi(c,u,!0),"\n   let offsetA = workgroup_id.z * uniforms.M * uniforms.K + m * uniforms.K;\n   let absKvHeadIdx = batchIdx * kv_num_heads + kvHeadIdx; // kvHeadIdx is relative to the batch\n   ").concat(v&&d?"let pastValueOffset = absKvHeadIdx * uniforms.N * uniforms.past_sequence_length + n;":"",";\n   let vOffset = absKvHeadIdx * uniforms.N * uniforms.kv_sequence_length + n;\n   ").concat(d?"let presentValueOffset = absKvHeadIdx * uniforms.N * uniforms.K + n;":"","\n   var value = ").concat(r.type.storage,"(0);\n   for (var w: u32 = 0u; w < uniforms.K; w += TILE_SIZE) {\n      if (m < uniforms.M && w + local_id.x < uniforms.K) {\n        tileQ[TILE_SIZE * local_id.y + local_id.x] = probs[offsetA + w + local_id.x];\n      }\n      if (n < uniforms.N && w + local_id.y < uniforms.K) {\n        var idx = TILE_SIZE * local_id.y + local_id.x;\n        ").concat(v&&d?"\n        if (w + local_id.y < past_sequence_length) {\n          tileV[idx] = past_value[pastValueOffset + (w + local_id.y) * uniforms.N];\n        } else if (w + local_id.y - past_sequence_length < uniforms.kv_sequence_length) {\n          tileV[idx] = v[vOffset + (w + local_id.y - past_sequence_length) * uniforms.N];\n        }\n      ":"\n            if (w + local_id.y < uniforms.kv_sequence_length) {\n              tileV[idx] = v[vOffset + (w + local_id.y) * uniforms.N];\n            }","\n        ").concat(d?"\n            if (w + local_id.y < present_sequence_length) {\n          present_value[presentValueOffset + (w + local_id.y) * uniforms.N] = tileV[idx];\n        }":"","\n      }\n     workgroupBarrier();\n     for (var k: u32 = 0u; k < TILE_SIZE && w+k < total_sequence_length; k++) {\n       value += tileQ[TILE_SIZE * local_id.y + k] * tileV[TILE_SIZE * k + local_id.x];\n     }\n     workgroupBarrier();\n   }\n\n   // we need to transpose output from BNSH_v to BSND_v\n   if (m < uniforms.M && n < uniforms.N) {\n     let outputIdx = batchIdx * uniforms.M * uniforms.v_hidden_size + m * uniforms.v_hidden_size\n       + headIdx * uniforms.N + n;\n     output[outputIdx] = value;\n   }\n  }")}}},Ui=function(e,t,n,i,r,o,a,s,c,l){let u=arguments.length>10&&void 0!==arguments[10]?arguments[10]:void 0,d=arguments.length>11&&void 0!==arguments[11]?arguments[11]:void 0,h=Math.min(e.outputCount,1+(a?1:0)+(s?1:0)),f=h>1?l.pastSequenceLength:0,p=f+l.kvSequenceLength,m=c&&Rt.size(c.dims)>0?c:void 0,g=[t,n];h>1&&a&&Rt.size(a.dims)>0&&g.push(a),m&&g.push(m),u&&g.push(u),d&&g.push(d);let y=e.compute(Di(h,t,n,a,m,l,f,u,d),{inputs:g,outputs:h>1?[-1,1]:[-1]})[0];e.compute(Mi(y,l.batchSize,l.numHeads,f,l.sequenceLength,p,u,d),{inputs:u&&d?[y,u,d]:[y],outputs:[]});let v=[y,i];h>1&&s&&Rt.size(s.dims)>0&&v.push(s),u&&v.push(u),d&&v.push(d),e.compute(Bi(h,y,i,s,l,f,u,d),{inputs:v,outputs:h>1?[0,2]:[0]})},Fi=(e,t)=>{let n=[t.batchSize,t.numHeads,t.sequenceLength,t.headSize],i=t.sequenceLength,r=t.inputHiddenSize,o=t.headSize,a=12,s={x:Math.ceil(t.headSize/a),y:Math.ceil(t.sequenceLength/a),z:t.batchSize*t.numHeads},c=[e.inputs[0],e.inputs[1],e.inputs[2]],l=[{type:12,data:i},{type:12,data:r},{type:12,data:o},{type:12,data:t.numHeads},{type:12,data:t.headSize},{type:12,data:t.hiddenSize},{type:12,data:t.hiddenSize+t.hiddenSize+t.vHiddenSize}];return e.compute({name:"AttentionPrepare",shaderCache:{inputDependencies:["type","type","type"]},getRunData:()=>({outputs:[{dims:n,dataType:e.inputs[0].dataType,gpuDataType:0},{dims:n,dataType:e.inputs[0].dataType,gpuDataType:0},{dims:n,dataType:e.inputs[0].dataType,gpuDataType:0}],dispatchGroup:s,programUniforms:l}),getShaderSource:e=>{let t=Sn("output_q",c[0].dataType,n),i=Sn("output_k",c[0].dataType,n),r=Sn("output_v",c[0].dataType,n),o=xn("input",c[0].dataType,c[0].dims),s=xn("weight",c[1].dataType,c[1].dims),l=xn("bias",c[2].dataType,c[2].dims),u=o.type.storage;return"\n  const TILE_SIZE = ".concat(a,"u;\n  var<workgroup> tileInput: array<").concat(u,", ").concat(144,">;\n  var<workgroup> tileWeightQ: array<").concat(u,", ").concat(144,">;\n  var<workgroup> tileWeightK: array<").concat(u,", ").concat(144,">;\n  var<workgroup> tileWeightV: array<").concat(u,", ").concat(144,">;\n  ").concat(e.registerUniforms([{name:"M",type:"u32"},{name:"K",type:"u32"},{name:"N",type:"u32"},{name:"num_heads",type:"u32"},{name:"head_size",type:"u32"},{name:"hidden_size",type:"u32"},{name:"ldb",type:"u32"}]).declareVariables(o,s,l,t,i,r),"\n  ").concat(e.mainStart([a,a,1]),"\n    let batchIndex = workgroup_id.z / uniforms.num_heads;\n    let headNumber = workgroup_id.z % uniforms.num_heads;\n    let m = global_id.y;\n    let n = global_id.x;\n\n    let inputOffset = batchIndex * (uniforms.M * uniforms.K) + m * uniforms.K;\n    let biasOffsetQ = headNumber * uniforms.head_size;\n    let biasOffsetK = uniforms.hidden_size + biasOffsetQ;\n    let biasOffsetV = uniforms.hidden_size + biasOffsetK;\n\n    var valueQ = ").concat(u,"(0);\n    var valueK = ").concat(u,"(0);\n    var valueV = ").concat(u,"(0);\n    for (var w: u32 = 0u; w < uniforms.K; w += TILE_SIZE) {\n      if (m < uniforms.M && w + local_id.x < uniforms.K) {\n        tileInput[TILE_SIZE * local_id.y + local_id.x] = input[inputOffset + w + local_id.x];\n      }\n      if (n < uniforms.N && w + local_id.y < uniforms.K) {\n        let offset = n + (w + local_id.y) * uniforms.ldb;\n        tileWeightQ[TILE_SIZE * local_id.y + local_id.x] = weight[biasOffsetQ + offset];\n        tileWeightK[TILE_SIZE * local_id.y + local_id.x] = weight[biasOffsetK + offset];\n        tileWeightV[TILE_SIZE * local_id.y + local_id.x] = weight[biasOffsetV + offset];\n      }\n      workgroupBarrier();\n      for (var k: u32 = 0u; k<TILE_SIZE && w+k < uniforms.K; k++) {\n        let inputTileOffset = TILE_SIZE * local_id.y + k;\n        let weightTileOffset = TILE_SIZE * k + local_id.x;\n        valueQ += tileInput[inputTileOffset] * tileWeightQ[weightTileOffset];\n        valueK += tileInput[inputTileOffset] * tileWeightK[weightTileOffset];\n        valueV += tileInput[inputTileOffset] * tileWeightV[weightTileOffset];\n      }\n\n      workgroupBarrier();\n    }\n\n    let headOffset = (m * uniforms.N + n) % uniforms.head_size;\n    valueQ += bias[headOffset + biasOffsetQ];\n    valueK += bias[headOffset + biasOffsetK];\n    valueV += bias[headOffset + biasOffsetV];\n\n    let offset = workgroup_id.z * uniforms.M * uniforms.N;\n    if (m < uniforms.M && n < uniforms.N) {\n      let outputIdx = offset + m * uniforms.N + n;\n      output_q[outputIdx] = valueQ;\n      output_k[outputIdx] = valueK;\n      output_v[outputIdx] = valueV;\n    }\n  }")}},{inputs:c,outputs:[-1,-1,-1]})},ji=(e,t)=>{let n=Li(e.inputs,t),[i,r,o]=Fi(e,n);return Ui(e,i,r,o,e.inputs[4],void 0,void 0,void 0,e.inputs[5],n)}}),Fl=re(()=>{ke(),El(),Cl(),Rl(),Ll(),Vi=(e,t)=>{if(!e||5!==e.length)throw new Error("BatchNormalization requires 5 inputs");let n=(e,t,n)=>{let i=t.length;if(i!==e.length)throw new Error("".concat(n,": num dimensions != ").concat(i));t.forEach((t,i)=>{if(t!==e[i])throw new Error("".concat(n,": dim[").concat(i,"] do not match"))})};if(e[0].dims.length>1){let i="NHWC"===t.format?t.spatial?e[0].dims.slice(-1):e[0].dims.slice(-1).concat(e[0].dims.slice(1,e[0].dims.length-1)):e[0].dims.slice(1,t.spatial?2:void 0);n(e[1].dims,i,"Invalid input scale"),n(e[2].dims,i,"Invalid input B"),n(e[3].dims,i,"Invalid input mean"),n(e[4].dims,i,"Invalid input var")}else n(e[1].dims,[1],"Invalid input scale"),n(e[2].dims,[1],"Invalid input B"),n(e[3].dims,[1],"Invalid input mean"),n(e[4].dims,[1],"Invalid input var")},qi=(e,t)=>{let{epsilon:n,spatial:i,format:r}=t,o=e[0].dims,a=i?gn(o[o.length-1]):1,s="NHWC"===r&&o.length>1?a:1,c=Rt.size(o)/a,l=i,u=l?o.length:o,d=xn("x",e[0].dataType,e[0].dims,a),h=xn("scale",e[1].dataType,e[1].dims,s),f=xn("bias",e[2].dataType,e[2].dims,s),p=xn("inputMean",e[3].dataType,e[3].dims,s),m=xn("inputVar",e[4].dataType,e[4].dims,s),g=Sn("y",e[0].dataType,u,a);return{name:"BatchNormalization",shaderCache:{hint:"".concat(t.epsilon,"_").concat(t.format,"_").concat(i,"_").concat(a),inputDependencies:l?["rank","type","type","type","type"]:void 0},getShaderSource:e=>"\n  const epsilon = ".concat(n,";\n  ").concat(e.registerUniform("outputSize","u32").declareVariables(d,h,f,p,m,g),"\n  ").concat(e.mainStart(),"\n  ").concat(e.guardAgainstOutOfBoundsWorkgroupSizes("uniforms.outputSize"),"\n    var outputIndices = ").concat(g.offsetToIndices("global_idx * ".concat(a)),";\n    ").concat((()=>{let e="";if(i)e="let cOffset = ".concat(1===o.length?"0u":"NHWC"===r?"outputIndices[".concat(o.length-1,"] / ").concat(a):"outputIndices[1]",";");else if("NCHW"===r)e="\n            ".concat(g.indicesSet("outputIndices","0","0"),"\n            let cOffset = ").concat(g.indicesToOffset("outputIndices"),";");else{e="var cIndices = ".concat(h.type.indices,"(0);\n                       cIndices[0] = outputIndices[").concat(o.length-1,"];");for(let t=1;t<h.rank;t++)e+="cIndices[".concat(t,"] = outputIndices[").concat(t,"];");e+="let cOffset = ".concat(h.indicesToOffset("cIndices"),";")}return e})(),"\n    let scale = ").concat(h.getByOffset("cOffset"),";\n    let bias = ").concat(f.getByOffset("cOffset"),";\n    let inputMean = ").concat(p.getByOffset("cOffset"),";\n    let inputVar = ").concat(m.getByOffset("cOffset"),";\n    let x = ").concat(d.getByOffset("global_idx"),";\n    let value = (x - inputMean) * inverseSqrt(inputVar + epsilon) * scale + bias;\n    ").concat(g.setByOffset("global_idx","value"),"\n  }"),getRunData:()=>({outputs:[{dims:e[0].dims,dataType:e[0].dataType}],dispatchGroup:{x:Math.ceil(c/64)},programUniforms:l?[{type:12,data:c},...mn(o)]:[{type:12,data:c}]})}},Hi=e=>un(e),Wi=(e,t)=>{let{inputs:n,outputCount:i}=e,r=Hi(s(s({},t),{},{outputCount:i}));if(I.webgpu.validateInputContent&&Vi(n,r),t.trainingMode)throw new Error("BatchNormalization trainingMode is not supported yet.");e.compute(qi(n,r))}}),jl=re(()=>{Cl(),Ll(),Gi=e=>{if(3!==e[0].dims.length)throw new Error("input should have 3 dimensions");if(![320,640,1280].includes(e[0].dims[2]))throw new Error("number of channels should be 320, 640 or 1280");if(1!==e[1].dims.length)throw new Error("bias is expected to have 1 dimensions");if(e[0].dims[2]!==e[1].dims[0])throw new Error("last dimension of input and bias are not the same")},Ki=e=>{let t=e[0].dims,n=e[0].dims[2],i=Rt.size(t)/4,r=e[0].dataType,o=xn("input",r,t,4),a=xn("bias",r,[n],4),s=xn("residual",r,t,4),c=Sn("output",r,t,4);return{name:"BiasAdd",getRunData:()=>({outputs:[{dims:t,dataType:e[0].dataType}],dispatchGroup:{x:Math.ceil(i/64)}}),getShaderSource:e=>"\n  const channels = ".concat(n,"u / 4;\n  ").concat(e.declareVariables(o,a,s,c),"\n\n  ").concat(e.mainStart(),"\n    ").concat(e.guardAgainstOutOfBoundsWorkgroupSizes(i),"\n    let value = ").concat(o.getByOffset("global_idx"),"\n      + ").concat(a.getByOffset("global_idx % channels")," + ").concat(s.getByOffset("global_idx"),";\n    ").concat(c.setByOffset("global_idx","value"),"\n  }")}},Zi=e=>{Gi(e.inputs),e.compute(Ki(e.inputs))}}),Vl=re(()=>{El(),Cl(),Rl(),Ll(),Qi=(e,t,n,i,r,o,a)=>{let s=Math.ceil(t/4),c="";c="string"==typeof r?"".concat(r,"(a)"):r("a");let l=xn("inputData",n,[s],4),u=Sn("outputData",i,[s],4),d=[{name:"vec_size",type:"u32"}];return a&&d.push(...a),"\n      ".concat(e.registerUniforms(d).declareVariables(l,u),"\n\n  ").concat(null!==o&&void 0!==o?o:"","\n\n  ").concat(e.mainStart(),"\n    ").concat(e.guardAgainstOutOfBoundsWorkgroupSizes("uniforms.vec_size"),"\n\n    let a = ").concat(l.getByOffset("global_idx"),";\n    ").concat(u.setByOffset("global_idx",c),"\n  }")},Xi=function(e,t,n,i,r){let o=arguments.length>5&&void 0!==arguments[5]?arguments[5]:e.dataType,a=arguments.length>6?arguments[6]:void 0,s=arguments.length>7?arguments[7]:void 0,c=[{type:12,data:Math.ceil(Rt.size(e.dims)/4)}];return a&&c.push(...a),{name:t,shaderCache:{hint:r,inputDependencies:["type"]},getShaderSource:t=>Qi(t,Rt.size(e.dims),e.dataType,o,n,i,s),getRunData:t=>({outputs:[{dims:e.dims,dataType:o}],dispatchGroup:{x:Math.ceil(Rt.size(t[0].dims)/64/4)},programUniforms:c})}},Yi=e=>{e.compute(Xi(e.inputs[0],"Abs","abs"))},Ji=e=>{e.compute(Xi(e.inputs[0],"Acos","acos"))},$i=e=>{e.compute(Xi(e.inputs[0],"Acosh","acosh"))},er=e=>{e.compute(Xi(e.inputs[0],"Asin","asin"))},tr=e=>{e.compute(Xi(e.inputs[0],"Asinh","asinh"))},nr=e=>{e.compute(Xi(e.inputs[0],"Atan","atan"))},ir=e=>{e.compute(Xi(e.inputs[0],"Atanh","atanh"))},rr=e=>un(e),or=(e,t)=>{let n;switch(t.to){case 10:n="vec4<f16>";break;case 1:n="vec4<f32>";break;case 12:n="vec4<u32>";break;case 6:n="vec4<i32>";break;case 9:n="vec4<bool>";break;default:throw new RangeError("not supported type (specified in attribute 'to' from 'Cast' operator): ".concat(t.to))}e.compute(Xi(e.inputs[0],"Cast",n,void 0,t.cacheKey,t.to))},ar=e=>{let t,n,i=e.length>=2&&0!==e[1].data,r=e.length>=3&&0!==e[2].data;switch(e[0].dataType){case 1:t=i?e[1].getFloat32Array()[0]:-34028234663852886e22,n=r?e[2].getFloat32Array()[0]:34028234663852886e22;break;case 10:t=i?e[1].getUint16Array()[0]:64511,n=r?e[2].getUint16Array()[0]:31743;break;default:throw new Error("Unsupport data type")}return un({min:t,max:n})},sr=(e,t)=>{let n=t||ar(e.inputs),i=pn(e.inputs[0].dataType);e.compute(Xi(e.inputs[0],"Clip",e=>"clamp(".concat(e,", vec4<").concat(i,">(uniforms.min), vec4<").concat(i,">(uniforms.max))"),void 0,n.cacheKey,void 0,[{type:e.inputs[0].dataType,data:n.min},{type:e.inputs[0].dataType,data:n.max}],[{name:"min",type:i},{name:"max",type:i}]),{inputs:[0]})},cr=e=>{e.compute(Xi(e.inputs[0],"Ceil","ceil"))},lr=e=>{e.compute(Xi(e.inputs[0],"Cos","cos"))},ur=e=>{e.compute(Xi(e.inputs[0],"Cosh","cosh"))},dr=e=>un(e),hr=(e,t)=>{let n=pn(e.inputs[0].dataType);e.compute(Xi(e.inputs[0],"Elu",e=>"elu_vf32(".concat(e,")"),"\n  const elu_alpha_ = ".concat(n,"(").concat(t.alpha,");\n\n  fn elu_f32(a: ").concat(n,") -> ").concat(n," {\n  return select((exp(a) - 1.0) * elu_alpha_, a, a >= 0.0);\n  }\n\n  fn elu_vf32(v: vec4<").concat(n,">) -> vec4<").concat(n,"> {\n  return vec4(elu_f32(v.x), elu_f32(v.y), elu_f32(v.z), elu_f32(v.w));\n  }"),t.cacheKey))},fr=function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"f32";return"\nconst r0: ".concat(e," = 0.3275911;\nconst r1: ").concat(e," = 0.254829592;\nconst r2: ").concat(e," = -0.284496736;\nconst r3: ").concat(e," = 1.421413741;\nconst r4: ").concat(e," = -1.453152027;\nconst r5: ").concat(e," = 1.061405429;\n\nfn erf_vf32(v: vec4<").concat(e,">) -> vec4<").concat(e,"> {\n  let absv = abs(v);\n  let x = 1.0 / (1.0 + r0 * absv);\n  return sign(v) * (1.0 - ((((r5 * x + r4) * x + r3) * x + r2) * x + r1) * x * exp(-absv * absv));\n}")},pr=e=>{let t=pn(e.inputs[0].dataType);e.compute(Xi(e.inputs[0],"Erf",e=>"erf_vf32(".concat(e,")"),fr(t)))},mr=e=>{e.compute(Xi(e.inputs[0],"Exp","exp"))},gr=e=>{e.compute(Xi(e.inputs[0],"Floor","floor"))},yr=e=>{let t=pn(e.inputs[0].dataType);e.compute(Xi(e.inputs[0],"Gelu",e=>"0.5 * ".concat(e," * (1.0 + erf_vf32(").concat(e," * 0.7071067811865475))"),fr(t)))},vr=(e,t)=>{let n=pn(e.inputs[0].dataType);e.compute(Xi(e.inputs[0],"LeakyRelu",e=>"select(leaky_relu_alpha_ * ".concat(e,", ").concat(e,", ").concat(e," >= vec4<").concat(n,">(0.0))"),"const leaky_relu_alpha_ = ".concat(n,"(").concat(t.alpha,");"),t.cacheKey))},_r=e=>{e.compute(Xi(e.inputs[0],"Not",e=>"!".concat(e)))},wr=e=>{e.compute(Xi(e.inputs[0],"Neg",e=>"-".concat(e)))},br=e=>{e.compute(Xi(e.inputs[0],"Reciprocal",e=>"1.0/".concat(e)))},xr=e=>{let t=pn(e.inputs[0].dataType);e.compute(Xi(e.inputs[0],"Relu",e=>"select(vec4<".concat(t,">(0.0), ").concat(e,", ").concat(e," > vec4<").concat(t,">(0.0))")))},Sr=e=>{e.compute(Xi(e.inputs[0],"Sigmoid",e=>"(1.0 / (1.0 + exp(-".concat(e,")))")))},Er=e=>un(e),Tr=(e,t)=>{let n=pn(e.inputs[0].dataType);e.compute(Xi(e.inputs[0],"HardSigmoid",e=>"max(vec4<".concat(n,">(0.0), min(vec4<").concat(n,">(1.0), ").concat(t.alpha," * ").concat(e," + vec4<").concat(n,">(").concat(t.beta,")))"),void 0,t.cacheKey))},kr=e=>{e.compute(Xi(e.inputs[0],"Sin","sin"))},Cr=e=>{e.compute(Xi(e.inputs[0],"Sinh","sinh"))},Ir=e=>{e.compute(Xi(e.inputs[0],"Sqrt","sqrt"))},Ar=e=>{e.compute(Xi(e.inputs[0],"Tan","tan"))},Nr=e=>"sign(".concat(e,") * (1 - exp(-2 * abs(").concat(e,"))) / (1 + exp(-2 * abs(").concat(e,")))"),Or=e=>{e.compute(Xi(e.inputs[0],"Tanh",Nr))},Pr=function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"f32";return"\nconst fast_gelu_a: ".concat(e," = 0.5;\nconst fast_gelu_b: ").concat(e," = 0.7978845608028654;\nconst fast_gelu_c: ").concat(e," = 0.035677408136300125;\n\nfn tanh_v(v: vec4<").concat(e,">) -> vec4<").concat(e,"> {\n  return ").concat(Nr("v"),";\n}\n")},Rr=e=>"(fast_gelu_a + fast_gelu_a * tanh_v(".concat(e," * (fast_gelu_c * ").concat(e," * ").concat(e," + fast_gelu_b))) * ").concat(e),Lr=e=>{let t=pn(e.inputs[0].dataType);e.compute(Xi(e.inputs[0],"FastGelu",Rr,Pr(t),void 0,e.inputs[0].dataType))},zr=(e,t)=>{let n=pn(e.inputs[0].dataType);return e.compute(Xi(e.inputs[0],"ThresholdedRelu",e=>"select(vec4<".concat(n,">(0.0), ").concat(e,", ").concat(e," > thresholded_relu_alpha_)"),"const thresholded_relu_alpha_ = vec4<".concat(n,">(").concat(t.alpha,");"),t.cacheKey)),0},Mr=e=>{e.compute(Xi(e.inputs[0],"Log","log"))},Dr=(e,t)=>"\nconst alpha = vec4<".concat(e,">(").concat(t,");\nconst one = ").concat(e,"(1.0);\nconst zero = ").concat(e,"(0.0);\n\nfn quick_gelu_impl(x: vec4<").concat(e,">) -> vec4<").concat(e,"> {\n  let v = x *alpha;\n  var x1 : vec4<").concat(e,">;\n  for (var i = 0; i < 4; i = i + 1) {\n    if (v[i] >= zero) {\n      x1[i] = one / (one + exp(-v[i]));\n    } else {\n      x1[i] = one - one / (one + exp(v[i]));\n    }\n  }\n  return x * x1;\n}\n"),Br=e=>"quick_gelu_impl(".concat(e,")"),Ur=(e,t)=>{let n=pn(e.inputs[0].dataType);e.compute(Xi(e.inputs[0],"QuickGelu",Br,Dr(n,t.alpha),t.cacheKey,e.inputs[0].dataType))}}),ql=re(()=>{Cl(),Ll(),Vl(),Fr=e=>{if(3!==e[0].dims.length)throw new Error("input should have 3 dimensions");if(![2560,5120,10240].includes(e[0].dims[2]))throw new Error("hidden state should be 2560, 5120 or 10240");if(1!==e[1].dims.length)throw new Error("bias is expected to have 1 dimensions");if(e[0].dims[2]!==e[1].dims[0])throw new Error("last dimension of input and bias are not the same")},jr=e=>{let t=e[0].dims.slice();t[2]=t[2]/2;let n=xn("input",e[0].dataType,e[0].dims,4),i=xn("bias",e[0].dataType,[e[0].dims[2]],4),r=Sn("output",e[0].dataType,t,4),o=Rt.size(t)/4,a=fn(e[0].dataType);return{name:"BiasSplitGelu",getRunData:()=>({outputs:[{dims:t,dataType:e[0].dataType}],dispatchGroup:{x:Math.ceil(o/64)}}),getShaderSource:t=>"\n  const M_SQRT2 = sqrt(2.0);\n  const halfChannels = ".concat(e[0].dims[2]/4/2,"u;\n\n  ").concat(t.declareVariables(n,i,r),"\n\n  ").concat(fr(a),"\n\n  ").concat(t.mainStart(),"\n    ").concat(t.guardAgainstOutOfBoundsWorkgroupSizes(o),"\n    let biasIdx = global_idx % halfChannels;\n    let batchIndex = global_idx / halfChannels;\n    let inputOffset = biasIdx + batchIndex * halfChannels * 2;\n    let valueLeft = input[inputOffset] + bias[biasIdx];\n    let valueRight = input[inputOffset + halfChannels] + bias[biasIdx + halfChannels];\n    let geluRight = valueRight * 0.5 * (erf_vf32(valueRight / M_SQRT2) + 1);\n\n    ").concat(r.setByOffset("global_idx","valueLeft * geluRight"),"\n  }")}},Vr=e=>{Fr(e.inputs),e.compute(jr(e.inputs))}}),Hl=re(()=>{El(),Cl(),Ll(),qr=(e,t,n,i,r,o,a,s,c,l,u,d)=>{let h,f;"string"==typeof s?h=f=(e,t)=>"".concat(s,"((").concat(e,"),(").concat(t,"))"):"function"==typeof s?h=f=s:(h=s.scalar,f=s.vector);let p,m=Sn("outputData",u,i.length,4),g=xn("aData",c,t.length,4),y=xn("bData",l,n.length,4);if(r)if(o){let e=1===Rt.size(t),i=1===Rt.size(n),r=t.length>0&&t[t.length-1]%4===0,o=n.length>0&&n[n.length-1]%4===0;p=e||i?m.setByOffset("global_idx",f(e?"".concat(g.type.value,"(").concat(g.getByOffset("0"),".x)"):g.getByOffset("global_idx"),i?"".concat(y.type.value,"(").concat(y.getByOffset("0"),".x)"):y.getByOffset("global_idx"))):"\n            let outputIndices = ".concat(m.offsetToIndices("global_idx * 4u"),";\n            let offsetA = ").concat(g.broadcastedIndicesToOffset("outputIndices",m),";\n            let offsetB = ").concat(y.broadcastedIndicesToOffset("outputIndices",m),";\n            ").concat(m.setByOffset("global_idx",f(a||r?g.getByOffset("offsetA / 4u"):"".concat(g.type.value,"(").concat(g.getByOffset("offsetA / 4u"),"[offsetA % 4u])"),a||o?y.getByOffset("offsetB / 4u"):"".concat(y.type.value,"(").concat(y.getByOffset("offsetB / 4u"),"[offsetB % 4u])"))),"\n          ")}else p=m.setByOffset("global_idx",f(g.getByOffset("global_idx"),y.getByOffset("global_idx")));else{if(!o)throw new Error("no necessary to use scalar implementation for element-wise binary op implementation.");let e=function(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"",i="aData[indexA".concat(t,"][componentA").concat(t,"]"),r="bData[indexB".concat(t,"][componentB").concat(t,"]");return"\n            let outputIndices".concat(t," = ").concat(m.offsetToIndices("global_idx * 4u + ".concat(t,"u")),";\n            let offsetA").concat(t," = ").concat(g.broadcastedIndicesToOffset("outputIndices".concat(t),m),";\n            let offsetB").concat(t," = ").concat(y.broadcastedIndicesToOffset("outputIndices".concat(t),m),";\n            let indexA").concat(t," = offsetA").concat(t," / 4u;\n            let indexB").concat(t," = offsetB").concat(t," / 4u;\n            let componentA").concat(t," = offsetA").concat(t," % 4u;\n            let componentB").concat(t," = offsetB").concat(t," % 4u;\n            ").concat(e,"[").concat(t,"] = ").concat(n,"(").concat(h(i,r),");\n          ")};p=9===u?"\n            var data = vec4<u32>(0);\n            ".concat(e("data",0,"u32"),"\n            ").concat(e("data",1,"u32"),"\n            ").concat(e("data",2,"u32"),"\n            ").concat(e("data",3,"u32"),"\n            outputData[global_idx] = dot(vec4<u32>(0x1, 0x100, 0x10000, 0x1000000), vec4<u32>(data));"):"\n            ".concat(e("outputData[global_idx]",0),"\n            ").concat(e("outputData[global_idx]",1),"\n            ").concat(e("outputData[global_idx]",2),"\n            ").concat(e("outputData[global_idx]",3),"\n          ")}return"\n        ".concat(e.registerUniform("vec_size","u32").declareVariables(g,y,m),"\n\n        ").concat(null!==d&&void 0!==d?d:"","\n\n        ").concat(e.mainStart(),"\n        ").concat(e.guardAgainstOutOfBoundsWorkgroupSizes("uniforms.vec_size"),"\n        ").concat(p,"\n      }")},Hr=function(e,t,n,i,r,o){let a=arguments.length>6&&void 0!==arguments[6]?arguments[6]:n.dataType,s=n.dims.map(e=>{var t;return null!==(t=Number(e))&&void 0!==t?t:1}),c=i.dims.map(e=>{var t;return null!==(t=Number(e))&&void 0!==t?t:1}),l=!Rt.areEqual(s,c),u=s,d=Rt.size(s),h=!1,f=!1,p=[l];if(l){let e=Pt.calcShape(s,c,!1);if(!e)throw new Error("Can't perform binary op on the given tensors");u=e.slice(),d=Rt.size(u);let t=1===Rt.size(s),n=1===Rt.size(c),i=s.length>0&&s[s.length-1]%4===0,r=c.length>0&&c[c.length-1]%4===0;p.push(t),p.push(n),p.push(i),p.push(r);let o=1;for(let a=1;a<u.length;a++){let e=s[s.length-a];if(e!==c[c.length-a])break;o*=e}o%4===0?(f=!0,h=!0):(t||n||i||r)&&(h=!0)}else h=!0;return p.push(h),{name:e,shaderCache:{hint:t+p.map(e=>e.toString()).join("_"),inputDependencies:["rank","rank"]},getShaderSource:e=>qr(e,s,c,u,h,l,f,r,n.dataType,i.dataType,a,o),getRunData:()=>({outputs:[{dims:u,dataType:a}],dispatchGroup:{x:Math.ceil(d/64/4)},programUniforms:[{type:12,data:Math.ceil(Rt.size(u)/4)},...mn(s,c,u)]})}},Wr=(e,t,n,i,r,o)=>{e.compute(Hr(t,null!==r&&void 0!==r?r:"",e.inputs[0],e.inputs[1],n,i,o))},Gr=e=>{Wr(e,"Add",(e,t)=>"".concat(e,"+").concat(t))},Kr=e=>{Wr(e,"Div",(e,t)=>"".concat(e,"/").concat(t))},Zr=e=>{Wr(e,"Equal",{scalar:(e,t)=>"u32(".concat(e,"==").concat(t,")"),vector:(e,t)=>"vec4<u32>(".concat(e,"==").concat(t,")")},void 0,void 0,9)},Qr=e=>{Wr(e,"Mul",(e,t)=>"".concat(e,"*").concat(t))},Xr=e=>{let t=xn("input",e.inputs[0].dataType,e.inputs[0].dims).type.value;Wr(e,"Pow",{scalar:(e,t)=>"pow_custom(".concat(e,",").concat(t,")"),vector:(e,t)=>"pow_vector_custom(".concat(e,",").concat(t,")")},"\n    fn pow_custom(a : ".concat(t,", b : ").concat(t,") -> ").concat(t," {\n      if (b == ").concat(t,"(0.0)) {\n        return ").concat(t,"(1.0);\n      } else if (a < ").concat(t,"(0.0) && f32(b) != floor(f32(b))) {\n        return ").concat(t,"(pow(f32(a), f32(b))); // NaN\n      }\n      return select(sign(a), ").concat(t,"(1.0), round(f32(abs(b) % ").concat(t,"(2.0))) != 1.0) * ").concat(t,"(").concat("i32"===t?"round":"","(pow(f32(abs(a)), f32(b))));\n    }\n    fn pow_vector_custom(a : vec4<").concat(t,">, b : vec4<").concat(t,">) -> vec4<").concat(t,"> {\n      // TODO: implement vectorized pow\n      return vec4<").concat(t,">(pow_custom(a.x, b.x), pow_custom(a.y, b.y), pow_custom(a.z, b.z), pow_custom(a.w, b.w));\n    }\n      "))},Yr=e=>{Wr(e,"Sub",(e,t)=>"".concat(e,"-").concat(t))},Jr=e=>{Wr(e,"Greater",{scalar:(e,t)=>"u32(".concat(e,">").concat(t,")"),vector:(e,t)=>"vec4<u32>(".concat(e,">").concat(t,")")},void 0,void 0,9)},$r=e=>{Wr(e,"Less",{scalar:(e,t)=>"u32(".concat(e,"<").concat(t,")"),vector:(e,t)=>"vec4<u32>(".concat(e,"<").concat(t,")")},void 0,void 0,9)},eo=e=>{Wr(e,"GreaterOrEqual",{scalar:(e,t)=>"u32(".concat(e,">=").concat(t,")"),vector:(e,t)=>"vec4<u32>(".concat(e,">=").concat(t,")")},void 0,void 0,9)},to=e=>{Wr(e,"LessOrEqual",{scalar:(e,t)=>"u32(".concat(e,"<=").concat(t,")"),vector:(e,t)=>"vec4<u32>(".concat(e,"<=").concat(t,")")},void 0,void 0,9)}}),Wl=re(()=>{El(),Cl(),Rl(),Ll(),no=(e,t)=>{if(!e||e.length<1)throw new Error("too few inputs");let n=e[0],i=n.dataType,r=n.dims.length;e.forEach((e,o)=>{if(0!==o){if(e.dataType!==i)throw new Error("input tensors should be one type");if(e.dims.length!==r)throw new Error("input tensors should have the same shape");e.dims.forEach((e,i)=>{if(i!==t&&e!==n.dims[i])throw new Error("non concat dimensions must match")})}})},io=(e,t)=>"\n  fn calculateInputIndex(index: u32) -> u32 {\n    let sizeInConcatAxis = array<u32, ".concat(e,"u>(").concat(t,");\n    for (var i: u32 = 0u; i < ").concat(e,"; i += 1u ) {\n      if (index < sizeInConcatAxis[i]) {\n        return i;\n      }\n    }\n    return ").concat(e,"u;\n  }"),ro=(e,t)=>{let n=e.length,i=[];for(let r=0;r<n;++r){let o=t.setByOffset("global_idx",e[r].getByIndices("indices"));1===n?i.push(o):0===r?i.push("if (inputIndex == ".concat(r,"u) { ").concat(o," }")):r===n-1?i.push("else { ".concat(o," }")):i.push("else if (inputIndex == ".concat(r,") { ").concat(o," }"))}return i.join("\n")},oo=(e,t,n,i)=>{let r=Rt.size(n),o=new Array(e.length),a=new Array(e.length),s=0,c=[],l=[],u=[{type:12,data:r}];for(let p=0;p<e.length;++p)s+=e[p].dims[t],o[p]=s,l.push(e[p].dims.length),a[p]=xn("input".concat(p),i,l[p]),c.push("rank"),u.push({type:12,data:o[p]});for(let p=0;p<e.length;++p)u.push(...mn(e[p].dims));u.push(...mn(n));let d=Sn("output",i,n.length),h=d.indicesGet("indices",t),f=Array.from(Array(o.length).keys()).map(e=>"uniforms.sizeInConcatAxis".concat(e)).join(",");return{name:"Concat",shaderCache:{hint:"".concat(t),inputDependencies:c},getRunData:()=>({outputs:[{dims:n,dataType:i}],dispatchGroup:{x:Math.ceil(r/64)},programUniforms:u}),getShaderSource:t=>"\n\n  ".concat((()=>{t.registerUniform("outputSize","u32");for(let n=0;n<e.length;n++)t.registerUniform("sizeInConcatAxis".concat(n),"u32");return t.declareVariables(...a,d)})(),"\n\n  ").concat(io(o.length,f),"\n\n  ").concat(t.mainStart(),"\n    ").concat(t.guardAgainstOutOfBoundsWorkgroupSizes("uniforms.outputSize"),"\n\n    var indices = ").concat(d.offsetToIndices("global_idx"),";\n\n    let inputIndex = calculateInputIndex(").concat(h,");\n    if (inputIndex != 0u) {\n      let sizeInConcatAxis = array<u32, ").concat(o.length,"u>(").concat(f,");\n      ").concat(h," -= sizeInConcatAxis[inputIndex - 1u];\n    }\n\n    ").concat(ro(a,d),"\n  }")}},ao=(e,t)=>{let n=e.inputs,i=n[0].dims,r=Rt.normalizeAxis(t.axis,i.length);no(n,r);let o=i.slice();o[r]=n.reduce((e,t)=>e+(t.dims.length>r?t.dims[r]:0),0);let a=n.filter(e=>Rt.size(e.dims)>0);e.compute(oo(a,r,o,n[0].dataType),{inputs:a})},so=e=>un({axis:e.axis})}),Gl=re(()=>{El(),Cl(),co=function(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"f32";switch(e.activation){case"Relu":return"value = max(value, ".concat(t,"(0.0));");case"Sigmoid":return"value = (".concat(t,"(1.0) / (").concat(t,"(1.0) + exp(-value)));");case"Clip":return"value = clamp(value, ".concat(t,"(").concat(n,"(uniforms.clip_min)), ").concat(t,"(").concat(n,"(uniforms.clip_max)));");case"HardSigmoid":return"value = max(".concat(t,"(0.0), min(").concat(t,"(1.0), ").concat(n,"(uniforms.alpha) * value + ").concat(n,"(uniforms.beta)));");case"LeakyRelu":return"value = select(".concat(n,"(uniforms.alpha) * value, value, value >= ").concat(t,"(0.0));");case"Tanh":return"let e2x = exp(-2.0 * abs(value));\n              value = sign(value) * (1.0 - e2x) / (1.0 + e2x);\n        ";case"":return"";default:throw new Error("Unsupported activation ".concat(e.activation))}},lo=(e,t)=>{"Clip"===e.activation?t.push({type:1,data:e.clipMax},{type:1,data:e.clipMin}):"HardSigmoid"===e.activation?t.push({type:1,data:e.alpha},{type:1,data:e.beta}):"LeakyRelu"===e.activation&&t.push({type:1,data:e.alpha})},uo=(e,t)=>{"Clip"===e.activation?t.push({name:"clip_max",type:"f32"},{name:"clip_min",type:"f32"}):"HardSigmoid"===e.activation?t.push({name:"alpha",type:"f32"},{name:"beta",type:"f32"}):"LeakyRelu"===e.activation&&t.push({name:"alpha",type:"f32"})},ho=e=>{let t=(null===e||void 0===e?void 0:e.activation)||"";if("HardSigmoid"===t){let[n,i]=(null===e||void 0===e?void 0:e.activation_params)||[.2,.5];return{activation:t,alpha:n,beta:i}}if("Clip"===t){let[n,i]=(null===e||void 0===e?void 0:e.activation_params)||[Mt,Dt];return{activation:t,clipMax:i,clipMin:n}}if("LeakyRelu"===t){let[n]=(null===e||void 0===e?void 0:e.activation_params)||[.01];return{activation:t,alpha:n}}return{activation:t}}}),Kl=re(()=>{fo=(e,t)=>{switch(e){case 1:return t;case 2:return"vec2<".concat(t,">");case 3:return"vec3<".concat(t,">");case 4:return"vec4<".concat(t,">");default:throw new Error("".concat(e,"-component is not supported."))}},po=e=>"\n      ".concat(e?"value = value + getBiasByOutputCoords(coords);":"","\n      ")}),Zl=re(()=>{mo=e=>"\nfn getIndexFromCoords4D(coords : vec4<i32>, shape : vec4<i32>) -> i32 {\n  return dot(coords, vec4<i32>(\n      shape.y * shape.z * shape.w, shape.z * shape.w, shape.w, 1));\n}\nfn getOutputIndexFromCoords(coords : vec4<i32>) -> i32 {\n  return dot(coords, vec4<i32>(\n    i32(".concat(e,".x), i32(").concat(e,".y), i32(").concat(e,".z), 1));\n}\n")}),Ql=re(()=>{El(),Cl(),Ll(),Gl(),go=(e,t,n,i,r)=>{let o=i-n;return"\n      ".concat(Array.from({length:n}).map((n,a)=>"\n      if (".concat(wn(t.shape,a,t.rank)," != 1) {\n        ").concat(t.indicesSet(e,a,wn(r,a+o,i)),"\n      } else {\n        ").concat(t.indicesSet(e,a,0),"\n      }")).join(""),"\n")},yo=function(e,t,n,i){let r=arguments.length>4&&void 0!==arguments[4]&&arguments[4],o=arguments.length>5?arguments[5]:void 0,a=e[0].dims,s=e[1].dims,c=a[a.length-2],l=s[s.length-1],u=a[a.length-1],d=gn(l),h=gn(u),f=gn(c),p=Rt.size(n)/d/f,m=e.length>2,g=i?i.slice(0,-2):n.slice(0,-2),y=[Rt.size(g),c,l],v=[{type:12,data:p},{type:12,data:c},{type:12,data:l},{type:12,data:u}];lo(t,v),v.push(...mn(g,a,s)),m&&v.push(...mn(e[2].dims)),v.push(...mn(y));return{name:"MatMulNaive",shaderCache:{hint:"".concat(t.activation,";").concat(d,";").concat(h,";").concat(f,";").concat(r),inputDependencies:m?["rank","rank","rank"]:["rank","rank"]},getRunData:()=>({outputs:[{dims:o?o(n):n,dataType:e[0].dataType}],dispatchGroup:{x:Math.ceil(p/64)},programUniforms:v}),getShaderSource:i=>{let o=Tn("batch_dims",e[0].dataType,g.length),c=xn("a",e[0].dataType,a.length,h),l=xn("b",e[1].dataType,s.length,d),u=Sn("output",e[0].dataType,y.length,d),p=fn(u.type.tensor),v=co(t,u.type.value,p),_=[c,l],w="";if(m){let t=r?d:1;_.push(xn("bias",e[2].dataType,e[2].dims.length,t)),w="".concat(r?"value += bias[col / ".concat(t,"];"):"value += ".concat(u.type.value,"(bias[row + i]);"))}let b=[{name:"output_size",type:"u32"},{name:"M",type:"u32"},{name:"N",type:"u32"},{name:"K",type:"u32"}];uo(t,b);return"\n  ".concat(i.registerUniforms(b).registerInternalVariables(o).declareVariables(..._,u),"\n  ").concat(i.mainStart(),"\n    ").concat(i.guardAgainstOutOfBoundsWorkgroupSizes("uniforms.output_size"),"\n    let col = (global_idx % (uniforms.N / ").concat(d,")) * ").concat(d,";\n    var index1 = global_idx / (uniforms.N / ").concat(d,");\n    let stride1 = uniforms.M / ").concat(f,";\n    let row = (index1 % stride1) * ").concat(f,";\n    let batch = index1 / stride1;\n\n    ").concat(2===n.length?"":"let batch_indices = ".concat(o.offsetToIndices("batch"),";"),"\n\n    var a_indices: ").concat(c.type.indices,";\n    ").concat(go("a_indices",c,c.rank-2,o.rank,"batch_indices"),"\n    ").concat(c.indicesSet("a_indices",c.rank-2,0),"\n    ").concat(c.indicesSet("a_indices",c.rank-1,0),"\n    let a_offset = ").concat(c.indicesToOffset("a_indices"),";\n\n    var b_indices: ").concat(l.type.indices,";\n    ").concat(go("b_indices",l,l.rank-2,o.rank,"batch_indices"),"\n    ").concat(l.indicesSet("b_indices",l.rank-2,0),"\n    ").concat(l.indicesSet("b_indices",l.rank-1,0),"\n    let b_offset = ").concat(l.indicesToOffset("b_indices"),";\n    var values: array<").concat(u.type.value,", ").concat(f,">;\n    for (var k: u32 = 0u; k < uniforms.K; k = k + ").concat(h,") {\n      ").concat((()=>{let e="var a_data: ".concat(c.type.value,";");for(let t=0;t<h;t++)e+="\n              let b_data".concat(t," = b[(b_offset + (k + ").concat(t,") * uniforms.N + col) / ").concat(d,"];");for(let t=0;t<f;t++){e+="a_data = a[(a_offset + (row + ".concat(t,") * uniforms.K + k) / ").concat(h,"];");for(let n=0;n<h;n++)e+="\n            values[".concat(t,"] = fma(").concat(l.type.value,"(a_data").concat(1===h?"":"[".concat(n,"]"),"), b_data").concat(n,", values[").concat(t,"]);\n")}return e})(),"\n    }\n    for (var i = 0u; i < ").concat(f,"u; i++) {\n      var value = values[i];\n      ").concat(w,"\n      ").concat(v,"\n      let cur_indices = ").concat(u.type.indices,"(batch, row + i, col);\n      let offset = ").concat(u.indicesToOffset("cur_indices"),";\n      ").concat(u.setByOffset("offset / ".concat(d),"value"),";\n    }\n  }\n  ")}}}}),Xl=re(()=>{El(),Cl(),Ll(),Gl(),Ql(),Kl(),vo=(e,t)=>e?"\n        mm_Asub[inputRow][inputCol] = mm_readA(batch,\n          kStart + inputRow,\n          globalRowStart / innerElementSize + inputCol".concat(t?", batchIndices":"",");\n        "):"\n        mm_Asub[inputRow][inputCol] = mm_readA(batch,\n          globalRow + innerRow,\n          kStart / innerElementSize + inputCol".concat(t?", batchIndices":"",");\n        "),_o=(e,t)=>e?"\n        let ACached0 = mm_Asub[k * innerElementSize][localRow];\n        let ACached1 = mm_Asub[k * innerElementSize + 1][localRow];\n        let ACached2 = mm_Asub[k * innerElementSize + 2][localRow];\n        ".concat(3===t?"":"let ACached3 = mm_Asub[k * innerElementSize + 3][localRow];","\n        for (var i = 0; i < rowPerThread; i = i + 1) {\n          acc[i] = BCached0 * ACached0[i] + acc[i];\n          acc[i] = BCached1 * ACached1[i] + acc[i];\n          acc[i] = BCached2 * ACached2[i] + acc[i];\n          ").concat(3===t?"":"acc[i] = BCached3 * ACached3[i] + acc[i];","\n        }"):"\n        for (var i = 0; i < rowPerThread; i = i + 1) {\n          let ACached = mm_Asub[tileRow + i][k];\n          acc[i] = BCached0 * ACached.x + acc[i];\n          acc[i] = BCached1 * ACached.y + acc[i];\n          acc[i] = BCached2 * ACached.z + acc[i];\n          ".concat(3===t?"":"acc[i] = BCached3 * ACached.w + acc[i];","\n        }"),wo=function(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"f32",i=arguments.length>3?arguments[3]:void 0,r=arguments.length>4&&void 0!==arguments[4]&&arguments[4],o=arguments.length>5&&void 0!==arguments[5]?arguments[5]:32,a=arguments.length>6&&void 0!==arguments[6]&&arguments[6],s=arguments.length>7&&void 0!==arguments[7]?arguments[7]:32,c=t[1]*e[1],l=t[0]*e[0],u=r?c:o,d=r?o:c,h=u/t[0],f=o/t[1];if((!r||4!==h||4!==e[1])&&(r||3!==h&&4!==h)||u%t[0]!==0||o%t[1]!==0||4!==e[0])throw new Error("If transposeA ".concat(r," is true, innerElementSize ").concat(h," and workPerThread[1] ").concat(e[1]," must be 4.\n      Otherwise, innerElementSize ").concat(h," must be 3 or 4.\n  tileAWidth ").concat(u," must be divisible by workgroupSize[0]").concat(t[0],". tileInner ").concat(o," must be divisible by workgroupSize[1] ").concat(t[1],". colPerThread ").concat(e[0]," must be 4."));return"\nvar<workgroup> mm_Asub: array<array<vec".concat(h,"<").concat(n,">, ").concat(u/h,">, ").concat(d,">;\nvar<workgroup> mm_Bsub: array<array<vec4<").concat(n,">, ").concat(l/e[0],">, ").concat(o,">;\n\nconst rowPerThread = ").concat(e[1],";\nconst colPerThread = ").concat(e[0],";\nconst innerElementSize = ").concat(h,";\nconst tileInner = ").concat(o,";\n\n@compute @workgroup_size(").concat(t[0],", ").concat(t[1],", ").concat(t[2],")\nfn main(@builtin(local_invocation_id) localId : vec3<u32>,\n        @builtin(global_invocation_id) globalId : vec3<u32>,\n        @builtin(workgroup_id) workgroupId : vec3<u32>) {\n  let localRow = i32(localId.y);\n  let tileRow = localRow * rowPerThread;\n  let tileCol = i32(localId.x);\n\n  let globalRow =i32(globalId.y) * rowPerThread;\n  let globalCol = i32(globalId.x);\n  let batch = ").concat(a?"0":"i32(globalId.z)",";\n  ").concat(i?"let batchIndices = ".concat(i.offsetToIndices("u32(batch)"),";"):"","\n  let globalRowStart = i32(workgroupId.y) * ").concat(c,";\n\n  let num_tiles = ").concat(a?"".concat(Math.ceil(s/o)):"(uniforms.dim_inner - 1) / tileInner + 1",";\n  var kStart = ").concat(a?"i32(globalId.z) * ".concat(s):"0",";\n\n  var acc: array<vec4<").concat(n,">, rowPerThread>;\n\n  // Loop over shared dimension.\n  let tileRowB = localRow * ").concat(f,";\n  for (var t = 0; t < num_tiles; t = t + 1) {\n      // Load one tile of A into local memory.\n      for (var innerRow = 0; innerRow < rowPerThread; innerRow = innerRow + 1) {\n          let inputRow = tileRow + innerRow;\n          let inputCol = tileCol;\n          ").concat(vo(r,i),"\n      }\n\n      // Load one tile of B into local memory.\n      for (var innerRow = 0; innerRow < ").concat(f,"; innerRow = innerRow + 1) {\n          let inputRow = tileRowB + innerRow;\n          let inputCol = tileCol;\n          mm_Bsub[inputRow][inputCol] = mm_readB(batch, kStart + inputRow, globalCol").concat(i?", batchIndices":"",");\n      }\n      kStart = kStart + tileInner;\n      workgroupBarrier();\n\n      // Compute acc values for a single thread.\n      for (var k = 0; k < tileInner / innerElementSize; k = k + 1) {\n          let BCached0 = mm_Bsub[k * innerElementSize][tileCol];\n          let BCached1 = mm_Bsub[k * innerElementSize + 1][tileCol];\n          let BCached2 = mm_Bsub[k * innerElementSize + 2][tileCol];\n          ").concat(3===h?"":"let BCached3 = mm_Bsub[k * innerElementSize + 3][tileCol];","\n\n          ").concat(_o(r,h),"\n      }\n\n      workgroupBarrier();\n  }\n\n  for (var innerRow = 0; innerRow < rowPerThread; innerRow = innerRow + 1) {\n      mm_write(batch, globalRow + innerRow, globalCol, acc[innerRow]);\n  }\n}")},bo=(e,t)=>e?"\n            mm_Asub[inputRow][inputCol] = mm_readA(batch,\n              kStart + inputRow,\n              globalRowStart + inputCol".concat(t?", batchIndices":"",");\n            "):"\n            mm_Asub[inputRow][inputCol] = mm_readA(batch,\n              globalRowStart + inputRow,\n              kStart + inputCol".concat(t?", batchIndices":"",");\n            "),xo=e=>e?"let ACached = mm_Asub[k][tileRow + innerRow];":"let ACached = mm_Asub[tileRow + innerRow][k];",So=function(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"f32",i=arguments.length>3?arguments[3]:void 0,r=arguments.length>4&&void 0!==arguments[4]&&arguments[4],o=arguments.length>5&&void 0!==arguments[5]?arguments[5]:32,a=arguments.length>6&&void 0!==arguments[6]&&arguments[6],s=arguments.length>7&&void 0!==arguments[7]?arguments[7]:32,c=arguments.length>8&&void 0!==arguments[8]&&arguments[8],l=e[1]*t[1],u=e[0]*t[0],d=r?l:o,h=r?o:l;if(h%t[1]!==0||d%t[0]!==0||o%t[1]!==0)throw new Error("tileAHight ".concat(h," must be divisible by workgroupSize[1]").concat(t[1],", tileAWidth ").concat(d," must be divisible by workgroupSize[0]").concat(t[0],", tileInner ").concat(o," must be divisible by workgroupSize[1]").concat(t[1]));let f=h/t[1],p=d/t[0],m=o/t[1],g=c?"\n    let localRow = i32(localId.y);\n    let localCol = i32(localId.x);\n    let globalRowStart = i32(workgroupId.y) * ".concat(l,";\n    let globalColStart = i32(workgroupId.x) * ").concat(u,";\n\n    // Loop over shared dimension.\n    for (var t = 0; t < num_tiles; t = t + 1) {\n      // Load one tile of A into local memory.\n      for (var inputRow = localRow; inputRow < ").concat(h,"; inputRow = inputRow + ").concat(t[1],") {\n        for (var inputCol = localCol; inputCol < ").concat(d,"; inputCol = inputCol + ").concat(t[0],") {\n          ").concat(bo(r,i),"\n        }\n      }\n      // Load one tile of B into local memory.\n      for (var inputRow = localRow; inputRow < ").concat(o,"; inputRow = inputRow + ").concat(t[1],") {\n            for (var inputCol = localCol; inputCol < ").concat(u,"; inputCol = inputCol + ").concat(t[0],") {\n          mm_Bsub[inputRow][inputCol] = mm_readB(batch,\n            kStart + inputRow,\n            globalColStart + inputCol").concat(i?", batchIndices":"",");\n        }\n      }\n      kStart = kStart + tileInner;\n      workgroupBarrier();\n\n      // Compute acc values for a single thread.\n      var BCached : array<").concat(n,", colPerThread>;\n      for (var k = 0; k < tileInner; k = k + 1) {\n        for (var inner = 0; inner < colPerThread; inner = inner + 1) {\n          BCached[inner] = mm_Bsub[k][localCol + inner * ").concat(t[0],"];\n        }\n        for (var innerRow = 0; innerRow < rowPerThread; innerRow = innerRow + 1) {\n          let ACached = ").concat(r?"mm_Asub[k][localRow + innerRow * ".concat(t[1],"];"):"mm_Asub[localRow + innerRow * ".concat(t[1],"][k];"),"\n          for (var innerCol = 0; innerCol < colPerThread; innerCol = innerCol + 1) {\n            acc[innerRow][innerCol] = acc[innerRow][innerCol] +\n                ACached * BCached[innerCol];\n          }\n        }\n      }\n      workgroupBarrier();\n    }\n    for (var innerRow = 0; innerRow < rowPerThread; innerRow = innerRow + 1) {\n      let gRow = globalRowStart + localRow + innerRow * ").concat(t[1],";\n      for (var innerCol = 0; innerCol < colPerThread; innerCol = innerCol + 1) {\n        let gCol = globalColStart + localCol + innerCol * ").concat(t[0],";\n        mm_write(batch, gRow, gCol, acc[innerRow][innerCol]);\n      }\n    }\n    "):"\nlet tileRow = i32(localId.y) * rowPerThread;\nlet tileCol = i32(localId.x) * colPerThread;\n\nlet globalRow = i32(globalId.y) * rowPerThread;\nlet globalCol = i32(globalId.x) * colPerThread;\nlet globalRowStart = i32(workgroupId.y) * ".concat(l,";\n\nlet tileRowA = i32(localId.y) * ").concat(f,";\nlet tileColA = i32(localId.x) * ").concat(p,";\nlet tileRowB = i32(localId.y) * ").concat(m,";\n// Loop over shared dimension.\nfor (var t = 0; t < num_tiles; t = t + 1) {\n  // Load one tile of A into local memory.\n  for (var innerRow = 0; innerRow < ").concat(f,"; innerRow = innerRow + 1) {\n    for (var innerCol = 0; innerCol < ").concat(p,"; innerCol = innerCol + 1) {\n      let inputRow = tileRowA + innerRow;\n      let inputCol = tileColA + innerCol;\n      ").concat(bo(r,i),"\n    }\n  }\n\n  // Load one tile of B into local memory.\n  for (var innerRow = 0; innerRow < ").concat(m,"; innerRow = innerRow + 1) {\n    for (var innerCol = 0; innerCol < colPerThread; innerCol = innerCol + 1) {\n      let inputRow = tileRowB + innerRow;\n      let inputCol = tileCol + innerCol;\n      mm_Bsub[inputRow][inputCol] = mm_readB(batch,\n        kStart + inputRow,\n        globalCol + innerCol").concat(i?", batchIndices":"",");\n    }\n  }\n  kStart = kStart + tileInner;\n  workgroupBarrier();\n\n  // Compute acc values for a single thread.\n  var BCached : array<").concat(n,", colPerThread>;\n  for (var k = 0; k < tileInner; k = k + 1) {\n    for (var inner = 0; inner < colPerThread; inner = inner + 1) {\n      BCached[inner] = mm_Bsub[k][tileCol + inner];\n    }\n\n    for (var innerRow = 0; innerRow < rowPerThread; innerRow = innerRow + 1) {\n      ").concat(xo(r),"\n      for (var innerCol = 0; innerCol < colPerThread; innerCol = innerCol + 1) {\n        acc[innerRow][innerCol] = acc[innerRow][innerCol] + ACached * BCached[innerCol];\n      }\n    }\n  }\n\n  workgroupBarrier();\n}\n\nfor (var innerRow = 0; innerRow < rowPerThread; innerRow = innerRow + 1) {\n  for (var innerCol = 0; innerCol < colPerThread; innerCol = innerCol + 1) {\n    mm_write(batch, globalRow + innerRow, globalCol + innerCol,\n        acc[innerRow][innerCol]);\n  }\n}\n");return"\n  var<workgroup> mm_Asub : array<array<".concat(n,", ").concat(d,">, ").concat(h,">;\n  var<workgroup> mm_Bsub : array<array<").concat(n,", ").concat(u,">, ").concat(o,">;\n  const rowPerThread = ").concat(e[1],";\n  const colPerThread = ").concat(e[0],";\n  const tileInner = ").concat(o,";\n\n@compute @workgroup_size(").concat(t[0],", ").concat(t[1],", ").concat(t[2],")\nfn main(@builtin(local_invocation_id) localId : vec3<u32>,\n        @builtin(global_invocation_id) globalId : vec3<u32>,\n        @builtin(workgroup_id) workgroupId : vec3<u32>) {\n    let batch = ").concat(a?"0":"i32(globalId.z)",";\n    ").concat(i?"let batchIndices = ".concat(i.offsetToIndices("u32(batch)"),";"):"","\n    let num_tiles = ").concat(a?"".concat(Math.ceil(s/o)):"(uniforms.dim_inner - 1) / tileInner + 1",";\n    var kStart = ").concat(a?"i32(globalId.z) * ".concat(s):"0",";\n\n    var acc : array<array<").concat(n,", colPerThread>, rowPerThread>;\n    ").concat(g,"\n  }\n")},Eo=function(e,t,n,i){let r=arguments.length>4&&void 0!==arguments[4]&&arguments[4],[o,a,s,c]=i,l=fn(i[0].type.tensor);return"\n    fn mm_readA(batch: i32, row: i32, colIn: i32, batchIndices: ".concat(o.type.indices,") -> ").concat(fo(e,l)," {\n      var value = ").concat(fo(e,l),"(0.0);\n      let col = colIn * ").concat(e,";\n      if(row < uniforms.dim_a_outer && col < uniforms.dim_inner)\n      {\n        var aIndices: ").concat(a.type.indices,";\n        ").concat(go("aIndices",a,a.rank-2,o.rank,"batchIndices"),"\n        ").concat(a.indicesSet("aIndices",a.rank-2,"u32(row)"),"\n        ").concat(a.indicesSet("aIndices",a.rank-1,"u32(colIn)"),"\n        value = ").concat(a.getByIndices("aIndices"),";\n      }\n      return value;\n    }\n\n    fn mm_readB(batch: i32, row: i32, colIn: i32, batchIndices: ").concat(o.type.indices,") -> ").concat(fo(e,l)," {\n      var value = ").concat(fo(e,l),"(0.0);\n      let col = colIn * ").concat(e,";\n      if(row < uniforms.dim_inner && col < uniforms.dim_b_outer)\n      {\n        var bIndices: ").concat(s.type.indices,";\n        ").concat(go("bIndices",s,s.rank-2,o.rank,"batchIndices"),"\n        ").concat(s.indicesSet("bIndices",s.rank-2,"u32(row)"),"\n        ").concat(s.indicesSet("bIndices",s.rank-1,"u32(colIn)"),"\n        value = ").concat(s.getByIndices("bIndices"),";\n      }\n      return value;\n    }\n\n    fn mm_write(batch: i32, row: i32, colIn: i32, valueIn: ").concat(fo(e,l),") {\n      let col = colIn * ").concat(e,";\n      if (row < uniforms.dim_a_outer && col < uniforms.dim_b_outer) {\n        var value = valueIn;\n        let coords = vec3<i32>(batch, row, colIn);\n        ").concat(t?"value = value + ".concat(r?"bias[colIn]":"".concat(fo(e,l),"(bias[row])"),";"):"","\n        ").concat(n,"\n        ").concat(c.setByIndices("vec3<u32>(coords)","value"),"\n      }\n    }\n    ")},To=function(e,t,n,i){let r=arguments.length>4&&void 0!==arguments[4]&&arguments[4],o=arguments.length>5?arguments[5]:void 0,a=e[0].dims,s=e[1].dims,c=a.slice(0,-2),l=s.slice(0,-2),u=i?i.slice(0,-2):n.slice(0,-2),d=Rt.size(u),h=a[a.length-2],f=a[a.length-1],p=s[s.length-1],m=f%4===0&&p%4===0,g=h<=8?[4,1,1]:[4,4,1],y=[8,8,1],v=[Math.ceil(p/y[0]/g[0]),Math.ceil(h/y[1]/g[1]),Math.ceil(d/y[2]/g[2])],_=m?4:1,w=[...c,h,f/_],b=w.length,x=[...l,f,p/_],S=x.length,E=[d,h,p/_],T=[{type:6,data:h},{type:6,data:p},{type:6,data:f}];lo(t,T),T.push(...mn(u,w,x));let k=["rank","rank"],C=e.length>2;C&&(T.push(...mn(e[2].dims)),k.push("rank")),T.push(...mn(E));return{name:"MatMul",shaderCache:{hint:"".concat(g,";").concat(t.activation,";").concat(m,";").concat(r),inputDependencies:k},getRunData:()=>({outputs:[{dims:o?o(n):n,dataType:e[0].dataType}],dispatchGroup:{x:v[0],y:v[1],z:v[2]},programUniforms:T}),getShaderSource:n=>{let i=u.length,o=Tn("batchDims",e[0].dataType,i,1),a=fn(e[0].dataType),s=xn("a",e[0].dataType,b,_),c=xn("b",e[1].dataType,S,_),l=Sn("result",e[0].dataType,E.length,_),d=[s,c];if(C){let t=r?_:1;d.push(xn("bias",e[2].dataType,e[2].dims.length,t))}let h=[{name:"dim_a_outer",type:"i32"},{name:"dim_b_outer",type:"i32"},{name:"dim_inner",type:"i32"}];uo(t,h);let f=fn(l.type.tensor),p=co(t,l.type.value,f),v=Eo(_,C,p,[o,s,c,l],r);return"\n  ".concat(n.registerUniforms(h).registerInternalVariables(o).declareVariables(...d,l),"\n  ").concat(v,"\n  ").concat(m?wo(g,y,a,o):So(g,y,a,o),"\n                   ")}}}}),Yl=re(()=>{El(),kl(),Ll(),Gl(),Kl(),Zl(),Xl(),ko=function(e,t,n,i){let r=arguments.length>4&&void 0!==arguments[4]&&arguments[4],o=arguments.length>5?arguments[5]:void 0,a=arguments.length>6&&void 0!==arguments[6]?arguments[6]:4,s=arguments.length>7&&void 0!==arguments[7]?arguments[7]:4,c=arguments.length>8&&void 0!==arguments[8]?arguments[8]:4,l=arguments.length>9&&void 0!==arguments[9]?arguments[9]:"f32",u=e=>{switch(e){case 1:return"return w[row * i32(uniforms.w_shape[3]) + colIn];";case 4:return"return w[row * i32(uniforms.w_shape[3]) / 4 + colIn];";default:throw new Error("innerElementSize ".concat(e," is not supported."))}},d=e?"\n    let coord = vec4<i32>(batch, xRow, xCol, xCh);\n    ":"\n    let coord = vec4<i32>(batch, xCh, xRow, xCol);\n    ",h=e?"\n    let coords = vec4<i32>(\n      batch,\n      row / outWidth,\n      row % outWidth,\n      col);\n    ":"\n    let coords = vec4<i32>(\n      batch,\n      row,\n      col / outWidth,\n      col % outWidth);\n    ",f=e?"i32(uniforms.x_shape[1])":"i32(uniforms.x_shape[2])",p=e?"i32(uniforms.x_shape[2])":"i32(uniforms.x_shape[3])",m=e?"row":"col",g=e?"col":"row",y="\n    let inChannels = i32(uniforms.w_shape[2]);\n    let outWidth = ".concat(e?"i32(uniforms.result_shape[2])":"i32(uniforms.result_shape[3])",";\n    let outRow = ").concat(m," / outWidth;\n    let outCol = ").concat(m," % outWidth;\n\n    let WRow = ").concat(g," / (i32(uniforms.w_shape[1]) * inChannels);\n    let WCol = ").concat(g," / inChannels % i32(uniforms.w_shape[1]);\n    let xRow = outRow * uniforms.stride[0] + uniforms.dilation[0] * WRow - uniforms.pad[0];\n    let xCol = outCol * uniforms.stride[1] + uniforms.dilation[1] * WCol - uniforms.pad[1];\n    let xCh = ").concat(g," % inChannels;\n    var resData = ").concat(fo(a,l),"(0.0);\n    // The bounds checking is always needed since we use it to pad zero for\n    // the 'same' padding type.\n    if (xRow >= 0 && xRow < ").concat(f," && xCol >= 0 && xCol < ").concat(p,") {\n      ").concat(d,"\n      let xIndex = getIndexFromCoords4D(coord, vec4<i32>(uniforms.x_shape));\n      ").concat((e=>{switch(e){case 1:return"resData = x[xIndex];";case 3:return"resData = vec3<".concat(l,">(x[xIndex], x[xIndex + 1], x[xIndex + 2]);");case 4:return"resData = x[xIndex / 4];";default:throw new Error("innerElementSize ".concat(e," is not supported."))}})(a),"\n    }\n    return resData;"),v=e?t&&i?"\n    let col = colIn * ".concat(a,";\n    ").concat(y):"\n    let col = colIn * ".concat(a,";\n    if (row < uniforms.dim_a_outer && col < uniforms.dim_inner) {\n      ").concat(y,"\n    }\n    return ").concat(fo(a,l),"(0.0);"):i&&n?"\n    let col = colIn * ".concat(a,";\n    ").concat(y):"\n    let col = colIn * ".concat(a,";\n    if (row < uniforms.dim_inner && col < uniforms.dim_b_outer) {\n      ").concat(y,"\n    }\n    return ").concat(fo(a,l),"(0.0);"),_=e?i&&n?u(s):"\n    let col = colIn * ".concat(s,";\n    if (row < uniforms.dim_inner && col < uniforms.dim_b_outer) {\n      ").concat(u(s),"\n    }\n    return ").concat(fo(s,l),"(0.0);"):"\n    let col = colIn * ".concat(s,";\n    if (row < uniforms.dim_inner && col < uniforms.dim_a_outer) {\n      ").concat(u(s),"\n    }\n    return ").concat(fo(s,l),"(0.0);"),w=fo(c,l),b=fo(e?a:s,l),x=fo(e?s:a,l),S=co(o,w,l);return"\n    fn mm_readA(batch: i32, row : i32, colIn : i32) -> ".concat(b," {\n      ").concat(e?v:_,"\n    }\n\n    fn mm_readB(batch: i32, row : i32, colIn : i32) -> ").concat(x," {\n      ").concat(e?_:v,"\n    }\n\n    fn mm_write(batch: i32, row : i32, colIn : i32, valueIn : ").concat(w,") {\n      let col = colIn * ").concat(c,";\n      if (row < uniforms.dim_a_outer && col < uniforms.dim_b_outer)\n      {\n      var value = valueIn;\n      let outWidth = ").concat(e?"i32(uniforms.result_shape[2])":"i32(uniforms.result_shape[3])",";\n      ").concat(h,"\n      ").concat(po(r),"\n      ").concat(S,"\n      setOutputAtCoords(coords[0], coords[1], coords[2], coords[3], value);\n      }\n    }")},Co=(e,t,n,i,r,o,a,s,c)=>{let l="NHWC"===t.format,u=l?e[0].dims[3]:e[0].dims[1],d=n[0],h=l?n[2]:n[3],f=l?n[1]:n[2],p=l?n[3]:n[1],m=l&&(u%4===0||u%3===0)&&p%4===0,g=l?p:h*f,y=l?h*f:p,v=[8,8,1],_=i<=8?[4,1,1]:[4,4,1],w=[Math.ceil(g/v[0]/_[0]),Math.ceil(y/v[1]/_[1]),Math.ceil(d/v[2]/_[2])];Nt("verbose",()=>"[conv2d_mm_webgpu] dispatch = ".concat(w));let b=m?l&&u%4!==0?3:4:1,x=v[1]*_[1],S=v[0]*_[0],E=Math.max(v[0]*b,v[1]),T=i%x===0,k=r%S===0,C=o%E===0,I=m?[b,4,4]:[1,1,1],A=[{type:6,data:i},{type:6,data:r},{type:6,data:o},{type:6,data:[t.pads[0],t.pads[1]]},{type:6,data:t.strides},{type:6,data:t.dilations}];lo(t,A),A.push(...mn(e[0].dims,e[1].dims));let N=["rank","rank"];a&&(A.push(...mn(e[2].dims)),N.push("rank")),A.push(...mn(n));return{name:"Conv2DMatMul",shaderCache:{hint:"".concat(t.cacheKey,";").concat(b,";").concat(m,";").concat(T,";").concat(k,";").concat(C,";").concat(x,";").concat(S,";").concat(E),inputDependencies:N},getRunData:()=>({outputs:[{dims:c?c(n):n,dataType:e[0].dataType}],dispatchGroup:{x:w[0],y:w[1],z:w[2]},programUniforms:A}),getShaderSource:i=>{let r=[{name:"dim_a_outer",type:"i32"},{name:"dim_b_outer",type:"i32"},{name:"dim_inner",type:"i32"},{name:"pad",type:"i32",length:2},{name:"stride",type:"i32",length:2},{name:"dilation",type:"i32",length:2}];uo(t,r);let o=m?4:1,c=fn(e[0].dataType),u="\n      fn setOutputAtIndex(flatIndex : i32, value : ".concat(m?"vec4<".concat(c,">"):c,") {\n        result[flatIndex] = ").concat(m?"vec4<".concat(c,">"):c,"(value);\n      }\n      fn setOutputAtCoords(d0 : i32, d1 : i32, d2 : i32, d3 : i32, value : ").concat(m?"vec4<".concat(c,">"):c,") {\n        let flatIndex = getOutputIndexFromCoords(vec4<i32>(d0, d1, d2, d3));\n        setOutputAtIndex(flatIndex ").concat(m?"/ 4":"",", value);\n      }"),d=[xn("x",e[0].dataType,e[0].dims.length,3===b?1:b),xn("w",e[1].dataType,e[1].dims.length,o)],h=Sn("result",e[0].dataType,n.length,o);if(a){let t=xn("bias",e[2].dataType,e[2].dims.length,o);d.push(t),u+="\n        fn getBiasByOutputCoords(coords : vec4<i32>) -> ".concat(m?"vec4<".concat(c,">"):c," {\n          return bias[coords.").concat(l?"w":"y").concat(m?"/ 4":"","];\n        }")}return"\n        ".concat(mo("uniforms.result_strides"),"\n        //struct Uniforms { xShape : vec4<i32>, wShape : vec4<i32>, outShape : vec4<i32>,\n        //  outShapeStrides: vec3<i32>, filterDims : vec2<i32>, pad : vec2<i32>, stride : vec2<i32>,\n        //  dilation : vec2<i32>, dimAOuter : i32, dimBOuter : i32, dimInner : i32 };\n        ").concat(i.registerUniforms(r).declareVariables(...d,h),"\n        ").concat(u,"\n        ").concat(ko(l,T,k,C,a,t,I[0],I[1],I[2],c),"\n        ").concat(m?wo(_,v,c,void 0,!l,E):So(_,v,c,void 0,!l,E,!1,void 0,s))}}}}),Jl=re(()=>{El(),kl(),Cl(),Ll(),Gl(),Kl(),Io=e=>{let t=1;for(let n=0;n<e.length;n++)t*=e[n];return t},Ao=e=>"number"==typeof e?[e,e,e]:e,No=(e,t)=>t<=1?e:e+(e-1)*(t-1),Oo=function(e,t,n){let i=No(t,arguments.length>3&&void 0!==arguments[3]?arguments[3]:1);return Math.floor((e[0]*(n-1)-n+i)/2)},Po=(e,t,n,i,r)=>{null==r&&(r=Oo(e,t[0],i[0]));let o=[0,0,0,n];for(let a=0;a<3;a++)e[a]+2*r>=t[a]&&(o[a]=Math.trunc((e[a]-t[a]+2*r)/i[a]+1));return o},Ro=(e,t,n,i,r,o,a,s,c,l)=>{let u,d,h,f;if("VALID"===e&&(e=0),"number"==typeof e){u={top:e,bottom:e,left:e,right:e,front:e,back:e};let p=Po([t,n,i,1],[s,c,l],1,[r,o,a],e);d=p[0],h=p[1],f=p[2]}else if(Array.isArray(e)){if(!e.every((e,t,n)=>e===n[0]))throw Error("Unsupported padding parameter: ".concat(e));u={top:e[0],bottom:e[1],left:e[2],right:e[3],front:e[4],back:e[5]};let p=Po([t,n,i,1],[s,c,l],1,[r,o,a],e[0]);d=p[0],h=p[1],f=p[2]}else{if("SAME_UPPER"!==e)throw Error("Unknown padding parameter: ".concat(e));{d=Math.ceil(t/r),h=Math.ceil(n/o),f=Math.ceil(i/a);let e=(d-1)*r+s-t,p=(h-1)*o+c-n,m=(f-1)*a+l-i,g=Math.floor(e/2),y=e-g,v=Math.floor(p/2),_=p-v,w=Math.floor(m/2);u={top:v,bottom:_,left:w,right:m-w,front:g,back:y}}}return{padInfo:u,outDepth:d,outHeight:h,outWidth:f}},Lo=function(e,t,n,i,r){let o,a,s,c,l,u=arguments.length>5&&void 0!==arguments[5]&&arguments[5],d=arguments.length>6&&void 0!==arguments[6]?arguments[6]:"channelsLast";if("channelsLast"===d)[o,a,s,c,l]=e;else{if("channelsFirst"!==d)throw new Error("Unknown dataFormat ".concat(d));[o,l,a,s,c]=e}let[h,,f,p,m]=t,[g,y,v]=Ao(n),[_,w,b]=Ao(i),x=No(f,_),S=No(p,w),E=No(m,b),{padInfo:T,outDepth:k,outHeight:C,outWidth:I}=Ro(r,a,s,c,g,y,v,x,S,E),A=u?h*l:h,N=[0,0,0,0,0];return"channelsFirst"===d?N=[o,A,k,C,I]:"channelsLast"===d&&(N=[o,k,C,I,A]),{batchSize:o,dataFormat:d,inDepth:a,inHeight:s,inWidth:c,inChannels:l,outDepth:k,outHeight:C,outWidth:I,outChannels:A,padInfo:T,strideDepth:g,strideHeight:y,strideWidth:v,filterDepth:f,filterHeight:p,filterWidth:m,effectiveFilterDepth:x,effectiveFilterHeight:S,effectiveFilterWidth:E,dilationDepth:_,dilationHeight:w,dilationWidth:b,inShape:e,outShape:N,filterShape:t}},zo=(e,t,n,i,r,o)=>{let a="channelsLast"===o,s=(a?e[0].dims[3]:e[0].dims[1],{x:n.map((e,t)=>t)}),c=[Math.ceil(Io(s.x.map(e=>n[e]))/64),1,1];Nt("verbose",()=>"[conv3d_naive_webgpu] dispatch = ".concat(c));let l=[{type:12,data:Rt.size(n)},{type:12,data:i},{type:12,data:r},{type:12,data:t.strides},{type:12,data:t.dilations}];lo(t,l),l.push(...mn(e[0].dims,e[1].dims));let u=["rank","rank"],d=3===e.length;d&&(l.push(...mn(e[2].dims)),u.push("rank")),l.push(...mn(n));return{name:"Conv3DNaive",shaderCache:{hint:"".concat(t.cacheKey,";").concat(a,";").concat(1,";").concat(d),inputDependencies:u},getRunData:()=>({outputs:[{dims:n,dataType:e[0].dataType}],dispatchGroup:{x:c[0],y:c[1],z:c[2]},programUniforms:l}),getShaderSource:o=>{let s=[{name:"output_size",type:"u32"},{name:"filter_dims",type:"u32",length:i.length},{name:"pads",type:"u32",length:r.length},{name:"strides",type:"u32",length:t.strides.length},{name:"dilations",type:"u32",length:t.dilations.length}];uo(t,s);let c=fn(e[0].dataType),l=xn("x",e[0].dataType,e[0].dims.length,1),u=xn("W",e[1].dataType,e[1].dims.length,1),h=[l,u],f=Sn("result",e[0].dataType,n.length,1),p="";if(d){let t=xn("bias",e[2].dataType,e[2].dims.length,1);h.push(t),p+="\n        fn getBiasByOutputCoords(coords : array<u32, 5>) -> ".concat(c," {\n          return bias[").concat(wn("coords",a?4:1,5)).concat("","];\n        }")}let m=fo(1,c),g=co(t,m,c);return"\n            ".concat(p,"\n            fn getX(d0 : u32, d1 : u32, d2 : u32, d3 : u32, d4 : u32) -> f32 {\n              let aIndices = array<u32, 5>(d0, d1, d2, d3, d4);\n              return ").concat(l.getByIndices("aIndices"),";\n            }\n            fn getW(d0 : u32, d1 : u32, d2 : u32, d3 : u32, d4 : u32) -> f32 {\n              let aIndices = array<u32, 5>(d0, d1, d2, d3, d4);\n              return ").concat(u.getByIndices("aIndices"),";\n            }\n          ").concat(o.registerUniforms(s).declareVariables(...h,f),"\n          ").concat(o.mainStart(),"\n          ").concat(o.guardAgainstOutOfBoundsWorkgroupSizes("uniforms.output_size"),"\n              let coords = ").concat(f.offsetToIndices("global_idx"),";\n              let batch = ").concat(wn("coords",0,l.rank),";\n              let d2 = ").concat(wn("coords",a?l.rank-1:1,l.rank),";\n              let xFRCCorner = vec3<u32>(").concat(wn("coords",a?1:2,l.rank),",\n              ").concat(wn("coords",a?2:3,l.rank),",\n              ").concat(wn("coords",a?3:4,l.rank),") * uniforms.strides - uniforms.pads;\n              let xFCorner = xFRCCorner.x;\n              let xRCorner = xFRCCorner.y;\n              let xCCorner = xFRCCorner.z;\n              let xShapeY = ").concat(wn("uniforms.x_shape",a?1:2,l.rank),";\n              let xShapeZ = ").concat(wn("uniforms.x_shape",a?2:3,l.rank),";\n              let xShapeW = ").concat(wn("uniforms.x_shape",a?3:4,l.rank),";\n              let xShapeU = ").concat(wn("uniforms.x_shape",a?4:1,l.rank),";\n              let inputDepthNearestVec4 = (xShapeU / 4) * 4;\n              let inputDepthVec4Remainder = xShapeU % 4;\n\n              var value = 0.0;\n              for (var wF = 0u; wF < uniforms.filter_dims[0]; wF++) {\n                let xF = xFCorner + wF * uniforms.dilations[0];\n                if (xF < 0 || xF >= xShapeY) {\n                  continue;\n                }\n\n                for (var wR = 0u; wR < uniforms.filter_dims[1]; wR++) {\n                  let xR = xRCorner + wR * uniforms.dilations[1];\n                  if (xR < 0 || xR >= xShapeZ) {\n                    continue;\n                  }\n\n                  for (var wC = 0u; wC < uniforms.filter_dims[2]; wC++) {\n                    let xC = xCCorner + wC * uniforms.dilations[2];\n                    if (xC < 0 || xC >= xShapeW) {\n                      continue;\n                    }\n\n                    for (var d1 = 0u; d1 < inputDepthNearestVec4; d1 += 4) {\n                      ").concat(a?"let xValues = vec4<f32>(\n                               getX(batch, xF, xR, xC, d1),\n                               getX(batch, xF, xR, xC, d1 + 1),\n                               getX(batch, xF, xR, xC, d1 + 2),\n                               getX(batch, xF, xR, xC, d1 + 3));\n                            ":"let xValues = vec4<f32>(\n                               getX(batch, d1, xF, xR, xC),\n                               getX(batch, d1 + 1, xF, xR, xC),\n                               getX(batch, d1 + 2, xF, xR, xC),\n                               getX(batch, d1 + 3, xF, xR, xC));\n                            ","\n                            let wValues = vec4<f32>(\n                              getW(d2, d1, wF, wR, wC),\n                              getW(d2, d1 + 1, wF, wR, wC),\n                              getW(d2, d1 + 2, wF, wR, wC),\n                              getW(d2, d1 + 3, wF, wR, wC));\n                      value += dot(xValues, wValues);\n                    }\n                    if (inputDepthVec4Remainder == 1) {\n                        ").concat(a?"value += getX(batch, xF, xR, xC, inputDepthNearestVec4)\n                          * getW(d2, inputDepthNearestVec4, wF, wR, wC);":"value += getX(batch, inputDepthNearestVec4, xF, xR, xC)\n                          * getW(d2, inputDepthNearestVec4, wF, wR, wC);","\n                    } else if (inputDepthVec4Remainder == 2) {\n                      ").concat(a?"let xValues = vec2<f32>(\n                        getX(batch, xF, xR, xC, inputDepthNearestVec4),\n                        getX(batch, xF, xR, xC, inputDepthNearestVec4 + 1));\n                      ":"let xValues = vec2<f32>(\n                        getX(batch, inputDepthNearestVec4, xF, xR, xC),\n                        getX(batch, inputDepthNearestVec4 + 1, xF, xR, xC));\n                    ","\n                    let wValues = vec2<f32>(\n                      getW(d2, inputDepthNearestVec4, wF, wR, wC),\n                      getW(d2, inputDepthNearestVec4 + 1, wF, wR, wC));\n                      value += dot(xValues, wValues);\n                    } else if (inputDepthVec4Remainder == 3) {\n                      ").concat(a?"let xValues = vec3<f32>(\n                        getX(batch, xF, xR, xC, inputDepthNearestVec4),\n                        getX(batch, xF, xR, xC, inputDepthNearestVec4 + 1),\n                        getX(batch, xF, xR, xC, inputDepthNearestVec4 + 2));\n                      ":"let xValues = vec3<f32>(\n                        getX(batch, inputDepthNearestVec4, xF, xR, xC),\n                        getX(batch, inputDepthNearestVec4 + 1, xF, xR, xC),\n                        getX(batch, inputDepthNearestVec4 + 2, xF, xR, xC));\n                    ","\n                    let wValues = vec3<f32>(\n                      getW(d2, inputDepthNearestVec4, wF, wR, wC),\n                      getW(d2, inputDepthNearestVec4 + 1, wF, wR, wC),\n                      getW(d2, inputDepthNearestVec4 + 2, wF, wR, wC));\n                      value += dot(xValues, wValues);\n                    }\n                  }\n                }\n              }\n              ").concat(d?"value = value + getBiasByOutputCoords(coords)":"",";\n              ").concat(g,"\n              result[global_idx] = f32(value);\n          }")}}}}),$l=re(()=>{El(),Cl(),Ll(),Gl(),Mo=(e,t,n,i)=>{let r=e.length>2,o=r?"value += b[output_channel];":"",a=e[0].dims,s=e[1].dims,c="NHWC"===t.format,l=c?n[3]:n[1],u=l/t.group,d=c&&u>=4?gn(l):1,h=Rt.size(n)/d,f=[{type:12,data:h},{type:12,data:t.dilations},{type:12,data:[t.strides[0],t.strides[1]]},{type:12,data:[t.pads[0],t.pads[1]]},{type:12,data:u}];lo(t,f),f.push(...mn(a,[s[0],s[1],s[2],s[3]/d]));let p=r?["rank","rank","rank"]:["rank","rank"];f.push(...mn([n[0],n[1],n[2],n[3]/d]));return{name:"GroupedConv",shaderCache:{hint:"".concat(t.cacheKey,"_").concat(d),inputDependencies:p},getRunData:()=>({outputs:[{dims:i?i(n):n,dataType:e[0].dataType}],dispatchGroup:{x:Math.ceil(h/64)},programUniforms:f}),getShaderSource:i=>{let l=Sn("output",e[0].dataType,n.length,d),u=fn(l.type.tensor),h=co(t,l.type.value,u),f=xn("x",e[0].dataType,a.length),p=xn("w",e[1].dataType,s.length,d),m=[f,p];r&&m.push(xn("b",e[2].dataType,e[2].dims,d));let g=[{name:"output_size",type:"u32"},{name:"dilations",type:"u32",length:t.dilations.length},{name:"strides",type:"u32",length:2},{name:"pads",type:"u32",length:2},{name:"output_channels_per_group",type:"u32"}];uo(t,g);let y=c?"\n      for (var wHeight: u32 = 0u; wHeight < uniforms.w_shape[0]; wHeight++) {\n        let xHeight = xRCCorner.x + wHeight * uniforms.dilations[0];\n\n        if (xHeight < 0u || xHeight >= uniforms.x_shape[1]) {\n          continue;\n        }\n\n        for (var wWidth: u32 = 0u; wWidth < uniforms.w_shape[1]; wWidth++) {\n          let xWidth = xRCCorner.y + wWidth * uniforms.dilations[1];\n          if (xWidth < 0u || xWidth >= uniforms.x_shape[2]) {\n            continue;\n          }\n\n          for (var wInChannel: u32 = 0u; wInChannel < uniforms.w_shape[2]; wInChannel++) {\n            let input_channel = in_channel_offset + wInChannel;\n            let xVal = ".concat(f.get("batch","xHeight","xWidth","input_channel"),";\n            let wVal = ").concat(p.get("wHeight","wWidth","wInChannel","output_channel"),";\n            value += xVal * wVal;\n          }\n        }\n      }\n      "):"\n      for (var wInChannel: u32 = 0u; wInChannel < uniforms.w_shape[1]; wInChannel++) {\n        let input_channel = in_channel_offset + wInChannel;\n        for (var wHeight: u32 = 0u; wHeight < uniforms.w_shape[2]; wHeight++) {\n          let xHeight = xRCCorner.x + wHeight * uniforms.dilations[0];\n\n          if (xHeight < 0u || xHeight >= uniforms.x_shape[2]) {\n            continue;\n          }\n\n          for (var wWidth: u32 = 0u; wWidth < uniforms.w_shape[3]; wWidth++) {\n            let xWidth = xRCCorner.y + wWidth * uniforms.dilations[1];\n            if (xWidth < 0u || xWidth >= uniforms.x_shape[3]) {\n              continue;\n            }\n\n            let xVal = ".concat(f.get("batch","input_channel","xHeight","xWidth"),";\n            let wVal = ").concat(p.get("output_channel","wInChannel","wHeight","wWidth"),";\n            value += xVal * wVal;\n          }\n        }\n      }\n      ");return"\n  ".concat(i.registerUniforms(g).declareVariables(...m,l),"\n\n  ").concat(i.mainStart(),"\n    ").concat(i.guardAgainstOutOfBoundsWorkgroupSizes("uniforms.output_size"),"\n\n    let outputIndices = ").concat(l.offsetToIndices("global_idx"),";\n    let batch: u32 = outputIndices[0];\n    let output_channel: u32 = outputIndices[").concat(c?3:1,"];\n    let xRCCorner: vec2<u32> = vec2<u32>(outputIndices[").concat(c?1:2,"], outputIndices[").concat(c?2:3,"]) * uniforms.strides - uniforms.pads;\n    let group_id: u32 = output_channel * ").concat(d," / uniforms.output_channels_per_group;\n    var in_channel_offset = group_id * uniforms.w_shape[").concat(c?2:1,"];\n\n    var value: ").concat(l.type.value," = ").concat(l.type.value,"(0);\n    ").concat(y,"\n    ").concat(o,"\n    ").concat(h,"\n    ").concat(l.setByOffset("global_idx","value"),"\n  }")}}},Do=(e,t,n,i)=>{let r=e.length>2,o=gn(n[3]),a=gn(n[2]),s=Rt.size(n)/o/a,c=[e[0].dims[0],e[0].dims[1],e[0].dims[2],e[0].dims[3]/o],l=[e[1].dims[0],e[1].dims[1],e[1].dims[2],e[1].dims[3]/o],u=[n[0],n[1],n[2],n[3]/o],d=[{type:12,data:s},{type:6,data:[t.strides[0],t.strides[1]]},{type:6,data:[t.pads[0],t.pads[1]]}];lo(t,d),d.push(...mn(c,l,u));let h=(a-1)*t.strides[1]+l[1];return{name:"GroupedConv-Vectorize",shaderCache:{hint:"".concat(t.cacheKey,";").concat(o,";").concat(a,";").concat(h,";").concat(l[0],";").concat(l[1]),inputDependencies:r?["rank","rank","type"]:["rank","rank"]},getRunData:()=>({outputs:[{dims:i?i(n):n,dataType:e[0].dataType}],dispatchGroup:{x:Math.ceil(s/64)},programUniforms:d}),getShaderSource:n=>{let i=Sn("output",e[0].dataType,u.length,o),s=fn(i.type.tensor),d=co(t,i.type.value,s),f=xn("x",e[0].dataType,c.length,o),p=xn("w",e[1].dataType,l.length,o),m=[f,p];r&&m.push(xn("b",e[2].dataType,e[2].dims,o));let g=r?"value += b[output_channel];":"",y=[{name:"output_size",type:"u32"},{name:"strides",type:"i32",length:2},{name:"pads",type:"i32",length:2}];return uo(t,y),"\n  ".concat(n.registerUniforms(y).declareVariables(...m,i),"\n  ").concat(n.mainStart(),"\n    ").concat(n.guardAgainstOutOfBoundsWorkgroupSizes("uniforms.output_size"),"\n    let width0 = uniforms.output_shape[3];\n    let output_channel = global_idx % width0;\n    var index1 = global_idx / width0;\n    let width1 = uniforms.output_shape[2] / ").concat(a,"u;\n    let col = (index1 % width1) * ").concat(a,"u;\n    index1 = index1 / width1;\n    let row = index1 % uniforms.output_shape[1];\n    let batch = index1 / uniforms.output_shape[1];\n\n    let x_corner = vec2<i32>(i32(row), i32(col)) * uniforms.strides - uniforms.pads;\n\n    var x_vals: array<").concat(f.type.value,", ").concat(h,">;\n    var values: array<").concat(i.type.value,", ").concat(a,">;\n    let input_channel = output_channel;\n    // Use constant instead of uniform can give better performance for w's height/width.\n    for (var w_height: u32 = 0u; w_height < ").concat(l[0],"; w_height++) {\n      let x_height = x_corner.x + i32(w_height);\n      if (x_height >= 0 && u32(x_height) < uniforms.x_shape[1]) {\n        for (var i = 0; i < ").concat(h,"; i++) {\n          let x_width = x_corner.y + i;\n          if (x_width >= 0 && u32(x_width) < uniforms.x_shape[2]) {\n            x_vals[i] = ").concat(f.get("batch","u32(x_height)","u32(x_width)","input_channel"),";\n          } else {\n            x_vals[i] = ").concat(f.type.value,"(0);\n          }\n        }\n        for (var w_width: u32 = 0u; w_width < ").concat(l[1],"; w_width++) {\n          let w_val = ").concat(p.get("w_height","w_width","0","output_channel"),";\n          for (var i = 0u; i < ").concat(a,"u; i++) {\n            values[i] = fma(x_vals[i * u32(uniforms.strides[1]) + w_width], w_val, values[i]);\n          }\n        }\n      }\n    }\n\n    for (var i = 0u; i < ").concat(a,"u; i++) {\n      var value = values[i];\n      ").concat(g,"\n      ").concat(d,"\n      ").concat(i.set("batch","row","col + i","output_channel","value"),";\n    }\n  }")}}}}),eu=re(()=>{Cl(),Yl(),Jl(),Xl(),$l(),Gl(),Ql(),zl(),Bo=(e,t,n,i,r,o)=>{let a=e[0],s=e.slice(o?1:2,o?3:4),c=s.length,l=t[0],u=t.slice(2).map((e,t)=>e+(e-1)*(n[t]-1)),d=s.map((e,t)=>e+i[t]+i[t+c]).map((e,t)=>Math.floor((e-u[t]+r[t])/r[t]));return d.splice(0,0,a),d.splice(o?3:1,0,l),d},Uo=[2,3,1,0],Fo=(e,t)=>{if(!e||2!==e.length&&3!==e.length)throw new Error("Conv requires 2 or 3 inputs");if(e[0].dims.length>5)throw new Error("greater than 5D is not supported");if(e[0].dims.length!==e[1].dims.length)throw new Error("filter does not have same dimension as input");if(e[0].dims["NHWC"===t.format?e[0].dims.length-1:1]!==e[1].dims[1]*t.group)throw new Error("FILTER_IN_CHANNEL should be equal to DATA_CHANNEL");if(3===e.length&&(1!==e[2].dims.length||e[1].dims[0]!==e[2].dims[0]))throw new Error("invalid bias");let n=e[0].dims.length-2;if(t.dilations.length!==n)throw new Error("dilations should be ".concat(n,"D"));if(t.strides.length!==n)throw new Error("strides should be ".concat(n,"D"));if(t.pads.length!==2*n)throw new Error("pads should be ".concat(2*n,"D"));if(0!==t.kernelShape.length&&t.kernelShape.length!==e[1].dims.length-2)throw new Error("invalid kernel shape")},jo=(e,t)=>{let n=e.kernelShape.slice();n.length<t[1].dims.length-2&&n.push(...Array(t[1].dims.length-2-n.length).fill(0));for(let o=2;o<t[1].dims.length;++o)0===n[o-2]&&(n[o-2]=t[1].dims[o]);let i=e.pads.slice();Lt.adjustPadsBasedOnAutoPad(t[0].dims,e.strides,e.dilations,n,i,"NHWC"===e.format,e.autoPad);let r=Object.assign({},e);return Object.assign(r,{kernelShape:n,pads:i}),r},Vo=e=>{let t=ho(e),n=e.format;return s(s({autoPad:["NOTSET","VALID","SAME_UPPER","SAME_LOWER"][e.auto_pad],format:n,dilations:e.dilations,group:e.group,kernelShape:e.kernel_shape,pads:e.pads,strides:e.strides,wIsConst:e.w_is_const()},t),{},{cacheKey:"".concat(e.format,";").concat(t.activation,";")})},qo=(e,t,n,i)=>{var r;let o="NHWC"===n.format,a=Bo(t[0].dims,t[1].dims,n.dilations,n.pads,n.strides,o);if(1!==n.group){let r=[t[0]];if(o){var s;let i=null!==(s=e.kernelCustomData.wT)&&void 0!==s?s:e.compute(Ln(t[1],Uo),{inputs:[1],outputs:[n.wIsConst?-2:-1]})[0];n.wIsConst&&!e.kernelCustomData.wT&&(e.kernelCustomData.wT=i),r.push(i)}else r.push(t[1]);return 3===t.length&&r.push(t[2]),void(!e.adapterInfo.isArchitecture("ampere")&&o&&t[1].dims[0]===n.group&&1===t[1].dims[1]&&1===n.dilations[0]&&1===n.dilations[1]?e.compute(Do(r,n,a,i),{inputs:r}):e.compute(Mo(r,n,a,i),{inputs:r}))}let c=3===t.length,l=t[0].dims[o?1:2],u=t[0].dims[o?2:3],d=t[0].dims[o?3:1],h=t[1].dims[2],f=t[1].dims[3],p=a[o?1:2],m=a[o?2:3],g=a[o?3:1],y=o&&h===l&&f===u&&0===n.pads[0]&&0===n.pads[1];if(y||1===h&&1===f&&1===n.dilations[0]&&1===n.dilations[1]&&1===n.strides[0]&&1===n.strides[1]&&0===n.pads[0]&&0===n.pads[1]){let r,s,h,f=a[0],_=[];if(o){var v;let i=null!==(v=e.kernelCustomData.wT)&&void 0!==v?v:e.compute(Ln(t[1],Uo),{inputs:[1],outputs:[n.wIsConst?-2:-1]})[0];if(n.wIsConst&&!e.kernelCustomData.wT&&(e.kernelCustomData.wT=i),y){let e=l*u*d;r=t[0].reshape([1,f,e]),s=i.reshape([1,e,g]),h=[1,f,g]}else r=t[0].reshape([f,l*u,d]),s=i.reshape([1,d,g]),h=[f,p*m,g];_.push(r),_.push(s)}else r=t[0].reshape([f,d,l*u]),s=t[1].reshape([1,g,d]),h=[f,g,p*m],_.push(s),_.push(r);c&&_.push(t[2]);let w=h[2],b=_[0].dims[_[0].dims.length-1];return void(w<8&&b<8?e.compute(yo(_,n,a,h,o,i),{inputs:_}):e.compute(To(_,n,a,h,o,i),{inputs:_}))}let _=null!==(r=e.kernelCustomData.wT)&&void 0!==r?r:e.compute(Ln(t[1],Uo),{inputs:[1],outputs:[n.wIsConst?-2:-1]})[0];n.wIsConst&&!e.kernelCustomData.wT&&(e.kernelCustomData.wT=_);let w=[t[0],_];c&&w.push(t[2]);let b=o?p*m:g,x=o?g:p*m,S=h*f*d;e.compute(Co(w,n,a,b,x,S,c,!0,i),{inputs:w})},Ho=(e,t)=>{let n="NHWC"===t.format,i=[e.inputs[0].reshape(n?[e.inputs[0].dims[0],1,e.inputs[0].dims[1],e.inputs[0].dims[2]]:[e.inputs[0].dims[0],e.inputs[0].dims[1],1,e.inputs[0].dims[2]]),e.inputs[1].reshape([e.inputs[1].dims[0],e.inputs[1].dims[1],1,e.inputs[1].dims[2]])];3===e.inputs.length&&i.push(e.inputs[2]);let r=[0,t.pads[0],0,t.pads[1]],o=[1].concat(t.strides),a=[1].concat(t.dilations),c=[1].concat(t.kernelShape),l=jo(s(s({},t),{},{pads:r,strides:o,dilations:a,kernelShape:c}),i);qo(e,i,l,e=>n?[e[0],e[2],e[3]]:[e[0],e[1],e[3]])},Wo=(e,t,n)=>{let i="NHWC"===n.format?"channelsLast":"channelsFirst",r=jo(n,t),o="NOTSET"===n.autoPad?n.pads:n.autoPad,a=Lo(t[0].dims,t[1].dims,n.strides,n.dilations,o,!1,i);e.compute(zo(t,r,a.outShape,[a.filterDepth,a.filterHeight,a.filterWidth],[a.padInfo.front,a.padInfo.top,a.padInfo.left],i))},Go=(e,t)=>{if(Fo(e.inputs,t),3===e.inputs[0].dims.length)Ho(e,t);else if(5===e.inputs[0].dims.length)Wo(e,e.inputs,t);else{let n=jo(t,e.inputs);qo(e,e.inputs,n)}}}),tu=re(()=>{El(),kl(),Cl(),Ll(),Ko=(e,t,n)=>{let i=e.length>2,r=t.outputShape,o="NHWC"===t.format,a=t.group,s=e[1].dims,c=s[2]/a,l=s[3],u=o?gn(c):1,d=o&&1===l&&c>=4,h=d?4*Math.floor(c/4):Math.floor(c/u)*u,f=c-h,p=o?gn(l):1,m=o?1===l?u:p:1,g=Rt.size(r)/p,y=[Math.ceil(g/64),1,1];Nt("verbose",()=>"[conv2d_backprop_webgpu] dispatch = ".concat(y));let v=["rank","rank"],_=[t.strides[0],t.strides[1]],w=[t.kernelShape[o?1:2],t.kernelShape[o?2:3]],b=[t.dilations[0],t.dilations[1]],x=[w[0]+(t.dilations[0]<=1?0:(t.kernelShape[o?1:2]-1)*(t.dilations[0]-1)),w[1]+(t.dilations[1]<=1?0:(t.kernelShape[o?2:3]-1)*(t.dilations[1]-1))],S=[x[0]-1-Math.floor((t.pads[0]+t.pads[2])/2),x[1]-1-Math.floor((t.pads[1]+t.pads[3])/2)],E=[{type:12,data:g},{type:12,data:_},{type:12,data:w},{type:12,data:b},{type:12,data:x},{type:6,data:S},{type:12,data:h},{type:12,data:c},{type:12,data:l},...mn(e[0].dims,e[1].dims)];i&&(E.push(...mn(e[2].dims)),v.push("rank")),E.push(...mn(r));return{name:"ConvTranspose2D",shaderCache:{hint:"".concat(t.cacheKey,";").concat(u).concat(m).concat(p).concat(d).concat(f),inputDependencies:v},getRunData:()=>({dispatchGroup:{x:y[0],y:y[1],z:y[2]},outputs:[{dims:n?n(r):r,dataType:e[0].dataType}],programUniforms:E}),getShaderSource:t=>{let n=[{name:"output_size",type:"u32"},{name:"strides",type:"u32",length:_.length},{name:"filter_dims",type:"u32",length:w.length},{name:"dilations",type:"u32",length:w.length},{name:"effective_filter_dims",type:"u32",length:x.length},{name:"pads",type:"i32",length:S.length},{name:"input_channels_per_group_int",type:"u32"},{name:"input_channels_per_group",type:"u32"},{name:"output_channels_per_group",type:"u32"}],a=fn(e[0].dataType),s=o?1:2,c=o?2:3,l=o?3:1,h=xn("W",e[1].dataType,e[1].dims.length,m),g=xn("Dy",e[0].dataType,e[0].dims.length,u),y=[g,h];i&&y.push(xn("bias",e[2].dataType,[r[l]].length,p));let v=Sn("result",e[0].dataType,r.length,p),b="\n            let outputIndices = ".concat(v.offsetToIndices("global_idx * ".concat(p)),";\n            let batch = ").concat(v.indicesGet("outputIndices",0),";\n            let d1 = ").concat(v.indicesGet("outputIndices",l),";\n            let r = ").concat(v.indicesGet("outputIndices",s),";\n            let c = ").concat(v.indicesGet("outputIndices",c),";\n            let dyCorner = vec2<i32>(i32(r), i32(c)) - uniforms.pads;\n            let dyRCorner = dyCorner.x;\n            let dyCCorner = dyCorner.y;\n            let groupId = d1 / uniforms.output_channels_per_group;\n            let wOutChannel = d1 - groupId * uniforms.output_channels_per_group;\n            // Convolve dy(?, ?, d2) with w(:, :, d1, d2) to compute dx(xR, xC, d1).\n            // ? = to be determined. : = across all values in that axis.\n            var dotProd = ").concat(v.type.value,"(0.0);\n            var wR: u32 = 0;\n            if (uniforms.dilations.x == 1) {\n              // Minimum wR >= 0 that satisfies (dyRCorner + wR) % (uniforms.strides.x) == 0\n              wR = u32(((dyRCorner + i32(uniforms.strides.x) - 1) / i32(uniforms.strides.x)) * i32(uniforms.strides.x) - dyRCorner);\n            }\n            for (; wR < uniforms.effective_filter_dims.x; wR = wR + 1) {\n              if (wR % uniforms.dilations.x != 0) {\n                continue;\n              }\n              let dyR = (").concat(a,"(dyRCorner) + ").concat(a,"(wR)) / ").concat(a,"(uniforms.strides[0]);\n              let wRPerm = uniforms.filter_dims.x - 1 - wR / uniforms.dilations.x;\n              if (dyR < 0.0 || dyR >= ").concat(a,"(uniforms.Dy_shape[").concat(s,"]) || fract(dyR) > 0.0 ||\n                  wRPerm < 0) {\n                continue;\n              }\n              let idyR: u32 = u32(dyR);\n              var wC: u32 = 0;\n              if (uniforms.dilations.y == 1) {\n                // Minimum wC >= 0 that satisfies (dyCCorner + wC) % (uniforms.strides.y) == 0\n                wC = u32(((dyCCorner + i32(uniforms.strides.y) - 1) / i32(uniforms.strides.y)) * i32(uniforms.strides.y) - dyCCorner);\n              }\n              for (; wC < uniforms.effective_filter_dims.y; wC = wC + 1) {\n                if (wC % uniforms.dilations.y != 0) {\n                  continue;\n                }\n                let dyC = (").concat(a,"(dyCCorner) + ").concat(a,"(wC)) / ").concat(a,"(uniforms.strides.y);\n                let wCPerm = uniforms.filter_dims.y - 1 - wC / uniforms.dilations.y;\n                if (dyC < 0.0 || dyC >= ").concat(a,"(uniforms.Dy_shape[").concat(c,"]) ||\n                    fract(dyC) > 0.0 || wCPerm < 0) {\n                  continue;\n                }\n                let idyC: u32 = u32(dyC);\n                var inputChannel = groupId * uniforms.input_channels_per_group;\n                ").concat(d?"\n                var x_offset = ".concat(g.indicesToOffset("".concat(g.type.indices,"(batch, idyR, idyC, inputChannel)"))," / ").concat(u,";\n                var w_offset = ").concat(h.indicesToOffset("".concat(h.type.indices,"(wRPerm, wCPerm, inputChannel, wOutChannel)"))," / ").concat(m,";\n                  "):"","\n                for (var d2: u32 = 0; d2 < uniforms.input_channels_per_group_int; d2 = d2 + ").concat(d?4:u,") {\n                  ").concat((()=>{let e="";if(d)4===u?e+="\n        let xValue = ".concat(g.getByOffset("x_offset"),";\n        let wValue = ").concat(h.getByOffset("w_offset"),";\n        dotProd = dotProd + dot(xValue, wValue);\n        x_offset += 1u;\n        w_offset += 1u;"):2===u?e+="\n          dotProd = dotProd + dot(vec4<".concat(a,">(").concat(g.getByOffset("x_offset"),", ").concat(g.getByOffset("x_offset + 1u"),"), vec4<").concat(a,">(").concat(h.getByOffset("w_offset"),", ").concat(h.getByOffset("w_offset + 1u"),"));\n          x_offset += 2u;\n          w_offset += 2u;"):1===u&&(e+="\n          dotProd = dotProd + dot(vec4<".concat(a,">(").concat(g.getByOffset("x_offset"),", ").concat(g.getByOffset("x_offset + 1u"),", ").concat(g.getByOffset("x_offset + 2u"),", ").concat(g.getByOffset("x_offset + 3u"),"), vec4<").concat(a,">(").concat(h.getByOffset("w_offset"),", ").concat(h.getByOffset("w_offset + 1u"),", ").concat(h.getByOffset("w_offset + 2u"),", ").concat(h.getByOffset("w_offset + 3u"),"));\n          x_offset += 4u;\n          w_offset += 4u;"));else if(e+="\n                  let xValue = ".concat(o?g.getByOffset("".concat(g.indicesToOffset("".concat(g.type.indices,"(batch, idyR, idyC, inputChannel)"))," / ").concat(u)):g.get("batch","inputChannel","idyR","idyC"),";\n        "),1===u)e+="\n          let w_offset = ".concat(h.indicesToOffset("".concat(h.type.indices,"(u32(wRPerm), u32(wCPerm), inputChannel, wOutChannel)")),";\n          let wValue = ").concat(h.getByOffset("w_offset / ".concat(m)),";\n          dotProd = dotProd + xValue * wValue;");else for(let t=0;t<u;t++)e+="\n            let wValue".concat(t," = ").concat(h.getByOffset("".concat(h.indicesToOffset("".concat(h.type.indices,"(u32(wRPerm), u32(wCPerm), inputChannel + ").concat(t,", wOutChannel)"))," / ").concat(m)),";\n            dotProd = dotProd + xValue[").concat(t,"] * wValue").concat(t,";");return e})(),"\n                  inputChannel = inputChannel + ").concat(d?4:u,";\n                }\n                ").concat((()=>{if(0===f)return"";if(!d)throw new Error("packInputAs4 ".concat(d," is not true."));let e="";if(1===u){e+="dotProd = dotProd";for(let t=0;t<f;t++)e+="\n            + ".concat(g.getByOffset("x_offset + ".concat(t))," * ").concat(h.getByOffset("w_offset + ".concat(t)));e+=";"}else if(2===u){if(2!==f)throw new Error("Invalid inputChannelsRemainder ".concat(f,"."));e+="\n          let xValue = ".concat(g.getByOffset("x_offset"),";\n          let wValue = ").concat(h.getByOffset("w_offset"),";\n          dotProd = dotProd + dot(xValue, wValue);")}return e})(),"\n                wC = wC + uniforms.strides.y - 1;\n              }\n              wR = wR + uniforms.strides[0] - 1;\n            }\n            let value = dotProd").concat(i?" + bias[d1 / ".concat(p,"]"):"",";\n            ").concat(v.setByOffset("global_idx","value"),";\n          ");return"\n    ".concat(t.registerUniforms(n).declareVariables(...y,v),"\n      ").concat(t.mainStart(),"\n      ").concat(t.guardAgainstOutOfBoundsWorkgroupSizes("uniforms.output_size"),";\n    ").concat(b,"}")}}}}),nu=re(()=>{tu(),Gl(),zl(),Zo=(e,t,n,i,r,o)=>(e-1)*t+n+(i-1)*r+1-o,Qo=(e,t,n,i,r)=>{let o=Math.floor(e/2);"SAME_UPPER"===t?(n[i]=o,n[r]=e-o):"SAME_LOWER"===t&&(n[i]=e-o,n[r]=o)},Xo=(e,t,n,i,r,o,a,s,c,l)=>{let u=e.length-2,d=0===l.length;c.length<u&&c.push(...Array(u-c.length).fill(0));let h=e[0],f=t[s?3:1]*r;for(let p=0,m=e.length-u-(s?1:0);p<u;++p,++m){let r=e[m],s=d?r*a[p]:l[p],h=Zo(r,a[p],o[p],t[m],n[p],s);Qo(h,i,o,p,p+u),d&&l.push(a[p]*(r-1)+c[p]+(t[m]-1)*n[p]+1-o[p]-o[p+u])}l.splice(0,0,h),l.splice(s?3:1,0,f)},Yo=(e,t)=>{let n=e.kernelShape.slice();if(0===e.kernelShape.length||0===e.kernelShape.reduce((e,t)=>e*t,1)){n.length=0;for(let e=2;e<t[1].dims.length;++e)n.push(t[1].dims[e])}let i="NHWC"===e.format;n.splice(0,0,t[1].dims[0]),n.splice(i?3:1,0,t[1].dims[1]);let r=e.pads.slice(),o=e.outputShape.slice(),a=e.outputPadding.slice(),s=t[0].dims,c=e.dilations.slice();if(0===c.reduce((e,t)=>e+t,0)){let e=t[0].dims.length-2;c=new Array(e).fill(1)}let l=e.strides.slice();if(0===l.reduce((e,t)=>e+t,0)){let e=t[0].dims.length-2;l=new Array(e).fill(1)}Xo(s,n,c,e.autoPad,e.group,r,l,i,a,o);let u=Object.assign({},e);return Object.assign(u,{kernelShape:n,pads:r,outputPadding:a,outputShape:o,dilations:c,strides:l}),u},Jo=e=>{let t=ho(e),n=e.format,i=["NOTSET","VALID","SAME_UPPER","SAME_LOWER"][typeof e.autoPad>"u"?0:e.autoPad],r=e.dilations,o=e.group,a=e.kernelShape,c=e.pads,l=e.strides,u=e.wIsConst();return s(s({autoPad:i,format:n,dilations:r,group:o,kernelShape:a,outputPadding:e.outputPadding,outputShape:e.outputShape,pads:c,strides:l,wIsConst:u},t),{},{cacheKey:"".concat(e.format,";").concat(t.activation,";")})},$o=(e,t)=>{if(!e||2!==e.length&&3!==e.length)throw new Error("Conv requires 2 or 3 inputs");if(4!==e[0].dims.length&&3!==e[0].dims.length)throw new Error("currently only support 2-dimensional conv");if(e[0].dims.length!==e[1].dims.length)throw new Error("filter does not have same dimension as input");if(e[0].dims["NHWC"===t.format?e[0].dims.length-1:1]!==e[1].dims[0])throw new Error("FILTER_IN_CHANNEL should be equal to DATA_CHANNEL");let n=e[1].dims[1]*t.group;if(3===e.length&&(1!==e[2].dims.length||e[2].dims[0]!==n))throw new Error("invalid bias");let i=e[0].dims.length-2;if(t.dilations.reduce((e,t)=>e+t,0)>0&&t.dilations.length!==i)throw new Error("dilations should be ".concat(i,"D"));if(t.strides.reduce((e,t)=>e+t,0)>0&&t.strides.length!==i)throw new Error("strides should be ".concat(i,"D"));if(t.pads.reduce((e,t)=>e+t,0)>0&&t.pads.length!==2*i)throw new Error("pads should be ".concat(2*i,"D"));if(t.outputPadding.length!==i&&0!==t.outputPadding.length)throw new Error("output_padding should be ".concat(i,"D"));if(t.kernelShape.reduce((e,t)=>e+t,0)>0&&0!==t.kernelShape.length&&t.kernelShape.length!==e[1].dims.length-2)throw new Error("invalid kernel shape");if(0!==t.outputShape.length&&t.outputShape.length!==e[0].dims.length-2)throw new Error("invalid output shape")},ea=(e,t,n,i)=>{var r;let o=null!==(r=e.kernelCustomData.wT)&&void 0!==r?r:e.compute(Ln(t[1],[2,3,0,1]),{inputs:[1],outputs:[n.wIsConst?-2:-1]})[0];n.wIsConst&&!e.kernelCustomData.wT&&(e.kernelCustomData.wT=o);let a=[t[0],o];3===t.length&&a.push(t[2]),e.compute(Ko(a,n,i),{inputs:a})},ta=(e,t)=>{let n="NHWC"===t.format,i=[e.inputs[0].reshape(n?[e.inputs[0].dims[0],1,e.inputs[0].dims[1],e.inputs[0].dims[2]]:[e.inputs[0].dims[0],e.inputs[0].dims[1],1,e.inputs[0].dims[2]]),e.inputs[1].reshape([e.inputs[1].dims[0],e.inputs[1].dims[1],1,e.inputs[1].dims[2]])];3===e.inputs.length&&i.push(e.inputs[2]);let r=t.kernelShape;(0===r.length||0===r[0])&&(r=[e.inputs[1].dims[2]]);let o=t.dilations;(0===o.length||0===o[0])&&(o=[1]);let a=t.strides;(0===a.length||0===a[0])&&(a=[1]);let c=t.pads;0===c.length&&(c=[0,0]),c=[0,c[0],0,c[1]],a=[1].concat(a),o=[1].concat(o),r=[1].concat(r);let l=t.outputPadding;l=[0].concat(l);let u=Yo(s(s({},t),{},{pads:c,strides:a,dilations:o,kernelShape:r,outputPadding:l}),i);ea(e,i,u,e=>n?[e[0],e[2],e[3]]:[e[0],e[1],e[3]])},na=(e,t)=>{if($o(e.inputs,t),3===e.inputs[0].dims.length)ta(e,t);else{let n=Yo(t,e.inputs);ea(e,e.inputs,n)}}}),iu=re(()=>{El(),Cl(),Rl(),Ll(),ia=(e,t,n,i)=>{let r=Rt.size(t),o=t.length,a=xn("input",e,o),s=Sn("output",e,o),c=6===n.dataType?n.getInt32Array()[0]:Number(n.getBigInt64Array()[0]),l=Rt.normalizeAxis(c,o);return{name:"CumSum",shaderCache:{hint:i.cacheKey,inputDependencies:["rank"]},getRunData:()=>({outputs:[{dims:t,dataType:e}],dispatchGroup:{x:Math.ceil(r/64)},programUniforms:[{type:12,data:r},{type:12,data:l},...mn(t,t)]}),getShaderSource:e=>{let t=" i32(".concat(a.indicesGet("inputIndices","uniforms.axis"),") "),n=wn("uniforms.input_shape","uniforms.axis",o),r=i.reverse?t+(i.exclusive?" + 1":""):"0",c=i.reverse?n:t+(i.exclusive?"":" + 1");return"\n                ".concat(e.registerUniform("outputSize","u32").registerUniform("axis","u32").declareVariables(a,s),"\n                ").concat(e.mainStart(),"\n                  ").concat(e.guardAgainstOutOfBoundsWorkgroupSizes("uniforms.outputSize"),"\n                  var inputIndices = ").concat(s.offsetToIndices("global_idx"),";\n                  var sum = ").concat(s.type.value,"(0);\n                  let first : i32 = ").concat(r,";\n                  let last : i32 = ").concat(c,";\n                  for (var i : i32 = first; i < last; i++) {\n                    ").concat(a.indicesSet("inputIndices","uniforms.axis","u32(i)"),";\n                    sum = sum + ").concat(a.getByIndices("inputIndices"),";\n                  }\n                  ").concat(s.setByOffset("global_idx","sum"),";\n                }")}}},ra=(e,t)=>{let n=e.inputs[0].dims,i=e.inputs[0].dataType,r=e.inputs[1];e.compute(ia(i,n,r,t),{inputs:[0]})},oa=e=>{let t=1===e.exclusive,n=1===e.reverse;return un({exclusive:t,reverse:n})}}),ru=re(()=>{El(),Cl(),Rl(),Ll(),aa=e=>{if(!e||1!==e.length)throw new Error("DepthToSpace requires 1 input.");if(4!==e[0].dims.length)throw new Error("DepthToSpace requires 4D input.")},sa=(e,t,n,i)=>{let r=[];r.push("fn perm(i: ".concat(i.type.indices,") -> ").concat(n.type.indices," {\n    var a: ").concat(n.type.indices,";"));for(let o=0;o<t;++o)r.push(n.indicesSet("a",e[o],"i[".concat(o,"]")));return r.push("return a;}"),r.join("\n")},ca=(e,t)=>{let n,i,r,o,a,s,c="NHWC"===t.format,l=t.blocksize,u="DCR"===t.mode;c?([n,i,r,o]=e.dims,a=u?[n,i,r,l,l,o/l**2]:[n,i,r,o/l**2,l,l],s=u?[0,1,3,2,4,5]:[0,1,4,2,5,3]):([n,i,r,o]=[e.dims[0],e.dims[2],e.dims[3],e.dims[1]],a=u?[n,l,l,o/l**2,i,r]:[n,o/l**2,l,l,i,r],s=u?[0,3,4,1,5,2]:[0,1,4,2,5,3]);let d=e.reshape(a),h=d.dims.length,f=e.dataType,p=xn("a",f,h),m=Sn("output",f,h);return{name:"DepthToSpace",shaderCache:{hint:"".concat(e.dims,";").concat(t.blocksize,";").concat(t.mode),inputDependencies:["rank"]},getRunData:e=>{let t=c?[n,i*l,r*l,o/l**2]:[n,o/l**2,i*l,r*l],a=Rt.size(t),u=d.dims,h=Rt.sortBasedOnPerm(u,s);return{outputs:[{dims:t,dataType:e[0].dataType}],dispatchGroup:{x:Math.ceil(a/64)},programUniforms:[{type:12,data:a},...mn(u,h)]}},getShaderSource:e=>"\n  ".concat(e.registerUniform("output_size","u32").declareVariables(p,m),"\n\n  ").concat(sa(s,h,p,m),"\n\n  ").concat(e.mainStart(),"\n    ").concat(e.guardAgainstOutOfBoundsWorkgroupSizes("uniforms.output_size"),"\n\n    let indices = ").concat(m.offsetToIndices("global_idx"),";\n    let aIndices = perm(indices);\n\n    ").concat(m.setByOffset("global_idx",p.getByIndices("aIndices")),"\n  }")}},la=(e,t)=>{aa(e.inputs),e.compute(ca(e.inputs[0],t))},ua=e=>un({blocksize:e.blocksize,mode:e.mode,format:e.format})}),ou=re(()=>{El(),Cl(),Rl(),Ll(),fa="^"+(ha="("+(da="[a-zA-Z]|\\.\\.\\.")+")+")+"$",pa="^"+("("+ha+",)*"+ha)+"$",ma=class{constructor(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:-1;this.symbolToIndices=new Map,this.inputIndex=e}addSymbol(e,t){let n=this.symbolToIndices.get(e);void 0===n?n=[t]:n.push(t),this.symbolToIndices.set(e,n)}},ga=class{constructor(e,t){var n;this.equation=t,this.hasEllipsis=!1,this.symbolToInfo=new Map,this.lhs=new Array,this.outputDims=[];let[i,r]=t.includes("->")?t.split("->",2):[t,""];if(!i.match(RegExp(pa)))throw new Error("Invalid LHS term");if(i.split(",").forEach((t,n)=>{let i=e[n].dims.slice();if(!t.match(RegExp(fa)))throw new Error("Invalid LHS term");let r=this.processTerm(t,!0,i,n);this.lhs.push(r)}),""===r)r+=[...this.symbolToInfo.entries()].filter(e=>{let[t,n]=e;return 1===n.count||"..."===t}).map(e=>{let[t]=e;return t}).join("");else if(!r.match(RegExp(ha)))throw new Error("Invalid RHS");null!==(n=r.match(RegExp(da,"g")))&&void 0!==n&&n.forEach(e=>{if("..."===e)this.outputDims=this.outputDims.concat(this.ellipsisDims);else{let t=this.symbolToInfo.get(e);if(void 0===t)throw new Error("Invalid RHS symbol");this.outputDims.push(t.dimValue)}}),this.rhs=this.processTerm(r,!1,this.outputDims)}addSymbol(e,t,n){let i=this.symbolToInfo.get(e);if(void 0!==i){if(i.dimValue!==t&&1!==i.count)throw new Error("Dimension mismatch");i.count++,i.inputIndices.push(n)}else i={count:1,dimValue:t,inputIndices:[n]};this.symbolToInfo.set(e,i)}processTerm(e,t,n){let i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:-1,r=n.length,o=!1,a=[],s=0;if(!e.match(RegExp(fa))&&!t&&""!==e)throw new Error("Invalid LHS term");let c=e.match(RegExp(da,"g")),l=new ma(i);return null!==c&&void 0!==c&&c.forEach((e,u)=>{if("..."===e){if(o)throw new Error("Only one ellipsis is allowed per input term");o=!0;let e=r-c.length+1;if(e<0)throw new Error("Ellipsis out of bounds");if(a=n.slice(s,s+e),this.hasEllipsis){if(this.ellipsisDims.length!==a.length||this.ellipsisDims.toString()!==a.toString())throw new Error("Ellipsis dimensions mismatch")}else{if(!t)throw new Error("Ellipsis must be specified in the LHS");this.hasEllipsis=!0,this.ellipsisDims=a}for(let t=0;t<a.length;t++){let e=String.fromCharCode(48+t);l.addSymbol(e,u+t),this.addSymbol(e,n[s++],i)}}else l.addSymbol(e,u+(this.hasEllipsis?this.ellipsisDims.length-1:0)),this.addSymbol(e,n[s++],i)}),l}},ya=e=>e+"_max",va=(e,t,n,i)=>{let r=e.map(e=>e.length).map((e,n)=>xn("input".concat(n),t,e)),o=Rt.size(i),a=Sn("output",t,i.length),s=[...n.symbolToInfo.keys()].filter(e=>!n.rhs.symbolToIndices.has(e));return{name:"Einsum",shaderCache:{hint:n.equation,inputDependencies:e.map(()=>"rank")},getRunData:()=>{let r=s.filter(e=>n.symbolToInfo.has(e)).map(e=>{var t;return{type:12,data:(null===(t=n.symbolToInfo.get(e))||void 0===t?void 0:t.dimValue)||0}});r.push({type:12,data:o});let a=e.map((e,t)=>[...mn(e)]).reduce((e,t)=>e.concat(t),r);return a.push(...mn(i)),{outputs:[{dims:i,dataType:t}],dispatchGroup:{x:Math.ceil(o/64)},programUniforms:a}},getShaderSource:e=>{let t=[],i=[],o=[],c=[],l=[],u=n.symbolToInfo.size===n.rhs.symbolToIndices.size;n.symbolToInfo.forEach((e,s)=>{if(n.rhs.symbolToIndices.has(s)){var u;let i=null===(u=n.rhs.symbolToIndices.get(s))||void 0===u?void 0:u[0];void 0!==i&&n.lhs.forEach((n,o)=>{if(e.inputIndices.includes(o)){let e=n.symbolToIndices.get(s);if(void 0===e)throw new Error("Invalid symbol error");e.forEach(e=>{t.push("".concat(r[o].indicesSet("input".concat(o,"Indices"),e,a.indicesGet("outputIndices",i))))})}})}else n.lhs.forEach((t,n)=>{if(e.inputIndices.includes(n)){let e=t.symbolToIndices.get(s);if(void 0===e)throw new Error("Invalid symbol error");e.forEach(e=>{i.push("".concat(r[n].indicesSet("input".concat(n,"Indices"),e,"".concat(s))))}),l.push("prod *= ".concat(r[n].getByIndices("input".concat(n,"Indices")),";"))}}),o.push("for(var ".concat(s,": u32 = 0; ").concat(s," < uniforms.").concat(ya(s),"; ").concat(s,"++) {")),c.push("}")});let d=u?[...t,"let sum = ".concat(r.map((e,t)=>e.getByIndices("input".concat(t,"Indices"))).join(" * "),";")]:[...t,"var sum = 0.0;",...o,...i,"var prod = 1.0;",...l,"sum += prod;",...c];return"\n            ".concat(e.registerUniforms(s.map(e=>({name:"".concat(ya(e)),type:"u32"}))).registerUniform("outputSize","u32").declareVariables(...r,a),"\n\n            ").concat(e.mainStart(),"\n            ").concat(e.guardAgainstOutOfBoundsWorkgroupSizes("uniforms.outputSize"),"\n            var outputIndices = ").concat(a.offsetToIndices("global_idx"),";\n            ").concat(r.map((e,t)=>"var input".concat(t,"Indices: ").concat(r[t].type.indices,";")).join("\n"),"\n            ").concat(d.join("\n"),";\n            ").concat(a.setByOffset("global_idx","sum"),";\n          }")}}},_a=(e,t)=>{let n=new ga(e.inputs,t.equation),i=n.outputDims,r=e.inputs.map((e,t)=>e.dims);e.compute(va(r,e.inputs[0].dataType,n,i))},wa=e=>{let t=e.equation.replace(/\s+/g,"");return un({equation:t})}}),au=re(()=>{El(),Cl(),Ll(),ba=e=>{if(!e||2!==e.length)throw new Error("Expand requires 2 input.");let t=e[0].dims,n=Array.from(e[1].getBigInt64Array(),Number),i=n.length<t.length?0:n.length-t.length,r=t.length<n.length?0:t.length-n.length;for(;i<n.length&&r<t.length;++i,++r)if(n[i]!==t[r]&&1!==n[i]&&1!==t[r])throw new Error("Expand requires shape to be broadcastable to input")},xa=(e,t)=>{let n=e.length-t.length,i=[];for(let r=0;r<n;++r)i.push(e[r]);for(let r=0;r<t.length;++r)i.push(1===t[r]?e[r+n]:t[r]);return i},Sa=(e,t)=>e.length>t.length?xa(e,t):xa(t,e),Ea=e=>{let t=e[0].dims,n=Array.from(e[1].getBigInt64Array(),Number),i=Sa(t,n),r=e[0].dataType,o=9===r||1===Rt.size(t),a=9===r||t.length>0&&t[t.length-1]%4===0?4:1,s=o||i.length>0&&i[i.length-1]%4===0?4:1,c=Math.ceil(Rt.size(i)/s),l=[{type:12,data:c},...mn(t,i)];return{name:"Expand",shaderCache:{hint:"".concat(i.length,";").concat(a).concat(s),inputDependencies:["rank"]},getShaderSource:e=>{let n,o=xn("input",r,t.length,a),c=Sn("output",r,i.length,s);if(9===r){let e=function(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"";return"\n          let outputIndices".concat(t," = ").concat(c.offsetToIndices("outputOffset + ".concat(t,"u")),";\n          let offset").concat(t," = ").concat(o.broadcastedIndicesToOffset("outputIndices".concat(t),c),";\n          let index").concat(t," = offset").concat(t," / 4u;\n          let component").concat(t," = offset").concat(t," % 4u;\n          ").concat(e,"[").concat(t,"] = ").concat(n,"(").concat(o.getByOffset("index".concat(t)),"[component").concat(t,"]);\n        ")};n="\n        let outputOffset = global_idx * ".concat(s,";\n        var data = vec4<u32>(0);\n        ").concat(e("data",0,"u32"),"\n        ").concat(e("data",1,"u32"),"\n        ").concat(e("data",2,"u32"),"\n        ").concat(e("data",3,"u32"),"\n        ").concat(c.setByOffset("global_idx","data"),"\n      }")}else n="\n        let outputIndices = ".concat(c.offsetToIndices("global_idx * ".concat(s)),";\n        let inputOffset = ").concat(o.broadcastedIndicesToOffset("outputIndices",c),";\n        let data = ").concat(c.type.value,"(").concat(o.getByOffset("inputOffset / ".concat(a)),");\n        ").concat(c.setByOffset("global_idx","data"),"\n      }");return"\n    ".concat(e.registerUniform("vec_size","u32").declareVariables(o,c),"\n    ").concat(e.mainStart(),"\n    ").concat(e.guardAgainstOutOfBoundsWorkgroupSizes("uniforms.vec_size"),"\n    ").concat(n)},getRunData:()=>({outputs:[{dims:i,dataType:e[0].dataType}],dispatchGroup:{x:Math.ceil(c/64)},programUniforms:l})}},Ta=e=>{ba(e.inputs),e.compute(Ea(e.inputs),{inputs:[0]})}}),su=re(()=>{El(),Cl(),Ll(),Vl(),ka=e=>{let t=e[0].dataType,n=Rt.size(e[0].dims),i=Rt.size(e[1].dims),r=i%4===0;return{name:"FastGeluWithBias",shaderCache:{hint:"".concat(r),inputDependencies:["type","type"]},getShaderSource:e=>{let n=xn("x",t,[1],4),i=xn("bias",t,[1],4),o=Sn("y",t,[1],4),a=e=>"\n      let bias".concat(e,"_offset: u32 = (global_idx * 4 + ").concat(e,") % uniforms.bias_size;\n      let bias").concat(e," = ").concat(i.getByOffset("bias".concat(e,"_offset / 4")),"[bias").concat(e,"_offset % 4];"),s=r?"\n      let bias = ".concat(i.getByOffset("global_idx % (uniforms.bias_size / 4)"),";"):"".concat(a(0)).concat(a(1)).concat(a(2)).concat(a(3),"\n      let bias = ").concat(n.type.value,"(bias0, bias1, bias2, bias3);");return"".concat(e.registerUniforms([{name:"output_vec_size",type:"u32"},{name:"bias_size",type:"u32"}]).declareVariables(n,i,o),"\n\n    ").concat(Pr(pn(t)),"\n\n    ").concat(e.mainStart(dn),"\n      ").concat(e.guardAgainstOutOfBoundsWorkgroupSizes("uniforms.output_vec_size"),"\n\n      let x = ").concat(n.getByOffset("global_idx"),";\n      ").concat(s,"\n      let x_in = x + bias;\n      ").concat(o.setByOffset("global_idx",Rr("x_in")),"\n    }")},getRunData:e=>({outputs:[{dims:e[0].dims,dataType:e[0].dataType}],programUniforms:[{type:12,data:Math.ceil(n/4)},{type:12,data:i}],dispatchGroup:{x:Math.ceil(n/dn/4)}})}},Ca=e=>{e.inputs.length<2||0===Rt.size(e.inputs[1].dims)?Lr(e):e.compute(ka(e.inputs))}}),cu=re(()=>{El(),Cl(),Rl(),Ll(),Ia=e=>{if(!e||2!==e.length)throw new Error("Gather requires 2 inputs.")},Aa=(e,t)=>{let n=e[0].dims,i=e[1].dims,r=n.length,o=Rt.normalizeAxis(t.axis,r),a=n.slice(0);a.splice(o,1,...i);let s=n[o],c=9===e[0].dataType?4:1,l=Math.ceil(Rt.size(a)/c),u=[{type:12,data:l},{type:6,data:s},{type:12,data:o},...mn(e[0].dims,e[1].dims,a)];return{name:"Gather",shaderCache:{hint:t.cacheKey,inputDependencies:["rank","rank"]},getRunData:()=>({outputs:[{dims:a,dataType:e[0].dataType}],dispatchGroup:{x:Math.ceil(l/64)},programUniforms:u}),getShaderSource:t=>{let n,s=xn("data",e[0].dataType,e[0].dims.length,c),l=xn("inputIndices",e[1].dataType,e[1].dims.length),u=Sn("output",e[0].dataType,a.length,c),d=e=>{let t=i.length,n="var indicesIndices".concat(e,"  = ").concat(l.type.indices,"(0);");for(let i=0;i<t;i++)n+="".concat(t>1?"indicesIndices".concat(e,"[").concat(i,"]"):"indicesIndices".concat(e)," = ").concat(a.length>1?"outputIndices".concat(e,"[uniforms.axis + ").concat(i,"]"):"outputIndices".concat(e),";");n+="\n          var idx".concat(e," = ").concat(l.getByIndices("indicesIndices".concat(e)),";\n          if (idx").concat(e," < 0) {\n            idx").concat(e," = idx").concat(e," + uniforms.axisDimLimit;\n          }\n          var dataIndices").concat(e," : ").concat(s.type.indices,";\n        ");for(let i=0,s=0;i<r;i++)i===o?(n+="".concat(r>1?"dataIndices".concat(e,"[").concat(i,"]"):"dataIndices".concat(e)," = u32(idx").concat(e,");"),s+=t):(n+="".concat(r>1?"dataIndices".concat(e,"[").concat(i,"]"):"dataIndices".concat(e)," = ").concat(a.length>1?"outputIndices".concat(e,"[").concat(s,"]"):"outputIndices".concat(e),";"),s++);return n};if(9===e[0].dataType){let e=function(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"";return"\n          let outputIndices".concat(t," = ").concat(u.offsetToIndices("outputOffset + ".concat(t,"u")),";\n          ").concat(d(t),";\n          let offset").concat(t," = ").concat(s.indicesToOffset("dataIndices".concat(t)),";\n          let index").concat(t," = offset").concat(t," / 4u;\n          let component").concat(t," = offset").concat(t," % 4u;\n          ").concat(e,"[").concat(t,"] = ").concat(n,"(").concat(s.getByOffset("index".concat(t)),"[component").concat(t,"]);\n        ")};n="\n        let outputOffset = global_idx * ".concat(c,";\n        var value = vec4<u32>(0);\n        ").concat(e("value",0,"u32"),"\n        ").concat(e("value",1,"u32"),"\n        ").concat(e("value",2,"u32"),"\n        ").concat(e("value",3,"u32"),"\n        ").concat(u.setByOffset("global_idx","value"),"\n      ")}else n="\n      let outputIndices = ".concat(u.offsetToIndices("global_idx"),";\n      ").concat(d(""),";\n      let value = ").concat(s.getByIndices("dataIndices"),";\n      ").concat(u.setByOffset("global_idx","value"),";\n      ");return"\n      ".concat(t.registerUniform("outputSize","u32").registerUniform("axisDimLimit","i32").registerUniform("axis","u32").declareVariables(s,l,u),"\n      ").concat(t.mainStart(),"\n        ").concat(t.guardAgainstOutOfBoundsWorkgroupSizes("uniforms.outputSize"),"\n        ").concat(n,"\n      }")}}},Na=e=>un({axis:e.axis}),Oa=(e,t)=>{let n=e.inputs;Ia(n),e.compute(Aa(e.inputs,t))}}),lu=re(()=>{El(),Cl(),Ll(),Pa=(e,t,n,i,r,o,a,s,c)=>{let l=[{type:12,data:o},{type:12,data:i},{type:12,data:r},{type:12,data:n},{type:12,data:a},{type:12,data:s},{type:12,data:c}],u=[o];l.push(...mn(t.dims,u));return e.compute({name:"computeSliceOffsets",shaderCache:{hint:"".concat(r.length,"_").concat(n.length),inputDependencies:["rank"]},getRunData:()=>({outputs:[{dims:u,dataType:e.inputs[1].dataType}],dispatchGroup:{x:Math.ceil(o/64)},programUniforms:l}),getShaderSource:e=>{let i=[xn("indices_data",t.dataType,t.dims.length),Sn("input_slice_offsets_data",12,1,1)],o=[{name:"output_size",type:"u32"},{name:"batch_dims",type:"u32"},{name:"input_dims",type:"u32",length:r.length},{name:"sizes_from_slice_dims_data",type:"u32",length:n.length},{name:"num_slices_per_batch",type:"u32"},{name:"input_batch_stride",type:"u32"},{name:"num_slice_dims",type:"u32"}];return"\n  ".concat(e.registerUniforms(o).declareVariables(...i),"\n  ").concat(e.mainStart(),"\n    ").concat(e.guardAgainstOutOfBoundsWorkgroupSizes("uniforms.output_size"),"\n    let batch_idx = global_idx / uniforms.num_slices_per_batch;\n    let base_offset = batch_idx * uniforms.input_batch_stride;\n\n    let slice_indices_base_offset = global_idx * uniforms.num_slice_dims;\n    var relative_slice_offset = 0;\n    for (var dim_idx = 0u; dim_idx < uniforms.num_slice_dims; dim_idx ++) {\n      var index = i32(indices_data[dim_idx + slice_indices_base_offset].x);\n      let input_dim_idx = uniforms.batch_dims + dim_idx;\n      if (index < 0) {\n        ").concat(1===r.length?"index += i32(uniforms.input_dims);":"index += i32(uniforms.input_dims[input_dim_idx]);","\n      }\n      ").concat(1===n.length?"relative_slice_offset += index * i32(uniforms.sizes_from_slice_dims_data);":"relative_slice_offset += index * i32(uniforms.sizes_from_slice_dims_data[dim_idx]);","\n    }\n\n    input_slice_offsets_data[global_idx] =  base_offset + u32(relative_slice_offset);\n  }")}},{inputs:[t],outputs:[-1]})[0]},Ra=(e,t)=>{let n=e.inputs,i=n[0].dims,r=n[0].dataType,o=n[1].dims,a=o[o.length-1],s=Rt.sizeToDimension(o,o.length-1),c=Rt.sizeFromDimension(i,t.batchDims+a),l=Rt.sizeToDimension(i,t.batchDims),u=Rt.sizeFromDimension(i,t.batchDims),d=s/l,h=new Array(a),f=c;for(let _=0;_<a;++_)h[a-1-_]=f,f*=i[t.batchDims+a-1-_];let p=Pa(e,n[1],h,t.batchDims,i,s,d,u,a),m=t.batchDims+a;if(m>i.length)throw new Error("last dimension of indices must not be larger than rank of input tensor");let g=o.slice(0,-1).concat(i.slice(m)),y=Rt.size(g),v=[{type:12,data:y},{type:12,data:c},...mn(n[0].dims,p.dims,g)];e.compute({name:"GatherND",shaderCache:{hint:t.cacheKey,inputDependencies:["rank","rank"]},getRunData:()=>({outputs:[{dims:g,dataType:r}],dispatchGroup:{x:Math.ceil(y/64)},programUniforms:v}),getShaderSource:e=>{let t=xn("data",n[0].dataType,n[0].dims.length),i=xn("slice_offsets",12,p.dims.length),r=Sn("output",n[0].dataType,g.length);return"\n          ".concat(e.registerUniform("output_size","u32").registerUniform("slice_size","u32").declareVariables(t,i,r),"\n            ").concat(e.mainStart(),"\n            ").concat(e.guardAgainstOutOfBoundsWorkgroupSizes("uniforms.output_size"),"\n          let slice_offset = slice_offsets[global_idx / uniforms.slice_size];\n          output[global_idx] = data[u32(slice_offset) + global_idx % uniforms.slice_size];\n        }")}},{inputs:[n[0],p]})},La=e=>({batchDims:e.batch_dims,cacheKey:""})}),uu=re(()=>{El(),Cl(),Rl(),Ll(),za=(e,t)=>{if(e.length<3||e.length>4)throw new Error("GatherBlockQuantized requires 3 or 4 inputs.");let n=Rt.normalizeAxis(t.quantizeAxis,e[0].dims.length),i=t.blockSize,r=e[0],o=e[2],a=4===e.length?e[3]:void 0;if(o.dims.length!==r.dims.length||!r.dims.map((e,t)=>t===n?Math.ceil(e/i)===o.dims[t]:e===o.dims[t]).reduce((e,t)=>e&&t,!0))throw new Error("Scales must have the same rank as the input tensor and the dims should match except on gatherAxis.");if(a){if(a.dataType!==r.dataType)throw new Error("Zero point must have the same data type as the input tensor.");if(a.dims.length!==o.dims.length||!a.dims.map((e,t)=>e===o.dims[t]).reduce((e,t)=>e&&t,!0))throw new Error("Zero point must have the same rank as the input tensor and the dims should match except on quantizeAxis.")}},Ma=(e,t)=>{let n=e[0].dims,i=e[1].dims,r=n.length,o=Rt.normalizeAxis(t.gatherAxis,r),a=Rt.normalizeAxis(t.quantizeAxis,r),s=n.slice(0);s.splice(o,1,...i);let c=Rt.size(s),l=e[2].dataType,u=22===e[0].dataType,d=[{type:12,data:c},{type:12,data:a},{type:12,data:o},{type:12,data:t.blockSize},...mn(...e.map((e,t)=>e.dims),s)];return{name:"GatherBlockQuantized",shaderCache:{hint:"".concat(t.cacheKey,";").concat(e.filter((e,t)=>1!==t).map(e=>e.dims.join("_")).join(";")),inputDependencies:Array.from({length:e.length},(e,t)=>"rank")},getRunData:()=>({outputs:[{dims:s,dataType:l}],dispatchGroup:{x:Math.ceil(c/64)},programUniforms:d}),getShaderSource:t=>{let r=xn("data",e[0].dataType,e[0].dims.length),a=xn("inputIndices",e[1].dataType,e[1].dims.length),c=xn("scales",e[2].dataType,e[2].dims.length),d=e.length>3?xn("zeroPoint",e[3].dataType,e[3].dims.length):void 0,h=Sn("output",l,s.length),f=[r,a,c];d&&f.push(d);return"\n        ".concat(t.registerUniforms([{name:"output_size",type:"u32"},{name:"quantize_axis",type:"u32"},{name:"gather_axis",type:"u32"},{name:"block_size",type:"u32"}]).declareVariables(...f,h),"\n        ").concat(t.mainStart(),"\n        let output_indices = ").concat(h.offsetToIndices("global_idx"),";\n        var indices_indices = ").concat(a.type.indices,"(0);\n        ").concat(i.length>1?"\n          for (var i: u32 = 0; i < ".concat(i.length,"; i++) {\n            let index = ").concat(h.indicesGet("output_indices","uniforms.gather_axis + i"),";\n            ").concat(a.indicesSet("indices_indices","i","index"),";\n          }"):"indices_indices = ".concat(h.indicesGet("output_indices","uniforms.gather_axis"),";"),";\n        var data_indices = ").concat(r.type.indices,"(0);\n        for (var i: u32 = 0; i < uniforms.gather_axis; i++) {\n          let index = ").concat(h.indicesGet("output_indices","i"),";\n          ").concat(r.indicesSet("data_indices","i","index"),";\n        }\n        var index_from_indices = ").concat(a.getByIndices("indices_indices"),";\n        if (index_from_indices < 0) {\n          index_from_indices += ").concat(n[o],";\n        }\n        ").concat(r.indicesSet("data_indices","uniforms.gather_axis","u32(index_from_indices)"),";\n        for (var i = uniforms.gather_axis + 1; i < ").concat(s.length,"; i++) {\n          let index = ").concat(h.indicesGet("output_indices","i + ".concat(i.length," - 1")),";\n          ").concat(r.indicesSet("data_indices","i","index"),";\n        }\n        let data_offset = ").concat(r.indicesToOffset("data_indices"),";\n        let data_index = data_offset % 8;\n        // Convert 4-bit packed data to 8-bit packed data.\n        let packed_4bit_quantized_data = ").concat(r.getByOffset("data_offset / 8"),";\n        let packed_8bit_quantized_data = (packed_4bit_quantized_data >> (4 * (data_index % 2))) & 0x0f0f0f0f;\n        let quantized_data_vec = ").concat(u?"unpack4xI8":"unpack4xU8","(u32(packed_8bit_quantized_data));\n        let quantized_data = quantized_data_vec[data_index / 2];\n        var scale_indices = data_indices;\n        let quantize_axis_index = ").concat(c.indicesGet("data_indices","uniforms.quantize_axis")," / uniforms.block_size;\n        ").concat(c.indicesSet("scale_indices","uniforms.quantize_axis","quantize_axis_index"),";\n        var scale = ").concat(c.getByIndices("scale_indices"),";\n        ").concat(d?"\n              let zero_point_indices = scale_indices;\n              let zero_point_offset = ".concat(d.indicesToOffset("zero_point_indices"),";\n              let zero_point_index = zero_point_offset % 8;\n              let packed_4bit_zero_points = ").concat(d.getByOffset("zero_point_offset / 8"),";\n              let packed_8bit_zero_points = (packed_4bit_zero_points >> (4 * (zero_point_index % 2))) & 0x0f0f0f0f;\n              let zero_point_vec = ").concat(u?"unpack4xI8":"unpack4xU8","(u32(packed_8bit_zero_points));\n              let zero_point = zero_point_vec[zero_point_index / 2];"):"var zero_point = 0",";\n        let dequantized_data = ").concat(pn(l),"(quantized_data - zero_point) * scale;\n        ").concat(h.setByOffset("global_idx","dequantized_data"),";\n    }")}}},Da=(e,t)=>{let n=e.inputs;za(n,t),e.compute(Ma(e.inputs,t))},Ba=e=>un({blockSize:e.blockSize,gatherAxis:e.gatherAxis,quantizeAxis:e.quantizeAxis})}),du=re(()=>{El(),Cl(),Rl(),Ll(),Ua=e=>{if(!e||2!==e.length)throw new Error("GatherElements requires 2 inputs.");if(e[0].dims.length<1)throw new Error("GatherElements requires that the data input be rank >= 1.");if(e[0].dims.length!==e[1].dims.length)throw new Error("GatherElements requires that the data input and\n                     indices input tensors be of same rank.")},Fa=(e,t)=>{let n=e[0].dims,i=e[0].dataType,r=n.length,o=e[1].dims,a=e[1].dataType,s=Rt.normalizeAxis(t.axis,r),c=n[s],l=o.slice(0),u=Rt.size(l),d=xn("input",i,r),h=xn("indicesInput",a,o.length),f=Sn("output",i,l.length),p=[{type:12,data:u},{type:6,data:c},{type:12,data:s}];return p.push(...mn(n,o,l)),{name:"GatherElements",shaderCache:{inputDependencies:["rank","rank"]},getRunData:()=>({outputs:[{dims:l,dataType:e[0].dataType}],dispatchGroup:{x:Math.ceil(u/64)},programUniforms:p}),getShaderSource:e=>"\n      ".concat(e.registerUniform("outputSize","u32").registerUniform("axisDimLimit","i32").registerUniform("axis","u32").declareVariables(d,h,f),"\n      ").concat(e.mainStart(),"\n      ").concat(e.guardAgainstOutOfBoundsWorkgroupSizes("uniforms.outputSize"),"\n\n      let outputIndices = ").concat(f.offsetToIndices("global_idx"),";\n\n      var idx = ").concat(h.getByOffset("global_idx"),";\n      if (idx < 0) {\n        idx = idx + uniforms.axisDimLimit;\n      }\n      var inputIndices = ").concat(d.type.indices,"(outputIndices);\n      ").concat(d.indicesSet("inputIndices","uniforms.axis","u32(idx)"),";\n      let value = ").concat(d.getByIndices("inputIndices"),";\n\n      ").concat(f.setByOffset("global_idx","value"),";\n  }")}},ja=e=>un({axis:e.axis}),Va=(e,t)=>{let n=e.inputs;Ua(n),e.compute(Fa(e.inputs,t))}}),hu=re(()=>{El(),Cl(),Ll(),qa=e=>{if(!e)throw new Error("Input is missing");if(e.length<2||e.length>3)throw new Error("Invaid input number.");if(3===e.length&&e[2].dims.length>2)throw new Error("Invalid input shape of C");if(e[0].dataType!==e[1].dataType||3===e.length&&e[0].dataType!==e[2].dataType)throw new Error("Input types are mismatched")},Ha=(e,t)=>{let n=e[0].dims.slice(),i=e[1].dims.slice(),[r,o,a]=zt.getShapeOfGemmResult(n,t.transA,i,t.transB,3===e.length?e[2].dims:void 0),s=[r,o];if(!s)throw new Error("Can't use gemm on the given tensors");let c=16,l=Math.ceil(o/c),u=Math.ceil(r/c),d=(Rt.size(s),[{type:12,data:l},{type:12,data:r},{type:12,data:o},{type:12,data:a},{type:1,data:t.alpha},{type:1,data:t.beta}]),h=["type","type"];3===e.length&&(d.push(...mn(e[2].dims)),h.push("rank")),d.push(...mn(s));return{name:"GemmShared",shaderCache:{hint:"".concat(t.cacheKey),inputDependencies:h},getRunData:()=>({outputs:[{dims:s,dataType:e[0].dataType}],dispatchGroup:{x:l*u},programUniforms:d}),getShaderSource:n=>{let i=xn("a",e[0].dataType,e[0].dims),r=xn("b",e[1].dataType,e[1].dims),o=null,a=[i,r];3===e.length&&(o=xn("c",e[2].dataType,e[2].dims.length),a.push(o));let l=Sn("output",e[0].dataType,s.length);a.push(l);let u="",d="";t.transA&&t.transB?(d="\n      var col = tile_row_start + local_id.x;\n      var row = k_start + local_id.y;\n      if (col < uniforms.M && row < uniforms.K) {\n        tile_a[local_id.y][local_id.x] = a[row * uniforms.M + col];\n      } else {\n        tile_a[local_id.y][local_id.x] = ".concat(i.type.value,"(0);\n      }\n\n      col = k_start + local_id.x;\n      row = tile_col_start + local_id.y;\n      if (col < uniforms.K && row < uniforms.N) {\n        tile_b[local_id.y][local_id.x] = b[row * uniforms.K + col];\n      } else {\n        tile_b[local_id.y][local_id.x] = ").concat(r.type.value,"(0);\n      }\n      "),u="value += tile_a[k][local_id.y] * tile_b[local_id.x][k];"):t.transA&&!t.transB?(d="\n      var col = tile_row_start + local_id.x;\n      var row = k_start + local_id.y;\n      if (col < uniforms.M && row < uniforms.K) {\n        tile_a[local_id.y][local_id.x] = a[row * uniforms.M + col];\n      } else {\n        tile_a[local_id.y][local_id.x] = ".concat(i.type.value,"(0);\n      }\n\n      col = tile_col_start + local_id.x;\n      row = k_start + local_id.y;\n      if (col < uniforms.N && row < uniforms.K) {\n        tile_b[local_id.y][local_id.x] = b[row * uniforms.N + col];\n      } else {\n        tile_b[local_id.y][local_id.x] = ").concat(r.type.value,"(0);\n      }\n      "),u="value += tile_a[k][local_id.y] * tile_b[k][local_id.x];"):!t.transA&&t.transB?(d="\n      var col = k_start + local_id.x;\n      var row = tile_row_start + local_id.y;\n      if (col < uniforms.K && row < uniforms.M) {\n        tile_a[local_id.y][local_id.x] = a[row * uniforms.K + col];\n      } else {\n        tile_a[local_id.y][local_id.x] = ".concat(i.type.value,"(0);\n      }\n\n      col = k_start + local_id.x;\n      row = tile_col_start + local_id.y;\n      if (col < uniforms.K && row < uniforms.N) {\n        tile_b[local_id.y][local_id.x] = b[row * uniforms.K + col];\n      } else {\n        tile_b[local_id.y][local_id.x] = ").concat(r.type.value,"(0);\n      }\n      "),u="value += tile_a[local_id.y][k] * tile_b[local_id.x][k];"):!t.transA&&!t.transB&&(d="\n      var col = k_start + local_id.x;\n      var row = tile_row_start + local_id.y;\n      if (col < uniforms.K && row < uniforms.M) {\n        tile_a[local_id.y][local_id.x] = a[row * uniforms.K + col];\n      } else {\n        tile_a[local_id.y][local_id.x] = ".concat(i.type.value,"(0);\n      }\n\n      col = tile_col_start + local_id.x;\n      row = k_start + local_id.y;\n      if (col < uniforms.N && row < uniforms.K) {\n        tile_b[local_id.y][local_id.x] = b[row * uniforms.N + col];\n      } else {\n        tile_b[local_id.y][local_id.x] = ").concat(r.type.value,"(0);\n      }\n      "),u="value += tile_a[local_id.y][k] * tile_b[k][local_id.x];");let h=1===t.alpha?"":"value *= uniforms.alpha;";return"\n  ".concat(n.registerUniforms([{name:"num_tile_n",type:"u32"},{name:"M",type:"u32"},{name:"N",type:"u32"},{name:"K",type:"u32"},{name:"alpha",type:"f32"},{name:"beta",type:"f32"}]).declareVariables(...a),"\n  var<workgroup> tile_a: array<array<").concat(i.type.storage,", ").concat(c,">, ").concat(c,">;\n  var<workgroup> tile_b: array<array<").concat(r.type.storage,", ").concat(c,">, ").concat(c,">;\n  ").concat(n.mainStart([c,c,1]),"\n    let tile_col_start = (workgroup_index % uniforms.num_tile_n) * ").concat(c,";\n    let tile_row_start = (workgroup_index / uniforms.num_tile_n) * ").concat(c,";\n    let num_tiles = (uniforms.K - 1) / ").concat(c," + 1;\n    var k_start = 0u;\n    var value = ").concat(l.type.value,"(0);\n    for (var t: u32 = 0u; t < num_tiles; t++) {\n      ").concat(d,"\n      k_start = k_start + ").concat(c,";\n      workgroupBarrier();\n\n      for (var k: u32 = 0u; k < ").concat(c,"; k++) {\n        ").concat(u,"\n      }\n      workgroupBarrier();\n    }\n\n    ").concat(h,"\n    let m = tile_row_start + local_id.y;\n    let n = tile_col_start + local_id.x;\n    ").concat(null!=o?"let cOffset = ".concat(o.broadcastedIndicesToOffset("vec2(m, n)",l),"; value += ").concat(l.type.value,"(uniforms.beta) * ").concat(o.getByOffset("cOffset"),";"):"","\n    if (m < uniforms.M && n < uniforms.N) {\n      output[m * uniforms.N + n] = value;\n    }\n  }")}}},Wa=e=>({transA:e.transA,transB:e.transB,alpha:e.alpha,beta:e.beta,cacheKey:"".concat(e.transA,";").concat(e.transB,";").concat(1===e.alpha)}),Ga=(e,t)=>{qa(e.inputs),e.compute(Ha(e.inputs,t))}}),fu=re(()=>{El(),Cl(),Rl(),Ll(),[Ka,Za,Qa,Xa]=[0,1,2,3],Ya=e=>{if(4!==e[0].dims.length)throw new Error("only 4-D tensor is supported.");if(e[0].dims.length!==e[1].dims.length)throw new Error("input dimensions must be equal to grid dimensions");if(e[0].dims.length-2!==e[1].dims[e[1].dims.length-1])throw new Error("last dimension of grid must be equal to ".concat(e[0].dims.length-2));if(e[0].dims[0]!==e[1].dims[0])throw new Error("grid batch size must match input batch size")},Ja=e=>"\n  fn gs_bicubic_interpolate(p: mat4x4<".concat(e,">, x: f32, y: f32) -> ").concat(e," {\n    var v: vec4<f32>;\n    var coeffs = gs_get_cubic_coeffs(x);\n    for (var i = 0; i < 4; i++) {\n      v[i] = coeffs[0] * p[i][0] + coeffs[1] * p[i][1] + coeffs[2] * p[i][2] + coeffs[3] * p[i][3];\n    }\n    coeffs = gs_get_cubic_coeffs(y);\n    let pixel = ").concat(e,"(coeffs[0] * v[0] + coeffs[1] * v[1] + coeffs[2] * v[2] + coeffs[3] * v[3]);\n    return pixel;\n  }\n"),$a=e=>"\n  fn gs_denormalize(n: f32, length: i32) -> f32 {\n    ".concat(0===e.alignCorners?"\n    // alignCorners: false => [-1, 1] to [-0.5, length - 0.5]\n    return ((n + 1.0) * f32(length) - 1.0) / 2.0;\n    ":"\n    // alignCorners: true => [-1, 1] to [0, length - 1]\n    return (n + 1.0) / 2.0 * (f32(length - 1));\n    ","\n  }\n"),es=e=>"\n  ".concat("reflection"===e.paddingMode?"\n      fn gs_reflect(x: i32, x_min: f32, x_max: f32) -> u32 {\n        var dx = 0.0;\n        var fx = f32(x);\n        let range = x_max - x_min;\n        if (fx < x_min) {\n          dx = x_min - fx;\n          let n = u32(dx / range);\n          let r = dx - f32(n) * range;\n          if (n % 2 == 0) {\n            fx = x_min + r;\n          } else {\n            fx = x_max - r;\n          }\n        } else if (fx > x_max) {\n          dx = fx - x_max;\n          let n = u32(dx / range);\n          let r = dx - f32(n) * range;\n          if (n % 2 == 0) {\n            fx = x_max - r;\n          } else {\n            fx = x_min + r;\n          }\n        }\n        return u32(fx);\n      }":"","\n"),ts=(e,t,n)=>"\n  fn pixel_at_grid(r: i32, c: i32, H: i32, W: i32, batch: u32, channel: u32, border: vec4<f32>) -> ".concat(t," {\n     var pixel = ").concat(t,"(0);\n     var indices = vec4<u32>(0);\n     indices[").concat(Ka,"] = batch;\n     indices[").concat(Za,"] = channel;")+(()=>{switch(n.paddingMode){case"zeros":return"\n          if (r >= 0 && r < H && c >=0 && c < W) {\n            indices[".concat(Qa,"] = u32(r);\n            indices[").concat(Xa,"] = u32(c);\n          } else {\n            return ").concat(t,"(0);\n          }\n        ");case"border":return"\n          indices[".concat(Qa,"] = u32(clamp(r, 0, H - 1));\n          indices[").concat(Xa,"] = u32(clamp(c, 0, W - 1));\n        ");case"reflection":return"\n          indices[".concat(Qa,"] = gs_reflect(r, border[1], border[3]);\n          indices[").concat(Xa,"] = gs_reflect(c, border[0], border[2]);\n        ");default:throw new Error("padding mode ".concat(n.paddingMode," is not supported"))}})()+"\n    return ".concat(e.getByIndices("indices"),";\n  }\n"),ns=(e,t,n)=>(()=>{switch(n.mode){case"nearest":return"\n          let result = pixel_at_grid(i32(round(y)), i32(round(x)), H_in, W_in, indices[".concat(Ka,"], indices[").concat(Za,"], border);\n        ");case"bilinear":return"\n          let x1 = i32(floor(x));\n          let y1 = i32(floor(y));\n          let x2 = x1 + 1;\n          let y2 = y1 + 1;\n\n          let p11 = pixel_at_grid(y1, x1, H_in, W_in, indices[".concat(Ka,"], indices[").concat(Za,"], border);\n          let p12 = pixel_at_grid(y1, x2, H_in, W_in, indices[").concat(Ka,"], indices[").concat(Za,"], border);\n          let p21 = pixel_at_grid(y2, x1, H_in, W_in, indices[").concat(Ka,"], indices[").concat(Za,"], border);\n          let p22 = pixel_at_grid(y2, x2, H_in, W_in, indices[").concat(Ka,"], indices[").concat(Za,"], border);\n\n          let dx2 = ").concat(t,"(f32(x2) - x);\n          let dx1 = ").concat(t,"(x - f32(x1));\n          let dy2 = ").concat(t,"(f32(y2) - y);\n          let dy1 = ").concat(t,"(y - f32(y1));\n          let result = dy2 * (dx2 * p11 + dx1 * p12) + dy1 * (dx2 * p21 + dx1 * p22);\n        ");case"bicubic":return"\n          let x0 = i32(floor(x)) - 1;\n          let y0 = i32(floor(y)) - 1;\n          var p: mat4x4<".concat(t,">;\n          for (var h = 0; h < 4; h++) {\n            for (var w = 0; w < 4; w++) {\n              p[h][w] = pixel_at_grid(h + y0, w + x0, H_in, W_in, indices[").concat(Ka,"], indices[").concat(Za,"], border);\n            }\n          }\n\n          let dx = x - f32(x0 + 1);\n          let dy = y - f32(y0 + 1);\n          let result = gs_bicubic_interpolate(p, dx, dy);\n        ");default:throw new Error("mode ".concat(n.mode," is not supported"))}})()+"".concat(e.setByOffset("global_idx","result")),is=(e,t)=>{let n=xn("x",e[0].dataType,e[0].dims.length),i=[e[1].dims[0],e[1].dims[1],e[1].dims[2]],r=xn("grid",e[1].dataType,i.length,2),o=[e[0].dims[0],e[0].dims[1],e[1].dims[1],e[1].dims[2]];"NHWC"===t.format&&(o=[e[0].dims[0],e[1].dims[1],e[1].dims[2],e[0].dims[3]],[Ka,Za,Qa,Xa]=[0,3,1,2]);let a=Sn("output",e[0].dataType,o.length),s=n.type.value,c=[{type:12,data:Rt.size(o)},...mn(e[0].dims,i,o)];return{name:"GridSample",shaderCache:{hint:"".concat(t.cacheKey),inputDependencies:["type","type"]},getRunData:e=>{let t=Rt.size(o);return{outputs:[{dims:o,dataType:e[0].dataType}],dispatchGroup:{x:Math.ceil(t/64)},programUniforms:c}},getShaderSource:e=>"\n  ".concat(e.registerUniform("output_size","u32").declareVariables(n,r,a),"\n  ").concat("\n  fn gs_get_cubic_coeffs(x: f32) -> vec4<f32> {\n    let cubic_alpha = -0.75f;\n    let x_abs = abs(x);\n    var coeffs: vec4<f32>;\n    coeffs[0] = (((cubic_alpha * (x_abs + 1) - 5 * cubic_alpha) * (x_abs + 1) + 8 * cubic_alpha) * (x_abs + 1) - 4 * cubic_alpha);\n    coeffs[1] = (((cubic_alpha + 2) * x_abs - (cubic_alpha + 3)) * x_abs * x_abs + 1);\n    coeffs[2] = (((cubic_alpha + 2) * (1 - x_abs) - (cubic_alpha + 3)) * (1 - x_abs) * (1 - x_abs) + 1);\n    coeffs[3] = (((cubic_alpha * (2 - x_abs) - 5 * cubic_alpha) * (2 - x_abs) + 8 * cubic_alpha) * (2 - x_abs) - 4 * cubic_alpha);\n    return coeffs;\n  }\n","\n  ").concat(Ja(s),"\n  ").concat($a(t),"\n  ").concat(es(t),"\n  ").concat(ts(n,s,t),"\n\n  ").concat(e.mainStart(),"\n    ").concat(e.guardAgainstOutOfBoundsWorkgroupSizes("uniforms.output_size"),"\n      let H_in = i32(uniforms.x_shape[").concat(Qa,"]);\n      let W_in = i32(uniforms.x_shape[").concat(Xa,"]);\n\n      ").concat(0===t.alignCorners?"\n      let x_min = -0.5;\n      let x_max = f32(W_in) - 0.5;\n      let y_min = -0.5;\n      let y_max = f32(H_in) - 0.5;\n      ":"\n      let x_min = 0.0;\n      let x_max = f32(W_in) - 1.0;\n      let y_min = 0.0;\n      let y_max = f32(H_in) - 1.0;\n      ",";\n      let border = vec4<f32>(x_min, y_min, x_max, y_max);\n\n      let indices = ").concat(a.offsetToIndices("global_idx"),";\n      var grid_indices = vec3<u32>(indices[").concat(Ka,"], indices[").concat(Qa,"], indices[").concat(Xa,"]);\n      let nxy = ").concat(r.getByIndices("grid_indices"),";\n      var x = gs_denormalize(f32(nxy[0]), W_in);\n      var y = gs_denormalize(f32(nxy[1]), H_in);\n\n      ").concat(ns(a,s,t),"\n  }")}},rs=(e,t)=>{Ya(e.inputs),e.compute(is(e.inputs,t))},os=e=>un({alignCorners:e.align_corners,mode:e.mode,paddingMode:e.padding_mode,format:e.format})}),pu=re(()=>{El(),Cl(),Rl(),Ol(),Ul(),Ll(),zl(),as=(e,t)=>e.length>t&&e[t].dims.length>0?e[t]:void 0,ss=(e,t)=>{let n=e[0],i=as(e,1),r=as(e,2),o=as(e,3),a=as(e,4),s=as(e,5),c=as(e,6),l=as(e,7);if(3!==n.dims.length&&5!==n.dims.length)throw new Error("Input query is expected to have 3 or 5 dimensions");let u,d=n.dims[0],h=n.dims[1],f=3===n.dims.length?n.dims[2]:t.numHeads*n.dims[4],p=h,m=0,g=0,y=Math.floor(f/t.numHeads);if(c&&l&&Rt.size(c.dims)&&Rt.size(l.dims)){if(4!==c.dims.length)throw new Error('Input "past_key" is expected to have 4 dimensions');if(c.dims[0]!==d||c.dims[1]!==t.numHeads||c.dims[3]!==y)throw new Error('Input "past_key" shape (batch_size, num_heads, past_sequence_length, head_size)');if(l.dims[0]!==d||l.dims[1]!==t.numHeads||l.dims[3]!==y)throw new Error('Input "past_value" shape (batch_size, num_heads, past_sequence_length, head_size)');if(c.dims[2]!==l.dims[2])throw new Error('Input "past_key" and "past_value" shall have same dim 2 (past_sequence_length)');if(4!==l.dims.length)throw new Error('Input "past_value" is expected to have 4 dimensions');m=c.dims[2],g=c.dims[2]}else if(c&&Rt.size(c.dims)||l&&Rt.size(l.dims))throw new Error('Input "past_key" and "past_value" shall be both present or both absent');if(i&&Rt.size(i.dims)>0){if(3!==n.dims.length)throw new Error('Input "query" is expected to have 3 dimensions when key is given');if(i.dims.length<3||i.dims.length>5)throw new Error('Input "key" is expected to have 3, 4, or 5 dimensions');if(n.dims[0]!==i.dims[0])throw new Error('Input "query" and "key" shall have same dim 0 (batch size)');if(3===i.dims.length){if(i.dims[2]!==n.dims[2])throw new Error('Input "query" and "key" shall have same dim 2 (hidden_size)');u=2,p=i.dims[1]}else if(5===i.dims.length){if(i.dims[2]!==t.numHeads||2!==i.dims[3]||i.dims[4]!==y)throw new Error('Expect "key" shape (batch_size, kv_sequence_length, num_heads, 2, head_size) for packed kv');if(r)throw new Error('Expect "value" be none when "key" has packed kv format.');u=5,p=i.dims[1]}else{if(i.dims[1]!==t.numHeads||i.dims[3]!==y)throw new Error('Expect "key" shape (batch_size, num_heads, kv_sequence_length, head_size) for past_key');u=0,p=i.dims[2]}}else{if(5!==n.dims.length)throw new Error('Input "query" is expected to have 5 dimensions when key is empty');if(n.dims[2]!==t.numHeads||3!==n.dims[3])throw new Error('Expect "query" shape (batch_size, kv_sequence_length, num_heads, 3, head_size) for packed kv');u=3}if(o&&Rt.size(o.dims)>0){if(1!==o.dims.length)throw new Error('Input "bias" is expected to have 1 dimension');if(i&&5===i.dims.length&&2===i.dims[3])throw new Error("bias is not allowed for packed kv.")}let v=m+p,_=0;if(a&&Rt.size(a.dims)>0){_=8;let e=a.dims;throw 1===e.length?e[0]===d?_=1:e[0]===3*d+2&&(_=3):2===e.length&&e[0]===d&&e[1]===v&&(_=5),8===_?new Error('Input "key_padding_mask" shape shall be (batch_size) or (batch_size, total_sequence_length)'):new Error("Mask not supported")}let w=!1,b=f;if(r&&Rt.size(r.dims)>0){if(3!==r.dims.length&&4!==r.dims.length)throw new Error('Input "value" is expected to have 3 or 4 dimensions');if(n.dims[0]!==r.dims[0])throw new Error('Input "query" and "value" shall have same dim 0 (batch_size)');if(3===r.dims.length){if(p!==r.dims[1])throw new Error('Input "key" and "value" shall have the same dim 1 (kv_sequence_length)');b=r.dims[2]}else{if(p!==r.dims[2])throw new Error('Input "key" and "value" shall have the same dim 2 (kv_sequence_length)');b=r.dims[1]*r.dims[3],w=!0}}if(a&&Rt.size(a.dims)>0)throw new Error("Key padding mask is not supported");if(s&&Rt.size(s.dims)>0){if(4!==s.dims.length)throw new Error('Input "attention_bias" is expected to have 4 dimensions');if(s.dims[0]!==d||s.dims[1]!==t.numHeads||s.dims[2]!==h||s.dims[3]!==v)throw new Error('Expect "attention_bias" shape (batch_size, num_heads, sequence_length, total_sequence_length)')}return{batchSize:d,sequenceLength:h,pastSequenceLength:m,kvSequenceLength:p,totalSequenceLength:v,maxSequenceLength:g,inputHiddenSize:0,hiddenSize:f,vHiddenSize:b,headSize:y,vHeadSize:Math.floor(b/t.numHeads),numHeads:t.numHeads,isUnidirectional:!1,pastPresentShareBuffer:!1,maskFilterValue:t.maskFilterValue,maskType:_,scale:t.scale,broadcastResPosBias:!1,passPastInKv:w,qkvFormat:u}},cs=e=>un(s({},e)),ls=un({perm:[0,2,1,3]}),us=(e,t,n,i,r,o,a)=>{let s=[i,r,o],c=Rt.size(s),l=[{type:12,data:c},{type:12,data:a},{type:12,data:o}];return e.compute({name:"MultiHeadAttentionAddBias",shaderCache:{inputDependencies:["type","type"]},getRunData:()=>({outputs:[{dims:s,dataType:t.dataType,gpuDataType:0}],dispatchGroup:{x:Math.ceil(c/64)},programUniforms:l}),getShaderSource:e=>{let i=Sn("qkv_with_bias",t.dataType,s),r=xn("qkv",t.dataType,s),o=xn("bias",n.dataType,s);return"\n  ".concat(e.registerUniforms([{name:"output_size",type:"u32"},{name:"bias_offset",type:"u32"},{name:"hidden_size",type:"u32"}]).declareVariables(r,o,i),"\n  ").concat(e.mainStart(),"\n    ").concat(e.guardAgainstOutOfBoundsWorkgroupSizes("uniforms.output_size"),"\n    let bias_offset_idx = (global_idx % uniforms.hidden_size) + uniforms.bias_offset;\n\n    qkv_with_bias[global_idx] = qkv[global_idx] + bias[bias_offset_idx];\n  }")}},{inputs:[t,n],outputs:[-1]})[0]},ds=(e,t,n,i,r,o,a,s)=>{let c=o;if(a&&Rt.size(a.dims)>0){if(1===i)throw new Error("AddBiasReshape is not implemented. Please export your model with packed QKV or KV");return c=us(e,o,a,t,i,n*r,s),c=c.reshape([t,i,n,r]),1===n||1===i?c:e.compute(Ln(c,ls.perm),{inputs:[c],outputs:[-1]})[0]}return 3===o.dims.length&&(c=o.reshape([t,i,n,r])),1===n||1===i?c:e.compute(Ln(c,ls.perm),{inputs:[c],outputs:[-1]})[0]},hs=(e,t)=>{let n=ss(e.inputs,t),i=e.inputs[0],r=as(e.inputs,1),o=as(e.inputs,2),a=as(e.inputs,3),s=as(e.inputs,4),c=as(e.inputs,5),l=as(e.inputs,6),u=as(e.inputs,7);if(5===i.dims.length)throw new Error("Packed QKV is not implemented");if(5===(null===r||void 0===r?void 0:r.dims.length))throw new Error("Packed KV is not implemented");let d=r&&o&&4===r.dims.length&&4===o.dims.length,h=ds(e,n.batchSize,n.numHeads,n.sequenceLength,n.headSize,i,a,0);if(d)return Ui(e,h,r,o,s,void 0,l,u,c,n);if(!r||!o)throw new Error("key and value must be provided");let f=ds(e,n.batchSize,n.numHeads,n.kvSequenceLength,n.headSize,r,a,n.hiddenSize),p=ds(e,n.batchSize,n.numHeads,n.kvSequenceLength,n.vHeadSize,o,a,2*n.hiddenSize);Ui(e,h,f,p,s,void 0,l,u,c,n)}}),mu=re(()=>{El(),Cl(),Rl(),Ll(),fs=e=>{if(!e||e.length<1)throw new Error("too few inputs")},ps=(e,t)=>{let n=[],i=t.numOutputs;return e[1].dims[0]>0&&(e[1].getBigInt64Array().forEach(e=>n.push(Number(e))),i=n.length),un({numOutputs:i,axis:t.axis,splitSizes:n})},ms=e=>"\nfn calculateOutputIndex(index: u32) -> u32 {\n    for (var i: u32 = 0u; i < ".concat(e,"u; i += 1u ) {\n    if (index < ").concat(wn("uniforms.size_in_split_axis","i",e),") {\n        return i;\n    }\n    }\n    return ").concat(e,"u;\n}"),gs=e=>{let t=e.length,n=[];for(let i=0;i<t;++i){let r=e[i].setByIndices("indices","input[global_idx]");1===t?n.push(r):0===i?n.push("if (output_number == ".concat(i,"u) { ").concat(r," }")):i===t-1?n.push("else { ".concat(r," }")):n.push("else if (output_number == ".concat(i,") { ").concat(r," }"))}return"\n      fn writeBufferData(output_number: u32, indices: ".concat(e[0].type.indices,", global_idx: u32) {\n        ").concat(n.join("\n"),"\n      }")},ys=(e,t)=>{let n=e[0].dims,i=Rt.size(n),r=e[0].dataType,o=Rt.normalizeAxis(t.axis,n.length),a=new Array(t.numOutputs),s=xn("input",r,n.length),c=new Array(t.numOutputs),l=[],u=[],d=0,h=[{type:12,data:i}];for(let f=0;f<t.numOutputs;f++){d+=t.splitSizes[f],c[f]=d;let i=n.slice();i[o]=t.splitSizes[f],u.push(i),a[f]=Sn("output".concat(f),r,i.length),l.push({dims:u[f],dataType:e[0].dataType})}h.push({type:12,data:c},...mn(n,...u));return{name:"Split",shaderCache:{hint:t.cacheKey,inputDependencies:["rank"]},getShaderSource:e=>"\n  ".concat(e.registerUniform("input_size","u32").registerUniform("size_in_split_axis","u32",c.length).declareVariables(s,...a),"\n  ").concat(ms(c.length),"\n  ").concat(gs(a),"\n\n  ").concat(e.mainStart(),"\n    ").concat(e.guardAgainstOutOfBoundsWorkgroupSizes("uniforms.input_size"),"\n\n    var indices = ").concat(s.offsetToIndices("global_idx"),";\n    var index = ").concat(s.indicesGet("indices",o),";\n    let output_number = calculateOutputIndex(index);\n    if (output_number != 0) {\n      index -= ").concat(wn("uniforms.size_in_split_axis","output_number - 1u",c.length),";\n      ").concat(s.indicesSet("indices",o,"index"),";\n    }\n    writeBufferData(output_number, indices, global_idx);\n  }"),getRunData:()=>({outputs:l,dispatchGroup:{x:Math.ceil(i/64)},programUniforms:h})}},vs=(e,t)=>{fs(e.inputs);let n=1===e.inputs.length?t:ps(e.inputs,t);e.compute(ys(e.inputs,n),{inputs:[0]})},_s=e=>{let t=e.axis,n=e.splitSizes,i=e.numOutputs<0?n.length:e.numOutputs;if(i!==n.length)throw new Error("numOutputs and splitSizes length must be equal");return un({axis:t,numOutputs:i,splitSizes:n})}}),gu=re(()=>{El(),Cl(),Rl(),Ll(),ws=(e,t)=>{let[n,i,r,o]=e,{numHeads:a,rotaryEmbeddingDim:s}=t;if(3!==n.dims.length&&4!==n.dims.length)throw new Error("Input 'x' is expected to have 3 or 4 dimensions, got ".concat(n.dims.length));if(!Rt.areEqual(i.dims,[])&&!Rt.areEqual(i.dims,[1])&&2!==i.dims.length)throw new Error("Input 'position_ids' is expected to have 0, 1, or 2 dimensions, got ".concat(i.dims.length));if(2!==r.dims.length)throw new Error("Input 'cos_cache' is expected to have 2 dimensions, got ".concat(r.dims.length));if(2!==o.dims.length)throw new Error("Input 'sin_cache' is expected to have 2 dimensions, got ".concat(o.dims.length));if(!Rt.areEqual(r.dims,o.dims))throw new Error("Inputs 'cos_cache' and 'sin_cache' are expected to have the same shape");if(s>0&&0===a)throw new Error("num_heads must be provided if rotary_embedding_dim is specified");let c=n.dims[0],l=n.dims[n.dims.length-2],u=r.dims[0],d=Rt.sizeFromDimension(n.dims,1)/l,h=0===s?2*r.dims[1]:d/a;if(s>h)throw new Error("rotary_embedding_dim must be less than or equal to head_size");if(2===i.dims.length){if(c!==i.dims[0])throw new Error("Input 'position_ids' dimension 0 should be of size batch_size, got ".concat(i.dims[0]));if(l!==i.dims[1])throw new Error("Input 'position_ids' dimension 1 should be of size sequence_length, got ".concat(i.dims[1]))}if(h/2!==r.dims[1]&&s/2!==r.dims[1])throw new Error("Input 'cos_cache' dimension 1 should be same as head_size / 2 or rotary_embedding_dim / 2, got ".concat(r.dims[1]));if(l>u)throw new Error("Updating cos_cache and sin_cache in RotaryEmbedding is not currently supported")},bs=(e,t)=>{let{interleaved:n,numHeads:i,rotaryEmbeddingDim:r,scale:o}=t,a=e[0].dims[0],s=Rt.sizeFromDimension(e[0].dims,1),c=e[0].dims[e[0].dims.length-2],l=s/c,u=e[2].dims[1],d=0===r?2*u:l/i,h=new Array(a,c,l/d,d-u),f=Rt.computeStrides(h),p=[{type:1,data:o},{type:12,data:h},{type:12,data:f},...3===e[0].dims.length?new Array({type:12,data:[s,l,d,1]}):[],...4===e[0].dims.length?new Array({type:12,data:[s,d,c*d,1]}):[],...mn(e[0].dims,e[1].dims,e[2].dims,e[3].dims,e[0].dims)];return{name:"RotaryEmbedding",shaderCache:{hint:un({interleaved:n}).cacheKey,inputDependencies:["rank","rank","rank","rank"]},getShaderSource:t=>{let i=xn("input",e[0].dataType,e[0].dims.length),r=xn("position_ids",e[1].dataType,e[1].dims.length),o=xn("cos_cache",e[2].dataType,e[2].dims.length),a=xn("sin_cache",e[3].dataType,e[3].dims.length),s=Sn("output",e[0].dataType,e[0].dims.length);return t.registerUniforms([{name:"scale",type:"f32"},{name:"global_shape",type:"u32",length:h.length},{name:"global_strides",type:"u32",length:f.length},{name:"input_output_strides",type:"u32",length:f.length}]),"\n        ".concat(t.declareVariables(i,r,o,a,s),"\n\n        ").concat(t.mainStart(dn),"\n          let half_rotary_emb_dim = uniforms.").concat(o.name,"_shape[1];\n          let bsnh = global_idx / uniforms.global_strides % uniforms.global_shape;\n          let size = uniforms.global_shape[0] * uniforms.global_strides[0];\n          ").concat(t.guardAgainstOutOfBoundsWorkgroupSizes("size"),"\n\n          if (bsnh[3] < half_rotary_emb_dim) {\n            let position_ids_idx =\n                ").concat(r.broadcastedIndicesToOffset("bsnh.xy",Sn("",r.type.tensor,2)),";\n            let position_id =\n                u32(").concat(r.getByOffset("position_ids_idx"),") + select(0, bsnh[1], position_ids_idx == 0);\n            let i = dot(bsnh, uniforms.input_output_strides) + select(0, bsnh[3], ").concat(n,");\n            let j = i + select(half_rotary_emb_dim, 1, ").concat(n,");\n            let re = ").concat(i.getByOffset("i")," * ").concat(o.get("position_id","bsnh[3]")," -\n                ").concat(i.getByOffset("j")," * ").concat(a.get("position_id","bsnh[3]"),";\n            ").concat(s.setByOffset("i","re"),"\n            let im = ").concat(i.getByOffset("i")," * ").concat(a.get("position_id","bsnh[3]")," +\n                ").concat(i.getByOffset("j")," * ").concat(o.get("position_id","bsnh[3]"),";\n            ").concat(s.setByOffset("j","im"),"\n          } else {\n            let k = dot(bsnh, uniforms.input_output_strides) + half_rotary_emb_dim;\n            ").concat(s.setByOffset("k",i.getByOffset("k")),"\n          }\n        }")},getRunData:()=>({outputs:[{dims:e[0].dims,dataType:e[0].dataType}],dispatchGroup:{x:Math.ceil(Rt.size(h)/dn)},programUniforms:p})}},xs=(e,t)=>{ws(e.inputs,t),e.compute(bs(e.inputs,t))}}),yu=re(()=>{Rl(),El(),Ul(),pu(),mu(),zl(),gu(),Ll(),Ss=(e,t)=>{if(t.doRotary&&e.length<=7)throw new Error("cos_cache and sin_cache inputs are required if do_rotary is specified");let n=e[0],i=e[1],r=e[2],o=e[3],a=e[4];if(0!==t.doRotary&&e.length<=7)throw new Error("cos_cast and sin_cache are expected if do_rotary attribute is non-zero");if(-1!==t.localWindowSize)throw new Error("Local attention is not supported");if(0!==t.softcap)throw new Error("Softcap is not supported");if(0!==t.rotaryInterleaved)throw new Error("Rotary interleaved is not supported");if(t.smoothSoftmax)throw new Error("Smooth softmax is not supported");if(3!==n.dims.length&&5!==n.dims.length)throw new Error("Input query is expected to have 3 or 5 dimensions");let s=n.dims[0],c=n.dims[1],l=3===n.dims.length?n.dims[2]:t.numHeads*n.dims[4],u=c,d=0,h=!i||0===i.dims.length,f=Math.floor(h?l/(t.numHeads+2*t.kvNumHeads):l/t.numHeads);h&&(l=f*t.numHeads);let p=o&&0!==o.dims.length,m=a&&0!==a.dims.length;if(p&&4===o.dims.length&&o.dims[0]===s&&o.dims[1]!==t.kvNumHeads&&o.dims[2]===t.kvNumHeads&&o.dims[3]===f)throw new Error("BSNH pastKey/pastValue is not supported");if(p&&m){if(4!==o.dims.length)throw new Error('Input "past_key" is expected to have 4 dimensions');if(4!==a.dims.length)throw new Error('Input "past_value" is expected to have 4 dimensions');d=o.dims[2]}else if(p||m)throw new Error('Input "past_key" and "past_value" shall be both present or both absent');let g=1;if(i&&i.dims.length>0){if(3!==n.dims.length)throw new Error('Input "query" is expected to have 3 dimensions when key is given');if(i.dims.length<3||i.dims.length>5)throw new Error('Input "key" is expected to have 3, 4, or 5 dimensions');if(n.dims[0]!==i.dims[0])throw new Error('Input "query" and "key" shall have same dim 0 (batch size)');if(3===i.dims.length){if(n.dims[2]%i.dims[2]!==0)throw new Error('Dimension 2 of "query" should be a multiple of "key"');u=i.dims[1]}else if(5===i.dims.length){if(i.dims[2]!==t.numHeads||2!==i.dims[3]||i.dims[4]!==f)throw new Error('Expect "key" shape (batch_size, kv_sequence_length, num_heads, 2, head_size) for packed kv');if(r)throw new Error('Expect "value" be none when "key" has packed kv format.');u=i.dims[1]}else{if(i.dims[1]!==t.numHeads||i.dims[3]!==f)throw new Error('Expect "key" shape (batch_size, num_heads, kv_sequence_length, head_size) for past_key');u=i.dims[2]}}else{if(3!==n.dims.length&&5!==n.dims.length)throw new Error('Input "query" is expected to have 3 or 5 dimensions when key is empty');if(5===n.dims.length&&(n.dims[2]!==t.numHeads||3!==n.dims[3]))throw new Error('Expect "query" shape (batch_size, kv_sequence_length, num_heads, 3, head_size) for packed kv');g=3}let y=!1,v=t.kvNumHeads?f*t.kvNumHeads:l;if(r&&r.dims.length>0){if(3!==r.dims.length&&4!==r.dims.length)throw new Error('Input "value" is expected to have 3 or 4 dimensions');if(n.dims[0]!==r.dims[0])throw new Error('Input "query" and "value" shall have same dim 0 (batch_size)');if(3===r.dims.length){if(u!==r.dims[1])throw new Error('Input "key" and "value" shall have the same dim 1 (kv_sequence_length)');v=r.dims[2]}else{if(u!==r.dims[2])throw new Error('Input "past_key" and "past_value" shall have the same dim 2 (kv_sequence_length)');v=r.dims[1]*r.dims[3],y=!0}}let _=e.length>4?e[5]:void 0;if(_&&1!==_.dims.length&&_.dims[0]!==s)throw new Error('Input "seqlens" is expected to have 1 dimension and the same dim 0 as batch_size');return{batchSize:s,sequenceLength:c,pastSequenceLength:d,kvSequenceLength:u,totalSequenceLength:-1,maxSequenceLength:-1,inputHiddenSize:0,hiddenSize:l,vHiddenSize:v,headSize:f,vHeadSize:Math.floor(v/t.kvNumHeads),numHeads:t.numHeads,kvNumHeads:t.kvNumHeads,nReps:t.numHeads/t.kvNumHeads,pastPresentShareBuffer:!1,maskType:0,scale:t.scale,broadcastResPosBias:!1,passPastInKv:y,qkvFormat:g}},Es=un({perm:[0,2,1,3]}),Ts=(e,t,n)=>{let i=t,r=n.kvNumHeads;return 3===t.dims.length&&0!==n.kvSequenceLength&&(i=t.reshape([n.batchSize,n.kvSequenceLength,r,n.headSize]),i=e.compute(Ln(i,Es.perm),{inputs:[i],outputs:[-1]})[0]),i},ks=(e,t,n,i)=>{let r=[e*t],o=e*t,a=[{type:12,data:o},{type:12,data:t},{type:12,data:e}];return{name:"GeneratePositionIds",shaderCache:{hint:"".concat(e,";").concat(t),inputDependencies:["type","type"]},getRunData:()=>({outputs:[{dims:r,dataType:7}],dispatchGroup:{x:Math.ceil(o/64)},programUniforms:a}),getShaderSource:e=>{let t=xn("seq_lens",n.dataType,n.dims),o=xn("total_seq_lens",i.dataType,i.dims),a=Sn("pos_ids",7,r);return"\n  ".concat(e.registerUniforms([{name:"output_size",type:"u32"},{name:"sequence_length",type:"u32"},{name:"batch_size",type:"u32"}]).declareVariables(t,o,a),"\n  ").concat(e.mainStart(),"\n    ").concat(e.guardAgainstOutOfBoundsWorkgroupSizes("uniforms.output_size"),"\n    let total_sequence_length = u32(").concat(o.getByOffset("0"),");\n    let is_subsequent_prompt = uniforms.sequence_length > 1 && uniforms.sequence_length != total_sequence_length;\n    let is_first_prompt = !is_subsequent_prompt && uniforms.sequence_length == total_sequence_length;\n    let batch_idx = global_idx / uniforms.sequence_length;\n    let sequence_idx = i32(global_idx % uniforms.sequence_length);\n    var pos_id: i32 = 0;\n    let seqlen = ").concat(t.getByOffset("batch_idx"),";\n    let total_seqlen = seqlen + 1;\n    if (is_first_prompt) {\n      if (sequence_idx < total_seqlen) {\n        pos_id = sequence_idx;\n      } else {\n        pos_id = 1;\n      }\n      ").concat(a.setByOffset("global_idx","pos_id"),"\n    } else if (is_subsequent_prompt) {\n      let past_seqlen = total_seqlen - i32(uniforms.sequence_length);\n      if (past_seqlen + sequence_idx < total_seqlen) {\n        pos_id = past_seqlen + sequence_idx;\n      } else {\n        pos_id = 1;\n      }\n      ").concat(a.setByOffset("global_idx","pos_id"),"\n    } else if (global_idx < uniforms.batch_size) {\n      ").concat(a.setByOffset("global_idx","seqlen"),"\n    };\n  }\n  ")}}},Cs=(e,t)=>{var n;let i=Ss(e.inputs,t);if(5===e.inputs[0].dims.length)throw new Error("Packed QKV is not implemented");if(5===(null===(n=e.inputs[1])||void 0===n?void 0:n.dims.length))throw new Error("Packed KV is not implemented");let r,o,a=e.inputs[0],s=e.inputs[1]&&e.inputs[1].dims.length>0?e.inputs[1]:void 0,c=e.inputs[2]&&e.inputs[2].dims.length>0?e.inputs[2]:void 0,l=e.inputs[3]&&0!==e.inputs[3].dims.length?e.inputs[3]:void 0,u=e.inputs[4]&&0!==e.inputs[4].dims.length?e.inputs[4]:void 0,d=e.inputs.length>4?e.inputs[5]:void 0,h=e.inputs.length>5?e.inputs[6]:void 0,f=i.kvNumHeads?i.kvNumHeads:i.numHeads,p=un({axis:2,numOutputs:3,splitSizes:[i.numHeads*i.headSize,f*i.headSize,f*i.headSize]}),[m,g,y]=s||c?[a,s,c]:e.compute(ys([a],p),{inputs:[a],outputs:[-1,-1,-1]});if(t.doRotary){let n=e.compute(ks(i.batchSize,i.sequenceLength,d,h),{inputs:[d,h],outputs:[-1]})[0],a=e.inputs[7],s=e.inputs[8],c=un({interleaved:0!==t.rotaryInterleaved,numHeads:i.numHeads,rotaryEmbeddingDim:0,scale:t.scale}),l=[m,n,a,s],u=[-1];r=e.compute(bs(l,c),{inputs:l,outputs:u})[0],l.splice(0,1,g);let f=un({interleaved:0!==t.rotaryInterleaved,numHeads:i.kvNumHeads,rotaryEmbeddingDim:0,scale:t.scale});o=e.compute(bs(l,f),{inputs:l,outputs:u})[0]}let v=ds(e,i.batchSize,i.numHeads,i.sequenceLength,i.headSize,t.doRotary?r:m,void 0,0),_=Ts(e,t.doRotary?o:g,i),w=Ts(e,y,i);Ui(e,v,_,w,void 0,void 0,l,u,void 0,i,d,h)}}),vu=re(()=>{El(),Cl(),zl(),Ll(),Is=(e,t,n,i,r,o,a,s)=>{let c=gn(o),l=1===c?"f32":"vec".concat(c,"f"),u=1===c?"vec2f":"mat2x".concat(c,"f"),d=r*a,h=64;1===d&&(h=256);let f=[r,a,o/c],p=[r,a,2],m=[];m.push(...mn(f,p));return e.compute({name:"InstanceNormComputeChannelScaleShift",shaderCache:{hint:"".concat(c,";").concat(s,";").concat(h),inputDependencies:["rank","type","type"]},getRunData:()=>({outputs:[{dims:p,dataType:1}],dispatchGroup:{x:d},programUniforms:m}),getShaderSource:e=>{let r=xn("x",t.dataType,3,c),o=[r,xn("scale",n.dataType,n.dims),xn("bias",i.dataType,i.dims),Sn("output",1,3,2)];return"\n  var<workgroup> workgroup_shared : array<".concat(u,", ").concat(h,">;\n  const workgroup_size = ").concat(h,"u;\n  ").concat(e.declareVariables(...o),"\n  ").concat(e.mainStart(h),"\n    let batch = workgroup_index / uniforms.x_shape[1];\n    let channel = workgroup_index % uniforms.x_shape[1];\n    let hight = uniforms.x_shape[2];\n    // initialize workgroup memory\n    var sum = ").concat(l,"(0);\n    var squared_sum = ").concat(l,"(0);\n    for (var h = local_idx; h < hight; h += workgroup_size) {\n      let value = ").concat(l,"(").concat(r.get("batch","channel","h"),");\n      sum += value;\n      squared_sum += value * value;\n    }\n    workgroup_shared[local_idx] = ").concat(u,"(sum, squared_sum);\n    workgroupBarrier();\n\n    for (var currSize = workgroup_size >> 1;  currSize > 0; currSize = currSize >> 1) {\n      if (local_idx < currSize) {\n        workgroup_shared[local_idx] = workgroup_shared[local_idx] + workgroup_shared[local_idx + currSize];\n      }\n      workgroupBarrier();\n    }\n    if (local_idx == 0) {\n      let sum_final = ").concat(_n("workgroup_shared[0][0]",c)," / f32(hight * ").concat(c,");\n      let squared_sum_final = ").concat(_n("workgroup_shared[0][1]",c)," / f32(hight * ").concat(c,");\n\n      let inv_std_dev = inverseSqrt(squared_sum_final - sum_final * sum_final + f32(").concat(s,"));\n      let channel_scale = inv_std_dev * f32(scale[channel]);\n      let channel_shift = f32(bias[channel]) - sum_final * channel_scale;\n      output[workgroup_index] = vec2f(channel_scale, channel_shift);\n    }\n  }")}},{inputs:[t,n,i],outputs:[-1]})[0]},As=(e,t,n)=>{let i=t[0].dims,r=i,o=i[0],a=i[1],s=Rt.sizeFromDimension(i,2),c=gn(s),l=Rt.size(r)/c,u=Is(e,t[0],t[1],t[2],o,s,a,n.epsilon),d=[o,a,s/c],h=[o,a];e.compute({name:"InstanceNormalization",shaderCache:{hint:"".concat(c),inputDependencies:["type","none"]},getRunData:()=>({outputs:[{dims:r,dataType:t[0].dataType}],dispatchGroup:{x:Math.ceil(l/64)},programUniforms:[{type:12,data:l},...mn(d,h,d)]}),getShaderSource:e=>{let n=xn("x",t[0].dataType,d.length,c),i=xn("scale_shift",1,h.length,2),r=Sn("output",t[0].dataType,d.length,c),o=[n,i,r];return"\n  ".concat(e.registerUniform("output_size","u32").declareVariables(...o),"\n  ").concat(e.mainStart(),"\n  ").concat(e.guardAgainstOutOfBoundsWorkgroupSizes("uniforms.output_size"),"\n      let outputIndices = ").concat(r.offsetToIndices("global_idx"),";\n      let batch = outputIndices[0];\n      let channel = outputIndices[1];\n      let scale_shift = ").concat(i.getByIndices("vec2<u32>(batch, channel)"),";\n      let value = ").concat(n.getByOffset("global_idx")," * ").concat(r.type.value,"(scale_shift.x) + ").concat(r.type.value,"(scale_shift.y);\n      ").concat(r.setByOffset("global_idx","value"),";\n  }")}},{inputs:[t[0],u]})},Ns=(e,t,n)=>{let i=t[0].dims,r=i,o=i[0],a=i[i.length-1],s=Rt.sizeFromDimension(i,1)/a,c=gn(a),l=Rt.size(r)/c,u=[{type:12,data:s},{type:12,data:Math.floor(a/c)}],d=!1,h=[0,i.length-1];for(let m=0;m<i.length-2;m++)d=d||1!==i[m+1],h.push(m+1);d=d&&1!==i[i.length-1];let f=d?e.compute(Ln(e.inputs[0],h),{inputs:[e.inputs[0]],outputs:[-1]})[0]:e.inputs[0].reshape(Array.from({length:i.length},(e,t)=>i[h[t]])),p=Is(e,f,t[1],t[2],o,s,a,n.epsilon);e.compute({name:"InstanceNormalizationNHWC",shaderCache:{hint:"".concat(c),inputDependencies:["type","type"]},getRunData:()=>({outputs:[{dims:r,dataType:t[0].dataType}],dispatchGroup:{x:Math.ceil(l/64)},programUniforms:u}),getShaderSource:e=>{let n=fn(t[0].dataType),i=1===c?"vec2f":"mat".concat(c,"x2f"),o=e=>{let t=0===e?"x":"y",i=1===c?"f32":"vec".concat(c,"f");switch(c){case 1:return"".concat(n,"(").concat(i,"(scale.").concat(t,"))");case 2:return"vec2<".concat(n,">(").concat(i,"(scale[0].").concat(t,", scale[1].").concat(t,"))");case 4:return"vec4<".concat(n,">(").concat(i,"(scale[0].").concat(t,", scale[1].").concat(t,", scale[2].").concat(t,", scale[3].").concat(t,"))");default:throw new Error("Not supported compoents ".concat(c))}},a=xn("input",t[0].dataType,t[0].dims,c),s=Sn("output",t[0].dataType,r,c);return"\n  @group(0) @binding(0) var<storage, read> input : array<".concat(a.type.storage,">;\n  @group(0) @binding(1) var<storage, read> scale_input : array<").concat(i,">;\n  @group(0) @binding(2) var<storage, read_write> output : array<").concat(s.type.storage,">;\n  struct Uniforms {H: u32, C : u32};\n  @group(0) @binding(3) var<uniform> uniforms: Uniforms;\n\n  ").concat(e.mainStart(),"\n    let current_image_number = global_idx / (uniforms.C * uniforms.H);\n    let current_channel_number = global_idx % uniforms.C;\n\n    let scale_offset = current_image_number * uniforms.C + current_channel_number;\n    let scale = scale_input[scale_offset];\n    output[global_idx] = fma(input[global_idx], ").concat(o(0),", ").concat(o(1),");\n  }")}},{inputs:[t[0],p]})},Os=(e,t)=>{"NHWC"===t.format?Ns(e,e.inputs,t):As(e,e.inputs,t)}}),_u=re(()=>{El(),Cl(),Ll(),Ps=e=>{if(!e||e.length<2)throw new Error("layerNorm requires at least 2 inputs.")},Rs=(e,t,n)=>{let i=t.simplified,r=e[0].dims,o=e[1],a=!i&&e[2],s=r,c=Rt.normalizeAxis(t.axis,r.length),l=Rt.sizeToDimension(r,c),u=Rt.sizeFromDimension(r,c),d=Rt.size(o.dims),h=a?Rt.size(a.dims):0;if(d!==u||a&&h!==u)throw new Error("Size of X.shape()[axis:] == ".concat(u,".\n       Size of scale and bias (if provided) must match this.\n       Got scale size of ").concat(d," and bias size of ").concat(h));let f=[];for(let w=0;w<r.length;++w)w<c?f.push(r[w]):f.push(1);let p=gn(u),m=["type","type"],g=[{type:12,data:l},{type:1,data:u},{type:12,data:Math.floor(u/p)},{type:1,data:t.epsilon}];a&&m.push("type");let y=n>1,v=n>2,_=[{dims:s,dataType:e[0].dataType}];return y&&_.push({dims:f,dataType:1}),v&&_.push({dims:f,dataType:1}),{name:"LayerNormalization",shaderCache:{hint:"".concat(p,";").concat(n,";").concat(i),inputDependencies:m},getRunData:()=>({outputs:_,dispatchGroup:{x:Math.ceil(l/64)},programUniforms:g}),getShaderSource:t=>{let n=fn(e[0].dataType),r=[xn("x",e[0].dataType,e[0].dims,p),xn("scale",o.dataType,o.dims,p)];a&&r.push(xn("bias",a.dataType,a.dims,p)),r.push(Sn("output",e[0].dataType,s,p)),y&&r.push(Sn("mean_data_output",1,f)),v&&r.push(Sn("inv_std_output",1,f));return"\n  ".concat(t.registerUniforms([{name:"norm_count",type:"u32"},{name:"norm_size",type:"f32"},{name:"norm_size_vectorized",type:"u32"},{name:"epsilon",type:"f32"}]).declareVariables(...r),"\n  ").concat(t.mainStart(),"\n    ").concat(t.guardAgainstOutOfBoundsWorkgroupSizes("uniforms.norm_count"),"\n    let offset = global_idx * uniforms.norm_size_vectorized;\n    var mean_vector = ").concat(yn("f32",p),";\n    var mean_square_vector = ").concat(yn("f32",p),";\n\n    for (var h: u32 = 0u; h < uniforms.norm_size_vectorized; h++) {\n      let value = ").concat(vn(n,p,"x[h + offset]"),";\n      mean_vector += value;\n      mean_square_vector += value * value;\n    }\n    let mean = ").concat(_n("mean_vector",p)," / uniforms.norm_size;\n    let inv_std_dev = inverseSqrt(").concat(_n("mean_square_vector",p)," / uniforms.norm_size ").concat(i?"":"- mean * mean"," + uniforms.epsilon);\n\n    for (var j: u32 = 0; j < uniforms.norm_size_vectorized; j++) {\n      let f32input = ").concat(vn(n,p,"x[j + offset]"),";\n      let f32scale = ").concat(vn(n,p,"scale[j]"),";\n      output[j + offset] = ").concat(r[0].type.value,"((f32input ").concat(i?"":"- mean",") * inv_std_dev * f32scale\n        ").concat(a?"+ ".concat(vn(n,p,"bias[j]")):"","\n      );\n    }\n\n    ").concat(y?"mean_data_output[global_idx] = mean":"",";\n    ").concat(v?"inv_std_output[global_idx] = inv_std_dev":"",";\n  }")}}},Ls=(e,t)=>{Ps(e.inputs),e.compute(Rs(e.inputs,t,e.outputCount))}}),wu=re(()=>{Cl(),Ql(),Xl(),zs=e=>{if(!e||2!==e.length)throw new Error("MatMul requires 2 inputs.");if(e[0].dims[e[0].dims.length-1]!==e[1].dims[e[1].dims.length-2])throw new Error("shared dimension does not match.")},Ms=e=>{zs(e.inputs);let t=Pt.calcShape(e.inputs[0].dims,e.inputs[1].dims,!0);if(!t)throw new Error("Can't use matmul on the given tensors");let n=t[t.length-1],i=e.inputs[0].dims[e.inputs[0].dims.length-1];if(n<8&&i<8)e.compute(yo(e.inputs,{activation:""},t));else{let r=t[t.length-2],o=Rt.size(e.inputs[0].dims.slice(0,-2)),a=Rt.size(e.inputs[1].dims.slice(0,-2));if(1!==o&&1===r&&1===a){let r=[1,o,n],a=[e.inputs[0].reshape([1,o,i]),e.inputs[1].reshape([1,i,n])];e.compute(To(a,{activation:""},t,r),{inputs:a})}else e.compute(To(e.inputs,{activation:""},t))}}}),bu=re(()=>{El(),Cl(),Rl(),Ll(),Ds=(e,t)=>{if(e.length<3||e.length>4)throw new Error("MatMulNBits requires 3 or 4 inputs");let n=e[0],i=n.dims.length;if(n.dims[i-1]!==t.k)throw new Error("The last dim of input shape does not match the k value");let r=Math.floor((t.k+t.blockSize-1)/t.blockSize),o=t.blockSize/8*t.bits,a=e[1];if(!Rt.areEqual(a.dims,[t.n,r,o]))throw new Error("The second inputs must be 3D tensor with shape N X nBlocksPerCol X blobSize");let s=e[2].dims;if(Rt.size(s)!==t.n*r)throw new Error("scales input size error.");if(4===e.length){let n=e[3].dims,i=t.n*(8===t.bits?r:Math.floor((r*t.bits+7)/8));if(Rt.size(n)!==i)throw new Error("zeroPoints input size error.")}},Bs=(e,t)=>{let n=e[0].dims,i=n.length,r=n[i-2],o=t.k,a=t.n,s=n.slice(0,i-2),c=Rt.size(s),l=e[1].dims[2]/4,u=e[0].dataType,d=gn(t.k),h=gn(l),f=gn(a),p=s.concat([r,a]),m=r>1&&a/f%2===0?2:1,g=Rt.size(p)/f/m,y=64,v=[],_=[c,r,o/d],w=Rt.convertShape(e[1].dims).slice();w.splice(-1,1,l/h),v.push(...mn(_)),v.push(...mn(w)),v.push(...mn(e[2].dims)),4===e.length&&v.push(...mn(Rt.convertShape(e[3].dims)));let b=[c,r,a/f];v.push(...mn(b));return{name:"MatMulNBits",shaderCache:{hint:"".concat(t.blockSize,";").concat(t.bits,";").concat(d,";").concat(h,";").concat(f,";").concat(m,";").concat(y),inputDependencies:Array(e.length).fill("rank")},getRunData:()=>({outputs:[{dims:p,dataType:u}],dispatchGroup:{x:g},programUniforms:v}),getShaderSource:n=>{let i=_.length,r=xn("a",e[0].dataType,i,d),o=xn("b",12,w.length,h),a=xn("scales",e[2].dataType,e[2].dims.length),s=[r,o,a],c=4===e.length?xn("zero_points",12,e[3].dims.length):void 0;c&&s.push(c);let u=b.length,p=Sn("output",e[0].dataType,u,f),g=fn(e[0].dataType),v=(()=>{switch(d){case 1:return"array<".concat(g,", 8>");case 2:return"mat4x2<".concat(g,">");case 4:return"mat2x4<".concat(g,">");default:throw new Error("".concat(d,"-component is not supported."))}})();return"\n        var<workgroup> workgroup_shared: array<".concat(p.type.value,", ").concat(m*y,">;\n        ").concat(n.declareVariables(...s,p),"\n        ").concat(n.mainStart([y,1,1]),"\n          let output_indices = ").concat(p.offsetToIndices("(global_idx / ".concat(y,") * ").concat(m)),";\n          let col = output_indices[2];\n          let row = output_indices[1];\n          let batch = output_indices[0];\n          let nBlocksPerCol = uniforms.b_shape[1];\n\n          for (var block = local_id.x; block < nBlocksPerCol; block += ").concat(y,") {\n            //process one block\n            var word_offset: u32 = block * ").concat(t.blockSize/d,";\n            ").concat((()=>{let e="\n            var col_index = col * ".concat(f,";\n            ").concat(c?"\n            let zero_point_bytes_per_col = (nBlocksPerCol + 1) / 2;\n            var zero_point_byte_count: u32;\n            var zero_point_word_index: u32;\n            var zero_point_byte_offset: u32;\n            let zero_point_nibble_offset: u32 = block & 0x1u;\n            var zero_point_bits_offset: u32;\n            var zero_point_word: u32;":"\n            // The default zero point is 8 for unsigned 4-bit quantization.\n            let zero_point = ".concat(g,"(8);"),"\n            ");for(let t=0;t<f*m;t++)e+="\n            let scale".concat(t," = ").concat(a.getByOffset("col_index * nBlocksPerCol + block"),";\n            ").concat(c?"\n            zero_point_byte_count = col_index * zero_point_bytes_per_col + (block >> 0x1u);\n            zero_point_word_index = zero_point_byte_count >> 0x2u;\n            zero_point_byte_offset = zero_point_byte_count & 0x3u;\n            zero_point_bits_offset = (zero_point_byte_offset << 3) + (zero_point_nibble_offset << 2);\n            zero_point_word = ".concat(c.getByOffset("zero_point_word_index")," >> zero_point_bits_offset;\n            let zero_point").concat(t," = ").concat(g,"((zero_point_word) & 0xFu);"):"","\n            col_index += 1;");return e})(),"\n            for (var word: u32 = 0; word < ").concat(l,"; word += ").concat(h,") {\n              ").concat((()=>{let e="col_index = col * ".concat(f,";");for(let t=0;t<f*m;t++)e+="\n            let b".concat(t,"_data = ").concat(o.getByIndices("".concat(o.type.indices,"(col_index, block, word)")),";\n            col_index += 1;");return e+="\n            var b_value: u32;\n            let b_mask: u32 = 0x0F0F0F0Fu;\n            var b_value_lower: vec4<u32>;\n            var b_value_upper: vec4<u32>;\n            var b_quantized_values: ".concat(v,";\n            var b_dequantized_values: ").concat(v,";"),e})(),"\n              for (var i: u32 = 0; i < ").concat(h,"; i++) {\n                ").concat((()=>{let e="\n          // reuse a data\n            var input_offset = ".concat(r.indicesToOffset("".concat(r.type.indices,"(batch, row, word_offset)")),";\n            var a_data: ").concat(v,";\n            for (var j: u32 = 0; j < ").concat(8/d,"; j++) {\n              a_data[j] = ").concat(r.getByOffset("input_offset"),";\n              input_offset++;\n            }\n          ");for(let t=0;t<f*m;t++)e+="\n            b_value = ".concat("b".concat(t,1===h?"_data":"_data[i]"),";\n            b_value_lower = unpack4xU8(b_value & b_mask);\n            b_value_upper = unpack4xU8((b_value >> 4) & b_mask);\n            b_quantized_values = ").concat(v,"(").concat(Array.from({length:4},(e,t)=>"".concat(g,"(b_value_lower[").concat(t,"]), ").concat(g,"(b_value_upper[").concat(t,"])")).join(", "),");\n            b_dequantized_values = ").concat(1===d?"".concat(v,"(").concat(Array.from({length:8},(e,n)=>"(b_quantized_values[".concat(n,"] - ").concat(c?"zero_point".concat(t):"zero_point",") * scale").concat(t)).join(", "),");"):"(b_quantized_values - ".concat(v,"(").concat(Array(8).fill("".concat(c?"zero_point".concat(t):"zero_point")).join(","),")) * scale").concat(t,";"),";\n            workgroup_shared[local_id.x * ").concat(m," + ").concat(Math.floor(t/f),"]").concat(f>1?"[".concat(t%f,"]"):""," += ").concat(Array.from({length:8/d},(e,t)=>"".concat(1===d?"a_data[".concat(t,"] * b_dequantized_values[").concat(t,"]"):"dot(a_data[".concat(t,"], b_dequantized_values[").concat(t,"])"))).join(" + "),";\n          ");return e})(),"\n                word_offset += ").concat(8/d,";\n              }\n            }\n          }\n          workgroupBarrier();\n\n          if (local_id.x < ").concat(m,") {\n            var output_value: ").concat(p.type.value," = ").concat(p.type.value,"(0);\n            var workgroup_shared_offset: u32 = local_id.x;\n            for (var b: u32 = 0u; b < ").concat(y,"u; b++) {\n              output_value += workgroup_shared[workgroup_shared_offset];\n              workgroup_shared_offset += ").concat(m,";\n            }\n            ").concat(p.setByIndices("".concat(p.type.indices,"(batch, row, col + local_id.x)"),"output_value"),";\n          }\n        }")}}},Us=(e,t)=>{let n=e[0].dims,i=n.length,r=n[i-2],o=t.k,a=t.n,s=n.slice(0,i-2),c=Rt.size(s),l=e[1].dims[2]/4,u=e[0].dataType,d=gn(t.k),h=gn(l),f=s.concat([r,a]),p=a%8===0?8:a%4===0?4:1,m=128/p,g=m*h*8,y=g/d,v=g/t.blockSize,_=Rt.size(f)/p,w=[],b=[c,r,o/d],x=Rt.convertShape(e[1].dims).slice();x.splice(-1,1,l/h),w.push(...mn(b)),w.push(...mn(x)),w.push(...mn(e[2].dims)),4===e.length&&w.push(...mn(Rt.convertShape(e[3].dims)));let S=[c,r,a];w.push(...mn(S));return{name:"BlockwiseMatMulNBits32",shaderCache:{hint:"".concat(t.blockSize,";").concat(d,";").concat(h,";").concat(m,";").concat(p),inputDependencies:Array(e.length).fill("rank")},getRunData:()=>({outputs:[{dims:f,dataType:u}],dispatchGroup:{x:_},programUniforms:w}),getShaderSource:n=>{let i=b.length,r=xn("a",e[0].dataType,i,d),o=xn("b",12,x.length,h),a=xn("scales",e[2].dataType,e[2].dims.length),s=[r,o,a],c=4===e.length?xn("zero_points",12,e[3].dims.length):void 0;c&&s.push(c);let l=S.length,u=Sn("output",e[0].dataType,l),f=fn(e[0].dataType);return"\n        var<workgroup> sub_a: array<".concat(r.type.value,", ").concat(y,">;\n        var<workgroup> inter_results: array<array<").concat(u.type.value,", ").concat(m,">, ").concat(p,">;\n        ").concat(n.declareVariables(...s,u),"\n        ").concat(n.mainStart([m,p,1]),"\n          let output_indices = ").concat(u.offsetToIndices("workgroup_index * ".concat(p)),";\n          let col = output_indices[2];\n          let row = output_indices[1];\n          let batch = output_indices[0];\n          let n_blocks_per_col = uniforms.b_shape[1];\n          let num_tiles =  (n_blocks_per_col - 1) / ").concat(v," + 1;\n\n          // Loop over shared dimension.\n          for (var tile: u32 = 0; tile < num_tiles; tile += 1) {\n            let a_col_start = tile * ").concat(y,";\n            // load one tile A data into shared memory.\n            for (var a_offset = local_idx; a_offset < ").concat(y,"; a_offset += ").concat(128,")\n            {\n              let a_col = a_col_start + a_offset;\n              if (a_col < uniforms.a_shape[2])\n              {\n                sub_a[a_offset] = ").concat(r.getByIndices("".concat(r.type.indices,"(batch, row, a_col)")),";\n              } else {\n                sub_a[a_offset] = ").concat(r.type.value,"(0);\n              }\n            }\n            workgroupBarrier();\n\n            // each thread process one block\n            let b_row = col + local_id.y;\n            let block = tile * ").concat(v," + local_id.x;\n            ").concat(c?"\n            let zero_point_bytes_per_col = (n_blocks_per_col + 1) / 2;\n            let zero_point_byte_count = b_row * zero_point_bytes_per_col + (block >> 0x1u);\n            let zero_point_word_index = zero_point_byte_count >> 0x2u;\n            let zero_point_byte_offset = zero_point_byte_count & 0x3u;\n            let zero_point_nibble_offset: u32 = block & 0x1u;\n            let zero_point_bits_offset = (zero_point_byte_offset << 3) + (zero_point_nibble_offset << 2);\n            let zero_point_word = ".concat(c.getByOffset("zero_point_word_index")," >> zero_point_bits_offset;\n            let zero_point = ").concat(f,"((zero_point_word) & 0xFu);"):"\n            // The default zero point is 8 for unsigned 4-bit quantization.\n            let zero_point = ".concat(f,"(8);"),"\n            let scale = ").concat(a.getByOffset("b_row * n_blocks_per_col + block"),";\n            let b_data = ").concat(o.getByIndices("".concat(o.type.indices,"(b_row, block, 0)")),";\n            var word_offset = local_id.x * ").concat(t.blockSize/d,";\n            for (var i: u32 = 0; i < ").concat(h,"; i++) {\n              ").concat((()=>{switch(d){case 1:return"\n          let a_data0 = vec4<".concat(f,">(sub_a[word_offset], sub_a[word_offset + 1], sub_a[word_offset + 2], sub_a[word_offset + 3]);\n          let a_data1 = vec4<").concat(f,">(sub_a[word_offset + 4], sub_a[word_offset + 5], sub_a[word_offset + 6], sub_a[word_offset + 7]);");case 2:return"\n          let a_data0 = vec4<".concat(f,">(sub_a[word_offset], sub_a[word_offset + 1]);\n          let a_data1 = vec4<").concat(f,">(sub_a[word_offset + 2], sub_a[word_offset + 3]);");case 4:return"\n          let a_data0 = sub_a[word_offset];\n          let a_data1 = sub_a[word_offset + 1];";default:throw new Error("".concat(d,"-component is not supported."))}})(),"\n              let b_value = ").concat(1===h?"b_data":"b_data[i]",";\n              let b_value_lower = unpack4xU8(b_value & 0x0F0F0F0Fu);\n              let b_value_upper = unpack4xU8((b_value >> 4) & 0x0F0F0F0Fu);\n              let b_quantized_values = mat2x4<").concat(f,">(").concat(Array.from({length:4},(e,t)=>"".concat(f,"(b_value_lower[").concat(t,"]), ").concat(f,"(b_value_upper[").concat(t,"])")).join(", "),");\n              let b_dequantized_values = (b_quantized_values - mat2x4<").concat(f,">(").concat(Array(8).fill("zero_point").join(","),")) * scale;\n              inter_results[local_id.y][local_id.x] += ").concat(Array.from({length:2},(e,t)=>"".concat("dot(a_data".concat(t,", b_dequantized_values[").concat(t,"])"))).join(" + "),";\n              word_offset += ").concat(8/d,";\n            }\n            workgroupBarrier();\n          }\n\n          if (local_idx < ").concat(p,") {\n            var output_value: ").concat(u.type.value," = ").concat(u.type.value,"(0);\n            for (var b = 0u; b < ").concat(m,"; b++) {\n              output_value += inter_results[local_idx][b];\n            }\n            if (col + local_idx < uniforms.output_shape[2])\n            {\n              ").concat(u.setByIndices("".concat(u.type.indices,"(batch, row, col + local_idx)"),"output_value"),"\n            }\n          }\n        }")}}},Fs=(e,t)=>{Ds(e.inputs,t),32===t.blockSize&&e.adapterInfo.isVendor("intel")&&e.adapterInfo.isArchitecture("gen-12lp")?e.compute(Us(e.inputs,t)):e.compute(Bs(e.inputs,t))},js=e=>un(e)}),xu=re(()=>{El(),Cl(),Ll(),Vs=e=>{if(!e||e.length<1)throw new Error("Too few inputs");if(1!==e[0].dataType&&10!==e[0].dataType)throw new Error("Input type must be float or float16.");if(e.length>=2){let t=2*e[0].dims.length===e[1].dims[0];if(4===e.length&&(t=2*e[3].dims[0]===e[1].dims[0]),!t)throw new Error("The pads should be a 1D tensor of shape [2 * input_rank] or [2 * num_axes].")}},qs=(e,t,n)=>{let i="";for(let r=t-1;r>=0;--r)i+="\n            k = i32(".concat(e.indicesGet("indices",r),") - ").concat(wn("uniforms.pads",r,n),";\n            if (k < 0) {\n              break;\n            }\n            if (k >= i32(").concat(wn("uniforms.x_shape",r,t),")) {\n              break;\n            }\n            offset += k * i32(").concat(wn("uniforms.x_strides",r,t),");\n        ");return"\n          value = ".concat(e.type.value,"(uniforms.constant_value);\n          for (var i = 0; i < 1; i++) {\n            var offset = 0;\n            var k = 0;\n            ").concat(i,"\n            value = x[offset];\n          }\n      ")},Hs=(e,t,n)=>{let i="";for(let r=t-1;r>=0;--r)i+="\n                k = i32(".concat(e.indicesGet("indices",r),") - ").concat(wn("uniforms.pads",r,n),";\n                if (k < 0) {\n                  k = -k;\n                }\n                {\n                  let _2n_1 = 2 * (i32(").concat(wn("uniforms.x_shape",r,t),") - 1);\n                  k = k % _2n_1;\n                  if(k >= i32(").concat(wn("uniforms.x_shape",r,t),")) {\n                    k = _2n_1 - k;\n                  }\n                }\n                offset += k * i32(").concat(wn("uniforms.x_strides",r,t),");\n            ");return"\n              var offset = 0;\n              var k = 0;\n              ".concat(i,"\n              value = x[offset];\n          ")},Ws=(e,t,n)=>{let i="";for(let r=t-1;r>=0;--r)i+="\n                k = i32(".concat(e.indicesGet("indices",r),") - ").concat(wn("uniforms.pads",r,n),";\n                if (k < 0) {\n                  k = 0;\n                }\n                if (k >= i32(").concat(wn("uniforms.x_shape",r,t),")) {\n                  k = i32(").concat(wn("uniforms.x_shape",r,t),") - 1;\n                }\n                offset += k * i32(").concat(wn("uniforms.x_strides",r,t),");\n            ");return"\n              var offset = 0;\n              var k = 0;\n              ".concat(i,"\n              value = x[offset];\n          ")},Gs=(e,t,n)=>{let i="";for(let r=t-1;r>=0;--r)i+="\n                k = i32(".concat(e.indicesGet("indices",r),") - ").concat(wn("uniforms.pads",r,n),";\n                if (k < 0)  {\n                  k += i32(").concat(wn("uniforms.x_shape",r,t),"]);\n                }\n                if (k >= i32(").concat(wn("uniforms.x_shape",r,t),")) {\n                  k -= i32(").concat(wn("uniforms.x_shape",r,t),");\n                }\n                offset += k * i32(").concat(wn("uniforms.x_strides",r,t),");\n            ");return"\n              var offset = 0;\n              var k = 0;\n              ".concat(i,"\n              value = x[offset];\n          ")},Ks=(e,t,n)=>{switch(n.mode){case 0:return qs(e,t,n.pads.length);case 1:return Hs(e,t,n.pads.length);case 2:return Ws(e,t,n.pads.length);case 3:return Gs(e,t,n.pads.length);default:throw new Error("Invalid mode")}},Zs=(e,t)=>{let n=Rt.padShape(e[0].dims.slice(),t.pads),i=e[0].dims,r=[{type:12,data:Rt.size(n)},{type:6,data:t.pads}],o=e.length>=3&&e[2].data;0===t.mode&&r.push({type:o?e[2].dataType:1,data:t.value}),r.push(...mn(e[0].dims,n));return{name:"Pad",shaderCache:{hint:"".concat(t.mode).concat(o),inputDependencies:["rank"]},getRunData:()=>({outputs:[{dims:n,dataType:e[0].dataType}],dispatchGroup:{x:Math.ceil(Rt.size(n)/64)},programUniforms:r}),getShaderSource:r=>{let a=Sn("output",e[0].dataType,n.length),s=xn("x",e[0].dataType,i.length),c=s.type.value,l=Ks(a,i.length,t),u=[{name:"output_size",type:"u32"},{name:"pads",type:"i32",length:t.pads.length}];return 0===t.mode&&u.push({name:"constant_value",type:o?c:"f32"}),"\n            ".concat(r.registerUniforms(u).declareVariables(s,a),"\n            ").concat(r.mainStart(),"\n            ").concat(r.guardAgainstOutOfBoundsWorkgroupSizes("uniforms.output_size"),"\n\n            let indices = ").concat(a.offsetToIndices("global_idx"),";\n\n            var value = ").concat(c,"(0);\n            ").concat(l,"\n            output[global_idx] = value;\n        }")}}},Qs=(e,t)=>{if(e.length>1){let n=e[1].getBigInt64Array(),i=e.length>=3&&e[2].data?10===e[2].dataType?e[2].getUint16Array()[0]:e[2].getFloat32Array()[0]:0,r=e[0].dims.length,o=new Int32Array(2*r).fill(0);if(e.length>=4){let t=e[3].getBigInt64Array();for(let e=0;e<t.length;e++)o[Number(t[e])]=Number(n[e]),o[Number(t[e])+r]=Number(n[e+t.length])}else n.forEach((e,t)=>o[Number(t)]=Number(e));let a=[];return o.forEach(e=>a.push(e)),{mode:t.mode,value:i,pads:a}}return t},Xs=(e,t)=>{Vs(e.inputs);let n=Qs(e.inputs,t);e.compute(Zs(e.inputs,n),{inputs:[0]})}}),Su=re(()=>{ke(),El(),Cl(),Ll(),Ys=e=>{if(I.webgpu.validateInputContent&&(!e||1!==e.length))throw new Error("Pool ops requires 1 input.")},Js=(e,t,n)=>{let i="NHWC"===t.format,r=e.dims.slice();i&&r.splice(1,0,r.pop());let o=Object.hasOwnProperty.call(t,"dilations"),a=t.kernelShape.slice(),s=t.strides.slice(),c=o?t.dilations.slice():[],l=t.pads.slice();Lt.adjustPoolAttributes(n,r,a,s,c,l);let u=Lt.computePoolOutputShape(n,r,s,c,a,l,t.autoPad),d=Object.assign({},t);o?Object.assign(d,{kernelShape:a,strides:s,pads:l,dilations:c,cacheKey:t.cacheKey}):Object.assign(d,{kernelShape:a,strides:s,pads:l,cacheKey:t.cacheKey});let h=u.slice();return h.push(h.splice(1,1)[0]),[d,i?h:u]},$s=(e,t)=>{let n="NHWC"===t.format,i=[{type:12,data:Rt.size(e)},{type:12,data:Rt.size(t.kernelShape)}],r=[{name:"outputSize",type:"u32"},{name:"kernelSize",type:"u32"}];if(t.kernelShape.length<=2){let e=t.kernelShape[t.kernelShape.length-1],n=t.strides[t.strides.length-1],o=t.pads[t.pads.length/2-1],a=t.pads[t.pads.length-1],s=!!(o+a);i.push({type:12,data:e},{type:12,data:n},{type:12,data:o},{type:12,data:a}),r.push({name:"kw",type:"u32"},{name:"sw",type:"u32"},{name:"pwStart",type:"u32"},{name:"pwEnd",type:"u32"});let c=!1;if(2===t.kernelShape.length){let e=t.kernelShape[t.kernelShape.length-2],n=t.strides[t.strides.length-2],o=t.pads[t.pads.length/2-2],a=t.pads[t.pads.length-2];c=!!(o+a),i.push({type:12,data:e},{type:12,data:n},{type:12,data:o},{type:12,data:a}),r.push({name:"kh",type:"u32"},{name:"sh",type:"u32"},{name:"phStart",type:"u32"},{name:"phEnd",type:"u32"})}return[i,r,!0,s,c]}{if(n)throw new Error("Pooling with kernelShape.length > 2 is not supported for NHWC format.");let e=Rt.computeStrides(t.kernelShape);i.push({type:12,data:e},{type:12,data:t.pads},{type:12,data:t.strides}),r.push({name:"kernelStrides",type:"u32",length:e.length},{name:"pads",type:"u32",length:t.pads.length},{name:"strides",type:"u32",length:t.strides.length});let o=t.pads.reduce((e,t)=>e+t);return[i,r,!!o,!1,!1]}},ec=(e,t,n,i,r,o,a,s,c,l,u,d)=>{let h="NHWC"===r.format,f=t.type.value,p=Sn("output",t.type.tensor,i);if(r.kernelShape.length<=2){let i="",l="",m="",g=n-(h?2:1);if(i=u?"\n                for (var i: u32 = 0u; i < uniforms.kw; i++) {\n                  xIndices[".concat(g,"] = indices[").concat(g,"] * uniforms.sw - uniforms.pwStart + i;\n                  if (xIndices[").concat(g,"] < 0 || xIndices[").concat(g,"]\n                      >= uniforms.x_shape[").concat(g,"]) {\n                    pad++;\n                    continue;\n                  }\n                  let x_val = x[").concat(t.indicesToOffset("xIndices"),"];\n                  ").concat(o,"\n                }"):"\n                for (var i: u32 = 0u; i < uniforms.kw; i++) {\n                  xIndices[".concat(g,"] = indices[").concat(g,"] * uniforms.sw - uniforms.pwStart + i;\n                  let x_val = x[").concat(t.indicesToOffset("xIndices"),"];\n                  ").concat(o,"\n                }"),2===r.kernelShape.length){let e=n-(h?3:2);l=d?"\n                for (var j: u32 = 0u; j < uniforms.kh; j++) {\n                  xIndices[".concat(e,"] = indices[").concat(e,"] * uniforms.sh - uniforms.phStart + j;\n                  if (xIndices[").concat(e,"] < 0 || xIndices[").concat(e,"] >= uniforms.x_shape[").concat(e,"]) {\n                    pad += i32(uniforms.kw);\n                    continue;\n                  }\n              "):"\n                for (var j: u32 = 0u; j < uniforms.kh; j++) {\n                  xIndices[".concat(e,"] = indices[").concat(e,"] * uniforms.sh - uniforms.phStart + j;\n                "),m="\n              }\n            "}return"\n            ".concat(e.registerUniforms(c).declareVariables(t,p),"\n\n            ").concat(e.mainStart(),"\n              ").concat(e.guardAgainstOutOfBoundsWorkgroupSizes("uniforms.outputSize"),"\n\n              let indices = ").concat(p.offsetToIndices("global_idx"),";\n              var xIndices = ").concat(p.offsetToIndices("global_idx"),";\n\n              var value = ").concat(f,"(").concat(s,");\n              var pad = 0;\n              ").concat(l,"\n              ").concat(i,"\n              ").concat(m,"\n              ").concat(a,"\n\n              output[global_idx] = value;\n            }")}{if(h)throw new Error("Pooling with kernelShape.length > 2 is not supported for NHWC format.");let i=r.kernelShape.length,u=r.pads.length,d="";return d=l?"\n                if (xIndices[j] >= uniforms.x_shape[j]) {\n                  pad++;\n                  isPad = true;\n                  break;\n                }\n              }\n              if (!isPad) {\n                let x_val = x[".concat(t.indicesToOffset("xIndices"),"];\n                ").concat(o,"\n              }"):"\n              }\n              let x_val = x[".concat(t.indicesToOffset("xIndices"),"];\n              ").concat(o,"\n            "),"\n            ".concat(e.registerUniforms(c).declareVariables(t,p),"\n\n            ").concat(e.mainStart(),"\n              ").concat(e.guardAgainstOutOfBoundsWorkgroupSizes("uniforms.outputSize"),"\n              let indices = ").concat(p.offsetToIndices("global_idx"),";\n              var xIndices = ").concat(p.offsetToIndices("global_idx"),";\n\n              var offsets: array<u32, ").concat(i,">;\n\n              var value = ").concat(f,"(").concat(s,");\n              var pad = 0;\n              var isPad = false;\n\n              for (var i: u32 = 0u; i < uniforms.kernelSize; i++) {\n                var offset = i;\n                for (var j = 0u; j < ").concat(i-1,"u; j++) {\n                  offsets[j] = offset / ").concat(wn("uniforms.kernelStrides","j",i),";\n                  offset -= offsets[j] * ").concat(wn("uniforms.kernelStrides","j",i),";\n                }\n                offsets[").concat(i-1,"] = offset;\n\n                isPad = false;\n                for (var j = ").concat(n-i,"u; j < ").concat(n,"u; j++) {\n                  xIndices[j] = indices[j] * ").concat(wn("uniforms.strides","j - ".concat(n-i,"u"),i),"\n                    + offsets[j - ").concat(n-i,"u] - ").concat(wn("uniforms.pads","j - 2u",u),";\n                  ").concat(d,"\n              }\n              ").concat(a,"\n\n              output[global_idx] = value;\n            }")}},tc=e=>"".concat(e.format,";").concat(e.ceilMode,";").concat(e.autoPad,";").concat(e.kernelShape.length),nc=e=>"".concat(tc(e),";").concat(e.countIncludePad),ic=e=>"".concat(tc(e),";").concat(e.storageOrder,";").concat(e.dilations),rc=e=>({format:e.format,autoPad:["NOTSET","VALID","SAME_UPPER","SAME_LOWER"][e.auto_pad],ceilMode:e.ceil_mode,kernelShape:e.kernel_shape,strides:e.strides,pads:e.pads}),oc=(e,t,n,i)=>{let[r,o]=Js(t,i,n),a=xn("x",t.dataType,t.dims.length),s=a.type.value,c="";r.countIncludePad?c+="value /= ".concat(s,"(uniforms.kernelSize);"):c+="value /= ".concat(s,"(i32(uniforms.kernelSize) - pad);");let[l,u,d,h,f]=$s(o,r);l.push(...mn(t.dims,o));return{name:e,shaderCache:{hint:"".concat(i.cacheKey,";").concat(d,";").concat(h,";").concat(f),inputDependencies:["rank"]},getRunData:()=>({outputs:[{dims:o,dataType:t.dataType}],dispatchGroup:{x:Math.ceil(Rt.size(o)/64)},programUniforms:l}),getShaderSource:e=>ec(e,a,t.dims.length,o.length,r,"value += x_val;",c,0,u,d,h,f)}},ac=e=>{let t=0!==e.count_include_pad,n=rc(e);if(0!==n.ceilMode)throw new Error("using ceil() in shape computation is not yet supported for AveragePool");let i=s(s({countIncludePad:t},n),{},{cacheKey:""});return s(s({},i),{},{cacheKey:nc(i)})},sc=(e,t)=>{Ys(e.inputs),e.compute(oc("AveragePool",e.inputs[0],!1,t))},cc={autoPad:"",ceilMode:0,countIncludePad:!1,kernelShape:[],strides:[],pads:[],storageOrder:0,dilations:[]},lc=e=>{let t=e.format;return s(s({format:t},cc),{},{cacheKey:t})},uc=(e,t)=>{Ys(e.inputs),e.compute(oc("GlobalAveragePool",e.inputs[0],!0,t))},dc=(e,t,n,i)=>{let[r,o]=Js(t,i,n),a=xn("x",t.dataType,t.dims.length),[s,c,l,u,d]=$s(o,r);return s.push(...mn(t.dims,o)),{name:e,shaderCache:{hint:"".concat(i.cacheKey,";").concat(l,";").concat(u,";").concat(d),inputDependencies:["rank"]},getRunData:()=>({outputs:[{dims:o,dataType:t.dataType}],dispatchGroup:{x:Math.ceil(Rt.size(o)/64)},programUniforms:s}),getShaderSource:e=>ec(e,a,t.dims.length,o.length,r,"\n      value = max(x_val, value);\n    ","",10===t.dataType?-65504:-1e5,c,l,u,d)}},hc=(e,t)=>{Ys(e.inputs),e.compute(dc("MaxPool",e.inputs[0],!1,t))},fc=e=>{let t=e.storage_order,n=e.dilations,i=rc(e);if(0!==t)throw new Error("column major storage order is not yet supported for MaxPool");if(0!==i.ceilMode)throw new Error("using ceil() in shape computation is not yet supported for MaxPool");let r=s(s({storageOrder:t,dilations:n},i),{},{cacheKey:""});return s(s({},r),{},{cacheKey:ic(r)})},pc=e=>{let t=e.format;return s(s({format:t},cc),{},{cacheKey:t})},mc=(e,t)=>{Ys(e.inputs),e.compute(dc("GlobalMaxPool",e.inputs[0],!0,t))}}),Eu=re(()=>{El(),Cl(),Rl(),Ll(),gc=(e,t)=>{if(e.length<2||e.length>3)throw new Error("DequantizeLinear requires 2 or 3 inputs.");if(3===e.length&&e[1].dims===e[2].dims)throw new Error("x-scale and x-zero-point must have the same shape.");if(3===e.length&&e[0].dataType!==e[2].dataType)throw new Error("x and x-zero-point must have the same data type.");if(6===e[0].dataType&&e.length>2)throw new Error("In the case of dequantizing int32 there is no zero point.");if(0!==e[1].dims.length&&1!==e[1].dims.length&&e[1].dims.length!==e[0].dims.length)throw new Error("scale input must be a scalar, a 1D tensor, or have the same rank as the input tensor.");if(e.length>2){if(e[0].dataType!==e[2].dataType)throw new Error("x and x-zero-point must have the same data type.");if(e[1].dims.length!==e[2].dims.length)throw new Error("scale and zero-point inputs must have the same rank.");if(!e[1].dims.map((t,n)=>t===e[2].dims[n]).reduce((e,t)=>e&&t,!0))throw new Error("scale and zero-point inputs must have the same shape.")}if(t.blockSize>0){if(0===e[1].dims.length||1===e[1].dims.length&&1===e[1].dims[0])throw new Error("blockSize must be set only for block quantization.");if(!e[1].dims.map((n,i)=>i===t.axis||n===e[0].dims[i]).reduce((e,t)=>e&&t,!0))throw new Error("For block qunatization, scale input shape to match the input shape except for the axis");if(e[1].dims.length!==e[0].dims.length)throw new Error("For block qunatization the scale input rank must be the same as the x rank.");let n=e[0].dims[t.axis],i=e[1].dims[t.axis];if(t.blockSize<Math.ceil(n/i)||t.blockSize>Math.ceil(n/(i-1)-1))throw new Error("blockSize must be with in the range [ceil(dI / Si), ceil(dI / (Si - 1) - 1)].")}},yc=(e,t)=>{let n=Rt.normalizeAxis(t.axis,e[0].dims.length),i=e[0].dataType,r=3===i,o=e[0].dims,a=e[1].dataType,s=Rt.size(o),c=3===i||2===i,l=c?[Math.ceil(Rt.size(e[0].dims)/4)]:e[0].dims,u=e[1].dims,d=e.length>2?e[2]:void 0,h=d?c?[Math.ceil(Rt.size(d.dims)/4)]:d.dims:void 0,f=0===u.length||1===u.length&&1===u[0],p=!1===f&&1===u.length,m=gn(s),g=f&&(!c||4===m),y=g?m:1,v=g&&!c?m:1,_=xn("input",c?12:i,l.length,v),w=xn("scale",a,u.length),b=d?xn("zero_point",c?12:i,h.length):void 0,x=Sn("output",a,o.length,y),S=[_,w];b&&S.push(b);let E=[l,u];d&&E.push(h);let T=[{type:12,data:s/y},{type:12,data:n},{type:12,data:t.blockSize},...mn(...E,o)];return{name:"DequantizeLinear",shaderCache:{hint:t.cacheKey,inputDependencies:b?["rank","rank","rank"]:["rank","rank"]},getShaderSource:e=>"\n      ".concat(e.registerUniforms([{name:"output_size",type:"u32"},{name:"axis",type:"u32"},{name:"block_size",type:"u32"}]).declareVariables(...S,x),"\n      ").concat(e.mainStart(),"\n          ").concat(e.guardAgainstOutOfBoundsWorkgroupSizes("uniforms.output_size"),"\n          let output_indices = ").concat(x.offsetToIndices("global_idx"),";\n\n          // Set input x\n          ").concat(c?"\n            let input = ".concat(_.getByOffset("global_idx / 4"),";\n            let x_vec = ").concat(r?"unpack4xI8(input)":"unpack4xU8(input)",";\n            let x_value = ").concat(1===y?"x_vec[global_idx % 4]":"x_vec",";"):"let x_value = ".concat(_.getByOffset("global_idx"),";"),";\n\n          // Set scale input\n          ").concat(f?"let scale_value= ".concat(w.getByOffset("0")):p?"\n            let scale_index = ".concat(x.indicesGet("output_indices","uniforms.axis"),";\n            let scale_value= ").concat(w.getByOffset("scale_index"),";"):"\n            var scale_indices: ".concat(w.type.indices," = output_indices;\n            let index = ").concat(w.indicesGet("scale_indices","uniforms.axis")," / uniforms.block_size;\n            ").concat(w.indicesSet("scale_indices","uniforms.axis","index"),";\n            let scale_value= ").concat(w.getByIndices("scale_indices"),";"),";\n\n          // Set zero-point input\n          ").concat(b?f?c?"\n                let zero_point_input = ".concat(b.getByOffset("0"),";\n                let zero_point_vec =  ").concat(r?"unpack4xI8(zero_point_input)":"unpack4xU8(zero_point_input)",";\n                let zero_point_value= zero_point_vec[0]"):"let zero_point_value = ".concat(b.getByOffset("0")):p?c?"\n                let zero_point_index = ".concat(x.indicesGet("output_indices","uniforms.axis"),";\n                let zero_point_input = ").concat(b.getByOffset("zero_point_index / 4"),";\n                let zero_point_vec =  ").concat(r?"unpack4xI8(zero_point_input)":"unpack4xU8(zero_point_input)",";\n                let zero_point_value = zero_point_vec[zero_point_index % 4]"):"\n                let zero_point_index = ".concat(x.indicesGet("output_indices","uniforms.axis"),";\n                let zero_point_value = ").concat(b.getByOffset("zero_point_index"),";"):c?"\n                let zero_point_offset = ".concat(w.indicesToOffset("scale_indices"),";\n                let zero_point_input = ").concat(b.getByOffset("zero_point_offset / 4"),";\n                let zero_point_vec = ").concat(r?"unpack4xI8(zero_point_input)":"unpack4xU8(zero_point_input)",";\n                let zero_point_value = zero_point_vec[zero_point_offset % 4];"):"let zero_point_value = ".concat(b.getByIndices("scale_indices"),";"):"let zero_point_value = ".concat(c?r?"i32":"u32":_.type.value,"(0);"),";\n      // Compute and write output\n      ").concat(x.setByOffset("global_idx","".concat(x.type.value,"(x_value - zero_point_value) * scale_value")),";\n      }"),getRunData:()=>({outputs:[{dims:o,dataType:a}],dispatchGroup:{x:Math.ceil(s/y/64),y:1,z:1},programUniforms:T})}},vc=(e,t)=>{gc(e.inputs,t),e.compute(yc(e.inputs,t))},_c=e=>un({axis:e.axis,blockSize:e.blockSize})}),Tu=re(()=>{ke(),El(),Ll(),wc=(e,t,n)=>{if(e===t||e<t&&n<0||e>t&&n>0)throw new Error("Range these inputs' contents are invalid.")},bc=(e,t,n,i)=>{let r=Math.abs(Math.ceil((t-e)/n)),o=[r],a=r,s=[{type:12,data:a},{type:i,data:e},{type:i,data:n},...mn(o)];return{name:"Range",shaderCache:{hint:"".concat(i)},getShaderSource:e=>{let t=Sn("output",i,o.length),n=t.type.value,r=[{name:"outputSize",type:"u32"},{name:"start",type:n},{name:"delta",type:n}];return"\n        ".concat(e.registerUniforms(r).declareVariables(t),"\n        ").concat(e.mainStart(),"\n        ").concat(e.guardAgainstOutOfBoundsWorkgroupSizes("uniforms.outputSize"),"\n        output[global_idx] = uniforms.start + ").concat(n,"(global_idx) * uniforms.delta;\n      }")},getRunData:()=>({outputs:[{dims:o,dataType:i}],dispatchGroup:{x:Math.ceil(a/64)},programUniforms:s})}},xc=e=>{let t=0,n=0,i=0;6===e.inputs[0].dataType?(t=e.inputs[0].getInt32Array()[0],n=e.inputs[1].getInt32Array()[0],i=e.inputs[2].getInt32Array()[0]):1===e.inputs[0].dataType&&(t=e.inputs[0].getFloat32Array()[0],n=e.inputs[1].getFloat32Array()[0],i=e.inputs[2].getFloat32Array()[0]),I.webgpu.validateInputContent&&wc(t,n,i),e.compute(bc(t,n,i,e.inputs[0].dataType),{inputs:[]})}}),ku=re(()=>{El(),Cl(),Rl(),Ll(),Sc=(e,t,n,i)=>{if("none"!==e&&"i32"!==i&&"u32"!==i&&"f32"!==i)throw new Error("Input ".concat(i," is not supported with reduction ").concat(e,"."));let r="{\n                var oldValue = 0;\n                loop {\n                  let newValueF32 =",o=";\n                  let newValue = bitcast<i32>(newValueF32);\n                  let res = atomicCompareExchangeWeak(&".concat(t,", oldValue, newValue);\n                  if res.exchanged {\n                    break;\n                  }\n                  oldValue = res.old_value;\n                }\n              }");switch(e){case"none":return"".concat(t,"=").concat(n,";");case"add":return"i32"===i||"u32"===i?"atomicAdd(&".concat(t,", bitcast<").concat(i,">(").concat(n,"));"):"\n              ".concat(r,"bitcast<").concat(i,">(oldValue) + (").concat(n,")").concat(o);case"max":return"i32"===i||"u32"===i?"atomicMax(&".concat(t,", bitcast<").concat(i,">(").concat(n,"));"):"\n                ".concat(r,"max(bitcast<f32>(oldValue), (").concat(n,"))").concat(o);case"min":return"i32"===i||"u32"===i?"atomicMin(&".concat(t,", bitcast<").concat(i,">(").concat(n,"));"):"".concat(r,"min(bitcast<").concat(i,">(oldValue), (").concat(n,"))").concat(o);case"mul":return"".concat(r,"(bitcast<").concat(i,">(oldValue) * (").concat(n,"))").concat(o);default:throw new Error("Reduction ".concat(e," is not supported."))}},Ec=(e,t)=>{let n=e[0].dims,i=e[1].dims,r=n,o=Math.ceil(Rt.sizeToDimension(i,i.length-1)/1),a=i[i.length-1],s=Rt.sizeFromDimension(n,a),c=[{type:12,data:o},{type:12,data:a},{type:12,data:s},...mn(e[1].dims,e[2].dims,r)];return{name:"ScatterND",shaderCache:{hint:"".concat(t.cacheKey,"_").concat(t.reduction),inputDependencies:["rank","rank"]},getRunData:()=>({outputs:[{dims:r,dataType:e[0].dataType}],dispatchGroup:{x:Math.ceil(o/64)},programUniforms:c}),getShaderSource:n=>{let i=xn("indices",e[1].dataType,e[1].dims.length),o=xn("updates",e[2].dataType,e[2].dims.length,1),a="none"!==t.reduction&&""!==t.reduction?En("output",e[0].dataType,r.length):Sn("output",e[0].dataType,r.length,1);return"\n      ".concat(n.registerUniform("output_size","u32").registerUniform("last_index_dimension","u32").registerUniform("num_updates_elements","u32").declareVariables(i,o,a),"\n      ").concat(n.mainStart(),"\n        ").concat(n.guardAgainstOutOfBoundsWorkgroupSizes("uniforms.output_size"),"\n  var data_offset = 0u;\n  let indices_start = uniforms.last_index_dimension * global_idx;\n  let indices_end = indices_start + uniforms.last_index_dimension;\n  for (var i = indices_start; i < indices_end; i++) {\n    var index = i32(indices[i].x);\n    ").concat(1===e[0].dims.length?"\n    let element_count_dim = uniforms.output_strides;\n    let dim_value = uniforms.output_shape;":"\n    let element_count_dim = uniforms.output_strides[i - indices_start];\n    let dim_value = uniforms.output_shape[i - indices_start];","\n    if (index >= 0) {\n      if (index >= i32(dim_value)) {\n        index = i32(dim_value - 1);\n      }\n    } else {\n      if (index < -i32(dim_value)) {\n        index = 0;\n      } else {\n        index += i32(dim_value);\n      }\n    }\n    data_offset += u32((u32(index) * element_count_dim));\n  }\n\n  for (var i = 0u; i < uniforms.num_updates_elements; i++) {\n    let value = updates[uniforms.num_updates_elements * global_idx + i];\n    ").concat(Sc(t.reduction,"output[data_offset + i]","value",a.type.value),"\n  }\n\n      }")}}},Tc=e=>un({reduction:e.reduction}),kc=(e,t)=>{e.compute(Ec(e.inputs,t),{inputs:[e.inputs[1],e.inputs[2]],outputs:[]})}}),Cu=re(()=>{El(),Cl(),Rl(),Ll(),Cc=(e,t)=>{if(e.every(e=>e>0||(()=>{throw new Error("Resize requires scales input values to be positive")})),e.length>0)if("linear"===t.mode){if(!(2===e.length||3===e.length||4===e.length&&1===e[0]&&1===e[1]||4===e.length&&1===e[0]&&1===e[3]||5===e.length&&1===e[0]&&1===e[1]))throw new Error("For linear mode, Resize requires scales to be 2D, 3D, 4D with either two outermost or one innermost and\n            one outermost scale values equal to 1, or 5D with two outermost scale values equal to 1")}else if("cubic"===t.mode&&!(2===e.length||4===e.length&&1===e[0]&&1===e[1]||4===e.length&&1===e[0]&&1===e[3]))throw new Error("Resize requires scales input size to be 2 or 4 for cubic mode")},Ic=(e,t,n)=>{t.every(e=>e>=0&&e<n||(()=>{throw new Error("Resize requires axes input values to be positive and less than rank")}));let i=new Array(n).fill(1);return t.forEach((t,n)=>i[t]=e[n]),i},Ac=(e,t,n,i,r,o)=>{let[a,s,c]=n>10?[1,2,3]:[-1,e.length>1?1:-1,-1],l=e[0].dims.length;if(a>0&&e.length>a&&e[a].dims.length>0)e[a].getFloat32Array().forEach(e=>o.push(e));else if("tf_crop_and_resize"===t.coordinateTransformMode)throw new Error("Resize requires RoI input to be specified when coordinateTransformMode is tfCropAndResize");if(s>0&&e.length>s&&1===e[s].dims.length&&e[s].dims[0]>0){if(e[s].getFloat32Array().forEach(e=>i.push(e)),0!==i.length&&i.length!==l&&n>=18&&i.length!==t.axes.length)throw new Error("Resize requires scales input size to be same as input rank or axes size for opset 18 and up");Cc(i,t),t.axes.length>0&&Ic(i,t.axes,l).forEach((e,t)=>i[t]=e)}if(c>0&&e.length>c&&1===e[c].dims.length&&e[c].dims[0]>0&&(e[c].getBigInt64Array().forEach(e=>r.push(Number(e))),0!==r.length&&r.length!==l&&n>=18&&r.length!==t.axes.length))throw new Error("Resize requires sizes input size to be same as input rank or axes size for opset 18 and up");if(t.axes.length>0){if(0!==i.length&&i.length!==t.axes.length)throw new Error('Resize requires "scales" input size to be of axes rank when axes attributes is specified');if(0!==r.length&&r.length!==t.axes.length)throw new Error('Resize requires "sizes" input size to be of rank axes rank when axes attributes is specified')}if(typeof i<"u"&&typeof r<"u"&&i.length>0&&r.length>l)throw new Error("Resize requires only of scales or sizes to be specified")},Nc=(e,t,n,i)=>"\n  // The whole part and the fractional part are calculated separately due to inaccuracy of floating\n  // point division. As an example, f32(21) / f32(7) may evaluate to 2.99... instead of 3, causing an\n  // offset-by-one error later in floor().\n  let big = (".concat(e,") * (").concat(t,");\n  let whole = ").concat(i,"(big / (").concat(n,"));\n  let fract = ").concat(i,"(big % (").concat(n,")) / ").concat(i,"(").concat(n,");\n  return whole + fract;\n"),Oc=(e,t)=>"fn getOriginalCoordinateFromResizedCoordinate(xResized: u32, xScale: f32, lengthResized: u32,\n     lengthOriginal: u32, roiStart: f32, roiEnd: f32) -> ".concat(t," { ")+(()=>{switch(e){case"asymmetric":return"\n          if (xScale < 1.0 || floor(xScale) != xScale) {\n            return ".concat(t,"(xResized) / ").concat(t,"(xScale);\n          } else {\n            ").concat(Nc("xResized","lengthOriginal","lengthResized",t),"\n          }\n        ");case"pytorch_half_pixel":return"if (lengthResized > 1) {\n                    return (".concat(t,"(xResized) + 0.5) / ").concat(t,"(xScale) - 0.5;\n                  } else {\n                    return 0.0;\n                  }");case"tf_half_pixel_for_nn":return"return (".concat(t,"(xResized) + 0.5) / ").concat(t,"(xScale);");case"align_corners":return"if (lengthResized == 1) {\n                    return 0.0;\n                  } else {\n                    ".concat(Nc("xResized","lengthOriginal - 1","lengthResized - 1",t),"\n                  }");case"tf_crop_and_resize":return"if (lengthResized > 1) {\n                    return ".concat(t,"(roiStart) * ").concat(t,"(lengthOriginal - 1) +\n                        (").concat(t,"(xResized) * ").concat(t,"(roiEnd - roiStart) * ").concat(t,"(lengthOriginal - 1)) /\n                        ").concat(t,"(lengthResized - 1);\n                  } else {\n                    return 0.5 * ").concat(t,"(roiStart + roiEnd) * ").concat(t,"(lengthOriginal - 1);\n                  }");case"half_pixel_symmetric":return"const outputWidth = ".concat(t,"xScale * ").concat(t,"(lengthResized);\n                  const adjustment = ").concat(t,"(lengthResized) / outputWidth;\n                  const center = ").concat(t,"(lengthOriginal) / 2;\n                  const offset = center * (1 - adjustment);\n                  return offset + ((").concat(t,"(xResized) + 0.5) / ").concat(t,"(xScale)) - 0.5;");case"half_pixel":return"return ((".concat(t,"(xResized) + 0.5) / ").concat(t,"(xScale)) - 0.5;");default:throw new Error("Coordinate transform mode ".concat(e," is not supported"))}})()+"}",Pc=(e,t,n)=>"fn getNearestPixelFromOriginal(xOriginal: ".concat(n,", isDownSample: bool) -> ").concat(n," {")+(()=>{switch(e){case"round_prefer_ceil":return"if (fract(xOriginal) == 0.5) {             return ceil(xOriginal);           } else {             return round(xOriginal);           }";case"floor":return"return floor(xOriginal);";case"ceil":return"return ceil(xOriginal);";case"round_prefer_floor":return"if (fract(xOriginal) == 0.5) {                     return floor(xOriginal);                   } else {                     return round(xOriginal);                   }";default:if(t<11)return"if (isDownSample)                     {                       return ceil(xOriginal);                     } else {                       return xOriginal;                     }";throw new Error("Nearest mode ".concat(e," is not supported"))}})()+"}",Rc=(e,t,n)=>{let i=new Array(n).fill(0).concat(new Array(n).fill(1)),r=0===e.length?i:e.slice();return t.length>0?(t.forEach((e,o)=>{i[e]=r[o],i[o+n]=r[t.length+o]}),i):r},Lc=(e,t,n,i)=>{let r=[];if(n.length>0)if(i.length>0){if(e.forEach(e=>r.push(e)),Math.max(...i)>e.length)throw new Error("axes is out of bound");i.forEach((e,t)=>r[e]=n[t])}else n.forEach(e=>r.push(e));else{if(0===t.length)throw new Error("Resize requires either scales or sizes.");r=e.map((e,n)=>Math.round(e*t[n]))}return r},zc=(e,t,n)=>{let i=(()=>{switch(n.keepAspectRatioPolicy){case"not_larger":return n.axes.length>0?Math.min(...n.axes.map(e=>t[e]),Number.MAX_VALUE):Math.min(...t,Number.MAX_VALUE);case"not_smaller":return n.axes.length>0?Math.max(...n.axes.map(e=>t[e]),Number.MIN_VALUE):Math.max(...t,Number.MIN_VALUE);default:throw new Error("Keep aspect ratio policy ".concat(n.keepAspectRatioPolicy," is not supported"))}})();t.fill(1,0,t.length);let r=e.slice();return n.axes.length>0?(n.axes.forEach(e=>t[e]=i),n.axes.forEach(n=>r[n]=Math.round(e[n]*t[n]))):(t.fill(i,0,t.length),r.forEach((e,n)=>r[n]=Math.round(e*t[n]))),r},Mc=(e,t,n,i,r)=>"\n    fn calculateOriginalIndicesFromOutputIndices(output_indices: ".concat(e.type.indices,") -> array<").concat(e.type.value,", ").concat(n.length,"> {\n      var original_indices: array<").concat(e.type.value,", ").concat(n.length,">;\n      for (var i:u32 = 0; i < ").concat(n.length,"; i++) {\n        var output_index = ").concat(e.indicesGet("output_indices","i"),";\n        var scale = ").concat(wn("uniforms.scales","i",i),";\n        var roi_low = ").concat(wn("uniforms.roi","i",r),";\n        var roi_hi = ").concat(wn("uniforms.roi","i + ".concat(t.length),r),";\n        if (scale == 1.0) {\n          original_indices[i] = ").concat(e.type.value,"(output_index);\n        } else {\n          var input_shape_i = ").concat(wn("uniforms.input_shape","i",t.length),";\n          var output_shape_i = ").concat(wn("uniforms.output_shape","i",n.length),";\n          original_indices[i] = getOriginalCoordinateFromResizedCoordinate(output_index, scale, output_shape_i,\n                                                                           input_shape_i, roi_low, roi_hi);\n        }\n      }\n      return original_indices;\n    }"),Dc=(e,t,n,i,r,o,a)=>"\n    fn calculateInputIndicesFromOutputIndices(output_indices: ".concat(t.type.indices,") -> ").concat(e.type.indices," {\n      var input_indices: ").concat(e.type.indices,";\n      for (var i:u32 = 0; i < ").concat(i.length,"; i++) {\n        var output_index = ").concat(t.indicesGet("output_indices","i"),";\n        var input_index: u32;\n        var scale = ").concat(wn("uniforms.scales","i",r),";\n        if (scale == 1.0) {\n          input_index = output_index;\n        } else {\n          var roi_low = ").concat(wn("uniforms.roi","i",o),";\n          var roi_hi = ").concat(wn("uniforms.roi","i + ".concat(n.length),o),";\n          var input_shape_i = ").concat(wn("uniforms.input_shape","i",n.length),";\n          var output_shape_i = ").concat(wn("uniforms.output_shape","i",i.length),";\n          var original_idx = getOriginalCoordinateFromResizedCoordinate(output_index, scale, output_shape_i,\n                                                                        input_shape_i, roi_low, roi_hi);\n          if (!").concat(a," || (original_idx >= 0 && original_idx < ").concat(t.type.value,"(input_shape_i))) {\n            if (original_idx < 0) {\n              input_index = 0;\n            } else if (original_idx > ").concat(t.type.value,"(input_shape_i - 1)) {\n              input_index = input_shape_i - 1;\n            } else {\n              input_index = u32(getNearestPixelFromOriginal(original_idx, scale < 1));\n            }\n          } else {\n            input_index = u32(original_idx);\n          }\n        }\n        ").concat(e.indicesSet("input_indices","i","input_index"),"\n      }\n      return input_indices;\n    }"),Bc=(e,t)=>"\n    fn checkInputIndices(input_indices: ".concat(e.type.indices,") -> bool {\n      for (var i:u32 = 0; i < ").concat(t.length,"; i++) {\n        var input_index = ").concat(e.indicesGet("input_indices","i"),";\n        if (input_index < 0 || input_index >= ").concat(wn("uniforms.input_shape","i",t.length),") {\n          return false;\n        }\n      }\n      return true;\n    }"),Uc=(e,t,n,i)=>e.rank>i?"\n    ".concat(e.indicesSet("input_indices",t,"channel"),";\n    ").concat(e.indicesSet("input_indices",n,"batch"),";\n"):"",Fc=(e,t,n,i,r)=>{let[o,a,s,c]=2===n.length?[-1,0,1,-1]:[0,2,3,1],l=e.type.value;return"\n    fn getInputValue(batch: u32, channel: u32, row: u32, col: u32) -> ".concat(l," {\n      var input_indices: ").concat(e.type.indices,";\n      ").concat(e.indicesSet("input_indices",a,"max(0, min(row, ".concat(n[a]," - 1))")),";\n      ").concat(e.indicesSet("input_indices",s,"max(0, min(col, ".concat(n[s]," - 1))")),";\n      ").concat(Uc(e,c,o,2),"\n      return ").concat(e.getByIndices("input_indices"),";\n    }\n\n    fn bilinearInterpolation(output_indices: ").concat(t.type.indices,") -> ").concat(l," {\n      var originalIndices = calculateOriginalIndicesFromOutputIndices(output_indices);\n      var row:").concat(l," = originalIndices[").concat(a,"];\n      var col:").concat(l," = originalIndices[").concat(s,"];\n      ").concat(i?"if (row < 0 || row > (".concat(n[a]," - 1) || col < 0 || col > (").concat(n[s]," - 1)) {\n        return ").concat(r,";\n      }"):"",";\n      row = max(0, min(row, ").concat(n[a]," - 1));\n      col = max(0, min(col, ").concat(n[s]," - 1));\n      var row1: u32 = u32(row);\n      var col1: u32 = u32(col);\n      var row2: u32 = u32(row + 1);\n      var col2: u32 = u32(col + 1);\n      var channel: u32 = ").concat(n.length>2?"u32(originalIndices[".concat(c,"])"):"0",";\n      var batch: u32 =  ").concat(n.length>2?"u32(originalIndices[".concat(o,"])"):"0",";\n      var x11: ").concat(l," = getInputValue(batch, channel, row1, col1);\n      var x12: ").concat(l," = getInputValue(batch, channel, row1, col2);\n      var x21: ").concat(l," = getInputValue(batch, channel, row2, col1);\n      var x22: ").concat(l," = getInputValue(batch, channel, row2, col2);\n      var dx1: ").concat(l," = abs(row - ").concat(l,"(row1));\n      var dx2: ").concat(l," = abs(").concat(l,"(row2) - row);\n      var dy1: ").concat(l," = abs(col - ").concat(l,"(col1));\n      var dy2: ").concat(l," = abs(").concat(l,"(col2) - col);\n      if (row1 == row2) {\n        dx1 = 0.5;\n        dx2 = 0.5;\n      }\n      if (col1 == col2) {\n        dy1 = 0.5;\n        dy2 = 0.5;\n      }\n      return (x11 * dx2 * dy2 + x12 * dx2 * dy1 + x21 * dx1 * dy2 + x22 * dx1 * dy1);\n    }")},jc=(e,t,n,i,r,o,a,s,c,l)=>{let u=2===n.length,[d,h]=u?[0,1]:[2,3],f=e.type.value,p=a=>{let u=a===d?"row":"col";return"\n      fn ".concat(u,"CubicInterpolation(input_indices: ").concat(e.type.indices,", output_indices: ").concat(t.type.indices,") -> ").concat(f," {\n        var output_index = ").concat(t.indicesGet("output_indices",a),";\n        var originalIdx: ").concat(f," = getOriginalCoordinateFromResizedCoordinate(output_index, ").concat(r[a],",\n        ").concat(i[a],", ").concat(n[a],", ").concat(o[a],", ").concat(o[a]," + ").concat(n.length,");\n        var fractOriginalIdx: ").concat(f," = originalIdx - floor(originalIdx);\n        var coefs = getCubicInterpolationCoefs(fractOriginalIdx);\n\n        if (").concat(s," && (originalIdx < 0 || originalIdx > (").concat(n[a]," - 1))) {\n          return ").concat(c,";\n        }\n        var data: array<").concat(f,", 4> = array<").concat(f,", 4>(0.0, 0.0, 0.0, 0.0);\n        for (var i: i32 = -1; i < 3; i++) {\n          var ").concat(u,": ").concat(f," = originalIdx + ").concat(f,"(i);\n          if (").concat(u," < 0 || ").concat(u," >= ").concat(n[a],") {\n            ").concat(l?"coefs[i + 1] = 0.0;\n                        continue;":s?"return ".concat(c,";"):"".concat(u," = max(0, min(").concat(u,", ").concat(n[a]," - 1));"),";\n          }\n        var input_indices_copy: ").concat(e.type.indices," = input_indices;\n          ").concat(e.indicesSet("input_indices_copy",a,"u32(".concat(u,")")),";\n          data[i + 1] = ").concat(a===d?e.getByIndices("input_indices_copy"):"rowCubicInterpolation(input_indices_copy, output_indices)",";\n        }\n        return cubicInterpolation1D(data, coefs);\n      }")};return"\n    ".concat(p(d),";\n    ").concat(p(h),";\n  fn getCubicInterpolationCoefs(s: ").concat(f,") -> array<").concat(f,", 4> {\n    var absS = abs(s);\n    var coeffs: array<").concat(f,", 4> = array<").concat(f,", 4>(0.0, 0.0, 0.0, 0.0);\n    var oneMinusAbsS: ").concat(f," = 1.0 - absS;\n    var twoMinusAbsS: ").concat(f," = 2.0 - absS;\n    var onePlusAbsS: ").concat(f," = 1.0 + absS;\n    coeffs[0] = ((").concat(a," * onePlusAbsS - 5 * ").concat(a,") * onePlusAbsS + 8 * ").concat(a,") * onePlusAbsS - 4 * ").concat(a,";\n    coeffs[1] = ((").concat(a," + 2) * absS - (").concat(a," + 3)) * absS * absS + 1;\n    coeffs[2] = ((").concat(a," + 2) * oneMinusAbsS - (").concat(a," + 3)) * oneMinusAbsS * oneMinusAbsS + 1;\n    coeffs[3] = ((").concat(a," * twoMinusAbsS - 5 * ").concat(a,") * twoMinusAbsS + 8 * ").concat(a,") * twoMinusAbsS - 4 * ").concat(a,";\n    return coeffs;\n  }\n\n  fn cubicInterpolation1D(x: array<").concat(f,", 4>, coefs: array<").concat(f,", 4>) -> ").concat(f," {\n    var coefsSum: ").concat(f," = coefs[0] + coefs[1] + coefs[2] + coefs[3];\n    return (x[0] * coefs[0] + x[1] * coefs[1]+ x[2] * coefs[2]+ x[3] * coefs[3]) / coefsSum;\n  }\n\n  fn bicubicInterpolation(output_indices: ").concat(t.type.indices,") -> ").concat(f," {\n    var input_indices: ").concat(e.type.indices," = output_indices;\n    return colCubicInterpolation(input_indices, output_indices);\n  }\n    ")},Vc=(e,t,n,i,r)=>{let[o,a,s,c,l]=3===n.length?[-1,0,1,2,-1]:[0,2,3,4,1],u=e.type.value;return"\n    fn getInputValue(batch: u32, channel: u32, depth:u32, height: u32, width: u32) -> ".concat(u," {\n      var input_indices: ").concat(e.type.indices,";\n      ").concat(e.indicesSet("input_indices",a,"max(0, min(depth, ".concat(n[a]," - 1))")),";\n      ").concat(e.indicesSet("input_indices",s,"max(0, min(height, ".concat(n[s]," - 1))")),";\n      ").concat(e.indicesSet("input_indices",c,"max(0, min(width, ".concat(n[c]," - 1))")),";\n      ").concat(Uc(e,l,o,3),"\n      return ").concat(e.getByIndices("input_indices"),";\n    }\n\n    fn trilinearInterpolation(output_indices: ").concat(t.type.indices,") -> ").concat(u," {\n      var originalIndices = calculateOriginalIndicesFromOutputIndices(output_indices);\n      var depth:").concat(u," = originalIndices[").concat(a,"];\n      var height:").concat(u," = originalIndices[").concat(s,"];\n      var width:").concat(u," = originalIndices[").concat(c,"];\n      ").concat(i?"if (depth < 0 || depth > (".concat(n[a]," - 1) || height < 0 || height > (").concat(n[s]," - 1) || width < 0 || (width > ").concat(n[c]," - 1)) {\n      return ").concat(r,";\n        }"):"",";\n\n    depth = max(0, min(depth, ").concat(n[a]," - 1));\n      height = max(0, min(height, ").concat(n[s]," - 1));\n      width = max(0, min(width, ").concat(n[c]," - 1));\n      var depth1: u32 = u32(depth);\n      var height1: u32 = u32(height);\n      var width1: u32 = u32(width);\n      var depth2: u32 = u32(depth + 1);\n      var height2: u32 = u32(height + 1);\n      var width2: u32 = u32(width + 1);\n      var channel: u32 = ").concat(n.length>3?"u32(originalIndices[".concat(l,"])"):"0",";\n      var batch: u32 =  ").concat(n.length>3?"u32(originalIndices[".concat(o,"])"):"0",";\n\n      var x111: ").concat(u," = getInputValue(batch, channel, depth1, height1, width1);\n      var x112: ").concat(u," = getInputValue(batch, channel, depth1, height1, width2);\n      var x121: ").concat(u," = getInputValue(batch, channel, depth1, height2, width1);\n      var x122: ").concat(u," = getInputValue(batch, channel, depth1, height2, width2);\n      var x211: ").concat(u," = getInputValue(batch, channel, depth2, height1, width1);\n      var x212: ").concat(u," = getInputValue(batch, channel, depth2, height1, width2);\n      var x221: ").concat(u," = getInputValue(batch, channel, depth2, height2, width1);\n      var x222: ").concat(u," = getInputValue(batch, channel, depth2, height2, width2);\n      var dx1: ").concat(u," = abs(depth - ").concat(u,"(depth1));\n      var dx2: ").concat(u," = abs(").concat(u,"(depth2) - depth);\n      var dy1: ").concat(u," = abs(height - ").concat(u,"(height1));\n      var dy2: ").concat(u," = abs(").concat(u,"(height2) - height);\n      var dz1: ").concat(u," = abs(width - ").concat(u,"(width1));\n      var dz2: ").concat(u," = abs(").concat(u,"(width2) - width);\n      if (depth1 == depth2) {\n        dx1 = 0.5;\n        dx2 = 0.5;\n      }\n      if (height1 == height2) {\n        dy1 = 0.5;\n        dy2 = 0.5;\n      }\n      if (width1 == width2) {\n        dz1 = 0.5;\n        dz2 = 0.5;\n      }\n      return (x111 * dx2 * dy2 * dz2 + x112 * dx2 * dy2 * dz1 + x121 * dx2 * dy1 *dz2 + x122 * dx2 * dy1 * dz1 +\n              x211 * dx1 * dy2 * dz2 + x212 * dx1 * dy2 * dz1 + x221 * dx1 * dy1 *dz2 + x222 * dx1 * dy1 * dz1);\n    }")},qc=(e,t,n,i,r,o)=>{let a=e.dims,s=Rc(o,t.axes,a.length),c=Lc(a,i,r,t.axes),l=i.slice();0===i.length&&(l=a.map((e,t)=>0===e?1:c[t]/e),"stretch"!==t.keepAspectRatioPolicy&&(c=zc(a,l,t)));let u=Sn("output",e.dataType,c.length),d=xn("input",e.dataType,a.length),h=Rt.size(c),f=a.length===c.length&&a.every((e,t)=>e===c[t]),p="tf_crop_and_resize"===t.coordinateTransformMode,m=t.extrapolationValue,g=d.type.value;return{name:"Resize",shaderCache:{hint:"".concat(t.cacheKey,"|").concat(n,"|").concat(l.length>0?"cubic"===t.mode?l:l.length:"","|").concat(r.length>0?r:"","|").concat(s.length>0?s:"","|").concat(f,"|").concat("nearest"===t.mode?a.length:a),inputDependencies:["rank"]},getShaderSource:e=>"\n      ".concat(f?"":"\n      ".concat(Oc(t.coordinateTransformMode,g),";\n      ").concat((()=>{switch(t.mode){case"nearest":return"\n              ".concat(Bc(d,a),";\n              ").concat(Pc(t.nearestMode,n,g),";\n              ").concat(Dc(d,u,a,c,l.length,s.length,p),";\n              ");case"linear":return"\n              ".concat(Mc(u,a,c,l.length,s.length),";\n              ").concat((()=>{if(2===a.length||4===a.length)return"".concat(Fc(d,u,a,p,m));if(3===a.length||5===a.length)return"".concat(Vc(d,u,a,p,m));throw Error("Linear mode only supports input dims 2, 3, 4 and 5 are supported in linear mode.")})(),";\n            ");case"cubic":return"\n            ".concat((()=>{if(2===a.length||4===a.length)return"".concat(jc(d,u,a,c,l,s,t.cubicCoeffA,p,t.extrapolationValue,t.excludeOutside));throw Error("Cubic mode only supports input dims 2 and 4 are supported in linear mode.")})(),";\n            ");default:throw Error("Invalid resize mode")}})(),";\n      "),"\n      ").concat(e.registerUniform("output_size","u32").registerUniform("scales","f32",l.length).registerUniform("roi","f32",s.length).declareVariables(d,u),"\n      ").concat(e.mainStart(),"\n        ").concat(e.guardAgainstOutOfBoundsWorkgroupSizes("uniforms.output_size"),"\n        ").concat(f?"output[global_idx] = input[global_idx];":"\n        let output_indices = ".concat(u.offsetToIndices("global_idx"),";\n        var input_indices: ").concat(d.type.indices,";\n        ").concat((()=>{switch(t.mode){case"nearest":return"input_indices = calculateInputIndicesFromOutputIndices(output_indices);\n                if (checkInputIndices(input_indices)) {\n                  output[global_idx] = ".concat(d.getByIndices("input_indices"),";\n                } else {\n                  output[global_idx] = ").concat(t.extrapolationValue,";\n                }");case"linear":return"output[global_idx] = ".concat(2===a.length||4===a.length?"bilinearInterpolation":"trilinearInterpolation","(output_indices);");case"cubic":return"output[global_idx] = bicubicInterpolation(output_indices);";default:throw Error("Unsupported resize mode: ".concat(t.mode))}})(),";\n"),"\n      }"),getRunData:()=>({outputs:[{dims:c,dataType:e.dataType}],dispatchGroup:{x:Math.ceil(h/64)},programUniforms:[{type:12,data:h},{type:1,data:l},{type:1,data:s},...mn(a,c)]})}},Hc=e=>{let t=e.customDataBuffer;return new Uint32Array(t,t.byteOffset,1)[0]},Wc=(e,t)=>{let n=[],i=[],r=[],o=Hc(e);if(0!==t.antialias)throw Error("Only default value (0) for Antialias attribute is supported");Ac(e.inputs,t,o,n,i,r),e.compute(qc(e.inputs[0],t,o,n,i,r),{inputs:[0]})},Gc=e=>{let t=e.antialias,n=e.axes,i=e.coordinateTransformMode,r=e.cubicCoeffA,o=0!==e.excludeOutside,a=e.extrapolationValue,s=e.keepAspectRatioPolicy,c=e.mode,l=""===e.nearestMode?"simple":e.nearestMode;return un({antialias:t,axes:n,coordinateTransformMode:i,cubicCoeffA:r,excludeOutside:o,extrapolationValue:a,keepAspectRatioPolicy:s,mode:c,nearestMode:l})}}),Iu=re(()=>{El(),Cl(),Ll(),Kc=e=>{if(!e||e.length<3)throw new Error("layerNorm requires at least 3 inputs.");let t=e[0],n=e[1],i=e[2];if(t.dataType!==n.dataType||t.dataType!==i.dataType)throw new Error("All inputs must have the same data type");if(3!==t.dims.length&&2!==t.dims.length)throw new Error("Input must be 2D or 3D");if(3!==n.dims.length&&2!==n.dims.length)throw new Error("Skip must be 2D or 3D");let r=t.dims[t.dims.length-1],o=t.dims[t.dims.length-2];if(n.dims[n.dims.length-1]!==r)throw new Error("Skip must have the same hidden size as input");if(n.dims[n.dims.length-2]!==o)throw new Error("Skip must have the same sequence length as input");if(1!==i.dims.length)throw new Error("Gamma must be 1D");if(i.dims[i.dims.length-1]!==r)throw new Error("Gamma must have the same hidden size as input");if(e.length>3){let t=e[3];if(1!==t.dims.length)throw new Error("Beta must be 1D");if(t.dims[t.dims.length-1]!==r)throw new Error("Beta must have the same hidden size as input")}if(e.length>4){let t=e[4];if(1!==t.dims.length)throw new Error("Bias must be 1D");if(t.dims[t.dims.length-1]!==r)throw new Error("Bias must have the same hidden size as input")}},Zc=(e,t,n,i)=>{let r=t.simplified,o=e[0].dims,a=Rt.size(o),s=o,c=a,l=o.slice(-1)[0],u=i?o.slice(0,-1).concat(1):[],d=!r&&e.length>3,h=e.length>4,f=i&&n>1,p=i&&n>2,m=n>3,g=64,y=gn(l),v=[{type:12,data:c},{type:12,data:y},{type:12,data:l},{type:1,data:t.epsilon}],_=[{dims:s,dataType:e[0].dataType}];return n>1&&_.push({dims:u,dataType:1}),n>2&&_.push({dims:u,dataType:1}),n>3&&_.push({dims:o,dataType:e[0].dataType}),{name:"SkipLayerNormalization",shaderCache:{hint:"".concat(y,";").concat(f,";").concat(p,";").concat(m),inputDependencies:e.map((e,t)=>"type")},getShaderSource:t=>{let n=[xn("x",e[0].dataType,e[0].dims,y),xn("skip",e[1].dataType,e[1].dims,y),xn("gamma",e[2].dataType,e[2].dims,y)];d&&n.push(xn("beta",e[3].dataType,e[3].dims,y)),h&&n.push(xn("bias",e[4].dataType,e[4].dims,y)),n.push(Sn("output",e[0].dataType,s,y)),f&&n.push(Sn("mean_output",1,u)),p&&n.push(Sn("inv_std_output",1,u)),m&&n.push(Sn("input_skip_bias_sum",e[0].dataType,s,y));let i=fn(e[0].dataType),o=fn(1,y);return"\n\n      ".concat(t.registerUniforms([{name:"output_size",type:"u32"},{name:"components",type:"u32"},{name:"hidden_size",type:"u32"},{name:"epsilon",type:"f32"}]).declareVariables(...n),"\n      var<workgroup> sum_shared : array<").concat(o,", ").concat(g,">;\n      var<workgroup> sum_squared_shared : array<").concat(o,", ").concat(g,">;\n\n      ").concat(t.mainStart([g,1,1]),"\n        let ix = local_id.x;\n        let iy = global_id.x / ").concat(g,";\n\n        let hidden_size_vectorized: u32 = uniforms.hidden_size / uniforms.components;\n        var stride = hidden_size_vectorized / ").concat(g,";\n        let offset = ix * stride + iy * hidden_size_vectorized;\n        let offset1d = stride * ix;\n        if (ix == ").concat(63,") {\n          stride = hidden_size_vectorized - stride * ix;\n        }\n        for (var i: u32 = 0; i < stride; i++) {\n          let skip_value = skip[offset + i];\n          let bias_value = ").concat(h?"bias[offset1d + i]":i+"(0.0)",";\n          let input_value = x[offset + i];\n          let value = input_value + skip_value + bias_value;\n          ").concat(m?"input_skip_bias_sum[offset + i] = value;":"","\n          output[offset + i] = value;\n          let f32_value = ").concat(vn(i,y,"value"),";\n          sum_shared[ix] += f32_value;\n          sum_squared_shared[ix] += f32_value * f32_value;\n        }\n        workgroupBarrier();\n\n        var reduce_size : u32 = ").concat(g,";\n        for (var curr_size = reduce_size >> 1;  curr_size > 0; curr_size = reduce_size >> 1) {\n          reduce_size = curr_size + (reduce_size & 1);\n          if (ix < curr_size) {\n            sum_shared[ix] += sum_shared[ix + reduce_size];\n            sum_squared_shared[ix] += sum_squared_shared[ix + reduce_size];\n          }\n          workgroupBarrier();\n        }\n\n        let sum = sum_shared[0];\n        let square_sum = sum_squared_shared[0];\n        let mean = ").concat(_n("sum",y)," / f32(uniforms.hidden_size);\n        let inv_std_dev = inverseSqrt(").concat(_n("square_sum",y)," / f32(uniforms.hidden_size) ").concat(r?"":"- mean * mean"," + uniforms.epsilon);\n        ").concat(f?"mean_output[global_idx] = mean;":"","\n        ").concat(p?"inv_std_output[global_idx] = inv_std_dev;":"","\n\n        for (var i: u32 = 0; i < stride; i++) {\n          output[offset + i] = (output[offset + i] ").concat(r?"":"- ".concat(i,"(mean)"),") *\n            ").concat(i,"(inv_std_dev) * gamma[offset1d + i]\n            ").concat(d?"+ beta[offset1d + i]":"",";\n        }\n      }")},getRunData:()=>({outputs:_,dispatchGroup:{x:Math.ceil(c/l)},programUniforms:v})}},Qc=(e,t)=>{Kc(e.inputs);let n=[0];e.outputCount>1&&n.push(-3),e.outputCount>2&&n.push(-3),e.outputCount>3&&n.push(3),e.compute(Zc(e.inputs,t,e.outputCount,!1),{outputs:n})}}),Au=re(()=>{El(),Cl(),Rl(),Ll(),Xc=(e,t)=>{if(!e||e.length<1)throw new Error("too few inputs");if(0!==t.axes.length){if(t.axes.length!==t.starts.length||t.axes.length!==t.ends.length)throw new Error("axes, starts and ends must have the same length")}else if(t.starts.length!==t.ends.length)throw new Error("starts and ends must have the same length");e.slice(1).forEach((t,n)=>{if(6!==e[n+1].dataType&&7!==e[n+1].dataType)throw new Error("Input ".concat(n," must be an array of int32 or int64"))})},Yc=(e,t)=>{let n=[];if(e.length>t)if(7===e[t].dataType)e[t].getBigInt64Array().forEach(e=>n.push(Number(e)));else{if(6!==e[t].dataType)throw new Error("Input ".concat(t," must be an array of int32 or int64"));e[t].getInt32Array().forEach(e=>n.push(Number(e)))}return n},Jc=(e,t)=>{if(e.length>1){let t=Yc(e,1),n=Yc(e,2),i=Yc(e,3);return 0===i.length&&(i=[...Array(e[0].dims.length).keys()]),un({starts:t,ends:n,axes:i})}return t},$c=(e,t,n,i,r)=>{let o=e;return e<0&&(o+=n[i[t]]),r[t]<0?Math.max(0,Math.min(o,n[i[t]]-1)):Math.max(0,Math.min(o,n[i[t]]))},el=(e,t,n)=>"fn calculateInputIndices(output_indices: ".concat(t.type.indices,") -> ").concat(e.type.indices," {\n          var input_indices: ").concat(e.type.indices,";\n          var carry = 0u;\n          for (var i = ").concat(n.length-1,"; i >= 0; i--) {\n            let input_shape_i = ").concat(wn("uniforms.input_shape","i",n.length),";\n            let steps_i = ").concat(wn("uniforms.steps","i",n.length),";\n            let signs_i = ").concat(wn("uniforms.signs","i",n.length),";\n            let starts_i = ").concat(wn("uniforms.starts","i",n.length),";\n            var output_index = ").concat(t.indicesGet("output_indices","i"),";\n            var input_index = output_index * steps_i + starts_i + carry;\n            carry = input_index / input_shape_i;\n            input_index = input_index % input_shape_i;\n            if (signs_i < 0) {\n              input_index = input_shape_i - input_index - 1u + starts_i;\n            }\n            ").concat(e.indicesSet("input_indices","i","input_index"),";\n          }\n          return input_indices;\n      }"),tl=(e,t)=>{let n=e[0].dims,i=Rt.size(n),r=t.axes.length>0?Rt.normalizeAxes(t.axes,n.length):[...Array(n.length).keys()],o=Yc(e,4);o.forEach(e=>0!==e||(()=>{throw new Error("step cannot be 0")})),0===o.length&&(o=Array(r.length).fill(1));let a=t.starts.map((e,t)=>$c(e,t,n,r,o)),s=t.ends.map((e,t)=>$c(e,t,n,r,o));if(r.length!==a.length||r.length!==s.length)throw new Error("start, ends and axes should have the same number of elements");if(r.length!==n.length)for(let g=0;g<n.length;++g)r.includes(g)||(a.splice(g,0,0),s.splice(g,0,n[g]),o.splice(g,0,1));let c=o.map(e=>Math.sign(e));o.forEach((e,t,n)=>{if(e<0){let i=(s[t]-a[t])/e,r=a[t],c=r+i*o[t];a[t]=c,s[t]=r,n[t]=-e}});let l=n.slice(0);r.forEach((e,t)=>{l[e]=Math.ceil((s[e]-a[e])/o[e])});let u={dims:l,dataType:e[0].dataType},d=Sn("output",e[0].dataType,l.length),h=xn("input",e[0].dataType,e[0].dims.length),f=Rt.size(l),p=[{name:"outputSize",type:"u32"},{name:"starts",type:"u32",length:a.length},{name:"signs",type:"i32",length:c.length},{name:"steps",type:"u32",length:o.length}],m=[{type:12,data:f},{type:12,data:a},{type:6,data:c},{type:12,data:o},...mn(e[0].dims,l)];return{name:"Slice",shaderCache:{hint:"".concat(c.length,"_").concat(a.length,"_").concat(o.length),inputDependencies:["rank"]},getShaderSource:e=>"\n      ".concat(e.registerUniforms(p).declareVariables(h,d),"\n        ").concat(el(h,d,n),"\n        ").concat(e.mainStart(),"\n          ").concat(e.guardAgainstOutOfBoundsWorkgroupSizes("uniforms.outputSize"),"\n          let output_indices = ").concat(d.offsetToIndices("global_idx"),";\n          let input_indices = calculateInputIndices(output_indices);\n          ").concat(d.setByOffset("global_idx",h.getByIndices("input_indices")),"\n      }"),getRunData:()=>({outputs:[u],dispatchGroup:{x:Math.ceil(i/64)},programUniforms:m})}},nl=(e,t)=>{Xc(e.inputs,t);let n=Jc(e.inputs,t);e.compute(tl(e.inputs,n),{inputs:[0]})},il=e=>{let t=e.starts,n=e.ends,i=e.axes;return un({starts:t,ends:n,axes:i})}}),Nu=re(()=>{El(),Cl(),Rl(),zl(),Ll(),rl=e=>{if(!e||1!==e.length)throw new Error("Softmax op requires 1 input.")},ol=(e,t)=>{let n,i=e.inputs[0],r=i.dims,o=Rt.size(r),a=r.length,s=Rt.normalizeAxis(t.axis,a),c=s<r.length-1,l=[];c?(l=Array.from({length:a},(e,t)=>t),l[s]=a-1,l[a-1]=s,n=e.compute(Ln(i,l),{inputs:[i],outputs:[-1]})[0]):n=i;let u=n.dims,d=u[a-1],h=o/d,f=gn(d),p=d/f,m=64;1===h&&(m=256);let g=xn("x",n.dataType,n.dims,f),y=Sn("result",n.dataType,n.dims,f),v=g.type.value,_="f32"===fn(n.dataType)?"var threadMax = ".concat(v,"(-3.402823e+38f);"):"var threadMax = ".concat(v,"(-65504.0h);"),w=e.compute({name:"Softmax",shaderCache:{hint:"".concat(f,";").concat(m),inputDependencies:["type"]},getRunData:()=>({outputs:[{dims:u,dataType:n.dataType}],dispatchGroup:{x:h},programUniforms:[{type:6,data:p}]}),getShaderSource:e=>"\n      var<workgroup> rowMaxShared : ".concat(v,";\n      var<workgroup> rowSumShared : ").concat(v,";\n      var<workgroup> threadShared : array<").concat(v,", ").concat(m,">;\n\n      fn getValue(row: i32, col: i32, row_stride: i32) -> ").concat(v," {\n        let index = row * row_stride + col;\n        return x[index];\n      }\n\n      fn setValue(row: i32, col: i32, row_stride: i32, value: ").concat(v,") {\n        let index = row * row_stride + col;\n        result[index] = value;\n      }\n      ").concat(e.registerUniform("packedCols","i32").declareVariables(g,y),"\n      ").concat(e.mainStart(m),"\n        let gindex = i32(global_idx);\n        let lindex = i32(local_idx);\n        const wg = ").concat(m,";\n        let row = gindex / wg;\n        let cols = uniforms.packedCols;\n        let row_stride : i32 = uniforms.packedCols;\n\n        // find the rows max\n        ").concat(_,"\n        for (var col = lindex; col < cols; col += wg) {\n          let value = getValue(row, col, row_stride);\n          threadMax = max(threadMax, value);\n        }\n        if (lindex < cols) {\n          threadShared[lindex] = threadMax;\n        }\n        workgroupBarrier();\n\n        var reduceSize = min(cols, wg);\n        for (var currSize = reduceSize >> 1;  currSize > 0; currSize = reduceSize >> 1) {\n          reduceSize = currSize + (reduceSize & 1);\n          if (lindex < currSize) {\n            threadShared[lindex] = max(threadShared[lindex], threadShared[lindex + reduceSize]);\n          }\n          workgroupBarrier();\n        }\n        if (lindex == 0) {\n          rowMaxShared = ").concat(v,"(").concat(((e,t)=>4===t?"max(max(".concat(e,".x, ").concat(e,".y), max(").concat(e,".z, ").concat(e,".w))"):2===t?"max(".concat(e,".x, ").concat(e,".y)"):3===t?"max(max(".concat(e,".x, ").concat(e,".y), ").concat(e,".z)"):e)("threadShared[0]",f),");\n        }\n        workgroupBarrier();\n\n        // find the rows sum\n        var threadSum = ").concat(v,"(0.0);\n        for (var col = lindex; col < cols; col += wg) {\n          let subExp = exp(getValue(row, col, row_stride) - rowMaxShared);\n          threadSum += subExp;\n        }\n        threadShared[lindex] = threadSum;\n        workgroupBarrier();\n\n        for (var currSize = wg >> 1;  currSize > 0; currSize = currSize >> 1) {\n          if (lindex < currSize) {\n            threadShared[lindex] = threadShared[lindex] + threadShared[lindex + currSize];\n          }\n          workgroupBarrier();\n        }\n        if (lindex == 0) {\n          rowSumShared = ").concat(v,"(").concat(_n("threadShared[0]",f),");\n        }\n        workgroupBarrier();\n\n        // calculate final value for each element in the row\n        for (var col = lindex; col < cols; col += wg) {\n          var value = exp(getValue(row, col, row_stride) - rowMaxShared) / rowSumShared;\n          // max operation protects against NaN since all values should be >=0\n          value = max(value, ").concat(v,"(0.0));\n          setValue(row, col, row_stride, value);\n        }\n      }")},{inputs:[n],outputs:[c?-1:0]})[0];c&&e.compute(Ln(w,l),{inputs:[w]})},al=(e,t)=>{rl(e.inputs),ol(e,t)},sl=e=>un({axis:e.axis})}),Ou=re(()=>{El(),Cl(),Ll(),cl=e=>Array.from(e.getBigInt64Array(),Number),ll=e=>{if(!e||2!==e.length)throw new Error("Tile requires 2 inputs.");if(1!==e[0].dataType&&10!==e[0].dataType&&6!==e[0].dataType&&12!==e[0].dataType)throw new Error("Tile only support float, float16, int32, and uint32 data types");if(7!==e[1].dataType)throw new Error("Tile `repeats` input should be of int64 data type");if(1!==e[1].dims.length)throw new Error("Tile `repeats` input should be 1-D");if(cl(e[1]).length!==e[0].dims.length)throw new Error("Tile `repeats` input should have same number of elements as rank of input data tensor")},ul=(e,t)=>{let n=[];for(let i=0;i<e.length;++i)n.push(e[i]*t[i]);return n},dl=(e,t)=>{let n=e[0].dims,i=null!==t&&void 0!==t?t:cl(e[1]),r=ul(n,i),o=Rt.size(r),a=e[0].dataType,s=xn("input",a,n.length),c=Sn("output",a,r.length);return{name:"Tile",shaderCache:{hint:"".concat(i),inputDependencies:["rank"]},getRunData:()=>({outputs:[{dims:r,dataType:e[0].dataType}],dispatchGroup:{x:Math.ceil(o/64)},programUniforms:[{type:12,data:o},...mn(e[0].dims,r)]}),getShaderSource:e=>"\n      const inputShape = ".concat(s.indices(...n),";\n      ").concat(e.registerUniform("output_size","u32").declareVariables(s,c),"\n      ").concat(e.mainStart(),"\n      ").concat(e.guardAgainstOutOfBoundsWorkgroupSizes("uniforms.output_size"),"\n      let output_indices = ").concat(c.offsetToIndices("global_idx"),";\n      var input_indices: ").concat(s.type.indices,";\n      for (var i = 0; i < ").concat(n.length,"; i++) {\n        let input_dim_i = ").concat(s.indicesGet("uniforms.input_shape","i"),";\n        let input_dim_value = ").concat(c.indicesGet("output_indices","i"),"  % input_dim_i;\n\n        ").concat(s.indicesSet("input_indices","i","input_dim_value"),"\n      }\n      ").concat(c.setByOffset("global_idx",s.getByIndices("input_indices")),"\n    }")}},hl=e=>{ll(e.inputs),e.compute(dl(e.inputs),{inputs:[0]})}}),Pu=re(()=>{El(),Cl(),Ll(),fl=(e,t,n,i,r)=>{let o,a=Sn("output_data",r,n.length,4),s=xn("a_data",t[1].dataType,t[1].dims.length,4),c=xn("b_data",t[2].dataType,t[2].dims.length,4),l=xn("c_data",t[0].dataType,t[0].dims.length,4),u=(e,t,n)=>"select(".concat(t,", ").concat(e,", ").concat(n,")");if(i){let e=function(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"",i="a_data[index_a".concat(t,"][component_a").concat(t,"]"),r="b_data[index_b".concat(t,"][component_b").concat(t,"]"),o="bool(c_data[index_c".concat(t,"] & (0xffu << (component_c").concat(t," * 8)))");return"\n            let output_indices".concat(t," = ").concat(a.offsetToIndices("global_idx * 4u + ".concat(t,"u")),";\n            let offset_a").concat(t," = ").concat(s.broadcastedIndicesToOffset("output_indices".concat(t),a),";\n            let offset_b").concat(t," = ").concat(c.broadcastedIndicesToOffset("output_indices".concat(t),a),";\n            let offset_c").concat(t," = ").concat(l.broadcastedIndicesToOffset("output_indices".concat(t),a),";\n            let index_a").concat(t," = offset_a").concat(t," / 4u;\n            let index_b").concat(t," = offset_b").concat(t," / 4u;\n            let index_c").concat(t," = offset_c").concat(t," / 4u;\n            let component_a").concat(t," = offset_a").concat(t," % 4u;\n            let component_b").concat(t," = offset_b").concat(t," % 4u;\n            let component_c").concat(t," = offset_c").concat(t," % 4u;\n            ").concat(e,"[").concat(t,"] = ").concat(n,"(").concat(u(i,r,o),");\n          ")};o=9===r?"\n            var data = vec4<u32>(0);\n            ".concat(e("data",0,"u32"),"\n            ").concat(e("data",1,"u32"),"\n            ").concat(e("data",2,"u32"),"\n            ").concat(e("data",3,"u32"),"\n            output_data[global_idx] = dot(vec4<u32>(0x1, 0x100, 0x10000, 0x1000000), vec4<u32>(data));"):"\n            ".concat(e("output_data[global_idx]",0),"\n            ").concat(e("output_data[global_idx]",1),"\n            ").concat(e("output_data[global_idx]",2),"\n            ").concat(e("output_data[global_idx]",3),"\n          ")}else o=a.setByOffset("global_idx",u(s.getByOffset("global_idx"),c.getByOffset("global_idx"),l.getByOffset("global_idx")));return"\n        ".concat(e.registerUniform("vec_size","u32").declareVariables(l,s,c,a),"\n        ").concat(e.mainStart(),"\n        ").concat(e.guardAgainstOutOfBoundsWorkgroupSizes("uniforms.vec_size"),"\n        ").concat(o,"\n      }")},pl=e=>{let t=e[1].dims,n=e[2].dims,i=e[0].dims,r=e[1].dataType,o=!(Rt.areEqual(t,n)&&Rt.areEqual(n,i)),a=t,s=Rt.size(t);if(o){let e=Pt.calcShape(Pt.calcShape(t,n,!1),i,!1);if(!e)throw new Error("Can't perform where op on the given tensors");a=e,s=Rt.size(a)}let c=Math.ceil(s/4);return{name:"Where",shaderCache:{inputDependencies:["rank","rank","rank"]},getShaderSource:t=>fl(t,e,a,o,r),getRunData:()=>({outputs:[{dims:a,dataType:r}],dispatchGroup:{x:Math.ceil(s/64/4)},programUniforms:[{type:12,data:c},...mn(i,t,n,a)]})}},ml=e=>{e.compute(pl(e.inputs))}}),Ru=re(()=>{Bl(),Ul(),Fl(),jl(),ql(),Hl(),Wl(),eu(),nu(),iu(),ru(),ou(),au(),su(),cu(),lu(),uu(),du(),hu(),fu(),yu(),vu(),_u(),wu(),bu(),pu(),xu(),Su(),Eu(),Tu(),ku(),Dl(),Cu(),gu(),Iu(),Au(),Nu(),mu(),Ou(),zl(),Vl(),Pu(),gl=new Map([["Abs",[Yi]],["Acos",[Ji]],["Acosh",[$i]],["Add",[Gr]],["ArgMax",[Pi,Ri]],["ArgMin",[Oi,Ri]],["Asin",[er]],["Asinh",[tr]],["Atan",[nr]],["Atanh",[ir]],["Attention",[ji]],["AveragePool",[sc,ac]],["BatchNormalization",[Wi]],["BiasAdd",[Zi]],["BiasSplitGelu",[Vr]],["Cast",[or,rr]],["Ceil",[cr]],["Clip",[sr]],["Concat",[ao,so]],["Conv",[Go,Vo]],["ConvTranspose",[na,Jo]],["Cos",[lr]],["Cosh",[ur]],["CumSum",[ra,oa]],["DepthToSpace",[la,ua]],["DequantizeLinear",[vc,_c]],["Div",[Kr]],["Einsum",[_a,wa]],["Elu",[hr,dr]],["Equal",[Zr]],["Erf",[pr]],["Exp",[mr]],["Expand",[Ta]],["FastGelu",[Ca]],["Floor",[gr]],["FusedConv",[Go,Vo]],["Gather",[Oa,Na]],["GatherElements",[Va,ja]],["GatherBlockQuantized",[Da,Ba]],["GatherND",[Ra,La]],["Gelu",[yr]],["Gemm",[Ga,Wa]],["GlobalAveragePool",[uc,lc]],["GlobalMaxPool",[mc,pc]],["Greater",[Jr]],["GreaterOrEqual",[eo]],["GridSample",[rs,os]],["GroupQueryAttention",[Cs]],["HardSigmoid",[Tr,Er]],["InstanceNormalization",[Os]],["LayerNormalization",[Ls]],["LeakyRelu",[vr,dr]],["Less",[$r]],["LessOrEqual",[to]],["Log",[Mr]],["MatMul",[Ms]],["MatMulNBits",[Fs,js]],["MaxPool",[hc,fc]],["Mul",[Qr]],["MultiHeadAttention",[hs,cs]],["Neg",[wr]],["Not",[_r]],["Pad",[Xs]],["Pow",[Xr]],["QuickGelu",[Ur,dr]],["Range",[xc]],["Reciprocal",[br]],["ReduceMin",[Ti]],["ReduceMean",[wi]],["ReduceMax",[Ei]],["ReduceSum",[Ci]],["ReduceProd",[ki]],["ReduceL1",[bi]],["ReduceL2",[xi]],["ReduceLogSum",[Ai]],["ReduceLogSumExp",[Si]],["ReduceSumSquare",[Ii]],["Relu",[xr]],["Resize",[Wc,Gc]],["RotaryEmbedding",[xs]],["ScatterND",[kc,Tc]],["Sigmoid",[Sr]],["Sin",[kr]],["Sinh",[Cr]],["Slice",[nl,il]],["SkipLayerNormalization",[Qc]],["Split",[vs,_s]],["Sqrt",[Ir]],["Softmax",[al,sl]],["Sub",[Yr]],["Tan",[Ar]],["Tanh",[Or]],["ThresholdedRelu",[zr,dr]],["Tile",[hl]],["Transpose",[zn,Mn]],["Where",[ml]]])}),Lu=re(()=>{ke(),kl(),Ll(),yl=class{constructor(e){this.backend=e,this.repo=new Map,this.attributesBound=!1}getArtifact(e){return this.repo.get(e)}setArtifact(e,t){this.repo.set(e,t)}run(e,t,n,i,r){K(e.programInfo.name);let o=this.backend.device,a=this.backend.getComputePassEncoder();this.backend.writeTimestamp(2*this.backend.pendingDispatchNumber);let s=[];for(let l of t)s.push({binding:s.length,resource:{buffer:l.buffer}});for(let l of n)s.push({binding:s.length,resource:{buffer:l.buffer}});r&&s.push({binding:s.length,resource:r});let c=o.createBindGroup({layout:e.computePipeline.getBindGroupLayout(0),entries:s,label:e.programInfo.name});if("capturing"===this.backend.sessionStatus){let t={kernelId:this.backend.currentKernelId,computePipeline:e.computePipeline,bindGroup:c,dispatchGroup:i};this.backend.capturedCommandList.get(this.backend.currentSessionId).push(t)}a.setPipeline(e.computePipeline),a.setBindGroup(0,c),a.dispatchWorkgroups(...i),this.backend.writeTimestamp(2*this.backend.pendingDispatchNumber+1),this.backend.pendingDispatchNumber++,(this.backend.pendingDispatchNumber>=this.backend.maxDispatchNumber||"at-passes"===this.backend.queryType)&&this.backend.endComputePass(),this.backend.pendingDispatchNumber>=this.backend.maxDispatchNumber&&this.backend.flush(),Z(e.programInfo.name)}dispose(){}build(e,t){K(e.name);let n=this.backend.device,i=[];[{feature:"shader-f16",extension:"f16"},{feature:"subgroups",extension:"subgroups"}].forEach(e=>{n.features.has(e.feature)&&i.push("enable ".concat(e.extension,";"))});let r=Cn(t,this.backend.device.limits),o=e.getShaderSource(r),a="".concat(i.join("\n"),"\n").concat(r.additionalImplementations,"\n").concat(o),s=n.createShaderModule({code:a,label:e.name});Nt("verbose",()=>"[WebGPU] ".concat(e.name," shader code: ").concat(a));let c=n.createComputePipeline({compute:{module:s,entryPoint:"main"},layout:"auto",label:e.name});return Z(e.name),{programInfo:e,computePipeline:c,uniformVariablesInfo:r.variablesInfo}}normalizeDispatchGroupSize(e){let t="number"==typeof e?e:e.x,n="number"==typeof e?1:e.y||1,i="number"==typeof e?1:e.z||1,r=this.backend.device.limits.maxComputeWorkgroupsPerDimension;if(t<=r&&n<=r&&i<=r)return[t,n,i];let o=t*n*i,a=Math.ceil(Math.sqrt(o));if(a>r){if(a=Math.ceil(Math.cbrt(o)),a>r)throw new Error("Total dispatch size exceeds WebGPU maximum.");return[a,a,a]}return[a,a,1]}}}),zu={};oe(zu,{WebGpuBackend:()=>Uu});var Mu,Du,Bu,Uu,Fu=re(()=>{ke(),El(),kl(),Il(),Pl(),Ru(),Lu(),Mu=(e,t)=>{if(t.length!==e.length)throw new Error("inputDependencies length ".concat(t.length," is not equal to inputTensors length ").concat(e.length,"."));let n=[];for(let i=0;i<e.length;++i){let r=e[i].dataType;switch(t[i]){case"none":n.push("");break;case"type":n.push("".concat(r));break;case"rank":{let t=e[i].dims.length;n.push("".concat(r,";").concat(t));break}case"dims":{let t=e[i].dims.join(",");n.push("".concat(r,";").concat(t));break}default:throw new Error("unsupported input dependency: ".concat(t[i]))}}return n.join("|")},Du=(e,t,n)=>{var i,r,o;let a=e.name;return null!==(i=e.shaderCache)&&void 0!==i&&i.hint&&(a+="["+e.shaderCache.hint+"]"),a+=":"+n+":".concat(Mu(t,null!==(r=null===(o=e.shaderCache)||void 0===o?void 0:o.inputDependencies)&&void 0!==r?r:new Array(t.length).fill("dims"))),a},Bu=class{constructor(e){e&&(this.architecture=e.architecture,this.vendor=e.vendor)}isArchitecture(e){return this.architecture===e}isVendor(e){return this.vendor===e}},Uu=class{constructor(){this.currentSessionId=null,this.currentKernelId=null,this.commandEncoder=null,this.computePassEncoder=null,this.maxDispatchNumber=16,this.pendingDispatchNumber=0,this.pendingKernels=[],this.pendingQueries=new Map,this.sessionStatus="default",this.capturedCommandList=new Map,this.capturedPendingKernels=new Map,this.sessionExternalDataMapping=new Map}get currentKernelCustomData(){if(null===this.currentKernelId)throw new Error("currentKernelCustomData(): currentKernelId is null. (should not happen)");let e=this.kernelCustomData.get(this.currentKernelId);return e||(e={},this.kernelCustomData.set(this.currentKernelId,e)),e}async initialize(e,t){this.env=e;let n=[],i={requiredLimits:{maxComputeWorkgroupStorageSize:t.limits.maxComputeWorkgroupStorageSize,maxComputeWorkgroupsPerDimension:t.limits.maxComputeWorkgroupsPerDimension,maxStorageBufferBindingSize:t.limits.maxStorageBufferBindingSize,maxBufferSize:t.limits.maxBufferSize,maxComputeInvocationsPerWorkgroup:t.limits.maxComputeInvocationsPerWorkgroup,maxComputeWorkgroupSizeX:t.limits.maxComputeWorkgroupSizeX,maxComputeWorkgroupSizeY:t.limits.maxComputeWorkgroupSizeY,maxComputeWorkgroupSizeZ:t.limits.maxComputeWorkgroupSizeZ},requiredFeatures:n},r=e=>t.features.has(e)&&n.push(e)&&!0;r("chromium-experimental-timestamp-query-inside-passes")||r("timestamp-query"),r("shader-f16"),r("subgroups"),this.device=await t.requestDevice(i),this.adapterInfo=new Bu(t.info||await t.requestAdapterInfo()),this.gpuDataManager=cn(this),this.programManager=new yl(this),this.kernels=new Map,this.kernelPersistentData=new Map,this.kernelCustomData=new Map,It(e.logLevel,!!e.debug),this.device.onuncapturederror=e=>{e.error instanceof GPUValidationError&&console.error("An uncaught WebGPU validation error was raised: ".concat(e.error.message))},Object.defineProperty(this.env.webgpu,"device",{value:this.device,writable:!1,enumerable:!0,configurable:!1}),Object.defineProperty(this.env.webgpu,"adapter",{value:t,writable:!1,enumerable:!0,configurable:!1}),this.setQueryType()}dispose(){typeof this.querySet<"u"&&this.querySet.destroy(),this.gpuDataManager.dispose()}getCommandEncoder(){return this.commandEncoder||(this.commandEncoder=this.device.createCommandEncoder()),this.commandEncoder}getComputePassEncoder(){if(!this.computePassEncoder){let e=this.getCommandEncoder(),t={};"at-passes"===this.queryType&&(t.timestampWrites={querySet:this.querySet,beginningOfPassWriteIndex:2*this.pendingDispatchNumber,endOfPassWriteIndex:2*this.pendingDispatchNumber+1}),this.computePassEncoder=e.beginComputePass(t)}return this.computePassEncoder}endComputePass(){this.computePassEncoder&&(this.computePassEncoder.end(),this.computePassEncoder=null)}flush(){if(!this.commandEncoder)return;let e;K(),this.endComputePass(),"none"!==this.queryType&&(this.commandEncoder.resolveQuerySet(this.querySet,0,2*this.pendingDispatchNumber,this.queryResolveBuffer,0),e=this.device.createBuffer({size:2*this.pendingDispatchNumber*8,usage:GPUBufferUsage.MAP_READ|GPUBufferUsage.COPY_DST}),this.pendingQueries.set(e,this.pendingKernels),this.pendingKernels=[],this.commandEncoder.copyBufferToBuffer(this.queryResolveBuffer,0,e,0,2*this.pendingDispatchNumber*8)),this.device.queue.submit([this.commandEncoder.finish()]),this.gpuDataManager.refreshPendingBuffers(),this.commandEncoder=null,this.pendingDispatchNumber=0,"none"!==this.queryType&&e.mapAsync(GPUMapMode.READ).then(()=>{let t=new BigUint64Array(e.getMappedRange()),n=this.pendingQueries.get(e);for(let e=0;e<t.length/2;e++){var i;let r=n[e],o=r.kernelId,a=this.kernels.get(o),s=a.kernelType,c=a.kernelName,l=r.programName,u=r.inputTensorViews,d=r.outputTensorViews,h=t[2*e],f=t[2*e+1];typeof this.queryTimeBase>"u"&&(this.queryTimeBase=h);let p=Number(h-this.queryTimeBase),m=Number(f-this.queryTimeBase);if(!Number.isSafeInteger(p)||!Number.isSafeInteger(m))throw new RangeError("incorrect timestamp range");if(null!==(i=this.env.webgpu.profiling)&&void 0!==i&&i.ondata)this.env.webgpu.profiling.ondata({version:1,inputsMetadata:u.map(e=>({dims:e.dims,dataType:gt(e.dataType)})),outputsMetadata:d.map(e=>({dims:e.dims,dataType:gt(e.dataType)})),kernelId:o,kernelType:s,kernelName:c,programName:l,startTime:p,endTime:m});else{let e="";u.forEach((t,n)=>{e+="input[".concat(n,"]: [").concat(t.dims,"] | ").concat(gt(t.dataType),", ")});let t="";d.forEach((e,n)=>{t+="output[".concat(n,"]: [").concat(e.dims,"] | ").concat(gt(e.dataType),", ")}),console.log('[profiling] kernel "'.concat(o,"|").concat(s,"|").concat(c,"|").concat(l,'" ').concat(e).concat(t,"start time: ").concat(p," ns, execution time: ").concat(m-p," ns"))}W("GPU","".concat(l,"::").concat(h,"::").concat(f))}e.unmap(),this.pendingQueries.delete(e)}),Z()}run(e,t,n,i,r,o){K(e.name);let a=[];for(let v=0;v<t.length;++v){let e=t[v].data;if(0===e)continue;let n=this.gpuDataManager.get(e);if(!n)throw new Error("no GPU data for input: ".concat(e));a.push(n)}let{outputs:s,dispatchGroup:c,programUniforms:l}=e.getRunData(t),u=0===n.length?s.map((e,t)=>t):n;if(u.length!==s.length)throw new Error("Output size ".concat(u.length," must be equal to ").concat(s.length,"."));let d,h=[],f=[];for(let v=0;v<s.length;++v){if(!Number.isInteger(u[v])||u[v]<-3||u[v]>=o)throw new Error("Invalid output index: ".concat(u[v]));if(-3===u[v])continue;let e=-1===u[v],t=-2===u[v],n=e||t?r(s[v].dataType,s[v].dims):i(u[v],s[v].dataType,s[v].dims);if(h.push(n),0===n.data)continue;let a=this.gpuDataManager.get(n.data);if(!a)throw new Error("no GPU data for output: ".concat(n.data));if(e&&this.temporaryData.push(a),t){let e=this.kernelPersistentData.get(this.currentKernelId);e||(e=[],this.kernelPersistentData.set(this.currentKernelId,e)),e.push(a)}f.push(a)}if(a.length!==t.length||f.length!==h.length){if(0===f.length)return Z(e.name),h;throw new Error("Program ".concat(e.name," has zero-sized tensor(s) in inputs or outputs. This is not supported now."))}if(l){let e=0,t=[];l.forEach(n=>{let i="number"==typeof n.data?[n.data]:n.data;if(0===i.length)return;let r,o,a=10===n.type?2:4;10===n.type?(o=i.length>4?16:i.length>2?8:i.length*a,r=i.length>4?16:a*i.length):(o=i.length<=2?i.length*a:16,r=16),e=Math.ceil(e/o)*o,t.push(e);let s=10===n.type?8:4;e+=i.length>4?Math.ceil(i.length/s)*r:i.length*a});let n=16;e=Math.ceil(e/n)*n;let i=new ArrayBuffer(e);l.forEach((e,n)=>{let r=t[n],o="number"==typeof e.data?[e.data]:e.data;if(6===e.type)new Int32Array(i,r,o.length).set(o);else if(12===e.type)new Uint32Array(i,r,o.length).set(o);else if(10===e.type)new Uint16Array(i,r,o.length).set(o);else{if(1!==e.type)throw new Error("Unsupported uniform type: ".concat(gt(e.type)));new Float32Array(i,r,o.length).set(o)}});let r=this.gpuDataManager.create(e,GPUBufferUsage.COPY_DST|GPUBufferUsage.UNIFORM);this.device.queue.writeBuffer(r.buffer,0,i,0,e),this.gpuDataManager.release(r.id),d={offset:0,size:e,buffer:r.buffer}}let p=this.programManager.normalizeDispatchGroupSize(c),m=1===p[1]&&1===p[2],g=Du(e,t,m),y=this.programManager.getArtifact(g);if(y||(y=this.programManager.build(e,p),this.programManager.setArtifact(g,y),Nt("info",()=>"[artifact] key: ".concat(g,", programName: ").concat(e.name))),l&&y.uniformVariablesInfo){if(l.length!==y.uniformVariablesInfo.length)throw new Error("Uniform variables count mismatch: expect ".concat(y.uniformVariablesInfo.length,", got ").concat(l.length,' in program "').concat(y.programInfo.name,'".'));for(let e=0;e<l.length;e++){let t=l[e],n=t.type,i="number"==typeof t.data?1:t.data.length,[r,o]=y.uniformVariablesInfo[e];if(n!==r||i!==o)throw new Error("Uniform variable ".concat(e," mismatch: expect type ").concat(r," with size ").concat(o,", got type ").concat(n," with size ").concat(i,' in program "').concat(y.programInfo.name,'".'))}}if(Nt("info",()=>'[ProgramManager] run "'.concat(e.name,'" (key=').concat(g,") with ").concat(p[0],"x").concat(p[1],"x").concat(p[2])),"none"!==this.queryType||"capturing"===this.sessionStatus){let e={kernelId:this.currentKernelId,programName:y.programInfo.name,inputTensorViews:t,outputTensorViews:h};this.pendingKernels.push(e),"capturing"===this.sessionStatus&&this.capturedPendingKernels.get(this.currentSessionId).push(e)}return this.programManager.run(y,a,f,p,d),Z(e.name),h}upload(e,t){this.gpuDataManager.upload(e,t)}memcpy(e,t){this.gpuDataManager.memcpy(e,t)}async download(e,t){await this.gpuDataManager.download(e,t)}alloc(e){return this.gpuDataManager.create(e).id}free(e){return this.gpuDataManager.release(e)}createKernel(e,t,n,i){let r=gl.get(e);if(!r)throw new Error("kernel not implemented: ".concat(e));let o={kernelType:e,kernelName:i,kernelEntry:r[0],attributes:[r[1],n]};this.kernels.set(t,o)}releaseKernel(e){let t=this.kernelPersistentData.get(e);if(t){for(let e of t)this.gpuDataManager.release(e.id);this.kernelPersistentData.delete(e)}this.kernelCustomData.delete(e),this.kernels.delete(e)}computeKernel(e,t,n){let i=this.kernels.get(e);if(!i)throw new Error("kernel not created: ".concat(e));let r=i.kernelType,o=i.kernelName,a=i.kernelEntry,s=i.attributes;if(null!==this.currentKernelId)throw new Error('kernel "['.concat(r,"] ").concat(o,'" is not allowed to be called recursively'));this.currentKernelId=e,s[0]&&(s[1]=s[0](s[1]),s[0]=void 0),Nt("info",()=>'[WebGPU] Start to run kernel "['.concat(r,"] ").concat(o,'"...'));let c=this.env.debug;this.temporaryData=[];try{return c&&this.device.pushErrorScope("validation"),a(t,s[1]),0}catch(l){return n.push(Promise.resolve('[WebGPU] Kernel "['.concat(r,"] ").concat(o,'" failed. ').concat(l))),1}finally{c&&n.push(this.device.popErrorScope().then(e=>e?'GPU validation error for kernel "['.concat(r,"] ").concat(o,'": ').concat(e.message):null));for(let e of this.temporaryData)this.gpuDataManager.release(e.id);this.temporaryData=[],this.currentKernelId=null}}registerBuffer(e,t,n,i){let r=this.sessionExternalDataMapping.get(e);r||(r=new Map,this.sessionExternalDataMapping.set(e,r));let o=r.get(t),a=this.gpuDataManager.registerExternalBuffer(n,i,o);return r.set(t,[a,n]),a}unregisterBuffers(e){let t=this.sessionExternalDataMapping.get(e);t&&(t.forEach(e=>this.gpuDataManager.unregisterExternalBuffer(e[0])),this.sessionExternalDataMapping.delete(e))}getBuffer(e){let t=this.gpuDataManager.get(e);if(!t)throw new Error("no GPU data for buffer: ".concat(e));return t.buffer}createDownloader(e,t,n){return async()=>{let i=await an(this,e,t);return Bt(i.buffer,n)}}writeTimestamp(e){"inside-passes"===this.queryType&&this.computePassEncoder.writeTimestamp(this.querySet,e)}setQueryType(){var e;this.queryType="none",("default"===(null===(e=this.env.webgpu.profiling)||void 0===e?void 0:e.mode)||(typeof this.env.trace>"u"?this.env.wasm.trace:this.env.trace))&&(this.device.features.has("chromium-experimental-timestamp-query-inside-passes")?this.queryType="inside-passes":this.device.features.has("timestamp-query")&&(this.queryType="at-passes"),"none"!==this.queryType&&typeof this.querySet>"u"&&(this.querySet=this.device.createQuerySet({type:"timestamp",count:2*this.maxDispatchNumber}),this.queryResolveBuffer=this.device.createBuffer({size:2*this.maxDispatchNumber*8,usage:GPUBufferUsage.COPY_SRC|GPUBufferUsage.QUERY_RESOLVE})))}captureBegin(){Nt("info","captureBegin"),this.capturedCommandList.get(this.currentSessionId)||this.capturedCommandList.set(this.currentSessionId,[]),this.capturedPendingKernels.get(this.currentSessionId)||this.capturedPendingKernels.set(this.currentSessionId,[]),this.flush(),this.sessionStatus="capturing"}captureEnd(){Nt("info","captureEnd"),this.flush(),this.sessionStatus="default"}replay(){Nt("info","replay"),this.sessionStatus="replaying";let e=this.capturedCommandList.get(this.currentSessionId),t=this.capturedPendingKernels.get(this.currentSessionId),n=e.length;this.pendingKernels=[];for(let i=0;i<n;i++){let n=this.getComputePassEncoder(),r=e[i];this.writeTimestamp(2*this.pendingDispatchNumber),n.setPipeline(r.computePipeline),n.setBindGroup(0,r.bindGroup),n.dispatchWorkgroups(...r.dispatchGroup),this.writeTimestamp(2*this.pendingDispatchNumber+1),this.pendingDispatchNumber++,"none"!==this.queryType&&this.pendingKernels.push(t[i]),(this.pendingDispatchNumber>=this.maxDispatchNumber||"at-passes"===this.queryType)&&this.endComputePass(),this.pendingDispatchNumber>=this.maxDispatchNumber&&this.flush()}this.flush(),this.sessionStatus="default"}onCreateSession(){this.gpuDataManager.onCreateSession()}onReleaseSession(e){this.unregisterBuffers(e),this.capturedCommandList.has(e)&&this.capturedCommandList.delete(e),this.capturedPendingKernels.has(e)&&this.capturedPendingKernels.delete(e),this.gpuDataManager.onReleaseSession(e)}onRunStart(e){this.currentSessionId=e,this.setQueryType()}}}),ju={};oe(ju,{init:()=>Hu});var Vu,qu,Hu,Wu,Gu,Ku,Zu,Qu,Xu,Yu,Ju,$u,ed,td,nd,id,rd,od,ad,sd,cd,ld,ud,dd,hd,fd,pd,md,gd,yd,vd,_d,wd,bd,xd,Sd,Ed,Td=re(()=>{El(),kl(),Cl(),Nl(),Vu=class e{constructor(e,t,n,i){this.module=e,this.dataType=t,this.data=n,this.dims=i}getFloat32Array(){if(1!==this.dataType)throw new Error("Invalid data type");let e=Rt.size(this.dims);return 0===e?new Float32Array:new Float32Array(this.module.HEAP8.buffer,this.data,e)}getBigInt64Array(){if(7!==this.dataType)throw new Error("Invalid data type");let e=Rt.size(this.dims);return 0===e?new BigInt64Array:new BigInt64Array(this.module.HEAP8.buffer,this.data,e)}getInt32Array(){if(6!==this.dataType)throw new Error("Invalid data type");let e=Rt.size(this.dims);return 0===e?new Int32Array:new Int32Array(this.module.HEAP8.buffer,this.data,e)}getUint16Array(){if(10!==this.dataType&&4!==this.dataType)throw new Error("Invalid data type");let e=Rt.size(this.dims);return 0===e?new Uint16Array:new Uint16Array(this.module.HEAP8.buffer,this.data,e)}reshape(t){if(Rt.size(t)!==Rt.size(this.dims))throw new Error("Invalid new shape");return new e(this.module,this.dataType,this.data,t)}},qu=class{constructor(e,t,n){this.module=e,this.backend=t,this.customDataOffset=0,this.customDataSize=0,this.adapterInfo=t.adapterInfo;let i=e.PTR_SIZE,r=n/e.PTR_SIZE,o=4===i?"i32":"i64";this.opKernelContext=Number(e.getValue(i*r++,o));let a=Number(e.getValue(i*r++,o));this.outputCount=Number(e.getValue(i*r++,o)),this.customDataOffset=Number(e.getValue(i*r++,"*")),this.customDataSize=Number(e.getValue(i*r++,o));let s=[];for(let c=0;c<a;c++){let t=Number(e.getValue(i*r++,o)),n=Number(e.getValue(i*r++,"*")),a=Number(e.getValue(i*r++,o)),c=[];for(let s=0;s<a;s++)c.push(Number(e.getValue(i*r++,o)));s.push(new Vu(e,t,n,c))}this.inputs=s}get kernelCustomData(){return this.backend.currentKernelCustomData}get customDataBuffer(){return this.module.HEAPU8.subarray(this.customDataOffset,this.customDataOffset+this.customDataSize)}compute(e,t){var n,i,r;let o=null!==(n=null===t||void 0===t||null===(i=t.inputs)||void 0===i?void 0:i.map(e=>"number"==typeof e?this.inputs[e]:e))&&void 0!==n?n:this.inputs,a=null!==(r=null===t||void 0===t?void 0:t.outputs)&&void 0!==r?r:[];return this.backend.run(e,o,a,(e,t,n)=>new Vu(this.module,t,this.output(e,n),n),(e,t)=>{let n=yt(e,t);if(!n)throw new Error("Unsupported data type: ".concat(e));let i=n>0?this.backend.gpuDataManager.create(n).id:0;return new Vu(this.module,e,i,t)},this.outputCount)}output(e,t){let n=this.module.stackSave();try{let n=this.module.PTR_SIZE,i=4===n?"i32":"i64",r=this.module.stackAlloc((1+t.length)*n);this.module.setValue(r,t.length,i);for(let e=0;e<t.length;e++)this.module.setValue(r+n*(e+1),t[e],i);return this.module._JsepOutput(this.opKernelContext,e,r)}catch(Ok){throw new Error("Failed to generate kernel's output[".concat(e,"] with dims [").concat(t,"]. If you are running with pre-allocated output, please make sure the output type/dims are correct. Error: ").concat(Ok))}finally{this.module.stackRestore(n)}}},Hu=async(e,t,n,i)=>{let r=t.jsepInit;if(!r)throw new Error("Failed to initialize JSEP. The WebAssembly module is not built with JSEP support.");if("webgpu"===e){let e=new(0,(Fu(),ae(zu)).WebGpuBackend);await e.initialize(n,i),r("webgpu",[e,t=>e.alloc(Number(t)),t=>e.free(t),function(n,i,r){if(arguments.length>3&&void 0!==arguments[3]&&arguments[3])Nt("verbose",()=>"[WebGPU] jsepCopyGpuToGpu: src=".concat(Number(n),", dst=").concat(Number(i),", size=").concat(Number(r))),e.memcpy(Number(n),Number(i));else{Nt("verbose",()=>"[WebGPU] jsepCopyCpuToGpu: dataOffset=".concat(Number(n),", gpuDataId=").concat(Number(i),", size=").concat(Number(r)));let o=t.HEAPU8.subarray(Number(n>>>0),Number(n>>>0)+Number(r));e.upload(Number(i),o)}},async(n,i,r)=>{Nt("verbose",()=>"[WebGPU] jsepCopyGpuToCpu: gpuDataId=".concat(n,", dataOffset=").concat(i,", size=").concat(r)),await e.download(Number(n),()=>t.HEAPU8.subarray(Number(i)>>>0,Number(i+r)>>>0))},(n,i,r)=>e.createKernel(n,Number(i),r,t.UTF8ToString(t._JsepGetNodeName(Number(i)))),t=>e.releaseKernel(t),(n,i,r,o)=>{Nt("verbose",()=>"[WebGPU] jsepRun: sessionHandle=".concat(r,", kernel=").concat(n,", contextDataOffset=").concat(i));let a=new qu(t,e,Number(i));return e.computeKernel(Number(n),a,o)},()=>e.captureBegin(),()=>e.captureEnd(),()=>e.replay()])}else{let e=new Jt(n);r("webnn",[e,()=>e.reserveTensorId(),t=>e.releaseTensorId(t),async(t,n,i,r,o)=>e.ensureTensor(t,n,i,r,o),(t,n)=>{e.uploadTensor(t,n)},async(t,n)=>e.downloadTensor(t,n),(t,n)=>e.registerMLContext(t,n),!!n.trace])}}}),kd=re(()=>{ke(),xl(),Sl(),El(),wl(),bl(),Tl(),Wu=(e,t)=>{0!==rt()._OrtInit(e,t)&&st("Can't initialize onnxruntime.")},Gu=async e=>{Wu(e.wasm.numThreads,_t(e.logLevel))},Ku=async(e,t)=>{var n,i;null===(n=(i=rt()).asyncInit)||void 0===n||n.call(i);let r=e.webgpu.adapter;if("webgpu"===t){if(typeof navigator>"u"||!navigator.gpu)throw new Error("WebGPU is not supported in current environment");if(r){if("object"!=typeof r.limits||"object"!=typeof r.features||"function"!=typeof r.requestDevice)throw new Error("Invalid GPU adapter set in `env.webgpu.adapter`. It must be a GPUAdapter object.")}else{let t=e.webgpu.powerPreference;if(void 0!==t&&"low-power"!==t&&"high-performance"!==t)throw new Error('Invalid powerPreference setting: "'.concat(t,'"'));let n=e.webgpu.forceFallbackAdapter;if(void 0!==n&&"boolean"!=typeof n)throw new Error('Invalid forceFallbackAdapter setting: "'.concat(n,'"'));if(r=await navigator.gpu.requestAdapter({powerPreference:t,forceFallbackAdapter:n}),!r)throw new Error('Failed to get GPU adapter. You may need to enable flag "--enable-unsafe-webgpu" if you are using Chrome.')}}if("webnn"===t&&(typeof navigator>"u"||!navigator.ml))throw new Error("WebNN is not supported in current environment");{let n=(Td(),ae(ju)).init;"webgpu"===t&&await n("webgpu",rt(),e,r),"webnn"===t&&await n("webnn",rt(),e)}},Zu=new Map,Qu=e=>{let t=rt(),n=t.stackSave();try{let n=t.PTR_SIZE,i=t.stackAlloc(2*n);0!==t._OrtGetInputOutputCount(e,i,i+n)&&st("Can't get session input/output count.");let r=4===n?"i32":"i64";return[Number(t.getValue(i,r)),Number(t.getValue(i+n,r))]}finally{t.stackRestore(n)}},Xu=(e,t)=>{let n=rt(),i=n.stackSave(),r=0;try{let i=n.PTR_SIZE,o=n.stackAlloc(2*i);0!==n._OrtGetInputOutputMetadata(e,t,o,o+i)&&st("Can't get session input/output metadata.");let a=Number(n.getValue(o,"*"));r=Number(n.getValue(o+i,"*"));let s=n.HEAP32[r/4];if(0===s)return[a,0];let c=n.HEAPU32[r/4+1],l=[];for(let e=0;e<c;e++){let t=Number(n.getValue(r+8+e*i,"*"));l.push(0!==t?n.UTF8ToString(t):Number(n.getValue(r+8+(e+c)*i,"*")))}return[a,s,l]}finally{n.stackRestore(i),0!==r&&n._OrtFree(r)}},Yu=e=>{let t=rt(),n=t._malloc(e.byteLength);if(0===n)throw new Error("Can't create a session. failed to allocate a buffer of size ".concat(e.byteLength,"."));return t.HEAPU8.set(e,n),[n,e.byteLength]},Ju=async(e,t)=>{let n,i,r=rt();Array.isArray(e)?[n,i]=e:e.buffer===r.HEAPU8.buffer?[n,i]=[e.byteOffset,e.byteLength]:[n,i]=Yu(e);let o=0,a=0,s=0,c=[],l=[],u=[];try{var d,h;if([a,c]=await pt(t),null!==t&&void 0!==t&&t.externalData&&r.mountExternalData){let e=[];for(let n of t.externalData){let t="string"==typeof n?n:n.path;e.push(St("string"==typeof n?n:n.data).then(e=>{r.mountExternalData(t,e)}))}await Promise.all(e)}for(let n of null!==(f=null===t||void 0===t?void 0:t.executionProviders)&&void 0!==f?f:[]){var f;if("webnn"===("string"==typeof n?n:n.name)){if(r.shouldTransferToMLTensor=!1,"string"!=typeof n){let e=n,t=null===e||void 0===e?void 0:e.context,i=null===e||void 0===e?void 0:e.gpuDevice,o=null===e||void 0===e?void 0:e.deviceType,a=null===e||void 0===e?void 0:e.powerPreference;r.currentContext=t||(i?await r.webnnCreateMLContext(i):await r.webnnCreateMLContext({deviceType:o,powerPreference:a}))}else r.currentContext=await r.webnnCreateMLContext();break}}o=await r._OrtCreateSession(n,i,a),null!==(d=r.webgpuOnCreateSession)&&void 0!==d&&d.call(r,o),0===o&&st("Can't create a session."),null!==(h=r.jsepOnCreateSession)&&void 0!==h&&h.call(r),r.currentContext&&(r.webnnRegisterMLContext(o,r.currentContext),r.currentContext=void 0,r.shouldTransferToMLTensor=!0);let[e,g]=Qu(o),y=!(null===t||void 0===t||!t.enableGraphCapture),v=[],_=[],w=[],b=[],x=[];for(let t=0;t<e;t++){let[e,n,i]=Xu(o,t);0===e&&st("Can't get an input name."),l.push(e);let a=r.UTF8ToString(e);v.push(a),w.push(0===n?{name:a,isTensor:!1}:{name:a,isTensor:!0,type:gt(n),shape:i})}for(let n=0;n<g;n++){let[i,a,s]=Xu(o,n+e);0===i&&st("Can't get an output name."),u.push(i);let c=r.UTF8ToString(i);_.push(c),b.push(0===a?{name:c,isTensor:!1}:{name:c,isTensor:!0,type:gt(a),shape:s});{var p,m;if(y&&void 0===(null===t||void 0===t?void 0:t.preferredOutputLocation)){x.push("gpu-buffer");continue}let e="string"==typeof(null===t||void 0===t?void 0:t.preferredOutputLocation)?t.preferredOutputLocation:null!==(p=null===t||void 0===t||null===(m=t.preferredOutputLocation)||void 0===m?void 0:m[c])&&void 0!==p?p:"cpu",n=r.webnnIsGraphOutput;if("cpu"===e&&n&&n(o,c)){x.push("ml-tensor-cpu-output");continue}if("cpu"!==e&&"cpu-pinned"!==e&&"gpu-buffer"!==e&&"ml-tensor"!==e)throw new Error("Not supported preferred output location: ".concat(e,"."));if(y&&"gpu-buffer"!==e)throw new Error("Not supported preferred output location: ".concat(e,". Only 'gpu-buffer' location is supported when enableGraphCapture is true."));x.push(e)}}let S=null;return x.some(e=>"gpu-buffer"===e||"ml-tensor"===e||"ml-tensor-cpu-output"===e)&&(s=r._OrtCreateBinding(o),0===s&&st("Can't create IO binding."),S={handle:s,outputPreferredLocations:x,outputPreferredLocationsEncoded:x.map(e=>"ml-tensor-cpu-output"===e?"ml-tensor":e).map(e=>xt(e))}),Zu.set(o,[o,l,u,S,y,!1]),[o,v,_,w,b]}catch(Lk){throw l.forEach(e=>r._OrtFree(e)),u.forEach(e=>r._OrtFree(e)),0!==s&&0!==r._OrtReleaseBinding(s)&&st("Can't release IO binding."),0!==o&&0!==r._OrtReleaseSession(o)&&st("Can't release session."),Lk}finally{var g;r._free(n),0!==a&&0!==r._OrtReleaseSessionOptions(a)&&st("Can't release session options."),c.forEach(e=>r._free(e)),null===(g=r.unmountExternalData)||void 0===g||g.call(r)}},$u=e=>{var t,n,i;let r=rt(),o=Zu.get(e);if(!o)throw new Error("cannot release session. invalid session id: ".concat(e));let[a,s,c,l,u]=o;l&&(u&&0!==r._OrtClearBoundOutputs(l.handle)&&st("Can't clear bound outputs."),0!==r._OrtReleaseBinding(l.handle)&&st("Can't release IO binding.")),null!==(t=r.jsepOnReleaseSession)&&void 0!==t&&t.call(r,e),null!==(n=r.webnnOnReleaseSession)&&void 0!==n&&n.call(r,e),null!==(i=r.webgpuOnReleaseSession)&&void 0!==i&&i.call(r,e),s.forEach(e=>r._OrtFree(e)),c.forEach(e=>r._OrtFree(e)),0!==r._OrtReleaseSession(a)&&st("Can't release session."),Zu.delete(e)},ed=async function(e,t,n,i,r,o){let a=arguments.length>6&&void 0!==arguments[6]&&arguments[6];if(!e)return void t.push(0);let s,c,l=rt(),u=l.PTR_SIZE,d=e[0],h=e[1],f=e[3],p=f;if("string"===d&&("gpu-buffer"===f||"ml-tensor"===f))throw new Error("String tensor is not supported on GPU.");if(a&&"gpu-buffer"!==f)throw new Error("External buffer must be provided for input/output index ".concat(o," when enableGraphCapture is true."));if("gpu-buffer"===f){let t=e[2].gpuBuffer;c=yt(mt(d),h);{let e=l.jsepRegisterBuffer;if(!e)throw new Error('Tensor location "gpu-buffer" is not supported without using WebGPU.');s=e(i,o,t,c)}}else if("ml-tensor"===f){let t=e[2].mlTensor;c=yt(mt(d),h);let n=l.webnnRegisterMLTensor;if(!n)throw new Error('Tensor location "ml-tensor" is not supported without using WebNN.');s=n(i,t,mt(d),h)}else{let t=e[2];if(Array.isArray(t)){c=u*t.length,s=l._malloc(c),n.push(s);for(let e=0;e<t.length;e++){if("string"!=typeof t[e])throw new TypeError("tensor data at index ".concat(e," is not a string"));l.setValue(s+e*u,ot(t[e],n),"*")}}else{let e=l.webnnIsGraphInput,o=l.webnnIsGraphOutput;if("string"!==d&&e&&o){let a=l.UTF8ToString(r);if(e(i,a)||o(i,a)){let e=mt(d);c=yt(e,h),p="ml-tensor";let n=l.webnnCreateTemporaryTensor,r=l.webnnUploadTensor;if(!n||!r)throw new Error('Tensor location "ml-tensor" is not supported without using WebNN.');let o=await n(i,e,h);r(o,new Uint8Array(t.buffer,t.byteOffset,t.byteLength)),s=o}else c=t.byteLength,s=l._malloc(c),n.push(s),l.HEAPU8.set(new Uint8Array(t.buffer,t.byteOffset,c),s)}else c=t.byteLength,s=l._malloc(c),n.push(s),l.HEAPU8.set(new Uint8Array(t.buffer,t.byteOffset,c),s)}}let m=l.stackSave(),g=l.stackAlloc(4*h.length);try{h.forEach((e,t)=>l.setValue(g+t*u,e,4===u?"i32":"i64"));let e=l._OrtCreateTensor(mt(d),s,c,g,h.length,xt(p));0===e&&st("Can't create tensor for input/output. session=".concat(i,", index=").concat(o,".")),t.push(e)}finally{l.stackRestore(m)}},td=async(e,t,n,i,r,o)=>{let a=rt(),s=a.PTR_SIZE,c=Zu.get(e);if(!c)throw new Error("cannot run inference. invalid session id: ".concat(e));let l=c[0],u=c[1],d=c[2],h=c[3],f=c[4],p=c[5],m=t.length,g=i.length,y=0,v=[],_=[],w=[],b=[],x=a.stackSave(),S=a.stackAlloc(m*s),E=a.stackAlloc(m*s),T=a.stackAlloc(g*s),k=a.stackAlloc(g*s);try{var C,I;[y,v]=ct(o),Q("wasm prepareInputOutputTensor");for(let i=0;i<m;i++)await ed(n[i],_,b,e,u[t[i]],t[i],f);for(let t=0;t<g;t++)await ed(r[t],w,b,e,d[i[t]],m+i[t],f);X("wasm prepareInputOutputTensor");for(let e=0;e<m;e++)a.setValue(S+e*s,_[e],"*"),a.setValue(E+e*s,u[t[e]],"*");for(let e=0;e<g;e++)a.setValue(T+e*s,w[e],"*"),a.setValue(k+e*s,d[i[e]],"*");if(h&&!p){let{handle:n,outputPreferredLocations:o,outputPreferredLocationsEncoded:s}=h;if(u.length!==m)throw new Error("input count from feeds (".concat(m,") is expected to be always equal to model's input count (").concat(u.length,")."));Q("wasm bindInputsOutputs");for(let i=0;i<m;i++){let r=t[i];0!==await a._OrtBindInput(n,u[r],_[i])&&st("Can't bind input[".concat(i,"] for session=").concat(e,"."))}for(let t=0;t<g;t++){var A;let c=i[t];null!==(A=r[t])&&void 0!==A&&A[3]?0!==a._OrtBindOutput(n,d[c],w[t],0)&&st("Can't bind pre-allocated output[".concat(t,"] for session=").concat(e,".")):0!==a._OrtBindOutput(n,d[c],0,s[c])&&st("Can't bind output[".concat(t,"] to ").concat(o[t]," for session=").concat(e,"."))}X("wasm bindInputsOutputs"),Zu.set(e,[l,u,d,h,f,!0])}let c;null!==(C=a.jsepOnRunStart)&&void 0!==C&&C.call(a,l),null===(I=a.webnnOnRunStart)||void 0===I||I.call(a,l),c=h?await a._OrtRunWithBinding(l,h.handle,g,T,y):await a._OrtRun(l,E,S,m,k,g,T,y),0!==c&&st("failed to call OrtRun().");let x=[],N=[];Q("wasm ProcessOutputTensor");for(let t=0;t<g;t++){let n=Number(a.getValue(T+t*s,"*"));if(n===w[t]){x.push(r[t]);continue}let o,c=a.stackSave(),l=a.stackAlloc(4*s),u=!1,d=0;try{0!==a._OrtGetTensorData(n,l,l+s,l+2*s,l+3*s)&&st("Can't access output tensor data on index ".concat(t,"."));let r=4===s?"i32":"i64",c=Number(a.getValue(l,r));d=a.getValue(l+s,"*");let f=a.getValue(l+2*s,"*"),p=Number(a.getValue(l+3*s,r)),m=[];for(let e=0;e<p;e++)m.push(Number(a.getValue(f+e*s,r)));0!==a._OrtFree(f)&&st("Can't free memory for tensor dims.");let g=m.reduce((e,t)=>e*t,1);o=gt(c);let y=null===h||void 0===h?void 0:h.outputPreferredLocations[i[t]];if("string"===o){if("gpu-buffer"===y||"ml-tensor"===y)throw new Error("String tensor is not supported on GPU.");let e=[];for(let t=0;t<g;t++){let n=a.getValue(d+t*s,"*"),i=a.getValue(d+(t+1)*s,"*"),r=t===g-1?void 0:i-n;e.push(a.UTF8ToString(n,r))}x.push([o,m,e,"cpu"])}else if("gpu-buffer"===y&&g>0){let e=a.jsepGetBuffer;if(!e)throw new Error('preferredLocation "gpu-buffer" is not supported without using WebGPU.');let t=e(d),i=yt(c,g);if(void 0===i||!wt(o))throw new Error("Unsupported data type: ".concat(o));u=!0,x.push([o,m,{gpuBuffer:t,download:a.jsepCreateDownloader(t,i,o),dispose:()=>{0!==a._OrtReleaseTensor(n)&&st("Can't release tensor.")}},"gpu-buffer"])}else if("ml-tensor"===y&&g>0){let t=a.webnnEnsureTensor,i=a.webnnIsGraphInputOutputTypeSupported;if(!t||!i)throw new Error('preferredLocation "ml-tensor" is not supported without using WebNN.');if(void 0===yt(c,g)||!bt(o))throw new Error("Unsupported data type: ".concat(o));if(!i(e,o,!1))throw new Error('preferredLocation "ml-tensor" for '.concat(o," output is not supported by current WebNN Context."));let r=await t(e,d,c,m,!1);u=!0,x.push([o,m,{mlTensor:r,download:a.webnnCreateMLTensorDownloader(d,o),dispose:()=>{a.webnnReleaseTensorId(d),a._OrtReleaseTensor(n)}},"ml-tensor"])}else if("ml-tensor-cpu-output"===y&&g>0){let e=a.webnnCreateMLTensorDownloader(d,o)(),t=x.length;u=!0,N.push((async()=>{let i=[t,await e];return a.webnnReleaseTensorId(d),a._OrtReleaseTensor(n),i})()),x.push([o,m,[],"cpu"])}else{let e=new(vt(o))(g);new Uint8Array(e.buffer,e.byteOffset,e.byteLength).set(a.HEAPU8.subarray(d,d+e.byteLength)),x.push([o,m,e,"cpu"])}}finally{a.stackRestore(c),"string"===o&&d&&a._free(d),u||a._OrtReleaseTensor(n)}}h&&!f&&(0!==a._OrtClearBoundOutputs(h.handle)&&st("Can't clear bound outputs."),Zu.set(e,[l,u,d,h,f,!1]));for(let[e,t]of await Promise.all(N))x[e][2]=t;return X("wasm ProcessOutputTensor"),x}finally{var N;null!==(N=a.webnnOnRunEnd)&&void 0!==N&&N.call(a,l),a.stackRestore(x),_.forEach(e=>a._OrtReleaseTensor(e)),w.forEach(e=>a._OrtReleaseTensor(e)),b.forEach(e=>a._free(e)),0!==y&&a._OrtReleaseRunOptions(y),v.forEach(e=>a._free(e))}},nd=e=>{let t=rt(),n=Zu.get(e);if(!n)throw new Error("invalid session id");let i=n[0],r=t._OrtEndProfiling(i);0===r&&st("Can't get an profile file name."),t._OrtFree(r)},id=e=>{let t=[];for(let n of e){let e=n[2];!Array.isArray(e)&&"buffer"in e&&t.push(e.buffer)}return t}}),Cd=re(()=>{ke(),kd(),wl(),_l(),rd=()=>!!I.wasm.proxy&&typeof document<"u",ad=!1,sd=!1,cd=!1,dd=new Map,hd=(e,t)=>{let n=dd.get(e);n?n.push(t):dd.set(e,[t])},fd=()=>{if(ad||!sd||cd||!od)throw new Error("worker not ready")},pd=e=>{switch(e.data.type){case"init-wasm":ad=!1,e.data.err?(cd=!0,ud[1](e.data.err)):(sd=!0,ud[0]()),ld&&(URL.revokeObjectURL(ld),ld=void 0);break;case"init-ep":case"copy-from":case"create":case"release":case"run":case"end-profiling":{let t=dd.get(e.data.type);e.data.err?t.shift()[1](e.data.err):t.shift()[0](e.data.out);break}}},md=async()=>{if(!sd){if(ad)throw new Error("multiple calls to 'initWasm()' detected.");if(cd)throw new Error("previous call to 'initWasm()' failed.");if(ad=!0,rd())return new Promise((e,t)=>{var i;null!==(i=od)&&void 0!==i&&i.terminate(),Ke().then(i=>{let[r,o]=i;try{(od=o).onerror=e=>t(e),od.onmessage=pd,ud=[e,t];let i={type:"init-wasm",in:I};!i.in.wasm.wasmPaths&&(r||De)&&(i.in.wasm.wasmPaths={wasm:new URL(n(98),n.b).href}),od.postMessage(i),ld=r}catch(Ok){t(Ok)}},t)});try{await it(I.wasm),await Gu(I),sd=!0}catch(Tk){throw cd=!0,Tk}finally{ad=!1}}},gd=async e=>{if(rd())return fd(),new Promise((t,n)=>{hd("init-ep",[t,n]);let i={type:"init-ep",in:{epName:e,env:I}};od.postMessage(i)});await Ku(I,e)},yd=async e=>rd()?(fd(),new Promise((t,n)=>{hd("copy-from",[t,n]);let i={type:"copy-from",in:{buffer:e}};od.postMessage(i,[e.buffer])})):Yu(e),vd=async(e,t)=>{if(rd()){if(null!==t&&void 0!==t&&t.preferredOutputLocation)throw new Error('session option "preferredOutputLocation" is not supported for proxy.');return fd(),new Promise((n,i)=>{hd("create",[n,i]);let r={type:"create",in:{model:e,options:s({},t)}},o=[];e instanceof Uint8Array&&o.push(e.buffer),od.postMessage(r,o)})}return Ju(e,t)},_d=async e=>{if(rd())return fd(),new Promise((t,n)=>{hd("release",[t,n]);let i={type:"release",in:e};od.postMessage(i)});$u(e)},wd=async(e,t,n,i,r,o)=>{if(rd()){if(n.some(e=>"cpu"!==e[3]))throw new Error("input tensor on GPU is not supported for proxy.");if(r.some(e=>e))throw new Error("pre-allocated output tensor is not supported for proxy.");return fd(),new Promise((r,a)=>{hd("run",[r,a]);let s=n,c={type:"run",in:{sessionId:e,inputIndices:t,inputs:s,outputIndices:i,options:o}};od.postMessage(c,id(s))})}return td(e,t,n,i,r,o)},bd=async e=>{if(rd())return fd(),new Promise((t,n)=>{hd("end-profiling",[t,n]);let i={type:"end-profiling",in:e};od.postMessage(i)});nd(e)}}),Id=re(()=>{ke(),Cd(),El(),Ce(),Tl(),xd=(e,t)=>{switch(e.location){case"cpu":return[e.type,e.dims,e.data,"cpu"];case"gpu-buffer":return[e.type,e.dims,{gpuBuffer:e.gpuBuffer},"gpu-buffer"];case"ml-tensor":return[e.type,e.dims,{mlTensor:e.mlTensor},"ml-tensor"];default:throw new Error("invalid data location: ".concat(e.location," for ").concat(t()))}},Sd=e=>{switch(e[3]){case"cpu":return new H(e[0],e[2],e[1]);case"gpu-buffer":{let t=e[0];if(!wt(t))throw new Error("not supported data type: ".concat(t," for deserializing GPU tensor"));let{gpuBuffer:n,download:i,dispose:r}=e[2];return H.fromGpuBuffer(n,{dataType:t,dims:e[1],download:i,dispose:r})}case"ml-tensor":{let t=e[0];if(!bt(t))throw new Error("not supported data type: ".concat(t," for deserializing MLTensor tensor"));let{mlTensor:n,download:i,dispose:r}=e[2];return H.fromMLTensor(n,{dataType:t,dims:e[1],download:i,dispose:r})}default:throw new Error("invalid data location: ".concat(e[3]))}},Ed=class{async fetchModelAndCopyToWasmMemory(e){return yd(await St(e))}async loadModel(e,t){let n;K(),n="string"==typeof e?await this.fetchModelAndCopyToWasmMemory(e):e,[this.sessionId,this.inputNames,this.outputNames,this.inputMetadata,this.outputMetadata]=await vd(n,t),Z()}async dispose(){return _d(this.sessionId)}async run(e,t,n){K();let i=[],r=[];Object.entries(e).forEach(e=>{let t=e[0],n=e[1],o=this.inputNames.indexOf(t);if(-1===o)throw new Error("invalid input '".concat(t,"'"));i.push(n),r.push(o)});let o=[],a=[];Object.entries(t).forEach(e=>{let t=e[0],n=e[1],i=this.outputNames.indexOf(t);if(-1===i)throw new Error("invalid output '".concat(t,"'"));o.push(n),a.push(i)});let s=i.map((e,t)=>xd(e,()=>'input "'.concat(this.inputNames[r[t]],'"'))),c=o.map((e,t)=>e?xd(e,()=>'output "'.concat(this.outputNames[a[t]],'"')):null),l=await wd(this.sessionId,r,s,a,c,n),u={};for(let h=0;h<l.length;h++){var d;u[this.outputNames[a[h]]]=null!==(d=o[h])&&void 0!==d?d:Sd(l[h])}return Z(),u}startProfiling(){}endProfiling(){bd(this.sessionId)}}}),Ad={};oe(Ad,{OnnxruntimeWebAssemblyBackend:()=>Od,initializeFlags:()=>Nd,wasmBackend:()=>Pd});var Nd,Od,Pd,Rd=re(()=>{ke(),Cd(),Id(),Nd=()=>{("number"!=typeof I.wasm.initTimeout||I.wasm.initTimeout<0)&&(I.wasm.initTimeout=0);let e=I.wasm.simd;if("boolean"!=typeof e&&void 0!==e&&"fixed"!==e&&"relaxed"!==e&&(console.warn('Property "env.wasm.simd" is set to unknown value "'.concat(e,'". Reset it to `false` and ignore SIMD feature checking.')),I.wasm.simd=!1),"boolean"!=typeof I.wasm.proxy&&(I.wasm.proxy=!1),"boolean"!=typeof I.wasm.trace&&(I.wasm.trace=!1),"number"!=typeof I.wasm.numThreads||!Number.isInteger(I.wasm.numThreads)||I.wasm.numThreads<=0)if(typeof self<"u"&&!self.crossOriginIsolated)I.wasm.numThreads=1;else{let e=typeof navigator>"u"?ie("node:os").cpus().length:navigator.hardwareConcurrency;I.wasm.numThreads=Math.min(4,Math.ceil((e||1)/2))}},Od=class{async init(e){Nd(),await md(),await gd(e)}async createInferenceSessionHandler(e,t){let n=new Ed;return await n.loadModel(e,t),n}},Pd=new Od});ke(),ke(),ke();{let e=(Rd(),ae(Ad)).wasmBackend;x("webgpu",e,5),x("webnn",e,5),x("cpu",e,10),x("wasm",e,10)}Object.defineProperty(I.versions,"web",{value:"1.23.2",enumerable:!0});const Ld=d("Navigation",[["polygon",{points:"3 11 22 2 13 21 11 13 3 11",key:"1ltx0t"}]]),zd=d("MapPin",[["path",{d:"M20 10c0 6-8 12-8 12s-8-6-8-12a8 8 0 0 1 16 0Z",key:"2oe9fu"}],["circle",{cx:"12",cy:"10",r:"3",key:"ilqhr7"}]]),Md=d("Lock",[["rect",{width:"18",height:"11",x:"3",y:"11",rx:"2",ry:"2",key:"1w4ew1"}],["path",{d:"M7 11V7a5 5 0 0 1 10 0v4",key:"fwvmzm"}]]),Dd=function(e){const t=[];let n=0;for(let i=0;i<e.length;i++){let r=e.charCodeAt(i);r<128?t[n++]=r:r<2048?(t[n++]=r>>6|192,t[n++]=63&r|128):55296===(64512&r)&&i+1<e.length&&56320===(64512&e.charCodeAt(i+1))?(r=65536+((1023&r)<<10)+(1023&e.charCodeAt(++i)),t[n++]=r>>18|240,t[n++]=r>>12&63|128,t[n++]=r>>6&63|128,t[n++]=63&r|128):(t[n++]=r>>12|224,t[n++]=r>>6&63|128,t[n++]=63&r|128)}return t},Bd={byteToCharMap_:null,charToByteMap_:null,byteToCharMapWebSafe_:null,charToByteMapWebSafe_:null,ENCODED_VALS_BASE:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",get ENCODED_VALS(){return this.ENCODED_VALS_BASE+"+/="},get ENCODED_VALS_WEBSAFE(){return this.ENCODED_VALS_BASE+"-_."},HAS_NATIVE_SUPPORT:"function"===typeof atob,encodeByteArray(e,t){if(!Array.isArray(e))throw Error("encodeByteArray takes an array as a parameter");this.init_();const n=t?this.byteToCharMapWebSafe_:this.byteToCharMap_,i=[];for(let r=0;r<e.length;r+=3){const t=e[r],o=r+1<e.length,a=o?e[r+1]:0,s=r+2<e.length,c=s?e[r+2]:0,l=t>>2,u=(3&t)<<4|a>>4;let d=(15&a)<<2|c>>6,h=63&c;s||(h=64,o||(d=64)),i.push(n[l],n[u],n[d],n[h])}return i.join("")},encodeString(e,t){return this.HAS_NATIVE_SUPPORT&&!t?btoa(e):this.encodeByteArray(Dd(e),t)},decodeString(e,t){return this.HAS_NATIVE_SUPPORT&&!t?atob(e):function(e){const t=[];let n=0,i=0;for(;n<e.length;){const r=e[n++];if(r<128)t[i++]=String.fromCharCode(r);else if(r>191&&r<224){const o=e[n++];t[i++]=String.fromCharCode((31&r)<<6|63&o)}else if(r>239&&r<365){const o=((7&r)<<18|(63&e[n++])<<12|(63&e[n++])<<6|63&e[n++])-65536;t[i++]=String.fromCharCode(55296+(o>>10)),t[i++]=String.fromCharCode(56320+(1023&o))}else{const o=e[n++],a=e[n++];t[i++]=String.fromCharCode((15&r)<<12|(63&o)<<6|63&a)}}return t.join("")}(this.decodeStringToByteArray(e,t))},decodeStringToByteArray(e,t){this.init_();const n=t?this.charToByteMapWebSafe_:this.charToByteMap_,i=[];for(let r=0;r<e.length;){const t=n[e.charAt(r++)],o=r<e.length?n[e.charAt(r)]:0;++r;const a=r<e.length?n[e.charAt(r)]:64;++r;const s=r<e.length?n[e.charAt(r)]:64;if(++r,null==t||null==o||null==a||null==s)throw new Ud;const c=t<<2|o>>4;if(i.push(c),64!==a){const e=o<<4&240|a>>2;if(i.push(e),64!==s){const e=a<<6&192|s;i.push(e)}}}return i},init_(){if(!this.byteToCharMap_){this.byteToCharMap_={},this.charToByteMap_={},this.byteToCharMapWebSafe_={},this.charToByteMapWebSafe_={};for(let e=0;e<this.ENCODED_VALS.length;e++)this.byteToCharMap_[e]=this.ENCODED_VALS.charAt(e),this.charToByteMap_[this.byteToCharMap_[e]]=e,this.byteToCharMapWebSafe_[e]=this.ENCODED_VALS_WEBSAFE.charAt(e),this.charToByteMapWebSafe_[this.byteToCharMapWebSafe_[e]]=e,e>=this.ENCODED_VALS_BASE.length&&(this.charToByteMap_[this.ENCODED_VALS_WEBSAFE.charAt(e)]=e,this.charToByteMapWebSafe_[this.ENCODED_VALS.charAt(e)]=e)}}};class Ud extends Error{constructor(){super(...arguments),this.name="DecodeBase64StringError"}}const Fd=function(e){return function(e){const t=Dd(e);return Bd.encodeByteArray(t,!0)}(e).replace(/\./g,"")},jd=function(e){try{return Bd.decodeString(e,!0)}catch(Tk){console.error("base64Decode failed: ",Tk)}return null};const Vd=()=>function(){if("undefined"!==typeof self)return self;if("undefined"!==typeof window)return window;if("undefined"!==typeof n.g)return n.g;throw new Error("Unable to locate global object.")}().__FIREBASE_DEFAULTS__,qd=()=>{try{return Vd()||(()=>{if("undefined"===typeof process)return;const e={NODE_ENV:"production",PUBLIC_URL:"/reef-monitor-app",WDS_SOCKET_HOST:void 0,WDS_SOCKET_PATH:void 0,WDS_SOCKET_PORT:void 0,FAST_REFRESH:!0}.__FIREBASE_DEFAULTS__;return e?JSON.parse(e):void 0})()||(()=>{if("undefined"===typeof document)return;let e;try{e=document.cookie.match(/__FIREBASE_DEFAULTS__=([^;]+)/)}catch(Tk){return}const t=e&&jd(e[1]);return t&&JSON.parse(t)})()}catch(Tk){return void console.info("Unable to get __FIREBASE_DEFAULTS__ due to: ".concat(Tk))}},Hd=e=>{var t,n;return null===(n=null===(t=qd())||void 0===t?void 0:t.emulatorHosts)||void 0===n?void 0:n[e]},Wd=e=>{const t=Hd(e);if(!t)return;const n=t.lastIndexOf(":");if(n<=0||n+1===t.length)throw new Error("Invalid host ".concat(t," with no separate hostname and port!"));const i=parseInt(t.substring(n+1),10);return"["===t[0]?[t.substring(1,n-1),i]:[t.substring(0,n),i]},Gd=()=>{var e;return null===(e=qd())||void 0===e?void 0:e.config},Kd=e=>{var t;return null===(t=qd())||void 0===t?void 0:t["_".concat(e)]};class Zd{constructor(){this.reject=()=>{},this.resolve=()=>{},this.promise=new Promise((e,t)=>{this.resolve=e,this.reject=t})}wrapCallback(e){return(t,n)=>{t?this.reject(t):this.resolve(n),"function"===typeof e&&(this.promise.catch(()=>{}),1===e.length?e(t):e(t,n))}}}function Qd(e,t){if(e.uid)throw new Error('The "uid" field is no longer supported by mockUserToken. Please use "sub" instead for Firebase Auth User ID.');const n=t||"demo-project",i=e.iat||0,r=e.sub||e.user_id;if(!r)throw new Error("mockUserToken must contain 'sub' or 'user_id' field!");const o=Object.assign({iss:"https://securetoken.google.com/".concat(n),aud:n,iat:i,exp:i+3600,auth_time:i,sub:r,user_id:r,firebase:{sign_in_provider:"custom",identities:{}}},e);return[Fd(JSON.stringify({alg:"none",type:"JWT"})),Fd(JSON.stringify(o)),""].join(".")}function Xd(){return"undefined"!==typeof navigator&&"string"===typeof navigator.userAgent?navigator.userAgent:""}function Yd(){return!function(){var e;const t=null===(e=qd())||void 0===e?void 0:e.forceEnvironment;if("node"===t)return!0;if("browser"===t)return!1;try{return"[object process]"===Object.prototype.toString.call(n.g.process)}catch(Tk){return!1}}()&&!!navigator.userAgent&&navigator.userAgent.includes("Safari")&&!navigator.userAgent.includes("Chrome")}function Jd(){try{return"object"===typeof indexedDB}catch(Tk){return!1}}class $d extends Error{constructor(e,t,n){super(t),this.code=e,this.customData=n,this.name="FirebaseError",Object.setPrototypeOf(this,$d.prototype),Error.captureStackTrace&&Error.captureStackTrace(this,eh.prototype.create)}}class eh{constructor(e,t,n){this.service=e,this.serviceName=t,this.errors=n}create(e){const t=(arguments.length<=1?void 0:arguments[1])||{},n="".concat(this.service,"/").concat(e),i=this.errors[e],r=i?function(e,t){return e.replace(th,(e,n)=>{const i=t[n];return null!=i?String(i):"<".concat(n,"?>")})}(i,t):"Error",o="".concat(this.serviceName,": ").concat(r," (").concat(n,").");return new $d(n,o,t)}}const th=/\{\$([^}]+)}/g;function nh(e,t){if(e===t)return!0;const n=Object.keys(e),i=Object.keys(t);for(const r of n){if(!i.includes(r))return!1;const n=e[r],o=t[r];if(ih(n)&&ih(o)){if(!nh(n,o))return!1}else if(n!==o)return!1}for(const r of i)if(!n.includes(r))return!1;return!0}function ih(e){return null!==e&&"object"===typeof e}function rh(e){const t=[];for(const[n,i]of Object.entries(e))Array.isArray(i)?i.forEach(e=>{t.push(encodeURIComponent(n)+"="+encodeURIComponent(e))}):t.push(encodeURIComponent(n)+"="+encodeURIComponent(i));return t.length?"&"+t.join("&"):""}function oh(e){const t={};return e.replace(/^\?/,"").split("&").forEach(e=>{if(e){const[n,i]=e.split("=");t[decodeURIComponent(n)]=decodeURIComponent(i)}}),t}function ah(e){const t=e.indexOf("?");if(!t)return"";const n=e.indexOf("#",t);return e.substring(t,n>0?n:void 0)}class sh{constructor(e,t){this.observers=[],this.unsubscribes=[],this.observerCount=0,this.task=Promise.resolve(),this.finalized=!1,this.onNoObservers=t,this.task.then(()=>{e(this)}).catch(e=>{this.error(e)})}next(e){this.forEachObserver(t=>{t.next(e)})}error(e){this.forEachObserver(t=>{t.error(e)}),this.close(e)}complete(){this.forEachObserver(e=>{e.complete()}),this.close()}subscribe(e,t,n){let i;if(void 0===e&&void 0===t&&void 0===n)throw new Error("Missing Observer.");i=function(e,t){if("object"!==typeof e||null===e)return!1;for(const n of t)if(n in e&&"function"===typeof e[n])return!0;return!1}(e,["next","error","complete"])?e:{next:e,error:t,complete:n},void 0===i.next&&(i.next=ch),void 0===i.error&&(i.error=ch),void 0===i.complete&&(i.complete=ch);const r=this.unsubscribeOne.bind(this,this.observers.length);return this.finalized&&this.task.then(()=>{try{this.finalError?i.error(this.finalError):i.complete()}catch(Tk){}}),this.observers.push(i),r}unsubscribeOne(e){void 0!==this.observers&&void 0!==this.observers[e]&&(delete this.observers[e],this.observerCount-=1,0===this.observerCount&&void 0!==this.onNoObservers&&this.onNoObservers(this))}forEachObserver(e){if(!this.finalized)for(let t=0;t<this.observers.length;t++)this.sendOne(t,e)}sendOne(e,t){this.task.then(()=>{if(void 0!==this.observers&&void 0!==this.observers[e])try{t(this.observers[e])}catch(Tk){"undefined"!==typeof console&&console.error&&console.error(Tk)}})}close(e){this.finalized||(this.finalized=!0,void 0!==e&&(this.finalError=e),this.task.then(()=>{this.observers=void 0,this.onNoObservers=void 0}))}}function ch(){}function lh(e){return e&&e._delegate?e._delegate:e}class uh{constructor(e,t,n){this.name=e,this.instanceFactory=t,this.type=n,this.multipleInstances=!1,this.serviceProps={},this.instantiationMode="LAZY",this.onInstanceCreated=null}setInstantiationMode(e){return this.instantiationMode=e,this}setMultipleInstances(e){return this.multipleInstances=e,this}setServiceProps(e){return this.serviceProps=e,this}setInstanceCreatedCallback(e){return this.onInstanceCreated=e,this}}const dh="[DEFAULT]";class hh{constructor(e,t){this.name=e,this.container=t,this.component=null,this.instances=new Map,this.instancesDeferred=new Map,this.instancesOptions=new Map,this.onInitCallbacks=new Map}get(e){const t=this.normalizeInstanceIdentifier(e);if(!this.instancesDeferred.has(t)){const e=new Zd;if(this.instancesDeferred.set(t,e),this.isInitialized(t)||this.shouldAutoInitialize())try{const n=this.getOrInitializeService({instanceIdentifier:t});n&&e.resolve(n)}catch(Tk){}}return this.instancesDeferred.get(t).promise}getImmediate(e){var t;const n=this.normalizeInstanceIdentifier(null===e||void 0===e?void 0:e.identifier),i=null!==(t=null===e||void 0===e?void 0:e.optional)&&void 0!==t&&t;if(!this.isInitialized(n)&&!this.shouldAutoInitialize()){if(i)return null;throw Error("Service ".concat(this.name," is not available"))}try{return this.getOrInitializeService({instanceIdentifier:n})}catch(Tk){if(i)return null;throw Tk}}getComponent(){return this.component}setComponent(e){if(e.name!==this.name)throw Error("Mismatching Component ".concat(e.name," for Provider ").concat(this.name,"."));if(this.component)throw Error("Component for ".concat(this.name," has already been provided"));if(this.component=e,this.shouldAutoInitialize()){if(function(e){return"EAGER"===e.instantiationMode}(e))try{this.getOrInitializeService({instanceIdentifier:dh})}catch(Tk){}for(const[e,t]of this.instancesDeferred.entries()){const n=this.normalizeInstanceIdentifier(e);try{const e=this.getOrInitializeService({instanceIdentifier:n});t.resolve(e)}catch(Tk){}}}}clearInstance(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:dh;this.instancesDeferred.delete(e),this.instancesOptions.delete(e),this.instances.delete(e)}async delete(){const e=Array.from(this.instances.values());await Promise.all([...e.filter(e=>"INTERNAL"in e).map(e=>e.INTERNAL.delete()),...e.filter(e=>"_delete"in e).map(e=>e._delete())])}isComponentSet(){return null!=this.component}isInitialized(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:dh;return this.instances.has(e)}getOptions(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:dh;return this.instancesOptions.get(e)||{}}initialize(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};const{options:t={}}=e,n=this.normalizeInstanceIdentifier(e.instanceIdentifier);if(this.isInitialized(n))throw Error("".concat(this.name,"(").concat(n,") has already been initialized"));if(!this.isComponentSet())throw Error("Component ".concat(this.name," has not been registered yet"));const i=this.getOrInitializeService({instanceIdentifier:n,options:t});for(const[r,o]of this.instancesDeferred.entries()){n===this.normalizeInstanceIdentifier(r)&&o.resolve(i)}return i}onInit(e,t){var n;const i=this.normalizeInstanceIdentifier(t),r=null!==(n=this.onInitCallbacks.get(i))&&void 0!==n?n:new Set;r.add(e),this.onInitCallbacks.set(i,r);const o=this.instances.get(i);return o&&e(o,i),()=>{r.delete(e)}}invokeOnInitCallbacks(e,t){const n=this.onInitCallbacks.get(t);if(n)for(const i of n)try{i(e,t)}catch(we){}}getOrInitializeService(e){let{instanceIdentifier:t,options:n={}}=e,i=this.instances.get(t);if(!i&&this.component&&(i=this.component.instanceFactory(this.container,{instanceIdentifier:(r=t,r===dh?void 0:r),options:n}),this.instances.set(t,i),this.instancesOptions.set(t,n),this.invokeOnInitCallbacks(i,t),this.component.onInstanceCreated))try{this.component.onInstanceCreated(this.container,t,i)}catch(we){}var r;return i||null}normalizeInstanceIdentifier(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:dh;return this.component?this.component.multipleInstances?e:dh:e}shouldAutoInitialize(){return!!this.component&&"EXPLICIT"!==this.component.instantiationMode}}class fh{constructor(e){this.name=e,this.providers=new Map}addComponent(e){const t=this.getProvider(e.name);if(t.isComponentSet())throw new Error("Component ".concat(e.name," has already been registered with ").concat(this.name));t.setComponent(e)}addOrOverwriteComponent(e){this.getProvider(e.name).isComponentSet()&&this.providers.delete(e.name),this.addComponent(e)}getProvider(e){if(this.providers.has(e))return this.providers.get(e);const t=new hh(e,this);return this.providers.set(e,t),t}getProviders(){return Array.from(this.providers.values())}}const ph=[];var mh;!function(e){e[e.DEBUG=0]="DEBUG",e[e.VERBOSE=1]="VERBOSE",e[e.INFO=2]="INFO",e[e.WARN=3]="WARN",e[e.ERROR=4]="ERROR",e[e.SILENT=5]="SILENT"}(mh||(mh={}));const gh={debug:mh.DEBUG,verbose:mh.VERBOSE,info:mh.INFO,warn:mh.WARN,error:mh.ERROR,silent:mh.SILENT},yh=mh.INFO,vh={[mh.DEBUG]:"log",[mh.VERBOSE]:"log",[mh.INFO]:"info",[mh.WARN]:"warn",[mh.ERROR]:"error"},_h=function(e,t){if(t<e.logLevel)return;const n=(new Date).toISOString(),i=vh[t];if(!i)throw new Error("Attempted to log a message with an invalid logType (value: ".concat(t,")"));for(var r=arguments.length,o=new Array(r>2?r-2:0),a=2;a<r;a++)o[a-2]=arguments[a];console[i]("[".concat(n,"]  ").concat(e.name,":"),...o)};class wh{constructor(e){this.name=e,this._logLevel=yh,this._logHandler=_h,this._userLogHandler=null,ph.push(this)}get logLevel(){return this._logLevel}set logLevel(e){if(!(e in mh))throw new TypeError('Invalid value "'.concat(e,'" assigned to `logLevel`'));this._logLevel=e}setLogLevel(e){this._logLevel="string"===typeof e?gh[e]:e}get logHandler(){return this._logHandler}set logHandler(e){if("function"!==typeof e)throw new TypeError("Value assigned to `logHandler` must be a function");this._logHandler=e}get userLogHandler(){return this._userLogHandler}set userLogHandler(e){this._userLogHandler=e}debug(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];this._userLogHandler&&this._userLogHandler(this,mh.DEBUG,...t),this._logHandler(this,mh.DEBUG,...t)}log(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];this._userLogHandler&&this._userLogHandler(this,mh.VERBOSE,...t),this._logHandler(this,mh.VERBOSE,...t)}info(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];this._userLogHandler&&this._userLogHandler(this,mh.INFO,...t),this._logHandler(this,mh.INFO,...t)}warn(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];this._userLogHandler&&this._userLogHandler(this,mh.WARN,...t),this._logHandler(this,mh.WARN,...t)}error(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];this._userLogHandler&&this._userLogHandler(this,mh.ERROR,...t),this._logHandler(this,mh.ERROR,...t)}}let bh,xh;const Sh=new WeakMap,Eh=new WeakMap,Th=new WeakMap,kh=new WeakMap,Ch=new WeakMap;let Ih={get(e,t,n){if(e instanceof IDBTransaction){if("done"===t)return Eh.get(e);if("objectStoreNames"===t)return e.objectStoreNames||Th.get(e);if("store"===t)return n.objectStoreNames[1]?void 0:n.objectStore(n.objectStoreNames[0])}return Oh(e[t])},set:(e,t,n)=>(e[t]=n,!0),has:(e,t)=>e instanceof IDBTransaction&&("done"===t||"store"===t)||t in e};function Ah(e){return e!==IDBDatabase.prototype.transaction||"objectStoreNames"in IDBTransaction.prototype?(xh||(xh=[IDBCursor.prototype.advance,IDBCursor.prototype.continue,IDBCursor.prototype.continuePrimaryKey])).includes(e)?function(){for(var t=arguments.length,n=new Array(t),i=0;i<t;i++)n[i]=arguments[i];return e.apply(Ph(this),n),Oh(Sh.get(this))}:function(){for(var t=arguments.length,n=new Array(t),i=0;i<t;i++)n[i]=arguments[i];return Oh(e.apply(Ph(this),n))}:function(t){for(var n=arguments.length,i=new Array(n>1?n-1:0),r=1;r<n;r++)i[r-1]=arguments[r];const o=e.call(Ph(this),t,...i);return Th.set(o,t.sort?t.sort():[t]),Oh(o)}}function Nh(e){return"function"===typeof e?Ah(e):(e instanceof IDBTransaction&&function(e){if(Eh.has(e))return;const t=new Promise((t,n)=>{const i=()=>{e.removeEventListener("complete",r),e.removeEventListener("error",o),e.removeEventListener("abort",o)},r=()=>{t(),i()},o=()=>{n(e.error||new DOMException("AbortError","AbortError")),i()};e.addEventListener("complete",r),e.addEventListener("error",o),e.addEventListener("abort",o)});Eh.set(e,t)}(e),t=e,(bh||(bh=[IDBDatabase,IDBObjectStore,IDBIndex,IDBCursor,IDBTransaction])).some(e=>t instanceof e)?new Proxy(e,Ih):e);var t}function Oh(e){if(e instanceof IDBRequest)return function(e){const t=new Promise((t,n)=>{const i=()=>{e.removeEventListener("success",r),e.removeEventListener("error",o)},r=()=>{t(Oh(e.result)),i()},o=()=>{n(e.error),i()};e.addEventListener("success",r),e.addEventListener("error",o)});return t.then(t=>{t instanceof IDBCursor&&Sh.set(t,e)}).catch(()=>{}),Ch.set(t,e),t}(e);if(kh.has(e))return kh.get(e);const t=Nh(e);return t!==e&&(kh.set(e,t),Ch.set(t,e)),t}const Ph=e=>Ch.get(e);const Rh=["get","getKey","getAll","getAllKeys","count"],Lh=["put","add","delete","clear"],zh=new Map;function Mh(e,t){if(!(e instanceof IDBDatabase)||t in e||"string"!==typeof t)return;if(zh.get(t))return zh.get(t);const n=t.replace(/FromIndex$/,""),i=t!==n,r=Lh.includes(n);if(!(n in(i?IDBIndex:IDBObjectStore).prototype)||!r&&!Rh.includes(n))return;const o=async function(e){const t=this.transaction(e,r?"readwrite":"readonly");let o=t.store;for(var a=arguments.length,s=new Array(a>1?a-1:0),c=1;c<a;c++)s[c-1]=arguments[c];return i&&(o=o.index(s.shift())),(await Promise.all([o[n](...s),r&&t.done]))[0]};return zh.set(t,o),o}Ih=(e=>s(s({},e),{},{get:(t,n,i)=>Mh(t,n)||e.get(t,n,i),has:(t,n)=>!!Mh(t,n)||e.has(t,n)}))(Ih);class Dh{constructor(e){this.container=e}getPlatformInfoString(){return this.container.getProviders().map(e=>{if(function(e){const t=e.getComponent();return"VERSION"===(null===t||void 0===t?void 0:t.type)}(e)){const t=e.getImmediate();return"".concat(t.library,"/").concat(t.version)}return null}).filter(e=>e).join(" ")}}const Bh="@firebase/app",Uh="0.10.13",Fh=new wh("@firebase/app"),jh="@firebase/app-compat",Vh="@firebase/analytics-compat",qh="@firebase/analytics",Hh="@firebase/app-check-compat",Wh="@firebase/app-check",Gh="@firebase/auth",Kh="@firebase/auth-compat",Zh="@firebase/database",Qh="@firebase/data-connect",Xh="@firebase/database-compat",Yh="@firebase/functions",Jh="@firebase/functions-compat",$h="@firebase/installations",ef="@firebase/installations-compat",tf="@firebase/messaging",nf="@firebase/messaging-compat",rf="@firebase/performance",of="@firebase/performance-compat",af="@firebase/remote-config",sf="@firebase/remote-config-compat",cf="@firebase/storage",lf="@firebase/storage-compat",uf="@firebase/firestore",df="@firebase/vertexai-preview",hf="@firebase/firestore-compat",ff="firebase",pf="[DEFAULT]",mf={[Bh]:"fire-core",[jh]:"fire-core-compat",[qh]:"fire-analytics",[Vh]:"fire-analytics-compat",[Wh]:"fire-app-check",[Hh]:"fire-app-check-compat",[Gh]:"fire-auth",[Kh]:"fire-auth-compat",[Zh]:"fire-rtdb",[Qh]:"fire-data-connect",[Xh]:"fire-rtdb-compat",[Yh]:"fire-fn",[Jh]:"fire-fn-compat",[$h]:"fire-iid",[ef]:"fire-iid-compat",[tf]:"fire-fcm",[nf]:"fire-fcm-compat",[rf]:"fire-perf",[of]:"fire-perf-compat",[af]:"fire-rc",[sf]:"fire-rc-compat",[cf]:"fire-gcs",[lf]:"fire-gcs-compat",[uf]:"fire-fst",[hf]:"fire-fst-compat",[df]:"fire-vertex","fire-js":"fire-js",[ff]:"fire-js-all"},gf=new Map,yf=new Map,vf=new Map;function _f(e,t){try{e.container.addComponent(t)}catch(Tk){Fh.debug("Component ".concat(t.name," failed to register with FirebaseApp ").concat(e.name),Tk)}}function wf(e){const t=e.name;if(vf.has(t))return Fh.debug("There were multiple attempts to register component ".concat(t,".")),!1;vf.set(t,e);for(const n of gf.values())_f(n,e);for(const n of yf.values())_f(n,e);return!0}function bf(e,t){const n=e.container.getProvider("heartbeat").getImmediate({optional:!0});return n&&n.triggerHeartbeat(),e.container.getProvider(t)}function xf(e){return void 0!==e.settings}const Sf=new eh("app","Firebase",{"no-app":"No Firebase App '{$appName}' has been created - call initializeApp() first","bad-app-name":"Illegal App name: '{$appName}'","duplicate-app":"Firebase App named '{$appName}' already exists with different options or config","app-deleted":"Firebase App named '{$appName}' already deleted","server-app-deleted":"Firebase Server App has been deleted","no-options":"Need to provide options, when not being deployed to hosting via source.","invalid-app-argument":"firebase.{$appName}() takes either no argument or a Firebase App instance.","invalid-log-argument":"First argument to `onLog` must be null or a function.","idb-open":"Error thrown when opening IndexedDB. Original error: {$originalErrorMessage}.","idb-get":"Error thrown when reading from IndexedDB. Original error: {$originalErrorMessage}.","idb-set":"Error thrown when writing to IndexedDB. Original error: {$originalErrorMessage}.","idb-delete":"Error thrown when deleting from IndexedDB. Original error: {$originalErrorMessage}.","finalization-registry-not-supported":"FirebaseServerApp deleteOnDeref field defined but the JS runtime does not support FinalizationRegistry.","invalid-server-app-environment":"FirebaseServerApp is not for use in browser environments."});class Ef{constructor(e,t,n){this._isDeleted=!1,this._options=Object.assign({},e),this._config=Object.assign({},t),this._name=t.name,this._automaticDataCollectionEnabled=t.automaticDataCollectionEnabled,this._container=n,this.container.addComponent(new uh("app",()=>this,"PUBLIC"))}get automaticDataCollectionEnabled(){return this.checkDestroyed(),this._automaticDataCollectionEnabled}set automaticDataCollectionEnabled(e){this.checkDestroyed(),this._automaticDataCollectionEnabled=e}get name(){return this.checkDestroyed(),this._name}get options(){return this.checkDestroyed(),this._options}get config(){return this.checkDestroyed(),this._config}get container(){return this._container}get isDeleted(){return this._isDeleted}set isDeleted(e){this._isDeleted=e}checkDestroyed(){if(this.isDeleted)throw Sf.create("app-deleted",{appName:this._name})}}const Tf="10.14.1";function kf(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=e;if("object"!==typeof t){t={name:t}}const i=Object.assign({name:pf,automaticDataCollectionEnabled:!1},t),r=i.name;if("string"!==typeof r||!r)throw Sf.create("bad-app-name",{appName:String(r)});if(n||(n=Gd()),!n)throw Sf.create("no-options");const o=gf.get(r);if(o){if(nh(n,o.options)&&nh(i,o.config))return o;throw Sf.create("duplicate-app",{appName:r})}const a=new fh(r);for(const c of vf.values())a.addComponent(c);const s=new Ef(n,i,a);return gf.set(r,s),s}function Cf(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:pf;const t=gf.get(e);if(!t&&e===pf&&Gd())return kf();if(!t)throw Sf.create("no-app",{appName:e});return t}function If(e,t,n){var i;let r=null!==(i=mf[e])&&void 0!==i?i:e;n&&(r+="-".concat(n));const o=r.match(/\s|\//),a=t.match(/\s|\//);if(o||a){const e=['Unable to register library "'.concat(r,'" with version "').concat(t,'":')];return o&&e.push('library name "'.concat(r,'" contains illegal characters (whitespace or "/")')),o&&a&&e.push("and"),a&&e.push('version name "'.concat(t,'" contains illegal characters (whitespace or "/")')),void Fh.warn(e.join(" "))}wf(new uh("".concat(r,"-version"),()=>({library:r,version:t}),"VERSION"))}const Af="firebase-heartbeat-store";let Nf=null;function Of(){return Nf||(Nf=function(e,t){let{blocked:n,upgrade:i,blocking:r,terminated:o}=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};const a=indexedDB.open(e,t),s=Oh(a);return i&&a.addEventListener("upgradeneeded",e=>{i(Oh(a.result),e.oldVersion,e.newVersion,Oh(a.transaction),e)}),n&&a.addEventListener("blocked",e=>n(e.oldVersion,e.newVersion,e)),s.then(e=>{o&&e.addEventListener("close",()=>o()),r&&e.addEventListener("versionchange",e=>r(e.oldVersion,e.newVersion,e))}).catch(()=>{}),s}("firebase-heartbeat-database",1,{upgrade:(e,t)=>{if(0===t)try{e.createObjectStore(Af)}catch(Tk){console.warn(Tk)}}}).catch(e=>{throw Sf.create("idb-open",{originalErrorMessage:e.message})})),Nf}async function Pf(e,t){try{const n=(await Of()).transaction(Af,"readwrite"),i=n.objectStore(Af);await i.put(t,Rf(e)),await n.done}catch(Tk){if(Tk instanceof $d)Fh.warn(Tk.message);else{const t=Sf.create("idb-set",{originalErrorMessage:null===Tk||void 0===Tk?void 0:Tk.message});Fh.warn(t.message)}}}function Rf(e){return"".concat(e.name,"!").concat(e.options.appId)}class Lf{constructor(e){this.container=e,this._heartbeatsCache=null;const t=this.container.getProvider("app").getImmediate();this._storage=new Mf(t),this._heartbeatsCachePromise=this._storage.read().then(e=>(this._heartbeatsCache=e,e))}async triggerHeartbeat(){var e,t;try{const n=this.container.getProvider("platform-logger").getImmediate().getPlatformInfoString(),i=zf();if(null==(null===(e=this._heartbeatsCache)||void 0===e?void 0:e.heartbeats)&&(this._heartbeatsCache=await this._heartbeatsCachePromise,null==(null===(t=this._heartbeatsCache)||void 0===t?void 0:t.heartbeats)))return;if(this._heartbeatsCache.lastSentHeartbeatDate===i||this._heartbeatsCache.heartbeats.some(e=>e.date===i))return;return this._heartbeatsCache.heartbeats.push({date:i,agent:n}),this._heartbeatsCache.heartbeats=this._heartbeatsCache.heartbeats.filter(e=>{const t=new Date(e.date).valueOf();return Date.now()-t<=2592e6}),this._storage.overwrite(this._heartbeatsCache)}catch(Tk){Fh.warn(Tk)}}async getHeartbeatsHeader(){var e;try{if(null===this._heartbeatsCache&&await this._heartbeatsCachePromise,null==(null===(e=this._heartbeatsCache)||void 0===e?void 0:e.heartbeats)||0===this._heartbeatsCache.heartbeats.length)return"";const t=zf(),{heartbeatsToSend:n,unsentEntries:i}=function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1024;const n=[];let i=e.slice();for(const r of e){const e=n.find(e=>e.agent===r.agent);if(e){if(e.dates.push(r.date),Df(n)>t){e.dates.pop();break}}else if(n.push({agent:r.agent,dates:[r.date]}),Df(n)>t){n.pop();break}i=i.slice(1)}return{heartbeatsToSend:n,unsentEntries:i}}(this._heartbeatsCache.heartbeats),r=Fd(JSON.stringify({version:2,heartbeats:n}));return this._heartbeatsCache.lastSentHeartbeatDate=t,i.length>0?(this._heartbeatsCache.heartbeats=i,await this._storage.overwrite(this._heartbeatsCache)):(this._heartbeatsCache.heartbeats=[],this._storage.overwrite(this._heartbeatsCache)),r}catch(Tk){return Fh.warn(Tk),""}}}function zf(){return(new Date).toISOString().substring(0,10)}class Mf{constructor(e){this.app=e,this._canUseIndexedDBPromise=this.runIndexedDBEnvironmentCheck()}async runIndexedDBEnvironmentCheck(){return!!Jd()&&new Promise((e,t)=>{try{let n=!0;const i="validate-browser-context-for-indexeddb-analytics-module",r=self.indexedDB.open(i);r.onsuccess=()=>{r.result.close(),n||self.indexedDB.deleteDatabase(i),e(!0)},r.onupgradeneeded=()=>{n=!1},r.onerror=()=>{var e;t((null===(e=r.error)||void 0===e?void 0:e.message)||"")}}catch(n){t(n)}}).then(()=>!0).catch(()=>!1)}async read(){if(await this._canUseIndexedDBPromise){const e=await async function(e){try{const t=(await Of()).transaction(Af),n=await t.objectStore(Af).get(Rf(e));return await t.done,n}catch(Tk){if(Tk instanceof $d)Fh.warn(Tk.message);else{const t=Sf.create("idb-get",{originalErrorMessage:null===Tk||void 0===Tk?void 0:Tk.message});Fh.warn(t.message)}}}(this.app);return(null===e||void 0===e?void 0:e.heartbeats)?e:{heartbeats:[]}}return{heartbeats:[]}}async overwrite(e){var t;if(await this._canUseIndexedDBPromise){const n=await this.read();return Pf(this.app,{lastSentHeartbeatDate:null!==(t=e.lastSentHeartbeatDate)&&void 0!==t?t:n.lastSentHeartbeatDate,heartbeats:e.heartbeats})}}async add(e){var t;if(await this._canUseIndexedDBPromise){const n=await this.read();return Pf(this.app,{lastSentHeartbeatDate:null!==(t=e.lastSentHeartbeatDate)&&void 0!==t?t:n.lastSentHeartbeatDate,heartbeats:[...n.heartbeats,...e.heartbeats]})}}}function Df(e){return Fd(JSON.stringify({version:2,heartbeats:e})).length}var Bf;Bf="",wf(new uh("platform-logger",e=>new Dh(e),"PRIVATE")),wf(new uh("heartbeat",e=>new Lf(e),"PRIVATE")),If(Bh,Uh,Bf),If(Bh,Uh,"esm2017"),If("fire-js","");var Uf,Ff,jf="undefined"!==typeof globalThis?globalThis:"undefined"!==typeof window?window:"undefined"!==typeof n.g?n.g:"undefined"!==typeof self?self:{},Vf={};(function(){var e;function t(){this.blockSize=-1,this.blockSize=64,this.g=Array(4),this.B=Array(this.blockSize),this.o=this.h=0,this.s()}function n(e,t,n){n||(n=0);var i=Array(16);if("string"===typeof t)for(var r=0;16>r;++r)i[r]=t.charCodeAt(n++)|t.charCodeAt(n++)<<8|t.charCodeAt(n++)<<16|t.charCodeAt(n++)<<24;else for(r=0;16>r;++r)i[r]=t[n++]|t[n++]<<8|t[n++]<<16|t[n++]<<24;t=e.g[0],n=e.g[1],r=e.g[2];var o=e.g[3],a=t+(o^n&(r^o))+i[0]+3614090360&4294967295;a=(n=(r=(o=(t=(n=(r=(o=(t=(n=(r=(o=(t=(n=(r=(o=(t=(n=(r=(o=(t=(n=(r=(o=(t=(n=(r=(o=(t=(n=(r=(o=(t=(n=(r=(o=(t=(n=(r=(o=(t=(n=(r=(o=(t=(n=(r=(o=(t=(n=(r=(o=(t=(n=(r=(o=(t=(n=(r=(o=(t=n+(a<<7&4294967295|a>>>25))+((a=o+(r^t&(n^r))+i[1]+3905402710&4294967295)<<12&4294967295|a>>>20))+((a=r+(n^o&(t^n))+i[2]+606105819&4294967295)<<17&4294967295|a>>>15))+((a=n+(t^r&(o^t))+i[3]+3250441966&4294967295)<<22&4294967295|a>>>10))+((a=t+(o^n&(r^o))+i[4]+4118548399&4294967295)<<7&4294967295|a>>>25))+((a=o+(r^t&(n^r))+i[5]+1200080426&4294967295)<<12&4294967295|a>>>20))+((a=r+(n^o&(t^n))+i[6]+2821735955&4294967295)<<17&4294967295|a>>>15))+((a=n+(t^r&(o^t))+i[7]+4249261313&4294967295)<<22&4294967295|a>>>10))+((a=t+(o^n&(r^o))+i[8]+1770035416&4294967295)<<7&4294967295|a>>>25))+((a=o+(r^t&(n^r))+i[9]+2336552879&4294967295)<<12&4294967295|a>>>20))+((a=r+(n^o&(t^n))+i[10]+4294925233&4294967295)<<17&4294967295|a>>>15))+((a=n+(t^r&(o^t))+i[11]+2304563134&4294967295)<<22&4294967295|a>>>10))+((a=t+(o^n&(r^o))+i[12]+1804603682&4294967295)<<7&4294967295|a>>>25))+((a=o+(r^t&(n^r))+i[13]+4254626195&4294967295)<<12&4294967295|a>>>20))+((a=r+(n^o&(t^n))+i[14]+2792965006&4294967295)<<17&4294967295|a>>>15))+((a=n+(t^r&(o^t))+i[15]+1236535329&4294967295)<<22&4294967295|a>>>10))+((a=t+(r^o&(n^r))+i[1]+4129170786&4294967295)<<5&4294967295|a>>>27))+((a=o+(n^r&(t^n))+i[6]+3225465664&4294967295)<<9&4294967295|a>>>23))+((a=r+(t^n&(o^t))+i[11]+643717713&4294967295)<<14&4294967295|a>>>18))+((a=n+(o^t&(r^o))+i[0]+3921069994&4294967295)<<20&4294967295|a>>>12))+((a=t+(r^o&(n^r))+i[5]+3593408605&4294967295)<<5&4294967295|a>>>27))+((a=o+(n^r&(t^n))+i[10]+38016083&4294967295)<<9&4294967295|a>>>23))+((a=r+(t^n&(o^t))+i[15]+3634488961&4294967295)<<14&4294967295|a>>>18))+((a=n+(o^t&(r^o))+i[4]+3889429448&4294967295)<<20&4294967295|a>>>12))+((a=t+(r^o&(n^r))+i[9]+568446438&4294967295)<<5&4294967295|a>>>27))+((a=o+(n^r&(t^n))+i[14]+3275163606&4294967295)<<9&4294967295|a>>>23))+((a=r+(t^n&(o^t))+i[3]+4107603335&4294967295)<<14&4294967295|a>>>18))+((a=n+(o^t&(r^o))+i[8]+1163531501&4294967295)<<20&4294967295|a>>>12))+((a=t+(r^o&(n^r))+i[13]+2850285829&4294967295)<<5&4294967295|a>>>27))+((a=o+(n^r&(t^n))+i[2]+4243563512&4294967295)<<9&4294967295|a>>>23))+((a=r+(t^n&(o^t))+i[7]+1735328473&4294967295)<<14&4294967295|a>>>18))+((a=n+(o^t&(r^o))+i[12]+2368359562&4294967295)<<20&4294967295|a>>>12))+((a=t+(n^r^o)+i[5]+4294588738&4294967295)<<4&4294967295|a>>>28))+((a=o+(t^n^r)+i[8]+2272392833&4294967295)<<11&4294967295|a>>>21))+((a=r+(o^t^n)+i[11]+1839030562&4294967295)<<16&4294967295|a>>>16))+((a=n+(r^o^t)+i[14]+4259657740&4294967295)<<23&4294967295|a>>>9))+((a=t+(n^r^o)+i[1]+2763975236&4294967295)<<4&4294967295|a>>>28))+((a=o+(t^n^r)+i[4]+1272893353&4294967295)<<11&4294967295|a>>>21))+((a=r+(o^t^n)+i[7]+4139469664&4294967295)<<16&4294967295|a>>>16))+((a=n+(r^o^t)+i[10]+3200236656&4294967295)<<23&4294967295|a>>>9))+((a=t+(n^r^o)+i[13]+681279174&4294967295)<<4&4294967295|a>>>28))+((a=o+(t^n^r)+i[0]+3936430074&4294967295)<<11&4294967295|a>>>21))+((a=r+(o^t^n)+i[3]+3572445317&4294967295)<<16&4294967295|a>>>16))+((a=n+(r^o^t)+i[6]+76029189&4294967295)<<23&4294967295|a>>>9))+((a=t+(n^r^o)+i[9]+3654602809&4294967295)<<4&4294967295|a>>>28))+((a=o+(t^n^r)+i[12]+3873151461&4294967295)<<11&4294967295|a>>>21))+((a=r+(o^t^n)+i[15]+530742520&4294967295)<<16&4294967295|a>>>16))+((a=n+(r^o^t)+i[2]+3299628645&4294967295)<<23&4294967295|a>>>9))+((a=t+(r^(n|~o))+i[0]+4096336452&4294967295)<<6&4294967295|a>>>26))+((a=o+(n^(t|~r))+i[7]+1126891415&4294967295)<<10&4294967295|a>>>22))+((a=r+(t^(o|~n))+i[14]+2878612391&4294967295)<<15&4294967295|a>>>17))+((a=n+(o^(r|~t))+i[5]+4237533241&4294967295)<<21&4294967295|a>>>11))+((a=t+(r^(n|~o))+i[12]+1700485571&4294967295)<<6&4294967295|a>>>26))+((a=o+(n^(t|~r))+i[3]+2399980690&4294967295)<<10&4294967295|a>>>22))+((a=r+(t^(o|~n))+i[10]+4293915773&4294967295)<<15&4294967295|a>>>17))+((a=n+(o^(r|~t))+i[1]+2240044497&4294967295)<<21&4294967295|a>>>11))+((a=t+(r^(n|~o))+i[8]+1873313359&4294967295)<<6&4294967295|a>>>26))+((a=o+(n^(t|~r))+i[15]+4264355552&4294967295)<<10&4294967295|a>>>22))+((a=r+(t^(o|~n))+i[6]+2734768916&4294967295)<<15&4294967295|a>>>17))+((a=n+(o^(r|~t))+i[13]+1309151649&4294967295)<<21&4294967295|a>>>11))+((o=(t=n+((a=t+(r^(n|~o))+i[4]+4149444226&4294967295)<<6&4294967295|a>>>26))+((a=o+(n^(t|~r))+i[11]+3174756917&4294967295)<<10&4294967295|a>>>22))^((r=o+((a=r+(t^(o|~n))+i[2]+718787259&4294967295)<<15&4294967295|a>>>17))|~t))+i[9]+3951481745&4294967295,e.g[0]=e.g[0]+t&4294967295,e.g[1]=e.g[1]+(r+(a<<21&4294967295|a>>>11))&4294967295,e.g[2]=e.g[2]+r&4294967295,e.g[3]=e.g[3]+o&4294967295}function i(e,t){this.h=t;for(var n=[],i=!0,r=e.length-1;0<=r;r--){var o=0|e[r];i&&o==t||(n[r]=o,i=!1)}this.g=n}!function(e,t){function n(){}n.prototype=t.prototype,e.D=t.prototype,e.prototype=new n,e.prototype.constructor=e,e.C=function(e,n,i){for(var r=Array(arguments.length-2),o=2;o<arguments.length;o++)r[o-2]=arguments[o];return t.prototype[n].apply(e,r)}}(t,function(){this.blockSize=-1}),t.prototype.s=function(){this.g[0]=1732584193,this.g[1]=4023233417,this.g[2]=2562383102,this.g[3]=271733878,this.o=this.h=0},t.prototype.u=function(e,t){void 0===t&&(t=e.length);for(var i=t-this.blockSize,r=this.B,o=this.h,a=0;a<t;){if(0==o)for(;a<=i;)n(this,e,a),a+=this.blockSize;if("string"===typeof e){for(;a<t;)if(r[o++]=e.charCodeAt(a++),o==this.blockSize){n(this,r),o=0;break}}else for(;a<t;)if(r[o++]=e[a++],o==this.blockSize){n(this,r),o=0;break}}this.h=o,this.o+=t},t.prototype.v=function(){var e=Array((56>this.h?this.blockSize:2*this.blockSize)-this.h);e[0]=128;for(var t=1;t<e.length-8;++t)e[t]=0;var n=8*this.o;for(t=e.length-8;t<e.length;++t)e[t]=255&n,n/=256;for(this.u(e),e=Array(16),t=n=0;4>t;++t)for(var i=0;32>i;i+=8)e[n++]=this.g[t]>>>i&255;return e};var r={};function o(e){return-128<=e&&128>e?function(e,t){var n=r;return Object.prototype.hasOwnProperty.call(n,e)?n[e]:n[e]=t(e)}(e,function(e){return new i([0|e],0>e?-1:0)}):new i([0|e],0>e?-1:0)}function a(e){if(isNaN(e)||!isFinite(e))return s;if(0>e)return h(a(-e));for(var t=[],n=1,r=0;e>=n;r++)t[r]=e/n|0,n*=4294967296;return new i(t,0)}var s=o(0),c=o(1),l=o(16777216);function u(e){if(0!=e.h)return!1;for(var t=0;t<e.g.length;t++)if(0!=e.g[t])return!1;return!0}function d(e){return-1==e.h}function h(e){for(var t=e.g.length,n=[],r=0;r<t;r++)n[r]=~e.g[r];return new i(n,~e.h).add(c)}function f(e,t){return e.add(h(t))}function p(e,t){for(;(65535&e[t])!=e[t];)e[t+1]+=e[t]>>>16,e[t]&=65535,t++}function m(e,t){this.g=e,this.h=t}function g(e,t){if(u(t))throw Error("division by zero");if(u(e))return new m(s,s);if(d(e))return t=g(h(e),t),new m(h(t.g),h(t.h));if(d(t))return t=g(e,h(t)),new m(h(t.g),t.h);if(30<e.g.length){if(d(e)||d(t))throw Error("slowDivide_ only works with positive integers.");for(var n=c,i=t;0>=i.l(e);)n=y(n),i=y(i);var r=v(n,1),o=v(i,1);for(i=v(i,2),n=v(n,2);!u(i);){var l=o.add(i);0>=l.l(e)&&(r=r.add(n),o=l),i=v(i,1),n=v(n,1)}return t=f(e,r.j(t)),new m(r,t)}for(r=s;0<=e.l(t);){for(n=Math.max(1,Math.floor(e.m()/t.m())),i=48>=(i=Math.ceil(Math.log(n)/Math.LN2))?1:Math.pow(2,i-48),l=(o=a(n)).j(t);d(l)||0<l.l(e);)l=(o=a(n-=i)).j(t);u(o)&&(o=c),r=r.add(o),e=f(e,l)}return new m(r,e)}function y(e){for(var t=e.g.length+1,n=[],r=0;r<t;r++)n[r]=e.i(r)<<1|e.i(r-1)>>>31;return new i(n,e.h)}function v(e,t){var n=t>>5;t%=32;for(var r=e.g.length-n,o=[],a=0;a<r;a++)o[a]=0<t?e.i(a+n)>>>t|e.i(a+n+1)<<32-t:e.i(a+n);return new i(o,e.h)}(e=i.prototype).m=function(){if(d(this))return-h(this).m();for(var e=0,t=1,n=0;n<this.g.length;n++){var i=this.i(n);e+=(0<=i?i:4294967296+i)*t,t*=4294967296}return e},e.toString=function(e){if(2>(e=e||10)||36<e)throw Error("radix out of range: "+e);if(u(this))return"0";if(d(this))return"-"+h(this).toString(e);for(var t=a(Math.pow(e,6)),n=this,i="";;){var r=g(n,t).g,o=((0<(n=f(n,r.j(t))).g.length?n.g[0]:n.h)>>>0).toString(e);if(u(n=r))return o+i;for(;6>o.length;)o="0"+o;i=o+i}},e.i=function(e){return 0>e?0:e<this.g.length?this.g[e]:this.h},e.l=function(e){return d(e=f(this,e))?-1:u(e)?0:1},e.abs=function(){return d(this)?h(this):this},e.add=function(e){for(var t=Math.max(this.g.length,e.g.length),n=[],r=0,o=0;o<=t;o++){var a=r+(65535&this.i(o))+(65535&e.i(o)),s=(a>>>16)+(this.i(o)>>>16)+(e.i(o)>>>16);r=s>>>16,a&=65535,s&=65535,n[o]=s<<16|a}return new i(n,-2147483648&n[n.length-1]?-1:0)},e.j=function(e){if(u(this)||u(e))return s;if(d(this))return d(e)?h(this).j(h(e)):h(h(this).j(e));if(d(e))return h(this.j(h(e)));if(0>this.l(l)&&0>e.l(l))return a(this.m()*e.m());for(var t=this.g.length+e.g.length,n=[],r=0;r<2*t;r++)n[r]=0;for(r=0;r<this.g.length;r++)for(var o=0;o<e.g.length;o++){var c=this.i(r)>>>16,f=65535&this.i(r),m=e.i(o)>>>16,g=65535&e.i(o);n[2*r+2*o]+=f*g,p(n,2*r+2*o),n[2*r+2*o+1]+=c*g,p(n,2*r+2*o+1),n[2*r+2*o+1]+=f*m,p(n,2*r+2*o+1),n[2*r+2*o+2]+=c*m,p(n,2*r+2*o+2)}for(r=0;r<t;r++)n[r]=n[2*r+1]<<16|n[2*r];for(r=t;r<2*t;r++)n[r]=0;return new i(n,0)},e.A=function(e){return g(this,e).h},e.and=function(e){for(var t=Math.max(this.g.length,e.g.length),n=[],r=0;r<t;r++)n[r]=this.i(r)&e.i(r);return new i(n,this.h&e.h)},e.or=function(e){for(var t=Math.max(this.g.length,e.g.length),n=[],r=0;r<t;r++)n[r]=this.i(r)|e.i(r);return new i(n,this.h|e.h)},e.xor=function(e){for(var t=Math.max(this.g.length,e.g.length),n=[],r=0;r<t;r++)n[r]=this.i(r)^e.i(r);return new i(n,this.h^e.h)},t.prototype.digest=t.prototype.v,t.prototype.reset=t.prototype.s,t.prototype.update=t.prototype.u,Ff=Vf.Md5=t,i.prototype.add=i.prototype.add,i.prototype.multiply=i.prototype.j,i.prototype.modulo=i.prototype.A,i.prototype.compare=i.prototype.l,i.prototype.toNumber=i.prototype.m,i.prototype.toString=i.prototype.toString,i.prototype.getBits=i.prototype.i,i.fromNumber=a,i.fromString=function e(t,n){if(0==t.length)throw Error("number format error: empty string");if(2>(n=n||10)||36<n)throw Error("radix out of range: "+n);if("-"==t.charAt(0))return h(e(t.substring(1),n));if(0<=t.indexOf("-"))throw Error('number format error: interior "-" character');for(var i=a(Math.pow(n,8)),r=s,o=0;o<t.length;o+=8){var c=Math.min(8,t.length-o),l=parseInt(t.substring(o,o+c),n);8>c?(c=a(Math.pow(n,c)),r=r.j(c).add(a(l))):r=(r=r.j(i)).add(a(l))}return r},Uf=Vf.Integer=i}).apply("undefined"!==typeof jf?jf:"undefined"!==typeof self?self:"undefined"!==typeof window?window:{});var qf,Hf,Wf,Gf,Kf,Zf,Qf,Xf,Yf="undefined"!==typeof globalThis?globalThis:"undefined"!==typeof window?window:"undefined"!==typeof n.g?n.g:"undefined"!==typeof self?self:{},Jf={};(function(){var e,t="function"==typeof Object.defineProperties?Object.defineProperty:function(e,t,n){return e==Array.prototype||e==Object.prototype||(e[t]=n.value),e};var n=function(e){e=["object"==typeof globalThis&&globalThis,e,"object"==typeof window&&window,"object"==typeof self&&self,"object"==typeof Yf&&Yf];for(var t=0;t<e.length;++t){var n=e[t];if(n&&n.Math==Math)return n}throw Error("Cannot find global object")}(this);!function(e,i){if(i)e:{var r=n;e=e.split(".");for(var o=0;o<e.length-1;o++){var a=e[o];if(!(a in r))break e;r=r[a]}(i=i(o=r[e=e[e.length-1]]))!=o&&null!=i&&t(r,e,{configurable:!0,writable:!0,value:i})}}("Array.prototype.values",function(e){return e||function(){return function(e,t){e instanceof String&&(e+="");var n=0,i=!1,r={next:function(){if(!i&&n<e.length){var r=n++;return{value:t(r,e[r]),done:!1}}return i=!0,{done:!0,value:void 0}}};return r[Symbol.iterator]=function(){return r},r}(this,function(e,t){return t})}});var i=i||{},r=this||self;function o(e){var t=typeof e;return"array"==(t="object"!=t?t:e?Array.isArray(e)?"array":t:"null")||"object"==t&&"number"==typeof e.length}function a(e){var t=typeof e;return"object"==t&&null!=e||"function"==t}function s(e,t,n){return e.call.apply(e.bind,arguments)}function c(e,t,n){if(!e)throw Error();if(2<arguments.length){var i=Array.prototype.slice.call(arguments,2);return function(){var n=Array.prototype.slice.call(arguments);return Array.prototype.unshift.apply(n,i),e.apply(t,n)}}return function(){return e.apply(t,arguments)}}function l(e,t,n){return(l=Function.prototype.bind&&-1!=Function.prototype.bind.toString().indexOf("native code")?s:c).apply(null,arguments)}function u(e,t){var n=Array.prototype.slice.call(arguments,1);return function(){var t=n.slice();return t.push.apply(t,arguments),e.apply(this,t)}}function d(e,t){function n(){}n.prototype=t.prototype,e.aa=t.prototype,e.prototype=new n,e.prototype.constructor=e,e.Qb=function(e,n,i){for(var r=Array(arguments.length-2),o=2;o<arguments.length;o++)r[o-2]=arguments[o];return t.prototype[n].apply(e,r)}}function h(e){const t=e.length;if(0<t){const n=Array(t);for(let i=0;i<t;i++)n[i]=e[i];return n}return[]}function f(e,t){for(let n=1;n<arguments.length;n++){const t=arguments[n];if(o(t)){const n=e.length||0,i=t.length||0;e.length=n+i;for(let r=0;r<i;r++)e[n+r]=t[r]}else e.push(t)}}function p(e){return/^[\s\xa0]*$/.test(e)}function m(){var e=r.navigator;return e&&(e=e.userAgent)?e:""}function g(e){return g[" "](e),e}g[" "]=function(){};var y=-1!=m().indexOf("Gecko")&&!(-1!=m().toLowerCase().indexOf("webkit")&&-1==m().indexOf("Edge"))&&!(-1!=m().indexOf("Trident")||-1!=m().indexOf("MSIE"))&&-1==m().indexOf("Edge");function v(e,t,n){for(const i in e)t.call(n,e[i],i,e)}function _(e){const t={};for(const n in e)t[n]=e[n];return t}const w="constructor hasOwnProperty isPrototypeOf propertyIsEnumerable toLocaleString toString valueOf".split(" ");function b(e,t){let n,i;for(let r=1;r<arguments.length;r++){for(n in i=arguments[r],i)e[n]=i[n];for(let t=0;t<w.length;t++)n=w[t],Object.prototype.hasOwnProperty.call(i,n)&&(e[n]=i[n])}}function x(e){var t=1;e=e.split(":");const n=[];for(;0<t&&e.length;)n.push(e.shift()),t--;return e.length&&n.push(e.join(":")),n}function S(e){r.setTimeout(()=>{throw e},0)}function E(){var e=A;let t=null;return e.g&&(t=e.g,e.g=e.g.next,e.g||(e.h=null),t.next=null),t}var T=new class{constructor(e,t){this.i=e,this.j=t,this.h=0,this.g=null}get(){let e;return 0<this.h?(this.h--,e=this.g,this.g=e.next,e.next=null):e=this.i(),e}}(()=>new k,e=>e.reset());class k{constructor(){this.next=this.g=this.h=null}set(e,t){this.h=e,this.g=t,this.next=null}reset(){this.next=this.g=this.h=null}}let C,I=!1,A=new class{constructor(){this.h=this.g=null}add(e,t){const n=T.get();n.set(e,t),this.h?this.h.next=n:this.g=n,this.h=n}},N=()=>{const e=r.Promise.resolve(void 0);C=()=>{e.then(O)}};var O=()=>{for(var e;e=E();){try{e.h.call(e.g)}catch($k){S($k)}var t=T;t.j(e),100>t.h&&(t.h++,e.next=t.g,t.g=e)}I=!1};function P(){this.s=this.s,this.C=this.C}function R(e,t){this.type=e,this.g=this.target=t,this.defaultPrevented=!1}P.prototype.s=!1,P.prototype.ma=function(){this.s||(this.s=!0,this.N())},P.prototype.N=function(){if(this.C)for(;this.C.length;)this.C.shift()()},R.prototype.h=function(){this.defaultPrevented=!0};var L=function(){if(!r.addEventListener||!Object.defineProperty)return!1;var e=!1,t=Object.defineProperty({},"passive",{get:function(){e=!0}});try{const e=()=>{};r.addEventListener("test",e,t),r.removeEventListener("test",e,t)}catch($k){}return e}();function z(e,t){if(R.call(this,e?e.type:""),this.relatedTarget=this.g=this.target=null,this.button=this.screenY=this.screenX=this.clientY=this.clientX=0,this.key="",this.metaKey=this.shiftKey=this.altKey=this.ctrlKey=!1,this.state=null,this.pointerId=0,this.pointerType="",this.i=null,e){var n=this.type=e.type,i=e.changedTouches&&e.changedTouches.length?e.changedTouches[0]:null;if(this.target=e.target||e.srcElement,this.g=t,t=e.relatedTarget){if(y){e:{try{g(t.nodeName);var r=!0;break e}catch(Lk){}r=!1}r||(t=null)}}else"mouseover"==n?t=e.fromElement:"mouseout"==n&&(t=e.toElement);this.relatedTarget=t,i?(this.clientX=void 0!==i.clientX?i.clientX:i.pageX,this.clientY=void 0!==i.clientY?i.clientY:i.pageY,this.screenX=i.screenX||0,this.screenY=i.screenY||0):(this.clientX=void 0!==e.clientX?e.clientX:e.pageX,this.clientY=void 0!==e.clientY?e.clientY:e.pageY,this.screenX=e.screenX||0,this.screenY=e.screenY||0),this.button=e.button,this.key=e.key||"",this.ctrlKey=e.ctrlKey,this.altKey=e.altKey,this.shiftKey=e.shiftKey,this.metaKey=e.metaKey,this.pointerId=e.pointerId||0,this.pointerType="string"===typeof e.pointerType?e.pointerType:M[e.pointerType]||"",this.state=e.state,this.i=e,e.defaultPrevented&&z.aa.h.call(this)}}d(z,R);var M={2:"touch",3:"pen",4:"mouse"};z.prototype.h=function(){z.aa.h.call(this);var e=this.i;e.preventDefault?e.preventDefault():e.returnValue=!1};var D="closure_listenable_"+(1e6*Math.random()|0),B=0;function U(e,t,n,i,r){this.listener=e,this.proxy=null,this.src=t,this.type=n,this.capture=!!i,this.ha=r,this.key=++B,this.da=this.fa=!1}function F(e){e.da=!0,e.listener=null,e.proxy=null,e.src=null,e.ha=null}function j(e){this.src=e,this.g={},this.h=0}function V(e,t){var n=t.type;if(n in e.g){var i,r=e.g[n],o=Array.prototype.indexOf.call(r,t,void 0);(i=0<=o)&&Array.prototype.splice.call(r,o,1),i&&(F(t),0==e.g[n].length&&(delete e.g[n],e.h--))}}function q(e,t,n,i){for(var r=0;r<e.length;++r){var o=e[r];if(!o.da&&o.listener==t&&o.capture==!!n&&o.ha==i)return r}return-1}j.prototype.add=function(e,t,n,i,r){var o=e.toString();(e=this.g[o])||(e=this.g[o]=[],this.h++);var a=q(e,t,i,r);return-1<a?(t=e[a],n||(t.fa=!1)):((t=new U(t,this.src,o,!!i,r)).fa=n,e.push(t)),t};var H="closure_lm_"+(1e6*Math.random()|0),W={};function G(e,t,n,i,r){if(i&&i.once)return Z(e,t,n,i,r);if(Array.isArray(t)){for(var o=0;o<t.length;o++)G(e,t[o],n,i,r);return null}return n=te(n),e&&e[D]?e.K(t,n,a(i)?!!i.capture:!!i,r):K(e,t,n,!1,i,r)}function K(e,t,n,i,r,o){if(!t)throw Error("Invalid event type");var s=a(r)?!!r.capture:!!r,c=$(e);if(c||(e[H]=c=new j(e)),(n=c.add(t,n,i,s,o)).proxy)return n;if(i=function(){function e(n){return t.call(e.src,e.listener,n)}const t=J;return e}(),n.proxy=i,i.src=e,i.listener=n,e.addEventListener)L||(r=s),void 0===r&&(r=!1),e.addEventListener(t.toString(),i,r);else if(e.attachEvent)e.attachEvent(Y(t.toString()),i);else{if(!e.addListener||!e.removeListener)throw Error("addEventListener and attachEvent are unavailable.");e.addListener(i)}return n}function Z(e,t,n,i,r){if(Array.isArray(t)){for(var o=0;o<t.length;o++)Z(e,t[o],n,i,r);return null}return n=te(n),e&&e[D]?e.L(t,n,a(i)?!!i.capture:!!i,r):K(e,t,n,!0,i,r)}function Q(e,t,n,i,r){if(Array.isArray(t))for(var o=0;o<t.length;o++)Q(e,t[o],n,i,r);else i=a(i)?!!i.capture:!!i,n=te(n),e&&e[D]?(e=e.i,(t=String(t).toString())in e.g&&(-1<(n=q(o=e.g[t],n,i,r))&&(F(o[n]),Array.prototype.splice.call(o,n,1),0==o.length&&(delete e.g[t],e.h--)))):e&&(e=$(e))&&(t=e.g[t.toString()],e=-1,t&&(e=q(t,n,i,r)),(n=-1<e?t[e]:null)&&X(n))}function X(e){if("number"!==typeof e&&e&&!e.da){var t=e.src;if(t&&t[D])V(t.i,e);else{var n=e.type,i=e.proxy;t.removeEventListener?t.removeEventListener(n,i,e.capture):t.detachEvent?t.detachEvent(Y(n),i):t.addListener&&t.removeListener&&t.removeListener(i),(n=$(t))?(V(n,e),0==n.h&&(n.src=null,t[H]=null)):F(e)}}}function Y(e){return e in W?W[e]:W[e]="on"+e}function J(e,t){if(e.da)e=!0;else{t=new z(t,this);var n=e.listener,i=e.ha||e.src;e.fa&&X(e),e=n.call(i,t)}return e}function $(e){return(e=e[H])instanceof j?e:null}var ee="__closure_events_fn_"+(1e9*Math.random()>>>0);function te(e){return"function"===typeof e?e:(e[ee]||(e[ee]=function(t){return e.handleEvent(t)}),e[ee])}function ne(){P.call(this),this.i=new j(this),this.M=this,this.F=null}function ie(e,t){var n,i=e.F;if(i)for(n=[];i;i=i.F)n.push(i);if(e=e.M,i=t.type||t,"string"===typeof t)t=new R(t,e);else if(t instanceof R)t.target=t.target||e;else{var r=t;b(t=new R(i,e),r)}if(r=!0,n)for(var o=n.length-1;0<=o;o--){var a=t.g=n[o];r=re(a,i,!0,t)&&r}if(r=re(a=t.g=e,i,!0,t)&&r,r=re(a,i,!1,t)&&r,n)for(o=0;o<n.length;o++)r=re(a=t.g=n[o],i,!1,t)&&r}function re(e,t,n,i){if(!(t=e.i.g[String(t)]))return!0;t=t.concat();for(var r=!0,o=0;o<t.length;++o){var a=t[o];if(a&&!a.da&&a.capture==n){var s=a.listener,c=a.ha||a.src;a.fa&&V(e.i,a),r=!1!==s.call(c,i)&&r}}return r&&!i.defaultPrevented}function oe(e,t,n){if("function"===typeof e)n&&(e=l(e,n));else{if(!e||"function"!=typeof e.handleEvent)throw Error("Invalid listener argument");e=l(e.handleEvent,e)}return 2147483647<Number(t)?-1:r.setTimeout(e,t||0)}function ae(e){e.g=oe(()=>{e.g=null,e.i&&(e.i=!1,ae(e))},e.l);const t=e.h;e.h=null,e.m.apply(null,t)}d(ne,P),ne.prototype[D]=!0,ne.prototype.removeEventListener=function(e,t,n,i){Q(this,e,t,n,i)},ne.prototype.N=function(){if(ne.aa.N.call(this),this.i){var e,t=this.i;for(e in t.g){for(var n=t.g[e],i=0;i<n.length;i++)F(n[i]);delete t.g[e],t.h--}}this.F=null},ne.prototype.K=function(e,t,n,i){return this.i.add(String(e),t,!1,n,i)},ne.prototype.L=function(e,t,n,i){return this.i.add(String(e),t,!0,n,i)};class se extends P{constructor(e,t){super(),this.m=e,this.l=t,this.h=null,this.i=!1,this.g=null}j(e){this.h=arguments,this.g?this.i=!0:ae(this)}N(){super.N(),this.g&&(r.clearTimeout(this.g),this.g=null,this.i=!1,this.h=null)}}function ce(e){P.call(this),this.h=e,this.g={}}d(ce,P);var le=[];function ue(e){v(e.g,function(e,t){this.g.hasOwnProperty(t)&&X(e)},e),e.g={}}ce.prototype.N=function(){ce.aa.N.call(this),ue(this)},ce.prototype.handleEvent=function(){throw Error("EventHandler.handleEvent not implemented")};var de=r.JSON.stringify,he=r.JSON.parse,fe=class{stringify(e){return r.JSON.stringify(e,void 0)}parse(e){return r.JSON.parse(e,void 0)}};function pe(){}function me(e){return e.h||(e.h=e.i())}function ge(){}pe.prototype.h=null;var ye={OPEN:"a",kb:"b",Ja:"c",wb:"d"};function ve(){R.call(this,"d")}function _e(){R.call(this,"c")}d(ve,R),d(_e,R);var we={},be=null;function xe(){return be=be||new ne}function Se(e){R.call(this,we.La,e)}function Ee(e){const t=xe();ie(t,new Se(t))}function Te(e,t){R.call(this,we.STAT_EVENT,e),this.stat=t}function ke(e){const t=xe();ie(t,new Te(t,e))}function Ce(e,t){R.call(this,we.Ma,e),this.size=t}function Ie(e,t){if("function"!==typeof e)throw Error("Fn must not be null and must be a function");return r.setTimeout(function(){e()},t)}function Ae(){this.g=!0}function Ne(e,t,n,i){e.info(function(){return"XMLHTTP TEXT ("+t+"): "+function(e,t){if(!e.g)return t;if(!t)return null;try{var n=JSON.parse(t);if(n)for(e=0;e<n.length;e++)if(Array.isArray(n[e])){var i=n[e];if(!(2>i.length)){var r=i[1];if(Array.isArray(r)&&!(1>r.length)){var o=r[0];if("noop"!=o&&"stop"!=o&&"close"!=o)for(var a=1;a<r.length;a++)r[a]=""}}}return de(n)}catch(s){return t}}(e,n)+(i?" "+i:"")})}we.La="serverreachability",d(Se,R),we.STAT_EVENT="statevent",d(Te,R),we.Ma="timingevent",d(Ce,R),Ae.prototype.xa=function(){this.g=!1},Ae.prototype.info=function(){};var Oe,Pe={NO_ERROR:0,gb:1,tb:2,sb:3,nb:4,rb:5,ub:6,Ia:7,TIMEOUT:8,xb:9},Re={lb:"complete",Hb:"success",Ja:"error",Ia:"abort",zb:"ready",Ab:"readystatechange",TIMEOUT:"timeout",vb:"incrementaldata",yb:"progress",ob:"downloadprogress",Pb:"uploadprogress"};function Le(){}function ze(e,t,n,i){this.j=e,this.i=t,this.l=n,this.R=i||1,this.U=new ce(this),this.I=45e3,this.H=null,this.o=!1,this.m=this.A=this.v=this.L=this.F=this.S=this.B=null,this.D=[],this.g=null,this.C=0,this.s=this.u=null,this.X=-1,this.J=!1,this.O=0,this.M=null,this.W=this.K=this.T=this.P=!1,this.h=new Me}function Me(){this.i=null,this.g="",this.h=!1}d(Le,pe),Le.prototype.g=function(){return new XMLHttpRequest},Le.prototype.i=function(){return{}},Oe=new Le;var De={},Be={};function Ue(e,t,n){e.L=1,e.v=dt(at(t)),e.m=n,e.P=!0,Fe(e,null)}function Fe(e,t){e.F=Date.now(),qe(e),e.A=at(e.v);var n=e.A,i=e.R;Array.isArray(i)||(i=[String(i)]),Et(n.i,"t",i),e.C=0,n=e.j.J,e.h=new Me,e.g=hn(e.j,n?t:null,!e.m),0<e.O&&(e.M=new se(l(e.Y,e,e.g),e.O)),t=e.U,n=e.g,i=e.ca;var r="readystatechange";Array.isArray(r)||(r&&(le[0]=r.toString()),r=le);for(var o=0;o<r.length;o++){var a=G(n,r[o],i||t.handleEvent,!1,t.h||t);if(!a)break;t.g[a.key]=a}t=e.H?_(e.H):{},e.m?(e.u||(e.u="POST"),t["Content-Type"]="application/x-www-form-urlencoded",e.g.ea(e.A,e.u,e.m,t)):(e.u="GET",e.g.ea(e.A,e.u,null,t)),Ee(),function(e,t,n,i,r,o){e.info(function(){if(e.g)if(o)for(var a="",s=o.split("&"),c=0;c<s.length;c++){var l=s[c].split("=");if(1<l.length){var u=l[0];l=l[1];var d=u.split("_");a=2<=d.length&&"type"==d[1]?a+(u+"=")+l+"&":a+(u+"=redacted&")}}else a=null;else a=o;return"XMLHTTP REQ ("+i+") [attempt "+r+"]: "+t+"\n"+n+"\n"+a})}(e.i,e.u,e.A,e.l,e.R,e.m)}function je(e){return!!e.g&&("GET"==e.u&&2!=e.L&&e.j.Ca)}function Ve(e,t){var n=e.C,i=t.indexOf("\n",n);return-1==i?Be:(n=Number(t.substring(n,i)),isNaN(n)?De:(i+=1)+n>t.length?Be:(t=t.slice(i,i+n),e.C=i+n,t))}function qe(e){e.S=Date.now()+e.I,He(e,e.I)}function He(e,t){if(null!=e.B)throw Error("WatchDog timer not null");e.B=Ie(l(e.ba,e),t)}function We(e){e.B&&(r.clearTimeout(e.B),e.B=null)}function Ge(e){0==e.j.G||e.J||sn(e.j,e)}function Ke(e){We(e);var t=e.M;t&&"function"==typeof t.ma&&t.ma(),e.M=null,ue(e.U),e.g&&(t=e.g,e.g=null,t.abort(),t.ma())}function Ze(e,t){try{var n=e.j;if(0!=n.G&&(n.g==e||$e(n.h,e)))if(!e.K&&$e(n.h,e)&&3==n.G){try{var i=n.Da.g.parse(t)}catch(u){i=null}if(Array.isArray(i)&&3==i.length){var r=i;if(0==r[0]){e:if(!n.u){if(n.g){if(!(n.g.F+3e3<e.F))break e;an(n),Qt(n)}nn(n),ke(18)}}else n.za=r[1],0<n.za-n.T&&37500>r[2]&&n.F&&0==n.v&&!n.C&&(n.C=Ie(l(n.Za,n),6e3));if(1>=Je(n.h)&&n.ca){try{n.ca()}catch(u){}n.ca=void 0}}else ln(n,11)}else if((e.K||n.g==e)&&an(n),!p(t))for(r=n.Da.g.parse(t),t=0;t<r.length;t++){let l=r[t];if(n.T=l[0],l=l[1],2==n.G)if("c"==l[0]){n.K=l[1],n.ia=l[2];const t=l[3];null!=t&&(n.la=t,n.j.info("VER="+n.la));const r=l[4];null!=r&&(n.Aa=r,n.j.info("SVER="+n.Aa));const u=l[5];null!=u&&"number"===typeof u&&0<u&&(i=1.5*u,n.L=i,n.j.info("backChannelRequestTimeoutMs_="+i)),i=n;const d=e.g;if(d){const e=d.g?d.g.getResponseHeader("X-Client-Wire-Protocol"):null;if(e){var o=i.h;o.g||-1==e.indexOf("spdy")&&-1==e.indexOf("quic")&&-1==e.indexOf("h2")||(o.j=o.l,o.g=new Set,o.h&&(et(o,o.h),o.h=null))}if(i.D){const e=d.g?d.g.getResponseHeader("X-HTTP-Session-Id"):null;e&&(i.ya=e,ut(i.I,i.D,e))}}n.G=3,n.l&&n.l.ua(),n.ba&&(n.R=Date.now()-e.F,n.j.info("Handshake RTT: "+n.R+"ms"));var a=e;if((i=n).qa=dn(i,i.J?i.ia:null,i.W),a.K){tt(i.h,a);var s=a,c=i.L;c&&(s.I=c),s.B&&(We(s),qe(s)),i.g=a}else tn(i);0<n.i.length&&Yt(n)}else"stop"!=l[0]&&"close"!=l[0]||ln(n,7);else 3==n.G&&("stop"==l[0]||"close"==l[0]?"stop"==l[0]?ln(n,7):Zt(n):"noop"!=l[0]&&n.l&&n.l.ta(l),n.v=0)}Ee()}catch(u){}}ze.prototype.ca=function(e){e=e.target;const t=this.M;t&&3==Ht(e)?t.j():this.Y(e)},ze.prototype.Y=function(e){try{if(e==this.g)e:{const h=Ht(this.g);var t=this.g.Ba();this.g.Z();if(!(3>h)&&(3!=h||this.g&&(this.h.h||this.g.oa()||Wt(this.g)))){this.J||4!=h||7==t||Ee(),We(this);var n=this.g.Z();this.X=n;t:if(je(this)){var i=Wt(this.g);e="";var o=i.length,a=4==Ht(this.g);if(!this.h.i){if("undefined"===typeof TextDecoder){Ke(this),Ge(this);var s="";break t}this.h.i=new r.TextDecoder}for(t=0;t<o;t++)this.h.h=!0,e+=this.h.i.decode(i[t],{stream:!(a&&t==o-1)});i.length=0,this.h.g+=e,this.C=0,s=this.h.g}else s=this.g.oa();if(this.o=200==n,function(e,t,n,i,r,o,a){e.info(function(){return"XMLHTTP RESP ("+i+") [ attempt "+r+"]: "+t+"\n"+n+"\n"+o+" "+a})}(this.i,this.u,this.A,this.l,this.R,h,n),this.o){if(this.T&&!this.K){t:{if(this.g){var c,l=this.g;if((c=l.g?l.g.getResponseHeader("X-HTTP-Initial-Response"):null)&&!p(c)){var u=c;break t}}u=null}if(!(n=u)){this.o=!1,this.s=3,ke(12),Ke(this),Ge(this);break e}Ne(this.i,this.l,n,"Initial handshake response via X-HTTP-Initial-Response"),this.K=!0,Ze(this,n)}if(this.P){let e;for(n=!0;!this.J&&this.C<s.length;){if(e=Ve(this,s),e==Be){4==h&&(this.s=4,ke(14),n=!1),Ne(this.i,this.l,null,"[Incomplete Response]");break}if(e==De){this.s=4,ke(15),Ne(this.i,this.l,s,"[Invalid Chunk]"),n=!1;break}Ne(this.i,this.l,e,null),Ze(this,e)}if(je(this)&&0!=this.C&&(this.h.g=this.h.g.slice(this.C),this.C=0),4!=h||0!=s.length||this.h.h||(this.s=1,ke(16),n=!1),this.o=this.o&&n,n){if(0<s.length&&!this.W){this.W=!0;var d=this.j;d.g==this&&d.ba&&!d.M&&(d.j.info("Great, no buffering proxy detected. Bytes received: "+s.length),rn(d),d.M=!0,ke(11))}}else Ne(this.i,this.l,s,"[Invalid Chunked Response]"),Ke(this),Ge(this)}else Ne(this.i,this.l,s,null),Ze(this,s);4==h&&Ke(this),this.o&&!this.J&&(4==h?sn(this.j,this):(this.o=!1,qe(this)))}else(function(e){const t={};e=(e.g&&2<=Ht(e)&&e.g.getAllResponseHeaders()||"").split("\r\n");for(let i=0;i<e.length;i++){if(p(e[i]))continue;var n=x(e[i]);const r=n[0];if("string"!==typeof(n=n[1]))continue;n=n.trim();const o=t[r]||[];t[r]=o,o.push(n)}!function(e,t){for(const n in e)t.call(void 0,e[n],n,e)}(t,function(e){return e.join(", ")})})(this.g),400==n&&0<s.indexOf("Unknown SID")?(this.s=3,ke(12)):(this.s=0,ke(13)),Ke(this),Ge(this)}}}catch($f){}},ze.prototype.cancel=function(){this.J=!0,Ke(this)},ze.prototype.ba=function(){this.B=null;const e=Date.now();0<=e-this.S?(function(e,t){e.info(function(){return"TIMEOUT: "+t})}(this.i,this.A),2!=this.L&&(Ee(),ke(17)),Ke(this),this.s=2,Ge(this)):He(this,this.S-e)};var Qe=class{constructor(e,t){this.g=e,this.map=t}};function Xe(e){this.l=e||10,r.PerformanceNavigationTiming?e=0<(e=r.performance.getEntriesByType("navigation")).length&&("hq"==e[0].nextHopProtocol||"h2"==e[0].nextHopProtocol):e=!!(r.chrome&&r.chrome.loadTimes&&r.chrome.loadTimes()&&r.chrome.loadTimes().wasFetchedViaSpdy),this.j=e?this.l:1,this.g=null,1<this.j&&(this.g=new Set),this.h=null,this.i=[]}function Ye(e){return!!e.h||!!e.g&&e.g.size>=e.j}function Je(e){return e.h?1:e.g?e.g.size:0}function $e(e,t){return e.h?e.h==t:!!e.g&&e.g.has(t)}function et(e,t){e.g?e.g.add(t):e.h=t}function tt(e,t){e.h&&e.h==t?e.h=null:e.g&&e.g.has(t)&&e.g.delete(t)}function nt(e){if(null!=e.h)return e.i.concat(e.h.D);if(null!=e.g&&0!==e.g.size){let t=e.i;for(const n of e.g.values())t=t.concat(n.D);return t}return h(e.i)}function it(e,t){if(e.forEach&&"function"==typeof e.forEach)e.forEach(t,void 0);else if(o(e)||"string"===typeof e)Array.prototype.forEach.call(e,t,void 0);else for(var n=function(e){if(e.na&&"function"==typeof e.na)return e.na();if(!e.V||"function"!=typeof e.V){if("undefined"!==typeof Map&&e instanceof Map)return Array.from(e.keys());if(!("undefined"!==typeof Set&&e instanceof Set)){if(o(e)||"string"===typeof e){var t=[];e=e.length;for(var n=0;n<e;n++)t.push(n);return t}t=[],n=0;for(const i in e)t[n++]=i;return t}}}(e),i=function(e){if(e.V&&"function"==typeof e.V)return e.V();if("undefined"!==typeof Map&&e instanceof Map||"undefined"!==typeof Set&&e instanceof Set)return Array.from(e.values());if("string"===typeof e)return e.split("");if(o(e)){for(var t=[],n=e.length,i=0;i<n;i++)t.push(e[i]);return t}for(i in t=[],n=0,e)t[n++]=e[i];return t}(e),r=i.length,a=0;a<r;a++)t.call(void 0,i[a],n&&n[a],e)}Xe.prototype.cancel=function(){if(this.i=nt(this),this.h)this.h.cancel(),this.h=null;else if(this.g&&0!==this.g.size){for(const e of this.g.values())e.cancel();this.g.clear()}};var rt=RegExp("^(?:([^:/?#.]+):)?(?://(?:([^\\\\/?#]*)@)?([^\\\\/?#]*?)(?::([0-9]+))?(?=[\\\\/?#]|$))?([^?#]+)?(?:\\?([^#]*))?(?:#([\\s\\S]*))?$");function ot(e){if(this.g=this.o=this.j="",this.s=null,this.m=this.l="",this.h=!1,e instanceof ot){this.h=e.h,st(this,e.j),this.o=e.o,this.g=e.g,ct(this,e.s),this.l=e.l;var t=e.i,n=new wt;n.i=t.i,t.g&&(n.g=new Map(t.g),n.h=t.h),lt(this,n),this.m=e.m}else e&&(t=String(e).match(rt))?(this.h=!1,st(this,t[1]||"",!0),this.o=ht(t[2]||""),this.g=ht(t[3]||"",!0),ct(this,t[4]),this.l=ht(t[5]||"",!0),lt(this,t[6]||"",!0),this.m=ht(t[7]||"")):(this.h=!1,this.i=new wt(null,this.h))}function at(e){return new ot(e)}function st(e,t,n){e.j=n?ht(t,!0):t,e.j&&(e.j=e.j.replace(/:$/,""))}function ct(e,t){if(t){if(t=Number(t),isNaN(t)||0>t)throw Error("Bad port number "+t);e.s=t}else e.s=null}function lt(e,t,n){t instanceof wt?(e.i=t,function(e,t){t&&!e.j&&(bt(e),e.i=null,e.g.forEach(function(e,t){var n=t.toLowerCase();t!=n&&(xt(this,t),Et(this,n,e))},e)),e.j=t}(e.i,e.h)):(n||(t=ft(t,vt)),e.i=new wt(t,e.h))}function ut(e,t,n){e.i.set(t,n)}function dt(e){return ut(e,"zx",Math.floor(2147483648*Math.random()).toString(36)+Math.abs(Math.floor(2147483648*Math.random())^Date.now()).toString(36)),e}function ht(e,t){return e?t?decodeURI(e.replace(/%25/g,"%2525")):decodeURIComponent(e):""}function ft(e,t,n){return"string"===typeof e?(e=encodeURI(e).replace(t,pt),n&&(e=e.replace(/%25([0-9a-fA-F]{2})/g,"%$1")),e):null}function pt(e){return"%"+((e=e.charCodeAt(0))>>4&15).toString(16)+(15&e).toString(16)}ot.prototype.toString=function(){var e=[],t=this.j;t&&e.push(ft(t,mt,!0),":");var n=this.g;return(n||"file"==t)&&(e.push("//"),(t=this.o)&&e.push(ft(t,mt,!0),"@"),e.push(encodeURIComponent(String(n)).replace(/%25([0-9a-fA-F]{2})/g,"%$1")),null!=(n=this.s)&&e.push(":",String(n))),(n=this.l)&&(this.g&&"/"!=n.charAt(0)&&e.push("/"),e.push(ft(n,"/"==n.charAt(0)?yt:gt,!0))),(n=this.i.toString())&&e.push("?",n),(n=this.m)&&e.push("#",ft(n,_t)),e.join("")};var mt=/[#\/\?@]/g,gt=/[#\?:]/g,yt=/[#\?]/g,vt=/[#\?@]/g,_t=/#/g;function wt(e,t){this.h=this.g=null,this.i=e||null,this.j=!!t}function bt(e){e.g||(e.g=new Map,e.h=0,e.i&&function(e,t){if(e){e=e.split("&");for(var n=0;n<e.length;n++){var i=e[n].indexOf("="),r=null;if(0<=i){var o=e[n].substring(0,i);r=e[n].substring(i+1)}else o=e[n];t(o,r?decodeURIComponent(r.replace(/\+/g," ")):"")}}}(e.i,function(t,n){e.add(decodeURIComponent(t.replace(/\+/g," ")),n)}))}function xt(e,t){bt(e),t=Tt(e,t),e.g.has(t)&&(e.i=null,e.h-=e.g.get(t).length,e.g.delete(t))}function St(e,t){return bt(e),t=Tt(e,t),e.g.has(t)}function Et(e,t,n){xt(e,t),0<n.length&&(e.i=null,e.g.set(Tt(e,t),h(n)),e.h+=n.length)}function Tt(e,t){return t=String(t),e.j&&(t=t.toLowerCase()),t}function kt(e,t,n,i,r){try{r&&(r.onload=null,r.onerror=null,r.onabort=null,r.ontimeout=null),i(n)}catch(Lk){}}function Ct(){this.g=new fe}function It(e,t,n){const i=n||"";try{it(e,function(e,n){let r=e;a(e)&&(r=de(e)),t.push(i+n+"="+encodeURIComponent(r))})}catch(Tk){throw t.push(i+"type="+encodeURIComponent("_badmap")),Tk}}function At(e){this.l=e.Ub||null,this.j=e.eb||!1}function Nt(e,t){ne.call(this),this.D=e,this.o=t,this.m=void 0,this.status=this.readyState=0,this.responseType=this.responseText=this.response=this.statusText="",this.onreadystatechange=null,this.u=new Headers,this.h=null,this.B="GET",this.A="",this.g=!1,this.v=this.j=this.l=null}function Ot(e){e.j.read().then(e.Pa.bind(e)).catch(e.ga.bind(e))}function Pt(e){e.readyState=4,e.l=null,e.j=null,e.v=null,Rt(e)}function Rt(e){e.onreadystatechange&&e.onreadystatechange.call(e)}function Lt(e){let t="";return v(e,function(e,n){t+=n,t+=":",t+=e,t+="\r\n"}),t}function zt(e,t,n){e:{for(i in n){var i=!1;break e}i=!0}i||(n=Lt(n),"string"===typeof e?null!=n&&encodeURIComponent(String(n)):ut(e,t,n))}function Mt(e){ne.call(this),this.headers=new Map,this.o=e||null,this.h=!1,this.v=this.g=null,this.D="",this.m=0,this.l="",this.j=this.B=this.u=this.A=!1,this.I=null,this.H="",this.J=!1}(e=wt.prototype).add=function(e,t){bt(this),this.i=null,e=Tt(this,e);var n=this.g.get(e);return n||this.g.set(e,n=[]),n.push(t),this.h+=1,this},e.forEach=function(e,t){bt(this),this.g.forEach(function(n,i){n.forEach(function(n){e.call(t,n,i,this)},this)},this)},e.na=function(){bt(this);const e=Array.from(this.g.values()),t=Array.from(this.g.keys()),n=[];for(let i=0;i<t.length;i++){const r=e[i];for(let e=0;e<r.length;e++)n.push(t[i])}return n},e.V=function(e){bt(this);let t=[];if("string"===typeof e)St(this,e)&&(t=t.concat(this.g.get(Tt(this,e))));else{e=Array.from(this.g.values());for(let n=0;n<e.length;n++)t=t.concat(e[n])}return t},e.set=function(e,t){return bt(this),this.i=null,St(this,e=Tt(this,e))&&(this.h-=this.g.get(e).length),this.g.set(e,[t]),this.h+=1,this},e.get=function(e,t){return e&&0<(e=this.V(e)).length?String(e[0]):t},e.toString=function(){if(this.i)return this.i;if(!this.g)return"";const e=[],t=Array.from(this.g.keys());for(var n=0;n<t.length;n++){var i=t[n];const o=encodeURIComponent(String(i)),a=this.V(i);for(i=0;i<a.length;i++){var r=o;""!==a[i]&&(r+="="+encodeURIComponent(String(a[i]))),e.push(r)}}return this.i=e.join("&")},d(At,pe),At.prototype.g=function(){return new Nt(this.l,this.j)},At.prototype.i=function(e){return function(){return e}}({}),d(Nt,ne),(e=Nt.prototype).open=function(e,t){if(0!=this.readyState)throw this.abort(),Error("Error reopening a connection");this.B=e,this.A=t,this.readyState=1,Rt(this)},e.send=function(e){if(1!=this.readyState)throw this.abort(),Error("need to call open() first. ");this.g=!0;const t={headers:this.u,method:this.B,credentials:this.m,cache:void 0};e&&(t.body=e),(this.D||r).fetch(new Request(this.A,t)).then(this.Sa.bind(this),this.ga.bind(this))},e.abort=function(){this.response=this.responseText="",this.u=new Headers,this.status=0,this.j&&this.j.cancel("Request was aborted.").catch(()=>{}),1<=this.readyState&&this.g&&4!=this.readyState&&(this.g=!1,Pt(this)),this.readyState=0},e.Sa=function(e){if(this.g&&(this.l=e,this.h||(this.status=this.l.status,this.statusText=this.l.statusText,this.h=e.headers,this.readyState=2,Rt(this)),this.g&&(this.readyState=3,Rt(this),this.g)))if("arraybuffer"===this.responseType)e.arrayBuffer().then(this.Qa.bind(this),this.ga.bind(this));else if("undefined"!==typeof r.ReadableStream&&"body"in e){if(this.j=e.body.getReader(),this.o){if(this.responseType)throw Error('responseType must be empty for "streamBinaryChunks" mode responses.');this.response=[]}else this.response=this.responseText="",this.v=new TextDecoder;Ot(this)}else e.text().then(this.Ra.bind(this),this.ga.bind(this))},e.Pa=function(e){if(this.g){if(this.o&&e.value)this.response.push(e.value);else if(!this.o){var t=e.value?e.value:new Uint8Array(0);(t=this.v.decode(t,{stream:!e.done}))&&(this.response=this.responseText+=t)}e.done?Pt(this):Rt(this),3==this.readyState&&Ot(this)}},e.Ra=function(e){this.g&&(this.response=this.responseText=e,Pt(this))},e.Qa=function(e){this.g&&(this.response=e,Pt(this))},e.ga=function(){this.g&&Pt(this)},e.setRequestHeader=function(e,t){this.u.append(e,t)},e.getResponseHeader=function(e){return this.h&&this.h.get(e.toLowerCase())||""},e.getAllResponseHeaders=function(){if(!this.h)return"";const e=[],t=this.h.entries();for(var n=t.next();!n.done;)n=n.value,e.push(n[0]+": "+n[1]),n=t.next();return e.join("\r\n")},Object.defineProperty(Nt.prototype,"withCredentials",{get:function(){return"include"===this.m},set:function(e){this.m=e?"include":"same-origin"}}),d(Mt,ne);var Dt=/^https?$/i,Bt=["POST","PUT"];function Ut(e,t){e.h=!1,e.g&&(e.j=!0,e.g.abort(),e.j=!1),e.l=t,e.m=5,Ft(e),Vt(e)}function Ft(e){e.A||(e.A=!0,ie(e,"complete"),ie(e,"error"))}function jt(e){if(e.h&&"undefined"!=typeof i&&(!e.v[1]||4!=Ht(e)||2!=e.Z()))if(e.u&&4==Ht(e))oe(e.Ea,0,e);else if(ie(e,"readystatechange"),4==Ht(e)){e.h=!1;try{const i=e.Z();e:switch(i){case 200:case 201:case 202:case 204:case 206:case 304:case 1223:var t=!0;break e;default:t=!1}var n;if(!(n=t)){var o;if(o=0===i){var a=String(e.D).match(rt)[1]||null;!a&&r.self&&r.self.location&&(a=r.self.location.protocol.slice(0,-1)),o=!Dt.test(a?a.toLowerCase():"")}n=o}if(n)ie(e,"complete"),ie(e,"success");else{e.m=6;try{var s=2<Ht(e)?e.g.statusText:""}catch(c){s=""}e.l=s+" ["+e.Z()+"]",Ft(e)}}finally{Vt(e)}}}function Vt(e,t){if(e.g){qt(e);const n=e.g,i=e.v[0]?()=>{}:null;e.g=null,e.v=null,t||ie(e,"ready");try{n.onreadystatechange=i}catch(Tk){}}}function qt(e){e.I&&(r.clearTimeout(e.I),e.I=null)}function Ht(e){return e.g?e.g.readyState:0}function Wt(e){try{if(!e.g)return null;if("response"in e.g)return e.g.response;switch(e.H){case"":case"text":return e.g.responseText;case"arraybuffer":if("mozResponseArrayBuffer"in e.g)return e.g.mozResponseArrayBuffer}return null}catch(np){return null}}function Gt(e,t,n){return n&&n.internalChannelParams&&n.internalChannelParams[e]||t}function Kt(e){this.Aa=0,this.i=[],this.j=new Ae,this.ia=this.qa=this.I=this.W=this.g=this.ya=this.D=this.H=this.m=this.S=this.o=null,this.Ya=this.U=0,this.Va=Gt("failFast",!1,e),this.F=this.C=this.u=this.s=this.l=null,this.X=!0,this.za=this.T=-1,this.Y=this.v=this.B=0,this.Ta=Gt("baseRetryDelayMs",5e3,e),this.cb=Gt("retryDelaySeedMs",1e4,e),this.Wa=Gt("forwardChannelMaxRetries",2,e),this.wa=Gt("forwardChannelRequestTimeoutMs",2e4,e),this.pa=e&&e.xmlHttpFactory||void 0,this.Xa=e&&e.Tb||void 0,this.Ca=e&&e.useFetchStreams||!1,this.L=void 0,this.J=e&&e.supportsCrossDomainXhr||!1,this.K="",this.h=new Xe(e&&e.concurrentRequestLimit),this.Da=new Ct,this.P=e&&e.fastHandshake||!1,this.O=e&&e.encodeInitMessageHeaders||!1,this.P&&this.O&&(this.O=!1),this.Ua=e&&e.Rb||!1,e&&e.xa&&this.j.xa(),e&&e.forceLongPolling&&(this.X=!1),this.ba=!this.P&&this.X&&e&&e.detectBufferingProxy||!1,this.ja=void 0,e&&e.longPollingTimeout&&0<e.longPollingTimeout&&(this.ja=e.longPollingTimeout),this.ca=void 0,this.R=0,this.M=!1,this.ka=this.A=null}function Zt(e){if(Xt(e),3==e.G){var t=e.U++,n=at(e.I);if(ut(n,"SID",e.K),ut(n,"RID",t),ut(n,"TYPE","terminate"),$t(e,n),(t=new ze(e,e.j,t)).L=2,t.v=dt(at(n)),n=!1,r.navigator&&r.navigator.sendBeacon)try{n=r.navigator.sendBeacon(t.v.toString(),"")}catch(i){}!n&&r.Image&&((new Image).src=t.v,n=!0),n||(t.g=hn(t.j,null),t.g.ea(t.v)),t.F=Date.now(),qe(t)}un(e)}function Qt(e){e.g&&(rn(e),e.g.cancel(),e.g=null)}function Xt(e){Qt(e),e.u&&(r.clearTimeout(e.u),e.u=null),an(e),e.h.cancel(),e.s&&("number"===typeof e.s&&r.clearTimeout(e.s),e.s=null)}function Yt(e){if(!Ye(e.h)&&!e.s){e.s=!0;var t=e.Ga;C||N(),I||(C(),I=!0),A.add(t,e),e.B=0}}function Jt(e,t){var n;n=t?t.l:e.U++;const i=at(e.I);ut(i,"SID",e.K),ut(i,"RID",n),ut(i,"AID",e.T),$t(e,i),e.m&&e.o&&zt(i,e.m,e.o),n=new ze(e,e.j,n,e.B+1),null===e.m&&(n.H=e.o),t&&(e.i=t.D.concat(e.i)),t=en(e,n,1e3),n.I=Math.round(.5*e.wa)+Math.round(.5*e.wa*Math.random()),et(e.h,n),Ue(n,i,t)}function $t(e,t){e.H&&v(e.H,function(e,n){ut(t,n,e)}),e.l&&it({},function(e,n){ut(t,n,e)})}function en(e,t,n){n=Math.min(e.i.length,n);var i=e.l?l(e.l.Na,e.l,e):null;e:{var r=e.i;let t=-1;for(;;){const e=["count="+n];-1==t?0<n?(t=r[0].g,e.push("ofs="+t)):t=0:e.push("ofs="+t);let o=!0;for(let a=0;a<n;a++){let n=r[a].g;const s=r[a].map;if(n-=t,0>n)t=Math.max(0,r[a].g-100),o=!1;else try{It(s,e,"req"+n+"_")}catch($f){i&&i(s)}}if(o){i=e.join("&");break e}}}return e=e.i.splice(0,n),t.D=e,i}function tn(e){if(!e.g&&!e.u){e.Y=1;var t=e.Fa;C||N(),I||(C(),I=!0),A.add(t,e),e.v=0}}function nn(e){return!(e.g||e.u||3<=e.v)&&(e.Y++,e.u=Ie(l(e.Fa,e),cn(e,e.v)),e.v++,!0)}function rn(e){null!=e.A&&(r.clearTimeout(e.A),e.A=null)}function on(e){e.g=new ze(e,e.j,"rpc",e.Y),null===e.m&&(e.g.H=e.o),e.g.O=0;var t=at(e.qa);ut(t,"RID","rpc"),ut(t,"SID",e.K),ut(t,"AID",e.T),ut(t,"CI",e.F?"0":"1"),!e.F&&e.ja&&ut(t,"TO",e.ja),ut(t,"TYPE","xmlhttp"),$t(e,t),e.m&&e.o&&zt(t,e.m,e.o),e.L&&(e.g.I=e.L);var n=e.g;e=e.ia,n.L=1,n.v=dt(at(t)),n.m=null,n.P=!0,Fe(n,e)}function an(e){null!=e.C&&(r.clearTimeout(e.C),e.C=null)}function sn(e,t){var n=null;if(e.g==t){an(e),rn(e),e.g=null;var i=2}else{if(!$e(e.h,t))return;n=t.D,tt(e.h,t),i=1}if(0!=e.G)if(t.o)if(1==i){n=t.m?t.m.length:0,t=Date.now()-t.F;var r=e.B;ie(i=xe(),new Ce(i,n)),Yt(e)}else tn(e);else if(3==(r=t.s)||0==r&&0<t.X||!(1==i&&function(e,t){return!(Je(e.h)>=e.h.j-(e.s?1:0))&&(e.s?(e.i=t.D.concat(e.i),!0):!(1==e.G||2==e.G||e.B>=(e.Va?0:e.Wa))&&(e.s=Ie(l(e.Ga,e,t),cn(e,e.B)),e.B++,!0))}(e,t)||2==i&&nn(e)))switch(n&&0<n.length&&(t=e.h,t.i=t.i.concat(n)),r){case 1:ln(e,5);break;case 4:ln(e,10);break;case 3:ln(e,6);break;default:ln(e,2)}}function cn(e,t){let n=e.Ta+Math.floor(Math.random()*e.cb);return e.isActive()||(n*=2),n*t}function ln(e,t){if(e.j.info("Error code "+t),2==t){var n=l(e.fb,e),i=e.Xa;const t=!i;i=new ot(i||"//www.google.com/images/cleardot.gif"),r.location&&"http"==r.location.protocol||st(i,"https"),dt(i),t?function(e,t){const n=new Ae;if(r.Image){const i=new Image;i.onload=u(kt,n,"TestLoadImage: loaded",!0,t,i),i.onerror=u(kt,n,"TestLoadImage: error",!1,t,i),i.onabort=u(kt,n,"TestLoadImage: abort",!1,t,i),i.ontimeout=u(kt,n,"TestLoadImage: timeout",!1,t,i),r.setTimeout(function(){i.ontimeout&&i.ontimeout()},1e4),i.src=e}else t(!1)}(i.toString(),n):function(e,t){new Ae;const n=new AbortController,i=setTimeout(()=>{n.abort(),kt(0,0,!1,t)},1e4);fetch(e,{signal:n.signal}).then(e=>{clearTimeout(i),e.ok?kt(0,0,!0,t):kt(0,0,!1,t)}).catch(()=>{clearTimeout(i),kt(0,0,!1,t)})}(i.toString(),n)}else ke(2);e.G=0,e.l&&e.l.sa(t),un(e),Xt(e)}function un(e){if(e.G=0,e.ka=[],e.l){const t=nt(e.h);0==t.length&&0==e.i.length||(f(e.ka,t),f(e.ka,e.i),e.h.i.length=0,h(e.i),e.i.length=0),e.l.ra()}}function dn(e,t,n){var i=n instanceof ot?at(n):new ot(n);if(""!=i.g)t&&(i.g=t+"."+i.g),ct(i,i.s);else{var o=r.location;i=o.protocol,t=t?t+"."+o.hostname:o.hostname,o=+o.port;var a=new ot(null);i&&st(a,i),t&&(a.g=t),o&&ct(a,o),n&&(a.l=n),i=a}return n=e.D,t=e.ya,n&&t&&ut(i,n,t),ut(i,"VER",e.la),$t(e,i),i}function hn(e,t,n){if(t&&!e.J)throw Error("Can't create secondary domain capable XhrIo object.");return(t=e.Ca&&!e.pa?new Mt(new At({eb:n})):new Mt(e.pa)).Ha(e.J),t}function fn(){}function pn(){}function mn(e,t){ne.call(this),this.g=new Kt(t),this.l=e,this.h=t&&t.messageUrlParams||null,e=t&&t.messageHeaders||null,t&&t.clientProtocolHeaderRequired&&(e?e["X-Client-Protocol"]="webchannel":e={"X-Client-Protocol":"webchannel"}),this.g.o=e,e=t&&t.initMessageHeaders||null,t&&t.messageContentType&&(e?e["X-WebChannel-Content-Type"]=t.messageContentType:e={"X-WebChannel-Content-Type":t.messageContentType}),t&&t.va&&(e?e["X-WebChannel-Client-Profile"]=t.va:e={"X-WebChannel-Client-Profile":t.va}),this.g.S=e,(e=t&&t.Sb)&&!p(e)&&(this.g.m=e),this.v=t&&t.supportsCrossDomainXhr||!1,this.u=t&&t.sendRawJson||!1,(t=t&&t.httpSessionIdParam)&&!p(t)&&(this.g.D=t,null!==(e=this.h)&&t in e&&(t in(e=this.h)&&delete e[t])),this.j=new vn(this)}function gn(e){ve.call(this),e.__headers__&&(this.headers=e.__headers__,this.statusCode=e.__status__,delete e.__headers__,delete e.__status__);var t=e.__sm__;if(t){e:{for(const n in t){e=n;break e}e=void 0}(this.i=e)&&(e=this.i,t=null!==t&&e in t?t[e]:void 0),this.data=t}else this.data=e}function yn(){_e.call(this),this.status=1}function vn(e){this.g=e}(e=Mt.prototype).Ha=function(e){this.J=e},e.ea=function(e,t,n,i){if(this.g)throw Error("[goog.net.XhrIo] Object is active with another request="+this.D+"; newUri="+e);t=t?t.toUpperCase():"GET",this.D=e,this.l="",this.m=0,this.A=!1,this.h=!0,this.g=this.o?this.o.g():Oe.g(),this.v=this.o?me(this.o):me(Oe),this.g.onreadystatechange=l(this.Ea,this);try{this.B=!0,this.g.open(t,String(e),!0),this.B=!1}catch(Lk){return void Ut(this,Lk)}if(e=n||"",n=new Map(this.headers),i)if(Object.getPrototypeOf(i)===Object.prototype)for(var o in i)n.set(o,i[o]);else{if("function"!==typeof i.keys||"function"!==typeof i.get)throw Error("Unknown input type for opt_headers: "+String(i));for(const e of i.keys())n.set(e,i.get(e))}i=Array.from(n.keys()).find(e=>"content-type"==e.toLowerCase()),o=r.FormData&&e instanceof r.FormData,!(0<=Array.prototype.indexOf.call(Bt,t,void 0))||i||o||n.set("Content-Type","application/x-www-form-urlencoded;charset=utf-8");for(const[r,a]of n)this.g.setRequestHeader(r,a);this.H&&(this.g.responseType=this.H),"withCredentials"in this.g&&this.g.withCredentials!==this.J&&(this.g.withCredentials=this.J);try{qt(this),this.u=!0,this.g.send(e),this.u=!1}catch(Lk){Ut(this,Lk)}},e.abort=function(e){this.g&&this.h&&(this.h=!1,this.j=!0,this.g.abort(),this.j=!1,this.m=e||7,ie(this,"complete"),ie(this,"abort"),Vt(this))},e.N=function(){this.g&&(this.h&&(this.h=!1,this.j=!0,this.g.abort(),this.j=!1),Vt(this,!0)),Mt.aa.N.call(this)},e.Ea=function(){this.s||(this.B||this.u||this.j?jt(this):this.bb())},e.bb=function(){jt(this)},e.isActive=function(){return!!this.g},e.Z=function(){try{return 2<Ht(this)?this.g.status:-1}catch(Pk){return-1}},e.oa=function(){try{return this.g?this.g.responseText:""}catch(Pk){return""}},e.Oa=function(e){if(this.g){var t=this.g.responseText;return e&&0==t.indexOf(e)&&(t=t.substring(e.length)),he(t)}},e.Ba=function(){return this.m},e.Ka=function(){return"string"===typeof this.l?this.l:String(this.l)},(e=Kt.prototype).la=8,e.G=1,e.connect=function(e,t,n,i){ke(0),this.W=e,this.H=t||{},n&&void 0!==i&&(this.H.OSID=n,this.H.OAID=i),this.F=this.X,this.I=dn(this,null,this.W),Yt(this)},e.Ga=function(e){if(this.s)if(this.s=null,1==this.G){if(!e){this.U=Math.floor(1e5*Math.random()),e=this.U++;const r=new ze(this,this.j,e);let o=this.o;if(this.S&&(o?(o=_(o),b(o,this.S)):o=this.S),null!==this.m||this.O||(r.H=o,o=null),this.P)e:{for(var t=0,n=0;n<this.i.length;n++){var i=this.i[n];if(void 0===(i="__data__"in i.map&&"string"===typeof(i=i.map.__data__)?i.length:void 0))break;if(4096<(t+=i)){t=n;break e}if(4096===t||n===this.i.length-1){t=n+1;break e}}t=1e3}else t=1e3;t=en(this,r,t),ut(n=at(this.I),"RID",e),ut(n,"CVER",22),this.D&&ut(n,"X-HTTP-Session-Id",this.D),$t(this,n),o&&(this.O?t="headers="+encodeURIComponent(String(Lt(o)))+"&"+t:this.m&&zt(n,this.m,o)),et(this.h,r),this.Ua&&ut(n,"TYPE","init"),this.P?(ut(n,"$req",t),ut(n,"SID","null"),r.T=!0,Ue(r,n,null)):Ue(r,n,t),this.G=2}}else 3==this.G&&(e?Jt(this,e):0==this.i.length||Ye(this.h)||Jt(this))},e.Fa=function(){if(this.u=null,on(this),this.ba&&!(this.M||null==this.g||0>=this.R)){var e=2*this.R;this.j.info("BP detection timer enabled: "+e),this.A=Ie(l(this.ab,this),e)}},e.ab=function(){this.A&&(this.A=null,this.j.info("BP detection timeout reached."),this.j.info("Buffering proxy detected and switch to long-polling!"),this.F=!1,this.M=!0,ke(10),Qt(this),on(this))},e.Za=function(){null!=this.C&&(this.C=null,Qt(this),nn(this),ke(19))},e.fb=function(e){e?(this.j.info("Successfully pinged google.com"),ke(2)):(this.j.info("Failed to ping google.com"),ke(1))},e.isActive=function(){return!!this.l&&this.l.isActive(this)},(e=fn.prototype).ua=function(){},e.ta=function(){},e.sa=function(){},e.ra=function(){},e.isActive=function(){return!0},e.Na=function(){},pn.prototype.g=function(e,t){return new mn(e,t)},d(mn,ne),mn.prototype.m=function(){this.g.l=this.j,this.v&&(this.g.J=!0),this.g.connect(this.l,this.h||void 0)},mn.prototype.close=function(){Zt(this.g)},mn.prototype.o=function(e){var t=this.g;if("string"===typeof e){var n={};n.__data__=e,e=n}else this.u&&((n={}).__data__=de(e),e=n);t.i.push(new Qe(t.Ya++,e)),3==t.G&&Yt(t)},mn.prototype.N=function(){this.g.l=null,delete this.j,Zt(this.g),delete this.g,mn.aa.N.call(this)},d(gn,ve),d(yn,_e),d(vn,fn),vn.prototype.ua=function(){ie(this.g,"a")},vn.prototype.ta=function(e){ie(this.g,new gn(e))},vn.prototype.sa=function(e){ie(this.g,new yn)},vn.prototype.ra=function(){ie(this.g,"b")},pn.prototype.createWebChannel=pn.prototype.g,mn.prototype.send=mn.prototype.o,mn.prototype.open=mn.prototype.m,mn.prototype.close=mn.prototype.close,Xf=Jf.createWebChannelTransport=function(){return new pn},Qf=Jf.getStatEventTarget=function(){return xe()},Zf=Jf.Event=we,Kf=Jf.Stat={mb:0,pb:1,qb:2,Jb:3,Ob:4,Lb:5,Mb:6,Kb:7,Ib:8,Nb:9,PROXY:10,NOPROXY:11,Gb:12,Cb:13,Db:14,Bb:15,Eb:16,Fb:17,ib:18,hb:19,jb:20},Pe.NO_ERROR=0,Pe.TIMEOUT=8,Pe.HTTP_ERROR=6,Gf=Jf.ErrorCode=Pe,Re.COMPLETE="complete",Wf=Jf.EventType=Re,ge.EventType=ye,ye.OPEN="a",ye.CLOSE="b",ye.ERROR="c",ye.MESSAGE="d",ne.prototype.listen=ne.prototype.K,Hf=Jf.WebChannel=ge,Jf.FetchXmlHttpFactory=At,Mt.prototype.listenOnce=Mt.prototype.L,Mt.prototype.getLastError=Mt.prototype.Ka,Mt.prototype.getLastErrorCode=Mt.prototype.Ba,Mt.prototype.getStatus=Mt.prototype.Z,Mt.prototype.getResponseJson=Mt.prototype.Oa,Mt.prototype.getResponseText=Mt.prototype.oa,Mt.prototype.send=Mt.prototype.ea,Mt.prototype.setWithCredentials=Mt.prototype.Ha,qf=Jf.XhrIo=Mt}).apply("undefined"!==typeof Yf?Yf:"undefined"!==typeof self?self:"undefined"!==typeof window?window:{});const $f="@firebase/firestore";class ep{constructor(e){this.uid=e}isAuthenticated(){return null!=this.uid}toKey(){return this.isAuthenticated()?"uid:"+this.uid:"anonymous-user"}isEqual(e){return e.uid===this.uid}}ep.UNAUTHENTICATED=new ep(null),ep.GOOGLE_CREDENTIALS=new ep("google-credentials-uid"),ep.FIRST_PARTY=new ep("first-party-uid"),ep.MOCK_USER=new ep("mock-user");let tp="10.14.0";const np=new wh("@firebase/firestore");function ip(){return np.logLevel}function rp(e){if(np.logLevel<=mh.DEBUG){for(var t=arguments.length,n=new Array(t>1?t-1:0),i=1;i<t;i++)n[i-1]=arguments[i];const r=n.map(sp);np.debug("Firestore (".concat(tp,"): ").concat(e),...r)}}function op(e){if(np.logLevel<=mh.ERROR){for(var t=arguments.length,n=new Array(t>1?t-1:0),i=1;i<t;i++)n[i-1]=arguments[i];const r=n.map(sp);np.error("Firestore (".concat(tp,"): ").concat(e),...r)}}function ap(e){if(np.logLevel<=mh.WARN){for(var t=arguments.length,n=new Array(t>1?t-1:0),i=1;i<t;i++)n[i-1]=arguments[i];const r=n.map(sp);np.warn("Firestore (".concat(tp,"): ").concat(e),...r)}}function sp(e){if("string"==typeof e)return e;try{return function(e){return JSON.stringify(e)}(e)}catch(kk){return e}}function cp(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"Unexpected state";const t="FIRESTORE (".concat(tp,") INTERNAL ASSERTION FAILED: ")+e;throw op(t),new Error(t)}function lp(e,t){e||cp()}function up(e,t){return e}const dp={OK:"ok",CANCELLED:"cancelled",UNKNOWN:"unknown",INVALID_ARGUMENT:"invalid-argument",DEADLINE_EXCEEDED:"deadline-exceeded",NOT_FOUND:"not-found",ALREADY_EXISTS:"already-exists",PERMISSION_DENIED:"permission-denied",UNAUTHENTICATED:"unauthenticated",RESOURCE_EXHAUSTED:"resource-exhausted",FAILED_PRECONDITION:"failed-precondition",ABORTED:"aborted",OUT_OF_RANGE:"out-of-range",UNIMPLEMENTED:"unimplemented",INTERNAL:"internal",UNAVAILABLE:"unavailable",DATA_LOSS:"data-loss"};class hp extends $d{constructor(e,t){super(e,t),this.code=e,this.message=t,this.toString=()=>"".concat(this.name,": [code=").concat(this.code,"]: ").concat(this.message)}}class fp{constructor(){this.promise=new Promise((e,t)=>{this.resolve=e,this.reject=t})}}class pp{constructor(e,t){this.user=t,this.type="OAuth",this.headers=new Map,this.headers.set("Authorization","Bearer ".concat(e))}}class mp{getToken(){return Promise.resolve(null)}invalidateToken(){}start(e,t){e.enqueueRetryable(()=>t(ep.UNAUTHENTICATED))}shutdown(){}}class gp{constructor(e){this.token=e,this.changeListener=null}getToken(){return Promise.resolve(this.token)}invalidateToken(){}start(e,t){this.changeListener=t,e.enqueueRetryable(()=>t(this.token.user))}shutdown(){this.changeListener=null}}class yp{constructor(e){this.t=e,this.currentUser=ep.UNAUTHENTICATED,this.i=0,this.forceRefresh=!1,this.auth=null}start(e,t){lp(void 0===this.o);let n=this.i;const i=e=>this.i!==n?(n=this.i,t(e)):Promise.resolve();let r=new fp;this.o=()=>{this.i++,this.currentUser=this.u(),r.resolve(),r=new fp,e.enqueueRetryable(()=>i(this.currentUser))};const o=()=>{const t=r;e.enqueueRetryable(async()=>{await t.promise,await i(this.currentUser)})},a=e=>{rp("FirebaseAuthCredentialsProvider","Auth detected"),this.auth=e,this.o&&(this.auth.addAuthTokenListener(this.o),o())};this.t.onInit(e=>a(e)),setTimeout(()=>{if(!this.auth){const e=this.t.getImmediate({optional:!0});e?a(e):(rp("FirebaseAuthCredentialsProvider","Auth not yet detected"),r.resolve(),r=new fp)}},0),o()}getToken(){const e=this.i,t=this.forceRefresh;return this.forceRefresh=!1,this.auth?this.auth.getToken(t).then(t=>this.i!==e?(rp("FirebaseAuthCredentialsProvider","getToken aborted due to token change."),this.getToken()):t?(lp("string"==typeof t.accessToken),new pp(t.accessToken,this.currentUser)):null):Promise.resolve(null)}invalidateToken(){this.forceRefresh=!0}shutdown(){this.auth&&this.o&&this.auth.removeAuthTokenListener(this.o),this.o=void 0}u(){const e=this.auth&&this.auth.getUid();return lp(null===e||"string"==typeof e),new ep(e)}}class vp{constructor(e,t,n){this.l=e,this.h=t,this.P=n,this.type="FirstParty",this.user=ep.FIRST_PARTY,this.I=new Map}T(){return this.P?this.P():null}get headers(){this.I.set("X-Goog-AuthUser",this.l);const e=this.T();return e&&this.I.set("Authorization",e),this.h&&this.I.set("X-Goog-Iam-Authorization-Token",this.h),this.I}}class _p{constructor(e,t,n){this.l=e,this.h=t,this.P=n}getToken(){return Promise.resolve(new vp(this.l,this.h,this.P))}start(e,t){e.enqueueRetryable(()=>t(ep.FIRST_PARTY))}shutdown(){}invalidateToken(){}}class wp{constructor(e){this.value=e,this.type="AppCheck",this.headers=new Map,e&&e.length>0&&this.headers.set("x-firebase-appcheck",this.value)}}class bp{constructor(e){this.A=e,this.forceRefresh=!1,this.appCheck=null,this.R=null}start(e,t){lp(void 0===this.o);const n=e=>{null!=e.error&&rp("FirebaseAppCheckTokenProvider","Error getting App Check token; using placeholder token instead. Error: ".concat(e.error.message));const n=e.token!==this.R;return this.R=e.token,rp("FirebaseAppCheckTokenProvider","Received ".concat(n?"new":"existing"," token.")),n?t(e.token):Promise.resolve()};this.o=t=>{e.enqueueRetryable(()=>n(t))};const i=e=>{rp("FirebaseAppCheckTokenProvider","AppCheck detected"),this.appCheck=e,this.o&&this.appCheck.addTokenListener(this.o)};this.A.onInit(e=>i(e)),setTimeout(()=>{if(!this.appCheck){const e=this.A.getImmediate({optional:!0});e?i(e):rp("FirebaseAppCheckTokenProvider","AppCheck not yet detected")}},0)}getToken(){const e=this.forceRefresh;return this.forceRefresh=!1,this.appCheck?this.appCheck.getToken(e).then(e=>e?(lp("string"==typeof e.token),this.R=e.token,new wp(e.token)):null):Promise.resolve(null)}invalidateToken(){this.forceRefresh=!0}shutdown(){this.appCheck&&this.o&&this.appCheck.removeTokenListener(this.o),this.o=void 0}}function xp(e){const t="undefined"!=typeof self&&(self.crypto||self.msCrypto),n=new Uint8Array(e);if(t&&"function"==typeof t.getRandomValues)t.getRandomValues(n);else for(let i=0;i<e;i++)n[i]=Math.floor(256*Math.random());return n}class Sp{static newId(){const e="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",t=62*Math.floor(256/62);let n="";for(;n.length<20;){const i=xp(40);for(let r=0;r<i.length;++r)n.length<20&&i[r]<t&&(n+=e.charAt(i[r]%62))}return n}}function Ep(e,t){return e<t?-1:e>t?1:0}function Tp(e,t,n){return e.length===t.length&&e.every((e,i)=>n(e,t[i]))}class kp{constructor(e,t){if(this.seconds=e,this.nanoseconds=t,t<0)throw new hp(dp.INVALID_ARGUMENT,"Timestamp nanoseconds out of range: "+t);if(t>=1e9)throw new hp(dp.INVALID_ARGUMENT,"Timestamp nanoseconds out of range: "+t);if(e<-62135596800)throw new hp(dp.INVALID_ARGUMENT,"Timestamp seconds out of range: "+e);if(e>=253402300800)throw new hp(dp.INVALID_ARGUMENT,"Timestamp seconds out of range: "+e)}static now(){return kp.fromMillis(Date.now())}static fromDate(e){return kp.fromMillis(e.getTime())}static fromMillis(e){const t=Math.floor(e/1e3),n=Math.floor(1e6*(e-1e3*t));return new kp(t,n)}toDate(){return new Date(this.toMillis())}toMillis(){return 1e3*this.seconds+this.nanoseconds/1e6}_compareTo(e){return this.seconds===e.seconds?Ep(this.nanoseconds,e.nanoseconds):Ep(this.seconds,e.seconds)}isEqual(e){return e.seconds===this.seconds&&e.nanoseconds===this.nanoseconds}toString(){return"Timestamp(seconds="+this.seconds+", nanoseconds="+this.nanoseconds+")"}toJSON(){return{seconds:this.seconds,nanoseconds:this.nanoseconds}}valueOf(){const e=this.seconds- -62135596800;return String(e).padStart(12,"0")+"."+String(this.nanoseconds).padStart(9,"0")}}class Cp{constructor(e){this.timestamp=e}static fromTimestamp(e){return new Cp(e)}static min(){return new Cp(new kp(0,0))}static max(){return new Cp(new kp(253402300799,999999999))}compareTo(e){return this.timestamp._compareTo(e.timestamp)}isEqual(e){return this.timestamp.isEqual(e.timestamp)}toMicroseconds(){return 1e6*this.timestamp.seconds+this.timestamp.nanoseconds/1e3}toString(){return"SnapshotVersion("+this.timestamp.toString()+")"}toTimestamp(){return this.timestamp}}class Ip{constructor(e,t,n){void 0===t?t=0:t>e.length&&cp(),void 0===n?n=e.length-t:n>e.length-t&&cp(),this.segments=e,this.offset=t,this.len=n}get length(){return this.len}isEqual(e){return 0===Ip.comparator(this,e)}child(e){const t=this.segments.slice(this.offset,this.limit());return e instanceof Ip?e.forEach(e=>{t.push(e)}):t.push(e),this.construct(t)}limit(){return this.offset+this.length}popFirst(e){return e=void 0===e?1:e,this.construct(this.segments,this.offset+e,this.length-e)}popLast(){return this.construct(this.segments,this.offset,this.length-1)}firstSegment(){return this.segments[this.offset]}lastSegment(){return this.get(this.length-1)}get(e){return this.segments[this.offset+e]}isEmpty(){return 0===this.length}isPrefixOf(e){if(e.length<this.length)return!1;for(let t=0;t<this.length;t++)if(this.get(t)!==e.get(t))return!1;return!0}isImmediateParentOf(e){if(this.length+1!==e.length)return!1;for(let t=0;t<this.length;t++)if(this.get(t)!==e.get(t))return!1;return!0}forEach(e){for(let t=this.offset,n=this.limit();t<n;t++)e(this.segments[t])}toArray(){return this.segments.slice(this.offset,this.limit())}static comparator(e,t){const n=Math.min(e.length,t.length);for(let i=0;i<n;i++){const n=e.get(i),r=t.get(i);if(n<r)return-1;if(n>r)return 1}return e.length<t.length?-1:e.length>t.length?1:0}}class Ap extends Ip{construct(e,t,n){return new Ap(e,t,n)}canonicalString(){return this.toArray().join("/")}toString(){return this.canonicalString()}toUriEncodedString(){return this.toArray().map(encodeURIComponent).join("/")}static fromString(){const e=[];for(var t=arguments.length,n=new Array(t),i=0;i<t;i++)n[i]=arguments[i];for(const r of n){if(r.indexOf("//")>=0)throw new hp(dp.INVALID_ARGUMENT,"Invalid segment (".concat(r,"). Paths must not contain // in them."));e.push(...r.split("/").filter(e=>e.length>0))}return new Ap(e)}static emptyPath(){return new Ap([])}}const Np=/^[_a-zA-Z][_a-zA-Z0-9]*$/;class Op extends Ip{construct(e,t,n){return new Op(e,t,n)}static isValidIdentifier(e){return Np.test(e)}canonicalString(){return this.toArray().map(e=>(e=e.replace(/\\/g,"\\\\").replace(/`/g,"\\`"),Op.isValidIdentifier(e)||(e="`"+e+"`"),e)).join(".")}toString(){return this.canonicalString()}isKeyField(){return 1===this.length&&"__name__"===this.get(0)}static keyField(){return new Op(["__name__"])}static fromServerFormat(e){const t=[];let n="",i=0;const r=()=>{if(0===n.length)throw new hp(dp.INVALID_ARGUMENT,"Invalid field path (".concat(e,"). Paths must not be empty, begin with '.', end with '.', or contain '..'"));t.push(n),n=""};let o=!1;for(;i<e.length;){const t=e[i];if("\\"===t){if(i+1===e.length)throw new hp(dp.INVALID_ARGUMENT,"Path has trailing escape character: "+e);const t=e[i+1];if("\\"!==t&&"."!==t&&"`"!==t)throw new hp(dp.INVALID_ARGUMENT,"Path has invalid escape sequence: "+e);n+=t,i+=2}else"`"===t?(o=!o,i++):"."!==t||o?(n+=t,i++):(r(),i++)}if(r(),o)throw new hp(dp.INVALID_ARGUMENT,"Unterminated ` in path: "+e);return new Op(t)}static emptyPath(){return new Op([])}}class Pp{constructor(e){this.path=e}static fromPath(e){return new Pp(Ap.fromString(e))}static fromName(e){return new Pp(Ap.fromString(e).popFirst(5))}static empty(){return new Pp(Ap.emptyPath())}get collectionGroup(){return this.path.popLast().lastSegment()}hasCollectionId(e){return this.path.length>=2&&this.path.get(this.path.length-2)===e}getCollectionGroup(){return this.path.get(this.path.length-2)}getCollectionPath(){return this.path.popLast()}isEqual(e){return null!==e&&0===Ap.comparator(this.path,e.path)}toString(){return this.path.toString()}static comparator(e,t){return Ap.comparator(e.path,t.path)}static isDocumentKey(e){return e.length%2==0}static fromSegments(e){return new Pp(new Ap(e.slice()))}}class Rp{constructor(e,t,n,i){this.indexId=e,this.collectionGroup=t,this.fields=n,this.indexState=i}}Rp.UNKNOWN_ID=-1;function Lp(e,t){const n=e.toTimestamp().seconds,i=e.toTimestamp().nanoseconds+1,r=Cp.fromTimestamp(1e9===i?new kp(n+1,0):new kp(n,i));return new Mp(r,Pp.empty(),t)}function zp(e){return new Mp(e.readTime,e.key,-1)}class Mp{constructor(e,t,n){this.readTime=e,this.documentKey=t,this.largestBatchId=n}static min(){return new Mp(Cp.min(),Pp.empty(),-1)}static max(){return new Mp(Cp.max(),Pp.empty(),-1)}}function Dp(e,t){let n=e.readTime.compareTo(t.readTime);return 0!==n?n:(n=Pp.comparator(e.documentKey,t.documentKey),0!==n?n:Ep(e.largestBatchId,t.largestBatchId))}const Bp="The current tab is not in the required state to perform this operation. It might be necessary to refresh the browser tab.";class Up{constructor(){this.onCommittedListeners=[]}addOnCommittedListener(e){this.onCommittedListeners.push(e)}raiseOnCommittedEvent(){this.onCommittedListeners.forEach(e=>e())}}async function Fp(e){if(e.code!==dp.FAILED_PRECONDITION||e.message!==Bp)throw e;rp("LocalStore","Unexpectedly lost primary lease")}class jp{constructor(e){this.nextCallback=null,this.catchCallback=null,this.result=void 0,this.error=void 0,this.isDone=!1,this.callbackAttached=!1,e(e=>{this.isDone=!0,this.result=e,this.nextCallback&&this.nextCallback(e)},e=>{this.isDone=!0,this.error=e,this.catchCallback&&this.catchCallback(e)})}catch(e){return this.next(void 0,e)}next(e,t){return this.callbackAttached&&cp(),this.callbackAttached=!0,this.isDone?this.error?this.wrapFailure(t,this.error):this.wrapSuccess(e,this.result):new jp((n,i)=>{this.nextCallback=t=>{this.wrapSuccess(e,t).next(n,i)},this.catchCallback=e=>{this.wrapFailure(t,e).next(n,i)}})}toPromise(){return new Promise((e,t)=>{this.next(e,t)})}wrapUserFunction(e){try{const t=e();return t instanceof jp?t:jp.resolve(t)}catch(e){return jp.reject(e)}}wrapSuccess(e,t){return e?this.wrapUserFunction(()=>e(t)):jp.resolve(t)}wrapFailure(e,t){return e?this.wrapUserFunction(()=>e(t)):jp.reject(t)}static resolve(e){return new jp((t,n)=>{t(e)})}static reject(e){return new jp((t,n)=>{n(e)})}static waitFor(e){return new jp((t,n)=>{let i=0,r=0,o=!1;e.forEach(e=>{++i,e.next(()=>{++r,o&&r===i&&t()},e=>n(e))}),o=!0,r===i&&t()})}static or(e){let t=jp.resolve(!1);for(const n of e)t=t.next(e=>e?jp.resolve(e):n());return t}static forEach(e,t){const n=[];return e.forEach((e,i)=>{n.push(t.call(this,e,i))}),this.waitFor(n)}static mapArray(e,t){return new jp((n,i)=>{const r=e.length,o=new Array(r);let a=0;for(let s=0;s<r;s++){const c=s;t(e[c]).next(e=>{o[c]=e,++a,a===r&&n(o)},e=>i(e))}})}static doWhile(e,t){return new jp((n,i)=>{const r=()=>{!0===e()?t().next(()=>{r()},i):n()};r()})}}function Vp(e){const t=e.match(/Android ([\d.]+)/i),n=t?t[1].split(".").slice(0,2).join("."):"-1";return Number(n)}function qp(e){return"IndexedDbTransactionError"===e.name}class Hp{constructor(e,t){this.previousValue=e,t&&(t.sequenceNumberHandler=e=>this.ie(e),this.se=e=>t.writeSequenceNumber(e))}ie(e){return this.previousValue=Math.max(e,this.previousValue),this.previousValue}next(){const e=++this.previousValue;return this.se&&this.se(e),e}}function Wp(e){return null==e}function Gp(e){return 0===e&&1/e==-1/0}function Kp(e){return"number"==typeof e&&Number.isInteger(e)&&!Gp(e)&&e<=Number.MAX_SAFE_INTEGER&&e>=Number.MIN_SAFE_INTEGER}Hp.oe=-1;const Zp=["mutationQueues","mutations","documentMutations","remoteDocuments","targets","owner","targetGlobal","targetDocuments","clientMetadata","remoteDocumentGlobal","collectionParents","bundles","namedQueries"],Qp=["mutationQueues","mutations","documentMutations","remoteDocumentsV14","targets","owner","targetGlobal","targetDocuments","clientMetadata","remoteDocumentGlobal","collectionParents","bundles","namedQueries","documentOverlays"],Xp=Qp,Yp=[...Xp,"indexConfiguration","indexState","indexEntries"];function Jp(e){let t=0;for(const n in e)Object.prototype.hasOwnProperty.call(e,n)&&t++;return t}function $p(e,t){for(const n in e)Object.prototype.hasOwnProperty.call(e,n)&&t(n,e[n])}function em(e){for(const t in e)if(Object.prototype.hasOwnProperty.call(e,t))return!1;return!0}class tm{constructor(e,t){this.comparator=e,this.root=t||im.EMPTY}insert(e,t){return new tm(this.comparator,this.root.insert(e,t,this.comparator).copy(null,null,im.BLACK,null,null))}remove(e){return new tm(this.comparator,this.root.remove(e,this.comparator).copy(null,null,im.BLACK,null,null))}get(e){let t=this.root;for(;!t.isEmpty();){const n=this.comparator(e,t.key);if(0===n)return t.value;n<0?t=t.left:n>0&&(t=t.right)}return null}indexOf(e){let t=0,n=this.root;for(;!n.isEmpty();){const i=this.comparator(e,n.key);if(0===i)return t+n.left.size;i<0?n=n.left:(t+=n.left.size+1,n=n.right)}return-1}isEmpty(){return this.root.isEmpty()}get size(){return this.root.size}minKey(){return this.root.minKey()}maxKey(){return this.root.maxKey()}inorderTraversal(e){return this.root.inorderTraversal(e)}forEach(e){this.inorderTraversal((t,n)=>(e(t,n),!1))}toString(){const e=[];return this.inorderTraversal((t,n)=>(e.push("".concat(t,":").concat(n)),!1)),"{".concat(e.join(", "),"}")}reverseTraversal(e){return this.root.reverseTraversal(e)}getIterator(){return new nm(this.root,null,this.comparator,!1)}getIteratorFrom(e){return new nm(this.root,e,this.comparator,!1)}getReverseIterator(){return new nm(this.root,null,this.comparator,!0)}getReverseIteratorFrom(e){return new nm(this.root,e,this.comparator,!0)}}class nm{constructor(e,t,n,i){this.isReverse=i,this.nodeStack=[];let r=1;for(;!e.isEmpty();)if(r=t?n(e.key,t):1,t&&i&&(r*=-1),r<0)e=this.isReverse?e.left:e.right;else{if(0===r){this.nodeStack.push(e);break}this.nodeStack.push(e),e=this.isReverse?e.right:e.left}}getNext(){let e=this.nodeStack.pop();const t={key:e.key,value:e.value};if(this.isReverse)for(e=e.left;!e.isEmpty();)this.nodeStack.push(e),e=e.right;else for(e=e.right;!e.isEmpty();)this.nodeStack.push(e),e=e.left;return t}hasNext(){return this.nodeStack.length>0}peek(){if(0===this.nodeStack.length)return null;const e=this.nodeStack[this.nodeStack.length-1];return{key:e.key,value:e.value}}}class im{constructor(e,t,n,i,r){this.key=e,this.value=t,this.color=null!=n?n:im.RED,this.left=null!=i?i:im.EMPTY,this.right=null!=r?r:im.EMPTY,this.size=this.left.size+1+this.right.size}copy(e,t,n,i,r){return new im(null!=e?e:this.key,null!=t?t:this.value,null!=n?n:this.color,null!=i?i:this.left,null!=r?r:this.right)}isEmpty(){return!1}inorderTraversal(e){return this.left.inorderTraversal(e)||e(this.key,this.value)||this.right.inorderTraversal(e)}reverseTraversal(e){return this.right.reverseTraversal(e)||e(this.key,this.value)||this.left.reverseTraversal(e)}min(){return this.left.isEmpty()?this:this.left.min()}minKey(){return this.min().key}maxKey(){return this.right.isEmpty()?this.key:this.right.maxKey()}insert(e,t,n){let i=this;const r=n(e,i.key);return i=r<0?i.copy(null,null,null,i.left.insert(e,t,n),null):0===r?i.copy(null,t,null,null,null):i.copy(null,null,null,null,i.right.insert(e,t,n)),i.fixUp()}removeMin(){if(this.left.isEmpty())return im.EMPTY;let e=this;return e.left.isRed()||e.left.left.isRed()||(e=e.moveRedLeft()),e=e.copy(null,null,null,e.left.removeMin(),null),e.fixUp()}remove(e,t){let n,i=this;if(t(e,i.key)<0)i.left.isEmpty()||i.left.isRed()||i.left.left.isRed()||(i=i.moveRedLeft()),i=i.copy(null,null,null,i.left.remove(e,t),null);else{if(i.left.isRed()&&(i=i.rotateRight()),i.right.isEmpty()||i.right.isRed()||i.right.left.isRed()||(i=i.moveRedRight()),0===t(e,i.key)){if(i.right.isEmpty())return im.EMPTY;n=i.right.min(),i=i.copy(n.key,n.value,null,null,i.right.removeMin())}i=i.copy(null,null,null,null,i.right.remove(e,t))}return i.fixUp()}isRed(){return this.color}fixUp(){let e=this;return e.right.isRed()&&!e.left.isRed()&&(e=e.rotateLeft()),e.left.isRed()&&e.left.left.isRed()&&(e=e.rotateRight()),e.left.isRed()&&e.right.isRed()&&(e=e.colorFlip()),e}moveRedLeft(){let e=this.colorFlip();return e.right.left.isRed()&&(e=e.copy(null,null,null,null,e.right.rotateRight()),e=e.rotateLeft(),e=e.colorFlip()),e}moveRedRight(){let e=this.colorFlip();return e.left.left.isRed()&&(e=e.rotateRight(),e=e.colorFlip()),e}rotateLeft(){const e=this.copy(null,null,im.RED,null,this.right.left);return this.right.copy(null,null,this.color,e,null)}rotateRight(){const e=this.copy(null,null,im.RED,this.left.right,null);return this.left.copy(null,null,this.color,null,e)}colorFlip(){const e=this.left.copy(null,null,!this.left.color,null,null),t=this.right.copy(null,null,!this.right.color,null,null);return this.copy(null,null,!this.color,e,t)}checkMaxDepth(){const e=this.check();return Math.pow(2,e)<=this.size+1}check(){if(this.isRed()&&this.left.isRed())throw cp();if(this.right.isRed())throw cp();const e=this.left.check();if(e!==this.right.check())throw cp();return e+(this.isRed()?0:1)}}im.EMPTY=null,im.RED=!0,im.BLACK=!1,im.EMPTY=new class{constructor(){this.size=0}get key(){throw cp()}get value(){throw cp()}get color(){throw cp()}get left(){throw cp()}get right(){throw cp()}copy(e,t,n,i,r){return this}insert(e,t,n){return new im(e,t)}remove(e,t){return this}isEmpty(){return!0}inorderTraversal(e){return!1}reverseTraversal(e){return!1}minKey(){return null}maxKey(){return null}isRed(){return!1}checkMaxDepth(){return!0}check(){return 0}};class rm{constructor(e){this.comparator=e,this.data=new tm(this.comparator)}has(e){return null!==this.data.get(e)}first(){return this.data.minKey()}last(){return this.data.maxKey()}get size(){return this.data.size}indexOf(e){return this.data.indexOf(e)}forEach(e){this.data.inorderTraversal((t,n)=>(e(t),!1))}forEachInRange(e,t){const n=this.data.getIteratorFrom(e[0]);for(;n.hasNext();){const i=n.getNext();if(this.comparator(i.key,e[1])>=0)return;t(i.key)}}forEachWhile(e,t){let n;for(n=void 0!==t?this.data.getIteratorFrom(t):this.data.getIterator();n.hasNext();)if(!e(n.getNext().key))return}firstAfterOrEqual(e){const t=this.data.getIteratorFrom(e);return t.hasNext()?t.getNext().key:null}getIterator(){return new om(this.data.getIterator())}getIteratorFrom(e){return new om(this.data.getIteratorFrom(e))}add(e){return this.copy(this.data.remove(e).insert(e,!0))}delete(e){return this.has(e)?this.copy(this.data.remove(e)):this}isEmpty(){return this.data.isEmpty()}unionWith(e){let t=this;return t.size<e.size&&(t=e,e=this),e.forEach(e=>{t=t.add(e)}),t}isEqual(e){if(!(e instanceof rm))return!1;if(this.size!==e.size)return!1;const t=this.data.getIterator(),n=e.data.getIterator();for(;t.hasNext();){const e=t.getNext().key,i=n.getNext().key;if(0!==this.comparator(e,i))return!1}return!0}toArray(){const e=[];return this.forEach(t=>{e.push(t)}),e}toString(){const e=[];return this.forEach(t=>e.push(t)),"SortedSet("+e.toString()+")"}copy(e){const t=new rm(this.comparator);return t.data=e,t}}class om{constructor(e){this.iter=e}getNext(){return this.iter.getNext().key}hasNext(){return this.iter.hasNext()}}class am{constructor(e){this.fields=e,e.sort(Op.comparator)}static empty(){return new am([])}unionWith(e){let t=new rm(Op.comparator);for(const n of this.fields)t=t.add(n);for(const n of e)t=t.add(n);return new am(t.toArray())}covers(e){for(const t of this.fields)if(t.isPrefixOf(e))return!0;return!1}isEqual(e){return Tp(this.fields,e.fields,(e,t)=>e.isEqual(t))}}class sm extends Error{constructor(){super(...arguments),this.name="Base64DecodeError"}}class cm{constructor(e){this.binaryString=e}static fromBase64String(e){const t=function(e){try{return atob(e)}catch(e){throw"undefined"!=typeof DOMException&&e instanceof DOMException?new sm("Invalid base64 string: "+e):e}}(e);return new cm(t)}static fromUint8Array(e){const t=function(e){let t="";for(let n=0;n<e.length;++n)t+=String.fromCharCode(e[n]);return t}(e);return new cm(t)}[Symbol.iterator](){let e=0;return{next:()=>e<this.binaryString.length?{value:this.binaryString.charCodeAt(e++),done:!1}:{value:void 0,done:!0}}}toBase64(){return function(e){return btoa(e)}(this.binaryString)}toUint8Array(){return function(e){const t=new Uint8Array(e.length);for(let n=0;n<e.length;n++)t[n]=e.charCodeAt(n);return t}(this.binaryString)}approximateByteSize(){return 2*this.binaryString.length}compareTo(e){return Ep(this.binaryString,e.binaryString)}isEqual(e){return this.binaryString===e.binaryString}}cm.EMPTY_BYTE_STRING=new cm("");const lm=new RegExp(/^\d{4}-\d\d-\d\dT\d\d:\d\d:\d\d(?:\.(\d+))?Z$/);function um(e){if(lp(!!e),"string"==typeof e){let t=0;const n=lm.exec(e);if(lp(!!n),n[1]){let e=n[1];e=(e+"000000000").substr(0,9),t=Number(e)}const i=new Date(e);return{seconds:Math.floor(i.getTime()/1e3),nanos:t}}return{seconds:dm(e.seconds),nanos:dm(e.nanos)}}function dm(e){return"number"==typeof e?e:"string"==typeof e?Number(e):0}function hm(e){return"string"==typeof e?cm.fromBase64String(e):cm.fromUint8Array(e)}function fm(e){var t,n;return"server_timestamp"===(null===(n=((null===(t=null==e?void 0:e.mapValue)||void 0===t?void 0:t.fields)||{}).__type__)||void 0===n?void 0:n.stringValue)}function pm(e){const t=e.mapValue.fields.__previous_value__;return fm(t)?pm(t):t}function mm(e){const t=um(e.mapValue.fields.__local_write_time__.timestampValue);return new kp(t.seconds,t.nanos)}class gm{constructor(e,t,n,i,r,o,a,s,c){this.databaseId=e,this.appId=t,this.persistenceKey=n,this.host=i,this.ssl=r,this.forceLongPolling=o,this.autoDetectLongPolling=a,this.longPollingOptions=s,this.useFetchStreams=c}}class ym{constructor(e,t){this.projectId=e,this.database=t||"(default)"}static empty(){return new ym("","")}get isDefaultDatabase(){return"(default)"===this.database}isEqual(e){return e instanceof ym&&e.projectId===this.projectId&&e.database===this.database}}const vm={mapValue:{fields:{__type__:{stringValue:"__max__"}}}};function _m(e){return"nullValue"in e?0:"booleanValue"in e?1:"integerValue"in e||"doubleValue"in e?2:"timestampValue"in e?3:"stringValue"in e?5:"bytesValue"in e?6:"referenceValue"in e?7:"geoPointValue"in e?8:"arrayValue"in e?9:"mapValue"in e?fm(e)?4:Lm(e)?9007199254740991:Pm(e)?10:11:cp()}function wm(e,t){if(e===t)return!0;const n=_m(e);if(n!==_m(t))return!1;switch(n){case 0:case 9007199254740991:return!0;case 1:return e.booleanValue===t.booleanValue;case 4:return mm(e).isEqual(mm(t));case 3:return function(e,t){if("string"==typeof e.timestampValue&&"string"==typeof t.timestampValue&&e.timestampValue.length===t.timestampValue.length)return e.timestampValue===t.timestampValue;const n=um(e.timestampValue),i=um(t.timestampValue);return n.seconds===i.seconds&&n.nanos===i.nanos}(e,t);case 5:return e.stringValue===t.stringValue;case 6:return function(e,t){return hm(e.bytesValue).isEqual(hm(t.bytesValue))}(e,t);case 7:return e.referenceValue===t.referenceValue;case 8:return function(e,t){return dm(e.geoPointValue.latitude)===dm(t.geoPointValue.latitude)&&dm(e.geoPointValue.longitude)===dm(t.geoPointValue.longitude)}(e,t);case 2:return function(e,t){if("integerValue"in e&&"integerValue"in t)return dm(e.integerValue)===dm(t.integerValue);if("doubleValue"in e&&"doubleValue"in t){const n=dm(e.doubleValue),i=dm(t.doubleValue);return n===i?Gp(n)===Gp(i):isNaN(n)&&isNaN(i)}return!1}(e,t);case 9:return Tp(e.arrayValue.values||[],t.arrayValue.values||[],wm);case 10:case 11:return function(e,t){const n=e.mapValue.fields||{},i=t.mapValue.fields||{};if(Jp(n)!==Jp(i))return!1;for(const r in n)if(n.hasOwnProperty(r)&&(void 0===i[r]||!wm(n[r],i[r])))return!1;return!0}(e,t);default:return cp()}}function bm(e,t){return void 0!==(e.values||[]).find(e=>wm(e,t))}function xm(e,t){if(e===t)return 0;const n=_m(e),i=_m(t);if(n!==i)return Ep(n,i);switch(n){case 0:case 9007199254740991:return 0;case 1:return Ep(e.booleanValue,t.booleanValue);case 2:return function(e,t){const n=dm(e.integerValue||e.doubleValue),i=dm(t.integerValue||t.doubleValue);return n<i?-1:n>i?1:n===i?0:isNaN(n)?isNaN(i)?0:-1:1}(e,t);case 3:return Sm(e.timestampValue,t.timestampValue);case 4:return Sm(mm(e),mm(t));case 5:return Ep(e.stringValue,t.stringValue);case 6:return function(e,t){const n=hm(e),i=hm(t);return n.compareTo(i)}(e.bytesValue,t.bytesValue);case 7:return function(e,t){const n=e.split("/"),i=t.split("/");for(let r=0;r<n.length&&r<i.length;r++){const e=Ep(n[r],i[r]);if(0!==e)return e}return Ep(n.length,i.length)}(e.referenceValue,t.referenceValue);case 8:return function(e,t){const n=Ep(dm(e.latitude),dm(t.latitude));return 0!==n?n:Ep(dm(e.longitude),dm(t.longitude))}(e.geoPointValue,t.geoPointValue);case 9:return Em(e.arrayValue,t.arrayValue);case 10:return function(e,t){var n,i,r,o;const a=e.fields||{},s=t.fields||{},c=null===(n=a.value)||void 0===n?void 0:n.arrayValue,l=null===(i=s.value)||void 0===i?void 0:i.arrayValue,u=Ep((null===(r=null==c?void 0:c.values)||void 0===r?void 0:r.length)||0,(null===(o=null==l?void 0:l.values)||void 0===o?void 0:o.length)||0);return 0!==u?u:Em(c,l)}(e.mapValue,t.mapValue);case 11:return function(e,t){if(e===vm.mapValue&&t===vm.mapValue)return 0;if(e===vm.mapValue)return 1;if(t===vm.mapValue)return-1;const n=e.fields||{},i=Object.keys(n),r=t.fields||{},o=Object.keys(r);i.sort(),o.sort();for(let a=0;a<i.length&&a<o.length;++a){const e=Ep(i[a],o[a]);if(0!==e)return e;const t=xm(n[i[a]],r[o[a]]);if(0!==t)return t}return Ep(i.length,o.length)}(e.mapValue,t.mapValue);default:throw cp()}}function Sm(e,t){if("string"==typeof e&&"string"==typeof t&&e.length===t.length)return Ep(e,t);const n=um(e),i=um(t),r=Ep(n.seconds,i.seconds);return 0!==r?r:Ep(n.nanos,i.nanos)}function Em(e,t){const n=e.values||[],i=t.values||[];for(let r=0;r<n.length&&r<i.length;++r){const e=xm(n[r],i[r]);if(e)return e}return Ep(n.length,i.length)}function Tm(e){return km(e)}function km(e){return"nullValue"in e?"null":"booleanValue"in e?""+e.booleanValue:"integerValue"in e?""+e.integerValue:"doubleValue"in e?""+e.doubleValue:"timestampValue"in e?function(e){const t=um(e);return"time(".concat(t.seconds,",").concat(t.nanos,")")}(e.timestampValue):"stringValue"in e?e.stringValue:"bytesValue"in e?function(e){return hm(e).toBase64()}(e.bytesValue):"referenceValue"in e?function(e){return Pp.fromName(e).toString()}(e.referenceValue):"geoPointValue"in e?function(e){return"geo(".concat(e.latitude,",").concat(e.longitude,")")}(e.geoPointValue):"arrayValue"in e?function(e){let t="[",n=!0;for(const i of e.values||[])n?n=!1:t+=",",t+=km(i);return t+"]"}(e.arrayValue):"mapValue"in e?function(e){const t=Object.keys(e.fields||{}).sort();let n="{",i=!0;for(const r of t)i?i=!1:n+=",",n+="".concat(r,":").concat(km(e.fields[r]));return n+"}"}(e.mapValue):cp()}function Cm(e){return!!e&&"integerValue"in e}function Im(e){return!!e&&"arrayValue"in e}function Am(e){return!!e&&"nullValue"in e}function Nm(e){return!!e&&"doubleValue"in e&&isNaN(Number(e.doubleValue))}function Om(e){return!!e&&"mapValue"in e}function Pm(e){var t,n;return"__vector__"===(null===(n=((null===(t=null==e?void 0:e.mapValue)||void 0===t?void 0:t.fields)||{}).__type__)||void 0===n?void 0:n.stringValue)}function Rm(e){if(e.geoPointValue)return{geoPointValue:Object.assign({},e.geoPointValue)};if(e.timestampValue&&"object"==typeof e.timestampValue)return{timestampValue:Object.assign({},e.timestampValue)};if(e.mapValue){const t={mapValue:{fields:{}}};return $p(e.mapValue.fields,(e,n)=>t.mapValue.fields[e]=Rm(n)),t}if(e.arrayValue){const t={arrayValue:{values:[]}};for(let n=0;n<(e.arrayValue.values||[]).length;++n)t.arrayValue.values[n]=Rm(e.arrayValue.values[n]);return t}return Object.assign({},e)}function Lm(e){return"__max__"===(((e.mapValue||{}).fields||{}).__type__||{}).stringValue}class zm{constructor(e){this.value=e}static empty(){return new zm({mapValue:{}})}field(e){if(e.isEmpty())return this.value;{let t=this.value;for(let n=0;n<e.length-1;++n)if(t=(t.mapValue.fields||{})[e.get(n)],!Om(t))return null;return t=(t.mapValue.fields||{})[e.lastSegment()],t||null}}set(e,t){this.getFieldsMap(e.popLast())[e.lastSegment()]=Rm(t)}setAll(e){let t=Op.emptyPath(),n={},i=[];e.forEach((e,r)=>{if(!t.isImmediateParentOf(r)){const e=this.getFieldsMap(t);this.applyChanges(e,n,i),n={},i=[],t=r.popLast()}e?n[r.lastSegment()]=Rm(e):i.push(r.lastSegment())});const r=this.getFieldsMap(t);this.applyChanges(r,n,i)}delete(e){const t=this.field(e.popLast());Om(t)&&t.mapValue.fields&&delete t.mapValue.fields[e.lastSegment()]}isEqual(e){return wm(this.value,e.value)}getFieldsMap(e){let t=this.value;t.mapValue.fields||(t.mapValue={fields:{}});for(let n=0;n<e.length;++n){let i=t.mapValue.fields[e.get(n)];Om(i)&&i.mapValue.fields||(i={mapValue:{fields:{}}},t.mapValue.fields[e.get(n)]=i),t=i}return t.mapValue.fields}applyChanges(e,t,n){$p(t,(t,n)=>e[t]=n);for(const i of n)delete e[i]}clone(){return new zm(Rm(this.value))}}function Mm(e){const t=[];return $p(e.fields,(e,n)=>{const i=new Op([e]);if(Om(n)){const e=Mm(n.mapValue).fields;if(0===e.length)t.push(i);else for(const n of e)t.push(i.child(n))}else t.push(i)}),new am(t)}class Dm{constructor(e,t,n,i,r,o,a){this.key=e,this.documentType=t,this.version=n,this.readTime=i,this.createTime=r,this.data=o,this.documentState=a}static newInvalidDocument(e){return new Dm(e,0,Cp.min(),Cp.min(),Cp.min(),zm.empty(),0)}static newFoundDocument(e,t,n,i){return new Dm(e,1,t,Cp.min(),n,i,0)}static newNoDocument(e,t){return new Dm(e,2,t,Cp.min(),Cp.min(),zm.empty(),0)}static newUnknownDocument(e,t){return new Dm(e,3,t,Cp.min(),Cp.min(),zm.empty(),2)}convertToFoundDocument(e,t){return!this.createTime.isEqual(Cp.min())||2!==this.documentType&&0!==this.documentType||(this.createTime=e),this.version=e,this.documentType=1,this.data=t,this.documentState=0,this}convertToNoDocument(e){return this.version=e,this.documentType=2,this.data=zm.empty(),this.documentState=0,this}convertToUnknownDocument(e){return this.version=e,this.documentType=3,this.data=zm.empty(),this.documentState=2,this}setHasCommittedMutations(){return this.documentState=2,this}setHasLocalMutations(){return this.documentState=1,this.version=Cp.min(),this}setReadTime(e){return this.readTime=e,this}get hasLocalMutations(){return 1===this.documentState}get hasCommittedMutations(){return 2===this.documentState}get hasPendingWrites(){return this.hasLocalMutations||this.hasCommittedMutations}isValidDocument(){return 0!==this.documentType}isFoundDocument(){return 1===this.documentType}isNoDocument(){return 2===this.documentType}isUnknownDocument(){return 3===this.documentType}isEqual(e){return e instanceof Dm&&this.key.isEqual(e.key)&&this.version.isEqual(e.version)&&this.documentType===e.documentType&&this.documentState===e.documentState&&this.data.isEqual(e.data)}mutableCopy(){return new Dm(this.key,this.documentType,this.version,this.readTime,this.createTime,this.data.clone(),this.documentState)}toString(){return"Document(".concat(this.key,", ").concat(this.version,", ").concat(JSON.stringify(this.data.value),", {createTime: ").concat(this.createTime,"}), {documentType: ").concat(this.documentType,"}), {documentState: ").concat(this.documentState,"})")}}class Bm{constructor(e,t){this.position=e,this.inclusive=t}}function Um(e,t,n){let i=0;for(let r=0;r<e.position.length;r++){const o=t[r],a=e.position[r];if(i=o.field.isKeyField()?Pp.comparator(Pp.fromName(a.referenceValue),n.key):xm(a,n.data.field(o.field)),"desc"===o.dir&&(i*=-1),0!==i)break}return i}function Fm(e,t){if(null===e)return null===t;if(null===t)return!1;if(e.inclusive!==t.inclusive||e.position.length!==t.position.length)return!1;for(let n=0;n<e.position.length;n++)if(!wm(e.position[n],t.position[n]))return!1;return!0}class jm{constructor(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"asc";this.field=e,this.dir=t}}function Vm(e,t){return e.dir===t.dir&&e.field.isEqual(t.field)}class qm{}class Hm extends qm{constructor(e,t,n){super(),this.field=e,this.op=t,this.value=n}static create(e,t,n){return e.isKeyField()?"in"===t||"not-in"===t?this.createKeyFieldInFilter(e,t,n):new Jm(e,t,n):"array-contains"===t?new ng(e,n):"in"===t?new ig(e,n):"not-in"===t?new rg(e,n):"array-contains-any"===t?new og(e,n):new Hm(e,t,n)}static createKeyFieldInFilter(e,t,n){return"in"===t?new $m(e,n):new eg(e,n)}matches(e){const t=e.data.field(this.field);return"!="===this.op?null!==t&&this.matchesComparison(xm(t,this.value)):null!==t&&_m(this.value)===_m(t)&&this.matchesComparison(xm(t,this.value))}matchesComparison(e){switch(this.op){case"<":return e<0;case"<=":return e<=0;case"==":return 0===e;case"!=":return 0!==e;case">":return e>0;case">=":return e>=0;default:return cp()}}isInequality(){return["<","<=",">",">=","!=","not-in"].indexOf(this.op)>=0}getFlattenedFilters(){return[this]}getFilters(){return[this]}}class Wm extends qm{constructor(e,t){super(),this.filters=e,this.op=t,this.ae=null}static create(e,t){return new Wm(e,t)}matches(e){return Gm(this)?void 0===this.filters.find(t=>!t.matches(e)):void 0!==this.filters.find(t=>t.matches(e))}getFlattenedFilters(){return null!==this.ae||(this.ae=this.filters.reduce((e,t)=>e.concat(t.getFlattenedFilters()),[])),this.ae}getFilters(){return Object.assign([],this.filters)}}function Gm(e){return"and"===e.op}function Km(e){return Zm(e)&&Gm(e)}function Zm(e){for(const t of e.filters)if(t instanceof Wm)return!1;return!0}function Qm(e){if(e instanceof Hm)return e.field.canonicalString()+e.op.toString()+Tm(e.value);if(Km(e))return e.filters.map(e=>Qm(e)).join(",");{const t=e.filters.map(e=>Qm(e)).join(",");return"".concat(e.op,"(").concat(t,")")}}function Xm(e,t){return e instanceof Hm?function(e,t){return t instanceof Hm&&e.op===t.op&&e.field.isEqual(t.field)&&wm(e.value,t.value)}(e,t):e instanceof Wm?function(e,t){return t instanceof Wm&&e.op===t.op&&e.filters.length===t.filters.length&&e.filters.reduce((e,n,i)=>e&&Xm(n,t.filters[i]),!0)}(e,t):void cp()}function Ym(e){return e instanceof Hm?function(e){return"".concat(e.field.canonicalString()," ").concat(e.op," ").concat(Tm(e.value))}(e):e instanceof Wm?function(e){return e.op.toString()+" {"+e.getFilters().map(Ym).join(" ,")+"}"}(e):"Filter"}class Jm extends Hm{constructor(e,t,n){super(e,t,n),this.key=Pp.fromName(n.referenceValue)}matches(e){const t=Pp.comparator(e.key,this.key);return this.matchesComparison(t)}}class $m extends Hm{constructor(e,t){super(e,"in",t),this.keys=tg("in",t)}matches(e){return this.keys.some(t=>t.isEqual(e.key))}}class eg extends Hm{constructor(e,t){super(e,"not-in",t),this.keys=tg("not-in",t)}matches(e){return!this.keys.some(t=>t.isEqual(e.key))}}function tg(e,t){var n;return((null===(n=t.arrayValue)||void 0===n?void 0:n.values)||[]).map(e=>Pp.fromName(e.referenceValue))}class ng extends Hm{constructor(e,t){super(e,"array-contains",t)}matches(e){const t=e.data.field(this.field);return Im(t)&&bm(t.arrayValue,this.value)}}class ig extends Hm{constructor(e,t){super(e,"in",t)}matches(e){const t=e.data.field(this.field);return null!==t&&bm(this.value.arrayValue,t)}}class rg extends Hm{constructor(e,t){super(e,"not-in",t)}matches(e){if(bm(this.value.arrayValue,{nullValue:"NULL_VALUE"}))return!1;const t=e.data.field(this.field);return null!==t&&!bm(this.value.arrayValue,t)}}class og extends Hm{constructor(e,t){super(e,"array-contains-any",t)}matches(e){const t=e.data.field(this.field);return!(!Im(t)||!t.arrayValue.values)&&t.arrayValue.values.some(e=>bm(this.value.arrayValue,e))}}class ag{constructor(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:[],i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:[],r=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null,o=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,a=arguments.length>6&&void 0!==arguments[6]?arguments[6]:null;this.path=e,this.collectionGroup=t,this.orderBy=n,this.filters=i,this.limit=r,this.startAt=o,this.endAt=a,this.ue=null}}function sg(e){return new ag(e,arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,arguments.length>2&&void 0!==arguments[2]?arguments[2]:[],arguments.length>3&&void 0!==arguments[3]?arguments[3]:[],arguments.length>4&&void 0!==arguments[4]?arguments[4]:null,arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,arguments.length>6&&void 0!==arguments[6]?arguments[6]:null)}function cg(e){const t=up(e);if(null===t.ue){let e=t.path.canonicalString();null!==t.collectionGroup&&(e+="|cg:"+t.collectionGroup),e+="|f:",e+=t.filters.map(e=>Qm(e)).join(","),e+="|ob:",e+=t.orderBy.map(e=>function(e){return e.field.canonicalString()+e.dir}(e)).join(","),Wp(t.limit)||(e+="|l:",e+=t.limit),t.startAt&&(e+="|lb:",e+=t.startAt.inclusive?"b:":"a:",e+=t.startAt.position.map(e=>Tm(e)).join(",")),t.endAt&&(e+="|ub:",e+=t.endAt.inclusive?"a:":"b:",e+=t.endAt.position.map(e=>Tm(e)).join(",")),t.ue=e}return t.ue}function lg(e,t){if(e.limit!==t.limit)return!1;if(e.orderBy.length!==t.orderBy.length)return!1;for(let n=0;n<e.orderBy.length;n++)if(!Vm(e.orderBy[n],t.orderBy[n]))return!1;if(e.filters.length!==t.filters.length)return!1;for(let n=0;n<e.filters.length;n++)if(!Xm(e.filters[n],t.filters[n]))return!1;return e.collectionGroup===t.collectionGroup&&!!e.path.isEqual(t.path)&&!!Fm(e.startAt,t.startAt)&&Fm(e.endAt,t.endAt)}function ug(e){return Pp.isDocumentKey(e.path)&&null===e.collectionGroup&&0===e.filters.length}class dg{constructor(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:[],i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:[],r=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null,o=arguments.length>5&&void 0!==arguments[5]?arguments[5]:"F",a=arguments.length>6&&void 0!==arguments[6]?arguments[6]:null,s=arguments.length>7&&void 0!==arguments[7]?arguments[7]:null;this.path=e,this.collectionGroup=t,this.explicitOrderBy=n,this.filters=i,this.limit=r,this.limitType=o,this.startAt=a,this.endAt=s,this.ce=null,this.le=null,this.he=null,this.startAt,this.endAt}}function hg(e,t,n,i,r,o,a,s){return new dg(e,t,n,i,r,o,a,s)}function fg(e){return new dg(e)}function pg(e){return 0===e.filters.length&&null===e.limit&&null==e.startAt&&null==e.endAt&&(0===e.explicitOrderBy.length||1===e.explicitOrderBy.length&&e.explicitOrderBy[0].field.isKeyField())}function mg(e){return null!==e.collectionGroup}function gg(e){const t=up(e);if(null===t.ce){t.ce=[];const e=new Set;for(const r of t.explicitOrderBy)t.ce.push(r),e.add(r.field.canonicalString());const n=t.explicitOrderBy.length>0?t.explicitOrderBy[t.explicitOrderBy.length-1].dir:"asc",i=function(e){let t=new rm(Op.comparator);return e.filters.forEach(e=>{e.getFlattenedFilters().forEach(e=>{e.isInequality()&&(t=t.add(e.field))})}),t}(t);i.forEach(i=>{e.has(i.canonicalString())||i.isKeyField()||t.ce.push(new jm(i,n))}),e.has(Op.keyField().canonicalString())||t.ce.push(new jm(Op.keyField(),n))}return t.ce}function yg(e){const t=up(e);return t.le||(t.le=vg(t,gg(e))),t.le}function vg(e,t){if("F"===e.limitType)return sg(e.path,e.collectionGroup,t,e.filters,e.limit,e.startAt,e.endAt);{t=t.map(e=>{const t="desc"===e.dir?"asc":"desc";return new jm(e.field,t)});const n=e.endAt?new Bm(e.endAt.position,e.endAt.inclusive):null,i=e.startAt?new Bm(e.startAt.position,e.startAt.inclusive):null;return sg(e.path,e.collectionGroup,t,e.filters,e.limit,n,i)}}function _g(e,t,n){return new dg(e.path,e.collectionGroup,e.explicitOrderBy.slice(),e.filters.slice(),t,n,e.startAt,e.endAt)}function wg(e,t){return lg(yg(e),yg(t))&&e.limitType===t.limitType}function bg(e){return"".concat(cg(yg(e)),"|lt:").concat(e.limitType)}function xg(e){return"Query(target=".concat(function(e){let t=e.path.canonicalString();return null!==e.collectionGroup&&(t+=" collectionGroup="+e.collectionGroup),e.filters.length>0&&(t+=", filters: [".concat(e.filters.map(e=>Ym(e)).join(", "),"]")),Wp(e.limit)||(t+=", limit: "+e.limit),e.orderBy.length>0&&(t+=", orderBy: [".concat(e.orderBy.map(e=>function(e){return"".concat(e.field.canonicalString()," (").concat(e.dir,")")}(e)).join(", "),"]")),e.startAt&&(t+=", startAt: ",t+=e.startAt.inclusive?"b:":"a:",t+=e.startAt.position.map(e=>Tm(e)).join(",")),e.endAt&&(t+=", endAt: ",t+=e.endAt.inclusive?"a:":"b:",t+=e.endAt.position.map(e=>Tm(e)).join(",")),"Target(".concat(t,")")}(yg(e)),"; limitType=").concat(e.limitType,")")}function Sg(e,t){return t.isFoundDocument()&&function(e,t){const n=t.key.path;return null!==e.collectionGroup?t.key.hasCollectionId(e.collectionGroup)&&e.path.isPrefixOf(n):Pp.isDocumentKey(e.path)?e.path.isEqual(n):e.path.isImmediateParentOf(n)}(e,t)&&function(e,t){for(const n of gg(e))if(!n.field.isKeyField()&&null===t.data.field(n.field))return!1;return!0}(e,t)&&function(e,t){for(const n of e.filters)if(!n.matches(t))return!1;return!0}(e,t)&&function(e,t){return!(e.startAt&&!function(e,t,n){const i=Um(e,t,n);return e.inclusive?i<=0:i<0}(e.startAt,gg(e),t))&&!(e.endAt&&!function(e,t,n){const i=Um(e,t,n);return e.inclusive?i>=0:i>0}(e.endAt,gg(e),t))}(e,t)}function Eg(e){return e.collectionGroup||(e.path.length%2==1?e.path.lastSegment():e.path.get(e.path.length-2))}function Tg(e){return(t,n)=>{let i=!1;for(const r of gg(e)){const e=kg(r,t,n);if(0!==e)return e;i=i||r.field.isKeyField()}return 0}}function kg(e,t,n){const i=e.field.isKeyField()?Pp.comparator(t.key,n.key):function(e,t,n){const i=t.data.field(e),r=n.data.field(e);return null!==i&&null!==r?xm(i,r):cp()}(e.field,t,n);switch(e.dir){case"asc":return i;case"desc":return-1*i;default:return cp()}}class Cg{constructor(e,t){this.mapKeyFn=e,this.equalsFn=t,this.inner={},this.innerSize=0}get(e){const t=this.mapKeyFn(e),n=this.inner[t];if(void 0!==n)for(const[i,r]of n)if(this.equalsFn(i,e))return r}has(e){return void 0!==this.get(e)}set(e,t){const n=this.mapKeyFn(e),i=this.inner[n];if(void 0===i)return this.inner[n]=[[e,t]],void this.innerSize++;for(let r=0;r<i.length;r++)if(this.equalsFn(i[r][0],e))return void(i[r]=[e,t]);i.push([e,t]),this.innerSize++}delete(e){const t=this.mapKeyFn(e),n=this.inner[t];if(void 0===n)return!1;for(let i=0;i<n.length;i++)if(this.equalsFn(n[i][0],e))return 1===n.length?delete this.inner[t]:n.splice(i,1),this.innerSize--,!0;return!1}forEach(e){$p(this.inner,(t,n)=>{for(const[i,r]of n)e(i,r)})}isEmpty(){return em(this.inner)}size(){return this.innerSize}}const Ig=new tm(Pp.comparator);function Ag(){return Ig}const Ng=new tm(Pp.comparator);function Og(){let e=Ng;for(var t=arguments.length,n=new Array(t),i=0;i<t;i++)n[i]=arguments[i];for(const r of n)e=e.insert(r.key,r);return e}function Pg(e){let t=Ng;return e.forEach((e,n)=>t=t.insert(e,n.overlayedDocument)),t}function Rg(){return zg()}function Lg(){return zg()}function zg(){return new Cg(e=>e.toString(),(e,t)=>e.isEqual(t))}const Mg=new tm(Pp.comparator),Dg=new rm(Pp.comparator);function Bg(){let e=Dg;for(var t=arguments.length,n=new Array(t),i=0;i<t;i++)n[i]=arguments[i];for(const r of n)e=e.add(r);return e}const Ug=new rm(Ep);function Fg(){return Ug}function jg(e,t){if(e.useProto3Json){if(isNaN(t))return{doubleValue:"NaN"};if(t===1/0)return{doubleValue:"Infinity"};if(t===-1/0)return{doubleValue:"-Infinity"}}return{doubleValue:Gp(t)?"-0":t}}function Vg(e){return{integerValue:""+e}}function qg(e,t){return Kp(t)?Vg(t):jg(e,t)}class Hg{constructor(){this._=void 0}}function Wg(e,t,n){return e instanceof Zg?function(e,t){const n={fields:{__type__:{stringValue:"server_timestamp"},__local_write_time__:{timestampValue:{seconds:e.seconds,nanos:e.nanoseconds}}}};return t&&fm(t)&&(t=pm(t)),t&&(n.fields.__previous_value__=t),{mapValue:n}}(n,t):e instanceof Qg?Xg(e,t):e instanceof Yg?Jg(e,t):function(e,t){const n=Kg(e,t),i=ey(n)+ey(e.Pe);return Cm(n)&&Cm(e.Pe)?Vg(i):jg(e.serializer,i)}(e,t)}function Gg(e,t,n){return e instanceof Qg?Xg(e,t):e instanceof Yg?Jg(e,t):n}function Kg(e,t){return e instanceof $g?function(e){return Cm(e)||function(e){return!!e&&"doubleValue"in e}(e)}(t)?t:{integerValue:0}:null}class Zg extends Hg{}class Qg extends Hg{constructor(e){super(),this.elements=e}}function Xg(e,t){const n=ty(t);for(const i of e.elements)n.some(e=>wm(e,i))||n.push(i);return{arrayValue:{values:n}}}class Yg extends Hg{constructor(e){super(),this.elements=e}}function Jg(e,t){let n=ty(t);for(const i of e.elements)n=n.filter(e=>!wm(e,i));return{arrayValue:{values:n}}}class $g extends Hg{constructor(e,t){super(),this.serializer=e,this.Pe=t}}function ey(e){return dm(e.integerValue||e.doubleValue)}function ty(e){return Im(e)&&e.arrayValue.values?e.arrayValue.values.slice():[]}class ny{constructor(e,t){this.version=e,this.transformResults=t}}class iy{constructor(e,t){this.updateTime=e,this.exists=t}static none(){return new iy}static exists(e){return new iy(void 0,e)}static updateTime(e){return new iy(e)}get isNone(){return void 0===this.updateTime&&void 0===this.exists}isEqual(e){return this.exists===e.exists&&(this.updateTime?!!e.updateTime&&this.updateTime.isEqual(e.updateTime):!e.updateTime)}}function ry(e,t){return void 0!==e.updateTime?t.isFoundDocument()&&t.version.isEqual(e.updateTime):void 0===e.exists||e.exists===t.isFoundDocument()}class oy{}function ay(e,t){if(!e.hasLocalMutations||t&&0===t.fields.length)return null;if(null===t)return e.isNoDocument()?new gy(e.key,iy.none()):new dy(e.key,e.data,iy.none());{const n=e.data,i=zm.empty();let r=new rm(Op.comparator);for(let e of t.fields)if(!r.has(e)){let t=n.field(e);null===t&&e.length>1&&(e=e.popLast(),t=n.field(e)),null===t?i.delete(e):i.set(e,t),r=r.add(e)}return new hy(e.key,i,new am(r.toArray()),iy.none())}}function sy(e,t,n){e instanceof dy?function(e,t,n){const i=e.value.clone(),r=py(e.fieldTransforms,t,n.transformResults);i.setAll(r),t.convertToFoundDocument(n.version,i).setHasCommittedMutations()}(e,t,n):e instanceof hy?function(e,t,n){if(!ry(e.precondition,t))return void t.convertToUnknownDocument(n.version);const i=py(e.fieldTransforms,t,n.transformResults),r=t.data;r.setAll(fy(e)),r.setAll(i),t.convertToFoundDocument(n.version,r).setHasCommittedMutations()}(e,t,n):function(e,t,n){t.convertToNoDocument(n.version).setHasCommittedMutations()}(0,t,n)}function cy(e,t,n,i){return e instanceof dy?function(e,t,n,i){if(!ry(e.precondition,t))return n;const r=e.value.clone(),o=my(e.fieldTransforms,i,t);return r.setAll(o),t.convertToFoundDocument(t.version,r).setHasLocalMutations(),null}(e,t,n,i):e instanceof hy?function(e,t,n,i){if(!ry(e.precondition,t))return n;const r=my(e.fieldTransforms,i,t),o=t.data;return o.setAll(fy(e)),o.setAll(r),t.convertToFoundDocument(t.version,o).setHasLocalMutations(),null===n?null:n.unionWith(e.fieldMask.fields).unionWith(e.fieldTransforms.map(e=>e.field))}(e,t,n,i):function(e,t,n){return ry(e.precondition,t)?(t.convertToNoDocument(t.version).setHasLocalMutations(),null):n}(e,t,n)}function ly(e,t){let n=null;for(const i of e.fieldTransforms){const e=t.data.field(i.field),r=Kg(i.transform,e||null);null!=r&&(null===n&&(n=zm.empty()),n.set(i.field,r))}return n||null}function uy(e,t){return e.type===t.type&&!!e.key.isEqual(t.key)&&!!e.precondition.isEqual(t.precondition)&&!!function(e,t){return void 0===e&&void 0===t||!(!e||!t)&&Tp(e,t,(e,t)=>function(e,t){return e.field.isEqual(t.field)&&function(e,t){return e instanceof Qg&&t instanceof Qg||e instanceof Yg&&t instanceof Yg?Tp(e.elements,t.elements,wm):e instanceof $g&&t instanceof $g?wm(e.Pe,t.Pe):e instanceof Zg&&t instanceof Zg}(e.transform,t.transform)}(e,t))}(e.fieldTransforms,t.fieldTransforms)&&(0===e.type?e.value.isEqual(t.value):1!==e.type||e.data.isEqual(t.data)&&e.fieldMask.isEqual(t.fieldMask))}class dy extends oy{constructor(e,t,n){let i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:[];super(),this.key=e,this.value=t,this.precondition=n,this.fieldTransforms=i,this.type=0}getFieldMask(){return null}}class hy extends oy{constructor(e,t,n,i){let r=arguments.length>4&&void 0!==arguments[4]?arguments[4]:[];super(),this.key=e,this.data=t,this.fieldMask=n,this.precondition=i,this.fieldTransforms=r,this.type=1}getFieldMask(){return this.fieldMask}}function fy(e){const t=new Map;return e.fieldMask.fields.forEach(n=>{if(!n.isEmpty()){const i=e.data.field(n);t.set(n,i)}}),t}function py(e,t,n){const i=new Map;lp(e.length===n.length);for(let r=0;r<n.length;r++){const o=e[r],a=o.transform,s=t.data.field(o.field);i.set(o.field,Gg(a,s,n[r]))}return i}function my(e,t,n){const i=new Map;for(const r of e){const e=r.transform,o=n.data.field(r.field);i.set(r.field,Wg(e,o,t))}return i}class gy extends oy{constructor(e,t){super(),this.key=e,this.precondition=t,this.type=2,this.fieldTransforms=[]}getFieldMask(){return null}}class yy extends oy{constructor(e,t){super(),this.key=e,this.precondition=t,this.type=3,this.fieldTransforms=[]}getFieldMask(){return null}}class vy{constructor(e,t,n,i){this.batchId=e,this.localWriteTime=t,this.baseMutations=n,this.mutations=i}applyToRemoteDocument(e,t){const n=t.mutationResults;for(let i=0;i<this.mutations.length;i++){const t=this.mutations[i];t.key.isEqual(e.key)&&sy(t,e,n[i])}}applyToLocalView(e,t){for(const n of this.baseMutations)n.key.isEqual(e.key)&&(t=cy(n,e,t,this.localWriteTime));for(const n of this.mutations)n.key.isEqual(e.key)&&(t=cy(n,e,t,this.localWriteTime));return t}applyToLocalDocumentSet(e,t){const n=Lg();return this.mutations.forEach(i=>{const r=e.get(i.key),o=r.overlayedDocument;let a=this.applyToLocalView(o,r.mutatedFields);a=t.has(i.key)?null:a;const s=ay(o,a);null!==s&&n.set(i.key,s),o.isValidDocument()||o.convertToNoDocument(Cp.min())}),n}keys(){return this.mutations.reduce((e,t)=>e.add(t.key),Bg())}isEqual(e){return this.batchId===e.batchId&&Tp(this.mutations,e.mutations,(e,t)=>uy(e,t))&&Tp(this.baseMutations,e.baseMutations,(e,t)=>uy(e,t))}}class _y{constructor(e,t,n,i){this.batch=e,this.commitVersion=t,this.mutationResults=n,this.docVersions=i}static from(e,t,n){lp(e.mutations.length===n.length);let i=Mg;const r=e.mutations;for(let o=0;o<r.length;o++)i=i.insert(r[o].key,n[o].version);return new _y(e,t,n,i)}}class wy{constructor(e,t){this.largestBatchId=e,this.mutation=t}getKey(){return this.mutation.key}isEqual(e){return null!==e&&this.mutation===e.mutation}toString(){return"Overlay{\n      largestBatchId: ".concat(this.largestBatchId,",\n      mutation: ").concat(this.mutation.toString(),"\n    }")}}class by{constructor(e,t){this.count=e,this.unchangedNames=t}}var xy,Sy;function Ey(e){switch(e){default:return cp();case dp.CANCELLED:case dp.UNKNOWN:case dp.DEADLINE_EXCEEDED:case dp.RESOURCE_EXHAUSTED:case dp.INTERNAL:case dp.UNAVAILABLE:case dp.UNAUTHENTICATED:return!1;case dp.INVALID_ARGUMENT:case dp.NOT_FOUND:case dp.ALREADY_EXISTS:case dp.PERMISSION_DENIED:case dp.FAILED_PRECONDITION:case dp.ABORTED:case dp.OUT_OF_RANGE:case dp.UNIMPLEMENTED:case dp.DATA_LOSS:return!0}}function Ty(e){if(void 0===e)return op("GRPC error has no .code"),dp.UNKNOWN;switch(e){case xy.OK:return dp.OK;case xy.CANCELLED:return dp.CANCELLED;case xy.UNKNOWN:return dp.UNKNOWN;case xy.DEADLINE_EXCEEDED:return dp.DEADLINE_EXCEEDED;case xy.RESOURCE_EXHAUSTED:return dp.RESOURCE_EXHAUSTED;case xy.INTERNAL:return dp.INTERNAL;case xy.UNAVAILABLE:return dp.UNAVAILABLE;case xy.UNAUTHENTICATED:return dp.UNAUTHENTICATED;case xy.INVALID_ARGUMENT:return dp.INVALID_ARGUMENT;case xy.NOT_FOUND:return dp.NOT_FOUND;case xy.ALREADY_EXISTS:return dp.ALREADY_EXISTS;case xy.PERMISSION_DENIED:return dp.PERMISSION_DENIED;case xy.FAILED_PRECONDITION:return dp.FAILED_PRECONDITION;case xy.ABORTED:return dp.ABORTED;case xy.OUT_OF_RANGE:return dp.OUT_OF_RANGE;case xy.UNIMPLEMENTED:return dp.UNIMPLEMENTED;case xy.DATA_LOSS:return dp.DATA_LOSS;default:return cp()}}(Sy=xy||(xy={}))[Sy.OK=0]="OK",Sy[Sy.CANCELLED=1]="CANCELLED",Sy[Sy.UNKNOWN=2]="UNKNOWN",Sy[Sy.INVALID_ARGUMENT=3]="INVALID_ARGUMENT",Sy[Sy.DEADLINE_EXCEEDED=4]="DEADLINE_EXCEEDED",Sy[Sy.NOT_FOUND=5]="NOT_FOUND",Sy[Sy.ALREADY_EXISTS=6]="ALREADY_EXISTS",Sy[Sy.PERMISSION_DENIED=7]="PERMISSION_DENIED",Sy[Sy.UNAUTHENTICATED=16]="UNAUTHENTICATED",Sy[Sy.RESOURCE_EXHAUSTED=8]="RESOURCE_EXHAUSTED",Sy[Sy.FAILED_PRECONDITION=9]="FAILED_PRECONDITION",Sy[Sy.ABORTED=10]="ABORTED",Sy[Sy.OUT_OF_RANGE=11]="OUT_OF_RANGE",Sy[Sy.UNIMPLEMENTED=12]="UNIMPLEMENTED",Sy[Sy.INTERNAL=13]="INTERNAL",Sy[Sy.UNAVAILABLE=14]="UNAVAILABLE",Sy[Sy.DATA_LOSS=15]="DATA_LOSS";let ky=null;function Cy(){return new TextEncoder}const Iy=new Uf([4294967295,4294967295],0);function Ay(e){const t=Cy().encode(e),n=new Ff;return n.update(t),new Uint8Array(n.digest())}function Ny(e){const t=new DataView(e.buffer),n=t.getUint32(0,!0),i=t.getUint32(4,!0),r=t.getUint32(8,!0),o=t.getUint32(12,!0);return[new Uf([n,i],0),new Uf([r,o],0)]}class Oy{constructor(e,t,n){if(this.bitmap=e,this.padding=t,this.hashCount=n,t<0||t>=8)throw new Py("Invalid padding: ".concat(t));if(n<0)throw new Py("Invalid hash count: ".concat(n));if(e.length>0&&0===this.hashCount)throw new Py("Invalid hash count: ".concat(n));if(0===e.length&&0!==t)throw new Py("Invalid padding when bitmap length is 0: ".concat(t));this.Ie=8*e.length-t,this.Te=Uf.fromNumber(this.Ie)}Ee(e,t,n){let i=e.add(t.multiply(Uf.fromNumber(n)));return 1===i.compare(Iy)&&(i=new Uf([i.getBits(0),i.getBits(1)],0)),i.modulo(this.Te).toNumber()}de(e){return 0!=(this.bitmap[Math.floor(e/8)]&1<<e%8)}mightContain(e){if(0===this.Ie)return!1;const t=Ay(e),[n,i]=Ny(t);for(let r=0;r<this.hashCount;r++){const e=this.Ee(n,i,r);if(!this.de(e))return!1}return!0}static create(e,t,n){const i=e%8==0?0:8-e%8,r=new Uint8Array(Math.ceil(e/8)),o=new Oy(r,i,t);return n.forEach(e=>o.insert(e)),o}insert(e){if(0===this.Ie)return;const t=Ay(e),[n,i]=Ny(t);for(let r=0;r<this.hashCount;r++){const e=this.Ee(n,i,r);this.Ae(e)}}Ae(e){const t=Math.floor(e/8),n=e%8;this.bitmap[t]|=1<<n}}class Py extends Error{constructor(){super(...arguments),this.name="BloomFilterError"}}class Ry{constructor(e,t,n,i,r){this.snapshotVersion=e,this.targetChanges=t,this.targetMismatches=n,this.documentUpdates=i,this.resolvedLimboDocuments=r}static createSynthesizedRemoteEventForCurrentChange(e,t,n){const i=new Map;return i.set(e,Ly.createSynthesizedTargetChangeForCurrentChange(e,t,n)),new Ry(Cp.min(),i,new tm(Ep),Ag(),Bg())}}class Ly{constructor(e,t,n,i,r){this.resumeToken=e,this.current=t,this.addedDocuments=n,this.modifiedDocuments=i,this.removedDocuments=r}static createSynthesizedTargetChangeForCurrentChange(e,t,n){return new Ly(n,t,Bg(),Bg(),Bg())}}class zy{constructor(e,t,n,i){this.Re=e,this.removedTargetIds=t,this.key=n,this.Ve=i}}class My{constructor(e,t){this.targetId=e,this.me=t}}class Dy{constructor(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:cm.EMPTY_BYTE_STRING,i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null;this.state=e,this.targetIds=t,this.resumeToken=n,this.cause=i}}class By{constructor(){this.fe=0,this.ge=jy(),this.pe=cm.EMPTY_BYTE_STRING,this.ye=!1,this.we=!0}get current(){return this.ye}get resumeToken(){return this.pe}get Se(){return 0!==this.fe}get be(){return this.we}De(e){e.approximateByteSize()>0&&(this.we=!0,this.pe=e)}ve(){let e=Bg(),t=Bg(),n=Bg();return this.ge.forEach((i,r)=>{switch(r){case 0:e=e.add(i);break;case 2:t=t.add(i);break;case 1:n=n.add(i);break;default:cp()}}),new Ly(this.pe,this.ye,e,t,n)}Ce(){this.we=!1,this.ge=jy()}Fe(e,t){this.we=!0,this.ge=this.ge.insert(e,t)}Me(e){this.we=!0,this.ge=this.ge.remove(e)}xe(){this.fe+=1}Oe(){this.fe-=1,lp(this.fe>=0)}Ne(){this.we=!0,this.ye=!0}}class Uy{constructor(e){this.Le=e,this.Be=new Map,this.ke=Ag(),this.qe=Fy(),this.Qe=new tm(Ep)}Ke(e){for(const t of e.Re)e.Ve&&e.Ve.isFoundDocument()?this.$e(t,e.Ve):this.Ue(t,e.key,e.Ve);for(const t of e.removedTargetIds)this.Ue(t,e.key,e.Ve)}We(e){this.forEachTarget(e,t=>{const n=this.Ge(t);switch(e.state){case 0:this.ze(t)&&n.De(e.resumeToken);break;case 1:n.Oe(),n.Se||n.Ce(),n.De(e.resumeToken);break;case 2:n.Oe(),n.Se||this.removeTarget(t);break;case 3:this.ze(t)&&(n.Ne(),n.De(e.resumeToken));break;case 4:this.ze(t)&&(this.je(t),n.De(e.resumeToken));break;default:cp()}})}forEachTarget(e,t){e.targetIds.length>0?e.targetIds.forEach(t):this.Be.forEach((e,n)=>{this.ze(n)&&t(n)})}He(e){const t=e.targetId,n=e.me.count,i=this.Je(t);if(i){const r=i.target;if(ug(r))if(0===n){const e=new Pp(r.path);this.Ue(t,e,Dm.newNoDocument(e,Cp.min()))}else lp(1===n);else{const i=this.Ye(t);if(i!==n){const n=this.Ze(e),r=n?this.Xe(n,e,i):1;if(0!==r){this.je(t);const e=2===r?"TargetPurposeExistenceFilterMismatchBloom":"TargetPurposeExistenceFilterMismatch";this.Qe=this.Qe.insert(t,e)}null==ky||ky.et(function(e,t,n,i,r){var o,a,s,c,l,u;const d={localCacheCount:e,existenceFilterCount:t.count,databaseId:n.database,projectId:n.projectId},h=t.unchangedNames;return h&&(d.bloomFilter={applied:0===r,hashCount:null!==(o=null==h?void 0:h.hashCount)&&void 0!==o?o:0,bitmapLength:null!==(c=null===(s=null===(a=null==h?void 0:h.bits)||void 0===a?void 0:a.bitmap)||void 0===s?void 0:s.length)&&void 0!==c?c:0,padding:null!==(u=null===(l=null==h?void 0:h.bits)||void 0===l?void 0:l.padding)&&void 0!==u?u:0,mightContain:e=>{var t;return null!==(t=null==i?void 0:i.mightContain(e))&&void 0!==t&&t}}),d}(i,e.me,this.Le.tt(),n,r))}}}}Ze(e){const t=e.me.unchangedNames;if(!t||!t.bits)return null;const{bits:{bitmap:n="",padding:i=0},hashCount:r=0}=t;let o,a;try{o=hm(n).toUint8Array()}catch(e){if(e instanceof sm)return ap("Decoding the base64 bloom filter in existence filter failed ("+e.message+"); ignoring the bloom filter and falling back to full re-query."),null;throw e}try{a=new Oy(o,i,r)}catch(e){return ap(e instanceof Py?"BloomFilter error: ":"Applying bloom filter failed: ",e),null}return 0===a.Ie?null:a}Xe(e,t,n){return t.me.count===n-this.nt(e,t.targetId)?0:2}nt(e,t){const n=this.Le.getRemoteKeysForTarget(t);let i=0;return n.forEach(n=>{const r=this.Le.tt(),o="projects/".concat(r.projectId,"/databases/").concat(r.database,"/documents/").concat(n.path.canonicalString());e.mightContain(o)||(this.Ue(t,n,null),i++)}),i}rt(e){const t=new Map;this.Be.forEach((n,i)=>{const r=this.Je(i);if(r){if(n.current&&ug(r.target)){const t=new Pp(r.target.path);null!==this.ke.get(t)||this.it(i,t)||this.Ue(i,t,Dm.newNoDocument(t,e))}n.be&&(t.set(i,n.ve()),n.Ce())}});let n=Bg();this.qe.forEach((e,t)=>{let i=!0;t.forEachWhile(e=>{const t=this.Je(e);return!t||"TargetPurposeLimboResolution"===t.purpose||(i=!1,!1)}),i&&(n=n.add(e))}),this.ke.forEach((t,n)=>n.setReadTime(e));const i=new Ry(e,t,this.Qe,this.ke,n);return this.ke=Ag(),this.qe=Fy(),this.Qe=new tm(Ep),i}$e(e,t){if(!this.ze(e))return;const n=this.it(e,t.key)?2:0;this.Ge(e).Fe(t.key,n),this.ke=this.ke.insert(t.key,t),this.qe=this.qe.insert(t.key,this.st(t.key).add(e))}Ue(e,t,n){if(!this.ze(e))return;const i=this.Ge(e);this.it(e,t)?i.Fe(t,1):i.Me(t),this.qe=this.qe.insert(t,this.st(t).delete(e)),n&&(this.ke=this.ke.insert(t,n))}removeTarget(e){this.Be.delete(e)}Ye(e){const t=this.Ge(e).ve();return this.Le.getRemoteKeysForTarget(e).size+t.addedDocuments.size-t.removedDocuments.size}xe(e){this.Ge(e).xe()}Ge(e){let t=this.Be.get(e);return t||(t=new By,this.Be.set(e,t)),t}st(e){let t=this.qe.get(e);return t||(t=new rm(Ep),this.qe=this.qe.insert(e,t)),t}ze(e){const t=null!==this.Je(e);return t||rp("WatchChangeAggregator","Detected inactive target",e),t}Je(e){const t=this.Be.get(e);return t&&t.Se?null:this.Le.ot(e)}je(e){this.Be.set(e,new By),this.Le.getRemoteKeysForTarget(e).forEach(t=>{this.Ue(e,t,null)})}it(e,t){return this.Le.getRemoteKeysForTarget(e).has(t)}}function Fy(){return new tm(Pp.comparator)}function jy(){return new tm(Pp.comparator)}const Vy={asc:"ASCENDING",desc:"DESCENDING"},qy={"<":"LESS_THAN","<=":"LESS_THAN_OR_EQUAL",">":"GREATER_THAN",">=":"GREATER_THAN_OR_EQUAL","==":"EQUAL","!=":"NOT_EQUAL","array-contains":"ARRAY_CONTAINS",in:"IN","not-in":"NOT_IN","array-contains-any":"ARRAY_CONTAINS_ANY"},Hy={and:"AND",or:"OR"};class Wy{constructor(e,t){this.databaseId=e,this.useProto3Json=t}}function Gy(e,t){return e.useProto3Json||Wp(t)?t:{value:t}}function Ky(e,t){return e.useProto3Json?"".concat(new Date(1e3*t.seconds).toISOString().replace(/\.\d*/,"").replace("Z",""),".").concat(("000000000"+t.nanoseconds).slice(-9),"Z"):{seconds:""+t.seconds,nanos:t.nanoseconds}}function Zy(e,t){return e.useProto3Json?t.toBase64():t.toUint8Array()}function Qy(e,t){return Ky(e,t.toTimestamp())}function Xy(e){return lp(!!e),Cp.fromTimestamp(function(e){const t=um(e);return new kp(t.seconds,t.nanos)}(e))}function Yy(e,t){return Jy(e,t).canonicalString()}function Jy(e,t){const n=function(e){return new Ap(["projects",e.projectId,"databases",e.database])}(e).child("documents");return void 0===t?n:n.child(t)}function $y(e){const t=Ap.fromString(e);return lp(_v(t)),t}function ev(e,t){return Yy(e.databaseId,t.path)}function tv(e,t){const n=$y(t);if(n.get(1)!==e.databaseId.projectId)throw new hp(dp.INVALID_ARGUMENT,"Tried to deserialize key from different project: "+n.get(1)+" vs "+e.databaseId.projectId);if(n.get(3)!==e.databaseId.database)throw new hp(dp.INVALID_ARGUMENT,"Tried to deserialize key from different database: "+n.get(3)+" vs "+e.databaseId.database);return new Pp(ov(n))}function nv(e,t){return Yy(e.databaseId,t)}function iv(e){const t=$y(e);return 4===t.length?Ap.emptyPath():ov(t)}function rv(e){return new Ap(["projects",e.databaseId.projectId,"databases",e.databaseId.database]).canonicalString()}function ov(e){return lp(e.length>4&&"documents"===e.get(4)),e.popFirst(5)}function av(e,t,n){return{name:ev(e,t),fields:n.value.mapValue.fields}}function sv(e,t){let n;if(t instanceof dy)n={update:av(e,t.key,t.value)};else if(t instanceof gy)n={delete:ev(e,t.key)};else if(t instanceof hy)n={update:av(e,t.key,t.data),updateMask:vv(t.fieldMask)};else{if(!(t instanceof yy))return cp();n={verify:ev(e,t.key)}}return t.fieldTransforms.length>0&&(n.updateTransforms=t.fieldTransforms.map(e=>function(e,t){const n=t.transform;if(n instanceof Zg)return{fieldPath:t.field.canonicalString(),setToServerValue:"REQUEST_TIME"};if(n instanceof Qg)return{fieldPath:t.field.canonicalString(),appendMissingElements:{values:n.elements}};if(n instanceof Yg)return{fieldPath:t.field.canonicalString(),removeAllFromArray:{values:n.elements}};if(n instanceof $g)return{fieldPath:t.field.canonicalString(),increment:n.Pe};throw cp()}(0,e))),t.precondition.isNone||(n.currentDocument=function(e,t){return void 0!==t.updateTime?{updateTime:Qy(e,t.updateTime)}:void 0!==t.exists?{exists:t.exists}:cp()}(e,t.precondition)),n}function cv(e,t){return{documents:[nv(e,t.path)]}}function lv(e,t){const n={structuredQuery:{}},i=t.path;let r;null!==t.collectionGroup?(r=i,n.structuredQuery.from=[{collectionId:t.collectionGroup,allDescendants:!0}]):(r=i.popLast(),n.structuredQuery.from=[{collectionId:i.lastSegment()}]),n.parent=nv(e,r);const o=function(e){if(0!==e.length)return yv(Wm.create(e,"and"))}(t.filters);o&&(n.structuredQuery.where=o);const a=function(e){if(0!==e.length)return e.map(e=>function(e){return{field:mv(e.field),direction:hv(e.dir)}}(e))}(t.orderBy);a&&(n.structuredQuery.orderBy=a);const s=Gy(e,t.limit);return null!==s&&(n.structuredQuery.limit=s),t.startAt&&(n.structuredQuery.startAt=function(e){return{before:e.inclusive,values:e.position}}(t.startAt)),t.endAt&&(n.structuredQuery.endAt=function(e){return{before:!e.inclusive,values:e.position}}(t.endAt)),{_t:n,parent:r}}function uv(e){let t=iv(e.parent);const n=e.structuredQuery,i=n.from?n.from.length:0;let r=null;if(i>0){lp(1===i);const e=n.from[0];e.allDescendants?r=e.collectionId:t=t.child(e.collectionId)}let o=[];n.where&&(o=function(e){const t=dv(e);return t instanceof Wm&&Km(t)?t.getFilters():[t]}(n.where));let a=[];n.orderBy&&(a=function(e){return e.map(e=>function(e){return new jm(gv(e.field),function(e){switch(e){case"ASCENDING":return"asc";case"DESCENDING":return"desc";default:return}}(e.direction))}(e))}(n.orderBy));let s=null;n.limit&&(s=function(e){let t;return t="object"==typeof e?e.value:e,Wp(t)?null:t}(n.limit));let c=null;n.startAt&&(c=function(e){const t=!!e.before,n=e.values||[];return new Bm(n,t)}(n.startAt));let l=null;return n.endAt&&(l=function(e){const t=!e.before,n=e.values||[];return new Bm(n,t)}(n.endAt)),hg(t,r,a,o,s,"F",c,l)}function dv(e){return void 0!==e.unaryFilter?function(e){switch(e.unaryFilter.op){case"IS_NAN":const t=gv(e.unaryFilter.field);return Hm.create(t,"==",{doubleValue:NaN});case"IS_NULL":const n=gv(e.unaryFilter.field);return Hm.create(n,"==",{nullValue:"NULL_VALUE"});case"IS_NOT_NAN":const i=gv(e.unaryFilter.field);return Hm.create(i,"!=",{doubleValue:NaN});case"IS_NOT_NULL":const r=gv(e.unaryFilter.field);return Hm.create(r,"!=",{nullValue:"NULL_VALUE"});default:return cp()}}(e):void 0!==e.fieldFilter?function(e){return Hm.create(gv(e.fieldFilter.field),function(e){switch(e){case"EQUAL":return"==";case"NOT_EQUAL":return"!=";case"GREATER_THAN":return">";case"GREATER_THAN_OR_EQUAL":return">=";case"LESS_THAN":return"<";case"LESS_THAN_OR_EQUAL":return"<=";case"ARRAY_CONTAINS":return"array-contains";case"IN":return"in";case"NOT_IN":return"not-in";case"ARRAY_CONTAINS_ANY":return"array-contains-any";default:return cp()}}(e.fieldFilter.op),e.fieldFilter.value)}(e):void 0!==e.compositeFilter?function(e){return Wm.create(e.compositeFilter.filters.map(e=>dv(e)),function(e){switch(e){case"AND":return"and";case"OR":return"or";default:return cp()}}(e.compositeFilter.op))}(e):cp()}function hv(e){return Vy[e]}function fv(e){return qy[e]}function pv(e){return Hy[e]}function mv(e){return{fieldPath:e.canonicalString()}}function gv(e){return Op.fromServerFormat(e.fieldPath)}function yv(e){return e instanceof Hm?function(e){if("=="===e.op){if(Nm(e.value))return{unaryFilter:{field:mv(e.field),op:"IS_NAN"}};if(Am(e.value))return{unaryFilter:{field:mv(e.field),op:"IS_NULL"}}}else if("!="===e.op){if(Nm(e.value))return{unaryFilter:{field:mv(e.field),op:"IS_NOT_NAN"}};if(Am(e.value))return{unaryFilter:{field:mv(e.field),op:"IS_NOT_NULL"}}}return{fieldFilter:{field:mv(e.field),op:fv(e.op),value:e.value}}}(e):e instanceof Wm?function(e){const t=e.getFilters().map(e=>yv(e));return 1===t.length?t[0]:{compositeFilter:{op:pv(e.op),filters:t}}}(e):cp()}function vv(e){const t=[];return e.fields.forEach(e=>t.push(e.canonicalString())),{fieldPaths:t}}function _v(e){return e.length>=4&&"projects"===e.get(0)&&"databases"===e.get(2)}class wv{constructor(e,t,n,i){let r=arguments.length>4&&void 0!==arguments[4]?arguments[4]:Cp.min(),o=arguments.length>5&&void 0!==arguments[5]?arguments[5]:Cp.min(),a=arguments.length>6&&void 0!==arguments[6]?arguments[6]:cm.EMPTY_BYTE_STRING,s=arguments.length>7&&void 0!==arguments[7]?arguments[7]:null;this.target=e,this.targetId=t,this.purpose=n,this.sequenceNumber=i,this.snapshotVersion=r,this.lastLimboFreeSnapshotVersion=o,this.resumeToken=a,this.expectedCount=s}withSequenceNumber(e){return new wv(this.target,this.targetId,this.purpose,e,this.snapshotVersion,this.lastLimboFreeSnapshotVersion,this.resumeToken,this.expectedCount)}withResumeToken(e,t){return new wv(this.target,this.targetId,this.purpose,this.sequenceNumber,t,this.lastLimboFreeSnapshotVersion,e,null)}withExpectedCount(e){return new wv(this.target,this.targetId,this.purpose,this.sequenceNumber,this.snapshotVersion,this.lastLimboFreeSnapshotVersion,this.resumeToken,e)}withLastLimboFreeSnapshotVersion(e){return new wv(this.target,this.targetId,this.purpose,this.sequenceNumber,this.snapshotVersion,e,this.resumeToken,this.expectedCount)}}class bv{constructor(e){this.ct=e}}function xv(e){const t=uv({parent:e.parent,structuredQuery:e.structuredQuery});return"LAST"===e.limitType?_g(t,t.limit,"L"):t}class Sv{constructor(){}It(e,t){this.Tt(e,t),t.Et()}Tt(e,t){if("nullValue"in e)this.dt(t,5);else if("booleanValue"in e)this.dt(t,10),t.At(e.booleanValue?1:0);else if("integerValue"in e)this.dt(t,15),t.At(dm(e.integerValue));else if("doubleValue"in e){const n=dm(e.doubleValue);isNaN(n)?this.dt(t,13):(this.dt(t,15),Gp(n)?t.At(0):t.At(n))}else if("timestampValue"in e){let n=e.timestampValue;this.dt(t,20),"string"==typeof n&&(n=um(n)),t.Rt("".concat(n.seconds||"")),t.At(n.nanos||0)}else if("stringValue"in e)this.Vt(e.stringValue,t),this.ft(t);else if("bytesValue"in e)this.dt(t,30),t.gt(hm(e.bytesValue)),this.ft(t);else if("referenceValue"in e)this.yt(e.referenceValue,t);else if("geoPointValue"in e){const n=e.geoPointValue;this.dt(t,45),t.At(n.latitude||0),t.At(n.longitude||0)}else"mapValue"in e?Lm(e)?this.dt(t,Number.MAX_SAFE_INTEGER):Pm(e)?this.wt(e.mapValue,t):(this.St(e.mapValue,t),this.ft(t)):"arrayValue"in e?(this.bt(e.arrayValue,t),this.ft(t)):cp()}Vt(e,t){this.dt(t,25),this.Dt(e,t)}Dt(e,t){t.Rt(e)}St(e,t){const n=e.fields||{};this.dt(t,55);for(const i of Object.keys(n))this.Vt(i,t),this.Tt(n[i],t)}wt(e,t){var n,i;const r=e.fields||{};this.dt(t,53);const o="value",a=(null===(i=null===(n=r[o].arrayValue)||void 0===n?void 0:n.values)||void 0===i?void 0:i.length)||0;this.dt(t,15),t.At(dm(a)),this.Vt(o,t),this.Tt(r[o],t)}bt(e,t){const n=e.values||[];this.dt(t,50);for(const i of n)this.Tt(i,t)}yt(e,t){this.dt(t,37),Pp.fromName(e).path.forEach(e=>{this.dt(t,60),this.Dt(e,t)})}dt(e,t){e.At(t)}ft(e){e.At(2)}}Sv.vt=new Sv;class Ev{constructor(){this.un=new Tv}addToCollectionParentIndex(e,t){return this.un.add(t),jp.resolve()}getCollectionParents(e,t){return jp.resolve(this.un.getEntries(t))}addFieldIndex(e,t){return jp.resolve()}deleteFieldIndex(e,t){return jp.resolve()}deleteAllFieldIndexes(e){return jp.resolve()}createTargetIndexes(e,t){return jp.resolve()}getDocumentsMatchingTarget(e,t){return jp.resolve(null)}getIndexType(e,t){return jp.resolve(0)}getFieldIndexes(e,t){return jp.resolve([])}getNextCollectionGroupToUpdate(e){return jp.resolve(null)}getMinOffset(e,t){return jp.resolve(Mp.min())}getMinOffsetFromCollectionGroup(e,t){return jp.resolve(Mp.min())}updateCollectionGroup(e,t,n){return jp.resolve()}updateIndexEntries(e,t){return jp.resolve()}}class Tv{constructor(){this.index={}}add(e){const t=e.lastSegment(),n=e.popLast(),i=this.index[t]||new rm(Ap.comparator),r=!i.has(n);return this.index[t]=i.add(n),r}has(e){const t=e.lastSegment(),n=e.popLast(),i=this.index[t];return i&&i.has(n)}getEntries(e){return(this.index[e]||new rm(Ap.comparator)).toArray()}}new Uint8Array(0);class kv{constructor(e,t,n){this.cacheSizeCollectionThreshold=e,this.percentileToCollect=t,this.maximumSequenceNumbersToCollect=n}static withCacheSize(e){return new kv(e,kv.DEFAULT_COLLECTION_PERCENTILE,kv.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT)}}kv.DEFAULT_COLLECTION_PERCENTILE=10,kv.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT=1e3,kv.DEFAULT=new kv(41943040,kv.DEFAULT_COLLECTION_PERCENTILE,kv.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT),kv.DISABLED=new kv(-1,0,0);class Cv{constructor(e){this.Ln=e}next(){return this.Ln+=2,this.Ln}static Bn(){return new Cv(0)}static kn(){return new Cv(-1)}}class Iv{constructor(){this.changes=new Cg(e=>e.toString(),(e,t)=>e.isEqual(t)),this.changesApplied=!1}addEntry(e){this.assertNotApplied(),this.changes.set(e.key,e)}removeEntry(e,t){this.assertNotApplied(),this.changes.set(e,Dm.newInvalidDocument(e).setReadTime(t))}getEntry(e,t){this.assertNotApplied();const n=this.changes.get(t);return void 0!==n?jp.resolve(n):this.getFromCache(e,t)}getEntries(e,t){return this.getAllFromCache(e,t)}apply(e){return this.assertNotApplied(),this.changesApplied=!0,this.applyChanges(e)}assertNotApplied(){}}class Av{constructor(e,t){this.overlayedDocument=e,this.mutatedFields=t}}class Nv{constructor(e,t,n,i){this.remoteDocumentCache=e,this.mutationQueue=t,this.documentOverlayCache=n,this.indexManager=i}getDocument(e,t){let n=null;return this.documentOverlayCache.getOverlay(e,t).next(i=>(n=i,this.remoteDocumentCache.getEntry(e,t))).next(e=>(null!==n&&cy(n.mutation,e,am.empty(),kp.now()),e))}getDocuments(e,t){return this.remoteDocumentCache.getEntries(e,t).next(t=>this.getLocalViewOfDocuments(e,t,Bg()).next(()=>t))}getLocalViewOfDocuments(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:Bg();const i=Rg();return this.populateOverlays(e,i,t).next(()=>this.computeViews(e,t,i,n).next(e=>{let t=Og();return e.forEach((e,n)=>{t=t.insert(e,n.overlayedDocument)}),t}))}getOverlayedDocuments(e,t){const n=Rg();return this.populateOverlays(e,n,t).next(()=>this.computeViews(e,t,n,Bg()))}populateOverlays(e,t,n){const i=[];return n.forEach(e=>{t.has(e)||i.push(e)}),this.documentOverlayCache.getOverlays(e,i).next(e=>{e.forEach((e,n)=>{t.set(e,n)})})}computeViews(e,t,n,i){let r=Ag();const o=zg(),a=zg();return t.forEach((e,t)=>{const a=n.get(t.key);i.has(t.key)&&(void 0===a||a.mutation instanceof hy)?r=r.insert(t.key,t):void 0!==a?(o.set(t.key,a.mutation.getFieldMask()),cy(a.mutation,t,a.mutation.getFieldMask(),kp.now())):o.set(t.key,am.empty())}),this.recalculateAndSaveOverlays(e,r).next(e=>(e.forEach((e,t)=>o.set(e,t)),t.forEach((e,t)=>{var n;return a.set(e,new Av(t,null!==(n=o.get(e))&&void 0!==n?n:null))}),a))}recalculateAndSaveOverlays(e,t){const n=zg();let i=new tm((e,t)=>e-t),r=Bg();return this.mutationQueue.getAllMutationBatchesAffectingDocumentKeys(e,t).next(e=>{for(const r of e)r.keys().forEach(e=>{const o=t.get(e);if(null===o)return;let a=n.get(e)||am.empty();a=r.applyToLocalView(o,a),n.set(e,a);const s=(i.get(r.batchId)||Bg()).add(e);i=i.insert(r.batchId,s)})}).next(()=>{const o=[],a=i.getReverseIterator();for(;a.hasNext();){const i=a.getNext(),s=i.key,c=i.value,l=Lg();c.forEach(e=>{if(!r.has(e)){const i=ay(t.get(e),n.get(e));null!==i&&l.set(e,i),r=r.add(e)}}),o.push(this.documentOverlayCache.saveOverlays(e,s,l))}return jp.waitFor(o)}).next(()=>n)}recalculateAndSaveOverlaysForDocumentKeys(e,t){return this.remoteDocumentCache.getEntries(e,t).next(t=>this.recalculateAndSaveOverlays(e,t))}getDocumentsMatchingQuery(e,t,n,i){return function(e){return Pp.isDocumentKey(e.path)&&null===e.collectionGroup&&0===e.filters.length}(t)?this.getDocumentsMatchingDocumentQuery(e,t.path):mg(t)?this.getDocumentsMatchingCollectionGroupQuery(e,t,n,i):this.getDocumentsMatchingCollectionQuery(e,t,n,i)}getNextDocuments(e,t,n,i){return this.remoteDocumentCache.getAllFromCollectionGroup(e,t,n,i).next(r=>{const o=i-r.size>0?this.documentOverlayCache.getOverlaysForCollectionGroup(e,t,n.largestBatchId,i-r.size):jp.resolve(Rg());let a=-1,s=r;return o.next(t=>jp.forEach(t,(t,n)=>(a<n.largestBatchId&&(a=n.largestBatchId),r.get(t)?jp.resolve():this.remoteDocumentCache.getEntry(e,t).next(e=>{s=s.insert(t,e)}))).next(()=>this.populateOverlays(e,t,r)).next(()=>this.computeViews(e,s,t,Bg())).next(e=>({batchId:a,changes:Pg(e)})))})}getDocumentsMatchingDocumentQuery(e,t){return this.getDocument(e,new Pp(t)).next(e=>{let t=Og();return e.isFoundDocument()&&(t=t.insert(e.key,e)),t})}getDocumentsMatchingCollectionGroupQuery(e,t,n,i){const r=t.collectionGroup;let o=Og();return this.indexManager.getCollectionParents(e,r).next(a=>jp.forEach(a,a=>{const s=function(e,t){return new dg(t,null,e.explicitOrderBy.slice(),e.filters.slice(),e.limit,e.limitType,e.startAt,e.endAt)}(t,a.child(r));return this.getDocumentsMatchingCollectionQuery(e,s,n,i).next(e=>{e.forEach((e,t)=>{o=o.insert(e,t)})})}).next(()=>o))}getDocumentsMatchingCollectionQuery(e,t,n,i){let r;return this.documentOverlayCache.getOverlaysForCollection(e,t.path,n.largestBatchId).next(o=>(r=o,this.remoteDocumentCache.getDocumentsMatchingQuery(e,t,n,r,i))).next(e=>{r.forEach((t,n)=>{const i=n.getKey();null===e.get(i)&&(e=e.insert(i,Dm.newInvalidDocument(i)))});let n=Og();return e.forEach((e,i)=>{const o=r.get(e);void 0!==o&&cy(o.mutation,i,am.empty(),kp.now()),Sg(t,i)&&(n=n.insert(e,i))}),n})}}class Ov{constructor(e){this.serializer=e,this.hr=new Map,this.Pr=new Map}getBundleMetadata(e,t){return jp.resolve(this.hr.get(t))}saveBundleMetadata(e,t){return this.hr.set(t.id,function(e){return{id:e.id,version:e.version,createTime:Xy(e.createTime)}}(t)),jp.resolve()}getNamedQuery(e,t){return jp.resolve(this.Pr.get(t))}saveNamedQuery(e,t){return this.Pr.set(t.name,function(e){return{name:e.name,query:xv(e.bundledQuery),readTime:Xy(e.readTime)}}(t)),jp.resolve()}}class Pv{constructor(){this.overlays=new tm(Pp.comparator),this.Ir=new Map}getOverlay(e,t){return jp.resolve(this.overlays.get(t))}getOverlays(e,t){const n=Rg();return jp.forEach(t,t=>this.getOverlay(e,t).next(e=>{null!==e&&n.set(t,e)})).next(()=>n)}saveOverlays(e,t,n){return n.forEach((n,i)=>{this.ht(e,t,i)}),jp.resolve()}removeOverlaysForBatchId(e,t,n){const i=this.Ir.get(n);return void 0!==i&&(i.forEach(e=>this.overlays=this.overlays.remove(e)),this.Ir.delete(n)),jp.resolve()}getOverlaysForCollection(e,t,n){const i=Rg(),r=t.length+1,o=new Pp(t.child("")),a=this.overlays.getIteratorFrom(o);for(;a.hasNext();){const e=a.getNext().value,o=e.getKey();if(!t.isPrefixOf(o.path))break;o.path.length===r&&e.largestBatchId>n&&i.set(e.getKey(),e)}return jp.resolve(i)}getOverlaysForCollectionGroup(e,t,n,i){let r=new tm((e,t)=>e-t);const o=this.overlays.getIterator();for(;o.hasNext();){const e=o.getNext().value;if(e.getKey().getCollectionGroup()===t&&e.largestBatchId>n){let t=r.get(e.largestBatchId);null===t&&(t=Rg(),r=r.insert(e.largestBatchId,t)),t.set(e.getKey(),e)}}const a=Rg(),s=r.getIterator();for(;s.hasNext()&&(s.getNext().value.forEach((e,t)=>a.set(e,t)),!(a.size()>=i)););return jp.resolve(a)}ht(e,t,n){const i=this.overlays.get(n.key);if(null!==i){const e=this.Ir.get(i.largestBatchId).delete(n.key);this.Ir.set(i.largestBatchId,e)}this.overlays=this.overlays.insert(n.key,new wy(t,n));let r=this.Ir.get(t);void 0===r&&(r=Bg(),this.Ir.set(t,r)),this.Ir.set(t,r.add(n.key))}}class Rv{constructor(){this.sessionToken=cm.EMPTY_BYTE_STRING}getSessionToken(e){return jp.resolve(this.sessionToken)}setSessionToken(e,t){return this.sessionToken=t,jp.resolve()}}class Lv{constructor(){this.Tr=new rm(zv.Er),this.dr=new rm(zv.Ar)}isEmpty(){return this.Tr.isEmpty()}addReference(e,t){const n=new zv(e,t);this.Tr=this.Tr.add(n),this.dr=this.dr.add(n)}Rr(e,t){e.forEach(e=>this.addReference(e,t))}removeReference(e,t){this.Vr(new zv(e,t))}mr(e,t){e.forEach(e=>this.removeReference(e,t))}gr(e){const t=new Pp(new Ap([])),n=new zv(t,e),i=new zv(t,e+1),r=[];return this.dr.forEachInRange([n,i],e=>{this.Vr(e),r.push(e.key)}),r}pr(){this.Tr.forEach(e=>this.Vr(e))}Vr(e){this.Tr=this.Tr.delete(e),this.dr=this.dr.delete(e)}yr(e){const t=new Pp(new Ap([])),n=new zv(t,e),i=new zv(t,e+1);let r=Bg();return this.dr.forEachInRange([n,i],e=>{r=r.add(e.key)}),r}containsKey(e){const t=new zv(e,0),n=this.Tr.firstAfterOrEqual(t);return null!==n&&e.isEqual(n.key)}}class zv{constructor(e,t){this.key=e,this.wr=t}static Er(e,t){return Pp.comparator(e.key,t.key)||Ep(e.wr,t.wr)}static Ar(e,t){return Ep(e.wr,t.wr)||Pp.comparator(e.key,t.key)}}class Mv{constructor(e,t){this.indexManager=e,this.referenceDelegate=t,this.mutationQueue=[],this.Sr=1,this.br=new rm(zv.Er)}checkEmpty(e){return jp.resolve(0===this.mutationQueue.length)}addMutationBatch(e,t,n,i){const r=this.Sr;this.Sr++,this.mutationQueue.length>0&&this.mutationQueue[this.mutationQueue.length-1];const o=new vy(r,t,n,i);this.mutationQueue.push(o);for(const a of i)this.br=this.br.add(new zv(a.key,r)),this.indexManager.addToCollectionParentIndex(e,a.key.path.popLast());return jp.resolve(o)}lookupMutationBatch(e,t){return jp.resolve(this.Dr(t))}getNextMutationBatchAfterBatchId(e,t){const n=t+1,i=this.vr(n),r=i<0?0:i;return jp.resolve(this.mutationQueue.length>r?this.mutationQueue[r]:null)}getHighestUnacknowledgedBatchId(){return jp.resolve(0===this.mutationQueue.length?-1:this.Sr-1)}getAllMutationBatches(e){return jp.resolve(this.mutationQueue.slice())}getAllMutationBatchesAffectingDocumentKey(e,t){const n=new zv(t,0),i=new zv(t,Number.POSITIVE_INFINITY),r=[];return this.br.forEachInRange([n,i],e=>{const t=this.Dr(e.wr);r.push(t)}),jp.resolve(r)}getAllMutationBatchesAffectingDocumentKeys(e,t){let n=new rm(Ep);return t.forEach(e=>{const t=new zv(e,0),i=new zv(e,Number.POSITIVE_INFINITY);this.br.forEachInRange([t,i],e=>{n=n.add(e.wr)})}),jp.resolve(this.Cr(n))}getAllMutationBatchesAffectingQuery(e,t){const n=t.path,i=n.length+1;let r=n;Pp.isDocumentKey(r)||(r=r.child(""));const o=new zv(new Pp(r),0);let a=new rm(Ep);return this.br.forEachWhile(e=>{const t=e.key.path;return!!n.isPrefixOf(t)&&(t.length===i&&(a=a.add(e.wr)),!0)},o),jp.resolve(this.Cr(a))}Cr(e){const t=[];return e.forEach(e=>{const n=this.Dr(e);null!==n&&t.push(n)}),t}removeMutationBatch(e,t){lp(0===this.Fr(t.batchId,"removed")),this.mutationQueue.shift();let n=this.br;return jp.forEach(t.mutations,i=>{const r=new zv(i.key,t.batchId);return n=n.delete(r),this.referenceDelegate.markPotentiallyOrphaned(e,i.key)}).next(()=>{this.br=n})}On(e){}containsKey(e,t){const n=new zv(t,0),i=this.br.firstAfterOrEqual(n);return jp.resolve(t.isEqual(i&&i.key))}performConsistencyCheck(e){return this.mutationQueue.length,jp.resolve()}Fr(e,t){return this.vr(e)}vr(e){return 0===this.mutationQueue.length?0:e-this.mutationQueue[0].batchId}Dr(e){const t=this.vr(e);return t<0||t>=this.mutationQueue.length?null:this.mutationQueue[t]}}class Dv{constructor(e){this.Mr=e,this.docs=new tm(Pp.comparator),this.size=0}setIndexManager(e){this.indexManager=e}addEntry(e,t){const n=t.key,i=this.docs.get(n),r=i?i.size:0,o=this.Mr(t);return this.docs=this.docs.insert(n,{document:t.mutableCopy(),size:o}),this.size+=o-r,this.indexManager.addToCollectionParentIndex(e,n.path.popLast())}removeEntry(e){const t=this.docs.get(e);t&&(this.docs=this.docs.remove(e),this.size-=t.size)}getEntry(e,t){const n=this.docs.get(t);return jp.resolve(n?n.document.mutableCopy():Dm.newInvalidDocument(t))}getEntries(e,t){let n=Ag();return t.forEach(e=>{const t=this.docs.get(e);n=n.insert(e,t?t.document.mutableCopy():Dm.newInvalidDocument(e))}),jp.resolve(n)}getDocumentsMatchingQuery(e,t,n,i){let r=Ag();const o=t.path,a=new Pp(o.child("")),s=this.docs.getIteratorFrom(a);for(;s.hasNext();){const{key:e,value:{document:a}}=s.getNext();if(!o.isPrefixOf(e.path))break;e.path.length>o.length+1||Dp(zp(a),n)<=0||(i.has(a.key)||Sg(t,a))&&(r=r.insert(a.key,a.mutableCopy()))}return jp.resolve(r)}getAllFromCollectionGroup(e,t,n,i){cp()}Or(e,t){return jp.forEach(this.docs,e=>t(e))}newChangeBuffer(e){return new Bv(this)}getSize(e){return jp.resolve(this.size)}}class Bv extends Iv{constructor(e){super(),this.cr=e}applyChanges(e){const t=[];return this.changes.forEach((n,i)=>{i.isValidDocument()?t.push(this.cr.addEntry(e,i)):this.cr.removeEntry(n)}),jp.waitFor(t)}getFromCache(e,t){return this.cr.getEntry(e,t)}getAllFromCache(e,t){return this.cr.getEntries(e,t)}}class Uv{constructor(e){this.persistence=e,this.Nr=new Cg(e=>cg(e),lg),this.lastRemoteSnapshotVersion=Cp.min(),this.highestTargetId=0,this.Lr=0,this.Br=new Lv,this.targetCount=0,this.kr=Cv.Bn()}forEachTarget(e,t){return this.Nr.forEach((e,n)=>t(n)),jp.resolve()}getLastRemoteSnapshotVersion(e){return jp.resolve(this.lastRemoteSnapshotVersion)}getHighestSequenceNumber(e){return jp.resolve(this.Lr)}allocateTargetId(e){return this.highestTargetId=this.kr.next(),jp.resolve(this.highestTargetId)}setTargetsMetadata(e,t,n){return n&&(this.lastRemoteSnapshotVersion=n),t>this.Lr&&(this.Lr=t),jp.resolve()}Kn(e){this.Nr.set(e.target,e);const t=e.targetId;t>this.highestTargetId&&(this.kr=new Cv(t),this.highestTargetId=t),e.sequenceNumber>this.Lr&&(this.Lr=e.sequenceNumber)}addTargetData(e,t){return this.Kn(t),this.targetCount+=1,jp.resolve()}updateTargetData(e,t){return this.Kn(t),jp.resolve()}removeTargetData(e,t){return this.Nr.delete(t.target),this.Br.gr(t.targetId),this.targetCount-=1,jp.resolve()}removeTargets(e,t,n){let i=0;const r=[];return this.Nr.forEach((o,a)=>{a.sequenceNumber<=t&&null===n.get(a.targetId)&&(this.Nr.delete(o),r.push(this.removeMatchingKeysForTargetId(e,a.targetId)),i++)}),jp.waitFor(r).next(()=>i)}getTargetCount(e){return jp.resolve(this.targetCount)}getTargetData(e,t){const n=this.Nr.get(t)||null;return jp.resolve(n)}addMatchingKeys(e,t,n){return this.Br.Rr(t,n),jp.resolve()}removeMatchingKeys(e,t,n){this.Br.mr(t,n);const i=this.persistence.referenceDelegate,r=[];return i&&t.forEach(t=>{r.push(i.markPotentiallyOrphaned(e,t))}),jp.waitFor(r)}removeMatchingKeysForTargetId(e,t){return this.Br.gr(t),jp.resolve()}getMatchingKeysForTargetId(e,t){const n=this.Br.yr(t);return jp.resolve(n)}containsKey(e,t){return jp.resolve(this.Br.containsKey(t))}}class Fv{constructor(e,t){this.qr={},this.overlays={},this.Qr=new Hp(0),this.Kr=!1,this.Kr=!0,this.$r=new Rv,this.referenceDelegate=e(this),this.Ur=new Uv(this),this.indexManager=new Ev,this.remoteDocumentCache=function(e){return new Dv(e)}(e=>this.referenceDelegate.Wr(e)),this.serializer=new bv(t),this.Gr=new Ov(this.serializer)}start(){return Promise.resolve()}shutdown(){return this.Kr=!1,Promise.resolve()}get started(){return this.Kr}setDatabaseDeletedListener(){}setNetworkEnabled(){}getIndexManager(e){return this.indexManager}getDocumentOverlayCache(e){let t=this.overlays[e.toKey()];return t||(t=new Pv,this.overlays[e.toKey()]=t),t}getMutationQueue(e,t){let n=this.qr[e.toKey()];return n||(n=new Mv(t,this.referenceDelegate),this.qr[e.toKey()]=n),n}getGlobalsCache(){return this.$r}getTargetCache(){return this.Ur}getRemoteDocumentCache(){return this.remoteDocumentCache}getBundleCache(){return this.Gr}runTransaction(e,t,n){rp("MemoryPersistence","Starting transaction:",e);const i=new jv(this.Qr.next());return this.referenceDelegate.zr(),n(i).next(e=>this.referenceDelegate.jr(i).next(()=>e)).toPromise().then(e=>(i.raiseOnCommittedEvent(),e))}Hr(e,t){return jp.or(Object.values(this.qr).map(n=>()=>n.containsKey(e,t)))}}class jv extends Up{constructor(e){super(),this.currentSequenceNumber=e}}class Vv{constructor(e){this.persistence=e,this.Jr=new Lv,this.Yr=null}static Zr(e){return new Vv(e)}get Xr(){if(this.Yr)return this.Yr;throw cp()}addReference(e,t,n){return this.Jr.addReference(n,t),this.Xr.delete(n.toString()),jp.resolve()}removeReference(e,t,n){return this.Jr.removeReference(n,t),this.Xr.add(n.toString()),jp.resolve()}markPotentiallyOrphaned(e,t){return this.Xr.add(t.toString()),jp.resolve()}removeTarget(e,t){this.Jr.gr(t.targetId).forEach(e=>this.Xr.add(e.toString()));const n=this.persistence.getTargetCache();return n.getMatchingKeysForTargetId(e,t.targetId).next(e=>{e.forEach(e=>this.Xr.add(e.toString()))}).next(()=>n.removeTargetData(e,t))}zr(){this.Yr=new Set}jr(e){const t=this.persistence.getRemoteDocumentCache().newChangeBuffer();return jp.forEach(this.Xr,n=>{const i=Pp.fromPath(n);return this.ei(e,i).next(e=>{e||t.removeEntry(i,Cp.min())})}).next(()=>(this.Yr=null,t.apply(e)))}updateLimboDocument(e,t){return this.ei(e,t).next(e=>{e?this.Xr.delete(t.toString()):this.Xr.add(t.toString())})}Wr(e){return 0}ei(e,t){return jp.or([()=>jp.resolve(this.Jr.containsKey(t)),()=>this.persistence.getTargetCache().containsKey(e,t),()=>this.persistence.Hr(e,t)])}}class qv{constructor(e,t,n,i){this.targetId=e,this.fromCache=t,this.$i=n,this.Ui=i}static Wi(e,t){let n=Bg(),i=Bg();for(const r of t.docChanges)switch(r.type){case 0:n=n.add(r.doc.key);break;case 1:i=i.add(r.doc.key)}return new qv(e,t.fromCache,n,i)}}class Hv{constructor(){this._documentReadCount=0}get documentReadCount(){return this._documentReadCount}incrementDocumentReadCount(e){this._documentReadCount+=e}}class Wv{constructor(){this.Gi=!1,this.zi=!1,this.ji=100,this.Hi=Yd()?8:Vp(Xd())>0?6:4}initialize(e,t){this.Ji=e,this.indexManager=t,this.Gi=!0}getDocumentsMatchingQuery(e,t,n,i){const r={result:null};return this.Yi(e,t).next(e=>{r.result=e}).next(()=>{if(!r.result)return this.Zi(e,t,i,n).next(e=>{r.result=e})}).next(()=>{if(r.result)return;const n=new Hv;return this.Xi(e,t,n).next(i=>{if(r.result=i,this.zi)return this.es(e,t,n,i.size)})}).next(()=>r.result)}es(e,t,n,i){return n.documentReadCount<this.ji?(ip()<=mh.DEBUG&&rp("QueryEngine","SDK will not create cache indexes for query:",xg(t),"since it only creates cache indexes for collection contains","more than or equal to",this.ji,"documents"),jp.resolve()):(ip()<=mh.DEBUG&&rp("QueryEngine","Query:",xg(t),"scans",n.documentReadCount,"local documents and returns",i,"documents as results."),n.documentReadCount>this.Hi*i?(ip()<=mh.DEBUG&&rp("QueryEngine","The SDK decides to create cache indexes for query:",xg(t),"as using cache indexes may help improve performance."),this.indexManager.createTargetIndexes(e,yg(t))):jp.resolve())}Yi(e,t){if(pg(t))return jp.resolve(null);let n=yg(t);return this.indexManager.getIndexType(e,n).next(i=>0===i?null:(null!==t.limit&&1===i&&(t=_g(t,null,"F"),n=yg(t)),this.indexManager.getDocumentsMatchingTarget(e,n).next(i=>{const r=Bg(...i);return this.Ji.getDocuments(e,r).next(i=>this.indexManager.getMinOffset(e,n).next(n=>{const o=this.ts(t,i);return this.ns(t,o,r,n.readTime)?this.Yi(e,_g(t,null,"F")):this.rs(e,o,t,n)}))})))}Zi(e,t,n,i){return pg(t)||i.isEqual(Cp.min())?jp.resolve(null):this.Ji.getDocuments(e,n).next(r=>{const o=this.ts(t,r);return this.ns(t,o,n,i)?jp.resolve(null):(ip()<=mh.DEBUG&&rp("QueryEngine","Re-using previous result from %s to execute query: %s",i.toString(),xg(t)),this.rs(e,o,t,Lp(i,-1)).next(e=>e))})}ts(e,t){let n=new rm(Tg(e));return t.forEach((t,i)=>{Sg(e,i)&&(n=n.add(i))}),n}ns(e,t,n,i){if(null===e.limit)return!1;if(n.size!==t.size)return!0;const r="F"===e.limitType?t.last():t.first();return!!r&&(r.hasPendingWrites||r.version.compareTo(i)>0)}Xi(e,t,n){return ip()<=mh.DEBUG&&rp("QueryEngine","Using full collection scan to execute query:",xg(t)),this.Ji.getDocumentsMatchingQuery(e,t,Mp.min(),n)}rs(e,t,n,i){return this.Ji.getDocumentsMatchingQuery(e,n,i).next(e=>(t.forEach(t=>{e=e.insert(t.key,t)}),e))}}class Gv{constructor(e,t,n,i){this.persistence=e,this.ss=t,this.serializer=i,this.os=new tm(Ep),this._s=new Cg(e=>cg(e),lg),this.us=new Map,this.cs=e.getRemoteDocumentCache(),this.Ur=e.getTargetCache(),this.Gr=e.getBundleCache(),this.ls(n)}ls(e){this.documentOverlayCache=this.persistence.getDocumentOverlayCache(e),this.indexManager=this.persistence.getIndexManager(e),this.mutationQueue=this.persistence.getMutationQueue(e,this.indexManager),this.localDocuments=new Nv(this.cs,this.mutationQueue,this.documentOverlayCache,this.indexManager),this.cs.setIndexManager(this.indexManager),this.ss.initialize(this.localDocuments,this.indexManager)}collectGarbage(e){return this.persistence.runTransaction("Collect garbage","readwrite-primary",t=>e.collect(t,this.os))}}function Kv(e,t,n,i){return new Gv(e,t,n,i)}async function Zv(e,t){const n=up(e);return await n.persistence.runTransaction("Handle user change","readonly",e=>{let i;return n.mutationQueue.getAllMutationBatches(e).next(r=>(i=r,n.ls(t),n.mutationQueue.getAllMutationBatches(e))).next(t=>{const r=[],o=[];let a=Bg();for(const e of i){r.push(e.batchId);for(const t of e.mutations)a=a.add(t.key)}for(const e of t){o.push(e.batchId);for(const t of e.mutations)a=a.add(t.key)}return n.localDocuments.getDocuments(e,a).next(e=>({hs:e,removedBatchIds:r,addedBatchIds:o}))})})}function Qv(e){const t=up(e);return t.persistence.runTransaction("Get last remote snapshot version","readonly",e=>t.Ur.getLastRemoteSnapshotVersion(e))}function Xv(e,t,n){let i=Bg(),r=Bg();return n.forEach(e=>i=i.add(e)),t.getEntries(e,i).next(e=>{let i=Ag();return n.forEach((n,o)=>{const a=e.get(n);o.isFoundDocument()!==a.isFoundDocument()&&(r=r.add(n)),o.isNoDocument()&&o.version.isEqual(Cp.min())?(t.removeEntry(n,o.readTime),i=i.insert(n,o)):!a.isValidDocument()||o.version.compareTo(a.version)>0||0===o.version.compareTo(a.version)&&a.hasPendingWrites?(t.addEntry(o),i=i.insert(n,o)):rp("LocalStore","Ignoring outdated watch update for ",n,". Current version:",a.version," Watch version:",o.version)}),{Ps:i,Is:r}})}function Yv(e,t){const n=up(e);return n.persistence.runTransaction("Get next mutation batch","readonly",e=>(void 0===t&&(t=-1),n.mutationQueue.getNextMutationBatchAfterBatchId(e,t)))}function Jv(e,t){const n=up(e);return n.persistence.runTransaction("Allocate target","readwrite",e=>{let i;return n.Ur.getTargetData(e,t).next(r=>r?(i=r,jp.resolve(i)):n.Ur.allocateTargetId(e).next(r=>(i=new wv(t,r,"TargetPurposeListen",e.currentSequenceNumber),n.Ur.addTargetData(e,i).next(()=>i))))}).then(e=>{const i=n.os.get(e.targetId);return(null===i||e.snapshotVersion.compareTo(i.snapshotVersion)>0)&&(n.os=n.os.insert(e.targetId,e),n._s.set(t,e.targetId)),e})}async function $v(e,t,n){const i=up(e),r=i.os.get(t),o=n?"readwrite":"readwrite-primary";try{n||await i.persistence.runTransaction("Release target",o,e=>i.persistence.referenceDelegate.removeTarget(e,r))}catch(e){if(!qp(e))throw e;rp("LocalStore","Failed to update sequence numbers for target ".concat(t,": ").concat(e))}i.os=i.os.remove(t),i._s.delete(r.target)}function e_(e,t,n){const i=up(e);let r=Cp.min(),o=Bg();return i.persistence.runTransaction("Execute query","readwrite",e=>function(e,t,n){const i=up(e),r=i._s.get(n);return void 0!==r?jp.resolve(i.os.get(r)):i.Ur.getTargetData(t,n)}(i,e,yg(t)).next(t=>{if(t)return r=t.lastLimboFreeSnapshotVersion,i.Ur.getMatchingKeysForTargetId(e,t.targetId).next(e=>{o=e})}).next(()=>i.ss.getDocumentsMatchingQuery(e,t,n?r:Cp.min(),n?o:Bg())).next(e=>(t_(i,Eg(t),e),{documents:e,Ts:o})))}function t_(e,t,n){let i=e.us.get(t)||Cp.min();n.forEach((e,t)=>{t.readTime.compareTo(i)>0&&(i=t.readTime)}),e.us.set(t,i)}class n_{constructor(){this.activeTargetIds=Fg()}fs(e){this.activeTargetIds=this.activeTargetIds.add(e)}gs(e){this.activeTargetIds=this.activeTargetIds.delete(e)}Vs(){const e={activeTargetIds:this.activeTargetIds.toArray(),updateTimeMs:Date.now()};return JSON.stringify(e)}}class i_{constructor(){this.so=new n_,this.oo={},this.onlineStateHandler=null,this.sequenceNumberHandler=null}addPendingMutation(e){}updateMutationState(e,t,n){}addLocalQueryTarget(e){return(!(arguments.length>1&&void 0!==arguments[1])||arguments[1])&&this.so.fs(e),this.oo[e]||"not-current"}updateQueryState(e,t,n){this.oo[e]=t}removeLocalQueryTarget(e){this.so.gs(e)}isLocalQueryTarget(e){return this.so.activeTargetIds.has(e)}clearQueryState(e){delete this.oo[e]}getAllActiveQueryTargets(){return this.so.activeTargetIds}isActiveQueryTarget(e){return this.so.activeTargetIds.has(e)}start(){return this.so=new n_,Promise.resolve()}handleUserChange(e,t,n){}setOnlineState(e){}shutdown(){}writeSequenceNumber(e){}notifyBundleLoaded(e){}}class r_{_o(e){}shutdown(){}}class o_{constructor(){this.ao=()=>this.uo(),this.co=()=>this.lo(),this.ho=[],this.Po()}_o(e){this.ho.push(e)}shutdown(){window.removeEventListener("online",this.ao),window.removeEventListener("offline",this.co)}Po(){window.addEventListener("online",this.ao),window.addEventListener("offline",this.co)}uo(){rp("ConnectivityMonitor","Network connectivity changed: AVAILABLE");for(const e of this.ho)e(0)}lo(){rp("ConnectivityMonitor","Network connectivity changed: UNAVAILABLE");for(const e of this.ho)e(1)}static D(){return"undefined"!=typeof window&&void 0!==window.addEventListener&&void 0!==window.removeEventListener}}let a_=null;function s_(){return null===a_?a_=268435456+Math.round(2147483648*Math.random()):a_++,"0x"+a_.toString(16)}const c_={BatchGetDocuments:"batchGet",Commit:"commit",RunQuery:"runQuery",RunAggregationQuery:"runAggregationQuery"};class l_{constructor(e){this.Io=e.Io,this.To=e.To}Eo(e){this.Ao=e}Ro(e){this.Vo=e}mo(e){this.fo=e}onMessage(e){this.po=e}close(){this.To()}send(e){this.Io(e)}yo(){this.Ao()}wo(){this.Vo()}So(e){this.fo(e)}bo(e){this.po(e)}}const u_="WebChannelConnection";class d_ extends class{constructor(e){this.databaseInfo=e,this.databaseId=e.databaseId;const t=e.ssl?"https":"http",n=encodeURIComponent(this.databaseId.projectId),i=encodeURIComponent(this.databaseId.database);this.Do=t+"://"+e.host,this.vo="projects/".concat(n,"/databases/").concat(i),this.Co="(default)"===this.databaseId.database?"project_id=".concat(n):"project_id=".concat(n,"&database_id=").concat(i)}get Fo(){return!1}Mo(e,t,n,i,r){const o=s_(),a=this.xo(e,t.toUriEncodedString());rp("RestConnection","Sending RPC '".concat(e,"' ").concat(o,":"),a,n);const s={"google-cloud-resource-prefix":this.vo,"x-goog-request-params":this.Co};return this.Oo(s,i,r),this.No(e,a,s,n).then(t=>(rp("RestConnection","Received RPC '".concat(e,"' ").concat(o,": "),t),t),t=>{throw ap("RestConnection","RPC '".concat(e,"' ").concat(o," failed with error: "),t,"url: ",a,"request:",n),t})}Lo(e,t,n,i,r,o){return this.Mo(e,t,n,i,r)}Oo(e,t,n){e["X-Goog-Api-Client"]="gl-js/ fire/"+tp,e["Content-Type"]="text/plain",this.databaseInfo.appId&&(e["X-Firebase-GMPID"]=this.databaseInfo.appId),t&&t.headers.forEach((t,n)=>e[n]=t),n&&n.headers.forEach((t,n)=>e[n]=t)}xo(e,t){const n=c_[e];return"".concat(this.Do,"/v1/").concat(t,":").concat(n)}terminate(){}}{constructor(e){super(e),this.forceLongPolling=e.forceLongPolling,this.autoDetectLongPolling=e.autoDetectLongPolling,this.useFetchStreams=e.useFetchStreams,this.longPollingOptions=e.longPollingOptions}No(e,t,n,i){const r=s_();return new Promise((o,a)=>{const s=new qf;s.setWithCredentials(!0),s.listenOnce(Wf.COMPLETE,()=>{try{switch(s.getLastErrorCode()){case Gf.NO_ERROR:const t=s.getResponseJson();rp(u_,"XHR for RPC '".concat(e,"' ").concat(r," received:"),JSON.stringify(t)),o(t);break;case Gf.TIMEOUT:rp(u_,"RPC '".concat(e,"' ").concat(r," timed out")),a(new hp(dp.DEADLINE_EXCEEDED,"Request time out"));break;case Gf.HTTP_ERROR:const n=s.getStatus();if(rp(u_,"RPC '".concat(e,"' ").concat(r," failed with status:"),n,"response text:",s.getResponseText()),n>0){let e=s.getResponseJson();Array.isArray(e)&&(e=e[0]);const t=null==e?void 0:e.error;if(t&&t.status&&t.message){const e=function(e){const t=e.toLowerCase().replace(/_/g,"-");return Object.values(dp).indexOf(t)>=0?t:dp.UNKNOWN}(t.status);a(new hp(e,t.message))}else a(new hp(dp.UNKNOWN,"Server responded with status "+s.getStatus()))}else a(new hp(dp.UNAVAILABLE,"Connection failed."));break;default:cp()}}finally{rp(u_,"RPC '".concat(e,"' ").concat(r," completed."))}});const c=JSON.stringify(i);rp(u_,"RPC '".concat(e,"' ").concat(r," sending request:"),i),s.send(t,"POST",c,n,15)})}Bo(e,t,n){const i=s_(),r=[this.Do,"/","google.firestore.v1.Firestore","/",e,"/channel"],o=Xf(),a=Qf(),s={httpSessionIdParam:"gsessionid",initMessageHeaders:{},messageUrlParams:{database:"projects/".concat(this.databaseId.projectId,"/databases/").concat(this.databaseId.database)},sendRawJson:!0,supportsCrossDomainXhr:!0,internalChannelParams:{forwardChannelRequestTimeoutMs:6e5},forceLongPolling:this.forceLongPolling,detectBufferingProxy:this.autoDetectLongPolling},c=this.longPollingOptions.timeoutSeconds;void 0!==c&&(s.longPollingTimeout=Math.round(1e3*c)),this.useFetchStreams&&(s.useFetchStreams=!0),this.Oo(s.initMessageHeaders,t,n),s.encodeInitMessageHeaders=!0;const l=r.join("");rp(u_,"Creating RPC '".concat(e,"' stream ").concat(i,": ").concat(l),s);const u=o.createWebChannel(l,s);let d=!1,h=!1;const f=new l_({Io:t=>{h?rp(u_,"Not sending because RPC '".concat(e,"' stream ").concat(i," is closed:"),t):(d||(rp(u_,"Opening RPC '".concat(e,"' stream ").concat(i," transport.")),u.open(),d=!0),rp(u_,"RPC '".concat(e,"' stream ").concat(i," sending:"),t),u.send(t))},To:()=>u.close()}),p=(e,t,n)=>{e.listen(t,e=>{try{n(e)}catch(e){setTimeout(()=>{throw e},0)}})};return p(u,Hf.EventType.OPEN,()=>{h||(rp(u_,"RPC '".concat(e,"' stream ").concat(i," transport opened.")),f.yo())}),p(u,Hf.EventType.CLOSE,()=>{h||(h=!0,rp(u_,"RPC '".concat(e,"' stream ").concat(i," transport closed")),f.So())}),p(u,Hf.EventType.ERROR,t=>{h||(h=!0,ap(u_,"RPC '".concat(e,"' stream ").concat(i," transport errored:"),t),f.So(new hp(dp.UNAVAILABLE,"The operation could not be completed")))}),p(u,Hf.EventType.MESSAGE,t=>{var n;if(!h){const r=t.data[0];lp(!!r);const o=r,a=o.error||(null===(n=o[0])||void 0===n?void 0:n.error);if(a){rp(u_,"RPC '".concat(e,"' stream ").concat(i," received error:"),a);const t=a.status;let n=function(e){const t=xy[e];if(void 0!==t)return Ty(t)}(t),r=a.message;void 0===n&&(n=dp.INTERNAL,r="Unknown error status: "+t+" with message "+a.message),h=!0,f.So(new hp(n,r)),u.close()}else rp(u_,"RPC '".concat(e,"' stream ").concat(i," received:"),r),f.bo(r)}}),p(a,Zf.STAT_EVENT,t=>{t.stat===Kf.PROXY?rp(u_,"RPC '".concat(e,"' stream ").concat(i," detected buffering proxy")):t.stat===Kf.NOPROXY&&rp(u_,"RPC '".concat(e,"' stream ").concat(i," detected no buffering proxy"))}),setTimeout(()=>{f.wo()},0),f}}function h_(){return"undefined"!=typeof document?document:null}function f_(e){return new Wy(e,!0)}class p_{constructor(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1e3,i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:1.5,r=arguments.length>4&&void 0!==arguments[4]?arguments[4]:6e4;this.ui=e,this.timerId=t,this.ko=n,this.qo=i,this.Qo=r,this.Ko=0,this.$o=null,this.Uo=Date.now(),this.reset()}reset(){this.Ko=0}Wo(){this.Ko=this.Qo}Go(e){this.cancel();const t=Math.floor(this.Ko+this.zo()),n=Math.max(0,Date.now()-this.Uo),i=Math.max(0,t-n);i>0&&rp("ExponentialBackoff","Backing off for ".concat(i," ms (base delay: ").concat(this.Ko," ms, delay with jitter: ").concat(t," ms, last attempt: ").concat(n," ms ago)")),this.$o=this.ui.enqueueAfterDelay(this.timerId,i,()=>(this.Uo=Date.now(),e())),this.Ko*=this.qo,this.Ko<this.ko&&(this.Ko=this.ko),this.Ko>this.Qo&&(this.Ko=this.Qo)}jo(){null!==this.$o&&(this.$o.skipDelay(),this.$o=null)}cancel(){null!==this.$o&&(this.$o.cancel(),this.$o=null)}zo(){return(Math.random()-.5)*this.Ko}}class m_{constructor(e,t,n,i,r,o,a,s){this.ui=e,this.Ho=n,this.Jo=i,this.connection=r,this.authCredentialsProvider=o,this.appCheckCredentialsProvider=a,this.listener=s,this.state=0,this.Yo=0,this.Zo=null,this.Xo=null,this.stream=null,this.e_=0,this.t_=new p_(e,t)}n_(){return 1===this.state||5===this.state||this.r_()}r_(){return 2===this.state||3===this.state}start(){this.e_=0,4!==this.state?this.auth():this.i_()}async stop(){this.n_()&&await this.close(0)}s_(){this.state=0,this.t_.reset()}o_(){this.r_()&&null===this.Zo&&(this.Zo=this.ui.enqueueAfterDelay(this.Ho,6e4,()=>this.__()))}a_(e){this.u_(),this.stream.send(e)}async __(){if(this.r_())return this.close(0)}u_(){this.Zo&&(this.Zo.cancel(),this.Zo=null)}c_(){this.Xo&&(this.Xo.cancel(),this.Xo=null)}async close(e,t){this.u_(),this.c_(),this.t_.cancel(),this.Yo++,4!==e?this.t_.reset():t&&t.code===dp.RESOURCE_EXHAUSTED?(op(t.toString()),op("Using maximum backoff delay to prevent overloading the backend."),this.t_.Wo()):t&&t.code===dp.UNAUTHENTICATED&&3!==this.state&&(this.authCredentialsProvider.invalidateToken(),this.appCheckCredentialsProvider.invalidateToken()),null!==this.stream&&(this.l_(),this.stream.close(),this.stream=null),this.state=e,await this.listener.mo(t)}l_(){}auth(){this.state=1;const e=this.h_(this.Yo),t=this.Yo;Promise.all([this.authCredentialsProvider.getToken(),this.appCheckCredentialsProvider.getToken()]).then(e=>{let[n,i]=e;this.Yo===t&&this.P_(n,i)},t=>{e(()=>{const e=new hp(dp.UNKNOWN,"Fetching auth token failed: "+t.message);return this.I_(e)})})}P_(e,t){const n=this.h_(this.Yo);this.stream=this.T_(e,t),this.stream.Eo(()=>{n(()=>this.listener.Eo())}),this.stream.Ro(()=>{n(()=>(this.state=2,this.Xo=this.ui.enqueueAfterDelay(this.Jo,1e4,()=>(this.r_()&&(this.state=3),Promise.resolve())),this.listener.Ro()))}),this.stream.mo(e=>{n(()=>this.I_(e))}),this.stream.onMessage(e=>{n(()=>1==++this.e_?this.E_(e):this.onNext(e))})}i_(){this.state=5,this.t_.Go(async()=>{this.state=0,this.start()})}I_(e){return rp("PersistentStream","close with error: ".concat(e)),this.stream=null,this.close(4,e)}h_(e){return t=>{this.ui.enqueueAndForget(()=>this.Yo===e?t():(rp("PersistentStream","stream callback skipped by getCloseGuardedDispatcher."),Promise.resolve()))}}}class g_ extends m_{constructor(e,t,n,i,r,o){super(e,"listen_stream_connection_backoff","listen_stream_idle","health_check_timeout",t,n,i,o),this.serializer=r}T_(e,t){return this.connection.Bo("Listen",e,t)}E_(e){return this.onNext(e)}onNext(e){this.t_.reset();const t=function(e,t){let n;if("targetChange"in t){t.targetChange;const i=function(e){return"NO_CHANGE"===e?0:"ADD"===e?1:"REMOVE"===e?2:"CURRENT"===e?3:"RESET"===e?4:cp()}(t.targetChange.targetChangeType||"NO_CHANGE"),r=t.targetChange.targetIds||[],o=function(e,t){return e.useProto3Json?(lp(void 0===t||"string"==typeof t),cm.fromBase64String(t||"")):(lp(void 0===t||t instanceof Buffer||t instanceof Uint8Array),cm.fromUint8Array(t||new Uint8Array))}(e,t.targetChange.resumeToken),a=t.targetChange.cause,s=a&&function(e){const t=void 0===e.code?dp.UNKNOWN:Ty(e.code);return new hp(t,e.message||"")}(a);n=new Dy(i,r,o,s||null)}else if("documentChange"in t){t.documentChange;const i=t.documentChange;i.document,i.document.name,i.document.updateTime;const r=tv(e,i.document.name),o=Xy(i.document.updateTime),a=i.document.createTime?Xy(i.document.createTime):Cp.min(),s=new zm({mapValue:{fields:i.document.fields}}),c=Dm.newFoundDocument(r,o,a,s),l=i.targetIds||[],u=i.removedTargetIds||[];n=new zy(l,u,c.key,c)}else if("documentDelete"in t){t.documentDelete;const i=t.documentDelete;i.document;const r=tv(e,i.document),o=i.readTime?Xy(i.readTime):Cp.min(),a=Dm.newNoDocument(r,o),s=i.removedTargetIds||[];n=new zy([],s,a.key,a)}else if("documentRemove"in t){t.documentRemove;const i=t.documentRemove;i.document;const r=tv(e,i.document),o=i.removedTargetIds||[];n=new zy([],o,r,null)}else{if(!("filter"in t))return cp();{t.filter;const e=t.filter;e.targetId;const{count:i=0,unchangedNames:r}=e,o=new by(i,r),a=e.targetId;n=new My(a,o)}}return n}(this.serializer,e),n=function(e){if(!("targetChange"in e))return Cp.min();const t=e.targetChange;return t.targetIds&&t.targetIds.length?Cp.min():t.readTime?Xy(t.readTime):Cp.min()}(e);return this.listener.d_(t,n)}A_(e){const t={};t.database=rv(this.serializer),t.addTarget=function(e,t){let n;const i=t.target;if(n=ug(i)?{documents:cv(e,i)}:{query:lv(e,i)._t},n.targetId=t.targetId,t.resumeToken.approximateByteSize()>0){n.resumeToken=Zy(e,t.resumeToken);const i=Gy(e,t.expectedCount);null!==i&&(n.expectedCount=i)}else if(t.snapshotVersion.compareTo(Cp.min())>0){n.readTime=Ky(e,t.snapshotVersion.toTimestamp());const i=Gy(e,t.expectedCount);null!==i&&(n.expectedCount=i)}return n}(this.serializer,e);const n=function(e,t){const n=function(e){switch(e){case"TargetPurposeListen":return null;case"TargetPurposeExistenceFilterMismatch":return"existence-filter-mismatch";case"TargetPurposeExistenceFilterMismatchBloom":return"existence-filter-mismatch-bloom";case"TargetPurposeLimboResolution":return"limbo-document";default:return cp()}}(t.purpose);return null==n?null:{"goog-listen-tags":n}}(this.serializer,e);n&&(t.labels=n),this.a_(t)}R_(e){const t={};t.database=rv(this.serializer),t.removeTarget=e,this.a_(t)}}class y_ extends m_{constructor(e,t,n,i,r,o){super(e,"write_stream_connection_backoff","write_stream_idle","health_check_timeout",t,n,i,o),this.serializer=r}get V_(){return this.e_>0}start(){this.lastStreamToken=void 0,super.start()}l_(){this.V_&&this.m_([])}T_(e,t){return this.connection.Bo("Write",e,t)}E_(e){return lp(!!e.streamToken),this.lastStreamToken=e.streamToken,lp(!e.writeResults||0===e.writeResults.length),this.listener.f_()}onNext(e){lp(!!e.streamToken),this.lastStreamToken=e.streamToken,this.t_.reset();const t=function(e,t){return e&&e.length>0?(lp(void 0!==t),e.map(e=>function(e,t){let n=e.updateTime?Xy(e.updateTime):Xy(t);return n.isEqual(Cp.min())&&(n=Xy(t)),new ny(n,e.transformResults||[])}(e,t))):[]}(e.writeResults,e.commitTime),n=Xy(e.commitTime);return this.listener.g_(n,t)}p_(){const e={};e.database=rv(this.serializer),this.a_(e)}m_(e){const t={streamToken:this.lastStreamToken,writes:e.map(e=>sv(this.serializer,e))};this.a_(t)}}class v_ extends class{}{constructor(e,t,n,i){super(),this.authCredentials=e,this.appCheckCredentials=t,this.connection=n,this.serializer=i,this.y_=!1}w_(){if(this.y_)throw new hp(dp.FAILED_PRECONDITION,"The client has already been terminated.")}Mo(e,t,n,i){return this.w_(),Promise.all([this.authCredentials.getToken(),this.appCheckCredentials.getToken()]).then(r=>{let[o,a]=r;return this.connection.Mo(e,Jy(t,n),i,o,a)}).catch(e=>{throw"FirebaseError"===e.name?(e.code===dp.UNAUTHENTICATED&&(this.authCredentials.invalidateToken(),this.appCheckCredentials.invalidateToken()),e):new hp(dp.UNKNOWN,e.toString())})}Lo(e,t,n,i,r){return this.w_(),Promise.all([this.authCredentials.getToken(),this.appCheckCredentials.getToken()]).then(o=>{let[a,s]=o;return this.connection.Lo(e,Jy(t,n),i,a,s,r)}).catch(e=>{throw"FirebaseError"===e.name?(e.code===dp.UNAUTHENTICATED&&(this.authCredentials.invalidateToken(),this.appCheckCredentials.invalidateToken()),e):new hp(dp.UNKNOWN,e.toString())})}terminate(){this.y_=!0,this.connection.terminate()}}class __{constructor(e,t){this.asyncQueue=e,this.onlineStateHandler=t,this.state="Unknown",this.S_=0,this.b_=null,this.D_=!0}v_(){0===this.S_&&(this.C_("Unknown"),this.b_=this.asyncQueue.enqueueAfterDelay("online_state_timeout",1e4,()=>(this.b_=null,this.F_("Backend didn't respond within 10 seconds."),this.C_("Offline"),Promise.resolve())))}M_(e){"Online"===this.state?this.C_("Unknown"):(this.S_++,this.S_>=1&&(this.x_(),this.F_("Connection failed 1 times. Most recent error: ".concat(e.toString())),this.C_("Offline")))}set(e){this.x_(),this.S_=0,"Online"===e&&(this.D_=!1),this.C_(e)}C_(e){e!==this.state&&(this.state=e,this.onlineStateHandler(e))}F_(e){const t="Could not reach Cloud Firestore backend. ".concat(e,"\nThis typically indicates that your device does not have a healthy Internet connection at the moment. The client will operate in offline mode until it is able to successfully connect to the backend.");this.D_?(op(t),this.D_=!1):rp("OnlineStateTracker",t)}x_(){null!==this.b_&&(this.b_.cancel(),this.b_=null)}}class w_{constructor(e,t,n,i,r){this.localStore=e,this.datastore=t,this.asyncQueue=n,this.remoteSyncer={},this.O_=[],this.N_=new Map,this.L_=new Set,this.B_=[],this.k_=r,this.k_._o(e=>{n.enqueueAndForget(async()=>{A_(this)&&(rp("RemoteStore","Restarting streams for network reachability change."),await async function(e){const t=up(e);t.L_.add(4),await x_(t),t.q_.set("Unknown"),t.L_.delete(4),await b_(t)}(this))})}),this.q_=new __(n,i)}}async function b_(e){if(A_(e))for(const t of e.B_)await t(!0)}async function x_(e){for(const t of e.B_)await t(!1)}function S_(e,t){const n=up(e);n.N_.has(t.targetId)||(n.N_.set(t.targetId,t),I_(n)?C_(n):Z_(n).r_()&&T_(n,t))}function E_(e,t){const n=up(e),i=Z_(n);n.N_.delete(t),i.r_()&&k_(n,t),0===n.N_.size&&(i.r_()?i.o_():A_(n)&&n.q_.set("Unknown"))}function T_(e,t){if(e.Q_.xe(t.targetId),t.resumeToken.approximateByteSize()>0||t.snapshotVersion.compareTo(Cp.min())>0){const n=e.remoteSyncer.getRemoteKeysForTarget(t.targetId).size;t=t.withExpectedCount(n)}Z_(e).A_(t)}function k_(e,t){e.Q_.xe(t),Z_(e).R_(t)}function C_(e){e.Q_=new Uy({getRemoteKeysForTarget:t=>e.remoteSyncer.getRemoteKeysForTarget(t),ot:t=>e.N_.get(t)||null,tt:()=>e.datastore.serializer.databaseId}),Z_(e).start(),e.q_.v_()}function I_(e){return A_(e)&&!Z_(e).n_()&&e.N_.size>0}function A_(e){return 0===up(e).L_.size}function N_(e){e.Q_=void 0}async function O_(e){e.q_.set("Online")}async function P_(e){e.N_.forEach((t,n)=>{T_(e,t)})}async function R_(e,t){N_(e),I_(e)?(e.q_.M_(t),C_(e)):e.q_.set("Unknown")}async function L_(e,t,n){if(e.q_.set("Online"),t instanceof Dy&&2===t.state&&t.cause)try{await async function(e,t){const n=t.cause;for(const i of t.targetIds)e.N_.has(i)&&(await e.remoteSyncer.rejectListen(i,n),e.N_.delete(i),e.Q_.removeTarget(i))}(e,t)}catch(n){rp("RemoteStore","Failed to remove targets %s: %s ",t.targetIds.join(","),n),await z_(e,n)}else if(t instanceof zy?e.Q_.Ke(t):t instanceof My?e.Q_.He(t):e.Q_.We(t),!n.isEqual(Cp.min()))try{const t=await Qv(e.localStore);n.compareTo(t)>=0&&await function(e,t){const n=e.Q_.rt(t);return n.targetChanges.forEach((n,i)=>{if(n.resumeToken.approximateByteSize()>0){const r=e.N_.get(i);r&&e.N_.set(i,r.withResumeToken(n.resumeToken,t))}}),n.targetMismatches.forEach((t,n)=>{const i=e.N_.get(t);if(!i)return;e.N_.set(t,i.withResumeToken(cm.EMPTY_BYTE_STRING,i.snapshotVersion)),k_(e,t);const r=new wv(i.target,t,n,i.sequenceNumber);T_(e,r)}),e.remoteSyncer.applyRemoteEvent(n)}(e,n)}catch(t){rp("RemoteStore","Failed to raise snapshot:",t),await z_(e,t)}}async function z_(e,t,n){if(!qp(t))throw t;e.L_.add(1),await x_(e),e.q_.set("Offline"),n||(n=()=>Qv(e.localStore)),e.asyncQueue.enqueueRetryable(async()=>{rp("RemoteStore","Retrying IndexedDB access"),await n(),e.L_.delete(1),await b_(e)})}function M_(e,t){return t().catch(n=>z_(e,n,t))}async function D_(e){const t=up(e),n=Q_(t);let i=t.O_.length>0?t.O_[t.O_.length-1].batchId:-1;for(;B_(t);)try{const e=await Yv(t.localStore,i);if(null===e){0===t.O_.length&&n.o_();break}i=e.batchId,U_(t,e)}catch(e){await z_(t,e)}F_(t)&&j_(t)}function B_(e){return A_(e)&&e.O_.length<10}function U_(e,t){e.O_.push(t);const n=Q_(e);n.r_()&&n.V_&&n.m_(t.mutations)}function F_(e){return A_(e)&&!Q_(e).n_()&&e.O_.length>0}function j_(e){Q_(e).start()}async function V_(e){Q_(e).p_()}async function q_(e){const t=Q_(e);for(const n of e.O_)t.m_(n.mutations)}async function H_(e,t,n){const i=e.O_.shift(),r=_y.from(i,t,n);await M_(e,()=>e.remoteSyncer.applySuccessfulWrite(r)),await D_(e)}async function W_(e,t){t&&Q_(e).V_&&await async function(e,t){if(function(e){return Ey(e)&&e!==dp.ABORTED}(t.code)){const n=e.O_.shift();Q_(e).s_(),await M_(e,()=>e.remoteSyncer.rejectFailedWrite(n.batchId,t)),await D_(e)}}(e,t),F_(e)&&j_(e)}async function G_(e,t){const n=up(e);n.asyncQueue.verifyOperationInProgress(),rp("RemoteStore","RemoteStore received new credentials");const i=A_(n);n.L_.add(3),await x_(n),i&&n.q_.set("Unknown"),await n.remoteSyncer.handleCredentialChange(t),n.L_.delete(3),await b_(n)}async function K_(e,t){const n=up(e);t?(n.L_.delete(2),await b_(n)):t||(n.L_.add(2),await x_(n),n.q_.set("Unknown"))}function Z_(e){return e.K_||(e.K_=function(e,t,n){const i=up(e);return i.w_(),new g_(t,i.connection,i.authCredentials,i.appCheckCredentials,i.serializer,n)}(e.datastore,e.asyncQueue,{Eo:O_.bind(null,e),Ro:P_.bind(null,e),mo:R_.bind(null,e),d_:L_.bind(null,e)}),e.B_.push(async t=>{t?(e.K_.s_(),I_(e)?C_(e):e.q_.set("Unknown")):(await e.K_.stop(),N_(e))})),e.K_}function Q_(e){return e.U_||(e.U_=function(e,t,n){const i=up(e);return i.w_(),new y_(t,i.connection,i.authCredentials,i.appCheckCredentials,i.serializer,n)}(e.datastore,e.asyncQueue,{Eo:()=>Promise.resolve(),Ro:V_.bind(null,e),mo:W_.bind(null,e),f_:q_.bind(null,e),g_:H_.bind(null,e)}),e.B_.push(async t=>{t?(e.U_.s_(),await D_(e)):(await e.U_.stop(),e.O_.length>0&&(rp("RemoteStore","Stopping write stream with ".concat(e.O_.length," pending writes")),e.O_=[]))})),e.U_}class X_{constructor(e,t,n,i,r){this.asyncQueue=e,this.timerId=t,this.targetTimeMs=n,this.op=i,this.removalCallback=r,this.deferred=new fp,this.then=this.deferred.promise.then.bind(this.deferred.promise),this.deferred.promise.catch(e=>{})}get promise(){return this.deferred.promise}static createAndSchedule(e,t,n,i,r){const o=Date.now()+n,a=new X_(e,t,o,i,r);return a.start(n),a}start(e){this.timerHandle=setTimeout(()=>this.handleDelayElapsed(),e)}skipDelay(){return this.handleDelayElapsed()}cancel(e){null!==this.timerHandle&&(this.clearTimeout(),this.deferred.reject(new hp(dp.CANCELLED,"Operation cancelled"+(e?": "+e:""))))}handleDelayElapsed(){this.asyncQueue.enqueueAndForget(()=>null!==this.timerHandle?(this.clearTimeout(),this.op().then(e=>this.deferred.resolve(e))):Promise.resolve())}clearTimeout(){null!==this.timerHandle&&(this.removalCallback(this),clearTimeout(this.timerHandle),this.timerHandle=null)}}function Y_(e,t){if(op("AsyncQueue","".concat(t,": ").concat(e)),qp(e))return new hp(dp.UNAVAILABLE,"".concat(t,": ").concat(e));throw e}class J_{constructor(e){this.comparator=e?(t,n)=>e(t,n)||Pp.comparator(t.key,n.key):(e,t)=>Pp.comparator(e.key,t.key),this.keyedMap=Og(),this.sortedSet=new tm(this.comparator)}static emptySet(e){return new J_(e.comparator)}has(e){return null!=this.keyedMap.get(e)}get(e){return this.keyedMap.get(e)}first(){return this.sortedSet.minKey()}last(){return this.sortedSet.maxKey()}isEmpty(){return this.sortedSet.isEmpty()}indexOf(e){const t=this.keyedMap.get(e);return t?this.sortedSet.indexOf(t):-1}get size(){return this.sortedSet.size}forEach(e){this.sortedSet.inorderTraversal((t,n)=>(e(t),!1))}add(e){const t=this.delete(e.key);return t.copy(t.keyedMap.insert(e.key,e),t.sortedSet.insert(e,null))}delete(e){const t=this.get(e);return t?this.copy(this.keyedMap.remove(e),this.sortedSet.remove(t)):this}isEqual(e){if(!(e instanceof J_))return!1;if(this.size!==e.size)return!1;const t=this.sortedSet.getIterator(),n=e.sortedSet.getIterator();for(;t.hasNext();){const e=t.getNext().key,i=n.getNext().key;if(!e.isEqual(i))return!1}return!0}toString(){const e=[];return this.forEach(t=>{e.push(t.toString())}),0===e.length?"DocumentSet ()":"DocumentSet (\n  "+e.join("  \n")+"\n)"}copy(e,t){const n=new J_;return n.comparator=this.comparator,n.keyedMap=e,n.sortedSet=t,n}}class $_{constructor(){this.W_=new tm(Pp.comparator)}track(e){const t=e.doc.key,n=this.W_.get(t);n?0!==e.type&&3===n.type?this.W_=this.W_.insert(t,e):3===e.type&&1!==n.type?this.W_=this.W_.insert(t,{type:n.type,doc:e.doc}):2===e.type&&2===n.type?this.W_=this.W_.insert(t,{type:2,doc:e.doc}):2===e.type&&0===n.type?this.W_=this.W_.insert(t,{type:0,doc:e.doc}):1===e.type&&0===n.type?this.W_=this.W_.remove(t):1===e.type&&2===n.type?this.W_=this.W_.insert(t,{type:1,doc:n.doc}):0===e.type&&1===n.type?this.W_=this.W_.insert(t,{type:2,doc:e.doc}):cp():this.W_=this.W_.insert(t,e)}G_(){const e=[];return this.W_.inorderTraversal((t,n)=>{e.push(n)}),e}}class ew{constructor(e,t,n,i,r,o,a,s,c){this.query=e,this.docs=t,this.oldDocs=n,this.docChanges=i,this.mutatedKeys=r,this.fromCache=o,this.syncStateChanged=a,this.excludesMetadataChanges=s,this.hasCachedResults=c}static fromInitialDocuments(e,t,n,i,r){const o=[];return t.forEach(e=>{o.push({type:0,doc:e})}),new ew(e,t,J_.emptySet(t),o,n,i,!0,!1,r)}get hasPendingWrites(){return!this.mutatedKeys.isEmpty()}isEqual(e){if(!(this.fromCache===e.fromCache&&this.hasCachedResults===e.hasCachedResults&&this.syncStateChanged===e.syncStateChanged&&this.mutatedKeys.isEqual(e.mutatedKeys)&&wg(this.query,e.query)&&this.docs.isEqual(e.docs)&&this.oldDocs.isEqual(e.oldDocs)))return!1;const t=this.docChanges,n=e.docChanges;if(t.length!==n.length)return!1;for(let i=0;i<t.length;i++)if(t[i].type!==n[i].type||!t[i].doc.isEqual(n[i].doc))return!1;return!0}}class tw{constructor(){this.z_=void 0,this.j_=[]}H_(){return this.j_.some(e=>e.J_())}}class nw{constructor(){this.queries=iw(),this.onlineState="Unknown",this.Y_=new Set}terminate(){!function(e,t){const n=up(e),i=n.queries;n.queries=iw(),i.forEach((e,n)=>{for(const i of n.j_)i.onError(t)})}(this,new hp(dp.ABORTED,"Firestore shutting down"))}}function iw(){return new Cg(e=>bg(e),wg)}async function rw(e,t){const n=up(e);let i=3;const r=t.query;let o=n.queries.get(r);o?!o.H_()&&t.J_()&&(i=2):(o=new tw,i=t.J_()?0:1);try{switch(i){case 0:o.z_=await n.onListen(r,!0);break;case 1:o.z_=await n.onListen(r,!1);break;case 2:await n.onFirstRemoteStoreListen(r)}}catch(e){const n=Y_(e,"Initialization of query '".concat(xg(t.query),"' failed"));return void t.onError(n)}n.queries.set(r,o),o.j_.push(t),t.Z_(n.onlineState),o.z_&&t.X_(o.z_)&&cw(n)}async function ow(e,t){const n=up(e),i=t.query;let r=3;const o=n.queries.get(i);if(o){const e=o.j_.indexOf(t);e>=0&&(o.j_.splice(e,1),0===o.j_.length?r=t.J_()?0:1:!o.H_()&&t.J_()&&(r=2))}switch(r){case 0:return n.queries.delete(i),n.onUnlisten(i,!0);case 1:return n.queries.delete(i),n.onUnlisten(i,!1);case 2:return n.onLastRemoteStoreUnlisten(i);default:return}}function aw(e,t){const n=up(e);let i=!1;for(const r of t){const e=r.query,t=n.queries.get(e);if(t){for(const e of t.j_)e.X_(r)&&(i=!0);t.z_=r}}i&&cw(n)}function sw(e,t,n){const i=up(e),r=i.queries.get(t);if(r)for(const o of r.j_)o.onError(n);i.queries.delete(t)}function cw(e){e.Y_.forEach(e=>{e.next()})}var lw,uw;(uw=lw||(lw={})).ea="default",uw.Cache="cache";class dw{constructor(e,t,n){this.query=e,this.ta=t,this.na=!1,this.ra=null,this.onlineState="Unknown",this.options=n||{}}X_(e){if(!this.options.includeMetadataChanges){const t=[];for(const n of e.docChanges)3!==n.type&&t.push(n);e=new ew(e.query,e.docs,e.oldDocs,t,e.mutatedKeys,e.fromCache,e.syncStateChanged,!0,e.hasCachedResults)}let t=!1;return this.na?this.ia(e)&&(this.ta.next(e),t=!0):this.sa(e,this.onlineState)&&(this.oa(e),t=!0),this.ra=e,t}onError(e){this.ta.error(e)}Z_(e){this.onlineState=e;let t=!1;return this.ra&&!this.na&&this.sa(this.ra,e)&&(this.oa(this.ra),t=!0),t}sa(e,t){if(!e.fromCache)return!0;if(!this.J_())return!0;const n="Offline"!==t;return(!this.options._a||!n)&&(!e.docs.isEmpty()||e.hasCachedResults||"Offline"===t)}ia(e){if(e.docChanges.length>0)return!0;const t=this.ra&&this.ra.hasPendingWrites!==e.hasPendingWrites;return!(!e.syncStateChanged&&!t)&&!0===this.options.includeMetadataChanges}oa(e){e=ew.fromInitialDocuments(e.query,e.docs,e.mutatedKeys,e.fromCache,e.hasCachedResults),this.na=!0,this.ta.next(e)}J_(){return this.options.source!==lw.Cache}}class hw{constructor(e){this.key=e}}class fw{constructor(e){this.key=e}}class pw{constructor(e,t){this.query=e,this.Ta=t,this.Ea=null,this.hasCachedResults=!1,this.current=!1,this.da=Bg(),this.mutatedKeys=Bg(),this.Aa=Tg(e),this.Ra=new J_(this.Aa)}get Va(){return this.Ta}ma(e,t){const n=t?t.fa:new $_,i=t?t.Ra:this.Ra;let r=t?t.mutatedKeys:this.mutatedKeys,o=i,a=!1;const s="F"===this.query.limitType&&i.size===this.query.limit?i.last():null,c="L"===this.query.limitType&&i.size===this.query.limit?i.first():null;if(e.inorderTraversal((e,t)=>{const l=i.get(e),u=Sg(this.query,t)?t:null,d=!!l&&this.mutatedKeys.has(l.key),h=!!u&&(u.hasLocalMutations||this.mutatedKeys.has(u.key)&&u.hasCommittedMutations);let f=!1;l&&u?l.data.isEqual(u.data)?d!==h&&(n.track({type:3,doc:u}),f=!0):this.ga(l,u)||(n.track({type:2,doc:u}),f=!0,(s&&this.Aa(u,s)>0||c&&this.Aa(u,c)<0)&&(a=!0)):!l&&u?(n.track({type:0,doc:u}),f=!0):l&&!u&&(n.track({type:1,doc:l}),f=!0,(s||c)&&(a=!0)),f&&(u?(o=o.add(u),r=h?r.add(e):r.delete(e)):(o=o.delete(e),r=r.delete(e)))}),null!==this.query.limit)for(;o.size>this.query.limit;){const e="F"===this.query.limitType?o.last():o.first();o=o.delete(e.key),r=r.delete(e.key),n.track({type:1,doc:e})}return{Ra:o,fa:n,ns:a,mutatedKeys:r}}ga(e,t){return e.hasLocalMutations&&t.hasCommittedMutations&&!t.hasLocalMutations}applyChanges(e,t,n,i){const r=this.Ra;this.Ra=e.Ra,this.mutatedKeys=e.mutatedKeys;const o=e.fa.G_();o.sort((e,t)=>function(e,t){const n=e=>{switch(e){case 0:return 1;case 2:case 3:return 2;case 1:return 0;default:return cp()}};return n(e)-n(t)}(e.type,t.type)||this.Aa(e.doc,t.doc)),this.pa(n),i=null!=i&&i;const a=t&&!i?this.ya():[],s=0===this.da.size&&this.current&&!i?1:0,c=s!==this.Ea;return this.Ea=s,0!==o.length||c?{snapshot:new ew(this.query,e.Ra,r,o,e.mutatedKeys,0===s,c,!1,!!n&&n.resumeToken.approximateByteSize()>0),wa:a}:{wa:a}}Z_(e){return this.current&&"Offline"===e?(this.current=!1,this.applyChanges({Ra:this.Ra,fa:new $_,mutatedKeys:this.mutatedKeys,ns:!1},!1)):{wa:[]}}Sa(e){return!this.Ta.has(e)&&!!this.Ra.has(e)&&!this.Ra.get(e).hasLocalMutations}pa(e){e&&(e.addedDocuments.forEach(e=>this.Ta=this.Ta.add(e)),e.modifiedDocuments.forEach(e=>{}),e.removedDocuments.forEach(e=>this.Ta=this.Ta.delete(e)),this.current=e.current)}ya(){if(!this.current)return[];const e=this.da;this.da=Bg(),this.Ra.forEach(e=>{this.Sa(e.key)&&(this.da=this.da.add(e.key))});const t=[];return e.forEach(e=>{this.da.has(e)||t.push(new fw(e))}),this.da.forEach(n=>{e.has(n)||t.push(new hw(n))}),t}ba(e){this.Ta=e.Ts,this.da=Bg();const t=this.ma(e.documents);return this.applyChanges(t,!0)}Da(){return ew.fromInitialDocuments(this.query,this.Ra,this.mutatedKeys,0===this.Ea,this.hasCachedResults)}}class mw{constructor(e,t,n){this.query=e,this.targetId=t,this.view=n}}class gw{constructor(e){this.key=e,this.va=!1}}class yw{constructor(e,t,n,i,r,o){this.localStore=e,this.remoteStore=t,this.eventManager=n,this.sharedClientState=i,this.currentUser=r,this.maxConcurrentLimboResolutions=o,this.Ca={},this.Fa=new Cg(e=>bg(e),wg),this.Ma=new Map,this.xa=new Set,this.Oa=new tm(Pp.comparator),this.Na=new Map,this.La=new Lv,this.Ba={},this.ka=new Map,this.qa=Cv.kn(),this.onlineState="Unknown",this.Qa=void 0}get isPrimaryClient(){return!0===this.Qa}}async function vw(e,t){let n=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];const i=Uw(e);let r;const o=i.Fa.get(t);return o?(i.sharedClientState.addLocalQueryTarget(o.targetId),r=o.view.Da()):r=await ww(i,t,n,!0),r}async function _w(e,t){const n=Uw(e);await ww(n,t,!0,!1)}async function ww(e,t,n,i){const r=await Jv(e.localStore,yg(t)),o=r.targetId,a=e.sharedClientState.addLocalQueryTarget(o,n);let s;return i&&(s=await bw(e,t,o,"current"===a,r.resumeToken)),e.isPrimaryClient&&n&&S_(e.remoteStore,r),s}async function bw(e,t,n,i,r){e.Ka=(t,n,i)=>async function(e,t,n,i){let r=t.view.ma(n);r.ns&&(r=await e_(e.localStore,t.query,!1).then(e=>{let{documents:n}=e;return t.view.ma(n,r)}));const o=i&&i.targetChanges.get(t.targetId),a=i&&null!=i.targetMismatches.get(t.targetId),s=t.view.applyChanges(r,e.isPrimaryClient,o,a);return Rw(e,t.targetId,s.wa),s.snapshot}(e,t,n,i);const o=await e_(e.localStore,t,!0),a=new pw(t,o.Ts),s=a.ma(o.documents),c=Ly.createSynthesizedTargetChangeForCurrentChange(n,i&&"Offline"!==e.onlineState,r),l=a.applyChanges(s,e.isPrimaryClient,c);Rw(e,n,l.wa);const u=new mw(t,n,a);return e.Fa.set(t,u),e.Ma.has(n)?e.Ma.get(n).push(t):e.Ma.set(n,[t]),l.snapshot}async function xw(e,t,n){const i=up(e),r=i.Fa.get(t),o=i.Ma.get(r.targetId);if(o.length>1)return i.Ma.set(r.targetId,o.filter(e=>!wg(e,t))),void i.Fa.delete(t);i.isPrimaryClient?(i.sharedClientState.removeLocalQueryTarget(r.targetId),i.sharedClientState.isActiveQueryTarget(r.targetId)||await $v(i.localStore,r.targetId,!1).then(()=>{i.sharedClientState.clearQueryState(r.targetId),n&&E_(i.remoteStore,r.targetId),Ow(i,r.targetId)}).catch(Fp)):(Ow(i,r.targetId),await $v(i.localStore,r.targetId,!0))}async function Sw(e,t){const n=up(e),i=n.Fa.get(t),r=n.Ma.get(i.targetId);n.isPrimaryClient&&1===r.length&&(n.sharedClientState.removeLocalQueryTarget(i.targetId),E_(n.remoteStore,i.targetId))}async function Ew(e,t){const n=up(e);try{const e=await function(e,t){const n=up(e),i=t.snapshotVersion;let r=n.os;return n.persistence.runTransaction("Apply remote event","readwrite-primary",e=>{const o=n.cs.newChangeBuffer({trackRemovals:!0});r=n.os;const a=[];t.targetChanges.forEach((o,s)=>{const c=r.get(s);if(!c)return;a.push(n.Ur.removeMatchingKeys(e,o.removedDocuments,s).next(()=>n.Ur.addMatchingKeys(e,o.addedDocuments,s)));let l=c.withSequenceNumber(e.currentSequenceNumber);null!==t.targetMismatches.get(s)?l=l.withResumeToken(cm.EMPTY_BYTE_STRING,Cp.min()).withLastLimboFreeSnapshotVersion(Cp.min()):o.resumeToken.approximateByteSize()>0&&(l=l.withResumeToken(o.resumeToken,i)),r=r.insert(s,l),function(e,t,n){return 0===e.resumeToken.approximateByteSize()||t.snapshotVersion.toMicroseconds()-e.snapshotVersion.toMicroseconds()>=3e8||n.addedDocuments.size+n.modifiedDocuments.size+n.removedDocuments.size>0}(c,l,o)&&a.push(n.Ur.updateTargetData(e,l))});let s=Ag(),c=Bg();if(t.documentUpdates.forEach(i=>{t.resolvedLimboDocuments.has(i)&&a.push(n.persistence.referenceDelegate.updateLimboDocument(e,i))}),a.push(Xv(e,o,t.documentUpdates).next(e=>{s=e.Ps,c=e.Is})),!i.isEqual(Cp.min())){const t=n.Ur.getLastRemoteSnapshotVersion(e).next(t=>n.Ur.setTargetsMetadata(e,e.currentSequenceNumber,i));a.push(t)}return jp.waitFor(a).next(()=>o.apply(e)).next(()=>n.localDocuments.getLocalViewOfDocuments(e,s,c)).next(()=>s)}).then(e=>(n.os=r,e))}(n.localStore,t);t.targetChanges.forEach((e,t)=>{const i=n.Na.get(t);i&&(lp(e.addedDocuments.size+e.modifiedDocuments.size+e.removedDocuments.size<=1),e.addedDocuments.size>0?i.va=!0:e.modifiedDocuments.size>0?lp(i.va):e.removedDocuments.size>0&&(lp(i.va),i.va=!1))}),await Mw(n,e,t)}catch(e){await Fp(e)}}function Tw(e,t,n){const i=up(e);if(i.isPrimaryClient&&0===n||!i.isPrimaryClient&&1===n){const e=[];i.Fa.forEach((n,i)=>{const r=i.view.Z_(t);r.snapshot&&e.push(r.snapshot)}),function(e,t){const n=up(e);n.onlineState=t;let i=!1;n.queries.forEach((e,n)=>{for(const r of n.j_)r.Z_(t)&&(i=!0)}),i&&cw(n)}(i.eventManager,t),e.length&&i.Ca.d_(e),i.onlineState=t,i.isPrimaryClient&&i.sharedClientState.setOnlineState(t)}}async function kw(e,t,n){const i=up(e);i.sharedClientState.updateQueryState(t,"rejected",n);const r=i.Na.get(t),o=r&&r.key;if(o){let e=new tm(Pp.comparator);e=e.insert(o,Dm.newNoDocument(o,Cp.min()));const n=Bg().add(o),r=new Ry(Cp.min(),new Map,new tm(Ep),e,n);await Ew(i,r),i.Oa=i.Oa.remove(o),i.Na.delete(t),zw(i)}else await $v(i.localStore,t,!1).then(()=>Ow(i,t,n)).catch(Fp)}async function Cw(e,t){const n=up(e),i=t.batch.batchId;try{const e=await function(e,t){const n=up(e);return n.persistence.runTransaction("Acknowledge batch","readwrite-primary",e=>{const i=t.batch.keys(),r=n.cs.newChangeBuffer({trackRemovals:!0});return function(e,t,n,i){const r=n.batch,o=r.keys();let a=jp.resolve();return o.forEach(e=>{a=a.next(()=>i.getEntry(t,e)).next(t=>{const o=n.docVersions.get(e);lp(null!==o),t.version.compareTo(o)<0&&(r.applyToRemoteDocument(t,n),t.isValidDocument()&&(t.setReadTime(n.commitVersion),i.addEntry(t)))})}),a.next(()=>e.mutationQueue.removeMutationBatch(t,r))}(n,e,t,r).next(()=>r.apply(e)).next(()=>n.mutationQueue.performConsistencyCheck(e)).next(()=>n.documentOverlayCache.removeOverlaysForBatchId(e,i,t.batch.batchId)).next(()=>n.localDocuments.recalculateAndSaveOverlaysForDocumentKeys(e,function(e){let t=Bg();for(let n=0;n<e.mutationResults.length;++n)e.mutationResults[n].transformResults.length>0&&(t=t.add(e.batch.mutations[n].key));return t}(t))).next(()=>n.localDocuments.getDocuments(e,i))})}(n.localStore,t);Nw(n,i,null),Aw(n,i),n.sharedClientState.updateMutationState(i,"acknowledged"),await Mw(n,e)}catch(e){await Fp(e)}}async function Iw(e,t,n){const i=up(e);try{const e=await function(e,t){const n=up(e);return n.persistence.runTransaction("Reject batch","readwrite-primary",e=>{let i;return n.mutationQueue.lookupMutationBatch(e,t).next(t=>(lp(null!==t),i=t.keys(),n.mutationQueue.removeMutationBatch(e,t))).next(()=>n.mutationQueue.performConsistencyCheck(e)).next(()=>n.documentOverlayCache.removeOverlaysForBatchId(e,i,t)).next(()=>n.localDocuments.recalculateAndSaveOverlaysForDocumentKeys(e,i)).next(()=>n.localDocuments.getDocuments(e,i))})}(i.localStore,t);Nw(i,t,n),Aw(i,t),i.sharedClientState.updateMutationState(t,"rejected",n),await Mw(i,e)}catch(n){await Fp(n)}}function Aw(e,t){(e.ka.get(t)||[]).forEach(e=>{e.resolve()}),e.ka.delete(t)}function Nw(e,t,n){const i=up(e);let r=i.Ba[i.currentUser.toKey()];if(r){const e=r.get(t);e&&(n?e.reject(n):e.resolve(),r=r.remove(t)),i.Ba[i.currentUser.toKey()]=r}}function Ow(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;e.sharedClientState.removeLocalQueryTarget(t);for(const i of e.Ma.get(t))e.Fa.delete(i),n&&e.Ca.$a(i,n);e.Ma.delete(t),e.isPrimaryClient&&e.La.gr(t).forEach(t=>{e.La.containsKey(t)||Pw(e,t)})}function Pw(e,t){e.xa.delete(t.path.canonicalString());const n=e.Oa.get(t);null!==n&&(E_(e.remoteStore,n),e.Oa=e.Oa.remove(t),e.Na.delete(n),zw(e))}function Rw(e,t,n){for(const i of n)i instanceof hw?(e.La.addReference(i.key,t),Lw(e,i)):i instanceof fw?(rp("SyncEngine","Document no longer in limbo: "+i.key),e.La.removeReference(i.key,t),e.La.containsKey(i.key)||Pw(e,i.key)):cp()}function Lw(e,t){const n=t.key,i=n.path.canonicalString();e.Oa.get(n)||e.xa.has(i)||(rp("SyncEngine","New document in limbo: "+n),e.xa.add(i),zw(e))}function zw(e){for(;e.xa.size>0&&e.Oa.size<e.maxConcurrentLimboResolutions;){const t=e.xa.values().next().value;e.xa.delete(t);const n=new Pp(Ap.fromString(t)),i=e.qa.next();e.Na.set(i,new gw(n)),e.Oa=e.Oa.insert(n,i),S_(e.remoteStore,new wv(yg(fg(n.path)),i,"TargetPurposeLimboResolution",Hp.oe))}}async function Mw(e,t,n){const i=up(e),r=[],o=[],a=[];i.Fa.isEmpty()||(i.Fa.forEach((e,s)=>{a.push(i.Ka(s,t,n).then(e=>{var t;if((e||n)&&i.isPrimaryClient){const r=e?!e.fromCache:null===(t=null==n?void 0:n.targetChanges.get(s.targetId))||void 0===t?void 0:t.current;i.sharedClientState.updateQueryState(s.targetId,r?"current":"not-current")}if(e){r.push(e);const t=qv.Wi(s.targetId,e);o.push(t)}}))}),await Promise.all(a),i.Ca.d_(r),await async function(e,t){const n=up(e);try{await n.persistence.runTransaction("notifyLocalViewChanges","readwrite",e=>jp.forEach(t,t=>jp.forEach(t.$i,i=>n.persistence.referenceDelegate.addReference(e,t.targetId,i)).next(()=>jp.forEach(t.Ui,i=>n.persistence.referenceDelegate.removeReference(e,t.targetId,i)))))}catch(e){if(!qp(e))throw e;rp("LocalStore","Failed to update sequence numbers: "+e)}for(const i of t){const e=i.targetId;if(!i.fromCache){const t=n.os.get(e),i=t.snapshotVersion,r=t.withLastLimboFreeSnapshotVersion(i);n.os=n.os.insert(e,r)}}}(i.localStore,o))}async function Dw(e,t){const n=up(e);if(!n.currentUser.isEqual(t)){rp("SyncEngine","User change. New user:",t.toKey());const e=await Zv(n.localStore,t);n.currentUser=t,function(e,t){e.ka.forEach(e=>{e.forEach(e=>{e.reject(new hp(dp.CANCELLED,t))})}),e.ka.clear()}(n,"'waitForPendingWrites' promise is rejected due to a user change."),n.sharedClientState.handleUserChange(t,e.removedBatchIds,e.addedBatchIds),await Mw(n,e.hs)}}function Bw(e,t){const n=up(e),i=n.Na.get(t);if(i&&i.va)return Bg().add(i.key);{let e=Bg();const i=n.Ma.get(t);if(!i)return e;for(const t of i){const i=n.Fa.get(t);e=e.unionWith(i.view.Va)}return e}}function Uw(e){const t=up(e);return t.remoteStore.remoteSyncer.applyRemoteEvent=Ew.bind(null,t),t.remoteStore.remoteSyncer.getRemoteKeysForTarget=Bw.bind(null,t),t.remoteStore.remoteSyncer.rejectListen=kw.bind(null,t),t.Ca.d_=aw.bind(null,t.eventManager),t.Ca.$a=sw.bind(null,t.eventManager),t}function Fw(e){const t=up(e);return t.remoteStore.remoteSyncer.applySuccessfulWrite=Cw.bind(null,t),t.remoteStore.remoteSyncer.rejectFailedWrite=Iw.bind(null,t),t}class jw{constructor(){this.kind="memory",this.synchronizeTabs=!1}async initialize(e){this.serializer=f_(e.databaseInfo.databaseId),this.sharedClientState=this.Wa(e),this.persistence=this.Ga(e),await this.persistence.start(),this.localStore=this.za(e),this.gcScheduler=this.ja(e,this.localStore),this.indexBackfillerScheduler=this.Ha(e,this.localStore)}ja(e,t){return null}Ha(e,t){return null}za(e){return Kv(this.persistence,new Wv,e.initialUser,this.serializer)}Ga(e){return new Fv(Vv.Zr,this.serializer)}Wa(e){return new i_}async terminate(){var e,t;null===(e=this.gcScheduler)||void 0===e||e.stop(),null===(t=this.indexBackfillerScheduler)||void 0===t||t.stop(),this.sharedClientState.shutdown(),await this.persistence.shutdown()}}jw.provider={build:()=>new jw};class Vw{async initialize(e,t){this.localStore||(this.localStore=e.localStore,this.sharedClientState=e.sharedClientState,this.datastore=this.createDatastore(t),this.remoteStore=this.createRemoteStore(t),this.eventManager=this.createEventManager(t),this.syncEngine=this.createSyncEngine(t,!e.synchronizeTabs),this.sharedClientState.onlineStateHandler=e=>Tw(this.syncEngine,e,1),this.remoteStore.remoteSyncer.handleCredentialChange=Dw.bind(null,this.syncEngine),await K_(this.remoteStore,this.syncEngine.isPrimaryClient))}createEventManager(e){return new nw}createDatastore(e){const t=f_(e.databaseInfo.databaseId),n=function(e){return new d_(e)}(e.databaseInfo);return function(e,t,n,i){return new v_(e,t,n,i)}(e.authCredentials,e.appCheckCredentials,n,t)}createRemoteStore(e){return function(e,t,n,i,r){return new w_(e,t,n,i,r)}(this.localStore,this.datastore,e.asyncQueue,e=>Tw(this.syncEngine,e,0),o_.D()?new o_:new r_)}createSyncEngine(e,t){return function(e,t,n,i,r,o,a){const s=new yw(e,t,n,i,r,o);return a&&(s.Qa=!0),s}(this.localStore,this.remoteStore,this.eventManager,this.sharedClientState,e.initialUser,e.maxConcurrentLimboResolutions,t)}async terminate(){var e,t;await async function(e){const t=up(e);rp("RemoteStore","RemoteStore shutting down."),t.L_.add(5),await x_(t),t.k_.shutdown(),t.q_.set("Unknown")}(this.remoteStore),null===(e=this.datastore)||void 0===e||e.terminate(),null===(t=this.eventManager)||void 0===t||t.terminate()}}Vw.provider={build:()=>new Vw};class qw{constructor(e){this.observer=e,this.muted=!1}next(e){this.muted||this.observer.next&&this.Ya(this.observer.next,e)}error(e){this.muted||(this.observer.error?this.Ya(this.observer.error,e):op("Uncaught Error in snapshot listener:",e.toString()))}Za(){this.muted=!0}Ya(e,t){setTimeout(()=>{this.muted||e(t)},0)}}class Hw{constructor(e,t,n,i,r){this.authCredentials=e,this.appCheckCredentials=t,this.asyncQueue=n,this.databaseInfo=i,this.user=ep.UNAUTHENTICATED,this.clientId=Sp.newId(),this.authCredentialListener=()=>Promise.resolve(),this.appCheckCredentialListener=()=>Promise.resolve(),this._uninitializedComponentsProvider=r,this.authCredentials.start(n,async e=>{rp("FirestoreClient","Received user=",e.uid),await this.authCredentialListener(e),this.user=e}),this.appCheckCredentials.start(n,e=>(rp("FirestoreClient","Received new app check token=",e),this.appCheckCredentialListener(e,this.user)))}get configuration(){return{asyncQueue:this.asyncQueue,databaseInfo:this.databaseInfo,clientId:this.clientId,authCredentials:this.authCredentials,appCheckCredentials:this.appCheckCredentials,initialUser:this.user,maxConcurrentLimboResolutions:100}}setCredentialChangeListener(e){this.authCredentialListener=e}setAppCheckTokenChangeListener(e){this.appCheckCredentialListener=e}terminate(){this.asyncQueue.enterRestrictedMode();const e=new fp;return this.asyncQueue.enqueueAndForgetEvenWhileRestricted(async()=>{try{this._onlineComponents&&await this._onlineComponents.terminate(),this._offlineComponents&&await this._offlineComponents.terminate(),this.authCredentials.shutdown(),this.appCheckCredentials.shutdown(),e.resolve()}catch(kk){const n=Y_(kk,"Failed to shutdown persistence");e.reject(n)}}),e.promise}}async function Ww(e,t){e.asyncQueue.verifyOperationInProgress(),rp("FirestoreClient","Initializing OfflineComponentProvider");const n=e.configuration;await t.initialize(n);let i=n.initialUser;e.setCredentialChangeListener(async e=>{i.isEqual(e)||(await Zv(t.localStore,e),i=e)}),t.persistence.setDatabaseDeletedListener(()=>e.terminate()),e._offlineComponents=t}async function Gw(e,t){e.asyncQueue.verifyOperationInProgress();const n=await Kw(e);rp("FirestoreClient","Initializing OnlineComponentProvider"),await t.initialize(n,e.configuration),e.setCredentialChangeListener(e=>G_(t.remoteStore,e)),e.setAppCheckTokenChangeListener((e,n)=>G_(t.remoteStore,n)),e._onlineComponents=t}async function Kw(e){if(!e._offlineComponents)if(e._uninitializedComponentsProvider){rp("FirestoreClient","Using user provided OfflineComponentProvider");try{await Ww(e,e._uninitializedComponentsProvider._offline)}catch(kk){const n=kk;if(!function(e){return"FirebaseError"===e.name?e.code===dp.FAILED_PRECONDITION||e.code===dp.UNIMPLEMENTED:!("undefined"!=typeof DOMException&&e instanceof DOMException)||22===e.code||20===e.code||11===e.code}(n))throw n;ap("Error using user provided cache. Falling back to memory cache: "+n),await Ww(e,new jw)}}else rp("FirestoreClient","Using default OfflineComponentProvider"),await Ww(e,new jw);return e._offlineComponents}async function Zw(e){return e._onlineComponents||(e._uninitializedComponentsProvider?(rp("FirestoreClient","Using user provided OnlineComponentProvider"),await Gw(e,e._uninitializedComponentsProvider._online)):(rp("FirestoreClient","Using default OnlineComponentProvider"),await Gw(e,new Vw))),e._onlineComponents}function Qw(e){return Zw(e).then(e=>e.syncEngine)}async function Xw(e){const t=await Zw(e),n=t.eventManager;return n.onListen=vw.bind(null,t.syncEngine),n.onUnlisten=xw.bind(null,t.syncEngine),n.onFirstRemoteStoreListen=_w.bind(null,t.syncEngine),n.onLastRemoteStoreUnlisten=Sw.bind(null,t.syncEngine),n}function Yw(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};const i=new fp;return e.asyncQueue.enqueueAndForget(async()=>function(e,t,n,i,r){const o=new qw({next:n=>{o.Za(),t.enqueueAndForget(()=>ow(e,a)),n.fromCache&&"server"===i.source?r.reject(new hp(dp.UNAVAILABLE,'Failed to get documents from server. (However, these documents may exist in the local cache. Run again without setting source to "server" to retrieve the cached documents.)')):r.resolve(n)},error:e=>r.reject(e)}),a=new dw(n,o,{includeMetadataChanges:!0,_a:!0});return rw(e,a)}(await Xw(e),e.asyncQueue,t,n,i)),i.promise}function Jw(e){const t={};return void 0!==e.timeoutSeconds&&(t.timeoutSeconds=e.timeoutSeconds),t}const $w=new Map;function eb(e,t,n){if(!n)throw new hp(dp.INVALID_ARGUMENT,"Function ".concat(e,"() cannot be called with an empty ").concat(t,"."))}function tb(e){if(!Pp.isDocumentKey(e))throw new hp(dp.INVALID_ARGUMENT,"Invalid document reference. Document references must have an even number of segments, but ".concat(e," has ").concat(e.length,"."))}function nb(e){if(Pp.isDocumentKey(e))throw new hp(dp.INVALID_ARGUMENT,"Invalid collection reference. Collection references must have an odd number of segments, but ".concat(e," has ").concat(e.length,"."))}function ib(e){if(void 0===e)return"undefined";if(null===e)return"null";if("string"==typeof e)return e.length>20&&(e="".concat(e.substring(0,20),"...")),JSON.stringify(e);if("number"==typeof e||"boolean"==typeof e)return""+e;if("object"==typeof e){if(e instanceof Array)return"an array";{const t=function(e){return e.constructor?e.constructor.name:null}(e);return t?"a custom ".concat(t," object"):"an object"}}return"function"==typeof e?"a function":cp()}function rb(e,t){if("_delegate"in e&&(e=e._delegate),!(e instanceof t)){if(t.name===e.constructor.name)throw new hp(dp.INVALID_ARGUMENT,"Type does not match the expected instance. Did you pass a reference from a different Firestore SDK?");{const n=ib(e);throw new hp(dp.INVALID_ARGUMENT,"Expected type '".concat(t.name,"', but it was: ").concat(n))}}return e}class ob{constructor(e){var t,n;if(void 0===e.host){if(void 0!==e.ssl)throw new hp(dp.INVALID_ARGUMENT,"Can't provide ssl option if host option is not set");this.host="firestore.googleapis.com",this.ssl=!0}else this.host=e.host,this.ssl=null===(t=e.ssl)||void 0===t||t;if(this.credentials=e.credentials,this.ignoreUndefinedProperties=!!e.ignoreUndefinedProperties,this.localCache=e.localCache,void 0===e.cacheSizeBytes)this.cacheSizeBytes=41943040;else{if(-1!==e.cacheSizeBytes&&e.cacheSizeBytes<1048576)throw new hp(dp.INVALID_ARGUMENT,"cacheSizeBytes must be at least 1048576");this.cacheSizeBytes=e.cacheSizeBytes}(function(e,t,n,i){if(!0===t&&!0===i)throw new hp(dp.INVALID_ARGUMENT,"".concat(e," and ").concat(n," cannot be used together."))})("experimentalForceLongPolling",e.experimentalForceLongPolling,"experimentalAutoDetectLongPolling",e.experimentalAutoDetectLongPolling),this.experimentalForceLongPolling=!!e.experimentalForceLongPolling,this.experimentalForceLongPolling?this.experimentalAutoDetectLongPolling=!1:void 0===e.experimentalAutoDetectLongPolling?this.experimentalAutoDetectLongPolling=!0:this.experimentalAutoDetectLongPolling=!!e.experimentalAutoDetectLongPolling,this.experimentalLongPollingOptions=Jw(null!==(n=e.experimentalLongPollingOptions)&&void 0!==n?n:{}),function(e){if(void 0!==e.timeoutSeconds){if(isNaN(e.timeoutSeconds))throw new hp(dp.INVALID_ARGUMENT,"invalid long polling timeout: ".concat(e.timeoutSeconds," (must not be NaN)"));if(e.timeoutSeconds<5)throw new hp(dp.INVALID_ARGUMENT,"invalid long polling timeout: ".concat(e.timeoutSeconds," (minimum allowed value is 5)"));if(e.timeoutSeconds>30)throw new hp(dp.INVALID_ARGUMENT,"invalid long polling timeout: ".concat(e.timeoutSeconds," (maximum allowed value is 30)"))}}(this.experimentalLongPollingOptions),this.useFetchStreams=!!e.useFetchStreams}isEqual(e){return this.host===e.host&&this.ssl===e.ssl&&this.credentials===e.credentials&&this.cacheSizeBytes===e.cacheSizeBytes&&this.experimentalForceLongPolling===e.experimentalForceLongPolling&&this.experimentalAutoDetectLongPolling===e.experimentalAutoDetectLongPolling&&function(e,t){return e.timeoutSeconds===t.timeoutSeconds}(this.experimentalLongPollingOptions,e.experimentalLongPollingOptions)&&this.ignoreUndefinedProperties===e.ignoreUndefinedProperties&&this.useFetchStreams===e.useFetchStreams}}class ab{constructor(e,t,n,i){this._authCredentials=e,this._appCheckCredentials=t,this._databaseId=n,this._app=i,this.type="firestore-lite",this._persistenceKey="(lite)",this._settings=new ob({}),this._settingsFrozen=!1,this._terminateTask="notTerminated"}get app(){if(!this._app)throw new hp(dp.FAILED_PRECONDITION,"Firestore was not initialized using the Firebase SDK. 'app' is not available");return this._app}get _initialized(){return this._settingsFrozen}get _terminated(){return"notTerminated"!==this._terminateTask}_setSettings(e){if(this._settingsFrozen)throw new hp(dp.FAILED_PRECONDITION,"Firestore has already been started and its settings can no longer be changed. You can only modify settings before calling any other methods on a Firestore object.");this._settings=new ob(e),void 0!==e.credentials&&(this._authCredentials=function(e){if(!e)return new mp;switch(e.type){case"firstParty":return new _p(e.sessionIndex||"0",e.iamToken||null,e.authTokenFactory||null);case"provider":return e.client;default:throw new hp(dp.INVALID_ARGUMENT,"makeAuthCredentialsProvider failed due to invalid credential type")}}(e.credentials))}_getSettings(){return this._settings}_freezeSettings(){return this._settingsFrozen=!0,this._settings}_delete(){return"notTerminated"===this._terminateTask&&(this._terminateTask=this._terminate()),this._terminateTask}async _restart(){"notTerminated"===this._terminateTask?await this._terminate():this._terminateTask="notTerminated"}toJSON(){return{app:this._app,databaseId:this._databaseId,settings:this._settings}}_terminate(){return function(e){const t=$w.get(e);t&&(rp("ComponentProvider","Removing Datastore"),$w.delete(e),t.terminate())}(this),Promise.resolve()}}class sb{constructor(e,t,n){this.converter=t,this._query=n,this.type="query",this.firestore=e}withConverter(e){return new sb(this.firestore,e,this._query)}}class cb{constructor(e,t,n){this.converter=t,this._key=n,this.type="document",this.firestore=e}get _path(){return this._key.path}get id(){return this._key.path.lastSegment()}get path(){return this._key.path.canonicalString()}get parent(){return new lb(this.firestore,this.converter,this._key.path.popLast())}withConverter(e){return new cb(this.firestore,e,this._key)}}class lb extends sb{constructor(e,t,n){super(e,t,fg(n)),this._path=n,this.type="collection"}get id(){return this._query.path.lastSegment()}get path(){return this._query.path.canonicalString()}get parent(){const e=this._path.popLast();return e.isEmpty()?null:new cb(this.firestore,null,new Pp(e))}withConverter(e){return new lb(this.firestore,e,this._path)}}function ub(e,t){for(var n=arguments.length,i=new Array(n>2?n-2:0),r=2;r<n;r++)i[r-2]=arguments[r];if(e=lh(e),eb("collection","path",t),e instanceof ab){const n=Ap.fromString(t,...i);return nb(n),new lb(e,null,n)}{if(!(e instanceof cb||e instanceof lb))throw new hp(dp.INVALID_ARGUMENT,"Expected first argument to collection() to be a CollectionReference, a DocumentReference or FirebaseFirestore");const n=e._path.child(Ap.fromString(t,...i));return nb(n),new lb(e.firestore,null,n)}}class db{constructor(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:Promise.resolve();this.Pu=[],this.Iu=!1,this.Tu=[],this.Eu=null,this.du=!1,this.Au=!1,this.Ru=[],this.t_=new p_(this,"async_queue_retry"),this.Vu=()=>{const e=h_();e&&rp("AsyncQueue","Visibility state changed to "+e.visibilityState),this.t_.jo()},this.mu=e;const t=h_();t&&"function"==typeof t.addEventListener&&t.addEventListener("visibilitychange",this.Vu)}get isShuttingDown(){return this.Iu}enqueueAndForget(e){this.enqueue(e)}enqueueAndForgetEvenWhileRestricted(e){this.fu(),this.gu(e)}enterRestrictedMode(e){if(!this.Iu){this.Iu=!0,this.Au=e||!1;const t=h_();t&&"function"==typeof t.removeEventListener&&t.removeEventListener("visibilitychange",this.Vu)}}enqueue(e){if(this.fu(),this.Iu)return new Promise(()=>{});const t=new fp;return this.gu(()=>this.Iu&&this.Au?Promise.resolve():(e().then(t.resolve,t.reject),t.promise)).then(()=>t.promise)}enqueueRetryable(e){this.enqueueAndForget(()=>(this.Pu.push(e),this.pu()))}async pu(){if(0!==this.Pu.length){try{await this.Pu[0](),this.Pu.shift(),this.t_.reset()}catch(Tk){if(!qp(Tk))throw Tk;rp("AsyncQueue","Operation failed with retryable error: "+Tk)}this.Pu.length>0&&this.t_.Go(()=>this.pu())}}gu(e){const t=this.mu.then(()=>(this.du=!0,e().catch(e=>{this.Eu=e,this.du=!1;const t=function(e){let t=e.message||"";return e.stack&&(t=e.stack.includes(e.message)?e.stack:e.message+"\n"+e.stack),t}(e);throw op("INTERNAL UNHANDLED ERROR: ",t),e}).then(e=>(this.du=!1,e))));return this.mu=t,t}enqueueAfterDelay(e,t,n){this.fu(),this.Ru.indexOf(e)>-1&&(t=0);const i=X_.createAndSchedule(this,e,t,n,e=>this.yu(e));return this.Tu.push(i),i}fu(){this.Eu&&cp()}verifyOperationInProgress(){}async wu(){let e;do{e=this.mu,await e}while(e!==this.mu)}Su(e){for(const t of this.Tu)if(t.timerId===e)return!0;return!1}bu(e){return this.wu().then(()=>{this.Tu.sort((e,t)=>e.targetTimeMs-t.targetTimeMs);for(const t of this.Tu)if(t.skipDelay(),"all"!==e&&t.timerId===e)break;return this.wu()})}Du(e){this.Ru.push(e)}yu(e){const t=this.Tu.indexOf(e);this.Tu.splice(t,1)}}class hb extends ab{constructor(e,t,n,i){super(e,t,n,i),this.type="firestore",this._queue=new db,this._persistenceKey=(null==i?void 0:i.name)||"[DEFAULT]"}async _terminate(){if(this._firestoreClient){const e=this._firestoreClient.terminate();this._queue=new db(e),this._firestoreClient=void 0,await e}}}function fb(e){if(e._terminated)throw new hp(dp.FAILED_PRECONDITION,"The client has already been terminated.");return e._firestoreClient||pb(e),e._firestoreClient}function pb(e){var t,n,i;const r=e._freezeSettings(),o=function(e,t,n,i){return new gm(e,t,n,i.host,i.ssl,i.experimentalForceLongPolling,i.experimentalAutoDetectLongPolling,Jw(i.experimentalLongPollingOptions),i.useFetchStreams)}(e._databaseId,(null===(t=e._app)||void 0===t?void 0:t.options.appId)||"",e._persistenceKey,r);e._componentsProvider||(null===(n=r.localCache)||void 0===n?void 0:n._offlineComponentProvider)&&(null===(i=r.localCache)||void 0===i?void 0:i._onlineComponentProvider)&&(e._componentsProvider={_offline:r.localCache._offlineComponentProvider,_online:r.localCache._onlineComponentProvider}),e._firestoreClient=new Hw(e._authCredentials,e._appCheckCredentials,e._queue,o,e._componentsProvider&&function(e){const t=null==e?void 0:e._online.build();return{_offline:null==e?void 0:e._offline.build(t),_online:t}}(e._componentsProvider))}class mb{constructor(e){this._byteString=e}static fromBase64String(e){try{return new mb(cm.fromBase64String(e))}catch(e){throw new hp(dp.INVALID_ARGUMENT,"Failed to construct data from Base64 string: "+e)}}static fromUint8Array(e){return new mb(cm.fromUint8Array(e))}toBase64(){return this._byteString.toBase64()}toUint8Array(){return this._byteString.toUint8Array()}toString(){return"Bytes(base64: "+this.toBase64()+")"}isEqual(e){return this._byteString.isEqual(e._byteString)}}class gb{constructor(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];for(let i=0;i<t.length;++i)if(0===t[i].length)throw new hp(dp.INVALID_ARGUMENT,"Invalid field name at argument $(i + 1). Field names must not be empty.");this._internalPath=new Op(t)}isEqual(e){return this._internalPath.isEqual(e._internalPath)}}class yb{constructor(e){this._methodName=e}}class vb{constructor(e,t){if(!isFinite(e)||e<-90||e>90)throw new hp(dp.INVALID_ARGUMENT,"Latitude must be a number between -90 and 90, but was: "+e);if(!isFinite(t)||t<-180||t>180)throw new hp(dp.INVALID_ARGUMENT,"Longitude must be a number between -180 and 180, but was: "+t);this._lat=e,this._long=t}get latitude(){return this._lat}get longitude(){return this._long}isEqual(e){return this._lat===e._lat&&this._long===e._long}toJSON(){return{latitude:this._lat,longitude:this._long}}_compareTo(e){return Ep(this._lat,e._lat)||Ep(this._long,e._long)}}class _b{constructor(e){this._values=(e||[]).map(e=>e)}toArray(){return this._values.map(e=>e)}isEqual(e){return function(e,t){if(e.length!==t.length)return!1;for(let n=0;n<e.length;++n)if(e[n]!==t[n])return!1;return!0}(this._values,e._values)}}const wb=/^__.*__$/;class bb{constructor(e,t,n){this.data=e,this.fieldMask=t,this.fieldTransforms=n}toMutation(e,t){return null!==this.fieldMask?new hy(e,this.data,this.fieldMask,t,this.fieldTransforms):new dy(e,this.data,t,this.fieldTransforms)}}function xb(e){switch(e){case 0:case 2:case 1:return!0;case 3:case 4:return!1;default:throw cp()}}class Sb{constructor(e,t,n,i,r,o){this.settings=e,this.databaseId=t,this.serializer=n,this.ignoreUndefinedProperties=i,void 0===r&&this.vu(),this.fieldTransforms=r||[],this.fieldMask=o||[]}get path(){return this.settings.path}get Cu(){return this.settings.Cu}Fu(e){return new Sb(Object.assign(Object.assign({},this.settings),e),this.databaseId,this.serializer,this.ignoreUndefinedProperties,this.fieldTransforms,this.fieldMask)}Mu(e){var t;const n=null===(t=this.path)||void 0===t?void 0:t.child(e),i=this.Fu({path:n,xu:!1});return i.Ou(e),i}Nu(e){var t;const n=null===(t=this.path)||void 0===t?void 0:t.child(e),i=this.Fu({path:n,xu:!1});return i.vu(),i}Lu(e){return this.Fu({path:void 0,xu:!0})}Bu(e){return Lb(e,this.settings.methodName,this.settings.ku||!1,this.path,this.settings.qu)}contains(e){return void 0!==this.fieldMask.find(t=>e.isPrefixOf(t))||void 0!==this.fieldTransforms.find(t=>e.isPrefixOf(t.field))}vu(){if(this.path)for(let e=0;e<this.path.length;e++)this.Ou(this.path.get(e))}Ou(e){if(0===e.length)throw this.Bu("Document fields must not be empty");if(xb(this.Cu)&&wb.test(e))throw this.Bu('Document fields cannot begin and end with "__"')}}class Eb{constructor(e,t,n){this.databaseId=e,this.ignoreUndefinedProperties=t,this.serializer=n||f_(e)}Qu(e,t,n){let i=arguments.length>3&&void 0!==arguments[3]&&arguments[3];return new Sb({Cu:e,methodName:t,qu:n,path:Op.emptyPath(),xu:!1,ku:i},this.databaseId,this.serializer,this.ignoreUndefinedProperties)}}function Tb(e){const t=e._freezeSettings(),n=f_(e._databaseId);return new Eb(e._databaseId,!!t.ignoreUndefinedProperties,n)}function kb(e,t,n,i,r){let o=arguments.length>5&&void 0!==arguments[5]?arguments[5]:{};const a=e.Qu(o.merge||o.mergeFields?2:0,t,n,r);Nb("Data must be an object, but it was:",a,i);const s=Ib(i,a);let c,l;if(o.merge)c=new am(a.fieldMask),l=a.fieldTransforms;else if(o.mergeFields){const e=[];for(const i of o.mergeFields){const r=Ob(t,i,n);if(!a.contains(r))throw new hp(dp.INVALID_ARGUMENT,"Field '".concat(r,"' is specified in your field mask but missing from your input data."));zb(e,r)||e.push(r)}c=new am(e),l=a.fieldTransforms.filter(e=>c.covers(e.field))}else c=null,l=a.fieldTransforms;return new bb(new zm(s),c,l)}function Cb(e,t){if(Ab(e=lh(e)))return Nb("Unsupported field value:",t,e),Ib(e,t);if(e instanceof yb)return function(e,t){if(!xb(t.Cu))throw t.Bu("".concat(e._methodName,"() can only be used with update() and set()"));if(!t.path)throw t.Bu("".concat(e._methodName,"() is not currently supported inside arrays"));const n=e._toFieldTransform(t);n&&t.fieldTransforms.push(n)}(e,t),null;if(void 0===e&&t.ignoreUndefinedProperties)return null;if(t.path&&t.fieldMask.push(t.path),e instanceof Array){if(t.settings.xu&&4!==t.Cu)throw t.Bu("Nested arrays are not supported");return function(e,t){const n=[];let i=0;for(const r of e){let e=Cb(r,t.Lu(i));null==e&&(e={nullValue:"NULL_VALUE"}),n.push(e),i++}return{arrayValue:{values:n}}}(e,t)}return function(e,t){if(null===(e=lh(e)))return{nullValue:"NULL_VALUE"};if("number"==typeof e)return qg(t.serializer,e);if("boolean"==typeof e)return{booleanValue:e};if("string"==typeof e)return{stringValue:e};if(e instanceof Date){const n=kp.fromDate(e);return{timestampValue:Ky(t.serializer,n)}}if(e instanceof kp){const n=new kp(e.seconds,1e3*Math.floor(e.nanoseconds/1e3));return{timestampValue:Ky(t.serializer,n)}}if(e instanceof vb)return{geoPointValue:{latitude:e.latitude,longitude:e.longitude}};if(e instanceof mb)return{bytesValue:Zy(t.serializer,e._byteString)};if(e instanceof cb){const n=t.databaseId,i=e.firestore._databaseId;if(!i.isEqual(n))throw t.Bu("Document reference is for database ".concat(i.projectId,"/").concat(i.database," but should be for database ").concat(n.projectId,"/").concat(n.database));return{referenceValue:Yy(e.firestore._databaseId||t.databaseId,e._key.path)}}if(e instanceof _b)return function(e,t){return{mapValue:{fields:{__type__:{stringValue:"__vector__"},value:{arrayValue:{values:e.toArray().map(e=>{if("number"!=typeof e)throw t.Bu("VectorValues must only contain numeric values.");return jg(t.serializer,e)})}}}}}}(e,t);throw t.Bu("Unsupported field value: ".concat(ib(e)))}(e,t)}function Ib(e,t){const n={};return em(e)?t.path&&t.path.length>0&&t.fieldMask.push(t.path):$p(e,(e,i)=>{const r=Cb(i,t.Mu(e));null!=r&&(n[e]=r)}),{mapValue:{fields:n}}}function Ab(e){return!("object"!=typeof e||null===e||e instanceof Array||e instanceof Date||e instanceof kp||e instanceof vb||e instanceof mb||e instanceof cb||e instanceof yb||e instanceof _b)}function Nb(e,t,n){if(!Ab(n)||!function(e){return"object"==typeof e&&null!==e&&(Object.getPrototypeOf(e)===Object.prototype||null===Object.getPrototypeOf(e))}(n)){const i=ib(n);throw"an object"===i?t.Bu(e+" a custom object"):t.Bu(e+" "+i)}}function Ob(e,t,n){if((t=lh(t))instanceof gb)return t._internalPath;if("string"==typeof t)return Rb(e,t);throw Lb("Field path arguments must be of type string or ",e,!1,void 0,n)}const Pb=new RegExp("[~\\*/\\[\\]]");function Rb(e,t,n){if(t.search(Pb)>=0)throw Lb("Invalid field path (".concat(t,"). Paths must not contain '~', '*', '/', '[', or ']'"),e,!1,void 0,n);try{return new gb(...t.split("."))._internalPath}catch(Ak){throw Lb("Invalid field path (".concat(t,"). Paths must not be empty, begin with '.', end with '.', or contain '..'"),e,!1,void 0,n)}}function Lb(e,t,n,i,r){const o=i&&!i.isEmpty(),a=void 0!==r;let s="Function ".concat(t,"() called with invalid data");n&&(s+=" (via `toFirestore()`)"),s+=". ";let c="";return(o||a)&&(c+=" (found",o&&(c+=" in field ".concat(i)),a&&(c+=" in document ".concat(r)),c+=")"),new hp(dp.INVALID_ARGUMENT,s+e+c)}function zb(e,t){return e.some(e=>e.isEqual(t))}class Mb{constructor(e,t,n,i,r){this._firestore=e,this._userDataWriter=t,this._key=n,this._document=i,this._converter=r}get id(){return this._key.path.lastSegment()}get ref(){return new cb(this._firestore,this._converter,this._key)}exists(){return null!==this._document}data(){if(this._document){if(this._converter){const e=new Db(this._firestore,this._userDataWriter,this._key,this._document,null);return this._converter.fromFirestore(e)}return this._userDataWriter.convertValue(this._document.data.value)}}get(e){if(this._document){const t=this._document.data.field(Bb("DocumentSnapshot.get",e));if(null!==t)return this._userDataWriter.convertValue(t)}}}class Db extends Mb{data(){return super.data()}}function Bb(e,t){return"string"==typeof t?Rb(e,t):t instanceof gb?t._internalPath:t._delegate._internalPath}function Ub(e){if("L"===e.limitType&&0===e.explicitOrderBy.length)throw new hp(dp.UNIMPLEMENTED,"limitToLast() queries require specifying at least one orderBy() clause")}class Fb{convertValue(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"none";switch(_m(e)){case 0:return null;case 1:return e.booleanValue;case 2:return dm(e.integerValue||e.doubleValue);case 3:return this.convertTimestamp(e.timestampValue);case 4:return this.convertServerTimestamp(e,t);case 5:return e.stringValue;case 6:return this.convertBytes(hm(e.bytesValue));case 7:return this.convertReference(e.referenceValue);case 8:return this.convertGeoPoint(e.geoPointValue);case 9:return this.convertArray(e.arrayValue,t);case 11:return this.convertObject(e.mapValue,t);case 10:return this.convertVectorValue(e.mapValue);default:throw cp()}}convertObject(e,t){return this.convertObjectMap(e.fields,t)}convertObjectMap(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"none";const n={};return $p(e,(e,i)=>{n[e]=this.convertValue(i,t)}),n}convertVectorValue(e){var t,n,i;const r=null===(i=null===(n=null===(t=e.fields)||void 0===t?void 0:t.value.arrayValue)||void 0===n?void 0:n.values)||void 0===i?void 0:i.map(e=>dm(e.doubleValue));return new _b(r)}convertGeoPoint(e){return new vb(dm(e.latitude),dm(e.longitude))}convertArray(e,t){return(e.values||[]).map(e=>this.convertValue(e,t))}convertServerTimestamp(e,t){switch(t){case"previous":const n=pm(e);return null==n?null:this.convertValue(n,t);case"estimate":return this.convertTimestamp(mm(e));default:return null}}convertTimestamp(e){const t=um(e);return new kp(t.seconds,t.nanos)}convertDocumentKey(e,t){const n=Ap.fromString(e);lp(_v(n));const i=new ym(n.get(1),n.get(3)),r=new Pp(n.popFirst(5));return i.isEqual(t)||op("Document ".concat(r," contains a document reference within a different database (").concat(i.projectId,"/").concat(i.database,") which is not supported. It will be treated as a reference in the current database (").concat(t.projectId,"/").concat(t.database,") instead.")),r}}function jb(e,t,n){let i;return i=e?n&&(n.merge||n.mergeFields)?e.toFirestore(t,n):e.toFirestore(t):t,i}class Vb{constructor(e,t){this.hasPendingWrites=e,this.fromCache=t}isEqual(e){return this.hasPendingWrites===e.hasPendingWrites&&this.fromCache===e.fromCache}}class qb extends Mb{constructor(e,t,n,i,r,o){super(e,t,n,i,o),this._firestore=e,this._firestoreImpl=e,this.metadata=r}exists(){return super.exists()}data(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};if(this._document){if(this._converter){const t=new Hb(this._firestore,this._userDataWriter,this._key,this._document,this.metadata,null);return this._converter.fromFirestore(t,e)}return this._userDataWriter.convertValue(this._document.data.value,e.serverTimestamps)}}get(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};if(this._document){const n=this._document.data.field(Bb("DocumentSnapshot.get",e));if(null!==n)return this._userDataWriter.convertValue(n,t.serverTimestamps)}}}class Hb extends qb{data(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return super.data(e)}}class Wb{constructor(e,t,n,i){this._firestore=e,this._userDataWriter=t,this._snapshot=i,this.metadata=new Vb(i.hasPendingWrites,i.fromCache),this.query=n}get docs(){const e=[];return this.forEach(t=>e.push(t)),e}get size(){return this._snapshot.docs.size}get empty(){return 0===this.size}forEach(e,t){this._snapshot.docs.forEach(n=>{e.call(t,new Hb(this._firestore,this._userDataWriter,n.key,n,new Vb(this._snapshot.mutatedKeys.has(n.key),this._snapshot.fromCache),this.query.converter))})}docChanges(){const e=!!(arguments.length>0&&void 0!==arguments[0]?arguments[0]:{}).includeMetadataChanges;if(e&&this._snapshot.excludesMetadataChanges)throw new hp(dp.INVALID_ARGUMENT,"To include metadata changes with your document changes, you must also pass { includeMetadataChanges:true } to onSnapshot().");return this._cachedChanges&&this._cachedChangesIncludeMetadataChanges===e||(this._cachedChanges=function(e,t){if(e._snapshot.oldDocs.isEmpty()){let t=0;return e._snapshot.docChanges.map(n=>{const i=new Hb(e._firestore,e._userDataWriter,n.doc.key,n.doc,new Vb(e._snapshot.mutatedKeys.has(n.doc.key),e._snapshot.fromCache),e.query.converter);return n.doc,{type:"added",doc:i,oldIndex:-1,newIndex:t++}})}{let n=e._snapshot.oldDocs;return e._snapshot.docChanges.filter(e=>t||3!==e.type).map(t=>{const i=new Hb(e._firestore,e._userDataWriter,t.doc.key,t.doc,new Vb(e._snapshot.mutatedKeys.has(t.doc.key),e._snapshot.fromCache),e.query.converter);let r=-1,o=-1;return 0!==t.type&&(r=n.indexOf(t.doc.key),n=n.delete(t.doc.key)),1!==t.type&&(n=n.add(t.doc),o=n.indexOf(t.doc.key)),{type:Gb(t.type),doc:i,oldIndex:r,newIndex:o}})}}(this,e),this._cachedChangesIncludeMetadataChanges=e),this._cachedChanges}}function Gb(e){switch(e){case 0:return"added";case 2:case 3:return"modified";case 1:return"removed";default:return cp()}}class Kb extends Fb{constructor(e){super(),this.firestore=e}convertBytes(e){return new mb(e)}convertReference(e){const t=this.convertDocumentKey(e,this.firestore._databaseId);return new cb(this.firestore,null,t)}}function Zb(e,t){const n=rb(e.firestore,hb),i=function(e,t){for(var n=arguments.length,i=new Array(n>2?n-2:0),r=2;r<n;r++)i[r-2]=arguments[r];if(e=lh(e),1===arguments.length&&(t=Sp.newId()),eb("doc","path",t),e instanceof ab){const n=Ap.fromString(t,...i);return tb(n),new cb(e,null,new Pp(n))}{if(!(e instanceof cb||e instanceof lb))throw new hp(dp.INVALID_ARGUMENT,"Expected first argument to collection() to be a CollectionReference, a DocumentReference or FirebaseFirestore");const n=e._path.child(Ap.fromString(t,...i));return tb(n),new cb(e.firestore,e instanceof lb?e.converter:null,new Pp(n))}}(e),r=jb(e.converter,t);return Qb(n,[kb(Tb(e.firestore),"addDoc",i._key,r,null!==e.converter,{}).toMutation(i._key,iy.exists(!1))]).then(()=>i)}function Qb(e,t){return function(e,t){const n=new fp;return e.asyncQueue.enqueueAndForget(async()=>async function(e,t,n){const i=Fw(e);try{const e=await function(e,t){const n=up(e),i=kp.now(),r=t.reduce((e,t)=>e.add(t.key),Bg());let o,a;return n.persistence.runTransaction("Locally write mutations","readwrite",e=>{let s=Ag(),c=Bg();return n.cs.getEntries(e,r).next(e=>{s=e,s.forEach((e,t)=>{t.isValidDocument()||(c=c.add(e))})}).next(()=>n.localDocuments.getOverlayedDocuments(e,s)).next(r=>{o=r;const a=[];for(const e of t){const t=ly(e,o.get(e.key).overlayedDocument);null!=t&&a.push(new hy(e.key,t,Mm(t.value.mapValue),iy.exists(!0)))}return n.mutationQueue.addMutationBatch(e,i,a,t)}).next(t=>{a=t;const i=t.applyToLocalDocumentSet(o,c);return n.documentOverlayCache.saveOverlays(e,t.batchId,i)})}).then(()=>({batchId:a.batchId,changes:Pg(o)}))}(i.localStore,t);i.sharedClientState.addPendingMutation(e.batchId),function(e,t,n){let i=e.Ba[e.currentUser.toKey()];i||(i=new tm(Ep)),i=i.insert(t,n),e.Ba[e.currentUser.toKey()]=i}(i,e.batchId,n),await Mw(i,e.changes),await D_(i.remoteStore)}catch(e){const t=Y_(e,"Failed to persist write");n.reject(t)}}(await Qw(e),t,n)),n.promise}(fb(e),t)}new WeakMap;!function(e){let t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];!function(e){tp=e}(Tf),wf(new uh("firestore",(e,n)=>{let{instanceIdentifier:i,options:r}=n;const o=e.getProvider("app").getImmediate(),a=new hb(new yp(e.getProvider("auth-internal")),new bp(e.getProvider("app-check-internal")),function(e,t){if(!Object.prototype.hasOwnProperty.apply(e.options,["projectId"]))throw new hp(dp.INVALID_ARGUMENT,'"projectId" not provided in firebase.initializeApp.');return new ym(e.options.projectId,t)}(o,i),o);return r=Object.assign({useFetchStreams:t},r),a._setSettings(r),a},"PUBLIC").setMultipleInstances(!0)),If($f,"4.7.3",e),If($f,"4.7.3","esm2017")}();const Xb="firebasestorage.googleapis.com",Yb="storageBucket";class Jb extends $d{constructor(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;super(tx(e),"Firebase Storage: ".concat(t," (").concat(tx(e),")")),this.status_=n,this.customData={serverResponse:null},this._baseMessage=this.message,Object.setPrototypeOf(this,Jb.prototype)}get status(){return this.status_}set status(e){this.status_=e}_codeEquals(e){return tx(e)===this.code}get serverResponse(){return this.customData.serverResponse}set serverResponse(e){this.customData.serverResponse=e,this.customData.serverResponse?this.message="".concat(this._baseMessage,"\n").concat(this.customData.serverResponse):this.message=this._baseMessage}}var $b,ex;function tx(e){return"storage/"+e}function nx(){return new Jb($b.UNKNOWN,"An unknown error occurred, please check the error payload for server response.")}function ix(){return new Jb($b.RETRY_LIMIT_EXCEEDED,"Max retry time for operation exceeded, please try again.")}function rx(){return new Jb($b.CANCELED,"User canceled the upload/download.")}function ox(){return new Jb($b.CANNOT_SLICE_BLOB,"Cannot slice blob for upload. Please retry the upload.")}function ax(e){return new Jb($b.INVALID_ARGUMENT,e)}function sx(){return new Jb($b.APP_DELETED,"The Firebase app was deleted.")}function cx(e,t){return new Jb($b.INVALID_FORMAT,"String does not match format '"+e+"': "+t)}function lx(e){throw new Jb($b.INTERNAL_ERROR,"Internal error: "+e)}!function(e){e.UNKNOWN="unknown",e.OBJECT_NOT_FOUND="object-not-found",e.BUCKET_NOT_FOUND="bucket-not-found",e.PROJECT_NOT_FOUND="project-not-found",e.QUOTA_EXCEEDED="quota-exceeded",e.UNAUTHENTICATED="unauthenticated",e.UNAUTHORIZED="unauthorized",e.UNAUTHORIZED_APP="unauthorized-app",e.RETRY_LIMIT_EXCEEDED="retry-limit-exceeded",e.INVALID_CHECKSUM="invalid-checksum",e.CANCELED="canceled",e.INVALID_EVENT_NAME="invalid-event-name",e.INVALID_URL="invalid-url",e.INVALID_DEFAULT_BUCKET="invalid-default-bucket",e.NO_DEFAULT_BUCKET="no-default-bucket",e.CANNOT_SLICE_BLOB="cannot-slice-blob",e.SERVER_FILE_WRONG_SIZE="server-file-wrong-size",e.NO_DOWNLOAD_URL="no-download-url",e.INVALID_ARGUMENT="invalid-argument",e.INVALID_ARGUMENT_COUNT="invalid-argument-count",e.APP_DELETED="app-deleted",e.INVALID_ROOT_OPERATION="invalid-root-operation",e.INVALID_FORMAT="invalid-format",e.INTERNAL_ERROR="internal-error",e.UNSUPPORTED_ENVIRONMENT="unsupported-environment"}($b||($b={}));class ux{constructor(e,t){this.bucket=e,this.path_=t}get path(){return this.path_}get isRoot(){return 0===this.path.length}fullServerUrl(){const e=encodeURIComponent;return"/b/"+e(this.bucket)+"/o/"+e(this.path)}bucketOnlyServerUrl(){return"/b/"+encodeURIComponent(this.bucket)+"/o"}static makeFromBucketSpec(e,t){let n;try{n=ux.makeFromUrl(e,t)}catch(Tk){return new ux(e,"")}if(""===n.path)return n;throw i=e,new Jb($b.INVALID_DEFAULT_BUCKET,"Invalid default bucket '"+i+"'.");var i}static makeFromUrl(e,t){let n=null;const i="([A-Za-z0-9.\\-_]+)";const r=new RegExp("^gs://"+i+"(/(.*))?$","i");function o(e){e.path_=decodeURIComponent(e.path)}const a=t.replace(/[.]/g,"\\."),s=[{regex:r,indices:{bucket:1,path:3},postModify:function(e){"/"===e.path.charAt(e.path.length-1)&&(e.path_=e.path_.slice(0,-1))}},{regex:new RegExp("^https?://".concat(a,"/").concat("v[A-Za-z0-9_]+","/b/").concat(i,"/o").concat("(/([^?#]*).*)?$"),"i"),indices:{bucket:1,path:3},postModify:o},{regex:new RegExp("^https?://".concat(t===Xb?"(?:storage.googleapis.com|storage.cloud.google.com)":t,"/").concat(i,"/").concat("([^?#]*)"),"i"),indices:{bucket:1,path:2},postModify:o}];for(let c=0;c<s.length;c++){const t=s[c],i=t.regex.exec(e);if(i){const e=i[t.indices.bucket];let r=i[t.indices.path];r||(r=""),n=new ux(e,r),t.postModify(n);break}}if(null==n)throw function(e){return new Jb($b.INVALID_URL,"Invalid URL '"+e+"'.")}(e);return n}}class dx{constructor(e){this.promise_=Promise.reject(e)}getPromise(){return this.promise_}cancel(){}}function hx(e){return"string"===typeof e||e instanceof String}function fx(e){return px()&&e instanceof Blob}function px(){return"undefined"!==typeof Blob}function mx(e,t,n,i){if(i<t)throw ax("Invalid value for '".concat(e,"'. Expected ").concat(t," or greater."));if(i>n)throw ax("Invalid value for '".concat(e,"'. Expected ").concat(n," or less."))}function gx(e,t,n){let i=t;return null==n&&(i="https://".concat(t)),"".concat(n,"://").concat(i,"/v0").concat(e)}function yx(e){const t=encodeURIComponent;let n="?";for(const i in e)if(e.hasOwnProperty(i)){n=n+(t(i)+"="+t(e[i]))+"&"}return n=n.slice(0,-1),n}function vx(e,t){const n=e>=500&&e<600,i=-1!==[408,429].indexOf(e),r=-1!==t.indexOf(e);return n||i||r}!function(e){e[e.NO_ERROR=0]="NO_ERROR",e[e.NETWORK_ERROR=1]="NETWORK_ERROR",e[e.ABORT=2]="ABORT"}(ex||(ex={}));class _x{constructor(e,t,n,i,r,o,a,s,c,l,u){let d=!(arguments.length>11&&void 0!==arguments[11])||arguments[11];this.url_=e,this.method_=t,this.headers_=n,this.body_=i,this.successCodes_=r,this.additionalRetryCodes_=o,this.callback_=a,this.errorCallback_=s,this.timeout_=c,this.progressCallback_=l,this.connectionFactory_=u,this.retry=d,this.pendingConnection_=null,this.backoffId_=null,this.canceled_=!1,this.appDelete_=!1,this.promise_=new Promise((e,t)=>{this.resolve_=e,this.reject_=t,this.start_()})}start_(){const e=(e,t)=>{if(t)return void e(!1,new wx(!1,null,!0));const n=this.connectionFactory_();this.pendingConnection_=n;const i=e=>{const t=e.loaded,n=e.lengthComputable?e.total:-1;null!==this.progressCallback_&&this.progressCallback_(t,n)};null!==this.progressCallback_&&n.addUploadProgressListener(i),n.send(this.url_,this.method_,this.body_,this.headers_).then(()=>{null!==this.progressCallback_&&n.removeUploadProgressListener(i),this.pendingConnection_=null;const t=n.getErrorCode()===ex.NO_ERROR,r=n.getStatus();if(!t||vx(r,this.additionalRetryCodes_)&&this.retry){const t=n.getErrorCode()===ex.ABORT;return void e(!1,new wx(!1,null,t))}const o=-1!==this.successCodes_.indexOf(r);e(!0,new wx(o,n))})},t=(e,t)=>{const n=this.resolve_,i=this.reject_,r=t.connection;if(t.wasSuccessCode)try{const e=this.callback_(r,r.getResponse());void 0!==e?n(e):n()}catch(Tk){i(Tk)}else if(null!==r){const e=nx();e.serverResponse=r.getErrorText(),this.errorCallback_?i(this.errorCallback_(r,e)):i(e)}else if(t.canceled){i(this.appDelete_?sx():rx())}else{i(ix())}};this.canceled_?t(0,new wx(!1,null,!0)):this.backoffId_=function(e,t,n){let i=1,r=null,o=null,a=!1,s=0;function c(){return 2===s}let l=!1;function u(){if(!l){l=!0;for(var e=arguments.length,n=new Array(e),i=0;i<e;i++)n[i]=arguments[i];t.apply(null,n)}}function d(t){r=setTimeout(()=>{r=null,e(f,c())},t)}function h(){o&&clearTimeout(o)}function f(e){if(l)return void h();for(var t=arguments.length,n=new Array(t>1?t-1:0),r=1;r<t;r++)n[r-1]=arguments[r];if(e)return h(),void u.call(null,e,...n);if(c()||a)return h(),void u.call(null,e,...n);let o;i<64&&(i*=2),1===s?(s=2,o=0):o=1e3*(i+Math.random()),d(o)}let p=!1;function m(e){p||(p=!0,h(),l||(null!==r?(e||(s=2),clearTimeout(r),d(0)):e||(s=1)))}return d(0),o=setTimeout(()=>{a=!0,m(!0)},n),m}(e,t,this.timeout_)}getPromise(){return this.promise_}cancel(e){this.canceled_=!0,this.appDelete_=e||!1,null!==this.backoffId_&&function(e){e(!1)}(this.backoffId_),null!==this.pendingConnection_&&this.pendingConnection_.abort()}}class wx{constructor(e,t,n){this.wasSuccessCode=e,this.connection=t,this.canceled=!!n}}function bx(){return"undefined"!==typeof BlobBuilder?BlobBuilder:"undefined"!==typeof WebKitBlobBuilder?WebKitBlobBuilder:void 0}function xx(){const e=bx();for(var t=arguments.length,n=new Array(t),i=0;i<t;i++)n[i]=arguments[i];if(void 0!==e){const t=new e;for(let e=0;e<n.length;e++)t.append(n[e]);return t.getBlob()}if(px())return new Blob(n);throw new Jb($b.UNSUPPORTED_ENVIRONMENT,"This browser doesn't seem to support creating Blobs")}function Sx(e){if("undefined"===typeof atob)throw t="base-64",new Jb($b.UNSUPPORTED_ENVIRONMENT,"".concat(t," is missing. Make sure to install the required polyfills. See https://firebase.google.com/docs/web/environments-js-sdk#polyfills for more information."));var t;return atob(e)}const Ex="raw",Tx="base64",kx="base64url",Cx="data_url";class Ix{constructor(e,t){this.data=e,this.contentType=t||null}}function Ax(e,t){switch(e){case Ex:return new Ix(Nx(t));case Tx:case kx:return new Ix(Ox(e,t));case Cx:return new Ix(function(e){const t=new Px(e);return t.base64?Ox(Tx,t.rest):function(e){let t;try{t=decodeURIComponent(e)}catch(Tk){throw cx(Cx,"Malformed data URL.")}return Nx(t)}(t.rest)}(t),new Px(t).contentType)}throw nx()}function Nx(e){const t=[];for(let n=0;n<e.length;n++){let i=e.charCodeAt(n);if(i<=127)t.push(i);else if(i<=2047)t.push(192|i>>6,128|63&i);else if(55296===(64512&i)){if(n<e.length-1&&56320===(64512&e.charCodeAt(n+1))){i=65536|(1023&i)<<10|1023&e.charCodeAt(++n),t.push(240|i>>18,128|i>>12&63,128|i>>6&63,128|63&i)}else t.push(239,191,189)}else 56320===(64512&i)?t.push(239,191,189):t.push(224|i>>12,128|i>>6&63,128|63&i)}return new Uint8Array(t)}function Ox(e,t){switch(e){case Tx:{const n=-1!==t.indexOf("-"),i=-1!==t.indexOf("_");if(n||i){throw cx(e,"Invalid character '"+(n?"-":"_")+"' found: is it base64url encoded?")}break}case kx:{const n=-1!==t.indexOf("+"),i=-1!==t.indexOf("/");if(n||i){throw cx(e,"Invalid character '"+(n?"+":"/")+"' found: is it base64 encoded?")}t=t.replace(/-/g,"+").replace(/_/g,"/");break}}let n;try{n=Sx(t)}catch(Tk){if(Tk.message.includes("polyfill"))throw Tk;throw cx(e,"Invalid character found")}const i=new Uint8Array(n.length);for(let r=0;r<n.length;r++)i[r]=n.charCodeAt(r);return i}class Px{constructor(e){this.base64=!1,this.contentType=null;const t=e.match(/^data:([^,]+)?,/);if(null===t)throw cx(Cx,"Must be formatted 'data:[<mediatype>][;base64],<data>");const n=t[1]||null;null!=n&&(this.base64=function(e,t){const n=e.length>=t.length;if(!n)return!1;return e.substring(e.length-t.length)===t}(n,";base64"),this.contentType=this.base64?n.substring(0,n.length-7):n),this.rest=e.substring(e.indexOf(",")+1)}}class Rx{constructor(e,t){let n=0,i="";fx(e)?(this.data_=e,n=e.size,i=e.type):e instanceof ArrayBuffer?(t?this.data_=new Uint8Array(e):(this.data_=new Uint8Array(e.byteLength),this.data_.set(new Uint8Array(e))),n=this.data_.length):e instanceof Uint8Array&&(t?this.data_=e:(this.data_=new Uint8Array(e.length),this.data_.set(e)),n=e.length),this.size_=n,this.type_=i}size(){return this.size_}type(){return this.type_}slice(e,t){if(fx(this.data_)){const n=function(e,t,n){return e.webkitSlice?e.webkitSlice(t,n):e.mozSlice?e.mozSlice(t,n):e.slice?e.slice(t,n):null}(this.data_,e,t);return null===n?null:new Rx(n)}{const n=new Uint8Array(this.data_.buffer,e,t-e);return new Rx(n,!0)}}static getBlob(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];if(px()){const e=t.map(e=>e instanceof Rx?e.data_:e);return new Rx(xx.apply(null,e))}{const e=t.map(e=>hx(e)?Ax(Ex,e).data:e.data_);let n=0;e.forEach(e=>{n+=e.byteLength});const i=new Uint8Array(n);let r=0;return e.forEach(e=>{for(let t=0;t<e.length;t++)i[r++]=e[t]}),new Rx(i,!0)}}uploadData(){return this.data_}}function Lx(e){let t;try{t=JSON.parse(e)}catch(Tk){return null}return"object"!==typeof(n=t)||Array.isArray(n)?null:t;var n}function zx(e){const t=e.lastIndexOf("/",e.length-2);return-1===t?e:e.slice(t+1)}function Mx(e,t){return t}class Dx{constructor(e,t,n,i){this.server=e,this.local=t||e,this.writable=!!n,this.xform=i||Mx}}let Bx=null;function Ux(){if(Bx)return Bx;const e=[];e.push(new Dx("bucket")),e.push(new Dx("generation")),e.push(new Dx("metageneration")),e.push(new Dx("name","fullPath",!0));const t=new Dx("name");t.xform=function(e,t){return function(e){return!hx(e)||e.length<2?e:zx(e)}(t)},e.push(t);const n=new Dx("size");return n.xform=function(e,t){return void 0!==t?Number(t):t},e.push(n),e.push(new Dx("timeCreated")),e.push(new Dx("updated")),e.push(new Dx("md5Hash",null,!0)),e.push(new Dx("cacheControl",null,!0)),e.push(new Dx("contentDisposition",null,!0)),e.push(new Dx("contentEncoding",null,!0)),e.push(new Dx("contentLanguage",null,!0)),e.push(new Dx("contentType",null,!0)),e.push(new Dx("metadata","customMetadata",!0)),Bx=e,Bx}function Fx(e,t,n){const i={type:"file"},r=n.length;for(let o=0;o<r;o++){const e=n[o];i[e.local]=e.xform(i,t[e.server])}return function(e,t){Object.defineProperty(e,"ref",{get:function(){const n=e.bucket,i=e.fullPath,r=new ux(n,i);return t._makeStorageReference(r)}})}(i,e),i}function jx(e,t,n){const i=Lx(t);if(null===i)return null;return Fx(e,i,n)}function Vx(e,t){const n={},i=t.length;for(let r=0;r<i;r++){const i=t[r];i.writable&&(n[i.server]=e[i.local])}return JSON.stringify(n)}class qx{constructor(e,t,n,i){this.url=e,this.method=t,this.handler=n,this.timeout=i,this.urlParams={},this.headers={},this.body=null,this.errorHandler=null,this.progressCallback=null,this.successCodes=[200],this.additionalRetryCodes=[]}}function Hx(e){if(!e)throw nx()}function Wx(e,t){return function(n,i){const r=jx(e,i,t);return Hx(null!==r),r}}function Gx(e,t){return function(n,i){const r=jx(e,i,t);return Hx(null!==r),function(e,t,n,i){const r=Lx(t);if(null===r)return null;if(!hx(r.downloadTokens))return null;const o=r.downloadTokens;if(0===o.length)return null;const a=encodeURIComponent;return o.split(",").map(t=>{const r=e.bucket,o=e.fullPath;return gx("/b/"+a(r)+"/o/"+a(o),n,i)+yx({alt:"media",token:t})})[0]}(r,i,e.host,e._protocol)}}function Kx(e){return function(t,n){let i;var r,o;return 401===t.getStatus()?i=t.getErrorText().includes("Firebase App Check token is invalid")?new Jb($b.UNAUTHORIZED_APP,"This app does not have permission to access Firebase Storage on this project."):new Jb($b.UNAUTHENTICATED,"User is not authenticated, please authenticate using Firebase Authentication and try again."):402===t.getStatus()?(o=e.bucket,i=new Jb($b.QUOTA_EXCEEDED,"Quota for bucket '"+o+"' exceeded, please view quota on https://firebase.google.com/pricing/.")):403===t.getStatus()?(r=e.path,i=new Jb($b.UNAUTHORIZED,"User does not have permission to access '"+r+"'.")):i=n,i.status=t.getStatus(),i.serverResponse=n.serverResponse,i}}function Zx(e){const t=Kx(e);return function(n,i){let r=t(n,i);var o;return 404===n.getStatus()&&(o=e.path,r=new Jb($b.OBJECT_NOT_FOUND,"Object '"+o+"' does not exist.")),r.serverResponse=i.serverResponse,r}}function Qx(e,t,n){const i=Object.assign({},n);return i.fullPath=e.path,i.size=t.size(),i.contentType||(i.contentType=function(e,t){return e&&e.contentType||t&&t.type()||"application/octet-stream"}(null,t)),i}function Xx(e,t,n,i,r){const o=t.bucketOnlyServerUrl(),a={"X-Goog-Upload-Protocol":"multipart"};const s=function(){let e="";for(let t=0;t<2;t++)e+=Math.random().toString().slice(2);return e}();a["Content-Type"]="multipart/related; boundary="+s;const c=Qx(t,i,r),l="--"+s+"\r\nContent-Type: application/json; charset=utf-8\r\n\r\n"+Vx(c,n)+"\r\n--"+s+"\r\nContent-Type: "+c.contentType+"\r\n\r\n",u="\r\n--"+s+"--",d=Rx.getBlob(l,i,u);if(null===d)throw ox();const h={name:c.fullPath},f=gx(o,e.host,e._protocol),p=e.maxUploadRetryTime,m=new qx(f,"POST",Wx(e,n),p);return m.urlParams=h,m.headers=a,m.body=d.uploadData(),m.errorHandler=Kx(t),m}class Yx{constructor(){this.sent_=!1,this.xhr_=new XMLHttpRequest,this.initXhr(),this.errorCode_=ex.NO_ERROR,this.sendPromise_=new Promise(e=>{this.xhr_.addEventListener("abort",()=>{this.errorCode_=ex.ABORT,e()}),this.xhr_.addEventListener("error",()=>{this.errorCode_=ex.NETWORK_ERROR,e()}),this.xhr_.addEventListener("load",()=>{e()})})}send(e,t,n,i){if(this.sent_)throw lx("cannot .send() more than once");if(this.sent_=!0,this.xhr_.open(t,e,!0),void 0!==i)for(const r in i)i.hasOwnProperty(r)&&this.xhr_.setRequestHeader(r,i[r].toString());return void 0!==n?this.xhr_.send(n):this.xhr_.send(),this.sendPromise_}getErrorCode(){if(!this.sent_)throw lx("cannot .getErrorCode() before sending");return this.errorCode_}getStatus(){if(!this.sent_)throw lx("cannot .getStatus() before sending");try{return this.xhr_.status}catch(Tk){return-1}}getResponse(){if(!this.sent_)throw lx("cannot .getResponse() before sending");return this.xhr_.response}getErrorText(){if(!this.sent_)throw lx("cannot .getErrorText() before sending");return this.xhr_.statusText}abort(){this.xhr_.abort()}getResponseHeader(e){return this.xhr_.getResponseHeader(e)}addUploadProgressListener(e){null!=this.xhr_.upload&&this.xhr_.upload.addEventListener("progress",e)}removeUploadProgressListener(e){null!=this.xhr_.upload&&this.xhr_.upload.removeEventListener("progress",e)}}class Jx extends Yx{initXhr(){this.xhr_.responseType="text"}}function $x(){return new Jx}class eS{constructor(e,t){this._service=e,this._location=t instanceof ux?t:ux.makeFromUrl(t,e.host)}toString(){return"gs://"+this._location.bucket+"/"+this._location.path}_newRef(e,t){return new eS(e,t)}get root(){const e=new ux(this._location.bucket,"");return this._newRef(this._service,e)}get bucket(){return this._location.bucket}get fullPath(){return this._location.path}get name(){return zx(this._location.path)}get storage(){return this._service}get parent(){const e=function(e){if(0===e.length)return null;const t=e.lastIndexOf("/");return-1===t?"":e.slice(0,t)}(this._location.path);if(null===e)return null;const t=new ux(this._location.bucket,e);return new eS(this._service,t)}_throwIfRoot(e){if(""===this._location.path)throw function(e){return new Jb($b.INVALID_ROOT_OPERATION,"The operation '"+e+"' cannot be performed on a root reference, create a non-root reference using child, such as .child('file.png').")}(e)}}function tS(e,t,n){e._throwIfRoot("uploadBytes");const i=Xx(e.storage,e._location,Ux(),new Rx(t,!0),n);return e.storage.makeRequestWithTokens(i,$x).then(t=>({metadata:t,ref:e}))}function nS(e){e._throwIfRoot("getDownloadURL");const t=function(e,t,n){const i=gx(t.fullServerUrl(),e.host,e._protocol),r=e.maxOperationRetryTime,o=new qx(i,"GET",Gx(e,n),r);return o.errorHandler=Zx(t),o}(e.storage,e._location,Ux());return e.storage.makeRequestWithTokens(t,$x).then(e=>{if(null===e)throw new Jb($b.NO_DOWNLOAD_URL,"The given file does not have any download URLs.");return e})}function iS(e,t){const n=function(e,t){const n=t.split("/").filter(e=>e.length>0).join("/");return 0===e.length?n:e+"/"+n}(e._location.path,t),i=new ux(e._location.bucket,n);return new eS(e.storage,i)}function rS(e,t){if(e instanceof sS){const n=e;if(null==n._bucket)throw new Jb($b.NO_DEFAULT_BUCKET,"No default bucket found. Did you set the '"+Yb+"' property when initializing the app?");const i=new eS(n,n._bucket);return null!=t?rS(i,t):i}return void 0!==t?iS(e,t):e}function oS(e,t){if(t&&/^[A-Za-z]+:\/\//.test(t)){if(e instanceof sS)return new eS(e,t);throw ax("To use ref(service, url), the first argument must be a Storage instance.")}return rS(e,t)}function aS(e,t){const n=null===t||void 0===t?void 0:t[Yb];return null==n?null:ux.makeFromBucketSpec(n,e)}class sS{constructor(e,t,n,i,r){this.app=e,this._authProvider=t,this._appCheckProvider=n,this._url=i,this._firebaseVersion=r,this._bucket=null,this._host=Xb,this._protocol="https",this._appId=null,this._deleted=!1,this._maxOperationRetryTime=12e4,this._maxUploadRetryTime=6e5,this._requests=new Set,this._bucket=null!=i?ux.makeFromBucketSpec(i,this._host):aS(this._host,this.app.options)}get host(){return this._host}set host(e){this._host=e,null!=this._url?this._bucket=ux.makeFromBucketSpec(this._url,e):this._bucket=aS(e,this.app.options)}get maxUploadRetryTime(){return this._maxUploadRetryTime}set maxUploadRetryTime(e){mx("time",0,Number.POSITIVE_INFINITY,e),this._maxUploadRetryTime=e}get maxOperationRetryTime(){return this._maxOperationRetryTime}set maxOperationRetryTime(e){mx("time",0,Number.POSITIVE_INFINITY,e),this._maxOperationRetryTime=e}async _getAuthToken(){if(this._overrideAuthToken)return this._overrideAuthToken;const e=this._authProvider.getImmediate({optional:!0});if(e){const t=await e.getToken();if(null!==t)return t.accessToken}return null}async _getAppCheckToken(){const e=this._appCheckProvider.getImmediate({optional:!0});if(e){return(await e.getToken()).token}return null}_delete(){return this._deleted||(this._deleted=!0,this._requests.forEach(e=>e.cancel()),this._requests.clear()),Promise.resolve()}_makeStorageReference(e){return new eS(this,e)}_makeRequest(e,t,n,i){let r=!(arguments.length>4&&void 0!==arguments[4])||arguments[4];if(this._deleted)return new dx(sx());{const o=function(e,t,n,i,r,o){let a=!(arguments.length>6&&void 0!==arguments[6])||arguments[6];const s=yx(e.urlParams),c=e.url+s,l=Object.assign({},e.headers);return function(e,t){t&&(e["X-Firebase-GMPID"]=t)}(l,t),function(e,t){null!==t&&t.length>0&&(e.Authorization="Firebase "+t)}(l,n),function(e,t){e["X-Firebase-Storage-Version"]="webjs/"+(null!==t&&void 0!==t?t:"AppManager")}(l,o),function(e,t){null!==t&&(e["X-Firebase-AppCheck"]=t)}(l,i),new _x(c,e.method,l,e.body,e.successCodes,e.additionalRetryCodes,e.handler,e.errorHandler,e.timeout,e.progressCallback,r,a)}(e,this._appId,n,i,t,this._firebaseVersion,r);return this._requests.add(o),o.getPromise().then(()=>this._requests.delete(o),()=>this._requests.delete(o)),o}}async makeRequestWithTokens(e,t){const[n,i]=await Promise.all([this._getAuthToken(),this._getAppCheckToken()]);return this._makeRequest(e,t,n,i).getPromise()}}const cS="@firebase/storage",lS="0.13.2",uS="storage";function dS(e,t){let{instanceIdentifier:n}=t;const i=e.getProvider("app").getImmediate(),r=e.getProvider("auth-internal"),o=e.getProvider("app-check-internal");return new sS(i,r,o,n,Tf)}wf(new uh(uS,dS,"PUBLIC").setMultipleInstances(!0)),If(cS,lS,""),If(cS,lS,"esm2017");function hS(e,t){var n={};for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&t.indexOf(i)<0&&(n[i]=e[i]);if(null!=e&&"function"===typeof Object.getOwnPropertySymbols){var r=0;for(i=Object.getOwnPropertySymbols(e);r<i.length;r++)t.indexOf(i[r])<0&&Object.prototype.propertyIsEnumerable.call(e,i[r])&&(n[i[r]]=e[i[r]])}return n}Object.create;Object.create;"function"===typeof SuppressedError&&SuppressedError;function fS(){return{"dependent-sdk-initialized-before-auth":"Another Firebase SDK was initialized and is trying to use Auth before Auth is initialized. Please be sure to call `initializeAuth` or `getAuth` before starting any other Firebase SDK."}}const pS=fS,mS=new eh("auth","Firebase",{"dependent-sdk-initialized-before-auth":"Another Firebase SDK was initialized and is trying to use Auth before Auth is initialized. Please be sure to call `initializeAuth` or `getAuth` before starting any other Firebase SDK."}),gS=new wh("@firebase/auth");function yS(e){if(gS.logLevel<=mh.ERROR){for(var t=arguments.length,n=new Array(t>1?t-1:0),i=1;i<t;i++)n[i-1]=arguments[i];gS.error("Auth (".concat(Tf,"): ").concat(e),...n)}}function vS(e){for(var t=arguments.length,n=new Array(t>1?t-1:0),i=1;i<t;i++)n[i-1]=arguments[i];throw xS(e,...n)}function _S(e){for(var t=arguments.length,n=new Array(t>1?t-1:0),i=1;i<t;i++)n[i-1]=arguments[i];return xS(e,...n)}function wS(e,t,n){const i=Object.assign(Object.assign({},pS()),{[t]:n});return new eh("auth","Firebase",i).create(t,{appName:e.name})}function bS(e){return wS(e,"operation-not-supported-in-this-environment","Operations that alter the current user are not supported in conjunction with FirebaseServerApp")}function xS(e){for(var t=arguments.length,n=new Array(t>1?t-1:0),i=1;i<t;i++)n[i-1]=arguments[i];if("string"!==typeof e){const t=n[0],i=[...n.slice(1)];return i[0]&&(i[0].appName=e.name),e._errorFactory.create(t,...i)}return mS.create(e,...n)}function SS(e,t){if(!e){for(var n=arguments.length,i=new Array(n>2?n-2:0),r=2;r<n;r++)i[r-2]=arguments[r];throw xS(t,...i)}}function ES(e){const t="INTERNAL ASSERTION FAILED: "+e;throw yS(t),new Error(t)}function TS(e,t){e||ES(t)}function kS(){var e;return"undefined"!==typeof self&&(null===(e=self.location)||void 0===e?void 0:e.href)||""}function CS(){return"http:"===IS()||"https:"===IS()}function IS(){var e;return"undefined"!==typeof self&&(null===(e=self.location)||void 0===e?void 0:e.protocol)||null}function AS(){return!("undefined"!==typeof navigator&&navigator&&"onLine"in navigator&&"boolean"===typeof navigator.onLine&&(CS()||function(){const e="object"===typeof chrome?chrome.runtime:"object"===typeof browser?browser.runtime:void 0;return"object"===typeof e&&void 0!==e.id}()||"connection"in navigator))||navigator.onLine}class NS{constructor(e,t){this.shortDelay=e,this.longDelay=t,TS(t>e,"Short delay should be less than long delay!"),this.isMobile="undefined"!==typeof window&&!!(window.cordova||window.phonegap||window.PhoneGap)&&/ios|iphone|ipod|ipad|android|blackberry|iemobile/i.test(Xd())||"object"===typeof navigator&&"ReactNative"===navigator.product}get(){return AS()?this.isMobile?this.longDelay:this.shortDelay:Math.min(5e3,this.shortDelay)}}function OS(e,t){TS(e.emulator,"Emulator should always be set here");const{url:n}=e.emulator;return t?"".concat(n).concat(t.startsWith("/")?t.slice(1):t):n}class PS{static initialize(e,t,n){this.fetchImpl=e,t&&(this.headersImpl=t),n&&(this.responseImpl=n)}static fetch(){return this.fetchImpl?this.fetchImpl:"undefined"!==typeof self&&"fetch"in self?self.fetch:"undefined"!==typeof globalThis&&globalThis.fetch?globalThis.fetch:"undefined"!==typeof fetch?fetch:void ES("Could not find fetch implementation, make sure you call FetchProvider.initialize() with an appropriate polyfill")}static headers(){return this.headersImpl?this.headersImpl:"undefined"!==typeof self&&"Headers"in self?self.Headers:"undefined"!==typeof globalThis&&globalThis.Headers?globalThis.Headers:"undefined"!==typeof Headers?Headers:void ES("Could not find Headers implementation, make sure you call FetchProvider.initialize() with an appropriate polyfill")}static response(){return this.responseImpl?this.responseImpl:"undefined"!==typeof self&&"Response"in self?self.Response:"undefined"!==typeof globalThis&&globalThis.Response?globalThis.Response:"undefined"!==typeof Response?Response:void ES("Could not find Response implementation, make sure you call FetchProvider.initialize() with an appropriate polyfill")}}const RS={CREDENTIAL_MISMATCH:"custom-token-mismatch",MISSING_CUSTOM_TOKEN:"internal-error",INVALID_IDENTIFIER:"invalid-email",MISSING_CONTINUE_URI:"internal-error",INVALID_PASSWORD:"wrong-password",MISSING_PASSWORD:"missing-password",INVALID_LOGIN_CREDENTIALS:"invalid-credential",EMAIL_EXISTS:"email-already-in-use",PASSWORD_LOGIN_DISABLED:"operation-not-allowed",INVALID_IDP_RESPONSE:"invalid-credential",INVALID_PENDING_TOKEN:"invalid-credential",FEDERATED_USER_ID_ALREADY_LINKED:"credential-already-in-use",MISSING_REQ_TYPE:"internal-error",EMAIL_NOT_FOUND:"user-not-found",RESET_PASSWORD_EXCEED_LIMIT:"too-many-requests",EXPIRED_OOB_CODE:"expired-action-code",INVALID_OOB_CODE:"invalid-action-code",MISSING_OOB_CODE:"internal-error",CREDENTIAL_TOO_OLD_LOGIN_AGAIN:"requires-recent-login",INVALID_ID_TOKEN:"invalid-user-token",TOKEN_EXPIRED:"user-token-expired",USER_NOT_FOUND:"user-token-expired",TOO_MANY_ATTEMPTS_TRY_LATER:"too-many-requests",PASSWORD_DOES_NOT_MEET_REQUIREMENTS:"password-does-not-meet-requirements",INVALID_CODE:"invalid-verification-code",INVALID_SESSION_INFO:"invalid-verification-id",INVALID_TEMPORARY_PROOF:"invalid-credential",MISSING_SESSION_INFO:"missing-verification-id",SESSION_EXPIRED:"code-expired",MISSING_ANDROID_PACKAGE_NAME:"missing-android-pkg-name",UNAUTHORIZED_DOMAIN:"unauthorized-continue-uri",INVALID_OAUTH_CLIENT_ID:"invalid-oauth-client-id",ADMIN_ONLY_OPERATION:"admin-restricted-operation",INVALID_MFA_PENDING_CREDENTIAL:"invalid-multi-factor-session",MFA_ENROLLMENT_NOT_FOUND:"multi-factor-info-not-found",MISSING_MFA_ENROLLMENT_ID:"missing-multi-factor-info",MISSING_MFA_PENDING_CREDENTIAL:"missing-multi-factor-session",SECOND_FACTOR_EXISTS:"second-factor-already-in-use",SECOND_FACTOR_LIMIT_EXCEEDED:"maximum-second-factor-count-exceeded",BLOCKING_FUNCTION_ERROR_RESPONSE:"internal-error",RECAPTCHA_NOT_ENABLED:"recaptcha-not-enabled",MISSING_RECAPTCHA_TOKEN:"missing-recaptcha-token",INVALID_RECAPTCHA_TOKEN:"invalid-recaptcha-token",INVALID_RECAPTCHA_ACTION:"invalid-recaptcha-action",MISSING_CLIENT_TYPE:"missing-client-type",MISSING_RECAPTCHA_VERSION:"missing-recaptcha-version",INVALID_RECAPTCHA_VERSION:"invalid-recaptcha-version",INVALID_REQ_TYPE:"invalid-req-type"},LS=new NS(3e4,6e4);function zS(e,t){return e.tenantId&&!t.tenantId?Object.assign(Object.assign({},t),{tenantId:e.tenantId}):t}async function MS(e,t,n,i){return DS(e,arguments.length>4&&void 0!==arguments[4]?arguments[4]:{},async()=>{let r={},o={};i&&("GET"===t?o=i:r={body:JSON.stringify(i)});const a=rh(Object.assign({key:e.config.apiKey},o)).slice(1),s=await e._getAdditionalHeaders();s["Content-Type"]="application/json",e.languageCode&&(s["X-Firebase-Locale"]=e.languageCode);const c=Object.assign({method:t,headers:s},r);return"undefined"!==typeof navigator&&"Cloudflare-Workers"===navigator.userAgent||(c.referrerPolicy="no-referrer"),PS.fetch()(US(e,e.config.apiHost,n,a),c)})}async function DS(e,t,n){e._canInitEmulator=!1;const i=Object.assign(Object.assign({},RS),t);try{const t=new jS(e),r=await Promise.race([n(),t.promise]);t.clearNetworkTimeout();const o=await r.json();if("needConfirmation"in o)throw VS(e,"account-exists-with-different-credential",o);if(r.ok&&!("errorMessage"in o))return o;{const t=r.ok?o.errorMessage:o.error.message,[n,a]=t.split(" : ");if("FEDERATED_USER_ID_ALREADY_LINKED"===n)throw VS(e,"credential-already-in-use",o);if("EMAIL_EXISTS"===n)throw VS(e,"email-already-in-use",o);if("USER_DISABLED"===n)throw VS(e,"user-disabled",o);const s=i[n]||n.toLowerCase().replace(/[_\s]+/g,"-");if(a)throw wS(e,s,a);vS(e,s)}}catch(Tk){if(Tk instanceof $d)throw Tk;vS(e,"network-request-failed",{message:String(Tk)})}}async function BS(e,t,n,i){let r=arguments.length>4&&void 0!==arguments[4]?arguments[4]:{};const o=await MS(e,t,n,i,r);return"mfaPendingCredential"in o&&vS(e,"multi-factor-auth-required",{_serverResponse:o}),o}function US(e,t,n,i){const r="".concat(t).concat(n,"?").concat(i);return e.config.emulator?OS(e.config,r):"".concat(e.config.apiScheme,"://").concat(r)}function FS(e){switch(e){case"ENFORCE":return"ENFORCE";case"AUDIT":return"AUDIT";case"OFF":return"OFF";default:return"ENFORCEMENT_STATE_UNSPECIFIED"}}class jS{constructor(e){this.auth=e,this.timer=null,this.promise=new Promise((e,t)=>{this.timer=setTimeout(()=>t(_S(this.auth,"network-request-failed")),LS.get())})}clearNetworkTimeout(){clearTimeout(this.timer)}}function VS(e,t,n){const i={appName:e.name};n.email&&(i.email=n.email),n.phoneNumber&&(i.phoneNumber=n.phoneNumber);const r=_S(e,t,i);return r.customData._tokenResponse=n,r}function qS(e){return void 0!==e&&void 0!==e.enterprise}class HS{constructor(e){if(this.siteKey="",this.recaptchaEnforcementState=[],void 0===e.recaptchaKey)throw new Error("recaptchaKey undefined");this.siteKey=e.recaptchaKey.split("/")[3],this.recaptchaEnforcementState=e.recaptchaEnforcementState}getProviderEnforcementState(e){if(!this.recaptchaEnforcementState||0===this.recaptchaEnforcementState.length)return null;for(const t of this.recaptchaEnforcementState)if(t.provider&&t.provider===e)return FS(t.enforcementState);return null}isProviderEnabled(e){return"ENFORCE"===this.getProviderEnforcementState(e)||"AUDIT"===this.getProviderEnforcementState(e)}}async function WS(e,t){return MS(e,"GET","/v2/recaptchaConfig",zS(e,t))}async function GS(e,t){return MS(e,"POST","/v1/accounts:lookup",t)}function KS(e){if(e)try{const t=new Date(Number(e));if(!isNaN(t.getTime()))return t.toUTCString()}catch(Tk){}}function ZS(e){return 1e3*Number(e)}function QS(e){const[t,n,i]=e.split(".");if(void 0===t||void 0===n||void 0===i)return yS("JWT malformed, contained fewer than 3 sections"),null;try{const e=jd(n);return e?JSON.parse(e):(yS("Failed to decode base64 JWT payload"),null)}catch(Tk){return yS("Caught error parsing JWT payload as JSON",null===Tk||void 0===Tk?void 0:Tk.toString()),null}}function XS(e){const t=QS(e);return SS(t,"internal-error"),SS("undefined"!==typeof t.exp,"internal-error"),SS("undefined"!==typeof t.iat,"internal-error"),Number(t.exp)-Number(t.iat)}async function YS(e,t){if(arguments.length>2&&void 0!==arguments[2]&&arguments[2])return t;try{return await t}catch(Tk){throw Tk instanceof $d&&function(e){let{code:t}=e;return t==="auth/".concat("user-disabled")||t==="auth/".concat("user-token-expired")}(Tk)&&e.auth.currentUser===e&&await e.auth.signOut(),Tk}}class JS{constructor(e){this.user=e,this.isRunning=!1,this.timerId=null,this.errorBackoff=3e4}_start(){this.isRunning||(this.isRunning=!0,this.schedule())}_stop(){this.isRunning&&(this.isRunning=!1,null!==this.timerId&&clearTimeout(this.timerId))}getInterval(e){var t;if(e){const e=this.errorBackoff;return this.errorBackoff=Math.min(2*this.errorBackoff,96e4),e}{this.errorBackoff=3e4;const e=(null!==(t=this.user.stsTokenManager.expirationTime)&&void 0!==t?t:0)-Date.now()-3e5;return Math.max(0,e)}}schedule(){let e=arguments.length>0&&void 0!==arguments[0]&&arguments[0];if(!this.isRunning)return;const t=this.getInterval(e);this.timerId=setTimeout(async()=>{await this.iteration()},t)}async iteration(){try{await this.user.getIdToken(!0)}catch(Tk){return void((null===Tk||void 0===Tk?void 0:Tk.code)==="auth/".concat("network-request-failed")&&this.schedule(!0))}this.schedule()}}class $S{constructor(e,t){this.createdAt=e,this.lastLoginAt=t,this._initializeTime()}_initializeTime(){this.lastSignInTime=KS(this.lastLoginAt),this.creationTime=KS(this.createdAt)}_copy(e){this.createdAt=e.createdAt,this.lastLoginAt=e.lastLoginAt,this._initializeTime()}toJSON(){return{createdAt:this.createdAt,lastLoginAt:this.lastLoginAt}}}async function eE(e){var t;const n=e.auth,i=await e.getIdToken(),r=await YS(e,GS(n,{idToken:i}));SS(null===r||void 0===r?void 0:r.users.length,n,"internal-error");const o=r.users[0];e._notifyReloadListener(o);const a=(null===(t=o.providerUserInfo)||void 0===t?void 0:t.length)?tE(o.providerUserInfo):[],s=function(e,t){const n=e.filter(e=>!t.some(t=>t.providerId===e.providerId));return[...n,...t]}(e.providerData,a),c=e.isAnonymous,l=!(e.email&&o.passwordHash)&&!(null===s||void 0===s?void 0:s.length),u=!!c&&l,d={uid:o.localId,displayName:o.displayName||null,photoURL:o.photoUrl||null,email:o.email||null,emailVerified:o.emailVerified||!1,phoneNumber:o.phoneNumber||null,tenantId:o.tenantId||null,providerData:s,metadata:new $S(o.createdAt,o.lastLoginAt),isAnonymous:u};Object.assign(e,d)}function tE(e){return e.map(e=>{var{providerId:t}=e,n=hS(e,["providerId"]);return{providerId:t,uid:n.rawId||"",displayName:n.displayName||null,email:n.email||null,phoneNumber:n.phoneNumber||null,photoURL:n.photoUrl||null}})}class nE{constructor(){this.refreshToken=null,this.accessToken=null,this.expirationTime=null}get isExpired(){return!this.expirationTime||Date.now()>this.expirationTime-3e4}updateFromServerResponse(e){SS(e.idToken,"internal-error"),SS("undefined"!==typeof e.idToken,"internal-error"),SS("undefined"!==typeof e.refreshToken,"internal-error");const t="expiresIn"in e&&"undefined"!==typeof e.expiresIn?Number(e.expiresIn):XS(e.idToken);this.updateTokensAndExpiration(e.idToken,e.refreshToken,t)}updateFromIdToken(e){SS(0!==e.length,"internal-error");const t=XS(e);this.updateTokensAndExpiration(e,null,t)}async getToken(e){return arguments.length>1&&void 0!==arguments[1]&&arguments[1]||!this.accessToken||this.isExpired?(SS(this.refreshToken,e,"user-token-expired"),this.refreshToken?(await this.refresh(e,this.refreshToken),this.accessToken):null):this.accessToken}clearRefreshToken(){this.refreshToken=null}async refresh(e,t){const{accessToken:n,refreshToken:i,expiresIn:r}=await async function(e,t){const n=await DS(e,{},async()=>{const n=rh({grant_type:"refresh_token",refresh_token:t}).slice(1),{tokenApiHost:i,apiKey:r}=e.config,o=US(e,i,"/v1/token","key=".concat(r)),a=await e._getAdditionalHeaders();return a["Content-Type"]="application/x-www-form-urlencoded",PS.fetch()(o,{method:"POST",headers:a,body:n})});return{accessToken:n.access_token,expiresIn:n.expires_in,refreshToken:n.refresh_token}}(e,t);this.updateTokensAndExpiration(n,i,Number(r))}updateTokensAndExpiration(e,t,n){this.refreshToken=t||null,this.accessToken=e||null,this.expirationTime=Date.now()+1e3*n}static fromJSON(e,t){const{refreshToken:n,accessToken:i,expirationTime:r}=t,o=new nE;return n&&(SS("string"===typeof n,"internal-error",{appName:e}),o.refreshToken=n),i&&(SS("string"===typeof i,"internal-error",{appName:e}),o.accessToken=i),r&&(SS("number"===typeof r,"internal-error",{appName:e}),o.expirationTime=r),o}toJSON(){return{refreshToken:this.refreshToken,accessToken:this.accessToken,expirationTime:this.expirationTime}}_assign(e){this.accessToken=e.accessToken,this.refreshToken=e.refreshToken,this.expirationTime=e.expirationTime}_clone(){return Object.assign(new nE,this.toJSON())}_performRefresh(){return ES("not implemented")}}function iE(e,t){SS("string"===typeof e||"undefined"===typeof e,"internal-error",{appName:t})}class rE{constructor(e){var{uid:t,auth:n,stsTokenManager:i}=e,r=hS(e,["uid","auth","stsTokenManager"]);this.providerId="firebase",this.proactiveRefresh=new JS(this),this.reloadUserInfo=null,this.reloadListener=null,this.uid=t,this.auth=n,this.stsTokenManager=i,this.accessToken=i.accessToken,this.displayName=r.displayName||null,this.email=r.email||null,this.emailVerified=r.emailVerified||!1,this.phoneNumber=r.phoneNumber||null,this.photoURL=r.photoURL||null,this.isAnonymous=r.isAnonymous||!1,this.tenantId=r.tenantId||null,this.providerData=r.providerData?[...r.providerData]:[],this.metadata=new $S(r.createdAt||void 0,r.lastLoginAt||void 0)}async getIdToken(e){const t=await YS(this,this.stsTokenManager.getToken(this.auth,e));return SS(t,this.auth,"internal-error"),this.accessToken!==t&&(this.accessToken=t,await this.auth._persistUserIfCurrent(this),this.auth._notifyListenersIfCurrent(this)),t}getIdTokenResult(e){return async function(e){let t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];const n=lh(e),i=await n.getIdToken(t),r=QS(i);SS(r&&r.exp&&r.auth_time&&r.iat,n.auth,"internal-error");const o="object"===typeof r.firebase?r.firebase:void 0,a=null===o||void 0===o?void 0:o.sign_in_provider;return{claims:r,token:i,authTime:KS(ZS(r.auth_time)),issuedAtTime:KS(ZS(r.iat)),expirationTime:KS(ZS(r.exp)),signInProvider:a||null,signInSecondFactor:(null===o||void 0===o?void 0:o.sign_in_second_factor)||null}}(this,e)}reload(){return async function(e){const t=lh(e);await eE(t),await t.auth._persistUserIfCurrent(t),t.auth._notifyListenersIfCurrent(t)}(this)}_assign(e){this!==e&&(SS(this.uid===e.uid,this.auth,"internal-error"),this.displayName=e.displayName,this.photoURL=e.photoURL,this.email=e.email,this.emailVerified=e.emailVerified,this.phoneNumber=e.phoneNumber,this.isAnonymous=e.isAnonymous,this.tenantId=e.tenantId,this.providerData=e.providerData.map(e=>Object.assign({},e)),this.metadata._copy(e.metadata),this.stsTokenManager._assign(e.stsTokenManager))}_clone(e){const t=new rE(Object.assign(Object.assign({},this),{auth:e,stsTokenManager:this.stsTokenManager._clone()}));return t.metadata._copy(this.metadata),t}_onReload(e){SS(!this.reloadListener,this.auth,"internal-error"),this.reloadListener=e,this.reloadUserInfo&&(this._notifyReloadListener(this.reloadUserInfo),this.reloadUserInfo=null)}_notifyReloadListener(e){this.reloadListener?this.reloadListener(e):this.reloadUserInfo=e}_startProactiveRefresh(){this.proactiveRefresh._start()}_stopProactiveRefresh(){this.proactiveRefresh._stop()}async _updateTokensIfNecessary(e){let t=arguments.length>1&&void 0!==arguments[1]&&arguments[1],n=!1;e.idToken&&e.idToken!==this.stsTokenManager.accessToken&&(this.stsTokenManager.updateFromServerResponse(e),n=!0),t&&await eE(this),await this.auth._persistUserIfCurrent(this),n&&this.auth._notifyListenersIfCurrent(this)}async delete(){if(xf(this.auth.app))return Promise.reject(bS(this.auth));const e=await this.getIdToken();return await YS(this,async function(e,t){return MS(e,"POST","/v1/accounts:delete",t)}(this.auth,{idToken:e})),this.stsTokenManager.clearRefreshToken(),this.auth.signOut()}toJSON(){return Object.assign(Object.assign({uid:this.uid,email:this.email||void 0,emailVerified:this.emailVerified,displayName:this.displayName||void 0,isAnonymous:this.isAnonymous,photoURL:this.photoURL||void 0,phoneNumber:this.phoneNumber||void 0,tenantId:this.tenantId||void 0,providerData:this.providerData.map(e=>Object.assign({},e)),stsTokenManager:this.stsTokenManager.toJSON(),_redirectEventId:this._redirectEventId},this.metadata.toJSON()),{apiKey:this.auth.config.apiKey,appName:this.auth.name})}get refreshToken(){return this.stsTokenManager.refreshToken||""}static _fromJSON(e,t){var n,i,r,o,a,s,c,l;const u=null!==(n=t.displayName)&&void 0!==n?n:void 0,d=null!==(i=t.email)&&void 0!==i?i:void 0,h=null!==(r=t.phoneNumber)&&void 0!==r?r:void 0,f=null!==(o=t.photoURL)&&void 0!==o?o:void 0,p=null!==(a=t.tenantId)&&void 0!==a?a:void 0,m=null!==(s=t._redirectEventId)&&void 0!==s?s:void 0,g=null!==(c=t.createdAt)&&void 0!==c?c:void 0,y=null!==(l=t.lastLoginAt)&&void 0!==l?l:void 0,{uid:v,emailVerified:_,isAnonymous:w,providerData:b,stsTokenManager:x}=t;SS(v&&x,e,"internal-error");const S=nE.fromJSON(this.name,x);SS("string"===typeof v,e,"internal-error"),iE(u,e.name),iE(d,e.name),SS("boolean"===typeof _,e,"internal-error"),SS("boolean"===typeof w,e,"internal-error"),iE(h,e.name),iE(f,e.name),iE(p,e.name),iE(m,e.name),iE(g,e.name),iE(y,e.name);const E=new rE({uid:v,auth:e,email:d,emailVerified:_,displayName:u,isAnonymous:w,photoURL:f,phoneNumber:h,tenantId:p,stsTokenManager:S,createdAt:g,lastLoginAt:y});return b&&Array.isArray(b)&&(E.providerData=b.map(e=>Object.assign({},e))),m&&(E._redirectEventId=m),E}static async _fromIdTokenResponse(e,t){let n=arguments.length>2&&void 0!==arguments[2]&&arguments[2];const i=new nE;i.updateFromServerResponse(t);const r=new rE({uid:t.localId,auth:e,stsTokenManager:i,isAnonymous:n});return await eE(r),r}static async _fromGetAccountInfoResponse(e,t,n){const i=t.users[0];SS(void 0!==i.localId,"internal-error");const r=void 0!==i.providerUserInfo?tE(i.providerUserInfo):[],o=!(i.email&&i.passwordHash)&&!(null===r||void 0===r?void 0:r.length),a=new nE;a.updateFromIdToken(n);const s=new rE({uid:i.localId,auth:e,stsTokenManager:a,isAnonymous:o}),c={uid:i.localId,displayName:i.displayName||null,photoURL:i.photoUrl||null,email:i.email||null,emailVerified:i.emailVerified||!1,phoneNumber:i.phoneNumber||null,tenantId:i.tenantId||null,providerData:r,metadata:new $S(i.createdAt,i.lastLoginAt),isAnonymous:!(i.email&&i.passwordHash)&&!(null===r||void 0===r?void 0:r.length)};return Object.assign(s,c),s}}const oE=new Map;function aE(e){TS(e instanceof Function,"Expected a class definition");let t=oE.get(e);return t?(TS(t instanceof e,"Instance stored in cache mismatched with class"),t):(t=new e,oE.set(e,t),t)}class sE{constructor(){this.type="NONE",this.storage={}}async _isAvailable(){return!0}async _set(e,t){this.storage[e]=t}async _get(e){const t=this.storage[e];return void 0===t?null:t}async _remove(e){delete this.storage[e]}_addListener(e,t){}_removeListener(e,t){}}sE.type="NONE";const cE=sE;function lE(e,t,n){return"firebase".concat(":",e,":").concat(t,":").concat(n)}class uE{constructor(e,t,n){this.persistence=e,this.auth=t,this.userKey=n;const{config:i,name:r}=this.auth;this.fullUserKey=lE(this.userKey,i.apiKey,r),this.fullPersistenceKey=lE("persistence",i.apiKey,r),this.boundEventHandler=t._onStorageEvent.bind(t),this.persistence._addListener(this.fullUserKey,this.boundEventHandler)}setCurrentUser(e){return this.persistence._set(this.fullUserKey,e.toJSON())}async getCurrentUser(){const e=await this.persistence._get(this.fullUserKey);return e?rE._fromJSON(this.auth,e):null}removeCurrentUser(){return this.persistence._remove(this.fullUserKey)}savePersistenceForRedirect(){return this.persistence._set(this.fullPersistenceKey,this.persistence.type)}async setPersistence(e){if(this.persistence===e)return;const t=await this.getCurrentUser();return await this.removeCurrentUser(),this.persistence=e,t?this.setCurrentUser(t):void 0}delete(){this.persistence._removeListener(this.fullUserKey,this.boundEventHandler)}static async create(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"authUser";if(!t.length)return new uE(aE(cE),e,n);const i=(await Promise.all(t.map(async e=>{if(await e._isAvailable())return e}))).filter(e=>e);let r=i[0]||aE(cE);const o=lE(n,e.config.apiKey,e.name);let a=null;for(const c of t)try{const t=await c._get(o);if(t){const n=rE._fromJSON(e,t);c!==r&&(a=n),r=c;break}}catch(we){}const s=i.filter(e=>e._shouldAllowMigration);return r._shouldAllowMigration&&s.length?(r=s[0],a&&await r._set(o,a.toJSON()),await Promise.all(t.map(async e=>{if(e!==r)try{await e._remove(o)}catch(we){}})),new uE(r,e,n)):new uE(r,e,n)}}function dE(e){const t=e.toLowerCase();if(t.includes("opera/")||t.includes("opr/")||t.includes("opios/"))return"Opera";if(mE(t))return"IEMobile";if(t.includes("msie")||t.includes("trident/"))return"IE";if(t.includes("edge/"))return"Edge";if(hE(t))return"Firefox";if(t.includes("silk/"))return"Silk";if(yE(t))return"Blackberry";if(vE(t))return"Webos";if(fE(t))return"Safari";if((t.includes("chrome/")||pE(t))&&!t.includes("edge/"))return"Chrome";if(gE(t))return"Android";{const t=/([a-zA-Z\d\.]+)\/[a-zA-Z\d\.]*$/,n=e.match(t);if(2===(null===n||void 0===n?void 0:n.length))return n[1]}return"Other"}function hE(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:Xd();return/firefox\//i.test(e)}function fE(){const e=(arguments.length>0&&void 0!==arguments[0]?arguments[0]:Xd()).toLowerCase();return e.includes("safari/")&&!e.includes("chrome/")&&!e.includes("crios/")&&!e.includes("android")}function pE(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:Xd();return/crios\//i.test(e)}function mE(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:Xd();return/iemobile/i.test(e)}function gE(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:Xd();return/android/i.test(e)}function yE(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:Xd();return/blackberry/i.test(e)}function vE(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:Xd();return/webos/i.test(e)}function _E(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:Xd();return/iphone|ipad|ipod/i.test(e)||/macintosh/i.test(e)&&/mobile/i.test(e)}function wE(){return function(){const e=Xd();return e.indexOf("MSIE ")>=0||e.indexOf("Trident/")>=0}()&&10===document.documentMode}function bE(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:Xd();return _E(e)||gE(e)||vE(e)||yE(e)||/windows phone/i.test(e)||mE(e)}function xE(e){let t,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[];switch(e){case"Browser":t=dE(Xd());break;case"Worker":t="".concat(dE(Xd()),"-").concat(e);break;default:t=e}const i=n.length?n.join(","):"FirebaseCore-web";return"".concat(t,"/","JsCore","/").concat(Tf,"/").concat(i)}class SE{constructor(e){this.auth=e,this.queue=[]}pushCallback(e,t){const n=t=>new Promise((n,i)=>{try{n(e(t))}catch(Tk){i(Tk)}});n.onAbort=t,this.queue.push(n);const i=this.queue.length-1;return()=>{this.queue[i]=()=>Promise.resolve()}}async runMiddleware(e){if(this.auth.currentUser===e)return;const t=[];try{for(const n of this.queue)await n(e),n.onAbort&&t.push(n.onAbort)}catch(Tk){t.reverse();for(const i of t)try{i()}catch(n){}throw this.auth._errorFactory.create("login-blocked",{originalMessage:null===Tk||void 0===Tk?void 0:Tk.message})}}}class EE{constructor(e){var t,n,i,r;const o=e.customStrengthOptions;this.customStrengthOptions={},this.customStrengthOptions.minPasswordLength=null!==(t=o.minPasswordLength)&&void 0!==t?t:6,o.maxPasswordLength&&(this.customStrengthOptions.maxPasswordLength=o.maxPasswordLength),void 0!==o.containsLowercaseCharacter&&(this.customStrengthOptions.containsLowercaseLetter=o.containsLowercaseCharacter),void 0!==o.containsUppercaseCharacter&&(this.customStrengthOptions.containsUppercaseLetter=o.containsUppercaseCharacter),void 0!==o.containsNumericCharacter&&(this.customStrengthOptions.containsNumericCharacter=o.containsNumericCharacter),void 0!==o.containsNonAlphanumericCharacter&&(this.customStrengthOptions.containsNonAlphanumericCharacter=o.containsNonAlphanumericCharacter),this.enforcementState=e.enforcementState,"ENFORCEMENT_STATE_UNSPECIFIED"===this.enforcementState&&(this.enforcementState="OFF"),this.allowedNonAlphanumericCharacters=null!==(i=null===(n=e.allowedNonAlphanumericCharacters)||void 0===n?void 0:n.join(""))&&void 0!==i?i:"",this.forceUpgradeOnSignin=null!==(r=e.forceUpgradeOnSignin)&&void 0!==r&&r,this.schemaVersion=e.schemaVersion}validatePassword(e){var t,n,i,r,o,a;const s={isValid:!0,passwordPolicy:this};return this.validatePasswordLengthOptions(e,s),this.validatePasswordCharacterOptions(e,s),s.isValid&&(s.isValid=null===(t=s.meetsMinPasswordLength)||void 0===t||t),s.isValid&&(s.isValid=null===(n=s.meetsMaxPasswordLength)||void 0===n||n),s.isValid&&(s.isValid=null===(i=s.containsLowercaseLetter)||void 0===i||i),s.isValid&&(s.isValid=null===(r=s.containsUppercaseLetter)||void 0===r||r),s.isValid&&(s.isValid=null===(o=s.containsNumericCharacter)||void 0===o||o),s.isValid&&(s.isValid=null===(a=s.containsNonAlphanumericCharacter)||void 0===a||a),s}validatePasswordLengthOptions(e,t){const n=this.customStrengthOptions.minPasswordLength,i=this.customStrengthOptions.maxPasswordLength;n&&(t.meetsMinPasswordLength=e.length>=n),i&&(t.meetsMaxPasswordLength=e.length<=i)}validatePasswordCharacterOptions(e,t){let n;this.updatePasswordCharacterOptionsStatuses(t,!1,!1,!1,!1);for(let i=0;i<e.length;i++)n=e.charAt(i),this.updatePasswordCharacterOptionsStatuses(t,n>="a"&&n<="z",n>="A"&&n<="Z",n>="0"&&n<="9",this.allowedNonAlphanumericCharacters.includes(n))}updatePasswordCharacterOptionsStatuses(e,t,n,i,r){this.customStrengthOptions.containsLowercaseLetter&&(e.containsLowercaseLetter||(e.containsLowercaseLetter=t)),this.customStrengthOptions.containsUppercaseLetter&&(e.containsUppercaseLetter||(e.containsUppercaseLetter=n)),this.customStrengthOptions.containsNumericCharacter&&(e.containsNumericCharacter||(e.containsNumericCharacter=i)),this.customStrengthOptions.containsNonAlphanumericCharacter&&(e.containsNonAlphanumericCharacter||(e.containsNonAlphanumericCharacter=r))}}class TE{constructor(e,t,n,i){this.app=e,this.heartbeatServiceProvider=t,this.appCheckServiceProvider=n,this.config=i,this.currentUser=null,this.emulatorConfig=null,this.operations=Promise.resolve(),this.authStateSubscription=new CE(this),this.idTokenSubscription=new CE(this),this.beforeStateQueue=new SE(this),this.redirectUser=null,this.isProactiveRefreshEnabled=!1,this.EXPECTED_PASSWORD_POLICY_SCHEMA_VERSION=1,this._canInitEmulator=!0,this._isInitialized=!1,this._deleted=!1,this._initializationPromise=null,this._popupRedirectResolver=null,this._errorFactory=mS,this._agentRecaptchaConfig=null,this._tenantRecaptchaConfigs={},this._projectPasswordPolicy=null,this._tenantPasswordPolicies={},this.lastNotifiedUid=void 0,this.languageCode=null,this.tenantId=null,this.settings={appVerificationDisabledForTesting:!1},this.frameworks=[],this.name=e.name,this.clientVersion=i.sdkClientVersion}_initializeWithPersistence(e,t){return t&&(this._popupRedirectResolver=aE(t)),this._initializationPromise=this.queue(async()=>{var n,i;if(!this._deleted&&(this.persistenceManager=await uE.create(this,e),!this._deleted)){if(null===(n=this._popupRedirectResolver)||void 0===n?void 0:n._shouldInitProactively)try{await this._popupRedirectResolver._initialize(this)}catch(Tk){}await this.initializeCurrentUser(t),this.lastNotifiedUid=(null===(i=this.currentUser)||void 0===i?void 0:i.uid)||null,this._deleted||(this._isInitialized=!0)}}),this._initializationPromise}async _onStorageEvent(){if(this._deleted)return;const e=await this.assertedPersistence.getCurrentUser();return this.currentUser||e?this.currentUser&&e&&this.currentUser.uid===e.uid?(this._currentUser._assign(e),void await this.currentUser.getIdToken()):void await this._updateCurrentUser(e,!0):void 0}async initializeCurrentUserFromIdToken(e){try{const t=await GS(this,{idToken:e}),n=await rE._fromGetAccountInfoResponse(this,t,e);await this.directlySetCurrentUser(n)}catch(t){console.warn("FirebaseServerApp could not login user with provided authIdToken: ",t),await this.directlySetCurrentUser(null)}}async initializeCurrentUser(e){var t;if(xf(this.app)){const e=this.app.settings.authIdToken;return e?new Promise(t=>{setTimeout(()=>this.initializeCurrentUserFromIdToken(e).then(t,t))}):this.directlySetCurrentUser(null)}const n=await this.assertedPersistence.getCurrentUser();let i=n,r=!1;if(e&&this.config.authDomain){await this.getOrInitRedirectPersistenceManager();const n=null===(t=this.redirectUser)||void 0===t?void 0:t._redirectEventId,o=null===i||void 0===i?void 0:i._redirectEventId,a=await this.tryRedirectSignIn(e);n&&n!==o||!(null===a||void 0===a?void 0:a.user)||(i=a.user,r=!0)}if(!i)return this.directlySetCurrentUser(null);if(!i._redirectEventId){if(r)try{await this.beforeStateQueue.runMiddleware(i)}catch(Tk){i=n,this._popupRedirectResolver._overrideRedirectResult(this,()=>Promise.reject(Tk))}return i?this.reloadAndSetCurrentUserOrClear(i):this.directlySetCurrentUser(null)}return SS(this._popupRedirectResolver,this,"argument-error"),await this.getOrInitRedirectPersistenceManager(),this.redirectUser&&this.redirectUser._redirectEventId===i._redirectEventId?this.directlySetCurrentUser(i):this.reloadAndSetCurrentUserOrClear(i)}async tryRedirectSignIn(e){let t=null;try{t=await this._popupRedirectResolver._completeRedirectFn(this,e,!0)}catch(Tk){await this._setRedirectUser(null)}return t}async reloadAndSetCurrentUserOrClear(e){try{await eE(e)}catch(Tk){if((null===Tk||void 0===Tk?void 0:Tk.code)!=="auth/".concat("network-request-failed"))return this.directlySetCurrentUser(null)}return this.directlySetCurrentUser(e)}useDeviceLanguage(){this.languageCode=function(){if("undefined"===typeof navigator)return null;const e=navigator;return e.languages&&e.languages[0]||e.language||null}()}async _delete(){this._deleted=!0}async updateCurrentUser(e){if(xf(this.app))return Promise.reject(bS(this));const t=e?lh(e):null;return t&&SS(t.auth.config.apiKey===this.config.apiKey,this,"invalid-user-token"),this._updateCurrentUser(t&&t._clone(this))}async _updateCurrentUser(e){let t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(!this._deleted)return e&&SS(this.tenantId===e.tenantId,this,"tenant-id-mismatch"),t||await this.beforeStateQueue.runMiddleware(e),this.queue(async()=>{await this.directlySetCurrentUser(e),this.notifyAuthListeners()})}async signOut(){return xf(this.app)?Promise.reject(bS(this)):(await this.beforeStateQueue.runMiddleware(null),(this.redirectPersistenceManager||this._popupRedirectResolver)&&await this._setRedirectUser(null),this._updateCurrentUser(null,!0))}setPersistence(e){return xf(this.app)?Promise.reject(bS(this)):this.queue(async()=>{await this.assertedPersistence.setPersistence(aE(e))})}_getRecaptchaConfig(){return null==this.tenantId?this._agentRecaptchaConfig:this._tenantRecaptchaConfigs[this.tenantId]}async validatePassword(e){this._getPasswordPolicyInternal()||await this._updatePasswordPolicy();const t=this._getPasswordPolicyInternal();return t.schemaVersion!==this.EXPECTED_PASSWORD_POLICY_SCHEMA_VERSION?Promise.reject(this._errorFactory.create("unsupported-password-policy-schema-version",{})):t.validatePassword(e)}_getPasswordPolicyInternal(){return null===this.tenantId?this._projectPasswordPolicy:this._tenantPasswordPolicies[this.tenantId]}async _updatePasswordPolicy(){const e=await async function(e){return MS(e,"GET","/v2/passwordPolicy",zS(e,arguments.length>1&&void 0!==arguments[1]?arguments[1]:{}))}(this),t=new EE(e);null===this.tenantId?this._projectPasswordPolicy=t:this._tenantPasswordPolicies[this.tenantId]=t}_getPersistence(){return this.assertedPersistence.persistence.type}_updateErrorMap(e){this._errorFactory=new eh("auth","Firebase",e())}onAuthStateChanged(e,t,n){return this.registerStateListener(this.authStateSubscription,e,t,n)}beforeAuthStateChanged(e,t){return this.beforeStateQueue.pushCallback(e,t)}onIdTokenChanged(e,t,n){return this.registerStateListener(this.idTokenSubscription,e,t,n)}authStateReady(){return new Promise((e,t)=>{if(this.currentUser)e();else{const n=this.onAuthStateChanged(()=>{n(),e()},t)}})}async revokeAccessToken(e){if(this.currentUser){const t={providerId:"apple.com",tokenType:"ACCESS_TOKEN",token:e,idToken:await this.currentUser.getIdToken()};null!=this.tenantId&&(t.tenantId=this.tenantId),await async function(e,t){return MS(e,"POST","/v2/accounts:revokeToken",zS(e,t))}(this,t)}}toJSON(){var e;return{apiKey:this.config.apiKey,authDomain:this.config.authDomain,appName:this.name,currentUser:null===(e=this._currentUser)||void 0===e?void 0:e.toJSON()}}async _setRedirectUser(e,t){const n=await this.getOrInitRedirectPersistenceManager(t);return null===e?n.removeCurrentUser():n.setCurrentUser(e)}async getOrInitRedirectPersistenceManager(e){if(!this.redirectPersistenceManager){const t=e&&aE(e)||this._popupRedirectResolver;SS(t,this,"argument-error"),this.redirectPersistenceManager=await uE.create(this,[aE(t._redirectPersistence)],"redirectUser"),this.redirectUser=await this.redirectPersistenceManager.getCurrentUser()}return this.redirectPersistenceManager}async _redirectUserForId(e){var t,n;return this._isInitialized&&await this.queue(async()=>{}),(null===(t=this._currentUser)||void 0===t?void 0:t._redirectEventId)===e?this._currentUser:(null===(n=this.redirectUser)||void 0===n?void 0:n._redirectEventId)===e?this.redirectUser:null}async _persistUserIfCurrent(e){if(e===this.currentUser)return this.queue(async()=>this.directlySetCurrentUser(e))}_notifyListenersIfCurrent(e){e===this.currentUser&&this.notifyAuthListeners()}_key(){return"".concat(this.config.authDomain,":").concat(this.config.apiKey,":").concat(this.name)}_startProactiveRefresh(){this.isProactiveRefreshEnabled=!0,this.currentUser&&this._currentUser._startProactiveRefresh()}_stopProactiveRefresh(){this.isProactiveRefreshEnabled=!1,this.currentUser&&this._currentUser._stopProactiveRefresh()}get _currentUser(){return this.currentUser}notifyAuthListeners(){var e,t;if(!this._isInitialized)return;this.idTokenSubscription.next(this.currentUser);const n=null!==(t=null===(e=this.currentUser)||void 0===e?void 0:e.uid)&&void 0!==t?t:null;this.lastNotifiedUid!==n&&(this.lastNotifiedUid=n,this.authStateSubscription.next(this.currentUser))}registerStateListener(e,t,n,i){if(this._deleted)return()=>{};const r="function"===typeof t?t:t.next.bind(t);let o=!1;const a=this._isInitialized?Promise.resolve():this._initializationPromise;if(SS(a,this,"internal-error"),a.then(()=>{o||r(this.currentUser)}),"function"===typeof t){const r=e.addObserver(t,n,i);return()=>{o=!0,r()}}{const n=e.addObserver(t);return()=>{o=!0,n()}}}async directlySetCurrentUser(e){this.currentUser&&this.currentUser!==e&&this._currentUser._stopProactiveRefresh(),e&&this.isProactiveRefreshEnabled&&e._startProactiveRefresh(),this.currentUser=e,e?await this.assertedPersistence.setCurrentUser(e):await this.assertedPersistence.removeCurrentUser()}queue(e){return this.operations=this.operations.then(e,e),this.operations}get assertedPersistence(){return SS(this.persistenceManager,this,"internal-error"),this.persistenceManager}_logFramework(e){e&&!this.frameworks.includes(e)&&(this.frameworks.push(e),this.frameworks.sort(),this.clientVersion=xE(this.config.clientPlatform,this._getFrameworks()))}_getFrameworks(){return this.frameworks}async _getAdditionalHeaders(){var e;const t={"X-Client-Version":this.clientVersion};this.app.options.appId&&(t["X-Firebase-gmpid"]=this.app.options.appId);const n=await(null===(e=this.heartbeatServiceProvider.getImmediate({optional:!0}))||void 0===e?void 0:e.getHeartbeatsHeader());n&&(t["X-Firebase-Client"]=n);const i=await this._getAppCheckToken();return i&&(t["X-Firebase-AppCheck"]=i),t}async _getAppCheckToken(){var e;const t=await(null===(e=this.appCheckServiceProvider.getImmediate({optional:!0}))||void 0===e?void 0:e.getToken());return(null===t||void 0===t?void 0:t.error)&&function(e){if(gS.logLevel<=mh.WARN){for(var t=arguments.length,n=new Array(t>1?t-1:0),i=1;i<t;i++)n[i-1]=arguments[i];gS.warn("Auth (".concat(Tf,"): ").concat(e),...n)}}("Error while retrieving App Check token: ".concat(t.error)),null===t||void 0===t?void 0:t.token}}function kE(e){return lh(e)}class CE{constructor(e){this.auth=e,this.observer=null,this.addObserver=function(e,t){const n=new sh(e,t);return n.subscribe.bind(n)}(e=>this.observer=e)}get next(){return SS(this.observer,this.auth,"internal-error"),this.observer.next.bind(this.observer)}}let IE={async loadJS(){throw new Error("Unable to load external scripts")},recaptchaV2Script:"",recaptchaEnterpriseScript:"",gapiScript:""};function AE(e){return IE.loadJS(e)}function NE(e){return"__".concat(e).concat(Math.floor(1e6*Math.random()))}class OE{constructor(e){this.type="recaptcha-enterprise",this.auth=kE(e)}async verify(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"verify",t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];function n(t,n,i){const r=window.grecaptcha;qS(r)?r.enterprise.ready(()=>{r.enterprise.execute(t,{action:e}).then(e=>{n(e)}).catch(()=>{n("NO_RECAPTCHA")})}):i(Error("No reCAPTCHA enterprise script loaded."))}return new Promise((e,i)=>{(async function(e){if(!t){if(null==e.tenantId&&null!=e._agentRecaptchaConfig)return e._agentRecaptchaConfig.siteKey;if(null!=e.tenantId&&void 0!==e._tenantRecaptchaConfigs[e.tenantId])return e._tenantRecaptchaConfigs[e.tenantId].siteKey}return new Promise(async(t,n)=>{WS(e,{clientType:"CLIENT_TYPE_WEB",version:"RECAPTCHA_ENTERPRISE"}).then(i=>{if(void 0!==i.recaptchaKey){const n=new HS(i);return null==e.tenantId?e._agentRecaptchaConfig=n:e._tenantRecaptchaConfigs[e.tenantId]=n,t(n.siteKey)}n(new Error("recaptcha Enterprise site key undefined"))}).catch(e=>{n(e)})})})(this.auth).then(r=>{if(!t&&qS(window.grecaptcha))n(r,e,i);else{if("undefined"===typeof window)return void i(new Error("RecaptchaVerifier is only supported in browser"));let t=IE.recaptchaEnterpriseScript;0!==t.length&&(t+=r),AE(t).then(()=>{n(r,e,i)}).catch(e=>{i(e)})}}).catch(e=>{i(e)})})}}async function PE(e,t,n){let i=arguments.length>3&&void 0!==arguments[3]&&arguments[3];const r=new OE(e);let o;try{o=await r.verify(n)}catch(s){o=await r.verify(n,!0)}const a=Object.assign({},t);return i?Object.assign(a,{captchaResp:o}):Object.assign(a,{captchaResponse:o}),Object.assign(a,{clientType:"CLIENT_TYPE_WEB"}),Object.assign(a,{recaptchaVersion:"RECAPTCHA_ENTERPRISE"}),a}async function RE(e,t,n,i){var r;if(null===(r=e._getRecaptchaConfig())||void 0===r?void 0:r.isProviderEnabled("EMAIL_PASSWORD_PROVIDER")){const r=await PE(e,t,n,"getOobCode"===n);return i(e,r)}return i(e,t).catch(async r=>{if(r.code==="auth/".concat("missing-recaptcha-token")){console.log("".concat(n," is protected by reCAPTCHA Enterprise for this project. Automatically triggering the reCAPTCHA flow and restarting the flow."));const r=await PE(e,t,n,"getOobCode"===n);return i(e,r)}return Promise.reject(r)})}function LE(e,t,n){const i=kE(e);SS(i._canInitEmulator,i,"emulator-config-failed"),SS(/^https?:\/\//.test(t),i,"invalid-emulator-scheme");const r=!!(null===n||void 0===n?void 0:n.disableWarnings),o=zE(t),{host:a,port:s}=function(e){const t=zE(e),n=/(\/\/)?([^?#/]+)/.exec(e.substr(t.length));if(!n)return{host:"",port:null};const i=n[2].split("@").pop()||"",r=/^(\[[^\]]+\])(:|$)/.exec(i);if(r){const e=r[1];return{host:e,port:ME(i.substr(e.length+1))}}{const[e,t]=i.split(":");return{host:e,port:ME(t)}}}(t),c=null===s?"":":".concat(s);i.config.emulator={url:"".concat(o,"//").concat(a).concat(c,"/")},i.settings.appVerificationDisabledForTesting=!0,i.emulatorConfig=Object.freeze({host:a,port:s,protocol:o.replace(":",""),options:Object.freeze({disableWarnings:r})}),r||function(){function e(){const e=document.createElement("p"),t=e.style;e.innerText="Running in emulator mode. Do not use with production credentials.",t.position="fixed",t.width="100%",t.backgroundColor="#ffffff",t.border=".1em solid #000000",t.color="#b50000",t.bottom="0px",t.left="0px",t.margin="0px",t.zIndex="10000",t.textAlign="center",e.classList.add("firebase-emulator-warning"),document.body.appendChild(e)}"undefined"!==typeof console&&"function"===typeof console.info&&console.info("WARNING: You are using the Auth Emulator, which is intended for local testing only.  Do not use with production credentials.");"undefined"!==typeof window&&"undefined"!==typeof document&&("loading"===document.readyState?window.addEventListener("DOMContentLoaded",e):e())}()}function zE(e){const t=e.indexOf(":");return t<0?"":e.substr(0,t+1)}function ME(e){if(!e)return null;const t=Number(e);return isNaN(t)?null:t}class DE{constructor(e,t){this.providerId=e,this.signInMethod=t}toJSON(){return ES("not implemented")}_getIdTokenResponse(e){return ES("not implemented")}_linkToIdToken(e,t){return ES("not implemented")}_getReauthenticationResolver(e){return ES("not implemented")}}async function BE(e,t){return MS(e,"POST","/v1/accounts:signUp",t)}async function UE(e,t){return BS(e,"POST","/v1/accounts:signInWithPassword",zS(e,t))}class FE extends DE{constructor(e,t,n){let i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null;super("password",n),this._email=e,this._password=t,this._tenantId=i}static _fromEmailAndPassword(e,t){return new FE(e,t,"password")}static _fromEmailAndCode(e,t){return new FE(e,t,"emailLink",arguments.length>2&&void 0!==arguments[2]?arguments[2]:null)}toJSON(){return{email:this._email,password:this._password,signInMethod:this.signInMethod,tenantId:this._tenantId}}static fromJSON(e){const t="string"===typeof e?JSON.parse(e):e;if((null===t||void 0===t?void 0:t.email)&&(null===t||void 0===t?void 0:t.password)){if("password"===t.signInMethod)return this._fromEmailAndPassword(t.email,t.password);if("emailLink"===t.signInMethod)return this._fromEmailAndCode(t.email,t.password,t.tenantId)}return null}async _getIdTokenResponse(e){switch(this.signInMethod){case"password":return RE(e,{returnSecureToken:!0,email:this._email,password:this._password,clientType:"CLIENT_TYPE_WEB"},"signInWithPassword",UE);case"emailLink":return async function(e,t){return BS(e,"POST","/v1/accounts:signInWithEmailLink",zS(e,t))}(e,{email:this._email,oobCode:this._password});default:vS(e,"internal-error")}}async _linkToIdToken(e,t){switch(this.signInMethod){case"password":return RE(e,{idToken:t,returnSecureToken:!0,email:this._email,password:this._password,clientType:"CLIENT_TYPE_WEB"},"signUpPassword",BE);case"emailLink":return async function(e,t){return BS(e,"POST","/v1/accounts:signInWithEmailLink",zS(e,t))}(e,{idToken:t,email:this._email,oobCode:this._password});default:vS(e,"internal-error")}}_getReauthenticationResolver(e){return this._getIdTokenResponse(e)}}async function jE(e,t){return BS(e,"POST","/v1/accounts:signInWithIdp",zS(e,t))}class VE extends DE{constructor(){super(...arguments),this.pendingToken=null}static _fromParams(e){const t=new VE(e.providerId,e.signInMethod);return e.idToken||e.accessToken?(e.idToken&&(t.idToken=e.idToken),e.accessToken&&(t.accessToken=e.accessToken),e.nonce&&!e.pendingToken&&(t.nonce=e.nonce),e.pendingToken&&(t.pendingToken=e.pendingToken)):e.oauthToken&&e.oauthTokenSecret?(t.accessToken=e.oauthToken,t.secret=e.oauthTokenSecret):vS("argument-error"),t}toJSON(){return{idToken:this.idToken,accessToken:this.accessToken,secret:this.secret,nonce:this.nonce,pendingToken:this.pendingToken,providerId:this.providerId,signInMethod:this.signInMethod}}static fromJSON(e){const t="string"===typeof e?JSON.parse(e):e,{providerId:n,signInMethod:i}=t,r=hS(t,["providerId","signInMethod"]);if(!n||!i)return null;const o=new VE(n,i);return o.idToken=r.idToken||void 0,o.accessToken=r.accessToken||void 0,o.secret=r.secret,o.nonce=r.nonce,o.pendingToken=r.pendingToken||null,o}_getIdTokenResponse(e){return jE(e,this.buildRequest())}_linkToIdToken(e,t){const n=this.buildRequest();return n.idToken=t,jE(e,n)}_getReauthenticationResolver(e){const t=this.buildRequest();return t.autoCreate=!1,jE(e,t)}buildRequest(){const e={requestUri:"http://localhost",returnSecureToken:!0};if(this.pendingToken)e.pendingToken=this.pendingToken;else{const t={};this.idToken&&(t.id_token=this.idToken),this.accessToken&&(t.access_token=this.accessToken),this.secret&&(t.oauth_token_secret=this.secret),t.providerId=this.providerId,this.nonce&&!this.pendingToken&&(t.nonce=this.nonce),e.postBody=rh(t)}return e}}const qE={USER_NOT_FOUND:"user-not-found"};class HE extends DE{constructor(e){super("phone","phone"),this.params=e}static _fromVerification(e,t){return new HE({verificationId:e,verificationCode:t})}static _fromTokenResponse(e,t){return new HE({phoneNumber:e,temporaryProof:t})}_getIdTokenResponse(e){return async function(e,t){return BS(e,"POST","/v1/accounts:signInWithPhoneNumber",zS(e,t))}(e,this._makeVerificationRequest())}_linkToIdToken(e,t){return async function(e,t){const n=await BS(e,"POST","/v1/accounts:signInWithPhoneNumber",zS(e,t));if(n.temporaryProof)throw VS(e,"account-exists-with-different-credential",n);return n}(e,Object.assign({idToken:t},this._makeVerificationRequest()))}_getReauthenticationResolver(e){return async function(e,t){return BS(e,"POST","/v1/accounts:signInWithPhoneNumber",zS(e,Object.assign(Object.assign({},t),{operation:"REAUTH"})),qE)}(e,this._makeVerificationRequest())}_makeVerificationRequest(){const{temporaryProof:e,phoneNumber:t,verificationId:n,verificationCode:i}=this.params;return e&&t?{temporaryProof:e,phoneNumber:t}:{sessionInfo:n,code:i}}toJSON(){const e={providerId:this.providerId};return this.params.phoneNumber&&(e.phoneNumber=this.params.phoneNumber),this.params.temporaryProof&&(e.temporaryProof=this.params.temporaryProof),this.params.verificationCode&&(e.verificationCode=this.params.verificationCode),this.params.verificationId&&(e.verificationId=this.params.verificationId),e}static fromJSON(e){"string"===typeof e&&(e=JSON.parse(e));const{verificationId:t,verificationCode:n,phoneNumber:i,temporaryProof:r}=e;return n||t||i||r?new HE({verificationId:t,verificationCode:n,phoneNumber:i,temporaryProof:r}):null}}class WE{constructor(e){var t,n,i,r,o,a;const s=oh(ah(e)),c=null!==(t=s.apiKey)&&void 0!==t?t:null,l=null!==(n=s.oobCode)&&void 0!==n?n:null,u=function(e){switch(e){case"recoverEmail":return"RECOVER_EMAIL";case"resetPassword":return"PASSWORD_RESET";case"signIn":return"EMAIL_SIGNIN";case"verifyEmail":return"VERIFY_EMAIL";case"verifyAndChangeEmail":return"VERIFY_AND_CHANGE_EMAIL";case"revertSecondFactorAddition":return"REVERT_SECOND_FACTOR_ADDITION";default:return null}}(null!==(i=s.mode)&&void 0!==i?i:null);SS(c&&l&&u,"argument-error"),this.apiKey=c,this.operation=u,this.code=l,this.continueUrl=null!==(r=s.continueUrl)&&void 0!==r?r:null,this.languageCode=null!==(o=s.languageCode)&&void 0!==o?o:null,this.tenantId=null!==(a=s.tenantId)&&void 0!==a?a:null}static parseLink(e){const t=function(e){const t=oh(ah(e)).link,n=t?oh(ah(t)).deep_link_id:null,i=oh(ah(e)).deep_link_id;return(i?oh(ah(i)).link:null)||i||n||t||e}(e);try{return new WE(t)}catch(we){return null}}}class GE{constructor(){this.providerId=GE.PROVIDER_ID}static credential(e,t){return FE._fromEmailAndPassword(e,t)}static credentialWithLink(e,t){const n=WE.parseLink(t);return SS(n,"argument-error"),FE._fromEmailAndCode(e,n.code,n.tenantId)}}GE.PROVIDER_ID="password",GE.EMAIL_PASSWORD_SIGN_IN_METHOD="password",GE.EMAIL_LINK_SIGN_IN_METHOD="emailLink";class KE{constructor(e){this.providerId=e,this.defaultLanguageCode=null,this.customParameters={}}setDefaultLanguage(e){this.defaultLanguageCode=e}setCustomParameters(e){return this.customParameters=e,this}getCustomParameters(){return this.customParameters}}class ZE extends KE{constructor(){super(...arguments),this.scopes=[]}addScope(e){return this.scopes.includes(e)||this.scopes.push(e),this}getScopes(){return[...this.scopes]}}class QE extends ZE{constructor(){super("facebook.com")}static credential(e){return VE._fromParams({providerId:QE.PROVIDER_ID,signInMethod:QE.FACEBOOK_SIGN_IN_METHOD,accessToken:e})}static credentialFromResult(e){return QE.credentialFromTaggedObject(e)}static credentialFromError(e){return QE.credentialFromTaggedObject(e.customData||{})}static credentialFromTaggedObject(e){let{_tokenResponse:t}=e;if(!t||!("oauthAccessToken"in t))return null;if(!t.oauthAccessToken)return null;try{return QE.credential(t.oauthAccessToken)}catch(we){return null}}}QE.FACEBOOK_SIGN_IN_METHOD="facebook.com",QE.PROVIDER_ID="facebook.com";class XE extends ZE{constructor(){super("google.com"),this.addScope("profile")}static credential(e,t){return VE._fromParams({providerId:XE.PROVIDER_ID,signInMethod:XE.GOOGLE_SIGN_IN_METHOD,idToken:e,accessToken:t})}static credentialFromResult(e){return XE.credentialFromTaggedObject(e)}static credentialFromError(e){return XE.credentialFromTaggedObject(e.customData||{})}static credentialFromTaggedObject(e){let{_tokenResponse:t}=e;if(!t)return null;const{oauthIdToken:n,oauthAccessToken:i}=t;if(!n&&!i)return null;try{return XE.credential(n,i)}catch(we){return null}}}XE.GOOGLE_SIGN_IN_METHOD="google.com",XE.PROVIDER_ID="google.com";class YE extends ZE{constructor(){super("github.com")}static credential(e){return VE._fromParams({providerId:YE.PROVIDER_ID,signInMethod:YE.GITHUB_SIGN_IN_METHOD,accessToken:e})}static credentialFromResult(e){return YE.credentialFromTaggedObject(e)}static credentialFromError(e){return YE.credentialFromTaggedObject(e.customData||{})}static credentialFromTaggedObject(e){let{_tokenResponse:t}=e;if(!t||!("oauthAccessToken"in t))return null;if(!t.oauthAccessToken)return null;try{return YE.credential(t.oauthAccessToken)}catch(we){return null}}}YE.GITHUB_SIGN_IN_METHOD="github.com",YE.PROVIDER_ID="github.com";class JE extends ZE{constructor(){super("twitter.com")}static credential(e,t){return VE._fromParams({providerId:JE.PROVIDER_ID,signInMethod:JE.TWITTER_SIGN_IN_METHOD,oauthToken:e,oauthTokenSecret:t})}static credentialFromResult(e){return JE.credentialFromTaggedObject(e)}static credentialFromError(e){return JE.credentialFromTaggedObject(e.customData||{})}static credentialFromTaggedObject(e){let{_tokenResponse:t}=e;if(!t)return null;const{oauthAccessToken:n,oauthTokenSecret:i}=t;if(!n||!i)return null;try{return JE.credential(n,i)}catch(we){return null}}}async function $E(e,t){return BS(e,"POST","/v1/accounts:signUp",zS(e,t))}JE.TWITTER_SIGN_IN_METHOD="twitter.com",JE.PROVIDER_ID="twitter.com";class eT{constructor(e){this.user=e.user,this.providerId=e.providerId,this._tokenResponse=e._tokenResponse,this.operationType=e.operationType}static async _fromIdTokenResponse(e,t,n){let i=arguments.length>3&&void 0!==arguments[3]&&arguments[3];const r=await rE._fromIdTokenResponse(e,n,i),o=tT(n);return new eT({user:r,providerId:o,_tokenResponse:n,operationType:t})}static async _forOperation(e,t,n){await e._updateTokensIfNecessary(n,!0);const i=tT(n);return new eT({user:e,providerId:i,_tokenResponse:n,operationType:t})}}function tT(e){return e.providerId?e.providerId:"phoneNumber"in e?"phone":null}class nT extends $d{constructor(e,t,n,i){var r;super(t.code,t.message),this.operationType=n,this.user=i,Object.setPrototypeOf(this,nT.prototype),this.customData={appName:e.name,tenantId:null!==(r=e.tenantId)&&void 0!==r?r:void 0,_serverResponse:t.customData._serverResponse,operationType:n}}static _fromErrorAndOperation(e,t,n,i){return new nT(e,t,n,i)}}function iT(e,t,n,i){return("reauthenticate"===t?n._getReauthenticationResolver(e):n._getIdTokenResponse(e)).catch(n=>{if(n.code==="auth/".concat("multi-factor-auth-required"))throw nT._fromErrorAndOperation(e,n,t,i);throw n})}async function rT(e,t){let n=arguments.length>2&&void 0!==arguments[2]&&arguments[2];const i=await YS(e,t._linkToIdToken(e.auth,await e.getIdToken()),n);return eT._forOperation(e,"link",i)}async function oT(e,t){let n=arguments.length>2&&void 0!==arguments[2]&&arguments[2];const{auth:i}=e;if(xf(i.app))return Promise.reject(bS(i));const r="reauthenticate";try{const o=await YS(e,iT(i,r,t,e),n);SS(o.idToken,i,"internal-error");const a=QS(o.idToken);SS(a,i,"internal-error");const{sub:s}=a;return SS(e.uid===s,i,"user-mismatch"),eT._forOperation(e,r,o)}catch(Tk){throw(null===Tk||void 0===Tk?void 0:Tk.code)==="auth/".concat("user-not-found")&&vS(i,"user-mismatch"),Tk}}async function aT(e,t){let n=arguments.length>2&&void 0!==arguments[2]&&arguments[2];if(xf(e.app))return Promise.reject(bS(e));const i="signIn",r=await iT(e,i,t),o=await eT._fromIdTokenResponse(e,i,r);return n||await e._updateCurrentUser(o.user),o}new WeakMap;const sT="__sak";class cT{constructor(e,t){this.storageRetriever=e,this.type=t}_isAvailable(){try{return this.storage?(this.storage.setItem(sT,"1"),this.storage.removeItem(sT),Promise.resolve(!0)):Promise.resolve(!1)}catch(we){return Promise.resolve(!1)}}_set(e,t){return this.storage.setItem(e,JSON.stringify(t)),Promise.resolve()}_get(e){const t=this.storage.getItem(e);return Promise.resolve(t?JSON.parse(t):null)}_remove(e){return this.storage.removeItem(e),Promise.resolve()}get storage(){return this.storageRetriever()}}class lT extends cT{constructor(){super(()=>window.localStorage,"LOCAL"),this.boundEventHandler=(e,t)=>this.onStorageEvent(e,t),this.listeners={},this.localCache={},this.pollTimer=null,this.fallbackToPolling=bE(),this._shouldAllowMigration=!0}forAllChangedKeys(e){for(const t of Object.keys(this.listeners)){const n=this.storage.getItem(t),i=this.localCache[t];n!==i&&e(t,i,n)}}onStorageEvent(e){let t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(!e.key)return void this.forAllChangedKeys((e,t,n)=>{this.notifyListeners(e,n)});const n=e.key;t?this.detachListener():this.stopPolling();const i=()=>{const e=this.storage.getItem(n);(t||this.localCache[n]!==e)&&this.notifyListeners(n,e)},r=this.storage.getItem(n);wE()&&r!==e.newValue&&e.newValue!==e.oldValue?setTimeout(i,10):i()}notifyListeners(e,t){this.localCache[e]=t;const n=this.listeners[e];if(n)for(const i of Array.from(n))i(t?JSON.parse(t):t)}startPolling(){this.stopPolling(),this.pollTimer=setInterval(()=>{this.forAllChangedKeys((e,t,n)=>{this.onStorageEvent(new StorageEvent("storage",{key:e,oldValue:t,newValue:n}),!0)})},1e3)}stopPolling(){this.pollTimer&&(clearInterval(this.pollTimer),this.pollTimer=null)}attachListener(){window.addEventListener("storage",this.boundEventHandler)}detachListener(){window.removeEventListener("storage",this.boundEventHandler)}_addListener(e,t){0===Object.keys(this.listeners).length&&(this.fallbackToPolling?this.startPolling():this.attachListener()),this.listeners[e]||(this.listeners[e]=new Set,this.localCache[e]=this.storage.getItem(e)),this.listeners[e].add(t)}_removeListener(e,t){this.listeners[e]&&(this.listeners[e].delete(t),0===this.listeners[e].size&&delete this.listeners[e]),0===Object.keys(this.listeners).length&&(this.detachListener(),this.stopPolling())}async _set(e,t){await super._set(e,t),this.localCache[e]=JSON.stringify(t)}async _get(e){const t=await super._get(e);return this.localCache[e]=JSON.stringify(t),t}async _remove(e){await super._remove(e),delete this.localCache[e]}}lT.type="LOCAL";const uT=lT;class dT extends cT{constructor(){super(()=>window.sessionStorage,"SESSION")}_addListener(e,t){}_removeListener(e,t){}}dT.type="SESSION";const hT=dT;class fT{constructor(e){this.eventTarget=e,this.handlersMap={},this.boundEventHandler=this.handleEvent.bind(this)}static _getInstance(e){const t=this.receivers.find(t=>t.isListeningto(e));if(t)return t;const n=new fT(e);return this.receivers.push(n),n}isListeningto(e){return this.eventTarget===e}async handleEvent(e){const t=e,{eventId:n,eventType:i,data:r}=t.data,o=this.handlersMap[i];if(!(null===o||void 0===o?void 0:o.size))return;t.ports[0].postMessage({status:"ack",eventId:n,eventType:i});const a=Array.from(o).map(async e=>e(t.origin,r)),s=await function(e){return Promise.all(e.map(async e=>{try{return{fulfilled:!0,value:await e}}catch(t){return{fulfilled:!1,reason:t}}}))}(a);t.ports[0].postMessage({status:"done",eventId:n,eventType:i,response:s})}_subscribe(e,t){0===Object.keys(this.handlersMap).length&&this.eventTarget.addEventListener("message",this.boundEventHandler),this.handlersMap[e]||(this.handlersMap[e]=new Set),this.handlersMap[e].add(t)}_unsubscribe(e,t){this.handlersMap[e]&&t&&this.handlersMap[e].delete(t),t&&0!==this.handlersMap[e].size||delete this.handlersMap[e],0===Object.keys(this.handlersMap).length&&this.eventTarget.removeEventListener("message",this.boundEventHandler)}}function pT(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"",t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:10,n="";for(let i=0;i<t;i++)n+=Math.floor(10*Math.random());return e+n}fT.receivers=[];class mT{constructor(e){this.target=e,this.handlers=new Set}removeMessageHandler(e){e.messageChannel&&(e.messageChannel.port1.removeEventListener("message",e.onMessage),e.messageChannel.port1.close()),this.handlers.delete(e)}async _send(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:50;const i="undefined"!==typeof MessageChannel?new MessageChannel:null;if(!i)throw new Error("connection_unavailable");let r,o;return new Promise((a,s)=>{const c=pT("",20);i.port1.start();const l=setTimeout(()=>{s(new Error("unsupported_event"))},n);o={messageChannel:i,onMessage(e){const t=e;if(t.data.eventId===c)switch(t.data.status){case"ack":clearTimeout(l),r=setTimeout(()=>{s(new Error("timeout"))},3e3);break;case"done":clearTimeout(r),a(t.data.response);break;default:clearTimeout(l),clearTimeout(r),s(new Error("invalid_response"))}}},this.handlers.add(o),i.port1.addEventListener("message",o.onMessage),this.target.postMessage({eventType:e,eventId:c,data:t},[i.port2])}).finally(()=>{o&&this.removeMessageHandler(o)})}}function gT(){return window}function yT(){return"undefined"!==typeof gT().WorkerGlobalScope&&"function"===typeof gT().importScripts}const vT="firebaseLocalStorageDb",_T="firebaseLocalStorage",wT="fbase_key";class bT{constructor(e){this.request=e}toPromise(){return new Promise((e,t)=>{this.request.addEventListener("success",()=>{e(this.request.result)}),this.request.addEventListener("error",()=>{t(this.request.error)})})}}function xT(e,t){return e.transaction([_T],t?"readwrite":"readonly").objectStore(_T)}function ST(){const e=indexedDB.open(vT,1);return new Promise((t,n)=>{e.addEventListener("error",()=>{n(e.error)}),e.addEventListener("upgradeneeded",()=>{const t=e.result;try{t.createObjectStore(_T,{keyPath:wT})}catch(Tk){n(Tk)}}),e.addEventListener("success",async()=>{const n=e.result;n.objectStoreNames.contains(_T)?t(n):(n.close(),await function(){const e=indexedDB.deleteDatabase(vT);return new bT(e).toPromise()}(),t(await ST()))})})}async function ET(e,t,n){const i=xT(e,!0).put({[wT]:t,value:n});return new bT(i).toPromise()}function TT(e,t){const n=xT(e,!0).delete(t);return new bT(n).toPromise()}class kT{constructor(){this.type="LOCAL",this._shouldAllowMigration=!0,this.listeners={},this.localCache={},this.pollTimer=null,this.pendingWrites=0,this.receiver=null,this.sender=null,this.serviceWorkerReceiverAvailable=!1,this.activeServiceWorker=null,this._workerInitializationPromise=this.initializeServiceWorkerMessaging().then(()=>{},()=>{})}async _openDb(){return this.db||(this.db=await ST()),this.db}async _withRetries(e){let t=0;for(;;)try{const t=await this._openDb();return await e(t)}catch(Tk){if(t++>3)throw Tk;this.db&&(this.db.close(),this.db=void 0)}}async initializeServiceWorkerMessaging(){return yT()?this.initializeReceiver():this.initializeSender()}async initializeReceiver(){this.receiver=fT._getInstance(yT()?self:null),this.receiver._subscribe("keyChanged",async(e,t)=>({keyProcessed:(await this._poll()).includes(t.key)})),this.receiver._subscribe("ping",async(e,t)=>["keyChanged"])}async initializeSender(){var e,t;if(this.activeServiceWorker=await async function(){if(!(null===navigator||void 0===navigator?void 0:navigator.serviceWorker))return null;try{return(await navigator.serviceWorker.ready).active}catch(e){return null}}(),!this.activeServiceWorker)return;this.sender=new mT(this.activeServiceWorker);const n=await this.sender._send("ping",{},800);n&&(null===(e=n[0])||void 0===e?void 0:e.fulfilled)&&(null===(t=n[0])||void 0===t?void 0:t.value.includes("keyChanged"))&&(this.serviceWorkerReceiverAvailable=!0)}async notifyServiceWorker(e){if(this.sender&&this.activeServiceWorker&&function(){var e;return(null===(e=null===navigator||void 0===navigator?void 0:navigator.serviceWorker)||void 0===e?void 0:e.controller)||null}()===this.activeServiceWorker)try{await this.sender._send("keyChanged",{key:e},this.serviceWorkerReceiverAvailable?800:50)}catch(we){}}async _isAvailable(){try{if(!indexedDB)return!1;const e=await ST();return await ET(e,sT,"1"),await TT(e,sT),!0}catch(we){}return!1}async _withPendingWrite(e){this.pendingWrites++;try{await e()}finally{this.pendingWrites--}}async _set(e,t){return this._withPendingWrite(async()=>(await this._withRetries(n=>ET(n,e,t)),this.localCache[e]=t,this.notifyServiceWorker(e)))}async _get(e){const t=await this._withRetries(t=>async function(e,t){const n=xT(e,!1).get(t),i=await new bT(n).toPromise();return void 0===i?null:i.value}(t,e));return this.localCache[e]=t,t}async _remove(e){return this._withPendingWrite(async()=>(await this._withRetries(t=>TT(t,e)),delete this.localCache[e],this.notifyServiceWorker(e)))}async _poll(){const e=await this._withRetries(e=>{const t=xT(e,!1).getAll();return new bT(t).toPromise()});if(!e)return[];if(0!==this.pendingWrites)return[];const t=[],n=new Set;if(0!==e.length)for(const{fbase_key:i,value:r}of e)n.add(i),JSON.stringify(this.localCache[i])!==JSON.stringify(r)&&(this.notifyListeners(i,r),t.push(i));for(const i of Object.keys(this.localCache))this.localCache[i]&&!n.has(i)&&(this.notifyListeners(i,null),t.push(i));return t}notifyListeners(e,t){this.localCache[e]=t;const n=this.listeners[e];if(n)for(const i of Array.from(n))i(t)}startPolling(){this.stopPolling(),this.pollTimer=setInterval(async()=>this._poll(),800)}stopPolling(){this.pollTimer&&(clearInterval(this.pollTimer),this.pollTimer=null)}_addListener(e,t){0===Object.keys(this.listeners).length&&this.startPolling(),this.listeners[e]||(this.listeners[e]=new Set,this._get(e)),this.listeners[e].add(t)}_removeListener(e,t){this.listeners[e]&&(this.listeners[e].delete(t),0===this.listeners[e].size&&delete this.listeners[e]),0===Object.keys(this.listeners).length&&this.stopPolling()}}kT.type="LOCAL";const CT=kT;NE("rcb"),new NS(3e4,6e4);const IT="recaptcha";async function AT(e,t,n){var i;const r=await n.verify();try{let o;if(SS("string"===typeof r,e,"argument-error"),SS(n.type===IT,e,"argument-error"),o="string"===typeof t?{phoneNumber:t}:t,"session"in o){const t=o.session;if("phoneNumber"in o){SS("enroll"===t.type,e,"internal-error");const n=await function(e,t){return MS(e,"POST","/v2/accounts/mfaEnrollment:start",zS(e,t))}(e,{idToken:t.credential,phoneEnrollmentInfo:{phoneNumber:o.phoneNumber,recaptchaToken:r}});return n.phoneSessionInfo.sessionInfo}{SS("signin"===t.type,e,"internal-error");const n=(null===(i=o.multiFactorHint)||void 0===i?void 0:i.uid)||o.multiFactorUid;SS(n,e,"missing-multi-factor-info");const a=await function(e,t){return MS(e,"POST","/v2/accounts/mfaSignIn:start",zS(e,t))}(e,{mfaPendingCredential:t.credential,mfaEnrollmentId:n,phoneSignInInfo:{recaptchaToken:r}});return a.phoneResponseInfo.sessionInfo}}{const{sessionInfo:t}=await async function(e,t){return MS(e,"POST","/v1/accounts:sendVerificationCode",zS(e,t))}(e,{phoneNumber:o.phoneNumber,recaptchaToken:r});return t}}finally{n._reset()}}class NT{constructor(e){this.providerId=NT.PROVIDER_ID,this.auth=kE(e)}verifyPhoneNumber(e,t){return AT(this.auth,e,lh(t))}static credential(e,t){return HE._fromVerification(e,t)}static credentialFromResult(e){const t=e;return NT.credentialFromTaggedObject(t)}static credentialFromError(e){return NT.credentialFromTaggedObject(e.customData||{})}static credentialFromTaggedObject(e){let{_tokenResponse:t}=e;if(!t)return null;const{phoneNumber:n,temporaryProof:i}=t;return n&&i?HE._fromTokenResponse(n,i):null}}function OT(e,t){return t?aE(t):(SS(e._popupRedirectResolver,e,"argument-error"),e._popupRedirectResolver)}NT.PROVIDER_ID="phone",NT.PHONE_SIGN_IN_METHOD="phone";class PT extends DE{constructor(e){super("custom","custom"),this.params=e}_getIdTokenResponse(e){return jE(e,this._buildIdpRequest())}_linkToIdToken(e,t){return jE(e,this._buildIdpRequest(t))}_getReauthenticationResolver(e){return jE(e,this._buildIdpRequest())}_buildIdpRequest(e){const t={requestUri:this.params.requestUri,sessionId:this.params.sessionId,postBody:this.params.postBody,tenantId:this.params.tenantId,pendingToken:this.params.pendingToken,returnSecureToken:!0,returnIdpCredential:!0};return e&&(t.idToken=e),t}}function RT(e){return aT(e.auth,new PT(e),e.bypassAuthState)}function LT(e){const{auth:t,user:n}=e;return SS(n,t,"internal-error"),oT(n,new PT(e),e.bypassAuthState)}async function zT(e){const{auth:t,user:n}=e;return SS(n,t,"internal-error"),rT(n,new PT(e),e.bypassAuthState)}class MT{constructor(e,t,n,i){let r=arguments.length>4&&void 0!==arguments[4]&&arguments[4];this.auth=e,this.resolver=n,this.user=i,this.bypassAuthState=r,this.pendingPromise=null,this.eventManager=null,this.filter=Array.isArray(t)?t:[t]}execute(){return new Promise(async(e,t)=>{this.pendingPromise={resolve:e,reject:t};try{this.eventManager=await this.resolver._initialize(this.auth),await this.onExecution(),this.eventManager.registerConsumer(this)}catch(Tk){this.reject(Tk)}})}async onAuthEvent(e){const{urlResponse:t,sessionId:n,postBody:i,tenantId:r,error:o,type:a}=e;if(o)return void this.reject(o);const s={auth:this.auth,requestUri:t,sessionId:n,tenantId:r||void 0,postBody:i||void 0,user:this.user,bypassAuthState:this.bypassAuthState};try{this.resolve(await this.getIdpTask(a)(s))}catch(Tk){this.reject(Tk)}}onError(e){this.reject(e)}getIdpTask(e){switch(e){case"signInViaPopup":case"signInViaRedirect":return RT;case"linkViaPopup":case"linkViaRedirect":return zT;case"reauthViaPopup":case"reauthViaRedirect":return LT;default:vS(this.auth,"internal-error")}}resolve(e){TS(this.pendingPromise,"Pending promise was never set"),this.pendingPromise.resolve(e),this.unregisterAndCleanUp()}reject(e){TS(this.pendingPromise,"Pending promise was never set"),this.pendingPromise.reject(e),this.unregisterAndCleanUp()}unregisterAndCleanUp(){this.eventManager&&this.eventManager.unregisterConsumer(this),this.pendingPromise=null,this.cleanUp()}}const DT=new NS(2e3,1e4);class BT extends MT{constructor(e,t,n,i,r){super(e,t,i,r),this.provider=n,this.authWindow=null,this.pollId=null,BT.currentPopupAction&&BT.currentPopupAction.cancel(),BT.currentPopupAction=this}async executeNotNull(){const e=await this.execute();return SS(e,this.auth,"internal-error"),e}async onExecution(){TS(1===this.filter.length,"Popup operations only handle one event");const e=pT();this.authWindow=await this.resolver._openPopup(this.auth,this.provider,this.filter[0],e),this.authWindow.associatedEvent=e,this.resolver._originValidation(this.auth).catch(e=>{this.reject(e)}),this.resolver._isIframeWebStorageSupported(this.auth,e=>{e||this.reject(_S(this.auth,"web-storage-unsupported"))}),this.pollUserCancellation()}get eventId(){var e;return(null===(e=this.authWindow)||void 0===e?void 0:e.associatedEvent)||null}cancel(){this.reject(_S(this.auth,"cancelled-popup-request"))}cleanUp(){this.authWindow&&this.authWindow.close(),this.pollId&&window.clearTimeout(this.pollId),this.authWindow=null,this.pollId=null,BT.currentPopupAction=null}pollUserCancellation(){const e=()=>{var t,n;(null===(n=null===(t=this.authWindow)||void 0===t?void 0:t.window)||void 0===n?void 0:n.closed)?this.pollId=window.setTimeout(()=>{this.pollId=null,this.reject(_S(this.auth,"popup-closed-by-user"))},8e3):this.pollId=window.setTimeout(e,DT.get())};e()}}BT.currentPopupAction=null;const UT=new Map;class FT extends MT{constructor(e,t){super(e,["signInViaRedirect","linkViaRedirect","reauthViaRedirect","unknown"],t,void 0,arguments.length>2&&void 0!==arguments[2]&&arguments[2]),this.eventId=null}async execute(){let e=UT.get(this.auth._key());if(!e){try{const t=await async function(e,t){const n=qT(t),i=VT(e);if(!await i._isAvailable())return!1;const r="true"===await i._get(n);return await i._remove(n),r}(this.resolver,this.auth),n=t?await super.execute():null;e=()=>Promise.resolve(n)}catch(Tk){e=()=>Promise.reject(Tk)}UT.set(this.auth._key(),e)}return this.bypassAuthState||UT.set(this.auth._key(),()=>Promise.resolve(null)),e()}async onAuthEvent(e){if("signInViaRedirect"===e.type)return super.onAuthEvent(e);if("unknown"!==e.type){if(e.eventId){const t=await this.auth._redirectUserForId(e.eventId);if(t)return this.user=t,super.onAuthEvent(e);this.resolve(null)}}else this.resolve(null)}async onExecution(){}cleanUp(){}}function jT(e,t){UT.set(e._key(),t)}function VT(e){return aE(e._redirectPersistence)}function qT(e){return lE("pendingRedirect",e.config.apiKey,e.name)}async function HT(e,t){let n=arguments.length>2&&void 0!==arguments[2]&&arguments[2];if(xf(e.app))return Promise.reject(bS(e));const i=kE(e),r=OT(i,t),o=new FT(i,r,n),a=await o.execute();return a&&!n&&(delete a.user._redirectEventId,await i._persistUserIfCurrent(a.user),await i._setRedirectUser(null,t)),a}class WT{constructor(e){this.auth=e,this.cachedEventUids=new Set,this.consumers=new Set,this.queuedRedirectEvent=null,this.hasHandledPotentialRedirect=!1,this.lastProcessedEventTime=Date.now()}registerConsumer(e){this.consumers.add(e),this.queuedRedirectEvent&&this.isEventForConsumer(this.queuedRedirectEvent,e)&&(this.sendToConsumer(this.queuedRedirectEvent,e),this.saveEventToCache(this.queuedRedirectEvent),this.queuedRedirectEvent=null)}unregisterConsumer(e){this.consumers.delete(e)}onEvent(e){if(this.hasEventBeenHandled(e))return!1;let t=!1;return this.consumers.forEach(n=>{this.isEventForConsumer(e,n)&&(t=!0,this.sendToConsumer(e,n),this.saveEventToCache(e))}),this.hasHandledPotentialRedirect||!function(e){switch(e.type){case"signInViaRedirect":case"linkViaRedirect":case"reauthViaRedirect":return!0;case"unknown":return KT(e);default:return!1}}(e)||(this.hasHandledPotentialRedirect=!0,t||(this.queuedRedirectEvent=e,t=!0)),t}sendToConsumer(e,t){var n;if(e.error&&!KT(e)){const i=(null===(n=e.error.code)||void 0===n?void 0:n.split("auth/")[1])||"internal-error";t.onError(_S(this.auth,i))}else t.onAuthEvent(e)}isEventForConsumer(e,t){const n=null===t.eventId||!!e.eventId&&e.eventId===t.eventId;return t.filter.includes(e.type)&&n}hasEventBeenHandled(e){return Date.now()-this.lastProcessedEventTime>=6e5&&this.cachedEventUids.clear(),this.cachedEventUids.has(GT(e))}saveEventToCache(e){this.cachedEventUids.add(GT(e)),this.lastProcessedEventTime=Date.now()}}function GT(e){return[e.type,e.eventId,e.sessionId,e.tenantId].filter(e=>e).join("-")}function KT(e){let{type:t,error:n}=e;return"unknown"===t&&(null===n||void 0===n?void 0:n.code)==="auth/".concat("no-auth-event")}const ZT=/^\d{1,3}\.\d{1,3}\.\d{1,3}\.\d{1,3}$/,QT=/^https?/;async function XT(e){if(e.config.emulator)return;const{authorizedDomains:t}=await async function(e){return MS(e,"GET","/v1/projects",arguments.length>1&&void 0!==arguments[1]?arguments[1]:{})}(e);for(const n of t)try{if(YT(n))return}catch(we){}vS(e,"unauthorized-domain")}function YT(e){const t=kS(),{protocol:n,hostname:i}=new URL(t);if(e.startsWith("chrome-extension://")){const r=new URL(e);return""===r.hostname&&""===i?"chrome-extension:"===n&&e.replace("chrome-extension://","")===t.replace("chrome-extension://",""):"chrome-extension:"===n&&r.hostname===i}if(!QT.test(n))return!1;if(ZT.test(e))return i===e;const r=e.replace(/\./g,"\\.");return new RegExp("^(.+\\."+r+"|"+r+")$","i").test(i)}const JT=new NS(3e4,6e4);function $T(){const e=gT().___jsl;if(null===e||void 0===e?void 0:e.H)for(const t of Object.keys(e.H))if(e.H[t].r=e.H[t].r||[],e.H[t].L=e.H[t].L||[],e.H[t].r=[...e.H[t].L],e.CP)for(let n=0;n<e.CP.length;n++)e.CP[n]=null}function ek(e){return new Promise((t,n)=>{var i,r,o;function a(){$T(),gapi.load("gapi.iframes",{callback:()=>{t(gapi.iframes.getContext())},ontimeout:()=>{$T(),n(_S(e,"network-request-failed"))},timeout:JT.get()})}if(null===(r=null===(i=gT().gapi)||void 0===i?void 0:i.iframes)||void 0===r?void 0:r.Iframe)t(gapi.iframes.getContext());else{if(!(null===(o=gT().gapi)||void 0===o?void 0:o.load)){const t=NE("iframefcb");return gT()[t]=()=>{gapi.load?a():n(_S(e,"network-request-failed"))},AE("".concat(IE.gapiScript,"?onload=").concat(t)).catch(e=>n(e))}a()}}).catch(e=>{throw tk=null,e})}let tk=null;const nk=new NS(5e3,15e3),ik={style:{position:"absolute",top:"-100px",width:"1px",height:"1px"},"aria-hidden":"true",tabindex:"-1"},rk=new Map([["identitytoolkit.googleapis.com","p"],["staging-identitytoolkit.sandbox.googleapis.com","s"],["test-identitytoolkit.sandbox.googleapis.com","t"]]);function ok(e){const t=e.config;SS(t.authDomain,e,"auth-domain-config-required");const n=t.emulator?OS(t,"emulator/auth/iframe"):"https://".concat(e.config.authDomain,"/").concat("__/auth/iframe"),i={apiKey:t.apiKey,appName:e.name,v:Tf},r=rk.get(e.config.apiHost);r&&(i.eid=r);const o=e._getFrameworks();return o.length&&(i.fw=o.join(",")),"".concat(n,"?").concat(rh(i).slice(1))}async function ak(e){const t=await function(e){return tk=tk||ek(e),tk}(e),n=gT().gapi;return SS(n,e,"internal-error"),t.open({where:document.body,url:ok(e),messageHandlersFilter:n.iframes.CROSS_ORIGIN_IFRAMES_FILTER,attributes:ik,dontclear:!0},t=>new Promise(async(n,i)=>{await t.restyle({setHideOnLeave:!1});const r=_S(e,"network-request-failed"),o=gT().setTimeout(()=>{i(r)},nk.get());function a(){gT().clearTimeout(o),n(t)}t.ping(a).then(a,()=>{i(r)})}))}const sk={location:"yes",resizable:"yes",statusbar:"yes",toolbar:"no"};class ck{constructor(e){this.window=e,this.associatedEvent=null}close(){if(this.window)try{this.window.close()}catch(Tk){}}}function lk(e,t,n){let i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:500,r=arguments.length>4&&void 0!==arguments[4]?arguments[4]:600;const o=Math.max((window.screen.availHeight-r)/2,0).toString(),a=Math.max((window.screen.availWidth-i)/2,0).toString();let s="";const c=Object.assign(Object.assign({},sk),{width:i.toString(),height:r.toString(),top:o,left:a}),l=Xd().toLowerCase();n&&(s=pE(l)?"_blank":n),hE(l)&&(t=t||"http://localhost",c.scrollbars="yes");const u=Object.entries(c).reduce((e,t)=>{let[n,i]=t;return"".concat(e).concat(n,"=").concat(i,",")},"");if(function(){var e;return _E(arguments.length>0&&void 0!==arguments[0]?arguments[0]:Xd())&&!!(null===(e=window.navigator)||void 0===e?void 0:e.standalone)}(l)&&"_self"!==s)return function(e,t){const n=document.createElement("a");n.href=e,n.target=t;const i=document.createEvent("MouseEvent");i.initMouseEvent("click",!0,!0,window,1,0,0,0,0,!1,!1,!1,!1,1,null),n.dispatchEvent(i)}(t||"",s),new ck(null);const d=window.open(t||"",s,u);SS(d,e,"popup-blocked");try{d.focus()}catch(Tk){}return new ck(d)}const uk="__/auth/handler",dk="emulator/auth/handler",hk=encodeURIComponent("fac");async function fk(e,t,n,i,r,o){SS(e.config.authDomain,e,"auth-domain-config-required"),SS(e.config.apiKey,e,"invalid-api-key");const a={apiKey:e.config.apiKey,appName:e.name,authType:n,redirectUrl:i,v:Tf,eventId:r};if(t instanceof KE){t.setDefaultLanguage(e.languageCode),a.providerId=t.providerId||"",function(e){for(const t in e)if(Object.prototype.hasOwnProperty.call(e,t))return!1;return!0}(t.getCustomParameters())||(a.customParameters=JSON.stringify(t.getCustomParameters()));for(const[e,t]of Object.entries(o||{}))a[e]=t}if(t instanceof ZE){const e=t.getScopes().filter(e=>""!==e);e.length>0&&(a.scopes=e.join(","))}e.tenantId&&(a.tid=e.tenantId);const s=a;for(const u of Object.keys(s))void 0===s[u]&&delete s[u];const c=await e._getAppCheckToken(),l=c?"#".concat(hk,"=").concat(encodeURIComponent(c)):"";return"".concat(function(e){let{config:t}=e;if(!t.emulator)return"https://".concat(t.authDomain,"/").concat(uk);return OS(t,dk)}(e),"?").concat(rh(s).slice(1)).concat(l)}const pk="webStorageSupport";const mk=class{constructor(){this.eventManagers={},this.iframes={},this.originValidationPromises={},this._redirectPersistence=hT,this._completeRedirectFn=HT,this._overrideRedirectResult=jT}async _openPopup(e,t,n,i){var r;TS(null===(r=this.eventManagers[e._key()])||void 0===r?void 0:r.manager,"_initialize() not called before _openPopup()");return lk(e,await fk(e,t,n,kS(),i),pT())}async _openRedirect(e,t,n,i){await this._originValidation(e);return function(e){gT().location.href=e}(await fk(e,t,n,kS(),i)),new Promise(()=>{})}_initialize(e){const t=e._key();if(this.eventManagers[t]){const{manager:e,promise:n}=this.eventManagers[t];return e?Promise.resolve(e):(TS(n,"If manager is not set, promise should be"),n)}const n=this.initAndGetManager(e);return this.eventManagers[t]={promise:n},n.catch(()=>{delete this.eventManagers[t]}),n}async initAndGetManager(e){const t=await ak(e),n=new WT(e);return t.register("authEvent",t=>{SS(null===t||void 0===t?void 0:t.authEvent,e,"invalid-auth-event");return{status:n.onEvent(t.authEvent)?"ACK":"ERROR"}},gapi.iframes.CROSS_ORIGIN_IFRAMES_FILTER),this.eventManagers[e._key()]={manager:n},this.iframes[e._key()]=t,n}_isIframeWebStorageSupported(e,t){this.iframes[e._key()].send(pk,{type:pk},n=>{var i;const r=null===(i=null===n||void 0===n?void 0:n[0])||void 0===i?void 0:i[pk];void 0!==r&&t(!!r),vS(e,"internal-error")},gapi.iframes.CROSS_ORIGIN_IFRAMES_FILTER)}_originValidation(e){const t=e._key();return this.originValidationPromises[t]||(this.originValidationPromises[t]=XT(e)),this.originValidationPromises[t]}get _shouldInitProactively(){return bE()||fE()||_E()}};var gk="@firebase/auth",yk="1.7.9";class vk{constructor(e){this.auth=e,this.internalListeners=new Map}getUid(){var e;return this.assertAuthConfigured(),(null===(e=this.auth.currentUser)||void 0===e?void 0:e.uid)||null}async getToken(e){if(this.assertAuthConfigured(),await this.auth._initializationPromise,!this.auth.currentUser)return null;return{accessToken:await this.auth.currentUser.getIdToken(e)}}addAuthTokenListener(e){if(this.assertAuthConfigured(),this.internalListeners.has(e))return;const t=this.auth.onIdTokenChanged(t=>{e((null===t||void 0===t?void 0:t.stsTokenManager.accessToken)||null)});this.internalListeners.set(e,t),this.updateProactiveRefresh()}removeAuthTokenListener(e){this.assertAuthConfigured();const t=this.internalListeners.get(e);t&&(this.internalListeners.delete(e),t(),this.updateProactiveRefresh())}assertAuthConfigured(){SS(this.auth._initializationPromise,"dependent-sdk-initialized-before-auth")}updateProactiveRefresh(){this.internalListeners.size>0?this.auth._startProactiveRefresh():this.auth._stopProactiveRefresh()}}const _k=Kd("authIdTokenMaxAge")||300;let wk=null;var bk,xk;function Sk(e,t){return new Promise(function(n,i){let r;return Ek(e).then(function(e){try{return r=e,n(new Blob([t.slice(0,2),r,t.slice(2)],{type:"image/jpeg"}))}catch(e){return i(e)}},i)})}bk={loadJS:e=>new Promise((t,n)=>{const i=document.createElement("script");i.setAttribute("src",e),i.onload=t,i.onerror=e=>{const t=_S("internal-error");t.customData=e,n(t)},i.type="text/javascript",i.charset="UTF-8",function(){var e,t;return null!==(t=null===(e=document.getElementsByTagName("head"))||void 0===e?void 0:e[0])&&void 0!==t?t:document}().appendChild(i)}),gapiScript:"https://apis.google.com/js/api.js",recaptchaV2Script:"https://www.google.com/recaptcha/api.js",recaptchaEnterpriseScript:"https://www.google.com/recaptcha/enterprise.js?render="},IE=bk,xk="Browser",wf(new uh("auth",(e,t)=>{let{options:n}=t;const i=e.getProvider("app").getImmediate(),r=e.getProvider("heartbeat"),o=e.getProvider("app-check-internal"),{apiKey:a,authDomain:s}=i.options;SS(a&&!a.includes(":"),"invalid-api-key",{appName:i.name});const c={apiKey:a,authDomain:s,clientPlatform:xk,apiHost:"identitytoolkit.googleapis.com",tokenApiHost:"securetoken.googleapis.com",apiScheme:"https",sdkClientVersion:xE(xk)},l=new TE(i,r,o,c);return function(e,t){const n=(null===t||void 0===t?void 0:t.persistence)||[],i=(Array.isArray(n)?n:[n]).map(aE);(null===t||void 0===t?void 0:t.errorMap)&&e._updateErrorMap(t.errorMap),e._initializeWithPersistence(i,null===t||void 0===t?void 0:t.popupRedirectResolver)}(l,n),l},"PUBLIC").setInstantiationMode("EXPLICIT").setInstanceCreatedCallback((e,t,n)=>{e.getProvider("auth-internal").initialize()})),wf(new uh("auth-internal",e=>(e=>new vk(e))(kE(e.getProvider("auth").getImmediate())),"PRIVATE").setInstantiationMode("EXPLICIT")),If(gk,yk,function(e){switch(e){case"Node":return"node";case"ReactNative":return"rn";case"Worker":return"webworker";case"Cordova":return"cordova";case"WebExtension":return"web-extension";default:return}}(xk)),If(gk,yk,"esm2017");const Ek=e=>new Promise((t,n)=>{const i=new FileReader;i.addEventListener("load",e=>{let{target:{result:i}}=e;const r=new DataView(i);let o=0;if(65496!==r.getUint16(o))return n("not a valid JPEG");for(o+=2;;){const e=r.getUint16(o);if(65498===e)break;const a=r.getUint16(o+2);if(65505===e&&1165519206===r.getUint32(o+4)){const e=o+10;let s;switch(r.getUint16(e)){case 18761:s=!0;break;case 19789:s=!1;break;default:return n("TIFF header contains invalid endian")}if(42!==r.getUint16(e+2,s))return n("TIFF header contains invalid version");const c=r.getUint32(e+4,s),l=e+c+2+12*r.getUint16(e+c,s);for(let t=e+c+2;t<l;t+=12)if(274==r.getUint16(t,s)){if(3!==r.getUint16(t+2,s))return n("Orientation data type is invalid");if(1!==r.getUint32(t+4,s))return n("Orientation data count is invalid");r.setUint16(t+8,1,s);break}return t(i.slice(o,o+2+a))}o+=2+a}return t(new Blob)}),i.readAsArrayBuffer(e)});var Tk={},kk={get exports(){return Tk},set exports(e){Tk=e}};!function(){var e,t,n={};kk.exports=n,n.parse=function(e,t){for(var i=n.bin.readUshort,r=n.bin.readUint,o=0,a={},s=new Uint8Array(e),c=s.length-4;101010256!=r(s,c);)c--;o=c,o+=4;var l=i(s,o+=4);i(s,o+=2);var u=r(s,o+=2),d=r(s,o+=4);o+=4,o=d;for(var h=0;h<l;h++){r(s,o),o+=4,o+=4,o+=4,r(s,o+=4),u=r(s,o+=4);var f=r(s,o+=4),p=i(s,o+=4),m=i(s,o+2),g=i(s,o+4);o+=6;var y=r(s,o+=8);o+=4,o+=p+m+g,n._readLocal(s,y,a,u,f,t)}return a},n._readLocal=function(e,t,i,r,o,a){var s=n.bin.readUshort,c=n.bin.readUint;c(e,t),s(e,t+=4),s(e,t+=2);var l=s(e,t+=2);c(e,t+=2),c(e,t+=4),t+=4;var u=s(e,t+=8),d=s(e,t+=2);t+=2;var h=n.bin.readUTF8(e,t,u);if(t+=u,t+=d,a)i[h]={size:o,csize:r};else{var f=new Uint8Array(e.buffer,t);if(0==l)i[h]=new Uint8Array(f.buffer.slice(t,t+r));else{if(8!=l)throw"unknown compression method: "+l;var p=new Uint8Array(o);n.inflateRaw(f,p),i[h]=p}}},n.inflateRaw=function(e,t){return n.F.inflate(e,t)},n.inflate=function(e,t){return e[0],e[1],n.inflateRaw(new Uint8Array(e.buffer,e.byteOffset+2,e.length-6),t)},n.deflate=function(e,t){null==t&&(t={level:6});var i=0,r=new Uint8Array(50+Math.floor(1.1*e.length));r[i]=120,r[i+1]=156,i+=2,i=n.F.deflateRaw(e,r,i,t.level);var o=n.adler(e,0,e.length);return r[i+0]=o>>>24&255,r[i+1]=o>>>16&255,r[i+2]=o>>>8&255,r[i+3]=o>>>0&255,new Uint8Array(r.buffer,0,i+4)},n.deflateRaw=function(e,t){null==t&&(t={level:6});var i=new Uint8Array(50+Math.floor(1.1*e.length)),r=n.F.deflateRaw(e,i,r,t.level);return new Uint8Array(i.buffer,0,r)},n.encode=function(e,t){null==t&&(t=!1);var i=0,r=n.bin.writeUint,o=n.bin.writeUshort,a={};for(var s in e){var c=!n._noNeed(s)&&!t,l=e[s],u=n.crc.crc(l,0,l.length);a[s]={cpr:c,usize:l.length,crc:u,file:c?n.deflateRaw(l):l}}for(var s in a)i+=a[s].file.length+30+46+2*n.bin.sizeUTF8(s);i+=22;var d=new Uint8Array(i),h=0,f=[];for(var s in a){var p=a[s];f.push(h),h=n._writeHeader(d,h,s,p,0)}var m=0,g=h;for(var s in a)p=a[s],f.push(h),h=n._writeHeader(d,h,s,p,1,f[m++]);var y=h-g;return r(d,h,101010256),h+=4,o(d,h+=4,m),o(d,h+=2,m),r(d,h+=2,y),r(d,h+=4,g),h+=4,h+=2,d.buffer},n._noNeed=function(e){var t=e.split(".").pop().toLowerCase();return-1!="png,jpg,jpeg,zip".indexOf(t)},n._writeHeader=function(e,t,i,r,o,a){var s=n.bin.writeUint,c=n.bin.writeUshort,l=r.file;return s(e,t,0==o?67324752:33639248),t+=4,1==o&&(t+=2),c(e,t,20),c(e,t+=2,0),c(e,t+=2,r.cpr?8:0),s(e,t+=2,0),s(e,t+=4,r.crc),s(e,t+=4,l.length),s(e,t+=4,r.usize),c(e,t+=4,n.bin.sizeUTF8(i)),c(e,t+=2,0),t+=2,1==o&&(t+=2,t+=2,s(e,t+=6,a),t+=4),t+=n.bin.writeUTF8(e,t,i),0==o&&(e.set(l,t),t+=l.length),t},n.crc={table:function(){for(var e=new Uint32Array(256),t=0;t<256;t++){for(var n=t,i=0;i<8;i++)1&n?n=3988292384^n>>>1:n>>>=1;e[t]=n}return e}(),update:function(e,t,i,r){for(var o=0;o<r;o++)e=n.crc.table[255&(e^t[i+o])]^e>>>8;return e},crc:function(e,t,i){return 4294967295^n.crc.update(4294967295,e,t,i)}},n.adler=function(e,t,n){for(var i=1,r=0,o=t,a=t+n;o<a;){for(var s=Math.min(o+5552,a);o<s;)r+=i+=e[o++];i%=65521,r%=65521}return r<<16|i},n.bin={readUshort:function(e,t){return e[t]|e[t+1]<<8},writeUshort:function(e,t,n){e[t]=255&n,e[t+1]=n>>8&255},readUint:function(e,t){return 16777216*e[t+3]+(e[t+2]<<16|e[t+1]<<8|e[t])},writeUint:function(e,t,n){e[t]=255&n,e[t+1]=n>>8&255,e[t+2]=n>>16&255,e[t+3]=n>>24&255},readASCII:function(e,t,n){for(var i="",r=0;r<n;r++)i+=String.fromCharCode(e[t+r]);return i},writeASCII:function(e,t,n){for(var i=0;i<n.length;i++)e[t+i]=n.charCodeAt(i)},pad:function(e){return e.length<2?"0"+e:e},readUTF8:function(e,t,i){for(var r,o="",a=0;a<i;a++)o+="%"+n.bin.pad(e[t+a].toString(16));try{r=decodeURIComponent(o)}catch(r){return n.bin.readASCII(e,t,i)}return r},writeUTF8:function(e,t,n){for(var i=n.length,r=0,o=0;o<i;o++){var a=n.charCodeAt(o);if(0==(4294967168&a))e[t+r]=a,r++;else if(0==(4294965248&a))e[t+r]=192|a>>6,e[t+r+1]=128|63&a,r+=2;else if(0==(4294901760&a))e[t+r]=224|a>>12,e[t+r+1]=128|a>>6&63,e[t+r+2]=128|63&a,r+=3;else{if(0!=(4292870144&a))throw"e";e[t+r]=240|a>>18,e[t+r+1]=128|a>>12&63,e[t+r+2]=128|a>>6&63,e[t+r+3]=128|63&a,r+=4}}return r},sizeUTF8:function(e){for(var t=e.length,n=0,i=0;i<t;i++){var r=e.charCodeAt(i);if(0==(4294967168&r))n++;else if(0==(4294965248&r))n+=2;else if(0==(4294901760&r))n+=3;else{if(0!=(4292870144&r))throw"e";n+=4}}return n}},n.F={},n.F.deflateRaw=function(e,t,i,r){var o=[[0,0,0,0,0],[4,4,8,4,0],[4,5,16,8,0],[4,6,16,16,0],[4,10,16,32,0],[8,16,32,32,0],[8,16,128,128,0],[8,32,128,256,0],[32,128,258,1024,1],[32,258,258,4096,1]][r],a=n.F.U,s=n.F._goodIndex;n.F._hash;var c=n.F._putsE,l=0,u=i<<3,d=0,h=e.length;if(0==r){for(;l<h;)c(t,u,l+(E=Math.min(65535,h-l))==h?1:0),u=n.F._copyExact(e,l,E,t,u+8),l+=E;return u>>>3}var f=a.lits,p=a.strt,m=a.prev,g=0,y=0,v=0,_=0,w=0,b=0;for(h>2&&(p[b=n.F._hash(e,0)]=0),l=0;l<h;l++){if(w=b,l+1<h-2){b=n.F._hash(e,l+1);var x=l+1&32767;m[x]=p[b],p[b]=x}if(d<=l){(g>14e3||y>26697)&&h-l>100&&(d<l&&(f[g]=l-d,g+=2,d=l),u=n.F._writeBlock(l==h-1||d==h?1:0,f,g,_,e,v,l-v,t,u),g=y=_=0,v=l);var S=0;l<h-2&&(S=n.F._bestMatch(e,l,m,w,Math.min(o[2],h-l),o[3]));var E=S>>>16,T=65535&S;if(0!=S){T=65535&S;var k=s(E=S>>>16,a.of0);a.lhst[257+k]++;var C=s(T,a.df0);a.dhst[C]++,_+=a.exb[k]+a.dxb[C],f[g]=E<<23|l-d,f[g+1]=T<<16|k<<8|C,g+=2,d=l+E}else a.lhst[e[l]]++;y++}}for(v==l&&0!=e.length||(d<l&&(f[g]=l-d,g+=2,d=l),u=n.F._writeBlock(1,f,g,_,e,v,l-v,t,u),g=0,y=0,g=y=_=0,v=l);0!=(7&u);)u++;return u>>>3},n.F._bestMatch=function(e,t,i,r,o,a){var s=32767&t,c=i[s],l=s-c+32768&32767;if(c==s||r!=n.F._hash(e,t-l))return 0;for(var u=0,d=0,h=Math.min(32767,t);l<=h&&0!=--a&&c!=s;){if(0==u||e[t+u]==e[t+u-l]){var f=n.F._howLong(e,t,l);if(f>u){if(d=l,(u=f)>=o)break;l+2<f&&(f=l+2);for(var p=0,m=0;m<f-2;m++){var g=t-l+m+32768&32767,y=g-i[g]+32768&32767;y>p&&(p=y,c=g)}}}l+=(s=c)-(c=i[s])+32768&32767}return u<<16|d},n.F._howLong=function(e,t,n){if(e[t]!=e[t-n]||e[t+1]!=e[t+1-n]||e[t+2]!=e[t+2-n])return 0;var i=t,r=Math.min(e.length,t+258);for(t+=3;t<r&&e[t]==e[t-n];)t++;return t-i},n.F._hash=function(e,t){return(e[t]<<8|e[t+1])+(e[t+2]<<4)&65535},n.saved=0,n.F._writeBlock=function(e,t,i,r,o,a,s,c,l){var u,d,h,f,p,m,g,y,v,_=n.F.U,w=n.F._putsF,b=n.F._putsE;_.lhst[256]++,d=(u=n.F.getTrees())[0],h=u[1],f=u[2],p=u[3],m=u[4],g=u[5],y=u[6],v=u[7];var x=32+(0==(l+3&7)?0:8-(l+3&7))+(s<<3),S=r+n.F.contSize(_.fltree,_.lhst)+n.F.contSize(_.fdtree,_.dhst),E=r+n.F.contSize(_.ltree,_.lhst)+n.F.contSize(_.dtree,_.dhst);E+=14+3*g+n.F.contSize(_.itree,_.ihst)+(2*_.ihst[16]+3*_.ihst[17]+7*_.ihst[18]);for(var T=0;T<286;T++)_.lhst[T]=0;for(T=0;T<30;T++)_.dhst[T]=0;for(T=0;T<19;T++)_.ihst[T]=0;var k=x<S&&x<E?0:S<E?1:2;if(w(c,l,e),w(c,l+1,k),l+=3,0==k){for(;0!=(7&l);)l++;l=n.F._copyExact(o,a,s,c,l)}else{var C,I;if(1==k&&(C=_.fltree,I=_.fdtree),2==k){n.F.makeCodes(_.ltree,d),n.F.revCodes(_.ltree,d),n.F.makeCodes(_.dtree,h),n.F.revCodes(_.dtree,h),n.F.makeCodes(_.itree,f),n.F.revCodes(_.itree,f),C=_.ltree,I=_.dtree,b(c,l,p-257),b(c,l+=5,m-1),b(c,l+=5,g-4),l+=4;for(var A=0;A<g;A++)b(c,l+3*A,_.itree[1+(_.ordr[A]<<1)]);l+=3*g,l=n.F._codeTiny(y,_.itree,c,l),l=n.F._codeTiny(v,_.itree,c,l)}for(var N=a,O=0;O<i;O+=2){for(var P=t[O],R=P>>>23,L=N+(8388607&P);N<L;)l=n.F._writeLit(o[N++],C,c,l);if(0!=R){var z=t[O+1],M=z>>16,D=z>>8&255,B=255&z;b(c,l=n.F._writeLit(257+D,C,c,l),R-_.of0[D]),l+=_.exb[D],w(c,l=n.F._writeLit(B,I,c,l),M-_.df0[B]),l+=_.dxb[B],N+=R}}l=n.F._writeLit(256,C,c,l)}return l},n.F._copyExact=function(e,t,n,i,r){var o=r>>>3;return i[o]=n,i[o+1]=n>>>8,i[o+2]=255-i[o],i[o+3]=255-i[o+1],o+=4,i.set(new Uint8Array(e.buffer,t,n),o),r+(n+4<<3)},n.F.getTrees=function(){for(var e=n.F.U,t=n.F._hufTree(e.lhst,e.ltree,15),i=n.F._hufTree(e.dhst,e.dtree,15),r=[],o=n.F._lenCodes(e.ltree,r),a=[],s=n.F._lenCodes(e.dtree,a),c=0;c<r.length;c+=2)e.ihst[r[c]]++;for(c=0;c<a.length;c+=2)e.ihst[a[c]]++;for(var l=n.F._hufTree(e.ihst,e.itree,7),u=19;u>4&&0==e.itree[1+(e.ordr[u-1]<<1)];)u--;return[t,i,l,o,s,u,r,a]},n.F.getSecond=function(e){for(var t=[],n=0;n<e.length;n+=2)t.push(e[n+1]);return t},n.F.nonZero=function(e){for(var t="",n=0;n<e.length;n+=2)0!=e[n+1]&&(t+=(n>>1)+",");return t},n.F.contSize=function(e,t){for(var n=0,i=0;i<t.length;i++)n+=t[i]*e[1+(i<<1)];return n},n.F._codeTiny=function(e,t,i,r){for(var o=0;o<e.length;o+=2){var a=e[o],s=e[o+1];r=n.F._writeLit(a,t,i,r);var c=16==a?2:17==a?3:7;a>15&&(n.F._putsE(i,r,s,c),r+=c)}return r},n.F._lenCodes=function(e,t){for(var n=e.length;2!=n&&0==e[n-1];)n-=2;for(var i=0;i<n;i+=2){var r=e[i+1],o=i+3<n?e[i+3]:-1,a=i+5<n?e[i+5]:-1,s=0==i?-1:e[i-1];if(0==r&&o==r&&a==r){for(var c=i+5;c+2<n&&e[c+2]==r;)c+=2;(l=Math.min(c+1-i>>>1,138))<11?t.push(17,l-3):t.push(18,l-11),i+=2*l-2}else if(r==s&&o==r&&a==r){for(c=i+5;c+2<n&&e[c+2]==r;)c+=2;var l=Math.min(c+1-i>>>1,6);t.push(16,l-3),i+=2*l-2}else t.push(r,0)}return n>>>1},n.F._hufTree=function(e,t,i){var r=[],o=e.length,a=t.length,s=0;for(s=0;s<a;s+=2)t[s]=0,t[s+1]=0;for(s=0;s<o;s++)0!=e[s]&&r.push({lit:s,f:e[s]});var c=r.length,l=r.slice(0);if(0==c)return 0;if(1==c){var u=r[0].lit;return l=0==u?1:0,t[1+(u<<1)]=1,t[1+(l<<1)]=1,1}r.sort(function(e,t){return e.f-t.f});var d=r[0],h=r[1],f=0,p=1,m=2;for(r[0]={lit:-1,f:d.f+h.f,l:d,r:h,d:0};p!=c-1;)d=f!=p&&(m==c||r[f].f<r[m].f)?r[f++]:r[m++],h=f!=p&&(m==c||r[f].f<r[m].f)?r[f++]:r[m++],r[p++]={lit:-1,f:d.f+h.f,l:d,r:h};var g=n.F.setDepth(r[p-1],0);for(g>i&&(n.F.restrictDepth(l,i,g),g=i),s=0;s<c;s++)t[1+(l[s].lit<<1)]=l[s].d;return g},n.F.setDepth=function(e,t){return-1!=e.lit?(e.d=t,t):Math.max(n.F.setDepth(e.l,t+1),n.F.setDepth(e.r,t+1))},n.F.restrictDepth=function(e,t,n){var i=0,r=1<<n-t,o=0;for(e.sort(function(e,t){return t.d==e.d?e.f-t.f:t.d-e.d}),i=0;i<e.length&&e[i].d>t;i++){var a=e[i].d;e[i].d=t,o+=r-(1<<n-a)}for(o>>>=n-t;o>0;)(a=e[i].d)<t?(e[i].d++,o-=1<<t-a-1):i++;for(;i>=0;i--)e[i].d==t&&o<0&&(e[i].d--,o++);0!=o&&console.log("debt left")},n.F._goodIndex=function(e,t){var n=0;return t[16|n]<=e&&(n|=16),t[8|n]<=e&&(n|=8),t[4|n]<=e&&(n|=4),t[2|n]<=e&&(n|=2),t[1|n]<=e&&(n|=1),n},n.F._writeLit=function(e,t,i,r){return n.F._putsF(i,r,t[e<<1]),r+t[1+(e<<1)]},n.F.inflate=function(e,t){var i=Uint8Array;if(3==e[0]&&0==e[1])return t||new i(0);var r=n.F,o=r._bitsF,a=r._bitsE,s=r._decodeTiny,c=r.makeCodes,l=r.codes2map,u=r._get17,d=r.U,h=null==t;h&&(t=new i(e.length>>>2<<3));for(var f,p,m=0,g=0,y=0,v=0,_=0,w=0,b=0,x=0,S=0;0==m;)if(m=o(e,S,1),g=o(e,S+1,2),S+=3,0!=g){if(h&&(t=n.F._check(t,x+(1<<17))),1==g&&(f=d.flmap,p=d.fdmap,w=511,b=31),2==g){y=a(e,S,5)+257,v=a(e,S+5,5)+1,_=a(e,S+10,4)+4,S+=14;for(var E=0;E<38;E+=2)d.itree[E]=0,d.itree[E+1]=0;var T=1;for(E=0;E<_;E++){var k=a(e,S+3*E,3);d.itree[1+(d.ordr[E]<<1)]=k,k>T&&(T=k)}S+=3*_,c(d.itree,T),l(d.itree,T,d.imap),f=d.lmap,p=d.dmap,S=s(d.imap,(1<<T)-1,y+v,e,S,d.ttree);var C=r._copyOut(d.ttree,0,y,d.ltree);w=(1<<C)-1;var I=r._copyOut(d.ttree,y,v,d.dtree);b=(1<<I)-1,c(d.ltree,C),l(d.ltree,C,f),c(d.dtree,I),l(d.dtree,I,p)}for(;;){var A=f[u(e,S)&w];S+=15&A;var N=A>>>4;if(N>>>8==0)t[x++]=N;else{if(256==N)break;var O=x+N-254;if(N>264){var P=d.ldef[N-257];O=x+(P>>>3)+a(e,S,7&P),S+=7&P}var R=p[u(e,S)&b];S+=15&R;var L=R>>>4,z=d.ddef[L],M=(z>>>4)+o(e,S,15&z);for(S+=15&z,h&&(t=n.F._check(t,x+(1<<17)));x<O;)t[x]=t[x++-M],t[x]=t[x++-M],t[x]=t[x++-M],t[x]=t[x++-M];x=O}}}else{0!=(7&S)&&(S+=8-(7&S));var D=4+(S>>>3),B=e[D-4]|e[D-3]<<8;h&&(t=n.F._check(t,x+B)),t.set(new i(e.buffer,e.byteOffset+D,B),x),S=D+B<<3,x+=B}return t.length==x?t:t.slice(0,x)},n.F._check=function(e,t){var n=e.length;if(t<=n)return e;var i=new Uint8Array(Math.max(n<<1,t));return i.set(e,0),i},n.F._decodeTiny=function(e,t,i,r,o,a){for(var s=n.F._bitsE,c=n.F._get17,l=0;l<i;){var u=e[c(r,o)&t];o+=15&u;var d=u>>>4;if(d<=15)a[l]=d,l++;else{var h=0,f=0;16==d?(f=3+s(r,o,2),o+=2,h=a[l-1]):17==d?(f=3+s(r,o,3),o+=3):18==d&&(f=11+s(r,o,7),o+=7);for(var p=l+f;l<p;)a[l]=h,l++}}return o},n.F._copyOut=function(e,t,n,i){for(var r=0,o=0,a=i.length>>>1;o<n;){var s=e[o+t];i[o<<1]=0,i[1+(o<<1)]=s,s>r&&(r=s),o++}for(;o<a;)i[o<<1]=0,i[1+(o<<1)]=0,o++;return r},n.F.makeCodes=function(e,t){for(var i,r,o,a,s=n.F.U,c=e.length,l=s.bl_count,u=0;u<=t;u++)l[u]=0;for(u=1;u<c;u+=2)l[e[u]]++;var d=s.next_code;for(i=0,l[0]=0,r=1;r<=t;r++)i=i+l[r-1]<<1,d[r]=i;for(o=0;o<c;o+=2)0!=(a=e[o+1])&&(e[o]=d[a],d[a]++)},n.F.codes2map=function(e,t,i){for(var r=e.length,o=n.F.U.rev15,a=0;a<r;a+=2)if(0!=e[a+1])for(var s=a>>1,c=e[a+1],l=s<<4|c,u=t-c,d=e[a]<<u,h=d+(1<<u);d!=h;)i[o[d]>>>15-t]=l,d++},n.F.revCodes=function(e,t){for(var i=n.F.U.rev15,r=15-t,o=0;o<e.length;o+=2){var a=e[o]<<t-e[o+1];e[o]=i[a]>>>r}},n.F._putsE=function(e,t,n){n<<=7&t;var i=t>>>3;e[i]|=n,e[i+1]|=n>>>8},n.F._putsF=function(e,t,n){n<<=7&t;var i=t>>>3;e[i]|=n,e[i+1]|=n>>>8,e[i+2]|=n>>>16},n.F._bitsE=function(e,t,n){return(e[t>>>3]|e[1+(t>>>3)]<<8)>>>(7&t)&(1<<n)-1},n.F._bitsF=function(e,t,n){return(e[t>>>3]|e[1+(t>>>3)]<<8|e[2+(t>>>3)]<<16)>>>(7&t)&(1<<n)-1},n.F._get17=function(e,t){return(e[t>>>3]|e[1+(t>>>3)]<<8|e[2+(t>>>3)]<<16)>>>(7&t)},n.F._get25=function(e,t){return(e[t>>>3]|e[1+(t>>>3)]<<8|e[2+(t>>>3)]<<16|e[3+(t>>>3)]<<24)>>>(7&t)},n.F.U=(e=Uint16Array,t=Uint32Array,{next_code:new e(16),bl_count:new e(16),ordr:[16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15],of0:[3,4,5,6,7,8,9,10,11,13,15,17,19,23,27,31,35,43,51,59,67,83,99,115,131,163,195,227,258,999,999,999],exb:[0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0,0,0,0],ldef:new e(32),df0:[1,2,3,4,5,7,9,13,17,25,33,49,65,97,129,193,257,385,513,769,1025,1537,2049,3073,4097,6145,8193,12289,16385,24577,65535,65535],dxb:[0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13,0,0],ddef:new t(32),flmap:new e(512),fltree:[],fdmap:new e(32),fdtree:[],lmap:new e(32768),ltree:[],ttree:[],dmap:new e(32768),dtree:[],imap:new e(512),itree:[],rev15:new e(32768),lhst:new t(286),dhst:new t(30),ihst:new t(19),lits:new t(15e3),strt:new e(65536),prev:new e(32768)}),function(){for(var e=n.F.U,t=0;t<32768;t++){var i=t;i=(4278255360&(i=(4042322160&(i=(3435973836&(i=(2863311530&i)>>>1|(1431655765&i)<<1))>>>2|(858993459&i)<<2))>>>4|(252645135&i)<<4))>>>8|(16711935&i)<<8,e.rev15[t]=(i>>>16|i<<16)>>>17}function r(e,t,n){for(;0!=t--;)e.push(0,n)}for(t=0;t<32;t++)e.ldef[t]=e.of0[t]<<3|e.exb[t],e.ddef[t]=e.df0[t]<<4|e.dxb[t];r(e.fltree,144,8),r(e.fltree,112,9),r(e.fltree,24,7),r(e.fltree,8,8),n.F.makeCodes(e.fltree,9),n.F.codes2map(e.fltree,9,e.flmap),n.F.revCodes(e.fltree,9),r(e.fdtree,32,5),n.F.makeCodes(e.fdtree,5),n.F.codes2map(e.fdtree,5,e.fdmap),n.F.revCodes(e.fdtree,5),r(e.itree,19,0),r(e.ltree,286,0),r(e.dtree,30,0),r(e.ttree,320,0)}()}();var Ck=function(e,t){return t.forEach(function(t){t&&"string"!=typeof t&&!Array.isArray(t)&&Object.keys(t).forEach(function(n){if("default"!==n&&!(n in e)){var i=Object.getOwnPropertyDescriptor(t,n);Object.defineProperty(e,n,i.get?i:{enumerable:!0,get:function(){return t[n]}})}})}),Object.freeze(e)}({__proto__:null,default:Tk},[Tk]);const Ik=function(){var e={nextZero(e,t){for(;0!=e[t];)t++;return t},readUshort:(e,t)=>e[t]<<8|e[t+1],writeUshort(e,t,n){e[t]=n>>8&255,e[t+1]=255&n},readUint:(e,t)=>16777216*e[t]+(e[t+1]<<16|e[t+2]<<8|e[t+3]),writeUint(e,t,n){e[t]=n>>24&255,e[t+1]=n>>16&255,e[t+2]=n>>8&255,e[t+3]=255&n},readASCII(e,t,n){let i="";for(let r=0;r<n;r++)i+=String.fromCharCode(e[t+r]);return i},writeASCII(e,t,n){for(let i=0;i<n.length;i++)e[t+i]=n.charCodeAt(i)},readBytes(e,t,n){const i=[];for(let r=0;r<n;r++)i.push(e[t+r]);return i},pad:e=>e.length<2?"0".concat(e):e,readUTF8(t,n,i){let r,o="";for(let a=0;a<i;a++)o+="%".concat(e.pad(t[n+a].toString(16)));try{r=decodeURIComponent(o)}catch(r){return e.readASCII(t,n,i)}return r}};function t(t,n,i,r){const a=n*i,s=o(r),c=Math.ceil(n*s/8),l=new Uint8Array(4*a),u=new Uint32Array(l.buffer),{ctype:d}=r,{depth:h}=r,f=e.readUshort;if(6==d){const e=a<<2;if(8==h)for(var p=0;p<e;p+=4)l[p]=t[p],l[p+1]=t[p+1],l[p+2]=t[p+2],l[p+3]=t[p+3];if(16==h)for(p=0;p<e;p++)l[p]=t[p<<1]}else if(2==d){const e=r.tabs.tRNS;if(null==e){if(8==h)for(p=0;p<a;p++){var m=3*p;u[p]=255<<24|t[m+2]<<16|t[m+1]<<8|t[m]}if(16==h)for(p=0;p<a;p++)m=6*p,u[p]=255<<24|t[m+4]<<16|t[m+2]<<8|t[m]}else{var g=e[0];const n=e[1],i=e[2];if(8==h)for(p=0;p<a;p++){var y=p<<2;m=3*p,u[p]=255<<24|t[m+2]<<16|t[m+1]<<8|t[m],t[m]==g&&t[m+1]==n&&t[m+2]==i&&(l[y+3]=0)}if(16==h)for(p=0;p<a;p++)y=p<<2,m=6*p,u[p]=255<<24|t[m+4]<<16|t[m+2]<<8|t[m],f(t,m)==g&&f(t,m+2)==n&&f(t,m+4)==i&&(l[y+3]=0)}}else if(3==d){const e=r.tabs.PLTE,o=r.tabs.tRNS,s=o?o.length:0;if(1==h)for(var v=0;v<i;v++){var _=v*c,w=v*n;for(p=0;p<n;p++){y=w+p<<2;var b=3*(x=t[_+(p>>3)]>>7-(7&p)&1);l[y]=e[b],l[y+1]=e[b+1],l[y+2]=e[b+2],l[y+3]=x<s?o[x]:255}}if(2==h)for(v=0;v<i;v++)for(_=v*c,w=v*n,p=0;p<n;p++)y=w+p<<2,b=3*(x=t[_+(p>>2)]>>6-((3&p)<<1)&3),l[y]=e[b],l[y+1]=e[b+1],l[y+2]=e[b+2],l[y+3]=x<s?o[x]:255;if(4==h)for(v=0;v<i;v++)for(_=v*c,w=v*n,p=0;p<n;p++)y=w+p<<2,b=3*(x=t[_+(p>>1)]>>4-((1&p)<<2)&15),l[y]=e[b],l[y+1]=e[b+1],l[y+2]=e[b+2],l[y+3]=x<s?o[x]:255;if(8==h)for(p=0;p<a;p++){var x;y=p<<2,b=3*(x=t[p]),l[y]=e[b],l[y+1]=e[b+1],l[y+2]=e[b+2],l[y+3]=x<s?o[x]:255}}else if(4==d){if(8==h)for(p=0;p<a;p++){y=p<<2;var S=t[E=p<<1];l[y]=S,l[y+1]=S,l[y+2]=S,l[y+3]=t[E+1]}if(16==h)for(p=0;p<a;p++){var E;y=p<<2,S=t[E=p<<2],l[y]=S,l[y+1]=S,l[y+2]=S,l[y+3]=t[E+2]}}else if(0==d)for(g=r.tabs.tRNS?r.tabs.tRNS:-1,v=0;v<i;v++){const e=v*c,i=v*n;if(1==h)for(var T=0;T<n;T++){var k=(S=255*(t[e+(T>>>3)]>>>7-(7&T)&1))==255*g?0:255;u[i+T]=k<<24|S<<16|S<<8|S}else if(2==h)for(T=0;T<n;T++)k=(S=85*(t[e+(T>>>2)]>>>6-((3&T)<<1)&3))==85*g?0:255,u[i+T]=k<<24|S<<16|S<<8|S;else if(4==h)for(T=0;T<n;T++)k=(S=17*(t[e+(T>>>1)]>>>4-((1&T)<<2)&15))==17*g?0:255,u[i+T]=k<<24|S<<16|S<<8|S;else if(8==h)for(T=0;T<n;T++)k=(S=t[e+T])==g?0:255,u[i+T]=k<<24|S<<16|S<<8|S;else if(16==h)for(T=0;T<n;T++)S=t[e+(T<<1)],k=f(t,e+(T<<1))==g?0:255,u[i+T]=k<<24|S<<16|S<<8|S}return l}function n(e,t,n,s){const c=o(e),l=Math.ceil(n*c/8),u=new Uint8Array((l+1+e.interlace)*s);return t=e.tabs.CgBI?r(t,u):i(t,u),0==e.interlace?t=a(t,e,0,n,s):1==e.interlace&&(t=function(e,t){const n=t.width,i=t.height,r=o(t),s=r>>3,c=Math.ceil(n*r/8),l=new Uint8Array(i*c);let u=0;const d=[0,0,4,0,2,0,1],h=[0,4,0,2,0,1,0],f=[8,8,8,4,4,2,2],p=[8,8,4,4,2,2,1];let m=0;for(;m<7;){const o=f[m],y=p[m];let v=0,_=0,w=d[m];for(;w<i;)w+=o,_++;let b=h[m];for(;b<n;)b+=y,v++;const x=Math.ceil(v*r/8);a(e,t,u,v,_);let S=0,E=d[m];for(;E<i;){let t=h[m],i=u+S*x<<3;for(;t<n;){var g;if(1==r&&(g=(g=e[i>>3])>>7-(7&i)&1,l[E*c+(t>>3)]|=g<<7-(7&t)),2==r&&(g=(g=e[i>>3])>>6-(7&i)&3,l[E*c+(t>>2)]|=g<<6-((3&t)<<1)),4==r&&(g=(g=e[i>>3])>>4-(7&i)&15,l[E*c+(t>>1)]|=g<<4-((1&t)<<2)),r>=8){const n=E*c+t*s;for(let t=0;t<s;t++)l[n+t]=e[(i>>3)+t]}i+=r,t+=y}S++,E+=o}v*_!=0&&(u+=_*(1+x)),m+=1}return l}(t,e)),t}function i(e,t){return r(new Uint8Array(e.buffer,2,e.length-6),t)}var r=function(){const e={H:{}};return e.H.N=function(t,n){const i=Uint8Array;let r,o,a=0,s=0,c=0,l=0,u=0,d=0,h=0,f=0,p=0;if(3==t[0]&&0==t[1])return n||new i(0);const m=e.H,g=m.b,y=m.e,v=m.R,_=m.n,w=m.A,b=m.Z,x=m.m,S=null==n;for(S&&(n=new i(t.length>>>2<<5));0==a;)if(a=g(t,p,1),s=g(t,p+1,2),p+=3,0!=s){if(S&&(n=e.H.W(n,f+(1<<17))),1==s&&(r=x.J,o=x.h,d=511,h=31),2==s){c=y(t,p,5)+257,l=y(t,p+5,5)+1,u=y(t,p+10,4)+4,p+=14;let e=1;for(var E=0;E<38;E+=2)x.Q[E]=0,x.Q[E+1]=0;for(E=0;E<u;E++){const n=y(t,p+3*E,3);x.Q[1+(x.X[E]<<1)]=n,n>e&&(e=n)}p+=3*u,_(x.Q,e),w(x.Q,e,x.u),r=x.w,o=x.d,p=v(x.u,(1<<e)-1,c+l,t,p,x.v);const n=m.V(x.v,0,c,x.C);d=(1<<n)-1;const i=m.V(x.v,c,l,x.D);h=(1<<i)-1,_(x.C,n),w(x.C,n,r),_(x.D,i),w(x.D,i,o)}for(;;){const e=r[b(t,p)&d];p+=15&e;const i=e>>>4;if(i>>>8==0)n[f++]=i;else{if(256==i)break;{let e=f+i-254;if(i>264){const n=x.q[i-257];e=f+(n>>>3)+y(t,p,7&n),p+=7&n}const r=o[b(t,p)&h];p+=15&r;const a=r>>>4,s=x.c[a],c=(s>>>4)+g(t,p,15&s);for(p+=15&s;f<e;)n[f]=n[f++-c],n[f]=n[f++-c],n[f]=n[f++-c],n[f]=n[f++-c];f=e}}}}else{0!=(7&p)&&(p+=8-(7&p));const r=4+(p>>>3),o=t[r-4]|t[r-3]<<8;S&&(n=e.H.W(n,f+o)),n.set(new i(t.buffer,t.byteOffset+r,o),f),p=r+o<<3,f+=o}return n.length==f?n:n.slice(0,f)},e.H.W=function(e,t){const n=e.length;if(t<=n)return e;const i=new Uint8Array(n<<1);return i.set(e,0),i},e.H.R=function(t,n,i,r,o,a){const s=e.H.e,c=e.H.Z;let l=0;for(;l<i;){const e=t[c(r,o)&n];o+=15&e;const i=e>>>4;if(i<=15)a[l]=i,l++;else{let e=0,t=0;16==i?(t=3+s(r,o,2),o+=2,e=a[l-1]):17==i?(t=3+s(r,o,3),o+=3):18==i&&(t=11+s(r,o,7),o+=7);const n=l+t;for(;l<n;)a[l]=e,l++}}return o},e.H.V=function(e,t,n,i){let r=0,o=0;const a=i.length>>>1;for(;o<n;){const n=e[o+t];i[o<<1]=0,i[1+(o<<1)]=n,n>r&&(r=n),o++}for(;o<a;)i[o<<1]=0,i[1+(o<<1)]=0,o++;return r},e.H.n=function(t,n){const i=e.H.m,r=t.length;let o,a,s,c;const l=i.j;for(var u=0;u<=n;u++)l[u]=0;for(u=1;u<r;u+=2)l[t[u]]++;const d=i.K;for(o=0,l[0]=0,a=1;a<=n;a++)o=o+l[a-1]<<1,d[a]=o;for(s=0;s<r;s+=2)c=t[s+1],0!=c&&(t[s]=d[c],d[c]++)},e.H.A=function(t,n,i){const r=t.length,o=e.H.m.r;for(let e=0;e<r;e+=2)if(0!=t[e+1]){const r=e>>1,a=t[e+1],s=r<<4|a,c=n-a;let l=t[e]<<c;const u=l+(1<<c);for(;l!=u;)i[o[l]>>>15-n]=s,l++}},e.H.l=function(t,n){const i=e.H.m.r,r=15-n;for(let e=0;e<t.length;e+=2){const o=t[e]<<n-t[e+1];t[e]=i[o]>>>r}},e.H.M=function(e,t,n){n<<=7&t;const i=t>>>3;e[i]|=n,e[i+1]|=n>>>8},e.H.I=function(e,t,n){n<<=7&t;const i=t>>>3;e[i]|=n,e[i+1]|=n>>>8,e[i+2]|=n>>>16},e.H.e=function(e,t,n){return(e[t>>>3]|e[1+(t>>>3)]<<8)>>>(7&t)&(1<<n)-1},e.H.b=function(e,t,n){return(e[t>>>3]|e[1+(t>>>3)]<<8|e[2+(t>>>3)]<<16)>>>(7&t)&(1<<n)-1},e.H.Z=function(e,t){return(e[t>>>3]|e[1+(t>>>3)]<<8|e[2+(t>>>3)]<<16)>>>(7&t)},e.H.i=function(e,t){return(e[t>>>3]|e[1+(t>>>3)]<<8|e[2+(t>>>3)]<<16|e[3+(t>>>3)]<<24)>>>(7&t)},e.H.m=function(){const e=Uint16Array,t=Uint32Array;return{K:new e(16),j:new e(16),X:[16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15],S:[3,4,5,6,7,8,9,10,11,13,15,17,19,23,27,31,35,43,51,59,67,83,99,115,131,163,195,227,258,999,999,999],T:[0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0,0,0,0],q:new e(32),p:[1,2,3,4,5,7,9,13,17,25,33,49,65,97,129,193,257,385,513,769,1025,1537,2049,3073,4097,6145,8193,12289,16385,24577,65535,65535],z:[0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13,0,0],c:new t(32),J:new e(512),_:[],h:new e(32),$:[],w:new e(32768),C:[],v:[],d:new e(32768),D:[],u:new e(512),Q:[],r:new e(32768),s:new t(286),Y:new t(30),a:new t(19),t:new t(15e3),k:new e(65536),g:new e(32768)}}(),function(){const t=e.H.m;for(var n=0;n<32768;n++){let e=n;e=(2863311530&e)>>>1|(1431655765&e)<<1,e=(3435973836&e)>>>2|(858993459&e)<<2,e=(4042322160&e)>>>4|(252645135&e)<<4,e=(4278255360&e)>>>8|(16711935&e)<<8,t.r[n]=(e>>>16|e<<16)>>>17}function i(e,t,n){for(;0!=t--;)e.push(0,n)}for(n=0;n<32;n++)t.q[n]=t.S[n]<<3|t.T[n],t.c[n]=t.p[n]<<4|t.z[n];i(t._,144,8),i(t._,112,9),i(t._,24,7),i(t._,8,8),e.H.n(t._,9),e.H.A(t._,9,t.J),e.H.l(t._,9),i(t.$,32,5),e.H.n(t.$,5),e.H.A(t.$,5,t.h),e.H.l(t.$,5),i(t.Q,19,0),i(t.C,286,0),i(t.D,30,0),i(t.v,320,0)}(),e.H.N}();function o(e){return[1,null,3,1,2,null,4][e.ctype]*e.depth}function a(e,t,n,i,r){let a=o(t);const c=Math.ceil(i*a/8);let l,u;a=Math.ceil(a/8);let d=e[n],h=0;if(d>1&&(e[n]=[0,0,1][d-2]),3==d)for(h=a;h<c;h++)e[h+1]=e[h+1]+(e[h+1-a]>>>1)&255;for(let o=0;o<r;o++)if(l=n+o*c,u=l+o+1,d=e[u-1],h=0,0==d)for(;h<c;h++)e[l+h]=e[u+h];else if(1==d){for(;h<a;h++)e[l+h]=e[u+h];for(;h<c;h++)e[l+h]=e[u+h]+e[l+h-a]}else if(2==d)for(;h<c;h++)e[l+h]=e[u+h]+e[l+h-c];else if(3==d){for(;h<a;h++)e[l+h]=e[u+h]+(e[l+h-c]>>>1);for(;h<c;h++)e[l+h]=e[u+h]+(e[l+h-c]+e[l+h-a]>>>1)}else{for(;h<a;h++)e[l+h]=e[u+h]+s(0,e[l+h-c],0);for(;h<c;h++)e[l+h]=e[u+h]+s(e[l+h-a],e[l+h-c],e[l+h-a-c])}return e}function s(e,t,n){const i=e+t-n,r=i-e,o=i-t,a=i-n;return r*r<=o*o&&r*r<=a*a?e:o*o<=a*a?t:n}function c(t,n,i){i.width=e.readUint(t,n),n+=4,i.height=e.readUint(t,n),n+=4,i.depth=t[n],n++,i.ctype=t[n],n++,i.compress=t[n],n++,i.filter=t[n],n++,i.interlace=t[n],n++}function l(e,t,n,i,r,o,a,s,c){const l=Math.min(t,r),u=Math.min(n,o);let d=0,h=0;for(let b=0;b<u;b++)for(let n=0;n<l;n++)if(a>=0&&s>=0?(d=b*t+n<<2,h=(s+b)*r+a+n<<2):(d=(-s+b)*t-a+n<<2,h=b*r+n<<2),0==c)i[h]=e[d],i[h+1]=e[d+1],i[h+2]=e[d+2],i[h+3]=e[d+3];else if(1==c){var f=e[d+3]*(1/255),p=e[d]*f,m=e[d+1]*f,g=e[d+2]*f,y=i[h+3]*(1/255),v=i[h]*y,_=i[h+1]*y,w=i[h+2]*y;const t=1-f,n=f+y*t,r=0==n?0:1/n;i[h+3]=255*n,i[h+0]=(p+v*t)*r,i[h+1]=(m+_*t)*r,i[h+2]=(g+w*t)*r}else if(2==c)f=e[d+3],p=e[d],m=e[d+1],g=e[d+2],y=i[h+3],v=i[h],_=i[h+1],w=i[h+2],f==y&&p==v&&m==_&&g==w?(i[h]=0,i[h+1]=0,i[h+2]=0,i[h+3]=0):(i[h]=p,i[h+1]=m,i[h+2]=g,i[h+3]=f);else if(3==c){if(f=e[d+3],p=e[d],m=e[d+1],g=e[d+2],y=i[h+3],v=i[h],_=i[h+1],w=i[h+2],f==y&&p==v&&m==_&&g==w)continue;if(f<220&&y>20)return!1}return!0}return{decode:function(t){const o=new Uint8Array(t);let a=8;const s=e,l=s.readUshort,u=s.readUint,d={tabs:{},frames:[]},h=new Uint8Array(o.length);let f,p=0,m=0;const g=[137,80,78,71,13,10,26,10];for(var y=0;y<8;y++)if(o[y]!=g[y])throw"The input is not a PNG file!";for(;a<o.length;){const t=s.readUint(o,a);a+=4;const g=s.readASCII(o,a,4);if(a+=4,"IHDR"==g)c(o,a,d);else if("iCCP"==g){for(var v=a;0!=o[v];)v++;s.readASCII(o,a,v-a),o[v+1];const n=o.slice(v+2,a+t);let c=null;try{c=i(n)}catch(e){c=r(n)}d.tabs[g]=c}else if("CgBI"==g)d.tabs[g]=o.slice(a,a+4);else if("IDAT"==g){for(y=0;y<t;y++)h[p+y]=o[a+y];p+=t}else if("acTL"==g)d.tabs[g]={num_frames:u(o,a),num_plays:u(o,a+4)},f=new Uint8Array(o.length);else if("fcTL"==g){0!=m&&((E=d.frames[d.frames.length-1]).data=n(d,f.slice(0,m),E.rect.width,E.rect.height),m=0);const e={x:u(o,a+12),y:u(o,a+16),width:u(o,a+4),height:u(o,a+8)};let t=l(o,a+22);t=l(o,a+20)/(0==t?100:t);const i={rect:e,delay:Math.round(1e3*t),dispose:o[a+24],blend:o[a+25]};d.frames.push(i)}else if("fdAT"==g){for(y=0;y<t-4;y++)f[m+y]=o[a+y+4];m+=t-4}else if("pHYs"==g)d.tabs[g]=[s.readUint(o,a),s.readUint(o,a+4),o[a+8]];else if("cHRM"==g)for(d.tabs[g]=[],y=0;y<8;y++)d.tabs[g].push(s.readUint(o,a+4*y));else if("tEXt"==g||"zTXt"==g){null==d.tabs[g]&&(d.tabs[g]={});var _=s.nextZero(o,a),w=s.readASCII(o,a,_-a),b=a+t-_-1;if("tEXt"==g)S=s.readASCII(o,_+1,b);else{var x=i(o.slice(_+2,_+2+b));S=s.readUTF8(x,0,x.length)}d.tabs[g][w]=S}else if("iTXt"==g){null==d.tabs[g]&&(d.tabs[g]={}),_=0,v=a,_=s.nextZero(o,v),w=s.readASCII(o,v,_-v);const e=o[v=_+1];var S;o[v+1],v+=2,_=s.nextZero(o,v),s.readASCII(o,v,_-v),v=_+1,_=s.nextZero(o,v),s.readUTF8(o,v,_-v),b=t-((v=_+1)-a),0==e?S=s.readUTF8(o,v,b):(x=i(o.slice(v,v+b)),S=s.readUTF8(x,0,x.length)),d.tabs[g][w]=S}else if("PLTE"==g)d.tabs[g]=s.readBytes(o,a,t);else if("hIST"==g){const e=d.tabs.PLTE.length/3;for(d.tabs[g]=[],y=0;y<e;y++)d.tabs[g].push(l(o,a+2*y))}else if("tRNS"==g)3==d.ctype?d.tabs[g]=s.readBytes(o,a,t):0==d.ctype?d.tabs[g]=l(o,a):2==d.ctype&&(d.tabs[g]=[l(o,a),l(o,a+2),l(o,a+4)]);else if("gAMA"==g)d.tabs[g]=s.readUint(o,a)/1e5;else if("sRGB"==g)d.tabs[g]=o[a];else if("bKGD"==g)0==d.ctype||4==d.ctype?d.tabs[g]=[l(o,a)]:2==d.ctype||6==d.ctype?d.tabs[g]=[l(o,a),l(o,a+2),l(o,a+4)]:3==d.ctype&&(d.tabs[g]=o[a]);else if("IEND"==g)break;a+=t,s.readUint(o,a),a+=4}var E;return 0!=m&&((E=d.frames[d.frames.length-1]).data=n(d,f.slice(0,m),E.rect.width,E.rect.height)),d.data=n(d,h,d.width,d.height),delete d.compress,delete d.interlace,delete d.filter,d},toRGBA8:function(e){const n=e.width,i=e.height;if(null==e.tabs.acTL)return[t(e.data,n,i,e).buffer];const r=[];null==e.frames[0].data&&(e.frames[0].data=e.data);const o=n*i*4,a=new Uint8Array(o),s=new Uint8Array(o),c=new Uint8Array(o);for(let d=0;d<e.frames.length;d++){const h=e.frames[d],f=h.rect.x,p=h.rect.y,m=h.rect.width,g=h.rect.height,y=t(h.data,m,g,e);if(0!=d)for(var u=0;u<o;u++)c[u]=a[u];if(0==h.blend?l(y,m,g,a,n,i,f,p,0):1==h.blend&&l(y,m,g,a,n,i,f,p,1),r.push(a.buffer.slice(0)),0==h.dispose);else if(1==h.dispose)l(s,m,g,a,n,i,f,p,0);else if(2==h.dispose)for(u=0;u<o;u++)a[u]=c[u]}return r},_paeth:s,_copyTile:l,_bin:e}}();!function(){const{_copyTile:e}=Ik,{_bin:t}=Ik,n=Ik._paeth;var i={table:function(){const e=new Uint32Array(256);for(let t=0;t<256;t++){let n=t;for(let e=0;e<8;e++)1&n?n=3988292384^n>>>1:n>>>=1;e[t]=n}return e}(),update(e,t,n,r){for(let o=0;o<r;o++)e=i.table[255&(e^t[n+o])]^e>>>8;return e},crc:(e,t,n)=>4294967295^i.update(4294967295,e,t,n)};function r(e,t,n,i){t[n]+=e[0]*i>>4,t[n+1]+=e[1]*i>>4,t[n+2]+=e[2]*i>>4,t[n+3]+=e[3]*i>>4}function o(e){return Math.max(0,Math.min(255,e))}function a(e,t){const n=e[0]-t[0],i=e[1]-t[1],r=e[2]-t[2],o=e[3]-t[3];return n*n+i*i+r*r+o*o}function s(e,t,n,i,s,c,l){null==l&&(l=1);const u=i.length,d=[];for(var h=0;h<u;h++){const e=i[h];d.push([e>>>0&255,e>>>8&255,e>>>16&255,e>>>24&255])}for(h=0;h<u;h++){let e=4294967295;for(var f=0,p=0;p<u;p++){var m=a(d[h],d[p]);p!=h&&m<e&&(e=m,f=p)}}const g=new Uint32Array(s.buffer),y=new Int16Array(t*n*4),v=[0,8,2,10,12,4,14,6,3,11,1,9,15,7,13,5];for(h=0;h<v.length;h++)v[h]=255*((v[h]+.5)/16-.5);for(let w=0;w<n;w++)for(let s=0;s<t;s++){var _;h=4*(w*t+s),2!=l?_=[o(e[h]+y[h]),o(e[h+1]+y[h+1]),o(e[h+2]+y[h+2]),o(e[h+3]+y[h+3])]:(m=v[4*(3&w)+(3&s)],_=[o(e[h]+m),o(e[h+1]+m),o(e[h+2]+m),o(e[h+3]+m)]),f=0;let b=16777215;for(p=0;p<u;p++){const e=a(_,d[p]);e<b&&(b=e,f=p)}const x=d[f],S=[_[0]-x[0],_[1]-x[1],_[2]-x[2],_[3]-x[3]];1==l&&(s!=t-1&&r(S,y,h+4,7),w!=n-1&&(0!=s&&r(S,y,h+4*t-4,3),r(S,y,h+4*t,5),s!=t-1&&r(S,y,h+4*t+4,1))),c[h>>2]=f,g[h>>2]=i[f]}}function c(e,n,r,o,a){null==a&&(a={});const{crc:s}=i,c=t.writeUint,l=t.writeUshort,u=t.writeASCII;let d=8;const h=e.frames.length>1;let f,p=!1,m=33+(h?20:0);if(null!=a.sRGB&&(m+=13),null!=a.pHYs&&(m+=21),null!=a.iCCP&&(f=pako.deflate(a.iCCP),m+=21+f.length+4),3==e.ctype){for(var g=e.plte.length,y=0;y<g;y++)e.plte[y]>>>24!=255&&(p=!0);m+=8+3*g+4+(p?8+1*g+4:0)}for(var v=0;v<e.frames.length;v++)h&&(m+=38),m+=(x=e.frames[v]).cimg.length+12,0!=v&&(m+=4);m+=12;const _=new Uint8Array(m),w=[137,80,78,71,13,10,26,10];for(y=0;y<8;y++)_[y]=w[y];if(c(_,d,13),d+=4,u(_,d,"IHDR"),d+=4,c(_,d,n),d+=4,c(_,d,r),d+=4,_[d]=e.depth,d++,_[d]=e.ctype,d++,_[d]=0,d++,_[d]=0,d++,_[d]=0,d++,c(_,d,s(_,d-17,17)),d+=4,null!=a.sRGB&&(c(_,d,1),d+=4,u(_,d,"sRGB"),d+=4,_[d]=a.sRGB,d++,c(_,d,s(_,d-5,5)),d+=4),null!=a.iCCP){const e=13+f.length;c(_,d,e),d+=4,u(_,d,"iCCP"),d+=4,u(_,d,"ICC profile"),d+=11,d+=2,_.set(f,d),d+=f.length,c(_,d,s(_,d-(e+4),e+4)),d+=4}if(null!=a.pHYs&&(c(_,d,9),d+=4,u(_,d,"pHYs"),d+=4,c(_,d,a.pHYs[0]),d+=4,c(_,d,a.pHYs[1]),d+=4,_[d]=a.pHYs[2],d++,c(_,d,s(_,d-13,13)),d+=4),h&&(c(_,d,8),d+=4,u(_,d,"acTL"),d+=4,c(_,d,e.frames.length),d+=4,c(_,d,null!=a.loop?a.loop:0),d+=4,c(_,d,s(_,d-12,12)),d+=4),3==e.ctype){for(c(_,d,3*(g=e.plte.length)),d+=4,u(_,d,"PLTE"),d+=4,y=0;y<g;y++){const t=3*y,n=e.plte[y],i=255&n,r=n>>>8&255,o=n>>>16&255;_[d+t+0]=i,_[d+t+1]=r,_[d+t+2]=o}if(d+=3*g,c(_,d,s(_,d-3*g-4,3*g+4)),d+=4,p){for(c(_,d,g),d+=4,u(_,d,"tRNS"),d+=4,y=0;y<g;y++)_[d+y]=e.plte[y]>>>24&255;d+=g,c(_,d,s(_,d-g-4,g+4)),d+=4}}let b=0;for(v=0;v<e.frames.length;v++){var x=e.frames[v];h&&(c(_,d,26),d+=4,u(_,d,"fcTL"),d+=4,c(_,d,b++),d+=4,c(_,d,x.rect.width),d+=4,c(_,d,x.rect.height),d+=4,c(_,d,x.rect.x),d+=4,c(_,d,x.rect.y),d+=4,l(_,d,o[v]),d+=2,l(_,d,1e3),d+=2,_[d]=x.dispose,d++,_[d]=x.blend,d++,c(_,d,s(_,d-30,30)),d+=4);const t=x.cimg;c(_,d,(g=t.length)+(0==v?0:4)),d+=4;const n=d;u(_,d,0==v?"IDAT":"fdAT"),d+=4,0!=v&&(c(_,d,b++),d+=4),_.set(t,d),d+=g,c(_,d,s(_,n,d-n)),d+=4}return c(_,d,0),d+=4,u(_,d,"IEND"),d+=4,c(_,d,s(_,d-4,4)),d+=4,_.buffer}function l(e,t,n){for(let i=0;i<e.frames.length;i++){const r=e.frames[i];r.rect.width;const o=r.rect.height,a=new Uint8Array(o*r.bpl+o);r.cimg=f(r.img,o,r.bpp,r.bpl,a,t,n)}}function u(t,n,i,r,o){const a=o[0],c=o[1],l=o[2],u=o[3],f=o[4],p=o[5];let g=6,y=8,v=255;for(var _=0;_<t.length;_++){const e=new Uint8Array(t[_]);for(var w=e.length,b=0;b<w;b+=4)v&=e[b+3]}const x=255!=v,S=function(t,n,i,r,o,a){const s=[];for(var c=0;c<t.length;c++){const d=new Uint8Array(t[c]),f=new Uint32Array(d.buffer);var l;let m=0,g=0,y=n,v=i,_=r?1:0;if(0!=c){const w=a||r||1==c||0!=s[c-2].dispose?1:2;let b=0,x=1e9;for(let e=0;e<w;e++){var u=new Uint8Array(t[c-1-e]);const r=new Uint32Array(t[c-1-e]);let a=n,s=i,l=-1,d=-1;for(let e=0;e<i;e++)for(let t=0;t<n;t++)f[p=e*n+t]!=r[p]&&(t<a&&(a=t),t>l&&(l=t),e<s&&(s=e),e>d&&(d=e));-1==l&&(a=s=l=d=0),o&&(1==(1&a)&&a--,1==(1&s)&&s--);const h=(l-a+1)*(d-s+1);h<x&&(x=h,b=e,m=a,g=s,y=l-a+1,v=d-s+1)}u=new Uint8Array(t[c-1-b]),1==b&&(s[c-1].dispose=2),l=new Uint8Array(y*v*4),e(u,n,i,l,y,v,-m,-g,0),_=e(d,n,i,l,y,v,-m,-g,3)?1:0,1==_?h(d,n,i,l,{x:m,y:g,width:y,height:v}):e(d,n,i,l,y,v,-m,-g,0)}else l=d.slice(0);s.push({rect:{x:m,y:g,width:y,height:v},img:l,blend:_,dispose:0})}if(r)for(c=0;c<s.length;c++){if(1==(m=s[c]).blend)continue;const e=m.rect,r=s[c-1].rect,a=Math.min(e.x,r.x),l=Math.min(e.y,r.y),u={x:a,y:l,width:Math.max(e.x+e.width,r.x+r.width)-a,height:Math.max(e.y+e.height,r.y+r.height)-l};s[c-1].dispose=1,c-1!=0&&d(t,n,i,s,c-1,u,o),d(t,n,i,s,c,u,o)}let f=0;if(1!=t.length)for(var p=0;p<s.length;p++){var m;f+=(m=s[p]).rect.width*m.rect.height}return s}(t,n,i,a,c,l),E={},T=[],k=[];if(0!=r){const e=[];for(b=0;b<S.length;b++)e.push(S[b].img.buffer);const t=function(e){let t=0;for(var n=0;n<e.length;n++)t+=e[n].byteLength;const i=new Uint8Array(t);let r=0;for(n=0;n<e.length;n++){const t=new Uint8Array(e[n]),o=t.length;for(let e=0;e<o;e+=4){let n=t[e],o=t[e+1],a=t[e+2];const s=t[e+3];0==s&&(n=o=a=0),i[r+e]=n,i[r+e+1]=o,i[r+e+2]=a,i[r+e+3]=s}r+=o}return i.buffer}(e),n=m(t,r);for(b=0;b<n.plte.length;b++)T.push(n.plte[b].est.rgba);let i=0;for(b=0;b<S.length;b++){const e=(I=S[b]).img.length;var C=new Uint8Array(n.inds.buffer,i>>2,e>>2);k.push(C);const t=new Uint8Array(n.abuf,i,e);p&&s(I.img,I.rect.width,I.rect.height,T,t,C),I.img.set(t),i+=e}}else for(_=0;_<S.length;_++){var I=S[_];const e=new Uint32Array(I.img.buffer);var A=I.rect.width;for(w=e.length,C=new Uint8Array(w),k.push(C),b=0;b<w;b++){const t=e[b];if(0!=b&&t==e[b-1])C[b]=C[b-1];else if(b>A&&t==e[b-A])C[b]=C[b-A];else{let e=E[t];if(null==e&&(E[t]=e=T.length,T.push(t),T.length>=300))break;C[b]=e}}}const N=T.length;for(N<=256&&0==f&&(y=N<=2?1:N<=4?2:N<=16?4:8,y=Math.max(y,u)),_=0;_<S.length;_++){(I=S[_]).rect.x,I.rect.y,A=I.rect.width;const e=I.rect.height;let t=I.img;new Uint32Array(t.buffer);let n=4*A,i=4;if(N<=256&&0==f){n=Math.ceil(y*A/8);var O=new Uint8Array(n*e);const r=k[_];for(let t=0;t<e;t++){b=t*n;const e=t*A;if(8==y)for(var P=0;P<A;P++)O[b+P]=r[e+P];else if(4==y)for(P=0;P<A;P++)O[b+(P>>1)]|=r[e+P]<<4-4*(1&P);else if(2==y)for(P=0;P<A;P++)O[b+(P>>2)]|=r[e+P]<<6-2*(3&P);else if(1==y)for(P=0;P<A;P++)O[b+(P>>3)]|=r[e+P]<<7-1*(7&P)}t=O,g=3,i=1}else if(0==x&&1==S.length){O=new Uint8Array(A*e*3);const r=A*e;for(b=0;b<r;b++){const e=3*b,n=4*b;O[e]=t[n],O[e+1]=t[n+1],O[e+2]=t[n+2]}t=O,g=2,i=3,n=3*A}I.img=t,I.bpl=n,I.bpp=i}return{ctype:g,depth:y,plte:T,frames:S}}function d(t,n,i,r,o,a,s){const c=Uint8Array,l=Uint32Array,u=new c(t[o-1]),d=new l(t[o-1]),f=o+1<t.length?new c(t[o+1]):null,p=new c(t[o]),m=new l(p.buffer);let g=n,y=i,v=-1,_=-1;for(let e=0;e<a.height;e++)for(let t=0;t<a.width;t++){const i=a.x+t,s=a.y+e,c=s*n+i,l=m[c];0==l||0==r[o-1].dispose&&d[c]==l&&(null==f||0!=f[4*c+3])||(i<g&&(g=i),i>v&&(v=i),s<y&&(y=s),s>_&&(_=s))}-1==v&&(g=y=v=_=0),s&&(1==(1&g)&&g--,1==(1&y)&&y--),a={x:g,y:y,width:v-g+1,height:_-y+1};const w=r[o];w.rect=a,w.blend=1,w.img=new Uint8Array(a.width*a.height*4),0==r[o-1].dispose?(e(u,n,i,w.img,a.width,a.height,-a.x,-a.y,0),h(p,n,i,w.img,a)):e(p,n,i,w.img,a.width,a.height,-a.x,-a.y,0)}function h(t,n,i,r,o){e(t,n,i,r,o.width,o.height,-o.x,-o.y,2)}function f(e,t,n,i,r,o,a){const s=[];let c,l=[0,1,2,3,4];-1!=o?l=[o]:(t*i>5e5||1==n)&&(l=[0]),a&&(c={level:0});const u=Ck;for(var d=0;d<l.length;d++){for(let o=0;o<t;o++)p(r,e,o,i,n,l[d]);s.push(u.deflate(r,c))}let h,f=1e9;for(d=0;d<s.length;d++)s[d].length<f&&(h=d,f=s[d].length);return s[h]}function p(e,t,i,r,o,a){const s=i*r;let c=s+i;if(e[c]=a,c++,0==a)if(r<500)for(var l=0;l<r;l++)e[c+l]=t[s+l];else e.set(new Uint8Array(t.buffer,s,r),c);else if(1==a){for(l=0;l<o;l++)e[c+l]=t[s+l];for(l=o;l<r;l++)e[c+l]=t[s+l]-t[s+l-o]+256&255}else if(0==i){for(l=0;l<o;l++)e[c+l]=t[s+l];if(2==a)for(l=o;l<r;l++)e[c+l]=t[s+l];if(3==a)for(l=o;l<r;l++)e[c+l]=t[s+l]-(t[s+l-o]>>1)+256&255;if(4==a)for(l=o;l<r;l++)e[c+l]=t[s+l]-n(t[s+l-o],0,0)+256&255}else{if(2==a)for(l=0;l<r;l++)e[c+l]=t[s+l]+256-t[s+l-r]&255;if(3==a){for(l=0;l<o;l++)e[c+l]=t[s+l]+256-(t[s+l-r]>>1)&255;for(l=o;l<r;l++)e[c+l]=t[s+l]+256-(t[s+l-r]+t[s+l-o]>>1)&255}if(4==a){for(l=0;l<o;l++)e[c+l]=t[s+l]+256-n(0,t[s+l-r],0)&255;for(l=o;l<r;l++)e[c+l]=t[s+l]+256-n(t[s+l-o],t[s+l-r],t[s+l-o-r])&255}}}function m(e,t){const n=new Uint8Array(e),i=n.slice(0),r=new Uint32Array(i.buffer),o=g(i,t),a=o[0],s=o[1],c=n.length,l=new Uint8Array(c>>2);let u;if(n.length<2e7)for(var d=0;d<c;d+=4)u=y(a,h=n[d]*(1/255),f=n[d+1]*(1/255),p=n[d+2]*(1/255),m=n[d+3]*(1/255)),l[d>>2]=u.ind,r[d>>2]=u.est.rgba;else for(d=0;d<c;d+=4){var h=n[d]*(1/255),f=n[d+1]*(1/255),p=n[d+2]*(1/255),m=n[d+3]*(1/255);for(u=a;u.left;)u=v(u.est,h,f,p,m)<=0?u.left:u.right;l[d>>2]=u.ind,r[d>>2]=u.est.rgba}return{abuf:i.buffer,inds:l,plte:s}}function g(e,t,n){null==n&&(n=1e-4);const i=new Uint32Array(e.buffer),r={i0:0,i1:e.length,bst:null,est:null,tdst:0,left:null,right:null};r.bst=b(e,r.i0,r.i1),r.est=x(r.bst);const o=[r];for(;o.length<t;){let t=0,r=0;for(var a=0;a<o.length;a++)o[a].est.L>t&&(t=o[a].est.L,r=a);if(t<n)break;const s=o[r],c=_(e,i,s.i0,s.i1,s.est.e,s.est.eMq255);if(s.i0>=c||s.i1<=c){s.est.L=0;continue}const l={i0:s.i0,i1:c,bst:null,est:null,tdst:0,left:null,right:null};l.bst=b(e,l.i0,l.i1),l.est=x(l.bst);const u={i0:c,i1:s.i1,bst:null,est:null,tdst:0,left:null,right:null};for(u.bst={R:[],m:[],N:s.bst.N-l.bst.N},a=0;a<16;a++)u.bst.R[a]=s.bst.R[a]-l.bst.R[a];for(a=0;a<4;a++)u.bst.m[a]=s.bst.m[a]-l.bst.m[a];u.est=x(u.bst),s.left=l,s.right=u,o[r]=l,o.push(u)}for(o.sort((e,t)=>t.bst.N-e.bst.N),a=0;a<o.length;a++)o[a].ind=a;return[r,o]}function y(e,t,n,i,r){if(null==e.left)return e.tdst=function(e,t,n,i,r){const o=t-e[0],a=n-e[1],s=i-e[2],c=r-e[3];return o*o+a*a+s*s+c*c}(e.est.q,t,n,i,r),e;const o=v(e.est,t,n,i,r);let a=e.left,s=e.right;o>0&&(a=e.right,s=e.left);const c=y(a,t,n,i,r);if(c.tdst<=o*o)return c;const l=y(s,t,n,i,r);return l.tdst<c.tdst?l:c}function v(e,t,n,i,r){const{e:o}=e;return o[0]*t+o[1]*n+o[2]*i+o[3]*r-e.eMq}function _(e,t,n,i,r,o){for(i-=4;n<i;){for(;w(e,n,r)<=o;)n+=4;for(;w(e,i,r)>o;)i-=4;if(n>=i)break;const a=t[n>>2];t[n>>2]=t[i>>2],t[i>>2]=a,n+=4,i-=4}for(;w(e,n,r)>o;)n-=4;return n+4}function w(e,t,n){return e[t]*n[0]+e[t+1]*n[1]+e[t+2]*n[2]+e[t+3]*n[3]}function b(e,t,n){const i=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],r=[0,0,0,0],o=n-t>>2;for(let a=t;a<n;a+=4){const t=e[a]*(1/255),n=e[a+1]*(1/255),o=e[a+2]*(1/255),s=e[a+3]*(1/255);r[0]+=t,r[1]+=n,r[2]+=o,r[3]+=s,i[0]+=t*t,i[1]+=t*n,i[2]+=t*o,i[3]+=t*s,i[5]+=n*n,i[6]+=n*o,i[7]+=n*s,i[10]+=o*o,i[11]+=o*s,i[15]+=s*s}return i[4]=i[1],i[8]=i[2],i[9]=i[6],i[12]=i[3],i[13]=i[7],i[14]=i[11],{R:i,m:r,N:o}}function x(e){const{R:t}=e,{m:n}=e,{N:i}=e,r=n[0],o=n[1],a=n[2],s=n[3],c=0==i?0:1/i,l=[t[0]-r*r*c,t[1]-r*o*c,t[2]-r*a*c,t[3]-r*s*c,t[4]-o*r*c,t[5]-o*o*c,t[6]-o*a*c,t[7]-o*s*c,t[8]-a*r*c,t[9]-a*o*c,t[10]-a*a*c,t[11]-a*s*c,t[12]-s*r*c,t[13]-s*o*c,t[14]-s*a*c,t[15]-s*s*c],u=l,d=S;let h=[Math.random(),Math.random(),Math.random(),Math.random()],f=0,p=0;if(0!=i)for(let g=0;g<16&&(h=d.multVec(u,h),p=Math.sqrt(d.dot(h,h)),h=d.sml(1/p,h),!(0!=g&&Math.abs(p-f)<1e-9));g++)f=p;const m=[r*c,o*c,a*c,s*c];return{Cov:l,q:m,e:h,L:f,eMq255:d.dot(d.sml(255,m),h),eMq:d.dot(h,m),rgba:(Math.round(255*m[3])<<24|Math.round(255*m[2])<<16|Math.round(255*m[1])<<8|Math.round(255*m[0]))>>>0}}var S={multVec:(e,t)=>[e[0]*t[0]+e[1]*t[1]+e[2]*t[2]+e[3]*t[3],e[4]*t[0]+e[5]*t[1]+e[6]*t[2]+e[7]*t[3],e[8]*t[0]+e[9]*t[1]+e[10]*t[2]+e[11]*t[3],e[12]*t[0]+e[13]*t[1]+e[14]*t[2]+e[15]*t[3]],dot:(e,t)=>e[0]*t[0]+e[1]*t[1]+e[2]*t[2]+e[3]*t[3],sml:(e,t)=>[e*t[0],e*t[1],e*t[2],e*t[3]]};Ik.encode=function(e,t,n,i,r,o,a){null==i&&(i=0),null==a&&(a=!1);const s=u(e,t,n,i,[!1,!1,!1,0,a,!1]);return l(s,-1),c(s,t,n,r,o)},Ik.encodeLL=function(e,t,n,i,r,o,a,s){const u={ctype:0+(1==i?0:2)+(0==r?0:4),depth:o,frames:[]},d=(i+r)*o,h=d*t;for(let c=0;c<e.length;c++)u.frames.push({rect:{x:0,y:0,width:t,height:n},img:new Uint8Array(e[c]),blend:0,dispose:1,bpp:Math.ceil(d/8),bpl:Math.ceil(h/8)});return l(u,0,!0),c(u,t,n,a,s)},Ik.encode.compress=u,Ik.encode.dither=s,Ik.quantize=m,Ik.quantize.getKDtree=g,Ik.quantize.getNearest=y}();const Ak={toArrayBuffer(e,t){const n=e.width,i=e.height,r=n<<2,o=e.getContext("2d").getImageData(0,0,n,i),a=new Uint32Array(o.data.buffer),s=(32*n+31)/32<<2,c=s*i,l=122+c,u=new ArrayBuffer(l),d=new DataView(u),h=1<<20;let f,p,m,g,y=h,v=0,_=0,w=0;function b(e){d.setUint16(_,e,!0),_+=2}function x(e){d.setUint32(_,e,!0),_+=4}function S(e){_+=e}b(19778),x(l),S(4),x(122),x(108),x(n),x(-i>>>0),b(1),b(32),x(3),x(c),x(2835),x(2835),S(8),x(16711680),x(65280),x(255),x(4278190080),x(1466527264),function e(){for(;v<i&&y>0;){for(g=122+v*s,f=0;f<r;)y--,p=a[w++],m=p>>>24,d.setUint32(g+f,p<<8|m),f+=4;v++}w<a.length?(y=h,setTimeout(e,Ak._dly)):t(u)}()},toBlob(e,t){this.toArrayBuffer(e,e=>{t(new Blob([e],{type:"image/bmp"}))})},_dly:9};var Nk={CHROME:"CHROME",FIREFOX:"FIREFOX",DESKTOP_SAFARI:"DESKTOP_SAFARI",IE:"IE",IOS:"IOS",ETC:"ETC"},Ok={[Nk.CHROME]:16384,[Nk.FIREFOX]:11180,[Nk.DESKTOP_SAFARI]:16384,[Nk.IE]:8192,[Nk.IOS]:4096,[Nk.ETC]:8192};const Pk="undefined"!=typeof window,Rk="undefined"!=typeof WorkerGlobalScope&&self instanceof WorkerGlobalScope,Lk=Pk&&window.cordova&&window.cordova.require&&window.cordova.require("cordova/modulemapper"),zk=(Pk||Rk)&&(Lk&&Lk.getOriginalSymbol(window,"File")||"undefined"!=typeof File&&File),Mk=(Pk||Rk)&&(Lk&&Lk.getOriginalSymbol(window,"FileReader")||"undefined"!=typeof FileReader&&FileReader);function Dk(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:Date.now();return new Promise(i=>{const r=e.split(","),o=r[0].match(/:(.*?);/)[1],a=globalThis.atob(r[1]);let s=a.length;const c=new Uint8Array(s);for(;s--;)c[s]=a.charCodeAt(s);const l=new Blob([c],{type:o});l.name=t,l.lastModified=n,i(l)})}function Bk(e){return new Promise((t,n)=>{const i=new Mk;i.onload=()=>t(i.result),i.onerror=e=>n(e),i.readAsDataURL(e)})}function Uk(e){return new Promise((t,n)=>{const i=new Image;i.onload=()=>t(i),i.onerror=e=>n(e),i.src=e})}function Fk(){if(void 0!==Fk.cachedResult)return Fk.cachedResult;let e=Nk.ETC;const{userAgent:t}=navigator;return/Chrom(e|ium)/i.test(t)?e=Nk.CHROME:/iP(ad|od|hone)/i.test(t)&&/WebKit/i.test(t)?e=Nk.IOS:/Safari/i.test(t)?e=Nk.DESKTOP_SAFARI:/Firefox/i.test(t)?e=Nk.FIREFOX:(/MSIE/i.test(t)||1==!!document.documentMode)&&(e=Nk.IE),Fk.cachedResult=e,Fk.cachedResult}function jk(e,t){const n=Fk(),i=Ok[n];let r=e,o=t,a=r*o;const s=r>o?o/r:r/o;for(;a>i*i;){const e=(i+r)/2,t=(i+o)/2;e<t?(o=t,r=t*s):(o=e*s,r=e),a=r*o}return{width:r,height:o}}function Vk(e,t){let n,i;try{if(n=new OffscreenCanvas(e,t),i=n.getContext("2d"),null===i)throw new Error("getContext of OffscreenCanvas returns null")}catch(e){n=document.createElement("canvas"),i=n.getContext("2d")}return n.width=e,n.height=t,[n,i]}function qk(e,t){const{width:n,height:i}=jk(e.width,e.height),[r,o]=Vk(n,i);return t&&/jpe?g/.test(t)&&(o.fillStyle="white",o.fillRect(0,0,r.width,r.height)),o.drawImage(e,0,0,r.width,r.height),r}function Hk(){return void 0!==Hk.cachedResult||(Hk.cachedResult=["iPad Simulator","iPhone Simulator","iPod Simulator","iPad","iPhone","iPod"].includes(navigator.platform)||navigator.userAgent.includes("Mac")&&"undefined"!=typeof document&&"ontouchend"in document),Hk.cachedResult}function Wk(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return new Promise(function(n,i){let r,o;var a=function(){try{return o=qk(r,t.fileType||e.type),n([r,o])}catch(e){return i(e)}},s=function(t){try{var n=function(e){try{throw e}catch(e){return i(e)}};try{let t;return Bk(e).then(function(e){try{return t=e,Uk(t).then(function(e){try{return r=e,function(){try{return a()}catch(e){return i(e)}}()}catch(e){return n(e)}},n)}catch(e){return n(e)}},n)}catch(e){n(e)}}catch(e){return i(e)}};try{if(Hk()||[Nk.DESKTOP_SAFARI,Nk.MOBILE_SAFARI].includes(Fk()))throw new Error("Skip createImageBitmap on IOS and Safari");return createImageBitmap(e).then(function(e){try{return r=e,a()}catch(e){return s()}},s)}catch(e){s()}})}function Gk(e,t,n,i){let r=arguments.length>4&&void 0!==arguments[4]?arguments[4]:1;return new Promise(function(o,a){let s;if("image/png"===t){let l,u,d;return l=e.getContext("2d"),({data:u}=l.getImageData(0,0,e.width,e.height)),d=Ik.encode([u.buffer],e.width,e.height,4096*r),s=new Blob([d],{type:t}),s.name=n,s.lastModified=i,c.call(this)}{if("image/bmp"===t)return new Promise(t=>Ak.toBlob(e,t)).then(function(e){try{return s=e,s.name=n,s.lastModified=i,h.call(this)}catch(e){return a(e)}}.bind(this),a);{if("function"==typeof OffscreenCanvas&&e instanceof OffscreenCanvas)return e.convertToBlob({type:t,quality:r}).then(function(e){try{return s=e,s.name=n,s.lastModified=i,f.call(this)}catch(e){return a(e)}}.bind(this),a);{let p;return p=e.toDataURL(t,r),Dk(p,n,i).then(function(e){try{return s=e,f.call(this)}catch(e){return a(e)}}.bind(this),a)}function f(){return h.call(this)}}function h(){return c.call(this)}}function c(){return o(s)}})}function Kk(e){e.width=0,e.height=0}function Zk(){return new Promise(function(e,t){let n,i,r,o,a;return void 0!==Zk.cachedResult?e(Zk.cachedResult):(n="data:image/jpeg;base64,/9j/4QAiRXhpZgAATU0AKgAAAAgAAQESAAMAAAABAAYAAAAAAAD/2wCEAAEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAf/AABEIAAEAAgMBEQACEQEDEQH/xABKAAEAAAAAAAAAAAAAAAAAAAALEAEAAAAAAAAAAAAAAAAAAAAAAQEAAAAAAAAAAAAAAAAAAAAAEQEAAAAAAAAAAAAAAAAAAAAA/9oADAMBAAIRAxEAPwA/8H//2Q==",Dk("data:image/jpeg;base64,/9j/4QAiRXhpZgAATU0AKgAAAAgAAQESAAMAAAABAAYAAAAAAAD/2wCEAAEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAf/AABEIAAEAAgMBEQACEQEDEQH/xABKAAEAAAAAAAAAAAAAAAAAAAALEAEAAAAAAAAAAAAAAAAAAAAAAQEAAAAAAAAAAAAAAAAAAAAAEQEAAAAAAAAAAAAAAAAAAAAA/9oADAMBAAIRAxEAPwA/8H//2Q==","test.jpg",Date.now()).then(function(n){try{return i=n,Wk(i).then(function(n){try{return r=n[1],Gk(r,i.type,i.name,i.lastModified).then(function(n){try{return o=n,Kk(r),Wk(o).then(function(n){try{return a=n[0],Zk.cachedResult=1===a.width&&2===a.height,e(Zk.cachedResult)}catch(e){return t(e)}},t)}catch(e){return t(e)}},t)}catch(e){return t(e)}},t)}catch(e){return t(e)}},t))})}function Qk(e){return new Promise((t,n)=>{const i=new Mk;i.onload=e=>{const n=new DataView(e.target.result);if(65496!=n.getUint16(0,!1))return t(-2);const i=n.byteLength;let r=2;for(;r<i;){if(n.getUint16(r+2,!1)<=8)return t(-1);const e=n.getUint16(r,!1);if(r+=2,65505==e){if(1165519206!=n.getUint32(r+=2,!1))return t(-1);const e=18761==n.getUint16(r+=6,!1);r+=n.getUint32(r+4,e);const i=n.getUint16(r,e);r+=2;for(let o=0;o<i;o++)if(274==n.getUint16(r+12*o,e))return t(n.getUint16(r+12*o+8,e))}else{if(65280!=(65280&e))break;r+=n.getUint16(r,!1)}}return t(-1)},i.onerror=e=>n(e),i.readAsArrayBuffer(e)})}function Xk(e,t){const{width:n}=e,{height:i}=e,{maxWidthOrHeight:r}=t;let o,a=e;return isFinite(r)&&(n>r||i>r)&&([a,o]=Vk(n,i),n>i?(a.width=r,a.height=i/n*r):(a.width=n/i*r,a.height=r),o.drawImage(e,0,0,a.width,a.height),Kk(e)),a}function Yk(e,t){const{width:n}=e,{height:i}=e,[r,o]=Vk(n,i);switch(t>4&&t<9?(r.width=i,r.height=n):(r.width=n,r.height=i),t){case 2:o.transform(-1,0,0,1,n,0);break;case 3:o.transform(-1,0,0,-1,n,i);break;case 4:o.transform(1,0,0,-1,0,i);break;case 5:o.transform(0,1,1,0,0,0);break;case 6:o.transform(0,1,-1,0,i,0);break;case 7:o.transform(0,-1,-1,0,i,n);break;case 8:o.transform(0,-1,1,0,0,n)}return o.drawImage(e,0,0,n,i),Kk(e),r}function Jk(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;return new Promise(function(i,r){let o,a,s,c,l,u,d,h,f,p,m,g,y,v,_,w,b,x,S,E;function T(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:5;if(t.signal&&t.signal.aborted)throw t.signal.reason;o+=e,t.onProgress(Math.min(o,100))}function k(e){if(t.signal&&t.signal.aborted)throw t.signal.reason;o=Math.min(Math.max(e,o),100),t.onProgress(o)}return o=n,a=t.maxIteration||10,s=1024*t.maxSizeMB*1024,T(),Wk(e,t).then(function(n){try{return[,c]=n,T(),l=Xk(c,t),T(),new Promise(function(n,i){var r;if(!(r=t.exifOrientation))return Qk(e).then(function(e){try{return r=e,o.call(this)}catch(e){return i(e)}}.bind(this),i);function o(){return n(r)}return o.call(this)}).then(function(n){try{return u=n,T(),Zk().then(function(n){try{return d=n?l:Yk(l,u),T(),h=t.initialQuality||1,f=t.fileType||e.type,Gk(d,f,e.name,e.lastModified,h).then(function(n){try{{if(p=n,T(),m=p.size>s,g=p.size>e.size,!m&&!g)return k(100),i(p);var o;function C(){if(a--&&(_>s||_>y)){let t,n;return t=E?.95*S.width:S.width,n=E?.95*S.height:S.height,[b,x]=Vk(t,n),x.drawImage(S,0,0,t,n),h*="image/png"===f?.85:.95,Gk(b,f,e.name,e.lastModified,h).then(function(e){try{return w=e,Kk(S),S=b,_=w.size,k(Math.min(99,Math.floor((v-_)/(v-s)*100))),C}catch(e){return r(e)}},r)}return[1]}return y=e.size,v=p.size,_=v,S=d,E=!t.alwaysKeepResolution&&m,(o=function(e){for(;e;){if(e.then)return void e.then(o,r);try{if(e.pop){if(e.length)return e.pop()?I.call(this):e;e=C}else e=e.call(this)}catch(e){return r(e)}}}.bind(this))(C);function I(){return Kk(S),Kk(b),Kk(l),Kk(d),Kk(c),k(100),i(w)}}}catch(u){return r(u)}}.bind(this),r)}catch(e){return r(e)}}.bind(this),r)}catch(e){return r(e)}}.bind(this),r)}catch(e){return r(e)}}.bind(this),r)})}let $k;function eC(e,t){return new Promise((n,i)=>{$k||($k=function(e){const t=[];return"function"==typeof e?t.push("(".concat(e,")()")):t.push(e),URL.createObjectURL(new Blob(t))}("\nlet scriptImported = false\nself.addEventListener('message', async (e) => {\n  const { file, id, imageCompressionLibUrl, options } = e.data\n  options.onProgress = (progress) => self.postMessage({ progress, id })\n  try {\n    if (!scriptImported) {\n      // console.log('[worker] importScripts', imageCompressionLibUrl)\n      self.importScripts(imageCompressionLibUrl)\n      scriptImported = true\n    }\n    // console.log('[worker] self', self)\n    const compressedFile = await imageCompression(file, options)\n    self.postMessage({ file: compressedFile, id })\n  } catch (e) {\n    // console.error('[worker] error', e)\n    self.postMessage({ error: e.message + '\\n' + e.stack, id })\n  }\n})\n"));const r=new Worker($k);r.addEventListener("message",function(e){if(t.signal&&t.signal.aborted)r.terminate();else if(void 0===e.data.progress){if(e.data.error)return i(new Error(e.data.error)),void r.terminate();n(e.data.file),r.terminate()}else t.onProgress(e.data.progress)}),r.addEventListener("error",i),t.signal&&t.signal.addEventListener("abort",()=>{i(t.signal.reason),r.terminate()}),r.postMessage({file:e,imageCompressionLibUrl:t.libURL,options:s(s({},t),{},{onProgress:void 0,signal:void 0})})})}function tC(e,t){return new Promise(function(n,i){let r,o,a,c,l,u;if(r=s({},t),a=0,({onProgress:c}=r),r.maxSizeMB=r.maxSizeMB||Number.POSITIVE_INFINITY,l="boolean"!=typeof r.useWebWorker||r.useWebWorker,delete r.useWebWorker,r.onProgress=e=>{a=e,"function"==typeof c&&c(a)},!(e instanceof Blob||e instanceof zk))return i(new Error("The file given is not an instance of Blob or File"));if(!/^image/.test(e.type))return i(new Error("The file given is not an image"));if(u="undefined"!=typeof WorkerGlobalScope&&self instanceof WorkerGlobalScope,!l||"function"!=typeof Worker||u)return Jk(e,r).then(function(e){try{return o=e,f.call(this)}catch(e){return i(e)}}.bind(this),i);var d=function(){try{return f.call(this)}catch(e){return i(e)}}.bind(this),h=function(t){try{return Jk(e,r).then(function(e){try{return o=e,d()}catch(e){return i(e)}},i)}catch(e){return i(e)}};try{return r.libURL=r.libURL||"https://cdn.jsdelivr.net/npm/browser-image-compression@2.0.2/dist/browser-image-compression.js",eC(e,r).then(function(e){try{return o=e,d()}catch(e){return h()}},h)}catch(e){h()}function f(){try{o.name=e.name,o.lastModified=e.lastModified}catch(e){}try{r.preserveExif&&"image/jpeg"===e.type&&(!r.fileType||r.fileType&&r.fileType===e.type)&&(o=Sk(e,o))}catch(e){}return n(o)}})}tC.getDataUrlFromFile=Bk,tC.getFilefromDataUrl=Dk,tC.loadImage=Uk,tC.drawImageInCanvas=qk,tC.drawFileInCanvas=Wk,tC.canvasToFile=Gk,tC.getExifOrientation=Qk,tC.handleMaxWidthOrHeight=Xk,tC.followExifOrientation=Yk,tC.cleanupCanvasMemory=Kk,tC.isAutoOrientationInBrowser=Zk,tC.approximateBelowMaximumCanvasSizeOfBrowser=jk,tC.copyExifWithoutOrientation=Sk,tC.getBrowserName=Fk,tC.version="2.0.2";If("firebase","10.14.1","app");const nC=kf({apiKey:"AIzaSyD0JXHO4DzfHocbMb7DzxFkMnllIEjt2n0",authDomain:"reef-health-monitor-c7263.firebaseapp.com",projectId:"reef-health-monitor-c7263",storageBucket:"reef-health-monitor-c7263.firebasestorage.app",messagingSenderId:"930786260606",appId:"1:930786260606:web:e0f0a3323cb8d2bd724a2f"}),iC=function(e,t){const n="string"==typeof e?e:t||"(default)",i=bf("object"==typeof e?e:Cf(),"firestore").getImmediate({identifier:n});if(!i._initialized){const e=Wd("firestore");e&&function(e,t,n){let i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{};var r;const o=(e=rb(e,ab))._getSettings(),a="".concat(t,":").concat(n);if("firestore.googleapis.com"!==o.host&&o.host!==a&&ap("Host has been set in both settings() and connectFirestoreEmulator(), emulator host will be used."),e._setSettings(Object.assign(Object.assign({},o),{host:a,ssl:!1})),i.mockUserToken){let t,n;if("string"==typeof i.mockUserToken)t=i.mockUserToken,n=ep.MOCK_USER;else{t=Qd(i.mockUserToken,null===(r=e._app)||void 0===r?void 0:r.options.projectId);const o=i.mockUserToken.sub||i.mockUserToken.user_id;if(!o)throw new hp(dp.INVALID_ARGUMENT,"mockUserToken must contain 'sub' or 'user_id' field!");n=new ep(o)}e._authCredentials=new gp(new pp(t,n))}}(i,...e)}return i}(nC),rC=function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:Cf(),t=arguments.length>1?arguments[1]:void 0;e=lh(e);const n=bf(e,uS).getImmediate({identifier:t}),i=Wd("storage");return i&&function(e,t,n){let i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{};!function(e,t,n){let i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{};e.host="".concat(t,":").concat(n),e._protocol="http";const{mockUserToken:r}=i;r&&(e._overrideAuthToken="string"===typeof r?r:Qd(r,e.app.options.projectId))}(e,t,n,i)}(n,...i),n}(nC),oC=function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:Cf();const t=bf(e,"auth");if(t.isInitialized())return t.getImmediate();const n=function(e,t){const n=bf(e,"auth");if(n.isInitialized()){const e=n.getImmediate();if(nh(n.getOptions(),null!==t&&void 0!==t?t:{}))return e;vS(e,"already-initialized")}return n.initialize({options:t})}(e,{popupRedirectResolver:mk,persistence:[CT,uT,hT]}),i=Kd("authTokenSyncURL");if(i&&"boolean"===typeof isSecureContext&&isSecureContext){const e=new URL(i,location.origin);if(location.origin===e.origin){const t=(r=e.toString(),async e=>{const t=e&&await e.getIdTokenResult(),n=t&&((new Date).getTime()-Date.parse(t.issuedAtTime))/1e3;if(n&&n>_k)return;const i=null===t||void 0===t?void 0:t.token;wk!==i&&(wk=i,await fetch(r,{method:i?"POST":"DELETE",headers:i?{Authorization:"Bearer ".concat(i)}:{}}))});!function(e,t,n){lh(e).beforeAuthStateChanged(t,n)}(n,t,()=>t(n.currentUser)),function(e,t,n,i){lh(e).onIdTokenChanged(t,n,i)}(n,e=>t(e))}}var r;const o=Hd("auth");return o&&LE(n,"http://".concat(o)),n}(nC),aC={GPS:"gps",DIVE_SITE:"dive_site",CUSTOM_SITE:"custom_site",GENERAL:"general"},sC=[{id:"coki_beach",name:"Coki Beach",island:"St. Thomas",lat:18.35167,lng:-64.86583},{id:"cow_and_calf",name:"Cow and Calf Rocks",island:"St. Thomas",lat:18.3043,lng:-64.84662},{id:"wreck_alley",name:"Wreck Alley",island:"St. Thomas",lat:18.31,lng:-64.95},{id:"french_cap",name:"French Cap",island:"St. Thomas",lat:18.233,lng:-64.8529},{id:"hull_bay",name:"Hull Bay",island:"St. Thomas",lat:18.37087,lng:-64.95269},{id:"lovango_south",name:"Lovango (South)",island:"St. Thomas",lat:18.3603,lng:-64.8045},{id:"lovango_north",name:"Lovango (North)",island:"St. Thomas",lat:18.3648,lng:-64.8031},{id:"frederiksted_pier",name:"Frederiksted Pier",island:"St. Croix",lat:17.7138,lng:-64.88931},{id:"salt_river",name:"Salt River Canyon",island:"St. Croix",lat:17.7847,lng:-64.75637},{id:"cane_bay",name:"Cane Bay Wall",island:"St. Croix",lat:17.77422,lng:-64.81373},{id:"trunk_bay",name:"Trunk Bay",island:"St. John",lat:18.35426,lng:-64.76942},{id:"haulover_bay",name:"Haulover Bay",island:"St. John",lat:18.34885,lng:-64.67806},{id:"annaberg",name:"Annaberg",island:"St. John",lat:18.36421,lng:-64.72506}],cC=[{id:"st_thomas_north",name:"St. Thomas - North Shore"},{id:"st_thomas_south",name:"St. Thomas - South Shore"},{id:"st_thomas_east",name:"St. Thomas - East End"},{id:"st_thomas_west",name:"St. Thomas - West End"},{id:"st_croix_north",name:"St. Croix - North Shore"},{id:"st_croix_south",name:"St. Croix - South Shore"},{id:"st_john_north",name:"St. John - North Shore"},{id:"st_john_south",name:"St. John - South Shore"},{id:"water_island",name:"Water Island"}];async function lC(){if(oC.currentUser)console.log("\u2705 User already authenticated:",oC.currentUser.uid);else try{console.log("\ud83d\udd10 No user signed in, signing in anonymously..."),await async function(e){var t;if(xf(e.app))return Promise.reject(bS(e));const n=kE(e);if(await n._initializationPromise,null===(t=n.currentUser)||void 0===t?void 0:t.isAnonymous)return new eT({user:n.currentUser,providerId:null,operationType:"signIn"});const i=await $E(n,{returnSecureToken:!0}),r=await eT._fromIdTokenResponse(n,"signIn",i,!0);return await n._updateCurrentUser(r.user),r}(oC),console.log("\u2705 Anonymous sign-in successful:",oC.currentUser.uid)}catch(e){throw console.error("\u274c Anonymous sign-in failed:",e),new Error("Authentication required for uploads")}}async function uC(e){console.log("\ud83d\udd0d saveObservation called with full data:",JSON.stringify(e,null,2));try{var t,n;await lC();const{imageFile:o,prediction:a,confidence:c,locationType:l,locationData:u,notes:d="",isSensitive:h=!1,waterTemp:f,depth:p}=e;console.log("\ud83d\udce6 Extracted values:"),console.log("  - imageFile:",o?"exists":"MISSING"),console.log("  - locationType:",l),console.log("  - locationData:",JSON.stringify(u,null,2));const m=await async function(e){if(!e||!(e instanceof Blob||e instanceof File))throw console.error("Invalid file type passed to compressImage:",typeof e),new Error("Invalid image file");const t={maxSizeMB:1,maxWidthOrHeight:1920,useWebWorker:!0,fileType:"image/jpeg"};try{console.log("\ud83d\udddc\ufe0f Compressing image:",e.name,e.size,"bytes");const n=await tC(e,t);return console.log("\u2705 Compressed to:",n.size,"bytes"),n}catch(n){return console.error("\u274c Image compression failed:",n),e}}(o),g="".concat(Date.now(),"_").concat(Math.random().toString(36).substr(2,9)),y=(i=rC,r="coral-images/".concat(g,".jpg"),oS(i=lh(i),r)),v={contentType:"image/jpeg",customMetadata:{userId:(null===(t=oC.currentUser)||void 0===t?void 0:t.uid)||"anonymous",prediction:a,timestamp:(new Date).toISOString()}};await function(e,t,n){return tS(e=lh(e),t,n)}(y,m,v);const _=await function(e){return nS(e=lh(e))}(y);let w={type:l};switch(l){case aC.GPS:w=s(s({},w),{},{coordinates:u.coordinates,accuracy:u.accuracy,siteName:u.siteName||null});break;case aC.DIVE_SITE:const e=sC.find(e=>e.id===u.siteId);w=s(s({},w),{},{siteId:u.siteId,siteName:u.siteName,island:u.island,coordinates:e?{lat:e.lat,lng:e.lng}:null});break;case aC.CUSTOM_SITE:w=s(s({},w),{},{customSiteName:u.customSiteName,island:u.island||null,coordinates:u.coordinates||null,description:u.description||null});break;case aC.GENERAL:w=s(s({},w),{},{areaId:u.areaId,areaName:u.areaName})}const b=s(s(s({userId:(null===(n=oC.currentUser)||void 0===n?void 0:n.uid)||"anonymous",timestamp:kp.now(),prediction:a,confidence:c,imageUrl:_,imageId:g,location:w,isSensitive:h},f&&{waterTemp:f}),p&&{depth:p}),{},{notes:d,deviceInfo:{userAgent:navigator.userAgent,platform:navigator.platform,isIOS:/iPhone|iPad|iPod/.test(navigator.userAgent)}}),x=await Zb(ub(iC,"observations"),b);return console.log("\u2705 Observation saved to cloud:",x.id),{success:!0,id:x.id,imageUrl:_}}catch(o){return console.error("\u274c Failed to save observation:",o),{success:!1,error:o.message,queuedForRetry:!1}}var i,r}var dC=n(579);function hC(e){let{locationType:t,setLocationType:n,selectedSite:i,setSelectedSite:r,selectedArea:o,setSelectedArea:a,customSiteName:s,setCustomSiteName:c,customSiteIsland:l,setCustomSiteIsland:u,customSiteDescription:d,setCustomSiteDescription:h,useGPS:p,setUseGPS:m,isSensitive:g,setIsSensitive:y,notes:v,setNotes:_,onSave:w,onCancel:b,saving:x}=e;return(0,dC.jsx)("div",{className:"location-modal",children:(0,dC.jsxs)("div",{className:"location-modal-content",children:[(0,dC.jsx)("h3",{children:"\ud83d\udccd Where was this scan taken?"}),(0,dC.jsxs)("div",{className:"location-type-selector",children:[(0,dC.jsxs)("button",{className:t===aC.GPS?"active":"",onClick:()=>n(aC.GPS),children:[(0,dC.jsx)(Ld,{size:20}),"GPS"]}),(0,dC.jsxs)("button",{className:t===aC.DIVE_SITE?"active":"",onClick:()=>n(aC.DIVE_SITE),children:[(0,dC.jsx)(zd,{size:20}),"Dive Site"]}),(0,dC.jsxs)("button",{className:t===aC.CUSTOM_SITE?"active":"",onClick:()=>n(aC.CUSTOM_SITE),children:[(0,dC.jsx)(zd,{size:20}),"New Site"]}),(0,dC.jsxs)("button",{className:t===aC.GENERAL?"active":"",onClick:()=>n(aC.GENERAL),children:[(0,dC.jsx)(f,{size:20}),"General"]})]}),t===aC.GPS&&(0,dC.jsxs)("div",{className:"location-option",children:[(0,dC.jsx)("p",{children:"Share exact GPS coordinates"}),(0,dC.jsxs)("label",{children:[(0,dC.jsx)("input",{type:"checkbox",checked:p,onChange:e=>m(e.target.checked)}),"Use my current location"]})]}),t===aC.DIVE_SITE&&(0,dC.jsxs)("div",{className:"location-option",children:[(0,dC.jsx)("p",{children:"Select a known dive site"}),(0,dC.jsxs)("select",{value:i||"",onChange:e=>r(e.target.value),className:"site-selector",children:[(0,dC.jsx)("option",{value:"",children:"-- Select Dive Site --"}),sC.map(e=>(0,dC.jsxs)("option",{value:e.id,children:[e.name," (",e.island,")"]},e.id))]})]}),t===aC.CUSTOM_SITE&&(0,dC.jsxs)("div",{className:"location-option",children:[(0,dC.jsx)("p",{children:"Create a new dive site"}),(0,dC.jsx)("input",{type:"text",placeholder:"Site name (e.g., 'Secret Garden')",value:s,onChange:e=>c(e.target.value),className:"custom-site-input"}),(0,dC.jsxs)("select",{value:l,onChange:e=>u(e.target.value),className:"island-selector",children:[(0,dC.jsx)("option",{value:"St. Thomas",children:"St. Thomas"}),(0,dC.jsx)("option",{value:"St. Croix",children:"St. Croix"}),(0,dC.jsx)("option",{value:"St. John",children:"St. John"}),(0,dC.jsx)("option",{value:"Water Island",children:"Water Island"})]}),(0,dC.jsx)("textarea",{placeholder:"Optional: Describe this site...",value:d,onChange:e=>h(e.target.value),className:"custom-site-description",rows:2}),(0,dC.jsxs)("label",{className:"custom-site-gps",children:[(0,dC.jsx)("input",{type:"checkbox",checked:p,onChange:e=>m(e.target.checked)}),"\ud83d\udccd Also save GPS coordinates"]}),(0,dC.jsx)("div",{className:"info-box",children:"\ud83d\udca1 This site will be added to the community database!"})]}),t===aC.GENERAL&&(0,dC.jsxs)("div",{className:"location-option",children:[(0,dC.jsx)("p",{children:"Select a general area"}),(0,dC.jsxs)("select",{value:o||"",onChange:e=>a(e.target.value),className:"area-selector",children:[(0,dC.jsx)("option",{value:"",children:"-- Select Area --"}),cC.map(e=>(0,dC.jsx)("option",{value:e.id,children:e.name},e.id))]})]}),(0,dC.jsx)("div",{className:"sensitive-toggle",children:(0,dC.jsxs)("label",{children:[(0,dC.jsx)(Md,{size:16}),(0,dC.jsx)("input",{type:"checkbox",checked:g,onChange:e=>y(e.target.checked)}),"Sensitive location (rare species)"]})}),(0,dC.jsx)("textarea",{placeholder:"Add notes (depth, conditions, etc.)",value:v,onChange:e=>_(e.target.value),className:"notes-input",rows:3}),(0,dC.jsxs)("div",{className:"modal-actions",children:[(0,dC.jsx)("button",{onClick:b,disabled:x,className:"cancel-btn",children:"Cancel"}),(0,dC.jsx)("button",{onClick:w,disabled:x,className:"save-btn",children:x?"Saving...":"Save to Cloud"})]})]})})}const fC=(0,e.createContext)(null),pC=fC.Provider;function mC(){const t=(0,e.useContext)(fC);if(null==t)throw new Error("No context provided: useLeafletContext() can only be used in a descendant of <MapContainer>");return t}var gC=n(228),yC=n.n(gC);const vC=["bounds","boundsOptions","center","children","className","id","placeholder","style","whenReady","zoom"];function _C(){return _C=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var i in n)Object.prototype.hasOwnProperty.call(n,i)&&(e[i]=n[i])}return e},_C.apply(this,arguments)}function wC(t,n){let{bounds:i,boundsOptions:r,center:o,children:a,className:s,id:l,placeholder:u,style:d,whenReady:h,zoom:f}=t,p=c(t,vC);const[m]=(0,e.useState)({className:s,id:l,style:d}),[g,y]=(0,e.useState)(null);(0,e.useImperativeHandle)(n,()=>{var e;return null!==(e=null===g||void 0===g?void 0:g.map)&&void 0!==e?e:null},[g]);const v=(0,e.useCallback)(e=>{if(null!==e&&null===g){const t=new gC.Map(e,p);null!=o&&null!=f?t.setView(o,f):null!=i&&t.fitBounds(i,r),null!=h&&t.whenReady(h),y(function(e){return Object.freeze({__version:1,map:e})}(t))}},[]);(0,e.useEffect)(()=>()=>{null===g||void 0===g||g.map.remove()},[g]);const _=g?e.createElement(pC,{value:g},a):null!==u&&void 0!==u?u:null;return e.createElement("div",_C({},m,{ref:v}),_)}const bC=(0,e.forwardRef)(wC);function xC(e,t,n){return Object.freeze({instance:e,context:t,container:n})}function SC(t,n){return null==n?function(n,i){const r=(0,e.useRef)();return r.current||(r.current=t(n,i)),r}:function(i,r){const o=(0,e.useRef)();o.current||(o.current=t(i,r));const a=(0,e.useRef)(i),{instance:s}=o.current;return(0,e.useEffect)(function(){a.current!==i&&(n(s,i,a.current),a.current=i)},[s,i,r]),o}}function EC(t,n){const i=(0,e.useRef)(n);(0,e.useEffect)(function(){n!==i.current&&null!=t.attributionControl&&(null!=i.current&&t.attributionControl.removeAttribution(i.current),null!=n&&t.attributionControl.addAttribution(n)),i.current=n},[t,n])}function TC(t,n){const i=(0,e.useRef)();(0,e.useEffect)(function(){return null!=n&&t.instance.on(n),i.current=n,function(){null!=i.current&&t.instance.off(i.current),i.current=null}},[t,n])}function kC(e,t){var n;const i=null!==(n=e.pane)&&void 0!==n?n:t.pane;return i?s(s({},e),{},{pane:i}):e}function CC(t){return function(n){const i=mC(),r=t(kC(n,i),i);return EC(i.map,n.attribution),TC(r.current,n.eventHandlers),function(t,n){(0,e.useEffect)(function(){var e;return(null!==(e=n.layerContainer)&&void 0!==e?e:n.map).addLayer(t.instance),function(){var e;null===(e=n.layerContainer)||void 0===e||e.removeLayer(t.instance),n.map.removeLayer(t.instance)}},[n,t])}(r.current,i),r}}const IC=["url"],AC=function(t){function n(n,i){const{instance:r}=t(n).current;return(0,e.useImperativeHandle)(i,()=>r),null}return(0,e.forwardRef)(n)}(CC(SC(function(e,t){let{url:n}=e,i=c(e,IC);return xC(new gC.TileLayer(n,kC(i,t)),t)},function(e,t,n){!function(e,t,n){const{opacity:i,zIndex:r}=t;null!=i&&i!==n.opacity&&e.setOpacity(i),null!=r&&r!==n.zIndex&&e.setZIndex(r)}(e,t,n);const{url:i}=t;null!=i&&i!==n.url&&e.setUrl(i)})));const NC=["position"],OC=function(t,n){return function(t){function n(n,i){const{instance:r,context:o}=t(n).current;return(0,e.useImperativeHandle)(i,()=>r),null==n.children?null:e.createElement(pC,{value:o},n.children)}return(0,e.forwardRef)(n)}(CC(SC(t,n)))}(function(e,t){let{position:n}=e,i=c(e,NC);const r=new gC.Marker(n,i);return xC(r,(o=t,a={overlayContainer:r},Object.freeze(s(s({},o),a))));var o,a},function(e,t,n){t.position!==n.position&&e.setLatLng(t.position),null!=t.icon&&t.icon!==n.icon&&e.setIcon(t.icon),null!=t.zIndexOffset&&t.zIndexOffset!==n.zIndexOffset&&e.setZIndexOffset(t.zIndexOffset),null!=t.opacity&&t.opacity!==n.opacity&&e.setOpacity(t.opacity),null!=e.dragging&&t.draggable!==n.draggable&&(!0===t.draggable?e.dragging.enable():e.dragging.disable())}),PC=function(n,i){const r=function(e,t){return function(n,i){const r=mC(),o=e(kC(n,r),r);return EC(r.map,n.attribution),TC(o.current,n.eventHandlers),t(o.current,r,n,i),o}}(SC(n),i);return function(n){function i(i,r){const[o,a]=(0,e.useState)(!1),{instance:s}=n(i,a).current;(0,e.useImperativeHandle)(r,()=>s),(0,e.useEffect)(function(){o&&s.update()},[s,o,i.children]);const c=s._contentNode;return c?(0,t.createPortal)(i.children,c):null}return(0,e.forwardRef)(i)}(r)}(function(e,t){return xC(new gC.Popup(e,t.overlayContainer),t)},function(t,n,i,r){let{position:o}=i;(0,e.useEffect)(function(){const{instance:e}=t;function i(t){t.popup===e&&(e.update(),r(!0))}function a(t){t.popup===e&&r(!1)}return n.map.on({popupopen:i,popupclose:a}),null==n.overlayContainer?(null!=o&&e.setLatLng(o),e.openOn(n.map)):n.overlayContainer.bindPopup(e),function(){var t;n.map.off({popupopen:i,popupclose:a}),null===(t=n.overlayContainer)||void 0===t||t.unbindPopup(),n.map.removeLayer(e)}},[t,n,r,o])});delete yC().Icon.Default.prototype._getIconUrl,yC().Icon.Default.mergeOptions({iconRetinaUrl:n(249),iconUrl:n(24),shadowUrl:n(71)});const RC=e=>yC().divIcon({className:"custom-marker",html:'<div style="\n      background-color: '.concat(e,';\n      width: 20px;\n      height: 20px;\n      border-radius: 50%;\n      border: 2px solid white;\n      box-shadow: 0 2px 5px rgba(0,0,0,0.3);\n    "></div>'),iconSize:[20,20],iconAnchor:[10,10]}),LC=RC("#22c55e"),zC=RC("#ef4444"),MC=t=>{let{onBack:n}=t;const[i,r]=(0,e.useState)([]),[o,a]=(0,e.useState)(!0);(0,e.useEffect)(()=>{(async()=>{try{const e=ub(iC,"observations"),t=await function(e){e=rb(e,sb);const t=rb(e.firestore,hb),n=fb(t),i=new Kb(t);return Ub(e._query),Yw(n,e._query).then(n=>new Wb(t,i,e,n))}(e),n=[];t.forEach(e=>{var t,i,r,o;const a=e.data();if(null!==(t=a.location)&&void 0!==t&&t.coordinates&&!a.isSensitive)n.push(s({id:e.id},a));else if(null!==(i=a.location)&&void 0!==i&&i.siteId&&!a.isSensitive){const t=sC.find(e=>e.id===a.location.siteId);t&&(n.push(s(s({id:e.id},a),{},{location:s(s({},a.location),{},{coordinates:{lat:t.lat,lng:t.lng}})})),console.log("\u2713 Added coordinates for legacy observation at ".concat(t.name)))}else null!==(r=a.location)&&void 0!==r&&r.customSiteName&&null!==(o=a.location)&&void 0!==o&&o.coordinates&&!a.isSensitive&&n.push(s({id:e.id},a))}),console.log("Loaded ".concat(n.length," observations for map (including ").concat(t.size-n.length," without location data)")),r(n),a(!1)}catch(e){console.error("Error fetching observations:",e),a(!1)}})()},[]);return o?(0,dC.jsx)("div",{style:{padding:"20px",textAlign:"center",fontFamily:"system-ui, -apple-system, sans-serif"},children:"Loading map..."}):(0,dC.jsxs)("div",{style:{position:"relative",height:"100vh",width:"100%"},children:[(0,dC.jsx)("button",{onClick:n,style:{position:"absolute",top:"10px",left:"10px",zIndex:1e3,padding:"10px 15px",backgroundColor:"white",border:"none",borderRadius:"5px",boxShadow:"0 2px 5px rgba(0,0,0,0.3)",cursor:"pointer",fontFamily:"system-ui, -apple-system, sans-serif",fontSize:"16px"},children:"\u2190 Back"}),(0,dC.jsxs)(bC,{center:[17.9,-64.8],zoom:10,style:{height:"100%",width:"100%"},zoomControl:!0,children:[(0,dC.jsx)(AC,{url:"https://server.arcgisonline.com/ArcGIS/rest/services/World_Imagery/MapServer/tile/{z}/{y}/{x}",attribution:"Esri, DigitalGlobe, GeoEye",maxZoom:18}),i.map(e=>{var t,n,i;return(0,dC.jsx)(OC,{position:[e.location.coordinates.lat,e.location.coordinates.lng],icon:"Healthy Coral"===e.prediction?LC:zC,children:(0,dC.jsx)(PC,{children:(0,dC.jsxs)("div",{style:{minWidth:"150px",fontFamily:"system-ui, -apple-system, sans-serif"},children:[e.imageUrl&&(0,dC.jsx)("img",{src:e.imageUrl,alt:"coral observation",style:{width:"100%",marginBottom:"8px",borderRadius:"4px"}}),(0,dC.jsx)("p",{style:{margin:"4px 0",fontWeight:"bold"},children:e.prediction}),(0,dC.jsxs)("p",{style:{margin:"4px 0",fontSize:"0.9em"},children:["Confidence: ",parseFloat(e.confidence).toFixed(1),"%"]}),(0,dC.jsx)("p",{style:{margin:"4px 0",fontSize:"0.85em",color:"#666"},children:new Date(1e3*e.timestamp.seconds).toLocaleDateString()}),((null===(t=e.location)||void 0===t?void 0:t.diveSite)||(null===(n=e.location)||void 0===n?void 0:n.siteName)||(null===(i=e.location)||void 0===i?void 0:i.customSiteName))&&(0,dC.jsxs)("p",{style:{margin:"4px 0",fontSize:"0.85em"},children:["\ud83d\udccd ",e.location.diveSite||e.location.siteName||e.location.customSiteName]})]})})},e.id)})]})]})},DC=JSON.parse('[{"id":"elkhorn","commonName":"Elkhorn Coral","scientificName":"Acropora palmata","family":"Acroporidae","description":"Large, robust branching coral that forms thick, flattened branches resembling elk antlers. One of the most important reef-building corals in the Caribbean, providing critical habitat for fish and other marine life.","conservationStatus":"Critically Endangered","iucnStatus":"CR","habitat":"Shallow reef zones, typically 1-5 meters depth, high-energy wave zones","identificationTips":["Thick, broad branches that flatten toward the tips","Branches spread horizontally like antlers","Usually tan to golden-brown when healthy","Forms large colonies that can dominate shallow reefs"],"maxColonySize":"4+ meters diameter","depthRange":"1-5m","commonInUSVI":true,"threatFactors":["Climate change","Disease","Storm damage","Ocean acidification"]},{"id":"staghorn","commonName":"Staghorn Coral","scientificName":"Acropora cervicornis","family":"Acroporidae","description":"Fast-growing branching coral with cylindrical branches resembling deer antlers. Forms dense thickets that provide important shelter for juvenile fish and invertebrates.","conservationStatus":"Critically Endangered","iucnStatus":"CR","habitat":"Mid-depth reef zones, typically 5-15 meters, protected areas with moderate water flow","identificationTips":["Thin, cylindrical branches (finger-thick)","Branches extend upward at various angles","More delicate than Elkhorn","Pale brown to tan when healthy","Forms dense, complex thickets"],"maxColonySize":"2-3 meters diameter","depthRange":"5-15m","commonInUSVI":true,"threatFactors":["White band disease","Climate change","Hurricanes","Predation"]},{"id":"boulder-brain","commonName":"Boulder Brain Coral","scientificName":"Colpophyllia natans","family":"Mussidae","description":"Large, massive coral with distinctive meandering valleys and ridges that resemble a brain. Long-lived and slow-growing, these corals can be several hundred years old.","conservationStatus":"Vulnerable","iucnStatus":"VU","habitat":"Found across reef zones, from shallow to deep, 3-30 meters depth","identificationTips":["Large dome or boulder shape","Continuous meandering valleys (not individual circles)","Wide valleys with thick, rounded ridges","Usually brown, green, or yellowish","Valleys often lighter than ridges"],"maxColonySize":"2+ meters diameter","depthRange":"3-30m","commonInUSVI":true,"threatFactors":["Stony coral tissue loss disease","Bleaching","Climate change"]},{"id":"mountainous-star","commonName":"Mountainous Star Coral","scientificName":"Orbicella faveolata","family":"Merulinidae","description":"One of the most important reef-building corals in the Caribbean. Forms large, mountainous colonies with tall bumps and columns. Slow-growing and long-lived.","conservationStatus":"Endangered","iucnStatus":"EN","habitat":"Common on reef slopes and walls, 3-30 meters depth","identificationTips":["Forms tall columns or mountainous bumps","Surface covered with small star-shaped corallites","Corallites arranged in irregular rows","Usually brown to greenish-brown","Bumpy, uneven surface texture"],"maxColonySize":"3+ meters diameter and height","depthRange":"3-30m","commonInUSVI":true,"threatFactors":["Stony coral tissue loss disease","Bleaching","Yellow band disease"]},{"id":"mustard-hill","commonName":"Mustard Hill Coral","scientificName":"Porites astreoides","family":"Poritidae","description":"Common, hardy coral that forms dome-shaped or encrusting colonies. One of the most resilient Caribbean corals, able to withstand environmental stress better than many other species.","conservationStatus":"Least Concern","iucnStatus":"LC","habitat":"Very adaptable, found from shallow to deep reefs, 1-40 meters","identificationTips":["Usually bright mustard-yellow to brown","Smooth, bumpy surface texture","Tiny, closely-packed polyps (hard to see individual ones)","Often forms small domes or encrusting plates","Very common on Caribbean reefs"],"maxColonySize":"1-2 meters diameter","depthRange":"1-40m","commonInUSVI":true,"threatFactors":["Generally resilient, but affected by extreme bleaching events"]}]'),BC={elkhorn:"https://inaturalist-open-data.s3.amazonaws.com/photos/387555070/medium.jpeg",staghorn:"https://inaturalist-open-data.s3.amazonaws.com/photos/262267058/medium.jpeg","boulder-brain":"https://inaturalist-open-data.s3.amazonaws.com/photos/138509/medium.jpg","mountainous-star":"https://inaturalist-open-data.s3.amazonaws.com/photos/48931058/medium.jpeg","mustard-hill":"https://inaturalist-open-data.s3.amazonaws.com/photos/116660486/medium.jpeg"};function UC(e){let{coral:t,onClose:n,getStatusColor:i,imageUrl:r}=e;return(0,dC.jsx)("div",{className:"modal-overlay",onClick:n,children:(0,dC.jsxs)("div",{className:"modal-content-coral",onClick:e=>e.stopPropagation(),children:[(0,dC.jsx)("button",{className:"close-button",onClick:n,children:"\xd7"}),(0,dC.jsxs)("div",{className:"modal-image-hero",children:[(0,dC.jsx)("img",{src:r,alt:t.commonName}),(0,dC.jsx)("span",{className:"status-badge-large",style:{backgroundColor:i(t.iucnStatus)},children:t.conservationStatus})]}),(0,dC.jsxs)("div",{className:"modal-header",children:[(0,dC.jsx)("h2",{children:t.commonName}),(0,dC.jsx)("p",{className:"scientific-name-large",children:t.scientificName}),(0,dC.jsx)("p",{className:"family-name",children:t.family})]}),(0,dC.jsxs)("div",{className:"modal-body",children:[(0,dC.jsxs)("section",{children:[(0,dC.jsx)("h3",{children:"Description"}),(0,dC.jsx)("p",{children:t.description})]}),(0,dC.jsxs)("section",{children:[(0,dC.jsx)("h3",{children:"Habitat & Depth"}),(0,dC.jsx)("p",{children:t.habitat}),(0,dC.jsxs)("div",{className:"quick-stat",children:[(0,dC.jsx)("strong",{children:"Depth Range:"})," ",t.depthRange]})]}),(0,dC.jsxs)("section",{children:[(0,dC.jsx)("h3",{children:"How to Identify"}),(0,dC.jsx)("ul",{className:"id-tips",children:t.identificationTips.map((e,t)=>(0,dC.jsx)("li",{children:e},t))})]}),(0,dC.jsxs)("div",{className:"coral-specs-grid",children:[(0,dC.jsxs)("div",{className:"spec-box",children:[(0,dC.jsx)("div",{className:"spec-label",children:"Max Colony Size"}),(0,dC.jsx)("div",{className:"spec-value",children:t.maxColonySize})]}),(0,dC.jsxs)("div",{className:"spec-box",children:[(0,dC.jsx)("div",{className:"spec-label",children:"Conservation Status"}),(0,dC.jsx)("div",{className:"spec-value",children:t.conservationStatus})]})]}),t.threatFactors&&t.threatFactors.length>0&&(0,dC.jsxs)("section",{children:[(0,dC.jsx)("h3",{children:"Threat Factors"}),(0,dC.jsx)("div",{className:"threat-tags",children:t.threatFactors.map((e,t)=>(0,dC.jsx)("span",{className:"threat-tag",children:e},t))})]}),(0,dC.jsx)("div",{className:"modal-footer-note",children:(0,dC.jsx)("p",{children:"Photos from iNaturalist research-grade observations"})})]})]})})}const FC=function(){const[t,n]=(0,e.useState)(null),[i,r]=(0,e.useState)(""),o=e=>({CR:"#d32f2f",EN:"#f57c00",VU:"#fbc02d",NT:"#7cb342",LC:"#388e3c"}[e]||"#757575"),a=DC.filter(e=>e.commonName.toLowerCase().includes(i.toLowerCase())||e.scientificName.toLowerCase().includes(i.toLowerCase()));return(0,dC.jsxs)(dC.Fragment,{children:[(0,dC.jsxs)("div",{className:"coral-guide-section",children:[(0,dC.jsxs)("div",{className:"coral-guide-header",children:[(0,dC.jsx)("h3",{children:"\ud83e\udeb8 Learn About Caribbean Corals"}),(0,dC.jsx)("p",{children:"Common species found in USVI waters"})]}),(0,dC.jsx)("div",{className:"coral-search",children:(0,dC.jsx)("input",{type:"text",placeholder:"Search coral species...",value:i,onChange:e=>r(e.target.value),className:"search-input"})}),(0,dC.jsx)("div",{className:"coral-carousel",children:a.map(e=>(0,dC.jsxs)("div",{className:"coral-card-home",onClick:()=>n(e),children:[(0,dC.jsxs)("div",{className:"coral-image-container",children:[(0,dC.jsx)("img",{src:BC[e.id],alt:e.commonName,className:"coral-image"}),(0,dC.jsx)("span",{className:"status-badge-overlay",style:{backgroundColor:o(e.iucnStatus)},children:e.iucnStatus})]}),(0,dC.jsxs)("div",{className:"coral-info",children:[(0,dC.jsx)("h4",{children:e.commonName}),(0,dC.jsx)("p",{className:"scientific-name-home",children:e.scientificName})]})]},e.id))}),0===a.length&&(0,dC.jsxs)("p",{className:"no-results",children:['No corals found matching "',i,'"']})]}),t&&(0,dC.jsx)(UC,{coral:t,onClose:()=>n(null),getStatusColor:o,imageUrl:BC[t.id]})]})},jC=["Bleached Coral","Healthy Coral"];const VC=function(){const[t,n]=(0,e.useState)(null),[i,r]=(0,e.useState)(!0),[o,a]=(0,e.useState)(!1),[c,l]=(0,e.useState)(null),[u,d]=(0,e.useState)([]),[w,b]=(0,e.useState)(!1),[x,S]=(0,e.useState)(!1),[E,T]=(0,e.useState)(null),k=(0,e.useRef)(null),C=(0,e.useRef)(null),[I,A]=((0,e.useRef)(null),(0,e.useState)(!1)),[N,O]=(0,e.useState)(!1),[P,R]=(0,e.useState)(aC.DIVE_SITE),[L,z]=(0,e.useState)(null),[M,D]=(0,e.useState)(null),[B,U]=(0,e.useState)(""),[F,j]=(0,e.useState)("St. Thomas"),[V,q]=(0,e.useState)(""),[W,G]=(0,e.useState)(!0),[K,Z]=(0,e.useState)(!1),[Q,X]=(0,e.useState)(""),[Y,$]=(0,e.useState)(!1),[ee,te]=(0,e.useState)(null),[ne,ie]=(0,e.useState)(!1),[re,oe]=(0,e.useState)(!1);(0,e.useEffect)(()=>{ce(),le(),ae(),se()},[]);const ae=()=>{localStorage.getItem("reefMonitorWelcomeSeen")||ie(!0)},se=()=>{const e=/Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent);oe(e)},ce=async()=>{try{r(!0),T(null);const e=await J.create("/reef-monitor-app/coral_model.onnx",{executionProviders:["wasm"]});n(e),r(!1)}catch(e){console.error("Error loading model:",e),T("Failed to load AI model. Please refresh the page."),r(!1)}},le=()=>{const e=localStorage.getItem("reefMonitorHistory");e&&d(JSON.parse(e))},ue=function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;const n=[s(s({},e),{},{timestamp:(new Date).toISOString(),id:Date.now(),cloudId:t,synced:!!t}),...u].slice(0,50);d(n),localStorage.setItem("reefMonitorHistory",JSON.stringify(n))},de=async(e,n)=>{if(!t)return i?void setTimeout(()=>de(e,n),500):void T("Model failed to load. Please refresh the page.");a(!0),T(null),te(n);try{const n=new Image;n.crossOrigin="anonymous",await new Promise((t,i)=>{n.onload=t,n.onerror=i,n.src=e});const i=await(r=n,new Promise(e=>{const t=document.createElement("canvas");t.width=224,t.height=224;const n=t.getContext("2d");n.drawImage(r,0,0,224,224);const i=n.getImageData(0,0,224,224).data,o=new Float32Array(150528);for(let r=0;r<i.length;r+=4){const e=r/4;o[3*e]=i[r]/255,o[3*e+1]=i[r+1]/255,o[3*e+2]=i[r+2]/255}e(o)})),o=new H("float32",i,[1,224,224,3]),s=t.inputNames[0],c={[s]:o},u=await t.run(c),d=u[Object.keys(u)[0]].data[0],h=1-d,f=d>.5,p={prediction:f?jC[1]:jC[0],confidence:(100*(f?d:h)).toFixed(1),allPredictions:[{label:jC[0],confidence:(100*h).toFixed(1)},{label:jC[1],confidence:(100*d).toFixed(1)}],imageUrl:e};l(p),a(!1),O(!0)}catch(o){console.error("Analysis error:",o),T("Failed to analyze image. Please try again."),a(!1)}var r},he=e=>{const t=e.target.files[0];if(t){T(null);let e=t;t.name&&"image.jpg"!==t.name&&"blob"!==t.name||(e=new File([t],"coral-".concat(Date.now(),".jpg"),{type:t.type||"image/jpeg"}));const n=new FileReader;n.onload=t=>{de(t.target.result,e)},n.onerror=()=>{T("Failed to read image file.")},n.readAsDataURL(e)}e.target.value=""},fe=()=>new Promise(e=>{navigator.geolocation?navigator.geolocation.getCurrentPosition(t=>e({lat:t.coords.latitude,lng:t.coords.longitude,accuracy:t.coords.accuracy}),()=>e(null),{timeout:5e3}):e(null)}),pe=e=>e.includes("Healthy")?"var(--coral-healthy)":e.includes("Bleached")?"var(--coral-warn)":e.includes("Dead")?"var(--coral-danger)":"var(--coral-disease)";return(0,dC.jsxs)("div",{className:"App",children:[(0,dC.jsxs)("header",{className:"header",children:[(0,dC.jsx)("h1",{children:"\ud83e\udeb8 Reef Monitor"}),(0,dC.jsxs)("div",{style:{display:"flex",gap:"10px"},children:[(0,dC.jsx)("button",{className:"history-btn",onClick:()=>b(!w),title:"View History",children:(0,dC.jsx)(h,{size:24})}),(0,dC.jsx)("button",{className:"history-btn",onClick:()=>S(!0),title:"View Map",children:(0,dC.jsx)(f,{size:24})})]})]}),i&&!E&&(0,dC.jsxs)("div",{className:"loading-screen",children:[(0,dC.jsx)(p,{className:"spinner",size:64}),(0,dC.jsx)("h2",{children:"Loading AI Model..."}),(0,dC.jsx)("p",{children:"Downloading coral health classifier (~77MB)"}),(0,dC.jsx)("p",{className:"loading-tip",children:"This only happens once!"})]}),N&&(0,dC.jsx)(hC,{locationType:P,setLocationType:R,selectedSite:L,setSelectedSite:z,selectedArea:M,setSelectedArea:D,customSiteName:B,setCustomSiteName:U,customSiteIsland:F,setCustomSiteIsland:j,customSiteDescription:V,setCustomSiteDescription:q,useGPS:W,setUseGPS:G,isSensitive:K,setIsSensitive:Z,notes:Q,setNotes:X,onSave:async()=>{try{$(!0);let e={};switch(P){case aC.GPS:if(W){const t=await fe();if(!t)return alert("Could not get GPS location. Please try another option."),void $(!1);e={coordinates:{lat:t.lat,lng:t.lng},accuracy:t.accuracy}}break;case aC.DIVE_SITE:if(console.log("\ud83d\udd0d DIVE_SITE case triggered"),console.log("\ud83d\udd0d selectedSite value:",L),!L)return alert("Please select a dive site"),void $(!1);const t=sC.find(e=>e.id===L);console.log("\ud83d\udd0d Found site object:",t),t?(e={siteId:t.id,siteName:t.name,island:t.island},console.log("\u2705 locationData built:",e)):console.error("\u274c Site not found in USVI_DIVE_SITES!");break;case aC.CUSTOM_SITE:if(!B.trim())return alert("Please enter a site name"),void $(!1);if(e={siteName:B,island:F,description:V},W){const t=await fe();t&&(e.coordinates={lat:t.lat,lng:t.lng},e.accuracy=t.accuracy)}break;case aC.GENERAL_AREA:if(!M)return alert("Please select an area"),void $(!1);const n=cC.find(e=>e.name===M);n&&(e={generalArea:n.name,approximateCoordinates:n.approximateCenter})}const t={imageFile:ee,prediction:c.prediction,confidence:parseFloat(c.confidence),allPredictions:c.allPredictions,timestamp:(new Date).toISOString(),locationType:P,locationData:e,isSensitive:K,notes:Q.trim()},n=await uC(t),i=(null===n||void 0===n?void 0:n.id)||null;ue(c,i),O(!1),te(null),X(""),U(""),q(""),z(null),D(null),alert("Observation saved successfully! \ud83e\udeb8")}catch(e){console.error("Error saving observation:",e),alert("Failed to save to cloud, but saved locally. Check your connection."),ue(c,null),O(!1)}finally{$(!1)}},onCancel:()=>{O(!1),te(null)},saving:Y}),ne&&(0,dC.jsx)("div",{className:"welcome-overlay",children:(0,dC.jsxs)("div",{className:"welcome-modal",children:[(0,dC.jsxs)("div",{className:"welcome-header",children:[(0,dC.jsx)("h1",{children:"\ud83e\udeb8 Reef Monitor"}),(0,dC.jsx)("p",{className:"welcome-subtitle",children:"AI-Powered Coral Health Analysis"})]}),(0,dC.jsxs)("div",{className:"welcome-content",children:[(0,dC.jsxs)("p",{className:"welcome-developer",children:["Developed by ",(0,dC.jsx)("strong",{children:"Daniel Basick"})]}),(0,dC.jsx)("p",{className:"welcome-description",children:"An AI-powered tool for documenting coral health in the USVI. Built to support marine researchers, dive operators, and citizen scientists in tracking reef conditions over time."}),(0,dC.jsxs)("div",{className:"welcome-features",children:[(0,dC.jsxs)("div",{className:"welcome-feature",children:[(0,dC.jsx)("span",{className:"feature-icon",children:"\ud83e\udeb8"}),(0,dC.jsx)("span",{children:"Every scan helps build a community database"})]}),(0,dC.jsxs)("div",{className:"welcome-feature",children:[(0,dC.jsx)("span",{className:"feature-icon",children:"\ud83c\udf0a"}),(0,dC.jsx)("span",{children:"Your observations contribute to conservation efforts"})]})]}),(0,dC.jsxs)("p",{className:"welcome-contact",children:["Questions? ",(0,dC.jsx)("a",{href:"mailto:DaBasick@yahoo.com",children:"DaBasick@yahoo.com"})]})]}),(0,dC.jsx)("button",{className:"welcome-btn",onClick:()=>{localStorage.setItem("reefMonitorWelcomeSeen","true"),ie(!1)},children:"Get Started"})]})}),!w&&!x&&(0,dC.jsxs)("main",{className:"main",children:[!c&&!i&&(0,dC.jsxs)("div",{className:"action-section",children:[re&&(0,dC.jsxs)("button",{className:"action-btn primary",onClick:()=>{var e;return null===(e=C.current)||void 0===e?void 0:e.click()},children:[(0,dC.jsx)(m,{size:32}),(0,dC.jsx)("span",{children:"Take Photo"})]}),(0,dC.jsxs)("button",{className:"action-btn ".concat(re?"secondary":"primary"),onClick:()=>{var e;return null===(e=k.current)||void 0===e?void 0:e.click()},children:[(0,dC.jsx)(g,{size:32}),(0,dC.jsx)("span",{children:"Upload Image"})]}),(0,dC.jsx)("input",{ref:k,type:"file",accept:"image/*",onChange:he,style:{display:"none"}}),(0,dC.jsx)("input",{ref:C,type:"file",accept:"image/*",capture:"environment",onChange:he,style:{display:"none"}})]}),o&&(0,dC.jsxs)("div",{className:"analyzing",children:[(0,dC.jsx)(p,{className:"spinner",size:48}),(0,dC.jsx)("h2",{children:"Analyzing Coral Health..."}),(0,dC.jsx)("p",{children:"AI processing in progress"})]}),E&&!c&&!o&&(0,dC.jsxs)("div",{className:"error-banner",children:[(0,dC.jsx)(y,{size:20}),(0,dC.jsx)("span",{children:E})]}),c&&!o&&!N&&(0,dC.jsxs)("div",{className:"results",children:[(0,dC.jsx)("div",{className:"result-image",children:(0,dC.jsx)("img",{src:c.imageUrl,alt:"Analyzed coral"})}),(0,dC.jsxs)("div",{className:"result-card",children:[(0,dC.jsxs)("div",{className:"result-header",children:[(0,dC.jsx)("span",{className:"result-icon",children:(me=c.prediction,me.includes("Healthy")?"\ud83e\udeb8":me.includes("Bleached")?"\u26a0\ufe0f":me.includes("Dead")?"\ud83d\udc80":"\ud83e\udda0")}),(0,dC.jsxs)("div",{children:[(0,dC.jsx)("h2",{children:c.prediction}),(0,dC.jsxs)("p",{className:"confidence",children:[c.confidence,"% confidence"]})]})]}),(0,dC.jsx)("div",{className:"confidence-bar",children:(0,dC.jsx)("div",{className:"confidence-fill",style:{width:"".concat(c.confidence,"%"),backgroundColor:pe(c.prediction)}})}),(0,dC.jsxs)("div",{className:"all-predictions",children:[(0,dC.jsx)("h3",{children:"Detailed Analysis"}),c.allPredictions.map((e,t)=>(0,dC.jsxs)("div",{className:"prediction-row",children:[(0,dC.jsx)("span",{className:"pred-label",children:e.label}),(0,dC.jsx)("div",{className:"pred-bar-container",children:(0,dC.jsx)("div",{className:"pred-bar",style:{width:"".concat(e.confidence,"%")}})}),(0,dC.jsxs)("span",{className:"pred-value",children:[e.confidence,"%"]})]},t))]}),(0,dC.jsxs)("button",{className:"btn-new-scan",onClick:()=>{l(null),T(null),te(null)},children:["New Scan",(0,dC.jsx)(v,{size:20})]})]})]}),!c&&!o&&!i&&(0,dC.jsxs)("div",{className:"info-card",children:[(0,dC.jsx)("h3",{children:"How It Works"}),(0,dC.jsxs)("ol",{children:[(0,dC.jsx)("li",{children:"Take or upload a photo of coral"}),(0,dC.jsx)("li",{children:"AI analyzes the health condition"}),(0,dC.jsx)("li",{children:"Add location details for the database"}),(0,dC.jsx)("li",{children:"Contribute to global reef health monitoring"})]})]}),!c&&!o&&!i&&(0,dC.jsx)(FC,{})]}),w&&(0,dC.jsxs)("div",{className:"history-view",children:[(0,dC.jsxs)("div",{className:"history-header",children:[(0,dC.jsx)("h2",{children:"Scan History"}),(0,dC.jsx)("button",{onClick:()=>b(!1),children:"Close"})]}),0===u.length?(0,dC.jsxs)("div",{className:"empty-history",children:[(0,dC.jsx)(h,{size:64}),(0,dC.jsx)("p",{children:"No scans yet"})]}):(0,dC.jsx)("div",{className:"history-list",children:u.map(e=>(0,dC.jsxs)("div",{className:"history-item",children:[(0,dC.jsx)("img",{src:e.imageUrl,alt:"Historical scan"}),(0,dC.jsxs)("div",{className:"history-info",children:[(0,dC.jsx)("h4",{children:e.prediction}),(0,dC.jsxs)("p",{children:[e.confidence,"% confident"]}),(0,dC.jsx)("span",{className:"history-date",children:new Date(e.timestamp).toLocaleDateString()}),e.synced&&(0,dC.jsx)("span",{className:"cloud-badge",children:"\u2601\ufe0f"})]}),(0,dC.jsx)("div",{className:"history-indicator",style:{backgroundColor:pe(e.prediction)}}),(0,dC.jsx)("button",{className:"btn-delete-item",onClick:()=>(e=>{const t=u.filter(t=>t.id!==e);d(t),localStorage.setItem("reefMonitorHistory",JSON.stringify(t))})(e.id),"aria-label":"Delete scan",children:(0,dC.jsx)(_,{size:18})})]},e.id))})]}),x&&(0,dC.jsx)(MC,{onBack:()=>S(!1)}),(0,dC.jsxs)("footer",{className:"footer",children:[(0,dC.jsxs)("p",{children:["Developed by Daniel Basick \u2022 ",(0,dC.jsx)("a",{href:"mailto:DaBasick@yahoo.com",children:"DaBasick@yahoo.com"})]}),(0,dC.jsx)("p",{children:"Powered by AI \u2022 Built for Conservation"})]})]});var me};t.render((0,dC.jsx)(e.StrictMode,{children:(0,dC.jsx)(VC,{})}),document.getElementById("root"))})()})();
//# sourceMappingURL=main.ad789b2e.js.map